LavaPack.loadBundle([[32,{"../../../../shared/constants/app":6186,"../../../../shared/constants/gas":6187,"../../../../shared/constants/metametrics":6190,"../../../../shared/constants/network":6191,"../../../../shared/constants/transaction":6196,"../../../../shared/modules/conversion.utils":6199,"../../../../shared/modules/swaps.utils":6209,"../../../../shared/modules/transaction.utils":6210,"../../../../ui/helpers/constants/transactions":6734,"../../../../ui/helpers/utils/conversions.util":6748,"../../../../ui/pages/send/send.utils":7005,"../../../../ui/pages/swaps/swaps.util":7113,"../../lib/cleanErrorStack":43,"../../lib/util":84,"../../metamask-controller":85,"./lib/util":34,"./pending-tx-tracker":35,"./tx-gas-utils":36,"./tx-state-manager":37,"@babel/runtime/helpers/defineProperty":196,"@babel/runtime/helpers/interopRequireDefault":202,"@ethereumjs/common":408,"@ethereumjs/tx":412,"@metamask/obs-store":1206,"bignumber.js":2065,"eth-rpc-errors":2489,"ethereumjs-util":2564,"ethjs-query":2613,lodash:5188,loglevel:5198,"nonce-tracker":5312,"safe-event-emitter":5749},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("@babel/runtime/helpers/defineProperty")),s=r(t("safe-event-emitter")),i=t("@metamask/obs-store"),o=t("ethereumjs-util"),c=r(t("ethjs-query")),u=t("eth-rpc-errors"),d=r(t("@ethereumjs/common")),l=t("@ethereumjs/tx"),p=r(t("nonce-tracker")),h=r(t("loglevel")),f=r(t("bignumber.js")),T=t("lodash"),m=r(t("../../lib/cleanErrorStack")),g=t("../../lib/util"),E=t("../../../../ui/pages/send/send.utils"),P=t("../../../../ui/pages/swaps/swaps.util"),S=t("../../../../ui/helpers/utils/conversions.util"),x=t("../../../../shared/constants/transaction"),v=t("../../../../ui/helpers/constants/transactions"),_=t("../../metamask-controller"),y=t("../../../../shared/constants/gas"),A=t("../../../../shared/modules/conversion.utils"),b=t("../../../../shared/modules/swaps.utils"),w=t("../../../../shared/constants/metametrics"),N=t("../../../../shared/constants/network"),O=t("../../../../shared/modules/transaction.utils"),I=t("../../../../shared/constants/app"),C=r(t("./tx-state-manager")),k=r(t("./tx-gas-utils")),R=r(t("./pending-tx-tracker")),M=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var a=D(e);if(a&&a.has(t))return a.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var i=n?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(r,s,i):r[s]=t[s]}r.default=t,a&&a.set(t,r);return r}(t("./lib/util"));function D(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,a=new WeakMap;return(D=function(t){return t?a:e})(t)}function F(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function G(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?F(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}const L=[x.TRANSACTION_TYPES.SWAP,x.TRANSACTION_TYPES.SWAP_APPROVAL],B=[...L,x.TRANSACTION_TYPES.SIMPLE_SEND,x.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER,x.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM,x.TRANSACTION_TYPES.CONTRACT_INTERACTION],j="failed on-chain";class U extends s.default{constructor(t){super(),this.networkStore=t.networkStore||new i.ObservableStore({}),this._getCurrentChainId=t.getCurrentChainId,this.getProviderConfig=t.getProviderConfig,this._getCurrentNetworkEIP1559Compatibility=t.getCurrentNetworkEIP1559Compatibility,this._getCurrentAccountEIP1559Compatibility=t.getCurrentAccountEIP1559Compatibility,this.preferencesStore=t.preferencesStore||new i.ObservableStore({}),this.provider=t.provider,this.getPermittedAccounts=t.getPermittedAccounts,this.blockTracker=t.blockTracker,this.signEthTx=t.signTransaction,this.inProcessOfSigning=new Set,this._trackMetaMetricsEvent=t.trackMetaMetricsEvent,this._getParticipateInMetrics=t.getParticipateInMetrics,this._getEIP1559GasFeeEstimates=t.getEIP1559GasFeeEstimates,this.createEventFragment=t.createEventFragment,this.updateEventFragment=t.updateEventFragment,this.finalizeEventFragment=t.finalizeEventFragment,this.getEventFragmentById=t.getEventFragmentById,this.getDeviceModel=t.getDeviceModel,this.getAccountType=t.getAccountType,this.getTokenStandardAndDetails=t.getTokenStandardAndDetails,this.memStore=new i.ObservableStore({}),this.query=new c.default(this.provider),this.txGasUtil=new k.default(this.provider),this._mapMethods(),this.txStateManager=new C.default({initState:t.initState,txHistoryLimit:t.txHistoryLimit,getNetwork:this.getNetwork.bind(this),getCurrentChainId:t.getCurrentChainId}),this._onBootCleanUp(),this.store=this.txStateManager.store,this.nonceTracker=new p.default({provider:this.provider,blockTracker:this.blockTracker,getPendingTransactions:(...e)=>[...this.txStateManager.getPendingTransactions(...e),...t.getExternalPendingTransactions(...e)],getConfirmedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.pendingTxTracker=new R.default({provider:this.provider,nonceTracker:this.nonceTracker,publishTransaction:t=>this.query.sendRawTransaction(t),getPendingTransactions:()=>[...this.txStateManager.getPendingTransactions(),...this.txStateManager.getApprovedTransactions()],approveTransaction:this.approveTransaction.bind(this),getCompletedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.txStateManager.store.subscribe((()=>this.emit(_.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE))),this._setupListeners(),this._updateMemstore(),this.txStateManager.store.subscribe((()=>this._updateMemstore())),this.networkStore.subscribe((()=>{this._onBootCleanUp(),this._updateMemstore()})),this._updatePendingTxsAfterFirstBlock()}getChainId(){const t=this.networkStore.getState(),e=this._getCurrentChainId(),a=parseInt(e,16);return"loading"===t||Number.isNaN(a)?0:a}async getEIP1559Compatibility(t){const e=await this._getCurrentNetworkEIP1559Compatibility(),a=await this._getCurrentAccountEIP1559Compatibility(t);return e&&a}async getCommonConfiguration(t){const{type:e,nickname:a}=this.getProviderConfig(),r=await this.getEIP1559Compatibility(t)?N.HARDFORKS.LONDON:N.HARDFORKS.BERLIN;if(e!==N.NETWORK_TYPE_RPC)return new d.default({chain:e,hardfork:r});const n=parseInt(this._getCurrentChainId(),16),s=this.networkStore.getState(),i={name:a,chainId:n,networkId:"loading"===s?0:parseInt(s,10)};return d.default.forCustomChain(N.MAINNET,i,r)}addTransaction(t){this.txStateManager.addTransaction(t),this.emit(`${t.id}:unapproved`,t),this._trackTransactionMetricsEvent(t,x.TRANSACTION_EVENTS.ADDED)}wipeTransactions(t){this.txStateManager.wipeTransactions(t)}async newUnapprovedTransaction(t,e={}){h.default.debug(`MetaMaskController newUnapprovedTransaction ${JSON.stringify(t)}`);const a=await this.addUnapprovedTransaction(t,e.origin);return new Promise(((t,e)=>{this.txStateManager.once(`${a.id}:finished`,(a=>{switch(a.status){case x.TRANSACTION_STATUSES.SUBMITTED:return t(a.hash);case x.TRANSACTION_STATUSES.REJECTED:return e((0,m.default)(u.ethErrors.provider.userRejectedRequest("MetaMask Tx Signature: User denied transaction signature.")));case x.TRANSACTION_STATUSES.FAILED:return e((0,m.default)(u.ethErrors.rpc.internal(a.err.message)));default:return e((0,m.default)(u.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(a.txParams)}`)))}}))}))}_getTransaction(t){const{transactions:e}=this.store.getState();return e[t]}_isUnapprovedTransaction(t){return this.txStateManager.getTransaction(t).status===x.TRANSACTION_STATUSES.UNAPPROVED}_throwErrorIfNotUnapprovedTx(t,e){if(!this._isUnapprovedTransaction(t))throw new Error(`TransactionsController: Can only call ${e} on an unapproved transaction.\n         Current tx status: ${this.txStateManager.getTransaction(t).status}`)}_updateTransaction(t,e,a){const r=this.txStateManager.getTransaction(t),n=(0,T.merge)(r,e);this.txStateManager.updateTransaction(n,a)}updatePreviousGasParams(t,{maxFeePerGas:e,maxPriorityFeePerGas:a,gasLimit:r}){const n={previousGas:{maxFeePerGas:e,maxPriorityFeePerGas:a,gasLimit:r}};n.previousGas=(0,T.pickBy)(n.previousGas);const s=`Update Previous Gas for ${t}`;return this._updateTransaction(t,n,s),this._getTransaction(t)}async updateEditableParams(t,{data:e,from:a,to:r,value:n,gas:s,gasPrice:i}){this._throwErrorIfNotUnapprovedTx(t,"updateEditableParams");const o={txParams:{data:e,from:a,to:r,value:n,gas:s,gasPrice:i}};o.txParams=(0,T.pickBy)(o.txParams,(t=>t!==undefined));const c=this._getTransaction(t),{type:u}=await(0,O.determineTransactionType)(G(G({},c.txParams),o.txParams),this.query);o.type=u;const d=`Update Editable Params for ${t}`;return this._updateTransaction(t,o,d),this._getTransaction(t)}updateTransactionGasFees(t,{gas:e,gasLimit:a,gasPrice:r,maxPriorityFeePerGas:n,maxFeePerGas:s,estimateUsed:i,estimateSuggested:o,defaultGasEstimates:c,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:l}){this._throwErrorIfNotUnapprovedTx(t,"updateTransactionGasFees");let p={txParams:{gas:e,gasLimit:a,gasPrice:r,maxPriorityFeePerGas:n,maxFeePerGas:s},estimateUsed:i,estimateSuggested:o,defaultGasEstimates:c,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:l};p.txParams=(0,T.pickBy)(p.txParams),p=(0,T.pickBy)(p);const h=`Update Transaction Gas Fees for ${t}`;return this._updateTransaction(t,p,h),this._getTransaction(t)}updateTransactionEstimatedBaseFee(t,{estimatedBaseFee:e,decEstimatedBaseFee:a}){this._throwErrorIfNotUnapprovedTx(t,"updateTransactionEstimatedBaseFee");let r={estimatedBaseFee:e,decEstimatedBaseFee:a};r=(0,T.pickBy)(r);const n=`Update Transaction Estimated Base Fees for ${t}`;return this._updateTransaction(t,r,n),this._getTransaction(t)}updateSwapApprovalTransaction(t,{type:e,sourceTokenSymbol:a}){this._throwErrorIfNotUnapprovedTx(t,"updateSwapApprovalTransaction");let r={type:e,sourceTokenSymbol:a};r=(0,T.pickBy)(r);const n=`Update Swap Approval Transaction for ${t}`;return this._updateTransaction(t,r,n),this._getTransaction(t)}updateSwapTransaction(t,{sourceTokenSymbol:e,destinationTokenSymbol:a,type:r,destinationTokenDecimals:n,destinationTokenAddress:s,swapMetaData:i,swapTokenValue:o,estimatedBaseFee:c,approvalTxId:u}){this._throwErrorIfNotUnapprovedTx(t,"updateSwapTransaction");let d={sourceTokenSymbol:e,destinationTokenSymbol:a,type:r,destinationTokenDecimals:n,destinationTokenAddress:s,swapMetaData:i,swapTokenValue:o,estimatedBaseFee:c,approvalTxId:u};d=(0,T.pickBy)(d);const l=`Update Swap Transaction for ${t}`;return this._updateTransaction(t,d,l),this._getTransaction(t)}updateTransactionUserSettings(t,{userEditedGasLimit:e,userFeeLevel:a}){this._throwErrorIfNotUnapprovedTx(t,"updateTransactionUserSettings");let r={userEditedGasLimit:e,userFeeLevel:a};r=(0,T.pickBy)(r);const n=`Update User Settings for ${t}`;return this._updateTransaction(t,r,n),this._getTransaction(t)}updateTransactionSendFlowHistory(t,e){var a;this._throwErrorIfNotUnapprovedTx(t,"updateTransactionSendFlowHistory");const r=this._getTransaction(t),n=`Update sendFlowHistory for ${t}`;return this.txStateManager.updateTransaction(G(G({},r),{},{sendFlowHistory:[...null!==(a=null==r?void 0:r.sendFlowHistory)&&void 0!==a?a:[],...e]}),n),this._getTransaction(t)}async addUnapprovedTransaction(t,e,a,r=[]){if(a!==undefined&&!B.includes(a))throw new Error(`TransactionController - invalid transactionType value: ${a}`);const n=M.normalizeTxParams(t),s=await this.getEIP1559Compatibility();M.validateTxParams(n,s);let i=this.txStateManager.generateTxMeta({txParams:n,origin:e,sendFlowHistory:r});if(e===I.ORIGIN_METAMASK){if(n.from!==this.getSelectedAddress())throw u.ethErrors.rpc.internal({message:"Internally initiated transaction is using invalid account.",data:{origin:e,fromAddress:n.from,selectedAddress:this.getSelectedAddress()}})}else{if(!(await this.getPermittedAccounts(e)).includes(n.from))throw u.ethErrors.provider.unauthorized({data:{origin:e}})}const{type:o,getCodeResponse:c}=await(0,O.determineTransactionType)(t,this.query);i.type=a||o,i.txParams.value=i.txParams.value?(0,g.addHexPrefix)(i.txParams.value):"0x0",this.addTransaction(i),this.emit("newUnapprovedTx",i);try{i=await this.addTxGasDefaults(i,c)}catch(t){throw h.default.warn(t),i=this.txStateManager.getTransaction(i.id),i.loadingDefaults=!1,this.txStateManager.updateTransaction(i,"Failed to calculate gas defaults."),t}return i.loadingDefaults=!1,this.txStateManager.updateTransaction(i,"Added new unapproved transaction."),i}async addTxGasDefaults(t,e){const a=t.txParams.type!==x.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:r,maxFeePerGas:n,maxPriorityFeePerGas:s}=await this._getDefaultGasFees(t,a),{gasLimit:i,simulationFails:o}=await this._getDefaultGasLimit(t,e);if(t=this.txStateManager.getTransaction(t.id),o&&(t.simulationFails=o),a){const{eip1559V2Enabled:e}=this.preferencesStore.getState(),a=this.getAdvancedGasFee();e&&Boolean(a)&&!L.includes(t.type)?(t.userFeeLevel=y.CUSTOM_GAS_ESTIMATE,t.txParams.maxFeePerGas=(0,A.decGWEIToHexWEI)(a.maxBaseFee),t.txParams.maxPriorityFeePerGas=(0,A.decGWEIToHexWEI)(a.priorityFee)):!t.txParams.gasPrice||t.txParams.maxFeePerGas||t.txParams.maxPriorityFeePerGas?(n&&s&&!t.txParams.maxFeePerGas&&!t.txParams.maxPriorityFeePerGas||t.origin===I.ORIGIN_METAMASK?t.userFeeLevel=y.GAS_RECOMMENDATIONS.MEDIUM:t.userFeeLevel=e?y.PRIORITY_LEVELS.DAPP_SUGGESTED:y.CUSTOM_GAS_ESTIMATE,n&&!t.txParams.maxFeePerGas&&(t.txParams.maxFeePerGas=n),s&&!t.txParams.maxPriorityFeePerGas&&(t.txParams.maxPriorityFeePerGas=s),r&&!t.txParams.maxFeePerGas&&(t.txParams.maxFeePerGas=r),t.txParams.maxFeePerGas&&!t.txParams.maxPriorityFeePerGas&&(t.txParams.maxPriorityFeePerGas=t.txParams.maxFeePerGas)):(t.txParams.maxFeePerGas=t.txParams.gasPrice,t.txParams.maxPriorityFeePerGas=t.txParams.gasPrice,e&&t.origin!==I.ORIGIN_METAMASK?t.userFeeLevel=y.PRIORITY_LEVELS.DAPP_SUGGESTED:t.userFeeLevel=y.CUSTOM_GAS_ESTIMATE),delete t.txParams.gasPrice}else delete t.txParams.maxPriorityFeePerGas,delete t.txParams.maxFeePerGas;return!r||t.txParams.gasPrice||t.txParams.maxPriorityFeePerGas||t.txParams.maxFeePerGas||(t.txParams.gasPrice=r),i&&!t.txParams.gas&&(t.txParams.gas=i,t.originalGasEstimate=i),t.defaultGasEstimates={estimateType:t.userFeeLevel,gas:t.txParams.gas,gasPrice:t.txParams.gasPrice,maxFeePerGas:t.txParams.maxFeePerGas,maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas},t}async _getDefaultGasFees(t,e){if(!e&&t.txParams.gasPrice||e&&t.txParams.maxFeePerGas&&t.txParams.maxPriorityFeePerGas)return{};try{const{gasFeeEstimates:t,gasEstimateType:a}=await this._getEIP1559GasFeeEstimates();if(e&&a===y.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:e,suggestedMaxFeePerGas:a}={}}=t;if(e&&a)return{maxFeePerGas:(0,A.decGWEIToHexWEI)(a),maxPriorityFeePerGas:(0,A.decGWEIToHexWEI)(e)}}else{if(a===y.GAS_ESTIMATE_TYPES.LEGACY)return{gasPrice:(0,A.decGWEIToHexWEI)(t.medium)};if(a===y.GAS_ESTIMATE_TYPES.ETH_GASPRICE)return{gasPrice:(0,A.decGWEIToHexWEI)(t.gasPrice)}}}catch(t){console.error(t)}const a=await this.query.gasPrice();return{gasPrice:a&&(0,g.addHexPrefix)(a.toString(16))}}async _getDefaultGasLimit(t){const e=this._getCurrentChainId(),a=N.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[e],r=(0,g.getChainType)(e);if(t.txParams.gas)return{};if(t.txParams.to&&t.type===x.TRANSACTION_TYPES.SIMPLE_SEND&&"custom"!==r&&!t.txParams.data)return{gasLimit:y.GAS_LIMITS.SIMPLE};const{blockGasLimit:n,estimatedGasHex:s,simulationFails:i}=await this.txGasUtil.analyzeGasUsage(t);return{gasLimit:this.txGasUtil.addGasBuffer((0,g.addHexPrefix)(s),n,a),simulationFails:i}}generateNewGasParams(t,e={},a=11){const{txParams:r}=t,n={},s={};var i;e.gasLimit&&(s.gas=null!==(i=null==e?void 0:e.gas)&&void 0!==i?i:y.GAS_LIMITS.SIMPLE);return e.estimateSuggested&&(s.estimateSuggested=e.estimateSuggested),e.estimateUsed&&(s.estimateUsed=e.estimateUsed),(0,O.isEIP1559Transaction)(t)?(n.maxFeePerGas=r.maxFeePerGas,n.maxPriorityFeePerGas=r.maxPriorityFeePerGas,s.maxFeePerGas=(null==e?void 0:e.maxFeePerGas)||(0,g.bnToHex)((0,g.BnMultiplyByFraction)((0,g.hexToBn)(r.maxFeePerGas),a,10)),s.maxPriorityFeePerGas=(null==e?void 0:e.maxPriorityFeePerGas)||(0,g.bnToHex)((0,g.BnMultiplyByFraction)((0,g.hexToBn)(r.maxPriorityFeePerGas),a,10))):(n.gasPrice=r.gasPrice,s.gasPrice=(null==e?void 0:e.gasPrice)||(0,g.bnToHex)((0,g.BnMultiplyByFraction)((0,g.hexToBn)(r.gasPrice),a,10))),{previousGasParams:n,newGasParams:s}}async createCancelTransaction(t,e,{estimatedBaseFee:a}={}){const r=this.txStateManager.getTransaction(t),{txParams:n}=r,{from:s,nonce:i}=n,{previousGasParams:o,newGasParams:c}=this.generateNewGasParams(r,G(G({},e),{},{gasLimit:e.gasLimit||y.GAS_LIMITS.SIMPLE})),u=this.txStateManager.generateTxMeta({txParams:G({from:s,to:s,nonce:i,value:"0x0"},c),previousGasParams:o,loadingDefaults:!1,status:x.TRANSACTION_STATUSES.APPROVED,type:x.TRANSACTION_TYPES.CANCEL});return a&&(u.estimatedBaseFee=a),this.addTransaction(u),await this.approveTransaction(u.id),u}async createSpeedUpTransaction(t,e,{estimatedBaseFee:a}={}){const r=this.txStateManager.getTransaction(t),{txParams:n}=r,{previousGasParams:s,newGasParams:i}=this.generateNewGasParams(r,e),o=this.txStateManager.generateTxMeta({txParams:G(G({},n),i),previousGasParams:s,loadingDefaults:!1,status:x.TRANSACTION_STATUSES.APPROVED,type:x.TRANSACTION_TYPES.RETRY});return a&&(o.estimatedBaseFee=a),this.addTransaction(o),await this.approveTransaction(o.id),o}async updateTransaction(t){this.txStateManager.updateTransaction(t,"confTx: user updated transaction")}async updateAndApproveTransaction(t){this.txStateManager.updateTransaction(t,"confTx: user approved transaction"),await this.approveTransaction(t.id)}async approveTransaction(t){if(this.inProcessOfSigning.has(t))return;let e;this.inProcessOfSigning.add(t);try{this.txStateManager.setTxStatusApproved(t);const a=this.txStateManager.getTransaction(t),r=a.txParams.from;let{customNonceValue:n}=a;n=Number(n),e=await this.nonceTracker.getNonceLock(r);const s=a.previousGasParams?a.txParams.nonce:e.nextNonce,i=0===n?n:n||s;a.txParams.nonce=(0,g.addHexPrefix)(i.toString(16)),a.nonceDetails=e.nonceDetails,n&&(a.nonceDetails.customNonceValue=n),this.txStateManager.updateTransaction(a,"transactions#approveTransaction");const o=await this.signTransaction(t);await this.publishTransaction(t,o),this._trackTransactionMetricsEvent(a,x.TRANSACTION_EVENTS.APPROVED),e.releaseLock()}catch(a){try{this._failTransaction(t,a)}catch(t){h.default.error(t)}throw e&&e.releaseLock(),a}finally{this.inProcessOfSigning.delete(t)}}async approveTransactionsWithSameNonce(t=[]){if(0===t.length)return"";const e=t[0],a=await this.getCommonConfiguration(e.from),r=l.TransactionFactory.fromTxData(e,{common:a}),n=(0,o.bufferToHex)(r.serialize());if(this.inProcessOfSigning.has(n))return"";let s,i;this.inProcessOfSigning.add(n);try{const a=e.from;i=await this.nonceTracker.getNonceLock(a);const r=i.nextNonce;s=await Promise.all(t.map((t=>(t.nonce=(0,g.addHexPrefix)(r.toString(16)),this.signExternalTransaction(t)))))}catch(t){throw h.default.error(t),t}finally{i&&i.releaseLock(),this.inProcessOfSigning.delete(n)}return s}async signExternalTransaction(t){const e=M.normalizeTxParams(t),a=this.getChainId(),r=(0,O.isEIP1559Transaction)({txParams:e})?x.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:x.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=G(G({},e),{},{type:r,gasLimit:e.gas,chainId:(0,g.addHexPrefix)((0,S.decimalToHex)(a))}),s=n.from,i=await this.getCommonConfiguration(s),c=l.TransactionFactory.fromTxData(n,{common:i}),u=await this.signEthTx(c,s);return(0,o.bufferToHex)(u.serialize())}async signTransaction(t){const e=this.txStateManager.getTransaction(t),a=this.getChainId(),r=(0,O.isEIP1559Transaction)(e)?x.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:x.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=G(G({},e.txParams),{},{type:r,chainId:a,gasLimit:e.txParams.gas}),s=n.from,i=await this.getCommonConfiguration(n.from),c=l.TransactionFactory.fromTxData(n,{common:i}),u=await this.signEthTx(c,s);e.r=(0,o.bufferToHex)(u.r),e.s=(0,o.bufferToHex)(u.s),e.v=(0,o.bufferToHex)(u.v),this.txStateManager.updateTransaction(e,"transactions#signTransaction: add r, s, v values"),this.txStateManager.setTxStatusSigned(e.id);return(0,o.bufferToHex)(u.serialize())}async publishTransaction(t,e){const a=this.txStateManager.getTransaction(t);if(a.rawTx=e,a.type===x.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(a.txParams.from);a.preTxBalance=t.toString(16)}let r;this.txStateManager.updateTransaction(a,"transactions#publishTransaction");try{r=await this.query.sendRawTransaction(e)}catch(t){if(!t.message.toLowerCase().includes("known transaction"))throw t;r=(0,o.keccak)((0,o.toBuffer)((0,g.addHexPrefix)(e),"hex")).toString("hex"),r=(0,g.addHexPrefix)(r)}this.setTxHash(t,r),this.txStateManager.setTxStatusSubmitted(t),this._trackTransactionMetricsEvent(a,x.TRANSACTION_EVENTS.SUBMITTED)}async updatePostTxBalance({txMeta:t,txId:e,numberOfAttempts:a=6}){const r=await this.query.getBalance(t.txParams.from),n=this.txStateManager.getTransaction(e),s=n.approvalTxId?this.txStateManager.getTransaction(n.approvalTxId):null;n.postTxBalance=r.toString(16);(0,b.isSwapsDefaultTokenAddress)(t.destinationTokenAddress,t.chainId)&&t.preTxBalance===n.postTxBalance&&a>0?setTimeout((()=>{this.updatePostTxBalance({txMeta:t,txId:e,numberOfAttempts:a-1})}),5e3):(this.txStateManager.updateTransaction(n,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(n,s))}async confirmTransaction(t,e,a,r){const n=this.txStateManager.getTransaction(t);if(n)try{const s=M.normalizeTxReceiptGasUsed(e.gasUsed);n.txReceipt=G(G({},e),{},{gasUsed:s}),a&&(n.baseFeePerGas=a),r&&(n.blockTimestamp=r),this.txStateManager.setTxStatusConfirmed(t),this._markNonceDuplicatesDropped(t);const{submittedTime:i}=n,o={gas_used:s};i&&(o.completion_time=this._getTransactionCompletionTime(i)),"0x0"===e.status&&(o.status=j),this._trackTransactionMetricsEvent(n,x.TRANSACTION_EVENTS.FINALIZED,o),this.txStateManager.updateTransaction(n,"transactions#confirmTransaction - add txReceipt"),n.type===x.TRANSACTION_TYPES.SWAP&&await this.updatePostTxBalance({txMeta:n,txId:t})}catch(t){h.default.error(t)}}async confirmExternalTransaction(t,e,a){if(await this.txStateManager.addExternalTransaction(t),!t)return;const r=t.id;try{const n=M.normalizeTxReceiptGasUsed(e.gasUsed);t.txReceipt=G(G({},e),{},{gasUsed:n}),a&&(t.baseFeePerGas=a),this.txStateManager.setTxStatusConfirmed(r),this._markNonceDuplicatesDropped(r);const{submittedTime:s}=t,i={gas_used:n};s&&(i.completion_time=this._getTransactionCompletionTime(s)),"0x0"===e.status&&(i.status=j),this._trackTransactionMetricsEvent(t,x.TRANSACTION_EVENTS.FINALIZED,i),this.txStateManager.updateTransaction(t,"transactions#confirmTransaction - add txReceipt"),t.type===x.TRANSACTION_TYPES.SWAP&&await this.updatePostTxBalance({txMeta:t,txId:r})}catch(t){h.default.error(t)}}async cancelTransaction(t){const e=this.txStateManager.getTransaction(t);this.txStateManager.setTxStatusRejected(t),this._trackTransactionMetricsEvent(e,x.TRANSACTION_EVENTS.REJECTED)}setTxHash(t,e){const a=this.txStateManager.getTransaction(t);a.hash=e,this.txStateManager.updateTransaction(a,"transactions#setTxHash")}async createTransactionEventFragment(t,e){const a=this.txStateManager.getTransaction(t),{properties:r,sensitiveProperties:n}=await this._buildEventFragmentProperties(a);this._createTransactionEventFragment(a,e,r,n)}_mapMethods(){this.getState=()=>this.memStore.getState(),this.getNetwork=()=>this.networkStore.getState(),this.getSelectedAddress=()=>this.preferencesStore.getState().selectedAddress,this.getUnapprovedTxCount=()=>Object.keys(this.txStateManager.getUnapprovedTxList()).length,this.getPendingTxCount=t=>this.txStateManager.getPendingTransactions(t).length,this.getTransactions=t=>this.txStateManager.getTransactions(t),this.getAdvancedGasFee=()=>this.preferencesStore.getState().advancedGasFee}async _updatePendingTxsAfterFirstBlock(){await this.blockTracker.getLatestBlock(),await this.pendingTxTracker.updatePendingTxs()}_onBootCleanUp(){this.txStateManager.getTransactions({searchCriteria:{status:x.TRANSACTION_STATUSES.UNAPPROVED,loadingDefaults:!0}}).forEach((t=>{this.addTxGasDefaults(t).then((t=>{t.loadingDefaults=!1,this.txStateManager.updateTransaction(t,"transactions: gas estimation for tx on boot")})).catch((e=>{const a=this.txStateManager.getTransaction(t.id);a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"failed to estimate gas during boot cleanup."),this._failTransaction(a.id,e)}))})),this.txStateManager.getTransactions({searchCriteria:{status:x.TRANSACTION_STATUSES.APPROVED}}).forEach((t=>{const e=new Error('Transaction found as "approved" during boot - possibly stuck during signing');this._failTransaction(t.id,e)}))}_setupListeners(){this.txStateManager.on("tx:status-update",this.emit.bind(this,"tx:status-update")),this._setupBlockTrackerListener(),this.pendingTxTracker.on("tx:warning",(t=>{this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:warning")})),this.pendingTxTracker.on("tx:failed",((t,e)=>{this._failTransaction(t,e)})),this.pendingTxTracker.on("tx:confirmed",((t,e,a,r)=>this.confirmTransaction(t,e,a,r))),this.pendingTxTracker.on("tx:dropped",(t=>{this._dropTransaction(t)})),this.pendingTxTracker.on("tx:block-update",((t,e)=>{t.firstRetryBlockNumber||(t.firstRetryBlockNumber=e,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:block-update"))})),this.pendingTxTracker.on("tx:retry",(t=>{"retryCount"in t||(t.retryCount=0),t.retryCount+=1,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:retry")}))}_markNonceDuplicatesDropped(t){const e=this.txStateManager.getTransaction(t),{nonce:a,from:r}=e.txParams,n=this.txStateManager.getTransactions({searchCriteria:{nonce:a,from:r}});n.length&&n.forEach((a=>{a.id!==t&&(a.replacedBy=e.hash,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),a.status!==x.TRANSACTION_STATUSES.FAILED&&this._dropTransaction(a.id))}))}_setupBlockTrackerListener(){let t=!1;const e=this._onLatestBlock.bind(this),{blockTracker:a,txStateManager:r}=this;function n(){const n=r.getPendingTransactions();!t&&n.length>0?(a.on("latest",e),t=!0):t&&!n.length&&(a.removeListener("latest",e),t=!1)}r.on("tx:status-update",n),n()}async _onLatestBlock(t){try{await this.pendingTxTracker.updatePendingTxs()}catch(t){h.default.error(t)}try{await this.pendingTxTracker.resubmitPendingTxs(t)}catch(t){h.default.error(t)}}_updateMemstore(){const t=this.txStateManager.getUnapprovedTxList(),e=this.txStateManager.getTransactions({limit:100});this.memStore.updateState({unapprovedTxs:t,currentNetworkTxList:e})}_calculateTransactionsCost(t,e){let a="0x0";null!=e&&e.txReceipt&&(a=(0,E.calcGasTotal)(e.txReceipt.gasUsed,e.txReceipt.effectiveGasPrice));const r=(0,E.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice),n=new f.default(r,16).plus(a,16).toString(16);return{approvalGasCostInEth:Number((0,S.hexWEIToDecETH)(a)),tradeGasCostInEth:Number((0,S.hexWEIToDecETH)(r)),tradeAndApprovalGasCostInEth:Number((0,S.hexWEIToDecETH)(n))}}_trackSwapsMetrics(t,e){if(this._getParticipateInMetrics()&&t.swapMetaData)if("0x0"===t.txReceipt.status)this._trackMetaMetricsEvent({event:"Swap Failed",sensitiveProperties:G({},t.swapMetaData),category:w.EVENT.CATEGORIES.SWAPS});else{const a=(0,P.getSwapsTokensReceivedFromTxMeta)(t.destinationTokenSymbol,t,t.destinationTokenAddress,t.txParams.from,t.destinationTokenDecimals,e,t.chainId),r=a?`${new f.default(a,10).div(t.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,n=t.txReceipt.gasUsed&&t.swapMetaData.estimated_gas?`${new f.default(t.txReceipt.gasUsed,16).div(t.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,s=this._calculateTransactionsCost(t,e);this._trackMetaMetricsEvent({event:"Swap Completed",category:w.EVENT.CATEGORIES.SWAPS,sensitiveProperties:G(G({},t.swapMetaData),{},{token_to_amount_received:a,quote_vs_executionRatio:r,estimated_vs_used_gasRatio:n,approval_gas_cost_in_eth:s.approvalGasCostInEth,trade_gas_cost_in_eth:s.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:s.tradeAndApprovalGasCostInEth})})}}async _buildEventFragmentProperties(t,e){const{type:a,time:r,status:n,chainId:s,origin:i,txParams:{gasPrice:o,gas:c,maxFeePerGas:u,maxPriorityFeePerGas:d,estimateSuggested:l,estimateUsed:p},defaultGasEstimates:h,metamaskNetworkId:f}=t,T=i===I.ORIGIN_METAMASK?"user":"dapp",{assetType:m,tokenStandard:g}=await(0,O.determineTransactionAssetType)(t,this.query,this.getTokenStandardAndDetails),E={};if((0,O.isEIP1559Transaction)(t)?(E.max_fee_per_gas=u,E.max_priority_fee_per_gas=d):E.gas_price=o,h){const{estimateType:e}=h;if(e){E.default_estimate=e;let a=t.defaultGasEstimates.maxFeePerGas,r=t.defaultGasEstimates.maxPriorityFeePerGas;if([y.GAS_RECOMMENDATIONS.LOW,y.GAS_RECOMMENDATIONS.MEDIUM,y.GAS_RECOMMENDATIONS.MEDIUM.HIGH].includes(e)){var P,S;const{gasFeeEstimates:t}=await this._getEIP1559GasFeeEstimates();var x,_;if(null!=t&&null!==(P=t[e])&&void 0!==P&&P.suggestedMaxFeePerGas)a=null===(x=t[e])||void 0===x?void 0:x.suggestedMaxFeePerGas,E.default_max_fee_per_gas=a;if(null!=t&&null!==(S=t[e])&&void 0!==S&&S.suggestedMaxPriorityFeePerGas)r=null===(_=t[e])||void 0===_?void 0:_.suggestedMaxPriorityFeePerGas,E.default_max_priority_fee_per_gas=r}}t.defaultGasEstimates.gas&&(E.default_gas=t.defaultGasEstimates.gas),t.defaultGasEstimates.gasPrice&&(E.default_gas_price=t.defaultGasEstimates.gasPrice)}l&&(E.estimate_suggested=l),p&&(E.estimate_used=p),null!=e&&e.gas_used&&(E.gas_used=e.gas_used);const A=this._getGasValuesInGWEI(E);let b="0";if(t.txParams.maxFeePerGas){const{eip1559V2Enabled:t}=this.preferencesStore.getState();b=t?"2":"1"}return{properties:{chain_id:s,referrer:i,source:T,network:f,type:a,eip_1559_version:b,gas_edit_type:"none",gas_edit_attempted:"none",account_type:await this.getAccountType(this.getSelectedAddress()),device_model:await this.getDeviceModel(this.getSelectedAddress()),asset_type:m,token_standard:g},sensitiveProperties:G(G({status:n,transaction_envelope_type:(0,O.isEIP1559Transaction)(t)?v.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:v.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:r,gas_limit:c},e),A)}}_createTransactionEventFragment(t,e,a,r){const n=`transaction-${[x.TRANSACTION_EVENTS.FINALIZED,x.TRANSACTION_EVENTS.SUBMITTED].includes(e)?"submitted":"added"}-${t.id}`;if(void 0===this.getEventFragmentById(n))switch(e){case x.TRANSACTION_EVENTS.ADDED:this.createEventFragment({category:w.EVENT.CATEGORIES.TRANSACTIONS,initialEvent:x.TRANSACTION_EVENTS.ADDED,successEvent:x.TRANSACTION_EVENTS.APPROVED,failureEvent:x.TRANSACTION_EVENTS.REJECTED,properties:a,sensitiveProperties:r,persist:!0,uniqueIdentifier:n});break;case x.TRANSACTION_EVENTS.APPROVED:case x.TRANSACTION_EVENTS.REJECTED:this.createEventFragment({category:w.EVENT.CATEGORIES.TRANSACTIONS,successEvent:x.TRANSACTION_EVENTS.APPROVED,failureEvent:x.TRANSACTION_EVENTS.REJECTED,properties:a,sensitiveProperties:r,persist:!0,uniqueIdentifier:n});break;case x.TRANSACTION_EVENTS.SUBMITTED:this.createEventFragment({category:w.EVENT.CATEGORIES.TRANSACTIONS,initialEvent:x.TRANSACTION_EVENTS.SUBMITTED,successEvent:x.TRANSACTION_EVENTS.FINALIZED,properties:a,sensitiveProperties:r,persist:!0,uniqueIdentifier:n});break;case x.TRANSACTION_EVENTS.FINALIZED:this.createEventFragment({category:w.EVENT.CATEGORIES.TRANSACTIONS,successEvent:x.TRANSACTION_EVENTS.FINALIZED,properties:a,sensitiveProperties:r,persist:!0,uniqueIdentifier:n})}}async _trackTransactionMetricsEvent(t,e,a={}){if(!t)return;const{properties:r,sensitiveProperties:n}=await this._buildEventFragmentProperties(t,a);let s;switch(this._createTransactionEventFragment(t,e,r,n),e){case x.TRANSACTION_EVENTS.APPROVED:s=`transaction-added-${t.id}`,this.updateEventFragment(s,{properties:r,sensitiveProperties:n}),this.finalizeEventFragment(s);break;case x.TRANSACTION_EVENTS.REJECTED:s=`transaction-added-${t.id}`,this.updateEventFragment(s,{properties:r,sensitiveProperties:n}),this.finalizeEventFragment(s,{abandoned:!0});break;case x.TRANSACTION_EVENTS.FINALIZED:s=`transaction-submitted-${t.id}`,this.updateEventFragment(s,{properties:r,sensitiveProperties:n}),this.finalizeEventFragment(`transaction-submitted-${t.id}`)}}_getTransactionCompletionTime(t){return Math.round((Date.now()-t)/1e3).toString()}_getGasValuesInGWEI(t){const e={};for(const a in t)(0,o.isHexString)(t[a])?e[a]=(0,S.hexWEIToDecGWEI)(t[a]):e[a]=t[a];return e}_failTransaction(t,e){this.txStateManager.setTxStatusFailed(t,e);const a=this.txStateManager.getTransaction(t);this._trackTransactionMetricsEvent(a,x.TRANSACTION_EVENTS.FINALIZED,{error:e.message})}_dropTransaction(t){this.txStateManager.setTxStatusDropped(t);const e=this.txStateManager.getTransaction(t);this._trackTransactionMetricsEvent(e,x.TRANSACTION_EVENTS.FINALIZED)}}a.default=U}}},{package:"$root$"}],[33,{"@babel/runtime/helpers/defineProperty":196,"@babel/runtime/helpers/interopRequireDefault":202,"fast-json-patch":4338,lodash:5188},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.generateHistoryEntry=c,a.migrateFromSnapshotsToDiffs=function(t){return t.map(((e,a)=>0===a?e:c(t[a-1],e)))},a.replayHistory=function(t){return(0,i.cloneDeep)(t).reduce(((t,e)=>s.default.applyPatch(t,e).newDocument))},a.snapshotFromTxMeta=function(t){const e=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},t);return delete e.history,(0,i.cloneDeep)(e)};var n=r(t("@babel/runtime/helpers/defineProperty")),s=r(t("fast-json-patch")),i=t("lodash");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function c(t,e,a){const r=s.default.compare(t,e);return r[0]&&(a&&(r[0].note=a),r[0].timestamp=Date.now()),r}}}},{package:"$root$"}],[34,{"../../../../../shared/constants/transaction":6196,"../../../../../shared/modules/hexstring-utils":6202,"../../../../../shared/modules/transaction.utils":6210,"../../../lib/util":84,"eth-rpc-errors":2489},function(){with(this)return function(){"use strict";return function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getFinalStates=function(){return[s.TRANSACTION_STATUSES.REJECTED,s.TRANSACTION_STATUSES.CONFIRMED,s.TRANSACTION_STATUSES.FAILED,s.TRANSACTION_STATUSES.DROPPED]},a.normalizeAndValidateTxParams=function(t,e=!0){const a=u(t,e);return h(a),a},a.normalizeTxParams=u,a.normalizeTxReceiptGasUsed=function(t){return"string"==typeof t?t:t.toString(16)},a.validateConfirmedExternalTransaction=void 0,a.validateFrom=f,a.validateRecipient=T,a.validateTxParams=h;var r=t("eth-rpc-errors"),n=t("../../../lib/util"),s=t("../../../../../shared/constants/transaction"),i=t("../../../../../shared/modules/transaction.utils"),o=t("../../../../../shared/modules/hexstring-utils");const c={from:n.addHexPrefix,to:(t,e)=>e?(0,n.addHexPrefix)(t).toLowerCase():(0,n.addHexPrefix)(t),nonce:n.addHexPrefix,value:n.addHexPrefix,data:n.addHexPrefix,gas:n.addHexPrefix,gasPrice:n.addHexPrefix,maxFeePerGas:n.addHexPrefix,maxPriorityFeePerGas:n.addHexPrefix,type:n.addHexPrefix,estimateSuggested:t=>t,estimateUsed:t=>t};function u(t,e=!0){const a={};for(const r in c)t[r]&&(a[r]=c[r](t[r],e));return a}function d(t,e,a){if(void 0!==t[a])throw r.ethErrors.rpc.invalidParams(`Invalid transaction params: specified ${e} but also included ${a}, these cannot be mixed`)}function l(t,e){if("string"!=typeof t[e])throw r.ethErrors.rpc.invalidParams(`Invalid transaction params: ${e} is not a string. got: (${t[e]})`)}function p(t,e){switch(e){case"maxFeePerGas":case"maxPriorityFeePerGas":if(t.type&&t.type!==s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET)throw r.ethErrors.rpc.invalidParams(`Invalid transaction envelope type: specified type "${t.type}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET}"`);break;default:if(t.type&&t.type===s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET)throw r.ethErrors.rpc.invalidParams(`Invalid transaction envelope type: specified type "${t.type}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function h(t,e=!0){if(!t||"object"!=typeof t||Array.isArray(t))throw r.ethErrors.rpc.invalidParams("Invalid transaction params: must be an object.");if(!t.to&&!t.data)throw r.ethErrors.rpc.invalidParams('Invalid transaction params: must specify "data" for contract deployments, or "to" (and optionally "data") for all other types of transactions.');if((0,i.isEIP1559Transaction)({txParams:t})&&!e)throw r.ethErrors.rpc.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559");Object.entries(t).forEach((([e,a])=>{switch(e){case"from":f(t);break;case"to":T(t);break;case"gasPrice":p(t,"gasPrice"),d(t,"gasPrice","maxFeePerGas"),d(t,"gasPrice","maxPriorityFeePerGas"),l(t,"gasPrice");break;case"maxFeePerGas":p(t,"maxFeePerGas"),d(t,"maxFeePerGas","gasPrice"),l(t,"maxFeePerGas");break;case"maxPriorityFeePerGas":p(t,"maxPriorityFeePerGas"),d(t,"maxPriorityFeePerGas","gasPrice"),l(t,"maxPriorityFeePerGas");break;case"value":if(l(t,"value"),a.toString().includes("-"))throw r.ethErrors.rpc.invalidParams(`Invalid transaction value "${a}": not a positive number.`);if(a.toString().includes("."))throw r.ethErrors.rpc.invalidParams(`Invalid transaction value of "${a}": number must be in wei.`);if(!a.match(/^0x[a-fA-F0-9]+$/u))throw r.ethErrors.rpc.invalidParams(`Invalid transaction value of "${a}": not a valid hex string.`);break;case"chainId":if("number"!=typeof a&&"string"!=typeof a)throw r.ethErrors.rpc.invalidParams(`Invalid transaction params: ${e} is not a Number or hex string. got: (${a})`);break;default:l(t,e)}}))}function f(t){if("string"!=typeof t.from)throw r.ethErrors.rpc.invalidParams(`Invalid "from" address "${t.from}": not a string.`);if(!(0,o.isValidHexAddress)(t.from,{allowNonPrefixed:!1}))throw r.ethErrors.rpc.invalidParams('Invalid "from" address.')}function T(t){if("0x"===t.to||null===t.to){if(!t.data)throw r.ethErrors.rpc.invalidParams('Invalid "to" address.');delete t.to}else if(t.to!==undefined&&!(0,o.isValidHexAddress)(t.to,{allowNonPrefixed:!1}))throw r.ethErrors.rpc.invalidParams('Invalid "to" address.');return t}a.validateConfirmedExternalTransaction=({txMeta:t,pendingTransactions:e,confirmedTransactions:a}={})=>{if(!t||!t.txParams)throw r.ethErrors.rpc.invalidParams('"txMeta" or "txMeta.txParams" is missing');if(t.status!==s.TRANSACTION_STATUSES.CONFIRMED)throw r.ethErrors.rpc.invalidParams('External transaction status should be "confirmed"');const n=t.txParams.nonce;if(e&&e.length>0){if(e.find((t=>{var e;return(null===(e=t.txParams)||void 0===e?void 0:e.nonce)===n})))throw r.ethErrors.rpc.invalidParams("External transaction nonce should not be in pending txs")}if(a&&a.length>0){if(a.find((t=>{var e;return(null===(e=t.txParams)||void 0===e?void 0:e.nonce)===n})))throw r.ethErrors.rpc.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"$root$"}],[35,{"../../../../shared/constants/transaction":6196,"./tx-state-manager":37,"@babel/runtime/helpers/defineProperty":196,"@babel/runtime/helpers/interopRequireDefault":202,"ethjs-query":2613,loglevel:5198,"safe-event-emitter":5749},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("@babel/runtime/helpers/defineProperty")),s=r(t("safe-event-emitter")),i=r(t("loglevel")),o=r(t("ethjs-query")),c=t("../../../../shared/constants/transaction"),u=t("./tx-state-manager");class d extends s.default{constructor(t){super(),(0,n.default)(this,"DROPPED_BUFFER_COUNT",3),(0,n.default)(this,"droppedBlocksBufferByHash",new Map),this.query=t.query||new o.default(t.provider),this.nonceTracker=t.nonceTracker,this.getPendingTransactions=t.getPendingTransactions,this.getCompletedTransactions=t.getCompletedTransactions,this.publishTransaction=t.publishTransaction,this.approveTransaction=t.approveTransaction,this.confirmTransaction=t.confirmTransaction}async updatePendingTxs(){const t=await this.nonceTracker.getGlobalLock();try{const t=this.getPendingTransactions();await Promise.all(t.map((t=>this._checkPendingTx(t))))}catch(t){i.default.error("PendingTransactionTracker - Error updating pending transactions"),i.default.error(t)}t.releaseLock()}async resubmitPendingTxs(t){const e=this.getPendingTransactions();if(e.length)for(const n of e)try{await this._resubmitTx(n,t)}catch(t){var a,r;const e=(null===(a=t.value)||void 0===a||null===(r=a.message)||void 0===r?void 0:r.toLowerCase())||t.message.toLowerCase();if(e.includes("replacement transaction underpriced")||e.includes("known transaction")||e.includes("gas price too low to replace")||e.includes("transaction with the same hash was already imported")||e.includes("gateway timeout")||e.includes("nonce too low"))return;n.warning={error:e,message:u.ERROR_SUBMITTING},this.emit("tx:warning",n,t)}}async _resubmitTx(t,e){t.firstRetryBlockNumber||this.emit("tx:block-update",t,e);const a=t.firstRetryBlockNumber||e,r=Number.parseInt(e,16)-Number.parseInt(a,16),n=t.retryCount||0;if(r<Math.min(50,Math.pow(2,n)))return undefined;if(!("rawTx"in t))return this.approveTransaction(t.id);const{rawTx:s}=t,i=await this.publishTransaction(s);return this.emit("tx:retry",t),i}async _checkPendingTx(t){const e=t.hash,a=t.id;if(t.status===c.TRANSACTION_STATUSES.SUBMITTED){if(!e){const t=new Error("We had an error while submitting this transaction, please try again.");return t.name="NoTxHashError",void this.emit("tx:failed",a,t)}if(await this._checkIfNonceIsTaken(t))this.emit("tx:dropped",a);else{try{const t=await this.query.getTransactionReceipt(e);if(null!=t&&t.blockNumber){const{baseFeePerGas:e,timestamp:r}=await this.query.getBlockByHash(null==t?void 0:t.blockHash,!1);return void this.emit("tx:confirmed",a,t,e,r)}}catch(e){return t.warning={error:e.message,message:"There was a problem loading this transaction."},void this.emit("tx:warning",t,e)}await this._checkIfTxWasDropped(t)&&this.emit("tx:dropped",a)}}}async _checkIfTxWasDropped(t){const{hash:e,txParams:{nonce:a,from:r}}=t,n=await this.query.getTransactionCount(r);if(parseInt(a,16)>=n.toNumber())return!1;this.droppedBlocksBufferByHash.has(e)||this.droppedBlocksBufferByHash.set(e,0);const s=this.droppedBlocksBufferByHash.get(e);return s<this.DROPPED_BUFFER_COUNT?(this.droppedBlocksBufferByHash.set(e,s+1),!1):(this.droppedBlocksBufferByHash.delete(e),!0)}async _checkIfNonceIsTaken(t){const e=t.txParams.from;return this.getCompletedTransactions(e).some((e=>!(e.id===t.id)&&e.txParams.nonce===t.txParams.nonce))}}a.default=d}}},{package:"$root$"}],[36,{"../../lib/util":84,"@babel/runtime/helpers/interopRequireDefault":202,"ethereumjs-util":2564,"ethjs-query":2613,lodash:5188,loglevel:5198},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("ethjs-query")),s=r(t("loglevel")),i=t("ethereumjs-util"),o=t("lodash"),c=t("../../lib/util");a.default=class{constructor(t){this.query=new n.default(t)}async analyzeGasUsage(t){const e=await this.query.getBlockByNumber("latest",!1),a=(0,c.hexToBn)(e.gasLimit),r=(0,c.BnMultiplyByFraction)(a,19,20);let n,i=(0,c.bnToHex)(r);try{i=await this.estimateTxGas(t)}catch(t){s.default.warn(t),n={reason:t.message,errorKey:t.errorKey,debug:{blockNumber:e.number,blockGasLimit:e.gasLimit}}}return{blockGasLimit:e.gasLimit,estimatedGasHex:i,simulationFails:n}}async estimateTxGas(t){const e=(0,o.cloneDeep)(t.txParams);return delete e.gasPrice,delete e.maxFeePerGas,delete e.maxPriorityFeePerGas,await this.query.estimateGas(e)}addGasBuffer(t,e,a=1.5){const r=(0,c.hexToBn)(t),n=(0,c.hexToBn)(e).muln(.9),s=r.muln(a);return r.gt(n)?(0,c.bnToHex)(r):s.lt(n)?(0,c.bnToHex)(s):(0,c.bnToHex)(n)}async getBufferedGasLimit(t,e){const{blockGasLimit:a,estimatedGasHex:r,simulationFails:n}=await this.analyzeGasUsage(t);return{gasLimit:this.addGasBuffer((0,i.addHexPrefix)(r),a,e),simulationFails:n}}}}}},{package:"$root$"}],[37,{"../../../../shared/constants/app":6186,"../../../../shared/constants/transaction":6196,"../../../../shared/modules/random-id":6206,"../../../../shared/modules/transaction.utils":6210,"../../metamask-controller":85,"./lib/tx-state-history-helpers":33,"./lib/util":34,"@babel/runtime/helpers/defineProperty":196,"@babel/runtime/helpers/interopRequireDefault":202,"@metamask/obs-store":1206,lodash:5188,loglevel:5198,"safe-event-emitter":5749},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=a.ERROR_SUBMITTING=void 0;var n=r(t("@babel/runtime/helpers/defineProperty")),s=r(t("safe-event-emitter")),i=t("@metamask/obs-store"),o=r(t("loglevel")),c=t("lodash"),u=r(t("../../../../shared/modules/random-id")),d=t("../../../../shared/constants/transaction"),l=t("../../metamask-controller"),p=t("../../../../shared/modules/transaction.utils"),h=t("../../../../shared/constants/app"),f=t("./lib/tx-state-history-helpers"),T=t("./lib/util");function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function g(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}const E="There was an error when resubmitting this transaction.";a.ERROR_SUBMITTING=E;class P extends s.default{constructor({initState:t,txHistoryLimit:e,getNetwork:a,getCurrentChainId:r}){super(),this.store=new i.ObservableStore(g({transactions:{}},t)),this.txHistoryLimit=e,this.getNetwork=a,this.getCurrentChainId=r}generateTxMeta(t={}){var e;const a=this.getNetwork(),r=this.getCurrentChainId();if("loading"===a)throw new Error("MetaMask is having trouble connecting to the network");let n=null;return t.txParams&&"string"==typeof t.origin&&t.origin!==h.ORIGIN_METAMASK&&(void 0!==t.txParams.gasPrice?n={gasPrice:t.txParams.gasPrice}:void 0===t.txParams.maxFeePerGas&&void 0===t.txParams.maxPriorityFeePerGas||(n={maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas,maxFeePerGas:t.txParams.maxFeePerGas}),void 0!==t.txParams.gas&&(n=g(g({},n),{},{gas:t.txParams.gas}))),g({id:(0,u.default)(),time:(new Date).getTime(),status:d.TRANSACTION_STATUSES.UNAPPROVED,metamaskNetworkId:a,originalGasEstimate:null===(e=t.txParams)||void 0===e?void 0:e.gas,userEditedGasLimit:!1,chainId:r,loadingDefaults:!0,dappSuggestedGasFees:n,sendFlowHistory:[]},t)}getUnapprovedTxList(){const t=this.getCurrentChainId(),e=this.getNetwork();return(0,c.pickBy)(this.store.getState().transactions,(a=>a.status===d.TRANSACTION_STATUSES.UNAPPROVED&&(0,p.transactionMatchesNetwork)(a,t,e)))}getApprovedTransactions(t){const e={status:d.TRANSACTION_STATUSES.APPROVED};return t&&(e.from=t),this.getTransactions({searchCriteria:e})}getPendingTransactions(t){const e={status:d.TRANSACTION_STATUSES.SUBMITTED};return t&&(e.from=t),this.getTransactions({searchCriteria:e})}getConfirmedTransactions(t){const e={status:d.TRANSACTION_STATUSES.CONFIRMED};return t&&(e.from=t),this.getTransactions({searchCriteria:e})}addTransaction(t){t.txParams&&(t.txParams=(0,T.normalizeAndValidateTxParams)(t.txParams,!1)),this.once(`${t.id}:signed`,(()=>{this.removeAllListeners(`${t.id}:rejected`)})),this.once(`${t.id}:rejected`,(()=>{this.removeAllListeners(`${t.id}:signed`)})),t.history=[];const e=(0,f.snapshotFromTxMeta)(t);t.history.push(e);const a=this.getTransactions({filterToCurrentNetwork:!1}),{txHistoryLimit:r}=this,n=new Set,s=a.reverse().filter((t=>{const{nonce:e,from:a}=t.txParams,{chainId:s,metamaskNetworkId:i,status:o}=t,c=`${e}-${null!=s?s:i}-${a}`;return!n.has(c)&&(!(n.size<r-1||!1===(0,T.getFinalStates)().includes(o))||(n.add(c),!1))})).map((t=>t.id));return this._deleteTransactions(s),this._addTransactionsToState([t]),t}addExternalTransaction(t){var e;const a=null==t||null===(e=t.txParams)||void 0===e?void 0:e.from,r=this.getConfirmedTransactions(a),n=this.getPendingTransactions(a);return(0,T.validateConfirmedExternalTransaction)({txMeta:t,pendingTransactions:n,confirmedTransactions:r}),this._addTransactionsToState([t]),t}getTransaction(t){const{transactions:e}=this.store.getState();return e[t]}updateTransaction(t,e){if(t.txParams)try{t.txParams=(0,T.normalizeAndValidateTxParams)(t.txParams,!1)}catch(e){if(t.warning.message!==E)throw e;return void this.setTxStatusFailed(t.id,e)}this._updateTransactionHistory(t,e)}_updateTransactionHistory(t,e){const a=(0,f.snapshotFromTxMeta)(t),r=(0,f.replayHistory)(t.history),n=(0,f.generateHistoryEntry)(r,a,e);n.length&&t.history.push(n);const s=t.id;this.store.updateState({transactions:g(g({},this.store.getState().transactions),{},{[s]:t})})}getTransactions({searchCriteria:t={},initialList:e,filterToCurrentNetwork:a=!0,limit:r}={}){const n=this.getCurrentChainId(),s=this.getNetwork(),i=(0,c.mapValues)(t,(t=>"function"==typeof t?t:e=>e===t)),o=e?(0,c.keyBy)(e,"id"):this.store.getState().transactions,u=(0,c.sortBy)((0,c.pickBy)(o,(t=>{if(a&&!1===(0,p.transactionMatchesNetwork)(t,n,s))return!1;for(const[e,a]of Object.entries(i))if(e in t.txParams){if(!1===a(t.txParams[e]))return!1}else if(!1===a(t[e]))return!1;return!0})),"time");if(r!==undefined){const t=new Set,e=[];for(let a=u.length-1;a>-1;a--){const n=u[a],{nonce:s}=n.txParams;if(!t.has(s)){if(!(t.size<r))continue;t.add(s)}e.unshift(n)}return e}return u}setTxStatusRejected(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.REJECTED),this._deleteTransaction(t)}setTxStatusUnapproved(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.UNAPPROVED)}setTxStatusApproved(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.APPROVED)}setTxStatusSigned(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.SIGNED)}setTxStatusSubmitted(t){const e=this.getTransaction(t);e.submittedTime=(new Date).getTime(),this.updateTransaction(e,"txStateManager - add submitted time stamp"),this._setTransactionStatus(t,d.TRANSACTION_STATUSES.SUBMITTED)}setTxStatusConfirmed(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.CONFIRMED)}setTxStatusDropped(t){this._setTransactionStatus(t,d.TRANSACTION_STATUSES.DROPPED)}setTxStatusFailed(t,e){var a;const r=e||new Error("Internal metamask failure"),n=this.getTransaction(t);n.err={message:(null===(a=r.message)||void 0===a?void 0:a.toString())||r.toString(),rpc:r.value,stack:r.stack},this._updateTransactionHistory(n,"transactions:tx-state-manager#fail - add error"),this._setTransactionStatus(t,d.TRANSACTION_STATUSES.FAILED)}wipeTransactions(t){const{transactions:e}=this.store.getState(),a=this.getNetwork(),r=this.getCurrentChainId();this.store.updateState({transactions:(0,c.omitBy)(e,(e=>e.txParams.from===t&&(0,p.transactionMatchesNetwork)(e,r,a)))})}clearUnapprovedTxs(){this.store.updateState({transactions:(0,c.omitBy)(this.store.getState().transactions,(t=>t.status===d.TRANSACTION_STATUSES.UNAPPROVED))})}_setTransactionStatus(t,e){const a=this.getTransaction(t);if(a){a.status=e;try{this._updateTransactionHistory(a,`txStateManager: setting status to ${e}`),this.emit(`${a.id}:${e}`,t),this.emit("tx:status-update",t,e),[d.TRANSACTION_STATUSES.SUBMITTED,d.TRANSACTION_STATUSES.REJECTED,d.TRANSACTION_STATUSES.FAILED].includes(e)&&this.emit(`${a.id}:finished`,a),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}catch(t){o.default.error(t)}}}_addTransactionsToState(t){this.store.updateState({transactions:t.reduce(((t,e)=>(t[e.id]=e,t)),this.store.getState().transactions)})}_deleteTransaction(t){const{transactions:e}=this.store.getState();delete e[t],this.store.updateState({transactions:e})}_deleteTransactions(t){const{transactions:e}=this.store.getState();t.forEach((t=>{delete e[t]})),this.store.updateState({transactions:e})}}a.default=P}}},{package:"$root$"}],[38,{"../../shared/constants/app":6186,"./lib/util":84,"@babel/runtime/helpers/interopRequireDefault":202,"webextension-polyfill":6161},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.onMessageReceived=a.checkForMultipleVersionsRunning=void 0;var n=r(t("webextension-polyfill")),s=t("../../shared/constants/app"),i=t("./lib/util");const o="isRunning";a.onMessageReceived=t=>{t===o&&console.warn("Warning! You have multiple instances of MetaMask running!")};a.checkForMultipleVersionsRunning=async()=>{if((0,i.getPlatform)()!==s.PLATFORM_CHROME&&(0,i.getPlatform)()!==s.PLATFORM_FIREFOX)return;const t=(0,i.getPlatform)()===s.PLATFORM_CHROME?s.CHROME_BUILD_IDS:s.FIREFOX_BUILD_IDS,e=n.default.runtime.id;for(const a of t)if(a!==e)try{await n.default.runtime.sendMessage(a,o)}catch(t){}}}}},{package:"$root$"}],[39,{},function(){with(this)return function(){"use strict";return function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var r={config:{},PreferencesController:{frequentRpcListDetail:[{rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}]}};a.default=r}}},{package:"$root$"}],[4,{},function(){with(this)return function(){"use strict";return function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN=a.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY=a.SINGLE_CALL_BALANCES_ADDRESS_KOVAN=a.SINGLE_CALL_BALANCES_ADDRESS=void 0;a.SINGLE_CALL_BALANCES_ADDRESS="0xb1f8e55c7f64d203c1400b9d8555d050f94adf39";a.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY="0x9f510b19f1ad66f0dcf6e45559fab0d6752c1db7";a.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN="0xb8e671734ce5c8d7dfbbea5574fa4cf39f7a54a4";a.SINGLE_CALL_BALANCES_ADDRESS_KOVAN="0xb1d3fbb2f83aecd196f474c16ca5d9cffa0d0ffc"}}},{package:"$root$"}],[40,{"@babel/runtime/helpers/defineProperty":196,"@babel/runtime/helpers/interopRequireDefault":202,"@metamask/controllers":1063,"@metamask/obs-store":1206},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("@babel/runtime/helpers/defineProperty")),s=t("@metamask/obs-store"),i=t("@metamask/controllers");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}class u extends s.ObservableStore{constructor({config:t,controllerMessenger:e,state:a,persist:r}){super(a),(0,n.default)(this,"config",{}),this.persist=r,this.controllerMessenger=e,t&&this.updateStructure(t)}updateStructure(t){this.config=t,this.removeAllListeners();for(const e of Object.keys(t)){if(!t[e])throw new Error(`Undefined '${e}'`);const a=t[e];a.subscribe?t[e].subscribe((t=>{this.updateState({[e]:t})})):this.controllerMessenger.subscribe(`${a.name}:stateChange`,(a=>{let r=a;this.persist&&(r=(0,i.getPersistentState)(a,t[e].metadata)),this.updateState({[e]:r})}))}}getFlatState(){if(!this.config)return{};let t={};for(const e of Object.keys(this.config)){const a=this.config[e],r=a.getState?a.getState():a.state;t=c(c({},t),r)}return t}}a.default=u}}},{package:"$root$"}],[41,{"../../../shared/constants/network":6191,"../constants/contracts":4,"./util":84,"@babel/runtime/helpers/interopRequireDefault":202,"@metamask/obs-store":1206,"eth-query":2485,loglevel:5198,pify:5424,"single-call-balance-checker-abi":5855,web3:6109},function(){with(this)return function(){"use strict";return function(t,e,a){var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(t("eth-query")),s=t("@metamask/obs-store"),i=r(t("loglevel")),o=r(t("pify")),c=r(t("web3")),u=r(t("single-call-balance-checker-abi")),d=t("../../../shared/constants/network"),l=t("../constants/contracts"),p=t("./util");a.default=class{constructor(t={}){this.store=new s.ObservableStore({accounts:{},currentBlockGasLimit:""}),this._provider=t.provider,this._query=(0,o.default)(new n.default(this._provider)),this._blockTracker=t.blockTracker,this._currentBlockNumber=this._blockTracker.getCurrentBlock(),this._blockTracker.once("latest",(t=>{this._currentBlockNumber=t})),this._updateForBlock=this._updateForBlock.bind(this),this.getCurrentChainId=t.getCurrentChainId,this.web3=new c.default(this._provider)}start(){this._blockTracker.removeListener("latest",this._updateForBlock),this._blockTracker.addListener("latest",this._updateForBlock),this._updateAccounts()}stop(){this._blockTracker.removeListener("latest",this._updateForBlock)}syncWithAddresses(t){const{accounts:e}=this.store.getState(),a=Object.keys(e),r=[];t.forEach((t=>{a.includes(t)||r.push(t)}));const n=[];a.forEach((e=>{t.includes(e)||n.push(e)})),this.addAccounts(r),this.removeAccount(n)}addAccounts(t){const{accounts:e}=this.store.getState();t.forEach((t=>{e[t]={}})),this.store.updateState({accounts:e}),this._currentBlockNumber&&this._updateAccounts()}removeAccount(t){const{accounts:e}=this.store.getState();t.forEach((t=>{delete e[t]})),this.store.updateState({accounts:e})}clearAccounts(){this.store.updateState({accounts:{}})}async _updateForBlock(t){this._currentBlockNumber=t;const e=await this._query.getBlockByNumber(t,!1);if(!e)return;const a=e.gasLimit;this.store.updateState({currentBlockGasLimit:a});try{await this._updateAccounts()}catch(t){i.default.error(t)}}async _updateAccounts(){const{accounts:t}=this.store.getState(),e=Object.keys(t);switch(this.getCurrentChainId()){case d.MAINNET_CHAIN_ID:await this._updateAccountsViaBalanceChecker(e,l.SINGLE_CALL_BALANCES_ADDRESS);break;case d.RINKEBY_CHAIN_ID:await this._updateAccountsViaBalanceChecker(e,l.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY);break;case d.ROPSTEN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(e,l.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN);break;case d.KOVAN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(e,l.SINGLE_CALL_BALANCES_ADDRESS_KOVAN);break;default:await Promise.all(e.map(this._updateAccount.bind(this)))}}async _updateAccount(t){const e={address:t,balance:await this._query.getBalance(t)},{accounts:a}=this.store.getState();a[t]&&(a[t]=e,this.store.updateState({accounts:a}))}async _updateAccountsViaBalanceChecker(t,e){const{accounts:a}=this.store.getState();this.web3.setProvider(this._provider);this.web3.eth.contract(u.default).at(e).balances(t,["0x0"],((e,r)=>{if(e)return i.default.warn("MetaMask - Account Tracker single call balance fetch failed",e),void Promise.all(t.map(this._updateAccount.bind(this)));t.forEach(((t,e)=>{const n=r[e]?(0,p.bnToHex)(r[e]):"0x0";a[t]={address:t,balance:n}})),this.store.updateState({accounts:a})}))}}}}},{package:"$root$"}],[43,{},function(){with(this)return function(){"use strict";return function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){let{name:e}=t;e=e===undefined?"Error":String(e);let a=t.message;a=a===undefined?"":String(a),""===e?t.stack=t.message:""===a?t.stack=t.name:t.stack||(t.stack=`${t.name}: ${t.message}`);return t}}}},{package:"$root$"}],[4337,{"./helpers":4339,"fast-deep-equal":4340},function(){with(this)return function(){"use strict";return function(t,e,a){Object.defineProperty(a,"__esModule",{value:!0});var r=t("fast-deep-equal"),n=t("./helpers");a.JsonPatchError=n.PatchError,a.deepClone=n._deepClone;var s={add:function(t,e,a){return t[e]=this.value,{newDocument:a}},remove:function(t,e,a){var r=t[e];return delete t[e],{newDocument:a,removed:r}},replace:function(t,e,a){var r=t[e];return t[e]=this.value,{newDocument:a,removed:r}},move:function(t,e,a){var r=o(a,this.path);r&&(r=n._deepClone(r));var s=c(a,{op:"remove",path:this.from}).removed;return c(a,{op:"add",path:this.path,value:s}),{newDocument:a,removed:r}},copy:function(t,e,a){var r=o(a,this.from);return c(a,{op:"add",path:this.path,value:n._deepClone(r)}),{newDocument:a}},test:function(t,e,a){return{newDocument:a,test:r(t[e],this.value)}},_get:function(t,e,a){return this.value=t[e],{newDocument:a}}},i={add:function(t,e,a){return n.isInteger(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:a,index:e}},remove:function(t,e,a){return{newDocument:a,removed:t.splice(e,1)[0]}},replace:function(t,e,a){var r=t[e];return t[e]=this.value,{newDocument:a,removed:r}},move:s.move,copy:s.copy,test:s.test,_get:s._get};function o(t,e){if(""==e)return t;var a={op:"_get",path:e};return c(t,a),a.value}function c(t,e,c,u,d,p){if(void 0===c&&(c=!1),void 0===u&&(u=!0),void 0===d&&(d=!0),void 0===p&&(p=0),c&&("function"==typeof c?c(e,0,t,e.path):l(e,0)),""===e.path){var h={newDocument:t};if("add"===e.op)return h.newDocument=e.value,h;if("replace"===e.op)return h.newDocument=e.value,h.removed=t,h;if("move"===e.op||"copy"===e.op)return h.newDocument=o(t,e.from),"move"===e.op&&(h.removed=t),h;if("test"===e.op){if(h.test=r(t,e.value),!1===h.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,e,t);return h.newDocument=t,h}if("remove"===e.op)return h.removed=t,h.newDocument=null,h;if("_get"===e.op)return e.value=t,h;if(c)throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",p,e,t);return h}u||(t=n._deepClone(t));var f=(e.path||"").split("/"),T=t,m=1,g=f.length,E=undefined,P=void 0,S=void 0;for(S="function"==typeof c?c:l;;){if(P=f[m],d&&"__proto__"==P)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(c&&E===undefined&&(T[P]===undefined?E=f.slice(0,m).join("/"):m==g-1&&(E=e.path),E!==undefined&&S(e,0,t,E)),m++,Array.isArray(T)){if("-"===P)P=T.length;else{if(c&&!n.isInteger(P))throw new a.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",p,e,t);n.isInteger(P)&&(P=~~P)}if(m>=g){if(c&&"add"===e.op&&P>T.length)throw new a.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",p,e,t);if(!1===(h=i[e.op].call(e,T,P,t)).test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,e,t);return h}}else if(P&&-1!=P.indexOf("~")&&(P=n.unescapePathComponent(P)),m>=g){if(!1===(h=s[e.op].call(e,T,P,t)).test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,e,t);return h}T=T[P]}}function u(t,e,r,s,i){if(void 0===s&&(s=!0),void 0===i&&(i=!0),r&&!Array.isArray(e))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(t=n._deepClone(t));for(var o=new Array(e.length),u=0,d=e.length;u<d;u++)o[u]=c(t,e[u],r,!0,i,u),t=o[u].newDocument;return o.newDocument=t,o}function d(t,e,r){var n=c(t,e);if(!1===n.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function l(t,e,r,i){if("object"!=typeof t||null===t||Array.isArray(t))throw new a.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(!s[t.op])throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r);if("string"!=typeof t.path)throw new a.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new a.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new a.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&t.value===undefined)throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&n.hasUndefined(t.value))throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r)if("add"==t.op){var o=t.path.split("/").length,c=i.split("/").length;if(o!==c+1&&o!==c)throw new a.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==i)throw new a.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if("move"===t.op||"copy"===t.op){var u=p([{op:"_get",path:t.from,value:undefined}],r);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new a.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}function p(t,e,r){try{if(!Array.isArray(t))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)u(n._deepClone(e),n._deepClone(t),r||!0);else{r=r||l;for(var s=0;s<t.length;s++)r(t[s],s,e,undefined)}}catch(t){if(t instanceof a.JsonPatchError)return t;throw t}}a.getValueByPointer=o,a.applyOperation=c,a.applyPatch=u,a.applyReducer=d,a.validator=l,a.validate=p,a.default={JsonPatchError:a.JsonPatchError,deepClone:a.deepClone,getValueByPointer:o,applyOperation:c,applyPatch:u,applyReducer:d,validator:l,validate:p}}}},{package:"fast-json-patch"}],[4338,{"./core":4337,"./helpers":4339},function(){with(this)return function(){"use strict";return function(t,e,a){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},r.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n=t("./helpers"),s=t("./core"),i=t("./core");a.applyOperation=i.applyOperation,a.applyPatch=i.applyPatch,a.applyReducer=i.applyReducer,a.getValueByPointer=i.getValueByPointer,a.validate=i.validate,a.validator=i.validator;var o=t("./helpers");a.JsonPatchError=o.PatchError,a.deepClone=o._deepClone,a.escapePathComponent=o.escapePathComponent,a.unescapePathComponent=o.unescapePathComponent;var c=new WeakMap,u=function(t){this.observers=new Map,this.obj=t},d=function(t,e){this.callback=t,this.observer=e};function l(t,e){e.unobserve()}function p(t,e){var a,r=function(t){return c.get(t)}(t);if(r){var s=function(t,e){return t.observers.get(e)}(r,e);a=s&&s.observer}else r=new u(t),c.set(t,r);if(a)return a;if(a={},r.value=n._deepClone(t),e){a.callback=e,a.next=null;var i=function(){h(a)},o=function(){clearTimeout(a.next),a.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return a.patches=[],a.object=t,a.unobserve=function(){h(a),clearTimeout(a.next),function(t,e){t.observers.delete(e.callback)}(r,a),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(e,new d(e,a)),a}function h(t,e){void 0===e&&(e=!1);var a=c.get(t.object);f(a.value,t.object,t.patches,"",e),t.patches.length&&s.applyPatch(a.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function f(t,e,a,r,s){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var i=n._objectKeys(e),o=n._objectKeys(t),c=!1,u=o.length-1;u>=0;u--){var d=t[p=o[u]];if(!n.hasOwnProperty(e,p)||e[p]===undefined&&d!==undefined&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(s&&a.push({op:"test",path:r+"/"+n.escapePathComponent(p),value:n._deepClone(d)}),a.push({op:"remove",path:r+"/"+n.escapePathComponent(p)}),c=!0):(s&&a.push({op:"test",path:r,value:t}),a.push({op:"replace",path:r,value:e}),!0);else{var l=e[p];"object"==typeof d&&null!=d&&"object"==typeof l&&null!=l?f(d,l,a,r+"/"+n.escapePathComponent(p),s):d!==l&&(!0,s&&a.push({op:"test",path:r+"/"+n.escapePathComponent(p),value:n._deepClone(d)}),a.push({op:"replace",path:r+"/"+n.escapePathComponent(p),value:n._deepClone(l)}))}}if(c||i.length!=o.length)for(u=0;u<i.length;u++){var p=i[u];n.hasOwnProperty(t,p)||e[p]===undefined||a.push({op:"add",path:r+"/"+n.escapePathComponent(p),value:n._deepClone(e[p])})}}}function T(t,e,a){void 0===a&&(a=!1);var r=[];return f(t,e,r,"",a),r}a.unobserve=l,a.observe=p,a.generate=h,a.compare=T;var m=t("./core"),g=t("./helpers");a.default=r({},m,{unobserve:l,observe:p,generate:h,compare:T,JsonPatchError:g.PatchError,deepClone:n._deepClone,escapePathComponent:n.escapePathComponent,unescapePathComponent:g.unescapePathComponent})}}},{package:"fast-json-patch"}],[4339,{},function(){with(this)return function(){"use strict";return function(t,e,a){
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var r,n=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},r(t,e)},function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)});Object.defineProperty(a,"__esModule",{value:!0});var s=Object.prototype.hasOwnProperty;function i(t,e){return s.call(t,e)}function o(t){if(Array.isArray(t)){for(var e=new Array(t.length),a=0;a<e.length;a++)e[a]=""+a;return e}if(Object.keys)return Object.keys(t);e=[];for(var r in t)i(t,r)&&e.push(r);return e}function c(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function u(t,e){var a;for(var r in t)if(i(t,r)){if(t[r]===e)return c(r)+"/";if("object"==typeof t[r]&&""!=(a=u(t[r],e)))return c(r)+"/"+a}return""}function d(t,e){var a=[t];for(var r in e){var n="object"==typeof e[r]?JSON.stringify(e[r],null,2):e[r];void 0!==n&&a.push(r+": "+n)}return a.join("\n")}Object.defineProperty(a,"hasOwnProperty",{value:i}),a._objectKeys=o,a._deepClone=function(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}},a.isInteger=function(t){for(var e,a=0,r=t.length;a<r;){if(!((e=t.charCodeAt(a))>=48&&e<=57))return!1;a++}return!0},a.escapePathComponent=c,a.unescapePathComponent=function(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")},a._getPathRecursive=u,a.getPath=function(t,e){if(t===e)return"/";var a=u(t,e);if(""===a)throw new Error("Object not found in root");return"/"+a},a.hasUndefined=function t(e){if(e===undefined)return!0;if(e)if(Array.isArray(e)){for(var a=0,r=e.length;a<r;a++)if(t(e[a]))return!0}else if("object"==typeof e){var n=o(e),s=n.length;for(a=0;a<s;a++)if(t(e[n[a]]))return!0}return!1};var l=function(t){function e(e,a,r,n,s){var i=this.constructor,o=t.call(this,d(e,{name:a,index:r,operation:n,tree:s}))||this;return o.name=a,o.index=r,o.operation=n,o.tree=s,Object.setPrototypeOf(o,i.prototype),o.message=d(e,{name:a,index:r,operation:n,tree:s}),o}return n(e,t),e}(Error);a.PatchError=l}}},{package:"fast-json-patch"}],[4340,{},function(){with(this)return function(){"use strict";return function(t,e,a){var r=Array.isArray,n=Object.keys,s=Object.prototype.hasOwnProperty;e.exports=function t(e,a){if(e===a)return!0;if(e&&a&&"object"==typeof e&&"object"==typeof a){var i,o,c,u=r(e),d=r(a);if(u&&d){if((o=e.length)!=a.length)return!1;for(i=o;0!=i--;)if(!t(e[i],a[i]))return!1;return!0}if(u!=d)return!1;var l=e instanceof Date,p=a instanceof Date;if(l!=p)return!1;if(l&&p)return e.getTime()==a.getTime();var h=e instanceof RegExp,f=a instanceof RegExp;if(h!=f)return!1;if(h&&f)return e.toString()==a.toString();var T=n(e);if((o=T.length)!==n(a).length)return!1;for(i=o;0!=i--;)if(!s.call(a,T[i]))return!1;for(i=o;0!=i--;)if(!t(e[c=T[i]],a[c]))return!1;return!0}return e!=e&&a!=a}}}},{package:"fast-json-patch>fast-deep-equal"}],[4343,{},function(){with(this)return function(){"use strict";return function(t,e,a){function r(t){for(var e=r.BASE,a=0,n=t.length;a<n;a++)e^=t.charCodeAt(a),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}r.BASE=2166136261,e.exports=r}}},{package:"3box>ipfs>fnv1a"}],[4345,{constants:2202},function(){with(this)return function(){"use strict";return function(t,e,a){e.exports=t("constants")}}},{package:"@metamask/snap-controllers>tar-stream>fs-constants"}],[4346,{assert:1805,events:2133,fsm:4347},function(){with(this)return function(){"use strict";return function(t,e,a){const r=t("events").EventEmitter,n=t("assert"),s=t("fsm");e.exports=function(t,e){"object"==typeof t&&(e=t,t="START");n.equal(typeof t,"string"),n.equal(typeof e,"object"),n.ok(e[t],"invalid starting state "+t),n.ok(s.validate(e));const a=new r;return i._graph=s.reachable(e),i._emitter=a,i._events=e,i._state=t,i.emit=i,i.on=function(t,e){a.on(t,e)},i;function i(t){const e=i._events[i._state][t];if(!function(t,e,a){if(!e)return!1;if(!t)return!0;const r=a[t];return!(!r||!r[e])&&1===r[e].length}(i._state,e,i._graph)){const e="invalid transition: "+i._state+" -> "+t;return a.emit("error",e)}const r=i._state+":leave",n=e+":enter";return i._state?void(a._events[r]?a.emit(r,s):s()):s();function s(){a._events[n]?a.emit(n,o):o()}function o(){i._state=e,a.emit(e),a.emit("done")}}}}}},{package:"3box>ipfs>fsm-event"}],[4347,{},function(){with(this)return function(){"use strict";return function(t,e,a){function r(t,e){for(var a in t){e(t[a],a,t)}}function n(t){return Object.keys(t).sort()}function s(t,e){return~t.indexOf(e)}function i(t,e){return t.filter((function(t){return s(e,t)}))}a.validate=function(t){Object.keys(t);return r(t,(function(e,a){r(e,(function(e,r){if(!t[e])throw new Error("invalid transition from state:"+a+" to state:"+e+" on event:"+r)}))})),!0};var o=a.reachable=function(t){var e={},a=!1;do{a=!1,r(t,(function(t,n){var s=e[n]=e[n]||{};r(t,(function(t,e){s[t]||(s[t]=[e],a=!0)})),r(t,(function(t,n){r(e[t],(function(t,e){s[e]||(s[e]=[n].concat(t),a=!0)}))}))}))}while(a);return e};a.terminal=a.deadlock=function(t){var e=[];return r(t,(function(t,a){(function(t){for(var e in t)return!1;return!0})(t)&&e.push(a)})),e};a.livelock=function(t,e){var a=o(t),n=[];return r(a,(function(t,a){s(e,a)||r(e,(function(e){t[e]||s(n,a)||n.push(a)}))})),n.sort()};function c(t){var e=[];return r(t,(function(t,a){r(t,(function(t,a){s(e,a)||e.push(a)}))})),e.sort()}a.combine=function(t,e,a,r){var o,u,d={},l=c(t),p=c(e),h=(u=p,(o=l).filter((function(t){return!s(u,t)})).concat(u.filter((function(t){return!s(o,t)}))).sort());return function a(r,s){var o,c=r+"-"+s;d[c]||(d[c]={}),o=d[c];var u=n(t[r]),l=n(e[s]);return i(u,l).forEach((function(n){o[n]=t[r][n]+"-"+e[s][n],d[o[n]]||a(t[r][n],e[s][n])})),i(h,u).forEach((function(e){o[e]=t[r][e]+"-"+s,d[o[e]]||a(t[r][e],s)})),i(h,l).forEach((function(t){o[t]=r+"-"+e[s][t],d[o[t]]||a(r,e[s][t])})),d[c]}(a,r),d}}}},{package:"3box>ipfs>fsm-event>fsm"}],[4351,{},function(){with(this)return function(){"use strict";return function(t,e,a){e.exports=function(){if("undefined"==typeof window)return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null}}}},{package:"3box>ipfs>libp2p-webrtc-star>simple-peer>get-browser-rtc"}],[4353,{},function(){with(this)return function(){"use strict";return function(t,e,a){e.exports=function(t){if(t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}}}},{package:"3box>ipfs>async-iterator-to-pull-stream>get-iterator"}],[4361,{"./types":4362,"cross-fetch/polyfill":2239},function(){with(this)return function(){"use strict";return function(t,e,a){var r=this&&this.__assign||Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},n=this&&this.__awaiter||function(t,e,a,r){return new(a||(a=Promise))((function(n,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?n(t.value):new a((function(e){e(t.value)})).then(i,o)}c((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var a,r,n,s,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,r&&(n=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[0,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{a=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},i=this&&this.__rest||function(t,e){var a={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(a[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(a[r[n]]=t[r[n]])}return a};Object.defineProperty(a,"__esModule",{value:!0});var o=t("./types"),c=t("./types");a.ClientError=c.ClientError,t("cross-fetch/polyfill");var u=function(){function t(t,e){this.url=t,this.options=e||{}}return t.prototype.rawRequest=function(t,e){return n(this,void 0,void 0,(function(){var a,n,c,u,d,p,h,f,T;return s(this,(function(s){switch(s.label){case 0:return a=this.options,n=a.headers,c=i(a,["headers"]),u=JSON.stringify({query:t,variables:e||undefined}),[4,fetch(this.url,r({method:"POST",headers:Object.assign({"Content-Type":"application/json"},n),body:u},c))];case 1:return[4,l(d=s.sent())];case 2:if(p=s.sent(),d.ok&&!p.errors&&p.data)return h=d.headers,f=d.status,[2,r({},p,{headers:h,status:f})];throw T="string"==typeof p?{error:p}:p,new o.ClientError(r({},T,{status:d.status,headers:d.headers}),{query:t,variables:e})}}))}))},t.prototype.request=function(t,e){return n(this,void 0,void 0,(function(){var a,n,c,u,d,p,h;return s(this,(function(s){switch(s.label){case 0:return a=this.options,n=a.headers,c=i(a,["headers"]),u=JSON.stringify({query:t,variables:e||undefined}),[4,fetch(this.url,r({method:"POST",headers:Object.assign({"Content-Type":"application/json"},n),body:u},c))];case 1:return[4,l(d=s.sent())];case 2:if(p=s.sent(),d.ok&&!p.errors&&p.data)return[2,p.data];throw h="string"==typeof p?{error:p}:p,new o.ClientError(r({},h,{status:d.status}),{query:t,variables:e})}}))}))},t.prototype.setHeaders=function(t){return this.options.headers=t,this},t.prototype.setHeader=function(t,e){var a,r=this.options.headers;return r?r[t]=e:this.options.headers=((a={})[t]=e,a),this},t}();function d(t,e,a){return n(this,void 0,void 0,(function(){return s(this,(function(r){return[2,new u(t).request(e,a)]}))}))}function l(t){return n(this,void 0,void 0,(function(){var e;return s(this,(function(a){return(e=t.headers.get("Content-Type"))&&e.startsWith("application/json")?[2,t.json()]:[2,t.text()]}))}))}a.GraphQLClient=u,a.rawRequest=function(t,e,a){return n(this,void 0,void 0,(function(){return s(this,(function(r){return[2,new u(t).rawRequest(e,a)]}))}))},a.request=d,a.default=d}}},{package:"3box>graphql-request"}],[4362,{},function(){with(this)return function(){"use strict";return function(t,e,a){var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)});Object.defineProperty(a,"__esModule",{value:!0});var s=function(t){function e(a,r){var n=this,s=e.extractMessage(a)+": "+JSON.stringify({response:a,request:r});return(n=t.call(this,s)||this).response=a,n.request=r,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(n,e),n}return n(e,t),e.extractMessage=function(t){try{return t.errors[0].message}catch(e){return"GraphQL Error (Code: "+t.status+")"}},e}(Error);a.ClientError=s}}},{package:"3box>graphql-request"}]],[],{});