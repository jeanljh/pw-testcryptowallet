import{a as Mt,b as re,c as It,d as At,e as Pt}from"./chunk-GE44DRQ2.js";import{a as vt,d as wt,e as Qt}from"./chunk-RMPHXHQS.js";import{a as xt,b as Rt}from"./chunk-LL3KTXMQ.js";import{a as Bt}from"./chunk-C7HUNOKC.js";import{b as bt}from"./chunk-QRTQZ46Y.js";import{a as Dt,b as p}from"./chunk-CPCRKRJC.js";import{a as yt}from"./chunk-Q4A4SAG2.js";import{b as Et,d as Lt}from"./chunk-3WFUHCRH.js";import{b as K}from"./chunk-63FXY6V3.js";import{j as W}from"./chunk-YU25S3Z6.js";import{A as gt,C as Tt,E as kt,F as Ct,n as ut,p as ft,r as pt,w as ht,z as Ee}from"./chunk-5JUYNHHM.js";import{a as oe,d as St}from"./chunk-3FSEKPUM.js";import{a as te,b as ct,c as dt,d as lt}from"./chunk-6PQVK4Y4.js";import{h as _t}from"./chunk-4NIKWPAL.js";import"./chunk-CHJAVPER.js";import{e as F}from"./chunk-T2IRCTJA.js";import"./chunk-NDCJG34S.js";import{a as U,b as y}from"./chunk-ALZVVIHH.js";import{$ as mt,K as O,L as _,N as it,O as N}from"./chunk-SPXYT2VO.js";import{$ as st}from"./chunk-7CFB2XTF.js";import{a as rt}from"./chunk-BADVKNVD.js";import{o as Z,r as ee,y as nt,z as at}from"./chunk-FLUPYUSZ.js";import{H as X,x as Re,y as Me}from"./chunk-UC2GDSBD.js";import"./chunk-RYV5MLCF.js";import"./chunk-OE3Y2WW2.js";import{a as z}from"./chunk-PI6SXITR.js";import{$a as $,$c as Je,Za as He,_a as We,ab as Ke,bb as je,cc as Xe,cd as $e,dd as ze,ed as Ze,fd as et,ga as qe,gd as tt,rb as Ye,vd as ot,xa as Ge}from"./chunk-LZ43QKYM.js";import"./chunk-LLRT7ZCZ.js";import{a as L}from"./chunk-LH3J3TLH.js";import{$ as Fe,B as Ie,H as I,L as we,O as Be,P as Qe,X as G,Y as J,Z as Oe,_ as Ne,aa as Ue,ba as Ve,ea as H,m as E,n as x,r as be,t as ve}from"./chunk-XEVJKE53.js";import"./chunk-2TP4LTGZ.js";import"./chunk-FA47DEF6.js";import"./chunk-NHQL3RON.js";import"./chunk-AUVAPXJK.js";import"./chunk-UCYWIXHR.js";import"./chunk-25RXMKCK.js";import"./chunk-YS3HYG35.js";import"./chunk-GVNSNU7P.js";import"./chunk-N3AWCE75.js";import"./chunk-MVO3PFGF.js";import"./chunk-DKCWR6P4.js";import{_ as v,c as De,j as u,n as xe,y as Ce}from"./chunk-NLHAZXT3.js";import"./chunk-Z7O2BQPT.js";import"./chunk-RRVELJ3L.js";import"./chunk-MWBMNCFR.js";import"./chunk-J5HV5RZ5.js";import"./chunk-JXDUUE4S.js";import"./chunk-Y5NME4BP.js";import"./chunk-T7EATGE4.js";import"./chunk-YP7AL7GO.js";import"./chunk-VYWNZTTM.js";import"./chunk-33JFC56H.js";import{a as po}from"./chunk-6N5VE5LT.js";import{a as T}from"./chunk-6YOUVTKE.js";import"./chunk-AEGO4G2O.js";import"./chunk-GQPYV2B4.js";import"./chunk-7BSXWXHJ.js";import"./chunk-M7JGFMJS.js";import{f as g,o as n,q as a}from"./chunk-4J7XGGEQ.js";n();a();var ke=g(T());n();a();var P=g(T()),co=g(X());n();a();var w=g(T());n();a();var Le=g(T());v();var Ot=()=>{let{buyStore:o,sellStore:e}=p(),{currentBuyPreset:t,setBuyValue:r,buyValue:s}=o,{currentSellPreset:i,setSellValue:m,sellValue:c}=e,{amountList:f=[]}=t,{amountList:h=[]}=i;(0,Le.useEffect)(()=>{Ce(f)||s.type==="custom"||r({value:f[s.index]||"0",type:"select",index:s.index})},[r,f]),(0,Le.useEffect)(()=>{if(Ce(h)||c.type==="custom")return;let S=h[c.index]||"0";m({value:S,type:"select",index:c.index})},[m,h])};var ho=({inputAmount:o,custom:e,defaultBuyAmountList:t,buyStore:r,setAmountUsed:s,setCustomUsed:i})=>{e==="1"?(r.setBuyValue({value:"",type:"custom",index:3}),i(!0),W("custom")):o&&(t.includes(o)?(r.setBuyValue({value:o,type:"select",index:t.findIndex(m=>m===o)}),s(!0),W("inputAmount")):r.setBuyValue({value:t[0]||"0",type:"select",index:0}))},So=({inputPercent:o,custom:e,defaultSellPercentList:t,sellStore:r,setPercentUsed:s,setCustomUsed:i})=>{e==="1"?(r.setSellValue({value:"",type:"custom",index:3}),r.setIsPercentMode(!0),i(!0),W("custom")):o&&(r.setIsPercentMode(!0),t.includes(o)?(r.setSellValue({value:o,type:"custom",index:3}),s(!0),W("inputPercent")):r.setSellValue({value:t[0]||"0",type:"select",index:0}))},Nt=()=>{let{queryParams:o}=Rt(),{buyStore:e,sellStore:t,configStore:r}=p(),{currentMode:s}=r,{currentBuyPreset:i}=e,{currentSellPreset:m}=t,{amountList:c}=i,{amountList:f}=m,h=o?.get?.("inputAmount"),S=o?.get?.("inputPercent"),C=o?.get?.("custom"),[M,A]=(0,w.useState)(!1),[D,_e]=(0,w.useState)(!1),[Q,Y]=(0,w.useState)(!1);(0,w.useEffect)(()=>{s==="buy"&&!M&&!Q&&ho({inputAmount:h,custom:C,defaultBuyAmountList:c||[],buyStore:e,setAmountUsed:A,setCustomUsed:Y})},[h,C,s,c,M,Q]),(0,w.useEffect)(()=>{s==="sell"&&!D&&!Q&&So({inputPercent:S,custom:C,defaultSellPercentList:f||[],sellStore:t,setPercentUsed:_e,setCustomUsed:Y})},[h,S,C,s,f,D,Q]),Ot()};n();a();var Vt=g(T());n();a();var Ft=g(T());n();a();var se=g(T());var go=()=>{let{buyStore:o,sellStore:e,configStore:t}=p(),{currentMode:r}=t,s=(0,se.useCallback)(f=>{let h=f.coinAmountOriginalDec||f.amountNum,S={...f,amountNum:h};e.onSocketUpdateFromTokenBalance(S),o.onSocketUpdateFromTokenBalance(S)},[e,o]),i=e.fromToken?.tokenContractAddress,m=o.fromToken?.tokenContractAddress,c=(0,se.useMemo)(()=>r==="sell"?i:m,[i,m,r]);return{updateTokenBalance:s,currentTokenAddress:c}},ne=go;var To=()=>{let{updateTokenBalance:o,currentTokenAddress:e}=ne(),t=Bt(),{chainId:r,accountId:s,userUniqueId:i,walletId:m,userWalletAddress:c,businessType:f}=t;return(0,Ft.useCallback)(async()=>{if(e&&r&&s&&i&&m&&c){let h=await wt({tokenAddress:e,chainId:r,accountId:s,userUniqueId:i,walletId:m,userWalletAddress:c,businessType:f});h&&o(h)}},[r,e,s,i,m,c,f,o])},Ut=To;var ko=()=>{let{accountStore:o,memePositionStore:e,configStore:t,commonStore:r}=p(),{computedAccountId:s}=o,{userUniqueId:i}=r,{computedNativeTokenInfo:m}=t,{chainId:c}=m||{},{fetchPositionList:f}=e,h=vt(f,300),{updateTokenBalance:S}=ne(),C=Ut();(0,Vt.useEffect)(()=>{let M=te({isPri:!0,needLogin:!0,subscribeParams:[{channel:lt.WALLET_ASSET}],onListenData:A=>{!A||(h({chainId:c,accountId:s,userUniqueId:i}),S(A))},onListenError:C,onListenReconnected:C});return()=>{M()}},[c,s,i,h,S,C])},qt=ko;n();a();var Gt=g(T());function Ht(){let{accountStore:o}=p(),{computedAccountWalletAddresses:e}=o;(0,Gt.useEffect)(()=>{let t=()=>{};return e&&(t=ct(e)),()=>{t?.()}},[e])}n();a();n();a();var jt=g(T());n();a();function ae(){let{buyStore:o,sellStore:e,configStore:t}=p(),{currentMode:r}=t;return(r==="sell"?e.fromToken:o.toToken)||{}}n();a();var Wt=(o,e)=>{let t={userUniqueId:o,tokenDetailList:[{chainId:e.chainId,contractAddress:e.tokenContractAddress,tokenSymbol:e.tokenSymbol,precision:e.decimals}]};return y.post(Xe,t)},Kt=o=>(Array.isArray(o)?o:[o]).map(t=>({channel:dt.DEX_MARKET_TX_CHANNEL,chainId:String(t?.chainId),tokenAddress:t?.tokenContractAddress}));var _o=()=>{let o=ae(),{commonStore:e}=p();(0,jt.useEffect)(()=>{!o.tokenContractAddress||!o.chainId||!e.userUniqueId||Wt(e.userUniqueId,o)},[e.userUniqueId,o.tokenContractAddress,o.chainId])},Yt=_o;n();a();var Zt=g(T());n();a();var $t=g(T());n();a();var Xt=async({tokenContractAddress:o,accountId:e=void 0,chainId:t,walletAddress:r=void 0})=>{let s=performance.now(),[i,m]=await I(y.get(Je,{params:{tokenContractAddress:o,accountId:e,chainId:t,walletAddress:r}})),c=performance.now()-s;return be.info(`[Market-API]: fetchLatestInfo: ${c?.toFixed?.(2)}ms`),!i&&m?m.data:{error:i}};n();a();var Jt=g(T());var Co=()=>{let{buyStore:o,sellStore:e,configStore:t}=p(),{currentMode:r}=t;return(0,Jt.useCallback)(s=>{let i={...s,chainId:Number(s.chainId)};r==="sell"?e.onSocketUpdateFromToken(i):o.onSocketUpdateToToken(i)},[r,e,o])},ie=Co;var Mo=()=>{let{accountStore:o}=p(),{computedAccountId:e,computedSignWalletAddress:t}=o,r=ie();return(0,$t.useCallback)(async s=>{let i=await Xt({tokenContractAddress:s.tokenContractAddress,chainId:s.chainId,accountId:e,walletAddress:t});if(i?.error)return;let m={...s,price:i.price,marketCap:i.marketCap};r(m)},[r,e])},zt=Mo;var Io=()=>{let o=ae(),e=ie(),t=zt();(0,Zt.useEffect)(()=>{if(!o.tokenContractAddress||!o.chainId)return()=>{};let r=Kt(o),s=te({subscribeParams:r,onListenData:i=>{e(i[0])},onListenError:()=>{t(o)},onListenReconnected:()=>{t(o)}});return()=>{s()}},[o.tokenContractAddress,o.chainId,e])},eo=Io;var Eo=()=>{Yt(),eo()},to=Eo;n();a();var B=g(T()),oo=g(X());var Lo=({currency:o,currentWallet:e,walletInfo:t,keyringIdentityTypeEnum:r,addressBookList:s,walletList:i,t:m,dispatch:c,onBack:f})=>{let{commonStore:h,accountStore:S,reset:C}=p(),M=(0,oo.useHistory)();(0,B.useEffect)(()=>{H.setRuntimeContext({history:M,toLocale:m,dispatch:c,walletInfo:t,onBack:f})},[m,M,c,t,f]),(0,B.useEffect)(()=>{e&&S.setWalletConfig(e)},[e]),(0,B.useEffect)(()=>(h.getUserUnit(o),()=>{C()}),[]),(0,B.useEffect)(()=>{S.setAddressBookList(s)},[s]),(0,B.useEffect)(()=>{S.setWalletList(i)},[i]),(0,B.useEffect)(()=>{S.setKeyringIdentityTypeEnum(r)},[r])},ro=Lo;n();a();var k=g(T()),q=g(X());n();a();var R=g(T()),ue=g(X()),ao=g(po());n();a();var ye=g(T());var yo=()=>ye.default.createElement("div",{className:"mt-50"},ye.default.createElement(Re,{pastDelay:!1,error:!0,delayTime:1e4,alt:"dexGenericError",retry:()=>{Be(we().pathname,"_self")}})),so=yo;n();a();var me=g(T());var Ao=()=>{let{commonStore:o,configStore:e}=p(),{currentMode:t}=e,{fromToken:r}=Qt(),{chainId:s,isNativeToken:i,tokenContractAddress:m}=r,{visibleAddFunds:c,setAddFundsVisible:f}=o,h=rt(),S=(0,me.useMemo)(()=>h?!0:t==="sell",[h,t]);return me.default.createElement(Mt,{visible:c,params:{chainId:s,tokenContractAddress:i?"":m,receiveOnly:S},onBack:()=>{f(!1)}})},no=x(Ao);var Po=[G,J],Do=({children:o,onBack:e})=>{let{commonStore:t,configStore:r,buyStore:s,sellStore:i}=p(),{showNavigator:m,title:c,closeable:f}=It({configStore:r,buyStore:s,sellStore:i}),h=(0,ue.useLocation)(),S=(0,ue.useHistory)(),{isTelegramMiniApp:C}=H.global,{Navigator:M}=H.components,{setAddFundsVisible:A}=t;(0,R.useEffect)(()=>{A(!1)},[]),yt(),_t(Pt.setServiceState);let D=()=>{e?e(S.goBack,Po.includes(h.pathname)):S.goBack()};return R.default.createElement(ut,{fallbackComponent:so},R.default.createElement("div",{className:(0,ao.default)("universe-swap background-base-primary",re.wrapper)},m?R.default.createElement(M,{title:c,onBack:D,closeable:f}):null,R.default.createElement("div",{id:"meme-swap-container",className:C?re.memeTelegramContainer:re.extensionContainer},o)),R.default.createElement(no,null))},io=x(Do);var mo=(0,k.lazy)(()=>import("./Buy-ZJCQRNW3.js")),xo=(0,k.lazy)(()=>import("./Sell-ZI5JM574.js")),Ro=(0,k.lazy)(()=>import("./Configure-T2M7OPMP.js")),bo=(0,k.lazy)(()=>import("./TokenList-QEJSUFLU.js")),vo=(0,k.lazy)(()=>import("./HighRisk-YSALSMRU.js")),wo=(0,k.lazy)(()=>import("./Presets-2CUVN4QW.js")),Bo=(0,k.lazy)(()=>import("./PresetEdit-RZA5COV6.js")),Qo=({onBack:o})=>k.default.createElement(io,{onBack:o},k.default.createElement(k.Suspense,null,k.default.createElement(q.Switch,null,[{path:G,component:mo,exact:!0},{path:J,component:xo,exact:!0},{path:Ne,component:Ro,exact:!0},{path:Oe,component:bo,exact:!0},{path:Fe,component:vo,exact:!0},{path:Ue,component:wo,extract:!0},{path:Ve,component:Bo,extract:!0}].map(t=>k.default.createElement(q.Route,{key:t.path,path:t.path,component:t.component,exact:t.exact})),k.default.createElement(q.Redirect,{from:G,to:{pathname:mo,search:new Qe().getAll()},strict:!0,exact:!0})))),uo=Qo;var Oo=({currency:o,currentWallet:e,keyringIdentityTypeEnum:t,addressBookList:r,walletList:s,walletInfo:i,onBack:m,t:c,dispatch:f})=>{ro({currency:o,currentWallet:e,walletInfo:i,keyringIdentityTypeEnum:t,addressBookList:r,walletList:s,t:c,dispatch:f,onBack:m}),Ht(),qt(),to();let{accountStore:{address:h,setFromChainId:S},configStore:{fetchConfig:C,computedConfig:M,setCurrentMode:A}}=p();(0,P.useEffect)(()=>{_.setTags({address:h})},[h]),(0,P.useEffect)(()=>{C()},[]);let D=(0,co.useLocation)();(0,P.useEffect)(()=>{if(D){let{isBuyMode:Q,isSellMode:Y}=xt(D);Q?A("buy"):Y&&A("sell")}},[D,A]),(0,P.useEffect)(()=>{M&&S(M?.nativeTokenInfo?.chainId)},[M]),bt(),Nt();let{initialized:_e}=Ct();return _e?P.default.createElement(uo,{onBack:m}):null},lo=(0,P.memo)(x(Oo));n();a();n();a();v();var ce=class{constructor(){this.loading=!0;this.setLoading=e=>{this.loading=e};this.fromToken=null;this.setFromToken=e=>{this.fromToken=e};this.toToken=null;this.setToToken=e=>{this.toToken=e};this.onSocketUpdateToToken=e=>{F(e,this.toToken)&&this.setToToken({...this.toToken,...e})};this.onSocketUpdateFromTokenBalance=e=>{F(e,this.fromToken)&&this.setFromToken({...this.fromToken,amountNum:e.amountNum})};this.buyValue={value:"0",index:0,type:"select"};this.setBuyValue=e=>{this.buyValue=e};this.buyPresetList=[];this.setBuyPresetList=e=>{this.buyPresetList=e};this.currentBuyPresetId="";this.setCurrentBuyPresetId=e=>{this.currentBuyPresetId=e};this.buyPresetPageEditState=!1;this.setBuyPresetPageEditState=e=>{this.buyPresetPageEditState=e};this.editBuyPreset={isEdit:!0,value:{}};this.setEditBuyPreset=e=>{this.editBuyPreset=e};this.memeBtnStatus=Z;this.setMemeBtnStatus=e=>{this.memeBtnStatus=e};E(this)}get computedBuyNumber(){if(this.buyValue.type==="custom"){let e=this.buyValue.value||"0";return z(e)?"0":new L.BigNumber(e).toString(10)}return this.currentBuyPreset?.amountList?.[this.buyValue.index]}get computedBuyTokenSymbol(){return u(this,"toToken.tokenSymbol")}get computedBuyNumberIsValid(){return new L.BigNumber(this.computedBuyNumber).gt(0)}get currentBuyPreset(){return this.buyPresetList.find(e=>e.id===this.currentBuyPresetId)||{}}};n();a();var de=class{constructor(){this.initState=!1;this.setInitState=e=>{this.initState=e};this.positionList=[];this.setPositionList=e=>{this.positionList=K.filterHiddenTokenList(e)};this.fetchPositionLoading=!0;this.setFetchPositionLoading=e=>{this.fetchPositionLoading=e};this.cancelFetchRef=null;this.fetchPositionList=async({accountId:e,userUniqueId:t,chainId:r,minAmountThreshold:s})=>{if(!e||!t||!r)return;this.cancelFetchRef&&this.cancelFetchRef.abort(),this.setFetchPositionLoading(!0),this.cancelFetchRef=N();let[i,m]=await I(y.get($e,{params:{accountId:e,userUniqueId:t,chainId:r,minAmountThreshold:s},signal:this.cancelFetchRef?.signal}));i&&_.stuff(i),m&&m.data&&this.setPositionList(m?.data),this.setFetchPositionLoading(!1),this.setInitState(!0)};E(this)}isCancel(e){return U(e)}};n();a();v();var le=class{constructor(){this.loading=!0;this.setLoading=e=>{this.loading=e};this.fromToken=null;this.setFromToken=e=>{this.fromToken=e};this.onSocketUpdateFromToken=e=>{F(e,this.fromToken)&&this.setFromToken({...this.fromToken,...e})};this.onSocketUpdateFromTokenBalance=e=>{F(e,this.fromToken)&&this.setFromToken({...this.fromToken,amountNum:e.amountNum})};this.toToken=null;this.setToToken=e=>{this.toToken=e};this.sellValue={value:"",type:"custom",index:0};this.setSellValue=e=>{this.sellValue=e};this.isPercentMode=!0;this.setIsPercentMode=e=>{this.isPercentMode=e};this.sellPresetList=[];this.setSellPresetList=e=>{this.sellPresetList=e};this.currentSellPresetId="";this.setCurrentSellPresetId=e=>{this.currentSellPresetId=e};this.sellPresetPageEditState=!1;this.setSellPresetPageEditState=e=>{this.sellPresetPageEditState=e};this.editSellPreset={isEdit:!0,value:{}};this.setEditSellPreset=e=>{this.editSellPreset=e};this.memeBtnStatus=Z;this.setMemeBtnStatus=e=>{this.memeBtnStatus=e};E(this)}get computedSellNumber(){try{let e=Math.min(this.fromToken?.decimals||0,12);if(this.sellValue.type==="custom"&&!this.isPercentMode){let s=this.sellValue.value||"0";return z(s)?"0":new L.BigNumber(s).toString(10)}let t=this.fromToken?.amountNum||"0";if(this.sellValue.type==="custom"&&this.isPercentMode)return L.floorMul(L.div(this.sellValue.value||"0",100),t,e);let r=this.currentSellPreset?.amountList?.[this.sellValue.index];return L.floorMul(r,t,e)}catch(e){return _.stuff(e),"0"}}get computedSellTokenSymbol(){return u(this,"fromToken.tokenSymbol")}get computedSellTokenBalanceLessAmount(){return u(this,"fromToken.computedSellNumber")>u(this,"fromToken.amountNum")}get computedSellNumberIsValid(){return new L.BigNumber(this.computedSellNumber).gt(0)}get currentSellPreset(){return this.sellPresetList.find(e=>e.id===this.currentSellPresetId)||{}}};n();a();var fe=class{constructor(){this.searchValue="";this.setSearchValue=e=>{this.searchValue=e};this.defaultSearchLoading=!0;this.setDefaultSearchLoading=e=>{this.defaultSearchLoading=e};this.searchLoading=!1;this.setSearchLoading=e=>{this.searchLoading=e};this.commonSearchState=!1;this.setCommonSearchState=e=>{this.commonSearchState=e};this.normalTokenList=[];this.unsupportedTokenList=[];this.fetchDefaultTokenList=async({chainId:e,computedAccountId:t,userUniqueId:r})=>{this.setDefaultSearchLoading(!0),this.setCommonSearchState(!1);let s={chainId:e,accountId:t,userUniqueId:r,minAmountThreshold:K.getMinAmountThresholdParam()},[i,m]=await I(y.get(ze,{params:s}));if(this.searchValue){this.setDefaultSearchLoading(!1);return}i&&(_.stuff(i),this.normalTokenList=[],this.unsupportedTokenList=[]),m&&m.data&&(this.normalTokenList=K.filterHiddenTokenList(m?.data),this.unsupportedTokenList=[]),this.setDefaultSearchLoading(!1)};this.cancelSearchRef=null;this.fetchSearchTokenList=async({chainId:e,computedAccountId:t,userUniqueId:r})=>{if(!this.searchValue)return;this.cancelSearchRef&&this.cancelSearchRef.abort(),this.setSearchLoading(!0),this.setCommonSearchState(!0),this.cancelSearchRef=N();let[s,i]=await I(y.get(Ze,{params:{chainId:e,accountId:t,userUniqueId:r,inputContent:this.searchValue},signal:this.cancelSearchRef?.signal}));if(!this.searchValue){this.setSearchLoading(!1);return}s&&!this.isCancel(s)&&(_.stuff(s),this.normalTokenList=[],this.unsupportedTokenList=[]),i&&i.data&&(this.normalTokenList=i?.data?.memeList,i?.data?.memeUnsupportList?this.unsupportedTokenList=i?.data?.memeUnsupportList.map(m=>{let c=m;return c.unSupportedMeme=!0,c}):this.unsupportedTokenList=[]),this.setSearchLoading(!1)};this.highRiskToken=null;this.setHighRiskToken=e=>{this.highRiskToken=e};this.highRiskCallBack=()=>{};this.setHighRiskCallBack=e=>{this.highRiskCallBack=e};E(this)}isCancel(e){return U(e)}};n();a();v();n();a();var pe=class{constructor(){this.currentMode="buy";this.setCurrentMode=e=>{this.currentMode=e};this.tradeScene=0;this.presetStorageKey=ee;this.currentChainID=Ye.SOLANA_MAINNET;this.initLoading=!0;this.setInitLoading=e=>{this.initLoading=e}}get computedIsBuy(){return this.currentMode==="buy"}get computedIsSell(){return this.currentMode==="sell"}};var he=class extends pe{constructor(){super();this.configList=[];this.setConfigList=t=>{this.configList=t};this.fetchConfig=async()=>{let[t,r]=await I(Et({sceneType:this.tradeScene}));if(t){_.error(O.MEME_SWAP_PRE_EXECUTE_ERR,{error:t});return}r&&r.data&&(this.setConfigList(r.data),this.setInitLoading(!1))};oe(this),this.tradeScene=0,this.presetStorageKey=ee}get computedConfig(){return this.configList.find(t=>De(t.chainId)===this.currentChainID&&t.sceneType===this.tradeScene)}get computedNativeTokenInfo(){return u(this.computedConfig,"nativeTokenInfo",{})}};n();a();v();n();a();v();n();a();var Ae=class{constructor(){this.needOrderConfirm=!0;this.isOpen=!1;this.open=()=>{this.isOpen=!0};this.close=async()=>{this.isOpen=!1,this.handleReject&&this.handleReject(),this.handleResolve=null,this.handleReject=null};this.confirm=async()=>{this.isOpen=!1,this.handleResolve&&this.handleResolve(),this.handleResolve=null,this.handleReject=null};this.setNeedOrderConfirm=e=>{this.needOrderConfirm=e};this.quoteData={};this.cacheQuoteData=null;this.needUpdata=!1;this.updateQuoteData=e=>{if(this.cacheQuoteData){if(this.cacheQuoteData.toAmount===e.toAmount)return;this.needUpdata=!0,this.cacheQuoteData=e;return}this.quoteData=e,this.cacheQuoteData=e};this.update=()=>{this.quoteData=this.cacheQuoteData,this.needUpdata=!1};this.handleResolve=null;this.handleReject=null;E(this)}},Pe=new Ae;var Se=class{constructor(){this.QUOTE_TIMEOUT=5e3;this.quoteLoading=!1;this.quoteData=Se.INIT_QUOTE_DATA;this.resetQuote=()=>{this.cleanQuoteTimer(),this.cacheParams=null,this.setQuoteData(Se.INIT_QUOTE_DATA)};this.isAutoQuote=!1;this.cancelRef=null;this.initLoading=!0;this.timerRef=null;this.cacheParams=null;this.startingPoll=async(e,t)=>{if(this.cacheParams=e,this.timerRef&&clearTimeout(this.timerRef),!this.isQuoteImmediate(this.cacheParams||{})){this.setIsInitLoading(!1),this.resetQuote();return}await this.fetchQuoteAction(this.cacheParams,t),clearTimeout(this.timerRef),this.timerRef=setTimeout(async()=>{this.setIsAutoQuote(!0),await this.startingPoll(this.cacheParams,t)},this.QUOTE_TIMEOUT)};this.fetchQuote=xe(this.startingPoll,Ge)}setQuoteLoading(e){this.quoteLoading=e}setQuoteData(e){this.quoteData=e}setIsAutoQuote(e){this.isAutoQuote=e}cleanQuoteTimer(){this.cancelRef&&(this.cancelRef.abort(),this.cancelRef=null),this.timerRef&&clearTimeout(this.timerRef)}setIsInitLoading(e){this.initLoading=e}quoteStart(){this.setQuoteLoading(!0),this.cleanQuoteTimer()}quoteEnd(){this.setIsInitLoading(!1),this.setQuoteLoading(!1),this.setIsAutoQuote(!1)}getQuoteUrl(){return tt}async fetchQuoteAction(e,t){this.quoteStart(),this.cancelRef=N();let[r,s]=await I(y.get(this.getQuoteUrl(),{params:e,signal:this.cancelRef.signal}));if(!U(r)&&r){let i=r||{};Pe.isOpen&&Pe?.close(),this.setQuoteData(i)}else this.setQuoteData(s||{}),t?.(s);this.quoteEnd()}isQuoteImmediate(e){return!!e?.chainId&&!!e?.fromTokenAddress&&!!e?.toTokenAddress&&new L.BigNumber(e?.amount).gt(0)}get computedQuoteCompleted(){return this.quoteData.error_code}get computedQuoteSuccuss(){return this.quoteData.error_code==="0"}get computedQuoteIsError(){return this.computedQuoteCompleted&&this.computedQuoteCompleted!=="0"&&this.computedQuoteCompleted!==je}get computedQuoteErrorMsg(){return u(this.quoteData,"error_message","")}get computedCustomQuoteLoading(){return!this.isAutoQuote&&this.quoteLoading}get computedQuoteNetworkError(){return this.quoteData.status==="ERR_NETWORK"}get computedQuoteIsBuyHoneypot(){return this.computedQuoteCompleted&&u(this.quoteData,"error_code")===Ke}get computedQuoteIsSellHoneypot(){return this.computedQuoteCompleted&&u(this.quoteData,"data.limitOrderInfo.code")===$}get computedQuoteIsBlackAddress(){return this.computedQuoteCompleted&&u(this.quoteData,"error_code")===He}get computedQuoteIsNewAddress(){return this.computedQuoteCompleted&&u(this.quoteData,"error_code")===We}},j=Se;j.INIT_QUOTE_DATA={data:null,detailMsg:"",error_code:"",error_message:"",msg:"",status:""};var ge=class extends j{constructor(){super(),oe(this)}getQuoteUrl(){return et}get jitoIsSuccess(){return u(this.quoteData,"data.memeModeCommonDexInfo.enableJito",!1)}get computedPriorityFeeInfo(){let e=u(this.quoteData,"data.memeModeCommonDexInfo.nonMevPriorityFeeInfo")??{};return{mevPriorityFeeInfo:u(this.quoteData,"data.memeModeCommonDexInfo.mevList[0]")??{},nonMevPriorityFeeInfo:e}}get computedFromTokenValue(){return u(this.quoteData,"data.memeModeCommonDexInfo.fromTokenPrice","0")}get computedToTokenAmount(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.receiveAmount","0")}get computedToTokenValue(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.toTokenPrice","0")}get quoteNetWorkFeeOfMoney(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.quoteNetWorkFeeOfMoney","")}get computedQuoteLiquidityError(){return this.computedQuoteCompleted&&!u(this.quoteData,"data.memeModeSingleChainSwapInfo")}get computedSwapOnOtherDapp(){let e=String(u(this.quoteData,"data.memeModeCommonDexInfo.isSupportDappTrade"))==="1";return this.computedQuoteCompleted&&e}get computedQuoteSafemoon(){if(this.computedQuoteCompleted){let e=u(this.quoteData,"data.memeModeCommonDexInfo.fromToken",{}),t=u(this.quoteData,"data.memeModeCommonDexInfo.toToken",{});if(Ee(e))return e?.tokenSymbol;if(Ee(t))return t?.tokenSymbol}return""}get computedGetRouterList(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.dexRouterList")}get computedGetEstimateGasFee(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.estimateGasFee")}get computedGetQuoteFrom(){return u(this.quoteData,"data.memeModeCommonDexInfo.fromToken",{})||{}}get computedGetQuoteTo(){return u(this.quoteData,"data.memeModeCommonDexInfo.toToken",{})||{}}get computedGetQuoteFromAmount(){return u(this.quoteData,"data.memeModeCommonDexInfo.fromTokenAmount")}get computedGetQuoteFromPrice(){return u(this.quoteData,"data.memeModeCommonDexInfo.fromTokenPrice")}get computedGetQuoteFromSinglePrice(){return Ie.div(this.computedGetQuoteFromPrice,this.computedGetQuoteFromAmount).toString()}get computedGetQuoteToAmount(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.receiveAmount")}get computedGetQuoteToPrice(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.toTokenPrice")}get computedGetQuoteToSinglePrice(){return Ie.div(this.computedGetQuoteToPrice,this.computedGetQuoteToAmount).toString()}get computedQuoteTraceData(){return u(this.quoteData,"data.traceData")}get computedGetQuoteTokenTax(){return u(this.quoteData,"data.memeModeCommonDexInfo.tokenTax","")}get computedQuoteIsInvalid(){return this.computedQuoteIsError||this.computedQuoteNetworkError||this.computedQuoteLiquidityError}get computedServiceFeeInfo(){return u(this.quoteData,"data.memeModeCommonDexInfo.serviceFeeInfo",{})}get computedAutoSlippage(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.autoSlippageInfo.referenceSlippage","")||u(this.quoteData,"data.memeModeSingleChainSwapInfo.autoSlippageInfo.autoSlippage","")}get mevUnstableShowLevel(){return u(this.quoteData,"data.memeModeCommonDexInfo.mevUnstableShowLevel",-1)}get solPrice(){return u(this.quoteData,"data.memeModeCommonDexInfo.nativeTokenPrice",0)}get quoteDiffValThreshold(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.quoteDiffValThreshold")}get quoteDiffPercentThreshold(){return u(this.quoteData,"data.memeModeSingleChainSwapInfo.quoteDiffPercentThreshold")}get computedValueDifference(){return St({pay:this.computedFromTokenValue,receive:this.computedToTokenValue,quoteDiffValThreshold:this.quoteDiffValThreshold,quoteDiffPercentThreshold:this.quoteDiffPercentThreshold})}get computedQuoteIsSellHoneypot(){return this.computedQuoteCompleted&&u(this.quoteData,"data.memeModeCommonDexInfo.code")===$}};n();a();v();var Te=class{constructor(){this.isSwapLoading=!1;this.cacheVerifyCallDataResult=null;this.setCacheVerifyCallDataResult=e=>{this.cacheVerifyCallDataResult=e};this.checkCallData=async({chainId:e,responseData:t,requestParams:r,accountId:s,signWalletAddress:i})=>{let m=await mt({callData:t?.callData?.data,chainId:e,hasReferralCommission:t?.hasReferralCommission,address:i});return m.success||this.setCacheVerifyCallDataResult({...m,walletId:s,requestCommissionAddress:r?.serviceFeeInfo?.referralCommissionAddress}),m};this.logVerifyCallDataResult=({txHash:e,orderId:t})=>{this.cacheVerifyCallDataResult&&!this.cacheVerifyCallDataResult.success&&(it({...this.cacheVerifyCallDataResult,txHash:e,orderId:t}),this.setCacheVerifyCallDataResult(null))};E(this,{},{autoBind:!0})}setIsSwapLoading(e){this.isSwapLoading=e}getSolanaUnsignedTx(e){let t=u(e,"calldataParams.enableJito"),r=e?.unsignedTx||"{}";try{return t?JSON.parse(r).array:[JSON.parse(r)]}catch(s){throw new Error(s)}}getJitoTxData(e){let t=new kt,r=this.getSolanaUnsignedTx(e);return Promise.all(r.map(t.txData))}async onSolanaSwap({data:e,signedTransactions:t,txArray:r}){try{let s=u(e,"calldataParams.enableJito"),i=await Tt({walletId:e.walletId,swapParams:e.calldataParams,signedTransactions:t,txArray:r,enableJito:s,isMemeMode:!0,orderId:e?.originData?.orderId});if(_.info(O.MEME_SWAP_BROADCAST_PARAMS,{data:{...e,solanaBroadcastParams:i,unsignedTxArray:r,signedTransactions:t}}),!qe()){let f=i?.dexMultiMetaSaveOrderParam?.chainId;st({chain_id:f,chain_name:ve.chainInfo?.[f]||"",tx_hash:i?.updateMultiOrderInfo?.transactionHash,trade_mode:nt.MEME,terminal:at.WEB})}let[m,c]=await I(Lt(i));if(m){this.broadcastError(m,{...e,solanaBroadcastParams:i,unsignedTxArray:r,signedTransactions:t,broadcastRes:c,tags:{userWalletAddress:e.userWalletAddress}});return}return _.info(O.MEME_SWAP_BROADCAST_SUCCESS,{data:{...e,solanaBroadcastParams:i,unsignedTxArray:r,signedTransactions:t,broadcastRes:c}}),this.logVerifyCallDataResult({txHash:c?.data?.broadcastResult?.data?.transactionHash,orderId:c?.data?.broadcastResult?.data?.orderId}),c}catch(s){throw this.broadcastError(s,{...e,unsignedTxArray:r,signedTransactions:t}),new Error(s?.error_message)}}broadcastError(e,t){Me.error({title:e?.error_message||ot("swaptrade_home_toast_broadcast_failed"),placement:Me.DIRECTION.top}),_.error(O.MEME_SWAP_BROADCAST_ERROR,{error:e,...t})}};var b=class{constructor(){this.reset=()=>{this.commonStore=new ht(this),this.accountStore=new pt(this),this.sendTransactionStore=new gt,this.configStore=new he,this.buyStore=new ce,this.sellStore=new le,this.memePositionStore=new de,this.quoteStore=new ge,this.memeTokenListStore=new fe,this.memeSwapStore=new Te};this.reset()}static getInstance(){return b.instance||(b.instance=new b),b.instance}},fo=b;var Fo=({localeData:o,...e})=>(At(),ke.default.createElement(ft,{localeData:o,isDev:!0,noRemoteData:!0,customRender:t=>t},ke.default.createElement(Dt.Provider,{value:fo.getInstance()},ke.default.createElement(lo,{...e})))),Bi=x(Fo);export{Bi as default};
//# sourceMappingURL=MemeMode-AQ5ZTS4R.js.map
