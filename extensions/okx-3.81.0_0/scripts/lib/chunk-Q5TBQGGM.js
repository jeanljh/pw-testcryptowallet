import{a as m,c as P}from"./chunk-5LVRFP7W.js";import{k as Q}from"./chunk-RZ6UTWVB.js";import{c as _,o as l,q as y}from"./chunk-4J7XGGEQ.js";var O=_(o=>{l();y();Object.defineProperty(o,"__esModule",{value:!0});o.decrypt=o.encrypt=o.decodeBytes=o.nsecFromPrvKey=o.npubEncode=o.nsec=o.nostrHdp=void 0;var U=m(),u=P();typeof crypto<"u"&&!crypto.subtle&&crypto.webcrypto&&(crypto.subtle=crypto.webcrypto.subtle);o.nostrHdp="npub";o.nsec="nsec";function Y(e){return z("npub",e)}o.npubEncode=Y;function K(e){return z("nsec",e)}o.nsecFromPrvKey=K;function z(e,t){return u.base.toBech32(e,u.base.fromHex(t))}function A(e,t){try{let[r,n]=u.base.fromBech32(t);if(e!==r)throw new Error("invalid data");return u.base.toHex(n,!1)}catch(r){throw console.log(r),r}}o.decodeBytes=A;async function ee(e,t,r){if(crypto==null)throw new Error("crypto is null");let n=U.secp256k1.getSharedSecret(A("nsec",e),"02"+u.base.stripHexPrefix(t)),a=F(n),p=Uint8Array.from(u.base.randomBytes(16)),v=u.base.toUtf8(r),x=await crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["encrypt"]),j=await crypto.subtle.encrypt({name:"AES-CBC",iv:p},x,v),H=u.base.toBase64(new Uint8Array(j)),M=u.base.toBase64(new Uint8Array(p.buffer));return`${H}?iv=${M}`}o.encrypt=ee;async function te(e,t,r){let[n,a]=r.split("?iv="),p=U.secp256k1.getSharedSecret(A("nsec",e),"02"+u.base.stripHexPrefix(t)),v=F(p),x=await crypto.subtle.importKey("raw",v,{name:"AES-CBC"},!1,["decrypt"]),j=u.base.fromBase64(n),H=u.base.fromBase64(a),M=await crypto.subtle.decrypt({name:"AES-CBC",iv:H},x,j);return u.base.fromUtf8(new Uint8Array(M))}o.decrypt=te;function F(e){return e.slice(1,33)}});var w=_(b=>{l();y();Object.defineProperty(b,"__esModule",{value:!0});b.getPublicKey=b.generatePrivateKey=void 0;var I=m(),q=P();function re(){return q.base.toHex(I.secp256k1.utils.randomPrivateKey(),!1)}b.generatePrivateKey=re;function ne(e){return q.base.toHex(I.secp256k1.schnorr.getPublicKey(q.base.stripHexPrefix(e)),!1)}b.getPublicKey=ne});var R=_(s=>{l();y();Object.defineProperty(s,"__esModule",{value:!0});s.getSignature=s.signEvent=s.verifySignature=s.validateEvent=s.getEventHash=s.serializeEvent=s.finishEvent=s.getBlankEvent=s.Kind=s.verifiedSymbol=void 0;var se=w(),ae=m(),g=P(),V=ae.signUtil.schnorr.secp256k1.schnorr;s.verifiedSymbol=Symbol("verified");var Z;(function(e){e[e.Metadata=0]="Metadata",e[e.Text=1]="Text",e[e.RecommendRelay=2]="RecommendRelay",e[e.Contacts=3]="Contacts",e[e.EncryptedDirectMessage=4]="EncryptedDirectMessage",e[e.EventDeletion=5]="EventDeletion",e[e.Repost=6]="Repost",e[e.Reaction=7]="Reaction",e[e.BadgeAward=8]="BadgeAward",e[e.ChannelCreation=40]="ChannelCreation",e[e.ChannelMetadata=41]="ChannelMetadata",e[e.ChannelMessage=42]="ChannelMessage",e[e.ChannelHideMessage=43]="ChannelHideMessage",e[e.ChannelMuteUser=44]="ChannelMuteUser",e[e.Blank=255]="Blank",e[e.Report=1984]="Report",e[e.ZapRequest=9734]="ZapRequest",e[e.Zap=9735]="Zap",e[e.RelayList=10002]="RelayList",e[e.ClientAuth=22242]="ClientAuth",e[e.NwcRequest=23194]="NwcRequest",e[e.HttpAuth=27235]="HttpAuth",e[e.ProfileBadge=30008]="ProfileBadge",e[e.BadgeDefinition=30009]="BadgeDefinition",e[e.Article=30023]="Article",e[e.FileMetadata=1063]="FileMetadata"})(Z=s.Kind||(s.Kind={}));function ie(e=Z.Blank){return{kind:e,content:"",tags:[],created_at:0}}s.getBlankEvent=ie;function oe(e,t){let r=e;return r.pubkey=(0,se.getPublicKey)(t),r.id=B(r),r.sig=k(r,t),r[s.verifiedSymbol]=!0,r}s.finishEvent=oe;function $(e){if(!G(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}s.serializeEvent=$;function B(e){let t=g.base.sha256(g.base.toUtf8($(e)));return g.base.toHex(t,!1)}s.getEventHash=B;var ce=e=>e instanceof Object;function G(e){if(!ce(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]=="object")return!1}return!0}s.validateEvent=G;function ue(e){if(typeof e[s.verifiedSymbol]=="boolean")return e[s.verifiedSymbol];let t=B(e);if(t!==e.id)return e[s.verifiedSymbol]=!1;try{return e[s.verifiedSymbol]=V.verify(e.sig,t,e.pubkey)}catch{return e[s.verifiedSymbol]=!1}}s.verifySignature=ue;function le(e,t){return console.warn("nostr-tools: `signEvent` is deprecated and will be removed or changed in the future. Please use `getSignature` instead."),k(e,g.base.stripHexPrefix(t))}s.signEvent=le;function k(e,t){return g.base.toHex(V.sign(B(e),g.base.stripHexPrefix(t)),!1)}s.getSignature=k});var X=_(i=>{l();y();var ye=i&&i.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),fe=i&&i.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),de=i&&i.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&ye(t,e,r);return fe(t,e),t};Object.defineProperty(i,"__esModule",{value:!0});i.NostrAssetsWallet=i.NewAddressError=i.CryptTextParams=i.nipOpType=void 0;var c=P(),L=m(),f=O(),h=de(Q()),W=R(),J=w(),D;(function(e){e[e.NIP04_Encrypt=1]="NIP04_Encrypt",e[e.NIP04_Decrypt=2]="NIP04_Decrypt"})(D=i.nipOpType||(i.nipOpType={}));var N=class{constructor(t,r,n){this.type=t,this.pubkey=r,this.text=n}};i.CryptTextParams=N;typeof h<"u"&&!h.subtle&&h.webcrypto&&(h.subtle=h.webcrypto.subtle);i.NewAddressError="generate address error";var T=class extends c.BaseWallet{async getDerivedPath(t){return`m/44'/1237'/${t.index}'/0/0`}getDerivedPrivateKey(t){return L.bip39.mnemonicToSeedV2(t.mnemonic).then(r=>{let n=L.bip32.fromSeedV2(r,t.hdPath);return n.privateKey?Promise.resolve((0,f.nsecFromPrvKey)(c.base.toHex(n.privateKey,!1))):Promise.reject(c.GenPrivateKeyError)}).catch(r=>Promise.reject(c.GenPrivateKeyError))}getRandomPrivateKey(){try{for(;;){let t=c.base.randomBytes(32);if((0,c.secp256k1SignTest)(t))return Promise.resolve((0,f.nsecFromPrvKey)(c.base.toHex(t,!1)))}}catch{}return Promise.reject(c.GenPrivateKeyError)}async getNewAddress(t){try{let[r,n]=c.base.fromBech32(t.privateKey);if(!(f.nsec==r))return Promise.reject("invalid privateKey");let p=(0,J.getPublicKey)(c.base.toHex(n,!1)),v={address:(0,f.npubEncode)(p),publicKey:p};return Promise.resolve(v)}catch(r){return Promise.reject(r)}}async validPrivateKey(t){let[r]=c.base.fromBech32(t.privateKey),a={isValid:f.nsec==r,privateKey:t.privateKey};return Promise.resolve(a)}async validAddress(t){var r=!1;try{let[a]=c.base.fromBech32(t.address);r=f.nostrHdp==a}catch(a){console.log(a)}let n={isValid:r,address:t.address};return Promise.resolve(n)}async signCommonMsg(t){let[,r]=c.base.fromBech32(t.privateKey);return super.signCommonMsg({privateKey:t.privateKey,privateKeyHex:c.base.toHex(r,!1),message:t.message,signType:c.SignType.Secp256k1})}async signTransaction(t){if(Object.prototype.toString.call(t.data)==="[object Object]"&&t.data.isCryptText){let r=t.data;switch(r.type){case D.NIP04_Decrypt:return(0,f.decrypt)(t.privateKey,r.pubkey,r.text);case D.NIP04_Encrypt:return(0,f.encrypt)(t.privateKey,r.pubkey,r.text);default:return Promise.reject(c.NotImplementedError)}}else try{let r=(0,f.decodeBytes)(f.nsec,t.privateKey),n=t.data;return n.pubkey||(n.pubkey=(0,J.getPublicKey)(r)),n.id||(n.id=(0,W.getEventHash)(n)),n.sig=(0,W.getSignature)(n,r),Promise.resolve(n)}catch(r){return Promise.reject(r)}}};i.NostrAssetsWallet=T});var be=_(d=>{l();y();var pe=d&&d.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),C=d&&d.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&pe(t,e,r)};Object.defineProperty(d,"__esModule",{value:!0});C(X(),d);C(O(),d);C(w(),d);C(R(),d)});export{be as a};
//# sourceMappingURL=chunk-Q5TBQGGM.js.map
