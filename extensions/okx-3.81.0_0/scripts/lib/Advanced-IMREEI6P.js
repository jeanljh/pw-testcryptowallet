import{a as Gs,b as Pe,c as Qs,d as Ys,e as js}from"./chunk-GE44DRQ2.js";import{a as Ks}from"./chunk-7T25FDKG.js";import{a as qs,c as Vs,h as Ws,k as wo}from"./chunk-WTOUIA45.js";import{i as Hs}from"./chunk-OJWZP4US.js";import{a as Lo,b as Oo}from"./chunk-63FXY6V3.js";import{a as z}from"./chunk-5UDVXFSD.js";import{a as Ss,b as Ts,e as Io,f as _o,g as Ao,h as Rs,i as Eo,j as Ro,k as Po,l as Bs,m as Us}from"./chunk-NNPQ7BFS.js";import{A as ko,F as Fs,p as _s,q as Co,r as As,s as Ut,t as pr,u as qt,v as Gt,w as bs}from"./chunk-5JUYNHHM.js";import{h as go,n as bo,o as Es,p as lt}from"./chunk-YAZIRKLK.js";import{a as at,c as ks}from"./chunk-3FSEKPUM.js";import{a as Et,b as Is,c as To,f as vt,g as Re}from"./chunk-UNX7SSQ5.js";import{c as vs,d as ys,i as mr,j as vo,k as Ds,o as yo,q as lr,r as yt}from"./chunk-7V2EB5SJ.js";import{a as So,b as us,c as ps,d as ye}from"./chunk-6PQVK4Y4.js";import"./chunk-X2ITVPF5.js";import{g as Ps,h as Ls,i as ws,l as Os,t as me,u as xs,v as Ms}from"./chunk-46D3AKOR.js";import{g as Ns}from"./chunk-4NIKWPAL.js";import"./chunk-B65FDDLM.js";import{b as N}from"./chunk-XDPVWBGA.js";import"./chunk-OGVTPJRM.js";import{a as gs}from"./chunk-CHJAVPER.js";import"./chunk-VN6CTHUI.js";import{a as as,c as cs,e as ve}from"./chunk-T2IRCTJA.js";import{b as ms,h as ls}from"./chunk-NDCJG34S.js";import"./chunk-XPWDQTID.js";import"./chunk-XSDSRNBQ.js";import{a as pe,b as k}from"./chunk-ALZVVIHH.js";import{K as B,L as R,O as bt,_ as is,f as Kn,n as ce,o as ts}from"./chunk-SPXYT2VO.js";import{D as ue,_ as rs,aa as ar,d as ir,l as ho,q as es,z as os}from"./chunk-7CFB2XTF.js";import"./chunk-BADVKNVD.js";import{C as fo,a as jn,d as xt,e as Mt,f as Bt,g as ns,h as Ee,i as cr,l as ur,z as ss}from"./chunk-FLUPYUSZ.js";import{H as te,I as P,J as ke,K as Zn,b as Yr,y as zo,z as Z}from"./chunk-UC2GDSBD.js";import"./chunk-RYV5MLCF.js";import{b as ds,f as hs,g as fs}from"./chunk-EGQ54WS5.js";import{e as Jn}from"./chunk-OE3Y2WW2.js";import{b as Vn,d as Dt,e as Wn,f as gt,g as Hn,h as Yn,i as be,j as lo,l as Xn,q as $n,r as zn,t as ie,u as Ft,w as ae}from"./chunk-PI6SXITR.js";import{$a as ln,B as v,C as re,Cb as $,D as ne,Db as Q,E as rn,G as Nt,H as Zo,Ia as rr,Jc as Nn,K as ao,Ka as cn,Kc as Dn,La as un,Lb as mo,Lc as Fn,M as G,Mb as x,N as ft,O as It,Pb as se,Q as tr,Qc as xn,R as nn,S as St,Sc as Mn,T as co,Ta as nr,Tc as Bn,Ua as pn,Va as _t,Wc as Un,X as er,Xc as qn,Y as q,Z as it,Za as mn,_c as Gn,a as Ze,ab as dn,b as to,c as Ie,cc as fn,d as eo,dc as Sn,e as oo,ec as gn,f as _e,fa as uo,fc as Tn,g as Jo,ga as mt,gc as Cn,h as ro,ha as po,hc as In,i as oe,ia as tt,ic as _n,id as Qn,j as Jr,ja as rt,jc as An,k as Ae,ka as sn,kc as kn,l as Zr,lc as bn,o as Y,p as no,q as j,qb as hn,qc as En,rb as sr,rc as vn,s as tn,sc as yn,t as M,tb as I,u as so,v as en,vc as Rn,vd as f,w as on,wa as or,wc as Pn,xa as an,xc as Ln,yc as wn,z as io,zc as On}from"./chunk-LZ43QKYM.js";import{a as E,b as Cs,c as U}from"./chunk-LLRT7ZCZ.js";import{a as _}from"./chunk-LH3J3TLH.js";import{H as y,T as Kr,U as ee,V as ze,W as jr,X as Xr,Y as $r,c as Ke,ca as Je,da as zr,e as je,ea as H,g as pt,h as At,i as kt,k as st,l as Xe,m as O,n as ht,o as $e}from"./chunk-XEVJKE53.js";import"./chunk-2TP4LTGZ.js";import"./chunk-FA47DEF6.js";import"./chunk-AOCKZLRR.js";import"./chunk-NHQL3RON.js";import"./chunk-AUVAPXJK.js";import"./chunk-UCYWIXHR.js";import"./chunk-25RXMKCK.js";import"./chunk-YS3HYG35.js";import"./chunk-GVNSNU7P.js";import"./chunk-N3AWCE75.js";import"./chunk-MVO3PFGF.js";import"./chunk-DKCWR6P4.js";import{A as qr,F as Zt,H as Gr,J as Qr,K as Vr,L as He,M as Ye,R as Xo,T as $o,V as Wr,Y as Ce,_ as L,c as J,f as nt,h as Ct,i as jo,j as S,n as Mr,q as Br,r as We,w as Ur,y as ot}from"./chunk-NLHAZXT3.js";import"./chunk-Z7O2BQPT.js";import"./chunk-RRVELJ3L.js";import"./chunk-MWBMNCFR.js";import"./chunk-J5HV5RZ5.js";import"./chunk-JXDUUE4S.js";import"./chunk-Y5NME4BP.js";import"./chunk-T7EATGE4.js";import{y as Ot}from"./chunk-YP7AL7GO.js";import"./chunk-VYWNZTTM.js";import{q as Hr}from"./chunk-33JFC56H.js";import{a as na}from"./chunk-6N5VE5LT.js";import{a as W}from"./chunk-6YOUVTKE.js";import"./chunk-AEGO4G2O.js";import"./chunk-GQPYV2B4.js";import"./chunk-7BSXWXHJ.js";import"./chunk-YN3RVC5F.js";import"./chunk-RZ6UTWVB.js";import"./chunk-KW3KLDWA.js";import"./chunk-M7JGFMJS.js";import{f as D,h as n,o as p,q as m}from"./chunk-4J7XGGEQ.js";p();m();var Ko=D(W()),ra=D(te());p();m();var $s=D(W());p();m();var No=D(W());var Xs=({children:a,rootStore:t})=>{let e=Cs(t),o=(0,No.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return No.default.createElement(e.Provider,{value:o},a)};var zs=ht(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),s=o||r,i=a.getInstance();return s===x.BRIDGE&&(i=t.getInstance()),$s.default.createElement(Xs,{rootStore:i},e)});p();m();var Fo=D(W());p();m();p();m();var Le=D(W()),Js=D(te());var sa=()=>{let a=P.get(nr);if(a){if(P.remove(nr),a.startsWith(jr))return _t.MEME_BUY;if(a.startsWith(rt))return _t.BRIDGE;if(a.startsWith(tt))return _t.SWAP}return P.get(pn)||_t.SWAP},ia=a=>({[_t.SWAP]:tt,[_t.BRIDGE]:rt,[_t.MEME_BUY]:Xr,[_t.MEME_SELL]:$r})[a]||tt,aa=a=>{switch(a){case po:case tt:return x.SWAP;case rt:return x.BRIDGE;default:return""}},Zs=()=>{let{pathname:a}=(0,Js.useLocation)(),{params:t,replace:e}=me(),{autoSwitch:o,from:r}=t,[s,i]=(0,Le.useState)(""),[c,u]=(0,Le.useState)(!0);return(0,Le.useEffect)(()=>{let l=sa(),d=ia(l);if(o===lr.BRIDGE&&!r.tokenContractAddress&&d!==a){e({pathname:d,params:{...t,autoSwitch:void 0}});return}let h=aa(a);h&&(async()=>{if(h===x.SWAP&&o===lr.BRIDGE){let A=await yt.judgeTabTypeByParams(t?.from,t?.to);A===x.BRIDGE&&e({pathname:rt,params:{...t,autoSwitch:void 0}}),i(A),u(!1)}else i(h),u(!1)})().catch(()=>{})},[a,o,r]),{tabType:s,autoSwitching:c}};p();m();var dr=D(W());var ti=(a,t)=>{let{accountStore:e}=U(),{params:o}=me(),{addressType:r}=o;(0,dr.useEffect)(()=>{e.setAddressType(r)},[]);let s=xs();(0,dr.useEffect)(()=>{async function i(){let c=new yt(a,o),{from:u,to:l,tab:d,inputAmount:h,error:C}=await c.initTokenPair(t);C||s(u,l,h,d)}a&&i().catch(()=>{})},[a])};p();m();var ei=D(W()),oi=D(te());var ri=a=>{let{fromToStore:t}=U(),{from:e,to:o}=t,{params:r,replace:s}=me(),{pathname:i}=(0,oi.useLocation)(),c=Ms();(0,ei.useEffect)(()=>{let u=c(e,o);u&&a&&[tt,rt].includes(i)&&(new yt(a).writeTabInfoToLocalStorage(u),s({params:{...u,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,i])};var ca=a=>{let{tabType:t}=Zs();ti(t,a),ri(t)},ni=ca;p();m();var ii=D(W());p();m();function ua(a){return new Promise(t=>setTimeout(t,a))}async function le(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(s){o=s,e&&r<t-1&&await ua(e)}throw o}function pa(a,t,e){let o=bt();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function ma(a,t,e){if(mt())return pa(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort(),abortController:o}}function si(a,t){return ma(k.get,a,t)}function ai(){let{accountStore:a,receiveAddressStore:t}=U(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:s}=t,{specifiedAddress:i}=r||{};(0,ii.useEffect)(()=>{let c=()=>{};if(e&&s){let{promise:u,cancel:l}=si(xn,{params:{userWalletAddress:e,receiveWalletAddress:i}});c=l,u.then(d=>{o(d?.data.blackListTypes||ao)}).catch(()=>{o(ao)})}else o(ao);return c},[e,o,i,s])}p();m();var ci=D(W());function hr(){let{accountStore:{address:a}}=U();(0,ci.useEffect)(()=>{R.setTags({address:a})},[a])}p();m();var fr=D(W());L();var la=()=>{let{quoteStore:a,accountStore:t,fromToStore:e,approveStore:o,recentTransactionStore:r,tokenModalStore:s}=U(),{computedAccountWalletAddresses:i}=t;(0,fr.useEffect)(()=>{let c=()=>{};return i&&(c=us(i)),()=>{c?.()}},[i]),(0,fr.useEffect)(()=>{let c=So({isPri:!0,needLogin:!0,subscribeParams:[{channel:ye.DEX_PUSH_ENGINE},{channel:ye.WALLET_ASSET}],onListenError:()=>{let u=S(a,"quote.bestRoute"),l={token:e.from,defiPlatformId:z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,u),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{a.fetchQuote()}};o.onSocketError(l),r.onSocketError(),e.setNeedBalanceLoading(!1),e.getSwapTokenBalance(),s.reloadTokenList()},onListenData:(u,l)=>{if(!!u){if(l?.channel===ye.DEX_PUSH_ENGINE){r.onSocket(u);let d=S(a,"quote.bestRoute"),h={token:e.from,defiPlatformId:z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,d),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{a.fetchQuote()}};o.onSocket({data:u,...h});return}l.channel===ye.WALLET_ASSET&&(s.updateAllTokenList(u),e.updateFromBalancePush(u))}}});return()=>{c?.()}},[r.onSocket,s.updateAllTokenList,e.updateFromBalancePush,t,a,r,s,e])},ui=la;p();m();var Sr=D(W());L();var pi=({token:a,onListenData:t=nt,globalPrice:e})=>{(0,Sr.useEffect)(()=>{!Ft(a)||ve(a,e)&&t(e)},[e,a?.chainId,a?.tokenContractAddress]),(0,Sr.useEffect)(()=>{if(!Ft(a))return nt;if(ve(a,e))return nt;let o=So({subscribeParams:{channel:ps.DEX_MARKET_TX_CHANNEL,chainId:String(a.chainId),tokenAddress:a.tokenContractAddress},onListenData:r=>{t(r?.[0]||{})},onListenError:nt});return()=>{o()}},[a?.chainId,a?.tokenContractAddress])},da=()=>{let{fromToStore:a={},commonMarketStore:t={}}=U(),{from:e,updateFromUsdPriceFromWs:o,to:r,updateToUsdPriceFromWs:s}=a,{globalPrice:i}=t;pi({token:e,onListenData:o,globalPrice:i}),pi({token:r,onListenData:s,globalPrice:i})},mi=da;p();m();var Rt=D(W()),li=D(te());Kn.setDataProxy(k);var ha=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:s,t:i,dispatch:c,currentTab:u,onBack:l})=>{let{commonStore:d,accountStore:h,recentTransactionStore:C,reset:A}=U(),b=(0,li.useHistory)();(0,Rt.useEffect)(()=>{H.setRuntimeContext({history:b,toLocale:i,dispatch:c,walletInfo:e,onBack:l})},[i,b,c,e,l]),(0,Rt.useEffect)(()=>(t&&(H.updateGlobal({currentWallet:t}),h.setWalletConfig(t)),()=>{h.cleanWalletConfig()}),[t]),(0,Rt.useEffect)(()=>(d.getUserUnit(a),d.fetchChainList({businessLine:1,currentTab:u}).catch(()=>{d.setChainListLoadError(!0)}),()=>{A()}),[]),(0,Rt.useEffect)(()=>{h.setAddressBookList(r)},[r]),(0,Rt.useEffect)(()=>{h.setWalletList(s)},[s]),(0,Rt.useEffect)(()=>{h.setKeyringIdentityTypeEnum(o)},[o]),(0,Rt.useEffect)(()=>{t.walletId?C.updatePendingOrders(t.walletId):C.setPendingOrders([])},[t.walletId,u]),qs()},di=ha;p();m();var X=D(W()),Pt=D(te());p();m();var de=D(W()),Do=D(te()),Ti=D(na());p();m();var hi=D(W());var fa=()=>{let{fromToStore:a}=U(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return hi.default.createElement(Gs,{visible:t,params:e,onBack:()=>{o()}})},fi=ht(fa);p();m();var Si=D(W());var gi=()=>{let{fromToStore:a}=U(),{closeAddFunds:t}=a;(0,Si.useEffect)(()=>{t()},[])};var Sa=[tt,rt],ga=({children:a,onBack:t})=>{let{showNavigator:e,title:o}=Qs(),r=(0,Do.useLocation)(),s=(0,Do.useHistory)(),{isTelegramMiniApp:i}=H.global,{Navigator:c}=H.components,u=r.pathname.includes(ee);gi();let l=()=>{u&&ue({...lt(),button_name:"back"}),t?t(s.goBack,Sa.includes(r.pathname)):s.goBack()},d=()=>i?Pe.telegramContainer:e?Pe.extensionContainer:Pe.extensionContainerNoHeader,{recentTransactionStore:h}=U(),{dialogVisible:C,dialogOrderId:A,closeDialog:b}=h;return de.default.createElement("div",{className:(0,Ti.default)("universe-swap background-base-primary",Pe.wrapper)},e?de.default.createElement(c,{asPage:!0,title:o,onBack:l,closeable:!1}):null,de.default.createElement("div",{className:d()},a),de.default.createElement(fi,null),de.default.createElement(Us,{orderId:A,visible:C,onClose:b}))},Ci=ht(ga);var Ta=(0,X.lazy)(()=>import("./Swap-DVYQT4SL.js")),Ca=(0,X.lazy)(()=>import("./Bridge-4YYPDLG4.js")),Ia=(0,X.lazy)(()=>import("./OrderDetail-TVNHYGOM.js")),_a=(0,X.lazy)(()=>import("./Contract-2F2CYIVQ.js")),Aa=(0,X.lazy)(()=>import("./Approve-42U5SB6D.js")),ka=(0,X.lazy)(()=>import("./Solana-2DEVTRMD.js")),ba=(0,X.lazy)(()=>import("./Claim-RFJHPN2W.js")),Ea=({onBack:a})=>{let t=(0,Pt.useLocation)();return X.default.createElement(Ci,{onBack:a},X.default.createElement(X.Suspense,null,X.default.createElement(Pt.Switch,null,[{path:tt,component:Ta,exact:!0},{path:rt,component:Ca,exact:!0},{path:Kr,component:Ia,exact:!0},{path:ee,component:_a,exact:!0},{path:ze,component:Aa,exact:!0},{path:Je,component:ka,exact:!0},{path:zr,component:ba,exact:!0}].map((o,r)=>X.default.createElement(Pt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),X.default.createElement(Pt.Redirect,{from:po,to:{pathname:tt,search:t.search},strict:!0,exact:!0}))))},Ii=Ea;var va=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:s,onBack:i,t:c,dispatch:u,currentTab:l=x.SWAP})=>{ni(s.chainId),di({currency:a,currentWallet:t,walletInfo:s,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:u,currentTab:l,onBack:i}),ai(),ui(),hr(),mi();let{initialized:d}=Fs();return d?Fo.default.createElement(Ii,{onBack:i}):null},_i=(0,Fo.memo)(ht(va));p();m();p();m();p();m();var we=class{constructor(){this.isSwapLoading=!1;this.setSwapLoading=t=>{this.isSwapLoading=t};this.checkCancelLimitOrder=async()=>{};O(this)}};p();m();L();var Oe=class{constructor(t){n(this,"checkTokenValid",async t=>{if(!Ft(t))return!1;let[e,o]=await y(k.get(Gn,{params:He(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,O(this,{},{autoBind:!0})}};var Qt=class{constructor(){Qt.instance?(this.commonStore=Qt.instance.commonStore,this.accountStore=Qt.instance.accountStore,this.checkTokenStore=Qt.instance.checkTokenStore,this.limitOrderConfirmStore=new we(this)):(this.commonStore=new bs(this),this.accountStore=new As(this),this.checkTokenStore=new Oe(this),this.limitOrderConfirmStore=new we(this),Qt.instance=this)}},Vt=Qt;n(Vt,"instance",null);p();m();L();p();m();L();p();m();var xo="NO_CHECK",Lt="0",Yp="0x".padEnd(66,"f");var gr=class{constructor(){this.approveTokenDefaultConfig={status:v.Unknown,approvedAmount:Lt,tagStatus:v.Unknown,successCallback:void 0,isCombineApproveAndSwap:!1,transactionHash:void 0,approveInfo:null};this.approveTokensConfig={};this.bridgeApproveSocketError=!1;this.getApproveTokenMapKey=(t,e)=>{let o=cs(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=S(this.approveTokensConfig,o);ot(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),s=S(this.approveTokensConfig,r),i=ot(s),c=s||this.approveTokenDefaultConfig;this.approveTokensConfig={...this.approveTokensConfig,[r]:{...c,...o}},i&&R.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return S(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=Qr(this.approveTokensConfig,e=>[v.Approving,v.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.getApprovalStatus=(t,e)=>this.getApproveTokenConfig(t,e).status;this.isApprovalCheckRequired=(t,e,o)=>{let{isNativeToken:r}=t;return(e?!0:o==="1")&&!r&&!hs(t.chainId)&&!fs(t.chainId)};this.validApproveAmountLessSwapAmount=(t,e)=>new _.BigNumber(t).isLessThan(e||Lt);this.isValidApprovalStatus=(t,e,o)=>{let r=Vn(t),s=this.validApproveAmountLessSwapAmount(t,e);return r?v.UnApproved:s&&o?v.CancelApprove:s?v.UnApproved:v.Approved};this.fetchApproveAllowance=async(t,e,o,r,s,i)=>{let c=()=>k.get(Rn,{params:{userWalletAddress:e,tokenContractAddress:t.tokenContractAddress,chainId:t.chainId,defiPlatformIds:o}}).then(d=>d?.data),u=await c();return r&&u&&typeof u=="object"&&Object.keys(u).length>0&&Object.values(u).every(d=>d?.amount===Lt)?(R.info(B.APPROVE_RETRY,{approveEventType:i,fromAmount:t.amount,defiPlatformId:s,isCrossChain:!1}),c()):u};this.getApproveUrl=t=>t?{approveDataUrl:Ln,saveApproveUrl:On}:{approveDataUrl:Pn,saveApproveUrl:wn};this.parseApproveTxInfo=({approveTxInfo:t,params:e})=>{let{isCrossChain:o,...r}=e,{id:s,data:i,from:c,to:u,unsignedTx:l,gas:d,gasPrice:h,maxFeePerGas:C,maxPriorityFeePerGas:A,type:b,nonce:F}=t||{},w={data:i,from:c,to:u};e.teeSilentSignEnabled&&(w={...w,gas:d,gasPrice:h,maxFeePerGas:C,maxPriorityFeePerGas:A,type:b,nonce:F},w=Ts(w));let V={txSource:3};return ds(e.chainId)&&(w=JSON.parse(l),Ye(V,"orderId",s)),o&&Ye(w,"extParams",V),R.info(B.APPROVE_DATA,{id:s,transactionPayload:w,unsignedTx:l,cancelApproveTag:r.cancelApproveTag}),{transactionPayload:w,id:s,defiPlatformId:r.defiPlatformId}};this.fetchApproveData=({approveDataUrl:t,params:e,approveTxInfo:o})=>{if(o)return this.parseApproveTxInfo({approveTxInfo:o,params:e});let{isCrossChain:r,...s}=e;return k.get(t,{params:s}).then(i=>this.parseApproveTxInfo({approveTxInfo:i?.data,params:e}))};this.isApprovalStatusPending=(t,e)=>{let o=this.getApprovalStatus(t,e);return[v.Approving,v.CancelApproving].includes(o)};this.isCancelApproveStatus=(t,e)=>{let o=this.getApprovalStatus(t,e);return[v.CancelApprove,v.CancelApproving].includes(o)};this.isPendingNeedCheck=async t=>{this.isApprovalStatusPending(t.token,t.defiPlatformId)&&this.checkApprove({...t,needRetry:!0}).catch(()=>{})};this.isPendingNotCheck=async t=>{this.isApprovalStatusPending(t.token,t.defiPlatformId)||this.checkApprove({...t,needCheck:xo}).catch(()=>{})};this.bridgePendingNotCheck=async t=>{(!this.isApprovalStatusPending(t.token,t.defiPlatformId)||this.bridgeApproveSocketError)&&(await this.checkApprove({...t,isCrossChain:!0,needCheck:xo}),this.bridgeApproveSocketError=!1)};this.updateUnnecessaryApproveTokenStatus=(t,e)=>{e.forEach(o=>{this.registerApproveToken(t,o),this.updateApproveTokenConfig(t,o,{status:v.Approved,tagStatus:v.UnApproved})})};this.updateApproveConfigByAllowance=({allowanceData:t,token:e,defiPlatformId:o,needCheck:r})=>{if(!t||ot(t)){this.updateApproveTokenConfig(e,o,{status:v.Unknown,approvedAmount:Lt,tagStatus:v.Unknown});return}r===xo&&this.isApprovalStatusPending(e,o)||Object.keys(t).forEach(s=>{let i=t[s];this.calcApproveState({approveInfo:i,token:e,defiPlatformId:s})})};this.checkApprove=async({token:t,userWalletAddress:e,needApprove:o,defiPlatformIds:r,defiPlatformId:s,allowanceData:i={},needCheck:c="",isLimitOrder:u=!1,isCrossChain:l=!1,needRetry:d=!1,approveEventType:h})=>{if(!this.isApprovalCheckRequired(t,u,o)){this.updateUnnecessaryApproveTokenStatus(t,r);return}let{tokenContractAddress:C}=t;if(C&&e){if(!l){let[,A]=await y(this.fetchApproveAllowance(t,e,r,d,s,h));this.updateApproveConfigByAllowance({allowanceData:A,token:t,defiPlatformId:s,needCheck:c});return}this.updateApproveConfigByAllowance({allowanceData:i,token:t,defiPlatformId:s,needCheck:c})}};this.calcApproveState=({approveInfo:t,token:e,defiPlatformId:o})=>{let{decimals:r}=e,s=Number(t.status);if([v.Approving,v.CancelApprove].includes(s))return;let i=Number(t.status)===v.Approved?t.amount:Lt,c=lo(i,r)||Lt,u=t?.needCancelApproveToken,l=this.isValidApprovalStatus(c,e.amount||Lt,u);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:l,tagStatus:l,approvedAmount:c,approveInfo:t})};this.updateApproveState=({token:t,defiPlatformId:e,userWalletAddress:o,needApprove:r="1"})=>{if(!Ft(t))return;let s=this.getApproveTokenConfig(t,e);s?.approveInfo?this.calcApproveState({approveInfo:s?.approveInfo,token:t,defiPlatformId:e}):this.isPendingNotCheck({token:t,userWalletAddress:o,defiPlatformId:e,needApprove:r})};this.fetchApproveDataErrorTips=(t,e,o)=>{this.updateApproveTokenConfig(t,e,{status:v.UnApproved});let r=N(t?.tokenSymbol);vo({title:o?f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:r}):f("swaptrade_toast_approve_fail",{tokenSymbol:r})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,defiPlatformId:s,cancelApproveTag:i})=>{R.error(B.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,defiPlatformId:s}),Ss(t)||zo.error({title:f("swaptrade_home_toast_broadcast_failed"),placement:zo.DIRECTION.top}),this.updateApproveTokenConfig(r,s,{status:this.isCancelApprove(i)?v.CancelApprove:v.UnApproved})};this.isCancelApprove=t=>t===re.CANCEL_APPROVE;this.setApprove=async({token:t,userWalletAddress:e,defiPlatformId:o,isCrossChain:r=!1,cancelApproveTag:s,approveAmount:i,approveTxInfo:c},{isSilentSign:u=!1,isCombineApproveAndSwap:l=!1,successCallback:d}={isSilentSign:!1})=>{let{chainId:h}=t;this.updateApproveTokenConfig(t,o,{status:this.isCancelApprove(s)?v.CancelApproving:v.Approving,isCombineApproveAndSwap:l,successCallback:d});try{let C={isCrossChain:r,userWalletAddress:e,tokenContractAddress:t.tokenContractAddress,chainId:t.chainId,defiPlatformId:o,cancelApproveTag:s,teeSilentSignEnabled:u};u&&!l&&(C.approveAmount=i);let{id:A,transactionPayload:b,defiPlatformId:F}=await this.fetchApproveData({approveTxInfo:c,approveDataUrl:this.getApproveUrl(r).approveDataUrl,params:C});await this.approveToken({chainId:h,transactionPayload:b},{isSilentSign:u}).then(async({result:w})=>{this.updateApproveTokenConfig(t,o,{transactionHash:w}),await this.saveApprove({id:A,chainId:h,transactionHash:w,userWalletAddress:e,isCrossChain:r,cancelApproveTag:s,defiPlatformId:F})}).catch(w=>{this.approveErrorTips({error:w,chainId:h,transactionPayload:b,token:t,defiPlatformId:F,cancelApproveTag:s})})}catch{this.fetchApproveDataErrorTips(t,o,s)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,userWalletAddress:r,isCrossChain:s,cancelApproveTag:i,defiPlatformId:c,refetchQuote:u})=>{if(!o)return;let l={id:t,transactionHash:o,chainId:e,userWalletAddress:r,cancelApproveTag:i};s&&Ye(l,"defiPlatformId",c),R.info(B.SAVE_APPROVE,l);let{saveApproveUrl:d}=this.getApproveUrl(s),[h]=await y(k.post(d,l));h&&R.info(B.SAVE_APPROVE_ERROR,{error:h?.message,...l}),s&&String(c)!==q&&u?.()};this.checkCurrentPushedApproveInfo=(t,e,o,r,s)=>{let{chainId:i,fromTokenAddress:c,platformId:u,defiPlatformId:l}=t,d=r?l:u,h={chainId:Number(i),tokenContractAddress:c},C=ve(e,h),A=String(o)===String(d),b=t.transactionHash===s;return{isCurrentToken:C,isSamePlatform:A,isSameTransactionHash:b,pushedToken:h,pushedPlatformId:d}};this.handleCurrentPushedApproveToken=async({dexData:t,pushedPlatformId:e,token:o,isCrossChain:r,refetchQuote:s,userWalletAddress:i,needApprove:c,approveEventType:u})=>{if(!r)await this.isPendingNeedCheck({token:o,userWalletAddress:i,defiPlatformIds:[e],defiPlatformId:e,needApprove:c,approveEventType:u});else{let l={status:t.status,amount:t.approveAmount,needCancelApproveToken:t.needCancelApproveToken};this.calcApproveState({approveInfo:l,token:o,defiPlatformId:e}),s?.()}};this.onSocket=async({data:t,token:e,defiPlatformId:o,isCrossChain:r,refetchQuote:s},i)=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let c=t.dexData,{status:u,transactionHash:l,fromTokenSymbol:d,exploreUrl:h,solanaToast:C,userWalletAddress:A}=c,b=mt(),{isCombineApproveAndSwap:F,successCallback:w,transactionHash:V}=this.getApproveTokenConfig(e,o),{isCurrentToken:et,isSamePlatform:Tt,isSameTransactionHash:ct,pushedToken:ut,pushedPlatformId:ge}=this.checkCurrentPushedApproveInfo(c,e,o,r,V);if(C==="1"){if(b)return;let K=ct&&F?"swaptrade_mid_dialog_toast_success_submitted":"swaptrade_transfer_notification_approval_submit";u===ne.CANCEL_APPROVE_SUBMITTED&&(K="swaptrade_transfer_toast_ccy_unrevoke_submit"),Ds({title:f(K,{ccy:N(d)})});return}if(et&&Tt&&(R.info(B.APPROVE_SOCKET_SUCCESS,{fromAmount:e.amount,defiPlatformId:o,status:c.status,amount:c.approveAmount,needCancelApproveToken:c.needCancelApproveToken,isCrossChain:r}),await this.handleCurrentPushedApproveToken({dexData:c,pushedPlatformId:ge,token:e,isCrossChain:r,userWalletAddress:A,refetchQuote:s,needApprove:"1",approveEventType:"onSocket"})),(!et||et&&!Tt)&&this.removeApproveTokenConfig(ut,ge),u===ne.APPROVE_SUCCESS){let K=f("swaptrade_toast_approve_success",{tokenSymbol:N(d)});!b&&mr({title:K,exploreUrl:h}),ys.emit(vs.APPROVE,{data:l,status:0,message:K}),ct&&w?await w():i?.()}else if(u===ne.APPROVE_FAILED&&!b){let K=f("swaptrade_toast_approve_fail",{tokenSymbol:N(d)});vo({title:K,exploreUrl:h})}else if(u===ne.CANCEL_APPROVE_SUCCESS&&!b){let K=f("swaptrade_transfer_notification_title_ccy_revoked",{ccy:N(d)});ct&&w&&await w(),mr({title:K,exploreUrl:h})}else if(u===ne.CANCEL_APPROVE_FAILED&&!b){let K=f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:N(d)});vo({title:K,exploreUrl:h})}}};this.onSocketError=t=>{t.isCrossChain?this.bridgeApproveSocketError=!0:this.isPendingNeedCheck(t).catch(()=>{})}}approveToken(t,{isSilentSign:e}={isSilentSign:!1}){return Promise.resolve(t)}},Ai=gr;var Wt=class extends Ai{constructor(e){super(e);n(this,"approveInfo",{});n(this,"setApproveInfo",e=>{this.approveInfo=e});n(this,"setApprove",async(e=re.APPROVE)=>{let{fromToStore:o,quoteStore:r,accountStore:s}=this.rootStore,i=S(r,"quote.bestRoute"),c=z.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,i),u=o.from,{chainId:l,tokenContractAddress:d}=u,h=s.getAddressByChainId(l);this.updateApproveTokenConfig(u,c,{status:this.isCancelApprove(e)?v.CancelApproving:v.Approving});try{let{id:C,transactionPayload:A}=await this.fetchApproveData({approveDataUrl:this.getApproveUrl(o.computedIsCrossChain).approveDataUrl,params:{userWalletAddress:h,tokenContractAddress:d,chainId:l,defiPlatformId:c,cancelApproveTag:e}});this.setApproveInfo({chainId:l,id:C,transactionPayload:A,token:u,defiPlatformId:c,cancelApproveTag:e}),H.history?.push({pathname:ze})}catch{this.fetchApproveDataErrorTips(u,c,e)}});n(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),H.history?.goBack?.();let{fromToStore:o,quoteStore:r}=this.rootStore,s=S(r,"quote.bestRoute"),i=z.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,s),c=o.from;this.updateApproveTokenConfig(c,i,{status:this.isCancelApprove(e)?v.CancelApprove:v.UnApproved})});n(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{fromToStore:r,accountStore:s,quoteStore:i}=this.rootStore,{id:c,chainId:u,cancelApproveTag:l,defiPlatformId:d}=this.approveInfo;await this.saveApprove({id:c,chainId:u,transactionHash:e,userWalletAddress:s.getAddressByChainId(u),cancelApproveTag:l,defiPlatformId:d,isCrossChain:r.computedIsCrossChain,refetchQuote:()=>{i.fetchQuote()}}),H.history?.goBack?.(),this.setApproveInfo({})});at(this),this.rootStore=e}};p();m();L();p();m();var De=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:s}=E(),{from:i,to:c}=a,{receiveAddrObj:u}=e,{computedForbiddenBridge:l,address:d}=s,h=a.computedTypedValue&&a.computedTypedValue.endsWith(".")?a.computedTypedValue.slice(0,-1):a.computedTypedValue,A={...{chainId:i.chainId,toChainId:c.chainId,toTokenAddress:c.tokenContractAddress,fromTokenAddress:i.tokenContractAddress,amount:h,userWalletAddress:d},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:ae(l),dexIds:ae(bo?.computedDexIds),receiveWalletAddress:u?.specifiedAddress};return ce()?A:o.extendFeeConfig(A)},wt=async()=>{let{fromToStore:a,accountStore:t}=E(),{from:e}=a,{computedSignWalletAddress:o}=t,r=await is(o,e.chainId);return{...De(),refCode:Hs.refCode,...r}},ki=()=>{let{quoteStore:a}=E();return{...De(),sort:a.bridgeSortType}},bi=()=>{let{quoteStore:a}=E(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:c,fromTokenAddress:u,toTokenAddress:l,amount:d}=De();return{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:c,fromTokenAddress:u,toTokenAddress:l,amount:d,bridgeId:e}};p();m();function ya({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var Mo=ya;var Ei=20,dt={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},Tr=class{constructor(t){n(this,"quoteData",null);n(this,"preDataForSendBtc",null);n(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});n(this,"setQuoteData",t=>{this.quoteData=t});n(this,"quoteParams",async()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,s={...await wt(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(s.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),s});n(this,"updating",!1);n(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let s={...await wt(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},i=await e.extendSignParams(s),[c,u]=await y(k.post(`${Fn}`,i));if(this.updating=!1,Mo({selector:"#wallet_scroll"}),c){Z.error({title:c?.data?.msg||f("swaptrade_top_notif_data_failed")});return}let{callDataResult:l,quoteResult:d}=u?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:d}),l){let h=await this.getPreExecutionPayload({orderData:l,requestParams:i});pt(()=>{this.transactionPayload=h,this.orderId=l?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=bi();this.updating=!0;let[e,o]=await y(k.get(Un,{params:{...t}}));if(this.updating=!1,Mo({selector:"#wallet_scroll"}),e){Z.error({title:e?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"updateSnapQuoteData",async()=>{let t=await wt(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await y(k.get(Mn,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,Mo({selector:"#wallet_scroll"}),o){Z.error({title:o?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:s}=r?.data||{};s&&this.rootStore.quoteStore.handleUpdateQuote({data:s}),this.initCountDown(),this.startCountdown()});n(this,"timer",null);n(this,"countdown",Ei);n(this,"initCountDown",()=>{this.countdown=Ei});n(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});n(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});n(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));n(this,"gasInfo",this.initGasInfo());n(this,"setGasInfo",t=>{this.gasInfo=t});n(this,"gasFee",0);n(this,"setGasFee",t=>{this.gasFee=t});n(this,"orderInfo",{});n(this,"transactionPayload",null);n(this,"orderId","");n(this,"solonaRent","");n(this,"getPreExecutionPayload",async({orderData:t,isSwapSolana:e,requestParams:o})=>{let{swapStore:r,quoteStore:s,fromToStore:i}=this.rootStore;r?.checkCallData?.({chainId:o?.chainId,responseData:t,isSingleChain:!0,requestParams:o}).catch(()=>{});let c=s?.quote?.bestRoute||{},{fromToken:u}=c,{computedIsSingleChain:l}=i,d=Rs(u,{orderData:t},r);if(e){let b=await d.jitoTransaction();return this.solonaRent=ls(b),b}let h=l&&go.supportCustomGasFee,{payload:C,rent:A}=await d.preExecution({needGasPrice:h});return u.chainId===sr.SOLANA_MAINNET&&A&&(this.solonaRent=A),C});n(this,"setTransactionPayload",t=>{this.transactionPayload=t});n(this,"solanaSwapTransactionData",null);n(this,"setSolanaSwapTransactionData",t=>{this.solanaSwapTransactionData=t});n(this,"handleSolanaOfflineData",async t=>{let{offlineType:e,calldata:o,defiPlatformId:r}=t,{unsignedTx:s,quote:i}=o||{},c=await ms(s);this.solanaSwapTransactionData={transaction:c,offlineType:e,defiPlatformId:r,quote:i}});n(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=await t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),s,i,c=null;if(r){let l=t.extendSolanaCalldata(o);c=l,[s,i]=await t.getSolanaCalldata(l)}else[s,i]=await y(k.post(Dn,o));if(s){let l=s?.error_message;return Z.error({title:l||f("swaptrade_top_notif_data_failed")}),!0}let u=await this.getPreExecutionPayload({orderData:i?.data||{},isSwapSolana:r,requestParams:c});return this.transactionPayload=u,this.orderId=i?.data?.orderId||"",!1});n(this,"preExecutionResult",{});n(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});n(this,"nativeCoin",null);n(this,"setNativeCoin",t=>{this.nativeCoin={...t}});n(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return _.BigNumber(r?o.availableBalance:lo(t,e))});n(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===St.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=_.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?_.BigNumber(t.amount).plus(e):_.BigNumber(e)});n(this,"gasFeeLoading",!0);n(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});n(this,"gasLimitError",null);n(this,"setGasLimitError",t=>{this.gasLimitError=t});n(this,"maxGasFeeInt","");n(this,"setMaxGasFeeInt",t=>{this.maxGasFeeInt=t});n(this,"activityId",null);n(this,"setActivityId",t=>{this.activityId=t});n(this,"type",St.SWAP);n(this,"setSwapType",t=>{this.type=t});n(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.orderId="",this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(St.SWAP),this.clearTimer(),this.solonaRent=""});n(this,"starknetRegisterStatus","");n(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});n(this,"visibleStarknetRegister",!1);n(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});n(this,"onSwap",()=>{ue({...lt(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});n(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});n(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});n(this,"confirmSwapMap",{[St.SWAP]:this.onSwap,[St.REDEEM]:this.onRedeem,[St.INTENT_SWAP]:this.onIntentSwap});n(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});n(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:s}=this.nativeCoin||{};return{[dt.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},btnText:f("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[dt.UPDATE]:{onClick:()=>{ue({...lt(),button_name:"update"}),this.updateQuoteData().catch(nt)},btnText:f("swaptrade_confirmswap_btn_update_price")},[dt.SNAP_UPDATE]:{onClick:()=>{ue({...lt(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(nt):this.updateSnapQuoteData().catch(nt)},btnText:f("swaptrade_confirmswap_btn_update_price")},[dt.FILL_UP]:{onClick:()=>{ar({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:s,receiveOnly:!1})},btnText:f("swaptrade_dialog_btn_supplement",{token:o})},[dt.CANCEL]:{onClick:()=>{ar({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:c}=H;c?.goBack()},btnText:f("swaptrade_top_btn_cancel")},default:{}}[t]});O(this),this.rootStore=t}get computedFormatTime(){return zn(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==sr.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),s=this.calcNativeCoinAmountChange();return r.gte(s.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=H;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=H.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let s=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?s:s||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(dt.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(dt.CANCEL)}get computedTipsBtnProps(){let t=dt.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=dt.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?dt.SNAP_UPDATE:dt.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},Bo=Tr;p();m();L();p();m();var Cr=class{constructor(t){n(this,"signIntentSwap",async()=>[]);n(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId,tradeMode:Os.SWAP},[o,r]=await y(k.post(Bn,{...e}));return o&&(R.error(B.INTENT_ORDER_CREATE_ERROR,{error:o}),Z.error({title:o?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),ir({...lt(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});n(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:s,accountStore:i}=this.rootStore,{quote:c,computedQuoteAmount:u}=o,{from:l,to:d}=s,{computedRealSlippageValue:h}=e,C=r?.receiveAddrObj?.specifiedAddress,A=h,b=c?.bestRoute?.bridge?.bridgeId,F=i?.address,w={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:C,fromChainId:l?.chainId,fromTokenAddress:l?.tokenContractAddress,fromAmount:u,toChainId:d.chainId,toTokenAddress:d.tokenContractAddress,toAmount:d.reverseReceiveAmount,walletAddress:F,bridgeId:b,minimumReceived:c?.bestRoute?.minimumReceived,slippage:A},[V,et]=await y(k.post(qn,{...w}));return V&&(R.error(B.INTENT_ORDER_CREATE_ERROR,{error:V}),Z.error({title:V?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),ir({...lt(),order_id:et?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[V,et]});this.rootStore=t}},vi=Cr;p();m();var yi=Co(["isConfirmLoading"],[]);var Ir=class extends vi{constructor(e){super(e);n(this,"isConfirmLoading",!1);n(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});n(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[s,i]=await r(o,e);return s&&(R.error(B.INTENT_SWAP_SIGN_ERROR,{error:s,msg:{chainId:e,unsignedTx:o}}),Z.error({title:f("swaptrade_trading_mode_alert_order_fail")})),[s,i]});n(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});n(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),R.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:s,calldata:i,defiPlatformId:c}=o?.quote.bestRoute,{quote:u,unsignedTx:l}=i||{};if(!u||!l)return;let[d,h]=await this.signIntentSwap(r,l);if(d)return;let[C,A]=await this.createIntentOrder({quote:u,offlineType:s,signature:h,defiPlatformId:c});if(C)return;e.afterTransaction(A.data?.orderId)}catch(s){R.error(B.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),R.removeKeep()}});n(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),R.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:s}=o?.quote.bestRoute,{calldata:i,defiPlatformId:c}=s,{quote:u,unsignedTx:l}=i||{};if(!u||!l)return;let[d,h]=await this.signIntentSwap(r,l);if(d)return;let[C,A]=await this.bridgeSumbitIntentOrder({quote:u,signature:h,defiPlatformId:c});if(C)return;e.afterTransaction(A.data?.orderId)}catch(s){R.error(B.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),R.removeKeep()}});Xe(this,yi)}},Uo=Ir;p();m();L();p();m();L();p();m();L();L();var _r=class{constructor(t){n(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:s,fromToken:i,toToken:c}=o;return!Number(r)&&!Number(s)?t=i.tokenSymbol===c.tokenSymbol?M.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:M.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=M.TO_TOKEN_PRICE_UNKNOWN):t=M.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o.showValueDiffDialog&&(t=r?M.VALUE_DIFFERENCE_TOO_MUCH_CROSS:M.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=M.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Zo.ENOUGH&&(t=M.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Nt.BTC_REPEAT?t=M.REPEAT_ORDER_BTC:o.repeatFlag===Nt.FACET_REPEAT?t=M.REPEAT_ORDER_FACET:o.enoughFlag!==Zo.ENOUGH&&(t=M.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||P.get(un))return null;let s=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===tr.FACET||Number(o.tokenType)===tr.FACET)&&(s=M.FACET_SWAP_TIPS),{errorType:s,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!P.get(on)&&(t=M.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,s=o.quote.bestRoute,{toTokenPrice:i,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:u}=s,{BigNumber:l}=_;return(r?new l(u):new l(c)).gte(new l(i))&&(t=M.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,s=Number(e.to.chainId)===1;if(r&&s){let i=S(o,"quote.bestRoute.toSwapFeeUsd"),c=S(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),u=S(o,"quote.bestRoute.bridge.toRiskLimit");_.BigNumber(i).dividedBy(c).gte(u)&&(t=M.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:s}=t;if(o){if(!await s())throw Error("btc balance update failed");let c=e.computedInputVal,u=r.availableBalance;if(_.BigNumber(c).gt(u))return{errorType:M.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return qr(e)&&e!==0?e===4&&P.get(`${so}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||P.get(`${so}_${e}`)?null:{errorType:M.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=P.get(`${so}_${en}`);return!e&&!o?{errorType:M.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:M.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return ks()?{errorType:M.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible,this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:s,continueToNextInterceptor:i}=await r.call(this)||{};if(s&&(t.push(s),!i))return t}return t}},Ri=_r;p();m();L();var Ra=()=>{let{quoteStore:a}=E(),t=a.enableQuoteAggregates?S(a,"quote.bestRoute"):null;return S(t,"defiPlatformId")===q?f("swaptrade_trade_placeholder_okxdex"):S(t,"name")},Ar=({disabled:a,toUsdPrice:t})=>{let{commonStore:e,fromToStore:o,buySellStore:r,quoteStore:s}=E();if(e.portal===uo.MARKET){let l=S(s,"quote.bestRoute.receiveAmount");return l?f(r.tradeMode==="buy"?"swaptrade_market_placeorder_btn_buy_amt":"swaptrade_market_placeorder_btn_sell_amt",{amt:gt(l,{needBillionMillionUnit:!0,useScientificNotation:!0}),token:Yn(o.to.tokenSymbol),price:Wn(e.currencyConversion(t).toString(),e.computedNowCurrencySymbol,{needPlaceholder:!0})}):r.tradeMode==="buy"?f("swaptrade_market_placeorder_btn_buy_symbol",{symbol:o.to.tokenSymbol}):f("swaptrade_market_placeorder_btn_sell_symbol",{symbol:o.from.tokenSymbol})}let u=(s.enableQuoteAggregates?S(s,"quote.bestRoute"):null)?Jr:a?Y:oe;if(o.computedIsSingleChain){let l=Ra();return f(u,{provider:l})}return f(Zr)},Pi=()=>{let{commonStore:a,buySellStore:t}=E();return a.portal===uo.MARKET?t.tradeMode==="buy"?Ot.TYPE.green:Ot.TYPE.red:null},Li=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=E();return a.portal===uo.MARKET?e.isConfirmLoading:t.swapBtnLoading};p();m();L();var wi=()=>{let{accountStore:a}=E(),t=S(a,"walletConfig.isWCApp"),e=S(a,"walletConfig.isOkxConnect"),o=f("swaptrade_card_swap_modal_btn_confirming_in_your_wallet"),r=f("swaptrade_modal_confirm_swap_btn_confirming_in_app");return t||e?r:o};var Fe=class{constructor(t){n(this,"swapBtnErrorTipsDialog",null);n(this,"swapInterceptor");n(this,"isInterceptionProcessing",!1);n(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));n(this,"notShowAgainCrossChainConfirm",!1);n(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});n(this,"tipsDialogInfo",this.defaultTipsDialogInfo());n(this,"swapBtnLoading",!1);n(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});n(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});n(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});n(this,"connectWallet",()=>{});n(this,"approve",()=>{});n(this,"cancelApprove",()=>{});n(this,"swap",()=>{});n(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;ho({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.showDappPanel()});n(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?Ae:null});n(this,"checkBlackAddress",()=>{let{quoteStore:t}=this.rootStore,{quoteError:e}=t.quote;return e?.error_code===mn?Y:null});n(this,"checkShowLimitRegion",()=>this.checkDappTrade()?null:Lo.computedIsLimitRegion?Y:null);n(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:s,quoteError:i,quoteNull:c}=e.quote,{from:u,to:l,computedTypedValue:d}=t,{tokenContractAddress:h}=u,{computedRealSlippageValue:C}=o;return c||!s&&i&&!r||!d||!l.tokenContractAddress||!h||C>50||C<0?Y:null});n(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?Y:null);n(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?Y:null});n(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?Y:null);n(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:Y});n(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t,hasInitWalletInfo:e}}=this;return!t&&e?Ie:null});n(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?Y:null});n(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?Y:null});n(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?Y:null});n(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===no.BALANCE_REQUEST_FAILED?Y:null});n(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?eo:null);n(this,"approveStatus",()=>{let{fromToStore:t,quoteStore:e,approveStore:{getApprovalStatus:o}}=this,{from:r,computedIsCrossChain:s}=t,i=S(e,"quote.bestRoute"),c=z.getCurrentRouteDefiPlatformId(s,i),u=o(r,c);return rn[u]||null});n(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?oe:null});n(this,"getBtnStatus",()=>{let t=[this.checkBlackAddress,this.checkShowLimitRegion,this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=Y),e});n(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||Z.warn({title:f("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:s,quoteStore:i,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=s,this.quoteStore=i,this.approveStore=c,this.swapInterceptor=new Ri(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await y(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){R.error(B.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,s=()=>{r++;let i=r===o.length-1;this.showErrorTips(o[r],i?t:s)};s()}getBtnAllStatus({from:t,toUsdPrice:e}){return{[Ie]:{statusType:Ie,disabled:!1,toLocaleText:()=>f(Ie),onClick:this.connectWallet},[eo]:{statusType:eo,disabled:!this.fromToStore.computedShowAddFund||ce(),toLocaleText:()=>f(Ks["FILL_UP"],{token:N(t.tokenSymbol)}),onClick:()=>{this.fromToStore.onClickAddFunds()},symbol:t.tokenSymbol},[oo]:{statusType:oo,disabled:!1,toLocaleText:()=>f(oo,{tokenSymbol:N(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:Ot.ICON_POSITION.leading},[_e]:{statusType:_e,loading:!0,disabled:!0,toLocaleText:()=>f(_e)},[Jo]:{statusType:_e,disabled:!1,toLocaleText:()=>f(Jo,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:Ot.ICON_POSITION.leading},[ro]:{statusType:ro,loading:!0,disabled:!0,toLocaleText:()=>f(ro)},[Y]:{statusType:Y,disabled:!0,toLocaleText:()=>Ar({disabled:!0,toUsdPrice:e})},[oe]:{statusType:oe,disabled:!1,loading:Li(),toLocaleText:()=>Ar({disabled:!1,toUsdPrice:e}),toLoadingLocaleText:()=>wi(),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:Pi()},[Ae]:{statusType:Ae,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>f(Ae),icon:"okds-open-link",iconType:Ot.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,s=e.from.balance,i=t.safeMoonStore.computedInputVal;return r?_.BigNumber(s||0).isLessThan(i):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e,to:o}=t,r=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading,toUsdPrice:S(o,"usdPrice")})[r]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:s,getGasTokenFeeLoading:i}=e,{fromTokenAmount:c="",inputToTokenAmount:u=""}=s?.bestRoute||{},l=!!r,d=l&&o&&_.BigNumber(r).isEqualTo(c),h=l&&!o&&_.BigNumber(r).isEqualTo(u);return!i&&(d||h)}};p();m();var Oi=Co(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);p();m();var br=()=>{let{accountStore:a}=E();rs({wallet_address:a.address,...Es()})};var Ht=class extends Fe{constructor(e){super(e);n(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:s}=this.rootStore,{from:i,cacheTokenInfo:c}=this.fromToStore;this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),R.info(B.CLICK_WALLET_SWAP_BUTTON,{chainId:i.chainId,tokenContractAddress:fo(i.tokenContractAddress),amountNum:i.balance}),_.eq(i.balance,c.amountNum)||R.info(B.BALANCE_IS_ERROR,{chainId:i.chainId,tokenContractAddress:fo(i.tokenContractAddress),amountNum:i.balance,cacheTokenInfo:{...c,tokenContractAddress:fo(c.tokenContractAddress)}});let{fromToken:u}=Ce.get(e,"bestRoute",{});if(o){if(Bs(e?.bestRoute?.structureType)&&s.isSwapSolana(u.chainId)&&await this.walletContractStore.handleSolanaOfflineData(e?.bestRoute))return}else{let d=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,d)return}this.swapBtnLoading=!1;let l=o?St.INTENT_SWAP:St.SWAP;if(r.saveWalletAddressToStorage(this.fromToStore?.to),s.isSwapSolana(u.chainId)){H.history?.push({pathname:Je});return}H.history?.push({pathname:ee,search:`needUpdate=${nn.on}&type=${l}`})});n(this,"swap",async()=>{let e=this.checkIsCurrentQuote(),{fromToStore:o,quoteStore:r}=this,{from:s,to:i}=o;ho({wallet_address:this.accountStore.address,button_name:"confirm",...lt()});let c=Ce.get(r,"quote.bestRoute.serviceFeeInfo.serviceFeeUsd","0");os({fee_shown:c,from_token_symbol:s?.tokenSymbol,to_token_symbol:i?.tokenSymbol,from_to_pair_symbol:`${s?.tokenSymbol}:${i?.tokenSymbol}`,input_amount_usd:s?.usdPrice,source:ts()?.source,terminal:ss.Plugin,selected_chain_id:s?.chainId,auto_confirm_enter:"off",chain_name:s?.chainName}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});n(this,"approve",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=Ce.get(o,"quote.bestRoute"),s=z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:v.Approving}),br(),this.approveStore.setApprove()});n(this,"cancelApprove",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=Ce.get(o,"quote.bestRoute"),s=z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:v.CancelApproving}),br(),this.approveStore.setApprove(re.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,Xe(this,Oi)}};p();m();L();L();p();m();L();L();p();m();p();m();var Ni=function(){return new Promise(function(t){setTimeout(t,1)})};p();m();var he=D(W());p();m();var Pa={["SWAP"]:"swap_used_chain_cache",["LIMIT_ORDER"]:"limit_used_chain_cache",["BRIDGE"]:"bridge_used_chain_cache"},Di="USED_CHAIN_CACHE",Er=4,La=a=>{let t=Pa[a],e=P.get(t)||[],o=P.get(Di)||[];return e.length!==0&&P.remove(t),o.filter(Boolean)},wa=({selectedChainIdList:a,chainList:t,cacheChainIdList:e})=>{t.sort((u,l)=>Number(l.popularWeight)-Number(u.popularWeight));let o=t.map(u=>u.chainId);if(e.length===0)return{sortedChainList:o.slice(0,Er),cacheChainIds:o};let r=new Set(o),s=e.filter(u=>r.has(u)),i=[...e],c=[...s.slice(0,Er)];return a.forEach(u=>{if(c.includes(u)||!u)return;let l=i.indexOf(u);l>-1&&i.splice(l,1),c.unshift(u),i.unshift(u)}),{sortedChainList:c.slice(0,Er),cacheChainIds:i}},Fi=(a,t,e)=>{R.info(B.GET_CHAINLIST_BY_STORAGE,{data:{fromAndToChainIdList:a,isChainListEmpty:t.length===0,hasUndefinedChain:t.some(i=>!i?.chainId),currentTab:e}});let o=La(e),{sortedChainList:r,cacheChainIds:s}=wa({selectedChainIdList:a,chainList:t,cacheChainIdList:o});return P.set(Di,s.filter(Boolean)),r.filter(Boolean)};p();m();var xe=class{constructor(t){n(this,"id",1);n(this,"tokenSymbol","--");n(this,"tokenName","--");n(this,"decimals",6);n(this,"tokenContractAddress","");n(this,"tokenLogoUrl","");n(this,"type","");n(this,"amountNum",0);n(this,"currencyAmount",0);O(this),Object.assign(this,t),this.tokenModalStore=E().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=_.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?Dt(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===I.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===I.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return st(this)}get computedTokenVolume(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.volume,{needPlaceholder:!0})}get computedTokenLiquidity(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.liquidity,{needPlaceholder:!0})}};p();m();var Me=(a={})=>({...Q,logoUrl:Q.logoUrl(),chainName:f(Q.localKey),...a}),qo=(a={})=>{let t=Yr();return{...$,get logoUrl(){return t===Hr.dark?$.darkLogoUrl():$.logoUrl()},chainName:f($.localKey),...a}};var xi="hide_collect_cancel_dialog",Mi="hideTokenGuide",Yt=class{constructor(t){n(this,"searchValue","");n(this,"setSearchValue",t=>{this.searchValue=t});n(this,"fromTokenList",new Map);n(this,"toTokenList",new Map);n(this,"searchTokenList",{});n(this,"currentCollectionGroupId");n(this,"setCurrentCollectionGroupId",t=>{this.currentCollectionGroupId=t});n(this,"setCurrentCollectionGroupIdAndGetList",t=>{t&&t===this.currentCollectionGroupId||(this.setCurrentCollectionGroupId(t),this[`${this.tokenModalFromState}TokenList`].set(Q.chainId),this.getTokenListByChainId().then(nt).catch(nt))});n(this,"error",!1);n(this,"tokenModalVisible",!1);n(this,"tokenModalFromState",I.FROM);n(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});n(this,"loading",{[I.FROM]:{},[I.TO]:{}});n(this,"initLoading",()=>{this.loading={[I.FROM]:{},[I.TO]:{}}});n(this,"importTokenInfo",{});n(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});n(this,"toSelectedChainId","");n(this,"fromSelectedChainId","");n(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});n(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});n(this,"fromSelectedChainAtSearch","");n(this,"toSelectedChainAtSearch","");n(this,"setFromSelectedChainAtSearch",t=>{this.fromSelectedChainAtSearch=t});n(this,"setToSelectedChainAtSearch",t=>{this.toSelectedChainAtSearch=t});n(this,"updateSelectedChainAtSearch",t=>{this.tokenModalFromState===I.FROM?this.setFromSelectedChainAtSearch(t):this.setToSelectedChainAtSearch(t)});n(this,"updateFromToSelectedChainIdAfterSearch",()=>{if(this.tokenModalFromState===I.FROM&&this.fromSelectedChainAtSearch!==this.fromSelectedChainId){this.setFromSelectedChainId(this.fromSelectedChainAtSearch);return}this.tokenModalFromState===I.TO&&this.toSelectedChainAtSearch!==this.toSelectedChainId&&this.setToSelectedChainId(this.toSelectedChainAtSearch)});n(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(J(o.chainId))).map(o=>{let r=new xe(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice,formattedVolume:r.computedTokenVolume,formattedLiquidity:r.computedTokenLiquidity}}));n(this,"extendTokenList",(t=[],e=!0)=>ot(t)?t:this.extendTokens(t,e));n(this,"importUserToken",kt(function*(e,o=!0){let r=e.map(c=>{let{chainId:u,tokenContractAddress:l,tokenSymbol:d,decimals:h}=c;return{chainId:u,contractAddress:l,tokenSymbol:d,precision:h}}),s={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},i=[];try{i=(yield k.post(fn,s)).data}catch(c){throw Z.error(f("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),i}));n(this,"sortTokens",t=>Vr(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));n(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===x.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));n(this,"formatTokenList",(t,e,o=!1)=>{let r=t;t.length>100&&e!==Q.chainId&&(r=t.slice(0,100)),o&&(r=Oo.filterHiddenTokenList(r));let s=this.extendTokenList(r,!0);return this.orderTokenList(s)});n(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});n(this,"clearCacheTokenList",()=>{});n(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===I.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===I.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===I.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===I.FROM&&Number(this.fromSelectedChainId)===$.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===I.TO&&Number(this.toSelectedChainId)===$.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===I.FROM&&Number(this.fromSelectedChainId)===Q.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===I.TO&&Number(this.toSelectedChainId)===Q.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(I.FROM,e.fromChainId):this.getTokenList(I.TO,e.toChainId,e.fromChainId)});n(this,"setTokenList",(t,e,o,r=!1)=>{let s=this.formatTokenList(e,t,r);this[`${o}TokenList`].set(t,s)});n(this,"cancelGetTokenListRef",null);n(this,"handleTokenList",kt(function*(e){let{field:o,chainId:r,url:s,params:i,enableSmallAssetFilter:c,enableHiddenTokenFilter:u}=e;this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${o}TokenList`].get(r)||this.setLoading(o,r,!0),this.cancelGetTokenListRef=bt();let l={...i};if(c){yield Oo.initializePromise;let d=Oo.getMinAmountThresholdParam();d!==void 0&&(l.minAmountThreshold=d)}try{let{data:d}=yield k.get(s,{params:l,signal:this.cancelGetTokenListRef?.signal,isolate:!0}),h=this.toLowerCaseContractAddress(d);return this.setTokenList(r,h,o,u),this.setLoading(o,r,!1),{data:h}}catch(d){return this.isCancel(d)?null:(this.setTokenList(r,[],o,!1),this.setLoading(o,r,!1),this.setError(!0),d)}}).bind(this));n(this,"getCrossChainParams",(t,e,o)=>{switch(t){case x.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,targetChainId:e.targetChainId,targetWalletAddress:e.targetWalletAddress,walletAddress:e.walletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case x.SWAP:default:return e}});n(this,"getTokenList",kt(function*(e,o,r){let s={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(s={...s,businessLine:se.LIMIT_ORDER});let i=this.getCrossChainParams(this.commonStore.currentTab,s,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=J(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e,!1),{data:[]};let u=Gt(qt.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList({field:e,chainId:c,url:u,params:i,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getFromCollectedTokens",kt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:se.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Ut.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:"",...this.computedCollectionGroupParams}),r=Gt(qt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:I.FROM,chainId:Q.chainId,url:r,params:o,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getToCollectedTokens",kt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:se.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Ut.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress,...this.computedCollectionGroupParams}),s=Gt(qt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:I.TO,chainId:Q.chainId,url:s,params:r,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getFromAllNetworksTokens",kt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:se.LIMIT_ORDER});let o=Gt(qt.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Ut.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList({field:I.FROM,chainId:$.chainId,url:o,params:r,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getToAllNetworksTokens",kt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:se.LIMIT_ORDER});let r=Gt(qt.ALL_NETWORK,this.commonStore.currentTab),s=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Ut.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList({field:I.TO,chainId:$.chainId,url:r,params:s,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"cancelSearchRef",null);n(this,"needRemoveChainId",t=>[$.chainId,Q.chainId].includes(J(t)));n(this,"getSearchChainType",()=>{let t=io.SINGLE;return this.computedCurrentSearchChainId===$.chainId&&(t=io.ALL_NETWORK),this.computedCurrentSearchChainId===Q.chainId&&(t=io.COLLECT),t});n(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===I.FROM?Ut.FROM:Ut.TO);n(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses},r={},s={};return this.tokenModalFromState===I.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainAtSearch,chainId:this.fromSelectedChainAtSearch,toChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===I.TO&&(s={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainAtSearch)&&(delete s.toChainId,delete r.chainId)),{...o,...r,...s}});n(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=bt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=$o(this.searchValue),e=this.getSearchParams(t);es({keyword:t});let o=Gt(qt.SEARCH,this.commonStore.currentTab),[r,s]=await y(k.get(o,{params:e,signal:this.cancelSearchRef?.signal}));if(r&&!this.isCancel(r)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(s){let{data:i}=s;if(this.commonStore.currentTab===x.BRIDGE)this.setSearchTokenList({list:i});else{let{systemList:c,thirdPartyList:u}=s.data;this.setSearchTokenList({systemList:c,thirdPartyList:u})}this.updateFromToSelectedChainIdAfterSearch(),this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});n(this,"resetTokenModal",()=>{this.resetTokenData()});n(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});n(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:s}=e;for(let i=0;i<o.length;i++)if(this.commonStore.equalsToken(o[i],e)){o[i].amountNum=s,o[i].currencyAmount=r;break}return o});n(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=J(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(st(r),t),I.FROM,!0);let s=this.toTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(st(s),t),I.TO,!0)});n(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(h=>h.chainId===e.chainId&&!h.disabled))return r;let{dexDefaultFromToTokenShowVO:s}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:u}=s,l=o===x.BRIDGE,d;return l&&u?d=u:this.commonStore.equalsToken(t,c)?d=i:d=c,{toToken:d,isChanged:!0}}return r});n(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return st(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});n(this,"hideCollectCancelConfirm",P.get(xi));n(this,"showCollectOverLimitDialog",!1);n(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});n(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:s}=this.commonStore,i=t&&t.length>0?t:[e.chainId,o.chainId];return Fi(i,r,s)});n(this,"tokenPageChainList",[]);n(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t?.filter(Boolean)||[]});n(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>J(e.chainId)===J(this.toSelectedChainId)));n(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>J(o.chainId)===J(t))===-1){let o=this.commonStore.chainList.find(s=>J(s.chainId)===J(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===I.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});n(this,"searchChainKeywords","");n(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});n(this,"filterChains",t=>Br(t,e=>{let o=Xo($o(this.searchChainKeywords));return Xo(e.chainName).includes(o)}));n(this,"dialogIndex",rr.TOKEN_LIST);n(this,"setDialogIndex",t=>{this.dialogIndex=t});n(this,"hideTokenGuide",!!P.get(Mi));n(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,P.set(Mi,"1")});n(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),as(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(rr.TOKEN_LIST)});n(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});n(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await Ni(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:s,updateTo:i,setBalance:c,setFromBalanceRequestError:u,setToBalanceRequestError:l,to:d,computedIsExactIn:h,needCrossChainDoubleConfirm:C,setNeedCrossChainDoubleConfirm:A}=this.fromToStore,{clearReceiveAddressValue:b}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let F=this.tokenModalFromState===I.FROM,w=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),u(!1),c(I.FROM,t.balance)},V=()=>{l(!1),c(I.TO,t.balance)};if(t.selected){F?V():w(),this.fromToStore.onSwitchFromTo();return}F?w():V();let et=()=>{C||A(!0)};if(F){if(Jn(t.chainId,d.chainId)&&this.commonStore.currentTab===x.BRIDGE){let Tt=new yt(this.commonStore.currentTab,{}),[ct,ut]=await Tt.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:ge}=r,K={...t},Te;ct?(s({...K,amount:ge}),Te=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,i({...Te})):(K=ut.data.fromTokenInfo,Te=ut.data.toTokenInfo,s({...K,amount:ge}),i(Te),et(),this.fromToStore.getTokenBalanceByAccount("from",K)),this.fromToStore.getTokenBalanceByAccount("to",Te)}else if(!this.commonStore.equalsToken(t,r)){let{amount:Tt}=r;o.setQuoteNumber(2),s({...t,riskLevel:t.riskLevel,amount:Tt});let{toToken:ct,isChanged:ut}=this.checkFromToLegal(t,d);i(ct),ut&&(et(),this.fromToStore.getTokenBalanceByAccount("to",st(ct))),h&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,d)||(et(),o.setQuoteNumber(0),i({...t,amount:""}),h||this.fromToStore.advanceSetTypedValue(""));b()});n(this,"updateTokenCollectionStatus",(t,e,o)=>{let r=!o?.length,s=this.currentCollectionGroupId&&!o.includes(this.currentCollectionGroupId);this.updateTokenCollectedLocal({...e,isCollectToken:r||s})});n(this,"memeTagConfig",{});n(this,"setMemeTagConfig",t=>{this.memeTagConfig=t});n(this,"fetchMemeTagConfig",async()=>{let[,t]=await y(k.get(Qn)),e=t?.data?.tagAndEmojiMap||{};return this.setMemeTagConfig(e),e});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}get computedCollectionGroupParams(){let t={accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress};return this.currentCollectionGroupId?{...t,groupId:this.currentCollectionGroupId}:t}get computedAdresses(){return S(this,"accountStore.computedMultiAddresses",{})}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===I.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return ot(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return pe(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=Me(),e=qo({});return[t,e,...st(this.tokenPageChainList)]}get computedToChain(){let t=Me();if(ie(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||ie(this.toSelectedChainId)?this.toSelectedChainId:ie(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?$.chainId:hn}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return Ct({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(s=>this.reassignTokenInfo(s,t,r)).filter(s=>this.filterCollectToken(s));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===I.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===I.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return J(this.tokenModalFromState===I.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedCurrentSearchChainId(){return J(this.tokenModalFromState===I.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch)}get computedIsCollectChain(){return this.computedCurrentChainId===Q.chainId}setShowCollectCancelConfirm(t){P.set(xi,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===I.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===I.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===I.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===I.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===I.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=We(st(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}get computedIsWatchListGroupShow(){return this.searchValue?!1:this.tokenModalFromState===I.FROM&&Number(this.fromSelectedChainId)===Q.chainId||this.tokenModalFromState===I.TO&&Number(this.toSelectedChainId)===Q.chainId}};var Go=class extends Yt{constructor(e){super(e);n(this,"showChainTab",!0);n(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});n(this,"extendTokenList",(e=[],o=!0)=>ot(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));n(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=We(st(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Zt([...r],"chainId")});n(this,"getCrossChainSearchType",()=>{let e=this.tokenModalFromState===I.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch;return Number(e)===Q.chainId?pr.COLLECTION:pr.COMMON});n(this,"getToChainIdAtSearch",()=>{let e=this.toSelectedChainId;return this.tokenModalFromState===I.TO&&(e=this.toSelectedChainAtSearch),Number(e)===$.chainId?"":e});at(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===I.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],s=this.generateToChainMap();return e.forEach(i=>{let c={...i};c.disabled=!s[i.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],s=!1)=>{let i=[];return r?.forEach(c=>{let u=c?.tokenList.map(l=>this.reassignTokenInfo(l,e,s)).filter(l=>this.filterCollectToken(l));i.push({...c,tokenList:u})}),i};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=Me(),o=qo({});if(ie(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),s=[];return st(this.tokenPageChainList).forEach(i=>{!i||i.chainId!==Number(this.fromToStore.from.chainId)&&s.push({...i,disabled:!r[i.chainId]})}),[e,o,...s]}return[e]}getSearchParams(e){let o={...this.computedAdresses};return this.tokenModalFromState===I.FROM&&(o={...o,fromChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&delete o.fromChainId),this.tokenModalFromState===I.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch},this.needRemoveChainId(this.toSelectedChainAtSearch)&&delete o.toChainId),{fromChainId:o.fromChainId??o?.chainId,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,targetChainId:o.targetChainId,targetWalletAddress:o.targetWalletAddress,walletAddress:this.accountStore.computedSignWalletAddress,inputContent:e,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.getToChainIdAtSearch(),fromTokenAddress:this.fromToStore.from?.tokenContractAddress||""}}};p();m();L();var{BigNumber:Bi}=_,vr="safemoon_slippage",yr="safemoon_is_changed",Ui=50,Rr={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Kt=class{constructor(t){n(this,"isChanged",!1);n(this,"getSafemoonIsChangedLocal",()=>!!P.get(`${yr}_${this.computedSlippageTokenPair}`));n(this,"cacheSlippage",0);O(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,At(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(P.get(`${yr}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(P.get(`${vr}_${this.computedSlippageTokenPair}`))}),At(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(P.get(`${vr}_${this.computedSlippageTokenPair}`))}),At(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t;let{computedIsSingleChain:e}=this.fromToStore;e||P.set(`${yr}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Bi(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),P.set(`${vr}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Bi(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return To(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=S(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===Ui?{type:Rr.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:N(o),slippageTolerance:e}),inputWarning:f("swaptrade_adjustslip_modal_advise_givenslip")}:e>Ui?{type:Rr.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:N(o)})}:{type:Rr.AdviseSlip,safeMoonSlippage:e,tip:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:N(o)}),inputWarning:f("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return S(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return S(t,"isHoneypot")===1}get computedInputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[I.FROM]}get computedInputFiatVal(){let{computedFromLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[I.TO]}get computedOutputFiatVal(){let{computedToLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return Hn(t[I.TO])}};p();m();var Qo=class{constructor(){n(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:P.get(er)===tn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});n(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});n(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),P.set(er,`${Number(t)}`)});n(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});O(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};p();m();var Pr=class{constructor(t){n(this,"isShowMev",!1);n(this,"setShowMev",t=>{this.isShowMev=t});n(this,"mevSwitchOpenStatue",co.AUTO_OFF);n(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});n(this,"mevInfo",{});n(this,"setMevInfo",t=>{this.mevInfo=t});n(this,"walletMevControl",!1);n(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,O(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===co.AUTO_ON||this.mevSwitchOpenStatue===co.USER_ON)}},Vo=Pr;p();m();L();var Lr=class{constructor(t){n(this,"feeConfig",{});n(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!ot(t)){this.feeConfig=t,ke.set("feeConfig",t);return}let e=ke.get("feeConfig"),o=He(e,["referrerAddress","feePercent"]);ot(o)?(this.feeConfig={},ke.remove("feeConfig")):this.feeConfig=o});n(this,"widgetFeeConfig",{});n(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});n(this,"receiveQuoteUrl",()=>this.isIframe?gn:Cn);n(this,"aggregatorQuoteUrl",()=>_n);n(this,"saveOrderUrl",()=>this.isIframe?bn:kn);n(this,"illegalFeePercent",t=>{let{BigNumber:e}=_,o=e(t);return!!(o.isNaN()||o.gt(cn)||o.lte(0))});n(this,"extendFeeConfig",(t={})=>{if(this.isWidget){let o=S(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=S(o,["referrerAddress",t.fromTokenAddress]),s=S(r,"account"),c=S(r,"feePercent")||o.feePercent;return s?{...t,referrerAddress:s,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=ot(this.feeConfig)?ke.get("feeConfig"):this.feeConfig;return{...t,...e}});O(this),this.rootStore=t,this.isIframe=!mt()&&Zn()&&!gs,this.isWidget=!mt()&&ce()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},Wo=Lr;p();m();L();p();m();L();p();m();var qi=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=E(),{from:s,to:i}=r;return!(!i?.tokenContractAddress||!s?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};p();m();p();m();var Gi=a=>{let{fromToStore:t,quoteStore:e}=E(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s}=a,{computedIsSingleChain:i}=t,c=Number(o?.code)===ft.CROSS_CHAIN_INTERVAL,u=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(u),{isAutoError:c||(i?!s:!r?.length)}};var Oa=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Na=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s,swapType:i,intentCode:c,isSupportDappTrade:u,offlineType:l,traceData:d,serviceFeeInfo:h}=a,C={intentCode:c,offlineType:l,swapType:i,traceData:d},A=r?.map(F=>({...o,...F,...C,isSupportDappTrade:u}));return{bestRoute:t.computedIsSingleChain?{...o,...s,...C,serviceFeeInfo:h,intentInfo:a?.intentInfo||{},isSupportDappTrade:u}:e.pickBestRouterAccordingBridgeId(A)||{...o,...C,isSupportDappTrade:u},combineSelectionRouterList:A}},Da=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e,priorityFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:c})=>{c.updateSlippageInfoFetched(a),c.setQuote({...c.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1,priorityFeeInfo:o,jitoData:r,commonDexInfo:s}),i.quoteUpdateFromTo(a),i.computedIsSingleChain||c.setPathSelectionRouterList(t||[])},wr=({isAutoError:a},{approveStore:t})=>{if(!a){let{fromToStore:e,quoteStore:o,accountStore:r}=E(),{needApprove:s,defiPlatformId:i,defiPlatformIds:c,allowanceData:u}=z.getApproveInfo(e.computedIsCrossChain,o);t.isPendingNotCheck({token:e.from,needApprove:s,defiPlatformIds:c,defiPlatformId:i,allowanceData:u,userWalletAddress:r.getAddressByChainId(e.from.chainId)}).catch(()=>{})}},Be=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),pt(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Fa=a=>{let{solanaPriorityFeeStore:t}=E();t&&t.setJitoData(a?.priorityFeeInfo)},Or=a=>{(a?.newPriorityFeeInfo||a?.priorityFeeInfo)&&go.setPriorityFeeInfo(a?.priorityFeeInfo||a?.newPriorityFeeInfo)},Qi=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),{isAutoError:r}=Gi(a);Oa({quoteStore:e,fromToStore:t});let{bestRoute:s,combineSelectionRouterList:i}=Na(a,{fromToStore:t,quoteStore:e}),{priorityFeeInfo:c,newPriorityFeeInfo:u,jitoData:l,commonDexInfo:d}=a;Da({bestRoute:s,combineSelectionRouterList:i,isAutoError:r,jitoData:l,commonDexInfo:d,priorityFeeInfo:u||c},{fromToStore:t,quoteStore:e,approveStore:o}),Fa(a),Or(a),wr({isAutoError:r},{approveStore:o}),Be({isAutoError:r},{quoteStore:e})};p();m();var Ue=class{constructor(t){n(this,"allTimerAndQuoteState",{[j.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[j.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>f(Ze)},[j.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>f(Ze)},[j.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>f(to)},[j.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>f(to)},[j.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>f(Ze)},[j.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>f(to)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=_;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,s=this.fromToStore?.computedIfQuote,i=o!==null;return s?i?this.allTimerAndQuoteState[j.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[j.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[j.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[j.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[j.QUOTING]:this.allTimerAndQuoteState[j.DEFAULT]:this.allTimerAndQuoteState[j.TIMER]:this.allTimerAndQuoteState[j.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:Ma,FACET_TOKEN_ERROR_TWO:Ba,FACET_TOKEN_ERROR_THREE:Ua}=ft,jt=class{constructor(){n(this,"dialogCloseFlag",!1);n(this,"slippageInfoFetched",!1);n(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});n(this,"enableQuoteAggregates",!1);n(this,"dialogShowQuotationComparison",!1);n(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});n(this,"quoteNumber",0);n(this,"setQuoteNumber",t=>{this.quoteNumber=t});n(this,"aggregateSelectId",it);n(this,"isDialog",!1);n(this,"setIsDialog",t=>{this.isDialog=t});n(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});n(this,"isPickRouterFromWallet",!1);n(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});n(this,"quoteScope",null);n(this,"setQuoteScope",t=>{this.quoteScope=t});n(this,"fetchQuoteStatus",0);n(this,"quote",{...this.initQuote});n(this,"setQuote",t=>{this.quote=t});n(this,"pathSelectionRouterList",[]);n(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});n(this,"pickRouter",{});n(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});n(this,"showChainListModel",!1);n(this,"setShowChainListModel",t=>{this.showChainListModel=t});n(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});n(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});n(this,"currentBridgeId","");n(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});n(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});n(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==mo.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});n(this,"quoteTimer",null);n(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});n(this,"cancelRef",null);n(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});n(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:s,computedIsExactIn:i}=this.fromToStore;return t===x.LIMIT_ORDER||!be(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!i&&!s});n(this,"getQuoteData",async t=>{let e=await wt();return y(le(()=>k.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),It.NUM,It.TIMER))});n(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Qi(e)}});n(this,"fetchQuote",async({source:t}={})=>{if(!qi())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},or),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(1),this.setBridgeSelectId?.(it)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(it))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=bt();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!pe(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!pe(e)&&!this.dialogCloseFlag&&pt(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},or)}),Promise.resolve(!0)});n(this,"quotePending",!1);n(this,"debounceQuote",Mr(this.fetchQuote,an));n(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});n(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});n(this,"getGasTokenFeeLoading",!1);n(this,"getGasTokenFeeCancelRef",null);n(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});n(this,"cacheNativeGasFee","");n(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});n(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},s=Gr(De(),["dexIds"]);this.getGasTokenFeeCancelRef=bt();let i=this.rootStore.fromToStore?.computedIsExactIn?Sn:Tn;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,u=e,[l,d]=await y(k.get(i,{params:{...s,amount:Xn(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!pe(l)&&l)return-1;if(!l){let{data:h}=d||{},{commonDexInfo:C}=h||{};Number(C?.code)===0&&C?.estimateReserveGasTokenFee!==""&&(u=C.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(u),u})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=Is({isSingleChain:t,autoSlippageInfo:e}),s=xt.AUTO,i,c;return o&&(r=o.computedRealSlippageValue,s=o.getSlippageType(),i=t?o.computedRealCustomMaxSlippage:void 0,c=t?o.computedRealCustomSlippage:void 0),!this.slippageInfoFetched&&s===xt.AUTO&&(s=xt.DEFAULT),{slippage:r,slippageType:s,customSlippage:c,maxSlippage:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:s}=this.fromToStore,i=Number(e?.code)===ft.CROSS_CHAIN_INTERVAL,c=i?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:i||(s?!r:!o?.length)}}updateSlippageInfoFetched(t){let{referenceSlippage:e,autoSlippage:o,autoTotalSlippage:r}=t?.autoSlippageInfo||{};(e||o||r)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!_.BigNumber(e).lt(_.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Ue(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return jn()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===G.EMPTY}get computedShouldShowLimitRegionTip(){let t=!!Lo.computedIsLimitRegion;return this.fromToStore?.computedIsSingleChain?t&&!this.quote?.bestRoute:t}get computedQuoteInterval(){let{fromToStore:t,approveStore:e,swapBtnStore:o,swapDappStore:r}=this.rootStore;if(this.quote?.bestRoute?.code===dn||this.quote?.bestRoute?.code===ln||t.computedFormToTokenIsLeverageToken)return{type:G.EMPTY};let s=Vs.handleQuoteErrorState({quote:this.quote,honeypotToken:S(this,"rootStore.safeMoonStore.computedHoneypot",!1),shouldShowLimitRegionTip:this.computedShouldShowLimitRegionTip})||this.accountStore.computedNonsupportChain,{from:i,computedNonsupportFacetToken:c}=this.fromToStore;if(s||c)return{type:G.EMPTY};if(r.checkShouldJumpToDapp())return{type:G.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:G.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:G.NOT_OKX_LIQUIDITY};let l=t.computedIsCrossChain?S(this.quote?.bestRoute,"bridge.defiPlatformId"):S(this.quote?.bestRoute,"defiPlatformId",q);if((!this.quoteScope||!t.computedIfQuote)&&this.fetchQuoteStatus!==3&&!e.isCancelApproveStatus(i,l)&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:G.EMPTY};if(this.computedCrossAccuracyLimit)return{type:G.CROSS_CHAIN_ACCURACY,text:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:i.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:N(i.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:G.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:d,crossMaxAmount:h}=this.quoteScope||{};if(_.BigNumber(i.amount).lt(_.BigNumber(d))){let C=gt(d,{cutPriceText:!0,isFloor:!1});return{type:G.CROSS_CHAIN_MIN,text:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:C,symbol:i.tokenSymbol}),equation:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:C,symbol:N(i.tokenSymbol)})}}if(_.BigNumber(i.amount).gt(_.BigNumber(h))){let C=gt(h,{cutPriceText:!0});return{type:G.CROSS_CHAIN_MAX,text:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:C,symbol:i.tokenSymbol}),equation:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:C,symbol:N(i.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:G.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:G.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:G.NOT_LIQUIDITY}:e.isCancelApproveStatus(i,l)&&!o.computedTooBalance?{type:G.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:G.PROVIDER_PRICE_WARN}:{type:G.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ft.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ft.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return _.BigNumber(t.amount).lte(o)&&_.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===q):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===ft.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[Ma,Ba,Ua].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:s}=this.rootStore.fromToStore,{quoteError:i,quoteNull:c,bestRoute:u}=this.quote;if(!r||i||c||!u?.youSaveDTO||s)return{visible:!1};let{youSaveDTO:l,fromToken:d,toToken:h}=u,{topTenDexInfoList:C,youSaveMoney:A}=l,b=Number(A)>=.1&&C?.length>0&&!d.isHoneypot&&!h.isHoneypot,F=e(A).toString(),w=b?Dt(F,t,{isFloor:!1}):"",V=b?C?.[1]?.dexName:"";return o&&(!s&&this.computedTopTenDexInfoList.length>0?b=!0:b=!1),{visible:b,youSaveStr:w,dexName:V}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:s,price:i,dexAmountOut:c,amountOutOfMoney:u,gasOfMoney:l,isOkxDex:d})=>{let h=e(u)?.toString(),C=e(l)?.toString();return{logoUrl:o,dexName:r,comparePercent:s,price:i,isOkxDex:d,formatPrice:gt(i),dexAmountOut:_.BigNumber(c).toString(),formatDexAmountOut:gt(c),amountOutOfMoney:h,formatAmountOutOfMoney:Dt(h,t,{needBillionMillionUnit:!1}),gasOfMoney:Dt(C,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:s}=this.commonStore,{from:i}=this.fromToStore;return f("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${gt(o)} ${i.tokenSymbol}`,fee:`${Dt(s(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===ws.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Ps.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===Ls.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===q}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===q}get computedPriceWarn(){let t=_.BigNumber(this?.quote?.bestRoute?.reducePercent),e=_.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return $n(this?.quote?.bestRoute?.reducePercent)}};p();m();L();var qa=a=>{let{quoteStore:t,swapStore:e}=E();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},Hi=a=>Number(a.commonDexInfo?.code)===ft.CROSS_CHAIN_INTERVAL,Ga=a=>!a.pathSelectionRouterList?.length,Qa=a=>Hi(a)||Ga(a),Va=a=>{let{quoteStore:t}=E(),e=Hi(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},Wa=a=>{let{quoteStore:t}=E(),e=t.bridgeSelectId===it?a[0]:a?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return qa(e),e||a[0]},Ha=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:s,isSupportDappTrade:i,offlineType:c,traceData:u}=a||{},l=r?.map((A,b)=>({commonDexInfo:t,...A,...A?.valueDiffInfo,isBest:b===0})),d={intentCode:s,offlineType:c,swapType:o,traceData:u},h={...e,...t,swapType:o,pathSelectionRouterList:l},C=l?.map(A=>({...t,...A,...d,isSupportDappTrade:i}));return{bestRoute:h,combineSelectionRouterList:C}},Ya=a=>{let{quoteStore:t,smartRouterStore:e}=E();if(e.showXRouteModal!==mo.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},Ka=({isAutoError:a,approveStore:t})=>{if(!a){let{fromToStore:e,accountStore:o,quoteStore:r}=E(),{needApprove:s,defiPlatformId:i,defiPlatformIds:c,allowanceData:u}=z.getApproveInfo(e.computedIsCrossChain,r),l=S(e,"from.chainId");t.bridgePendingNotCheck({token:e.from,userWalletAddress:o.getAddressByChainId(l),needApprove:s,defiPlatformIds:c,defiPlatformId:i,allowanceData:u}).catch(()=>{})}},ja=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:s,quoteStore:i})=>{let c=Ct({},a,t);i.updateSlippageInfoFetched(c),i.setBridgeSelectId(c?.bridge?.bridgeId),i.setQuote({...i.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),Va(o),e&&i.setBridgeFetchStatus(3),s.quoteUpdateFromTo(c),s.computedIsCrossChain&&(i.setPathSelectionRouterList(r||[]),Ya(r||[]))},Yi=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),{bestRoute:r,combineSelectionRouterList:s}=Ha({data:a}),i=Wa(r.pathSelectionRouterList),c=Qa(a);e.setQuoteNumber(e.quoteNumber+1),ja({bestRoute:r,bridgeInfo:i,isAutoError:c,originData:a,combineSelectionRouterList:s},{fromToStore:t,quoteStore:e}),Ka({isAutoError:c,approveStore:o}),Be({isAutoError:c},{quoteStore:e})};var qe=class extends jt{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeListPending=!1;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=ki();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),y(le(()=>k.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw R.stuff(r),r}),It.NUM,It.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Yi(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};at(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await y(k.get(En));if(e)throw e;return S(o,"data",[]).map(s=>({platformId:s.chainId,logo:s.logoUrl}))}get bridgeList(){return this.initialPropsStore.initialProps.bridgeList||[]}get computedIsBridgeListLoading(){return $e()?!this.bridgeList?.length:this.bridgeListPending}async getBridgeList(){this.setBridgeListPending(!0),await y(this.initialPropsStore.getInitialProps({key:"bridgeList",callee:qe})),this.setBridgeListPending(!1)}getQuoteStoreUrl(){return In}},Ki=Io(qe);p();m();L();var Ja="1",Za="2",ji={minValue:.01,maxValue:.5},Xi={minValue:.03,maxValue:.5},Xt=class{constructor(t){n(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:"",mode:Mt.DYNAMIC,level:Bt.LOW,customMax:""});n(this,"configSingle",ji);n(this,"configCross",Xi);n(this,"hasInit",!1);n(this,"inputCache","");n(this,"isFrozen",!1);n(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,O(this,{},{autoBind:!0})}setInputCache(t){this.inputCache=t}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=Et(this.rootStore);return t||this.isFrozen?{maxSlippage:this.computedRealCustomMaxSlippage,autoSlippageInfo:e}:{customSlippage:this.computedRealCustomSlippage,autoSlippageInfo:e}}get isSingleChain(){return this.rootStore.fromToStore.computedIsSingleChain}get minSlippage(){return this.isSingleChain?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.isSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return _.mul(this.minSlippage,100)}get maxSlippageShow(){return _.mul(this.maxSlippage,100)}get computedSupportCustomMax(){return S(Et(this.rootStore),"supportMaxSlippage",!1)}get computedFixedSlippageLevelMap(){if(!this.isSingleChain)return null;let t=S(Et(this.rootStore),"shortcutFixSlippage",Object.values(ns));return{low:vt(t[0]),medium:vt(t[1]),high:vt(t[2])}}get computedDynamicSlippageLimit(){let t=S(Et(this.rootStore),"dynamicSlippageRangeMin",Ee.DYNAMIC_MIN),e=S(Et(this.rootStore),"dynamicSlippageRangeMax",Ee.DYNAMIC_MAX),o=S(Et(this.rootStore),"recommendSlippageRangeMin",Ee.RECOMMEND_MIN),r=S(Et(this.rootStore),"recommendSlippageRangeMax",Ee.RECOMMEND_MAX);return{dynamicMin:vt(t),dynamicMax:vt(e),recommendMin:vt(o),recommendMax:vt(r)}}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=S(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return _.mul(e,100)}return To(this.rootStore)}get computedRealCustomSlippage(){let t=S(this,"slippageSetting.inputSlippage","");return t?Re(t):""}get computedRealCustomMaxSlippage(){let t=S(this,"slippageSetting.customMax","");return t?Re(t):""}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(Re(t))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:s,toPriceFluctuation:i,rateFluctuationThreshold:c,slippageFluctuationhold:u,rateFluctuation:l}=e,{from:d,to:h}=this.fromToStore,C=h?.tokenSymbol||"",A=d?.tokenSymbol||"",b=_.mul(u,100),F=_.mul(r,100),w=_.mul(c,100),V=Number(l),et=Number(c);if(t>b){if(V<et)return null}else if(t===b){let Tt=Math.abs(s),ct=Math.abs(i),ut=Number(r);if(Tt>ut&&ct>ut)return{tip:f("swaptrade_placeorder_alert_both_volatility",{payToken:A,receiveToken:C,value:F,min:o}),tipEquation:f("swaptrade_placeorder_alert_both_volatility",{payToken:N(A),receiveToken:N(C),value:F,min:o})};if(Tt>ut)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:A,value:F,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:N(A),value:F,min:o})};if(ct>ut)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:C,value:F,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:N(C),value:F,min:o})};if(V>=et)return{tip:f("swaptrade_settings_alert_both_exchange",{payToken:A,receiveToken:C,value:w,min:o}),tipEquation:f("swaptrade_settings_alert_both_exchange",{payToken:N(A),receiveToken:N(C),value:w,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0,mode:Mt.DYNAMIC,level:Bt.LOW,customMax:""},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=jo(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1,t.mode=Mt.FIXED,t.level=Bt.CUSTOM,t.customMax="")}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?xt.AUTO:xt.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o,{computedIsSingleChain:s}=this.fromToStore;if(!r||s){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0,e.mode=Mt.DYNAMIC,e.level=Bt.LOW;let c=jo(i);o.isChanged&&c&&(e.inputSlippage=c,e.autoIsSelected=!1,e.mode=Mt.FIXED,e.level=Bt.CUSTOM,e.customMax=""),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){this.hasInit=!0;try{let{data:t}=await k.get(Nn),e=t?.find(({configId:r})=>Ja===r),o=t?.find(({configId:r})=>Za===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=ji,this.configCross=Xi}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:"",mode:Mt.DYNAMIC,level:Bt.LOW,customMax:""},this.setSlippageSetting(e)}initReactions(){At(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.initSlippageSetting()):!1,{equals:Ke.shallow}),At(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:Ke.shallow}),At(()=>{let{quote:t}=this.rootStore.quoteStore,e=S(t,"bestRoute.smartRoutingMenuVoList"),o=S(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===Ws.BRIDGE,{computedSafeMoonNotSupport:s}=this;return{computedSafeMoonNotSupport:s,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:Ke.shallow})}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},s=this.fromToStore.to?.tokenSymbol;if(!be(o))return"--";let i=this.inputCache?Re(this.inputCache):this.computedRealSlippageValue,c=e?r:_.mul(o,1-(be(i)?i:0));return _.BigNumber(c).lte(0)?"--":`${gt(c,{needBillionMillionUnit:!1})} ${s}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=_.BigNumber(o);return!r.isZero()&&!r.isNaN()&&_.div(_.sub(r,e),r)>=.1}};p();m();L();var Dr=class{constructor(t){n(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:s}=e,i=S(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,u=s?.specifiedAddress;return{...r,fromSwapFeeUsd:i,bridgeId:c,receiveWalletAddress:u}});n(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:s}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:s.chainId,toTokenAddress:s.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});n(this,"repeatOrder",null);n(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=S(o.bestRoute,"fromSwapFeeUsd"),s={...e,chainId:t,fromSwapFeeUsd:r},[i,c]=await y(k.get(vn,{params:s}));!i&&[Nt.COMMON_REPEAT,Nt.BTC_REPEAT,Nt.FACET_REPEAT].includes(c?.data.repeatFlag)&&pt(()=>{let{orderId:u,enoughFlag:l}=c?.data??{};this.repeatOrder={enoughFlag:l,repeatFlag:c?.data.repeatFlag,id:u}})});n(this,"checkSwapMoreInfo",null);n(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await y(k.post(yn,{...t}));e||pt(()=>{this.checkSwapMoreInfo=o?.data})});O(this),this.rootStore=t}},Ho=Dr;p();m();var $t=class{constructor(t){n(this,"swapOnDappBtnLoading",!1);n(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});n(this,"dappPanelVisible",!1);n(this,"setDappPanelVisible",t=>{this.dappPanelVisible=t});n(this,"showDappPanel",()=>{this.setSwapOnDappBtnLoading(!0),this.setDappPanelVisible(!0)});n(this,"hideDappPanel",()=>{this.setSwapOnDappBtnLoading(!1),this.setDappPanelVisible(!1)});n(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),s=!!this.quoteStore?.computedSupportDappTradeByQuote,i=!o&&r,c=o&&r,u=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:s,balance:c||u,kline:c||u,klineJumpMarket:c||u,costValue:e&&c||u,valueDifference:u,liquidity:u,disableInput:i||c,showMax:u,showAddFund:u}});n(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:no.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));n(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});n(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);n(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);n(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);n(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=bo?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});n(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,O(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,s=Array.isArray(r)&&r.find(i=>Number(i.chainId)===Number(e));return this.bridgeSupportDappTrade(s)}};p();m();L();var zt=class{constructor(){this.serviceStatus=null;O(this)}get maintenanceChainsMap(){return this.serviceStatus?Zt(this.serviceStatus?.maintenanceChains,"chainID")??{}:{}}async init(){if(this.serviceStatus!==null&&this.serviceStatus.maintenanceChains?.length===0)return;let t=await Ns();pt(()=>{this.serviceStatus={...t}}),js.setServiceState(t)}};p();m();var Jt=class{constructor({swapServStatusStore:t,chainIdList:e}){this.chainIdList=e,this.swapServStatusStore=t,O(this)}get currChainMaintenanceInfo(){let t=this.swapServStatusStore.maintenanceChainsMap,e=this.chainIdList?.get()?.slice()??[];if(!t||!e.length)return null;for(let o of e){let r=t[o];if(r)return r}return null}get isCurrChainInMaintenance(){return Boolean(this.currChainMaintenanceInfo)}};L();var fe=class extends Vt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new Ao(this),this.outerStore=new Wo(this),this.fromToStore=new _o(this),this.approveStore=new Wt(this),this.quoteStore=new Ki(this),this.tokenModalStore=new Go(this),this.safeMoonStore=new Kt(this),this.walletContractStore=new Bo(this),this.sendTransactionStore=new ko(this),this.intentSwapStore=new Uo(this),this.swapCheckStore=new Ho(this),this.swapStore=new Eo(this),this.swapBtnStore=new Ht(this),this.mevStore=new Vo(this),this.recentTransactionStore=new yo(this),this.facetStore=new Ro(this),this.swapDappStore=new $t(this),this.smartRouterStore=new wo(this),this.slippageStore=new Xt(this),this.oneMoreOrderStore=new Po(this),this.gasDropStore=new Qo,this.swapServStatusStore=new zt,this.chainMaintanceStore=new Jt({swapServStatusStore:this.swapServStatusStore,chainIdList:je(()=>{let{from:e,to:o}=this.fromToStore;return Wr([e.chainId,o.chainId].filter(Boolean))})})});this.reset()}},Ge=fe;n(Ge,"instance",null),n(Ge,"getInstance",()=>(fe.instance||(fe.instance=new fe),fe.instance));var zi=Ge;p();m();p();m();var Yo=class extends Yt{constructor(t){super(t),at(this)}getSearchParams(t){return this.singleSearchParams(t)}};p();m();L();p();m();L();var tc=a=>{let{quoteStore:t,swapStore:e}=E();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},ec=a=>{let{quoteStore:t}=E(),e=a.find(s=>s.defiPlatformId===q),o=t.aggregateSelectId===it?e:a.find(s=>s.defiPlatformId===t.aggregateSelectId),r=S(e,"dexRouterList",[]);return tc(o),Ct({},o||a[0],{dexRouterList:r})},oc=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:s,defiPlatformInfoList:i,traceData:c}=a,u=i.map((d,h)=>({...d,isBest:h===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?s:"0",swapType:r,defiPlatformInfoList:u,traceData:c}}},rc=({bestRoute:a,aggregateInfo:t,isAutoError:e,priorityFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:c})=>{let u=Ct({},a,t);c.updateSlippageInfoFetched(u),c.setAggregateSelectId(u.defiPlatformId),c.setQuote({...c.quote,bestRoute:u,quoteNull:e,quoteError:null,isFetchQuoting:!1,priorityFeeInfo:o,jitoData:r,commonDexInfo:s}),e&&c.setAggregateFetchStatus(4),i.quoteUpdateFromTo(u)},nc=a=>{let{solanaPriorityFeeStore:t}=E();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},Ji=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),r=e.aggregateFetchStatus===3,{bestRoute:s}=oc({data:a,isCompareResult:r}),i=ec(s.defiPlatformInfoList),c=r&&s.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1);let{priorityFeeInfo:u,jitoData:l,commonDexInfo:d}=a;rc({bestRoute:s,aggregateInfo:i,isAutoError:c,priorityFeeInfo:u,jitoData:l,commonDexInfo:d},{fromToStore:t,quoteStore:e}),nc(a),Or(a),wr({isAutoError:c},{approveStore:o}),Be({isAutoError:c},{quoteStore:e})};var Qe=class extends jt{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&k.get(this.outerStore.aggregatorQuoteUrl(),{params:Ct({},e,{defiPlatformIds:q}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{R.stuff(r)})};this.getWalletQuoteParams=e=>{if(this.compareVisible)return e;let o=[];return this.aggregateSelectId!==it&&this.aggregateSelectId!==q?o=[q,this.aggregateSelectId]:o=[q],{...e,defiPlatformIds:ae(o)}};this.handleQuoteParams=async()=>{let e=await wt();if(!this.compareVisible&&mt()){let o=[];this.aggregateSelectId!==it&&this.aggregateSelectId!==q?o=[q,this.aggregateSelectId]:o=[q],e.defiPlatformIds=ae(o)}return e};this.getQuoteData=async e=>{let o=await this.handleQuoteParams();return mt()||this.fetchOKXQuote({params:o,signal:e}),y(le(()=>this.fetchAggregatesQuote({params:o,signal:e}),It.NUM,It.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Ji(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorListPending=!1;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=async()=>{this.setAggregatorListPending(!0),await y(this.initialPropsStore.getInitialProps({key:"aggregatorList",callee:Qe})),this.setAggregatorListPending(!1)};this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e,mt()&&this.fetchQuoteDebounce()};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};at(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await y(k.get(An));if(e)throw e;return S(o,"data",[]).map(s=>({platformId:s.platformId,logo:s.logo}))}fetchAggregatesQuote({params:e,signal:o}){return k.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(it),this.setAggregateFetchStatus(3),r))}get aggregatorList(){return this.initialPropsStore.initialProps.aggregatorList||[]}get computedIsAggregatorListLoading(){return $e()?!this.aggregatorList?.length:this.aggregatorListPending}get computedPriorityFeeInfo(){let e=S(this,"quote.priorityFeeInfo.normal",{})??{};return{mevPriorityFeeInfo:S(this,"quote.priorityFeeInfo.mev.[0]",{})??{},nonMevPriorityFeeInfo:e}}},Zi=Io(Qe);p();m();p();m();L();var Fr=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return ur.map(r=>({type:r,fee:a[`${r}Fee`],usd:a[`${r}FeeUsd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))},ta=a=>{let t={},e=Zt(Fr(a),"type");return Ur(ur).forEach(o=>{t[o]={amount:e[o]?.fee||"",price:e[o]?.usd||""}}),t};var xr=class{constructor(t){n(this,"visible",!1);n(this,"setVisible",t=>{this.visible=t});n(this,"feeType",cr.MARKET);n(this,"setFeeType",t=>{this.feeType=t});n(this,"customFee",null);n(this,"setCustomFee",t=>{this.customFee=t});n(this,"jitoData",null);n(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,at(this)}get computedPriorityFeeList(){return Fr(this.jitoData)}get computedPriorityFeeMap(){return ta(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===cr.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return _.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},ea=xr;var Se=class extends Vt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new Ao(this),this.outerStore=new Wo(this),this.fromToStore=new _o(this),this.approveStore=new Wt(this),this.quoteStore=new Zi(this),this.tokenModalStore=new Yo(this),this.safeMoonStore=new Kt(this),this.walletContractStore=new Bo(this),this.sendTransactionStore=new ko(this),this.intentSwapStore=new Uo(this),this.swapCheckStore=new Ho(this),this.swapStore=new Eo(this),this.swapBtnStore=new Ht(this),this.solanaPriorityFeeStore=new ea(this),this.mevStore=new Vo(this),this.recentTransactionStore=new yo(this),this.facetStore=new Ro(this),this.swapDappStore=new $t(this),this.smartRouterStore=new wo(this),this.slippageStore=new Xt(this),this.oneMoreOrderStore=new Po(this),this.swapServStatusStore=new zt,this.chainMaintanceStore=new Jt({swapServStatusStore:this.swapServStatusStore,chainIdList:je(()=>{let{from:e}=this.fromToStore;return e?.chainId?[e.chainId]:[]})})});this.reset()}},Ve=Se;n(Ve,"instance",null),n(Ve,"getInstance",()=>(Se.instance||(Se.instance=new Se),Se.instance));var oa=Ve;var sc=({localeData:a,...t})=>{Ys();let e=(0,ra.useLocation)(),o;return e.pathname.includes(rt)?o=x.BRIDGE:e.pathname.includes(sn)?o=x.LIMIT_ORDER:e.pathname===tt&&(o=x.SWAP),console.log("log-swap-localData",a),Ko.default.createElement(_s,{localeData:a,isDev:!0,noRemoteData:!0,customRender:r=>r},Ko.default.createElement(zs,{swapRootStore:oa,bridgeRootStore:zi,initTab:o},Ko.default.createElement(_i,{currentTab:o,...t})))},xI=ht(sc);export{xI as default};
//# sourceMappingURL=Advanced-IMREEI6P.js.map
