import{b as G}from"./chunk-ALZVVIHH.js";import{L as w,oa as E,s as M}from"./chunk-SPXYT2VO.js";import{A as I}from"./chunk-UC2GDSBD.js";import{Mb as c,ga as b,jd as v}from"./chunk-LZ43QKYM.js";import{H as y,ea as P,o as F,t as k}from"./chunk-XEVJKE53.js";import{_ as H,j as S}from"./chunk-NLHAZXT3.js";import{a as V}from"./chunk-6YOUVTKE.js";import{f as J,n as u,o as r,q as i}from"./chunk-4J7XGGEQ.js";r();i();var W=J(V());H();var K=e=>Number(e)===1,Y=async()=>{let[,e]=await y(G.get(v,{}));return{loaded:!0,state:S(e,"data.state"),isLimitRegion:K(S(e,"data.isLimitRegion")),maintenanceChains:S(e,"data.maintenanceChains")}},ne=e=>{(0,W.useEffect)(()=>{Y().then(t=>(typeof e=="function"&&e(t),t)).catch(()=>{})},[e])};r();i();r();i();var C=()=>[c.SWAP,c.BRIDGE];r();i();var z=[c.SWAP,c.BRIDGE,c.LIMIT_ORDER],X=()=>{let e=C(),t=e.includes(c.SWAP),n=e.includes(c.BRIDGE),s=e.includes(c.LIMIT_ORDER);return{[c.SWAP]:t,[c.BRIDGE]:n,[c.LIMIT_ORDER]:s,allSupported:t&&n&&s}},Te=()=>b()?!0:!X().allSupported,j=()=>{let e=C();return e.length===1&&z.includes(e[0])},Re=e=>{let t=C();return j()?{tabsSetting:{show:!1,size:I.SIZE.xxl,textShow:e}}:{tabsSetting:{show:!e,size:I.SIZE.xxl,textShow:e},supportBusinessLines:t}},Le=e=>{let t=C();return j()?{tabsSetting:{show:!1,textShow:!e},isFullTab:e,supportBusinessLines:t}:{tabsSetting:{show:e,textShow:!e},isFullTab:e,supportBusinessLines:t}};r();i();r();i();var p={JWT:"jwt",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",PING:"ping",PONG:"pong",LOGIN:"login",LOGOUT:"logout"},T=()=>{};r();i();function f(e,t){!e||e.forEach(n=>{n(t)})}function R(e,t){e?.has(t)&&e.delete(t)}function g(e,t){return F()||e.add(t),()=>R(e,t)}function L(e){return Array.isArray(e)?e:[e]}function m(e){if(!e)return"";let t={};return Object.keys(e).sort().forEach(n=>{t[n]=e[n]}),JSON.stringify(t)}var D=e=>e?e.split(",").map(n=>({token:n})):[];function x(e){switch(e){case"dex-token-candle1m":case"dex-token-candle15m":case"dex-token-candle4H":return e;default:return""}}r();i();r();i();var{SUBSCRIBE:O,UNSUBSCRIBE:Z,PING:$}=p,_=class{constructor(){this.wsInstance=null;this.initDone=!1;this.authenticated=!0;this.disconnected=!1;this.dataFnsMap=new Map;this.channelCache=new Map;this.wsDataCache={};this.errorFnsList=new Set}connect(){if(this.initDone)return;this.initDone=!0;let t=this.getWsUrl();this.wsInstance=new M({connectUrl:t,reconnectTime:1e4,maxPendingTime:2e4}),this.wsInstance.onSocketConnected(this.connectedCallback.bind(this)),this.wsInstance.setPushDataResolver(this.dataCallback.bind(this)),this.wsInstance.onSocketError(this.errorCallback.bind(this)),this.wsInstance.onStatusChange(this.statusCallback.bind(this)),this.wsInstance.onPushDiscontinue(()=>{this.wsInstance.sendChannel($)}),this.wsInstance.connect()}subscribe(t,{needLogin:n}={needLogin:!1}){let s=L(t),o=[];if(s.forEach(a=>{let h=m(a),l=this.channelCache.get(h);if(l){this.channelCache.set(h,l+1);let{channel:A}=a,B=x(A),U=this.wsDataCache[B]?.[h];U&&f(this.dataFnsMap.get(B),U);return}this.channelCache.set(h,1),o.push(a)}),!this.initDone){this.connect();return}!this.isConnected()||n&&!this.authenticated||this.sendChannel({op:O,args:o})}unsubscribe(t){let n=L(t),s=[];n.forEach(o=>{let a=m(o),h=this.channelCache.get(a);if(h>1){this.channelCache.set(a,h-1);return}this.channelCache.delete(a),s.push(o);let l=x(o.channel);l&&delete this.wsDataCache[l]?.[a]}),!(!this.initDone||!this.isConnected())&&this.sendChannel({op:Z,args:s})}sendChannel({op:t,args:n=[]}){this.isConnected()&&n.length&&this.wsInstance.sendChannel(JSON.stringify({op:t,args:n}))}dataCallback(t={}){let{arg:n}=t;if(!n?.channel)return;f(this.dataFnsMap.get(n.channel),t);let s=x(n?.channel);if(!s)return;let o=m(n);this.wsDataCache[s]?this.wsDataCache[s][o]=t:this.wsDataCache[s]={[o]:t}}addListenerData(t,n,s){let{argsParam:o}=s||{},a=m(o);return this.channelCache.get(a)>1&&n({event:O}),this.dataFnsMap.get(t)||this.dataFnsMap.set(t,new Set),this.wsDataCache[t]&&Object.values(this.wsDataCache[t]).forEach(l=>{n(l)}),g(this.dataFnsMap.get(t),n)}remoteListenerData(t,n){return R(this.dataFnsMap.get(t),n)}addListenerError(t){return g(this.errorFnsList,t)}errorCallback(t){this.disconnected=!0,f(this.errorFnsList,t)}connectedCallback(){let t=[];this.channelCache.forEach((n,s)=>{try{t.push(JSON.parse(s))}catch{}}),this.sendChannel({op:O,args:t})}statusCallback(){}isConnected(){return!!this.wsInstance?.isConnected()}getWsUrl(){return""}};var N=class extends _{constructor(){super(...arguments);this.connectedFnsList=new Set;this.authenticated=!1;this.loginResolveFn=T;this.loginRejectFn=T;this.tokens=""}connectedCallback(){super.connectedCallback(),this.tokens&&this.login(this.tokens).then(()=>{this.authenticated=!0,super.connectedCallback(),f(this.connectedFnsList,{disconnected:this.disconnected})}).catch(()=>{w.stuff("ws login fail")})}addListenerConnected(n){return g(this.connectedFnsList,n)}dataCallback(n){let{event:s,code:o}=n;if(s===p.LOGIN){if(Number(o)===0){this.loginResolveFn();return}this.loginRejectFn()}else super.dataCallback(n)}login(n){return new Promise((s,o)=>{this.wsInstance.sendChannel(JSON.stringify({op:p.LOGIN,args:D(n)})),this.loginResolveFn=s,this.loginRejectFn=o})}logout(n){!this.authenticated||!this.isConnected()||(this.authenticated=!1,this.wsInstance.sendChannel(JSON.stringify({op:p.LOGOUT,args:D(n)})))}getWsUrl(){let n=localStorage.getItem("dev_ct_wsPress"),s="",o=P.global?.getWssHostname?.(),a=E.global?.getWssHostname?.();return b()||E.isExtensionEnv?s=`wss://${o||a}`:s=k.socketBaseUrls?.dex,s||w.error("SOCKET_BASE_URL_EMPTY",{oldWallet:o,newWallet:a,webDev:u.env.SOCKET_URL_DEX,web:k.socketBaseUrls?.dex}),n||`${s}/ws/v5/iprivate`}},ot=new N;export{p as a,f as b,g as c,L as d,_ as e,ot as f,Y as g,ne as h,Te as i,Re as j,Le as k};
//# sourceMappingURL=chunk-4NIKWPAL.js.map
