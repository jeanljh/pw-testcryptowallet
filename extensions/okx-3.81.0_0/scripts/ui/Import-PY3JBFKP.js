import{a as Rt}from"./chunk-PQGL6H5C.js";import"./chunk-XIS6W7VE.js";import"./chunk-JHEMUHSU.js";import"./chunk-GXEP5BK5.js";import"./chunk-3BSFGGCJ.js";import"./chunk-6C2G522Z.js";import{a as Dt}from"./chunk-ELHHHA5F.js";import{a as Pt,b as vt,c as Lt}from"./chunk-G23O242T.js";import{a as w,b as bt,d as Mt}from"./chunk-P4PGYDTS.js";import"./chunk-UFGJXE4D.js";import"./chunk-7QX2TXNH.js";import{d as kt}from"./chunk-ZDHJHPQ5.js";import"./chunk-GTQ5U6DA.js";import{a as j}from"./chunk-TE6AOABI.js";import{a as $}from"./chunk-YINA5CY5.js";import{c as ht}from"./chunk-7R6RXU4S.js";import"./chunk-V3ZL5FH4.js";import"./chunk-QRGSOGHH.js";import{c as At}from"./chunk-JBNHZ7EW.js";import{m as Q}from"./chunk-7HYQ2DGP.js";import"./chunk-UOWKDFTX.js";import"./chunk-3ZKJXYZ4.js";import"./chunk-JWVIZID6.js";import"./chunk-47LIW52M.js";import"./chunk-33XRMYWN.js";import"./chunk-ZOKF3EKQ.js";import"./chunk-MDBKHBHQ.js";import"./chunk-WRVJM3F3.js";import"./chunk-NYBKFEEM.js";import"./chunk-XVSXMJ3S.js";import"./chunk-KQ66JTF7.js";import"./chunk-OOYDFTEF.js";import"./chunk-JNIP4OYT.js";import"./chunk-XRCQOGA2.js";import"./chunk-SWUBCABA.js";import"./chunk-EEIYH3NC.js";import"./chunk-H7WHTGUY.js";import{b as F}from"./chunk-7MCLPJAH.js";import"./chunk-WAIJPY5X.js";import{j as wt}from"./chunk-YGMRSF47.js";import"./chunk-6XGS36TZ.js";import{a as Ct}from"./chunk-M2YY6A5T.js";import"./chunk-XLG73W5Q.js";import{b as W,pb as yt}from"./chunk-GCS2RK7E.js";import"./chunk-OIPQWTNV.js";import"./chunk-VJI6MZK4.js";import"./chunk-5PRURJ2O.js";import{u as p}from"./chunk-FGAB46RQ.js";import"./chunk-47ZMUKCZ.js";import"./chunk-Z62JX42S.js";import{Da as It,Ea as Y,Na as _t,aa as V}from"./chunk-2QHGKEME.js";import"./chunk-B624VS3G.js";import"./chunk-W4SQ6335.js";import"./chunk-YDSDBRIT.js";import{a as Ot}from"./chunk-6PA65BO3.js";import"./chunk-OIXGC4LI.js";import"./chunk-MAAUVUWY.js";import"./chunk-4X64L7DZ.js";import"./chunk-WU2LB6XB.js";import"./chunk-GLL4BXR6.js";import"./chunk-4L5HWMAA.js";import"./chunk-EZS2GR7E.js";import"./chunk-NUN72MDU.js";import"./chunk-BFWVIVOY.js";import"./chunk-S3FOFXM7.js";import"./chunk-YIFLUVTR.js";import{c as T,e as z}from"./chunk-EN2WHAVL.js";import{h as Nt}from"./chunk-CP2RIMI2.js";import"./chunk-3QLLFUC4.js";import"./chunk-EFOY37CC.js";import{c as N}from"./chunk-HMTT52FG.js";import{a as Z}from"./chunk-45NMMWRA.js";import"./chunk-E4OV5WXB.js";import"./chunk-GR7YC6C3.js";import"./chunk-O33H5V3V.js";import"./chunk-DJN2J7J5.js";import{b as ct,n as jt}from"./chunk-35ANKHOJ.js";import"./chunk-BI4OEIFC.js";import{ac as xt,nc as Gt}from"./chunk-COF7YKSN.js";import{A as n,K as st}from"./chunk-VZKEX7KP.js";import"./chunk-QCEQQDCM.js";import{H as at,K,o as it}from"./chunk-BJKBO23H.js";import"./chunk-IO3ALUOJ.js";import"./chunk-AHVVUOFF.js";import"./chunk-JLNZTUPO.js";import"./chunk-MSZOM4GC.js";import"./chunk-BYVN72KS.js";import"./chunk-ZUJLXC72.js";import"./chunk-DJSNVDZI.js";import"./chunk-K336SGW3.js";import"./chunk-XFTQD4B2.js";import"./chunk-DIZF7D6Q.js";import"./chunk-JHCCLVAB.js";import"./chunk-W7AONC6R.js";import"./chunk-FOOC6LB7.js";import"./chunk-SEAUBLKM.js";import"./chunk-UP4BZFYG.js";import"./chunk-DHKS44RQ.js";import"./chunk-4DBVFCYR.js";import"./chunk-2IGQWLAB.js";import{a as Et}from"./chunk-GVV6OTQP.js";import{u as U,z as d}from"./chunk-ZFVABNQN.js";import"./chunk-VYWNZTTM.js";import"./chunk-LBWWOQL4.js";import"./chunk-4QGZDIBD.js";import{b as C}from"./chunk-73B6GL3S.js";import"./chunk-LVJGLJNA.js";import"./chunk-Z7PBP7IJ.js";import"./chunk-5F7M5EJ4.js";import"./chunk-RNWGOGLT.js";import"./chunk-UGJ3FMEQ.js";import"./chunk-H6JAOQCX.js";import"./chunk-Z2AIGJGI.js";import"./chunk-VBZ4JSJ6.js";import"./chunk-LBYXY63E.js";import"./chunk-M4ANCDMF.js";import"./chunk-J6KTJ3IN.js";import"./chunk-5CQODPK7.js";import"./chunk-C5XO4JMZ.js";import"./chunk-HI3LE734.js";import"./chunk-RX4V72AK.js";import{f as g,o,q as r}from"./chunk-Y5OH3DDZ.js";o();r();var Kt=g(Ot()),c=g(C()),nt=g(_t());z();st();o();r();var G={container:"_container_1on3b_1",main:"_main_1on3b_7",title:"_title_1on3b_10",subTitle:"_subTitle_1on3b_17",qrCode:"_qrCode_1on3b_23",scanImg:"_scanImg_1on3b_27",scanTip:"_scanTip_1on3b_31",notHaveWalletImg:"_notHaveWalletImg_1on3b_35",notHaveWalletTitle:"_notHaveWalletTitle_1on3b_40",notHaveWalletSubTitle:"_notHaveWalletSubTitle_1on3b_47",scanStatusTip:"_scanStatusTip_1on3b_50",loadingContainer:"_loadingContainer_1on3b_54"};o();r();var J=g(C());z();var lt=g(_t());o();r();z();var X=g(C());var M=()=>{let[t,i]=(0,X.useState)(null);return(0,X.useEffect)(()=>{(async()=>{let a=await T().getMpcToken();i(a)})()},[]),t};var u={IMPORTED:"IMPORTED",NOT_CREATE:"NOT_CREATE",NOT_IMPORTED:"NOT_IMPORTED",TOKEN_EXPIRED:"TOKEN_EXPIRED",ACCOUNT_MISMATCH:"ACCOUNT_MISMATCH",VERIFY_PASS:"VERIFY_PASS",RECOVER:"RECOVER"},Ut=()=>{let t=M(),i=(0,lt.useSelector)(It),a=(0,lt.useSelector)(Y),[_,e]=(0,J.useState)(null);return(0,J.useEffect)(()=>{!t||(async()=>{try{let{data:l}=await vt({},{headers:{Authorization:t}}),{mpcId:m}=l;switch(i){case w.VERIFY:{let f=await T().getMpcIdByWalletId(a);e({...l,accountStatus:f!==m?u.ACCOUNT_MISMATCH:u.VERIFY_PASS});break}case w.RECOVER:{if(m)try{await T().checkMpcIdIsImported(m),e({...l,accountStatus:u.RECOVER})}catch{e({...l,accountStatus:u.IMPORTED})}else e({...l,accountStatus:u.NOT_CREATE});break}case w.IMPORT:case w.NO_ACTION:{if(m)try{await T().checkMpcIdIsImported(m),e({...l,accountStatus:u.NOT_IMPORTED})}catch{e({...l,accountStatus:u.IMPORTED})}else e({...l,accountStatus:u.NOT_CREATE});break}default:break}}catch{e({accountStatus:u.TOKEN_EXPIRED})}})()},[t]),{accountInfo:_}};o();r();var P=g(C());o();r();var tt={img:"_img_18f4s_1",title:"_title_18f4s_6",text:"_text_18f4s_13"};var et=({text:t,title:i,footer:a})=>{let _=Nt({dark:"/cdn/assets/imgs/246/3CD5B03CE6E2FC68.png",light:"/cdn/assets/imgs/246/F1105B2119166F9E.png"});return P.default.createElement(P.default.Fragment,null,P.default.createElement("img",{className:tt.img,src:_,alt:""}),P.default.createElement(p.Text,{className:tt.title,align:p.ALIGN.center},i),P.default.createElement(p.Text,{size:p.SIZE.sm,align:p.ALIGN.center,className:tt.text},t),a)};o();r();var v=g(C());st();o();r();var mt={"retina-border-basic":"_retina-border-basic_2bcuq_1",retinaBorderBasic:"_retina-border-basic_2bcuq_1",main:"_main_2bcuq_29",title:"_title_2bcuq_63"};var Wt=()=>{let t=Z(),i=$(),a=j(),_=()=>{globalThis.open(a.download||`https://${i}/download`)};return v.default.createElement(F,{offsetBottom:0},v.default.createElement(N.FlexBox,{className:mt.main,align:N.ALIGN.center},v.default.createElement(Et,{width:32,height:32,alt:"",src:`${t}/cdn/assets/imgs/237/A229988567261685.png`}),v.default.createElement(p.Text,{size:p.SIZE.md,className:mt.title},n("extension_wallet_qr_title_app_download")),v.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.xs,onClick:_},n("extension_wallet_qr_btn_download"))))};o();r();var s=g(C()),B=g(_t()),Bt=g(Ot());st();z();jt();Gt();o();r();var A=g(C());var Xt=3e3,x={SCAN_NOT:-1,SCAN_SUCCESS:0,SCAN_FAIL:1,SHARE2_UPLOADED:2,SHARE2_UPLOAD_FAIL:3,NET_WORK_ERROR:"NET_WORK_ERROR"},Ft=(t,i)=>{let[a,_]=(0,A.useState)({status:x.SCAN_NOT}),e=M(),l=(0,A.useRef)(null),m=()=>{l.current&&clearInterval(l.current),_({status:x.SCAN_NOT})},f=(0,A.useCallback)(async()=>{try{let{data:E}=await Pt({pubKey:t},{headers:{Authorization:e}}),{status:y,cipherText:h,mpcId:b}=E;_({status:y,cipherText:h,mpcId:b})}catch{_({status:x.NET_WORK_ERROR})}},[t,e]);return(0,A.useEffect)(()=>!t||!i?.mpcId?()=>{m()}:(f(),l.current=setInterval(async()=>{await f()},Xt),()=>{m()}),[t,e,i?.mpcId]),{scanInfo:a,clear:m}};o();r();var I=g(C());o();r();var ot={scanImg:"_scanImg_r7slg_1",scanStatusTip:"_scanStatusTip_r7slg_5",loadingTip:"_loadingTip_r7slg_9"};var L=({onClick:t=()=>{},imgSrc:i,text:a,loading:_=!1})=>{let e=Z();return I.default.createElement(N.FlexBox,{onClick:t,direction:N.DIRECTION.vertical,align:N.ALIGN.center},_?I.default.createElement(I.default.Fragment,null,I.default.createElement(U.Circle,{size:U.SIZE.lg}),I.default.createElement(p.Text,{className:ot.loadingTip,size:p.SIZE.sm},a)):I.default.createElement(I.default.Fragment,null,I.default.createElement("img",{className:ot.scanImg,src:`${e}${i}`,alt:""}),I.default.createElement(p.Text,{className:ot.scanStatusTip,size:p.SIZE.sm},a)))};o();r();var k={container:"_container_7ejxx_1",main:"_main_7ejxx_7",title:"_title_7ejxx_10",subTitle:"_subTitle_7ejxx_17",qrCode:"_qrCode_7ejxx_23",scanImg:"_scanImg_7ejxx_28",scanTip:"_scanTip_7ejxx_32",scanStatusTip:"_scanStatusTip_7ejxx_36"};var Jt="okx_mpc:",te=({accountInfo:t,userInfo:i})=>{let a=(0,Bt.useHistory)(),_=(0,B.useDispatch)(),[e,l]=(0,s.useState)(!1),[m,f]=(0,s.useState)({}),[E,y]=(0,s.useState)(!1),h=(0,B.useSelector)(V),b=(0,B.useSelector)(Y),ut=wt(b),{scanInfo:D,clear:pt}=Ft(m.publicKey,t),Vt=i?.email||"",ft=async()=>{l(!0),y(!1);let R=Dt();try{let O=await R.exec("genRsaPair");f(O)}catch{y(!0)}finally{l(!1)}};(0,s.useEffect)(()=>{ft()},[]);let[Yt,dt]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{let{AesEncodeQRCodeInfo:R}=await ct();if(m.publicKey&&i.uuid){let O={publicKey:m.publicKey,time:Date.now(),uId:i.uuid},q=R(JSON.stringify(O),i.uuid);dt(`${Jt}${q}`);return}dt("")})()},[m,i.uuid]);let H=async()=>{pt(),ft()},zt=(0,s.useCallback)(()=>{if(E)return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_refresh_qr_code")});if(e)return s.default.createElement(L,{loading:!0,onClick:H,text:n("extension_wallet_qr_text_loading")});switch(D.status){case x.SCAN_SUCCESS:return s.default.createElement(L,{imgSrc:"/cdn/assets/imgs/237/0929F8643613BD4F.png",text:n("extension_wallet_qr_text_confirm_mobile")});case x.SCAN_FAIL:case x.SHARE2_UPLOAD_FAIL:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_sync_failed")});case x.NET_WORK_ERROR:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_network_failed")});case x.SHARE2_UPLOADED:default:return null}},[D,E,e]);return(0,s.useEffect)(()=>{(async()=>{let{status:R,cipherText:O,mpcId:q}=D;if(R===x.SHARE2_UPLOADED){let{phone:Qt="",approvedPetname:gt=""}=i,Tt={approvedPetname:gt,phone:Qt,email:Vt,walletName:gt};if(_(Q.setKeepOpen({show:!0})),h){let{RSADecodeQRCodeInfo:Zt}=await ct(),$t=await Zt(O,m.privateKey);if(await T().importMpcWallet({share2:$t,mpcId:q,userInfo:Tt}),Ct(),t.accountStatus===u.RECOVER&&ut?.status?.mpcStatus===Mt.RECOVER&&ut?.keyringIdentityType===xt.MPC){let St=await T().getWalletIdentityByWalletId(b);St?.groupId&&await _(At(St.groupId))}a.push(W)}else await _(ht({cipherText:O,privateKey:m.privateKey,mpcId:q,userInfo:Tt})),a.push(`${yt}?from=${Rt.MPC}`);pt()}})()},[D,m]),s.default.createElement(s.default.Fragment,null,s.default.createElement(K,{className:k.qrCode,level:K.LEVEL.Q,text:Yt,type:K.TYPE.svg,size:232,cornersDotOptions:{type:"dot"},cornersSquareOptions:{type:"dot"},dotsOptions:{type:"dots"},mask:D.status!==x.SCAN_NOT||E||e,renderMaskCon:zt}))},ee=({accountInfo:t,userInfo:i={},accountName:a})=>s.default.createElement("div",{className:k.container},s.default.createElement("div",{className:k.main},s.default.createElement("div",{className:k.title},n("extension_wallet_qr_title_sync_wallet")),s.default.createElement("div",{className:k.subTitle},n("extension_wallet_qr_subtitle_scan_confirm",{acctname:a})),s.default.createElement(te,{accountInfo:t,userInfo:i}),s.default.createElement(p.Text,{className:k.scanTip,size:p.SIZE.sm,align:p.ALIGN.center},n("extension_wallet_qr_text_operational_tips")))),Ht=ee;o();r();var rt=g(C());var qt=()=>{let t=M(),[i,a]=(0,rt.useState)({userInfo:null});return(0,rt.useEffect)(()=>{!t||(async()=>{try{let{data:_,code:e}=await Lt({},{headers:{Authorization:t}});a({userInfo:_,code:e})}catch{a({userInfo:{}})}})()},[t]),i};var oe=()=>{let t=(0,Kt.useHistory)(),i=$(),a=j(),_=(0,nt.useDispatch)(),{userInfo:e,code:l}=qt(),m=(0,nt.useSelector)(V),{accountInfo:f}=Ut(),E=(0,c.useMemo)(()=>e?.phone||e?.email||"",[e]);(0,c.useEffect)(()=>{f&&e&&(f?.accountStatus===u.VERIFY_PASS?(at.success({title:n("extension_wallet_error_toast_verification_successful")}),_(Q.setKeepOpen({show:!0})),T().setMpcAction("",""),t.push(W)):l===0&&at.success({title:n("extension_wallet_qr_toast_login_successful",{acctname:E})}))},[f,e,E,l]);let y=async()=>{T().setMpcAction("","")};if((0,c.useEffect)(()=>(window.addEventListener("beforeunload",y),()=>{window.removeEventListener("beforeunload",y)}),[]),!f||!e)return c.default.createElement("div",{className:G.loadingContainer},c.default.createElement(U.Circle,null));let h=()=>{T().setMpcAction("",""),t.push(W)},b=()=>{switch(f.accountStatus){case u.IMPORTED:return c.default.createElement(et,{title:n("extension_wallet_verification_title_account_duplicate",{acctname:E}),text:n("extension_wallet_verification_text_account_duplicate1"),footer:c.default.createElement(F.FooterActions,{placeholder:!1},c.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:h},n("extension_wallet_verification_btn_return")))});case u.NOT_CREATE:return c.default.createElement(et,{title:n("extension_wallet_login_title_not_created",{acctname:E}),text:n("extension_wallet_login_text_not_created1"),footer:c.default.createElement(Wt,null)});case u.ACCOUNT_MISMATCH:return c.default.createElement(et,{title:n("extension_wallet_verification_title_account_mismatch"),text:n("extension_wallet_verification_text_account_mismatch1"),footer:c.default.createElement(F.FooterActions,{placeholder:!1},c.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:h},n("extension_wallet_verification_btn_return")))});case u.NOT_IMPORTED:case u.RECOVER:return c.default.createElement(Ht,{accountInfo:f,userInfo:e,accountName:E});default:return null}};return c.default.createElement("div",{className:G.container},c.default.createElement(kt,{onBack:h,closeable:!1,bordered:!1}),c.default.createElement("div",{className:G.main},b()),c.default.createElement(it,{visible:f.accountStatus===u.TOKEN_EXPIRED||l!==0,title:n("extension_wallet_error_toast_title_verify_again"),text:n("extension_wallet_error_toast_text_verify_again1"),infoType:it.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:c.default.createElement(d,{category:d.CATEGORY.fill,type:d.TYPE.highlight,size:d.SIZE.md,block:!0,onClick:async()=>{await T().setMpcAction(w.VERIFY,m),globalThis.open(a?.mpcLogin||`https://${i}${bt}`),window.close()}},n("extension_wallet_error_toast_btn_verification"))}))},fr=oe;export{fr as default};
//# sourceMappingURL=Import-PY3JBFKP.js.map
