import{c as g,f as nt}from"./chunk-BFWVIVOY.js";import{J as v,S as O,U as rt,a as h,f as S}from"./chunk-S3FOFXM7.js";import{a as I,k as B,l as Q,r as U,s as Z,v as M,w as tt}from"./chunk-YIFLUVTR.js";import{c as u,e as et}from"./chunk-EN2WHAVL.js";import{b as x,c as G}from"./chunk-GR7YC6C3.js";import{B as k,F as P,J as T}from"./chunk-O33H5V3V.js";import{a as b}from"./chunk-35ANKHOJ.js";import{Gb as w,Sb as X,f as _,g as q,h as c,k as z}from"./chunk-COF7YKSN.js";import{b as y,d as J,f as p,n as process,o as f,q as m}from"./chunk-Y5OH3DDZ.js";var st,ot,at,j,St,$=y(()=>{"use strict";f();m();Q();st=B({name:"keyring",initialState:{keyringIdentities:[],selectedWallet:""},reducers:{setKeyringIdentities:(t,e)=>{t.selectedWallet=e.payload.selectedWallet,t.keyringIdentities=e.payload.keyringIdentities}}}),{actions:ot,reducer:at}=st,{setKeyringIdentities:j}=ot,St=at});function D(t,e){return e===i.LOCALE_TYPE.default?t:`${e}_${t}`}async function a(t,e,r){a.cache||(a.cache={});let n=D(t,e);if(r&&a.cache[n])return a.cache[n];try{let{data:s}=await U(()=>k(x.i18nConfigUrl(t,e)),2,0),o=e===i.LOCALE_TYPE.default?it(s):s;return _.set({[n]:o}),a.cache[n]=o,o}catch(s){L.default.error(s)}return{}}async function R(t,e){let r=D(t,e);return new Promise((n,s)=>{_.get(r).then(o=>{n(o[r])}).catch(o=>{s(o)})})}async function ct(t,e=i.LOCALE_TYPE.default,r=void 0){try{let n={};if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){if(r?.remote)try{return n=await a(t,e,!1),r.storageWallet.set(r.project,r.version),n}catch(s){L.default.error(`failed to fetch ${t} locale because of`,s)}try{n=await R(t,e)}catch{return a(t,e,!0)}if(n&&Object.keys(n).length>0)return(!r||r.remote)&&a(t,e,!0),n}return a(t,e,!0)}catch(n){return L.default.error(`failed to fetch ${t} locale because of`,n),{}}}async function ut(t,e=i.LOCALE_TYPE.default,r=void 0){if(process.env.PLATFORM_WEB)return ct(t,e,r);try{let n={};return(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH)&&(n=await R(t,e)),{...await(await fetch(`/${e}/${t}/messages.json`)).json(),...n}}catch(n){return L.default.error(`failed to fetch ${t} locale because of`,n),{}}}async function d(t,e=i.LOCALE_TYPE.default,r=!0){if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){let n=await a(t,e,r);if(n)return n}return ut(t,e)}async function Bt(t){a(t,i.LOCALE_TYPE.default,!1),a(t,i.LOCALE_TYPE.dex,!1),a(t,i.LOCALE_TYPE.okd,!1),a(t,i.LOCALE_TYPE.defi,!1)}var L,i,it,Y=y(()=>{"use strict";f();m();L=p(I());q();i=p(b());G();z();T();Z();it=(t={})=>{let e={};return Object.entries(t).forEach(([r,n])=>{e[r]={message:n}}),e}});var yt={};J(yt,{forceUpdateLightState:()=>V,forceUpdateMetamaskState:()=>mt,getChainInfo:()=>ft,getCurrentWindowTab:()=>pt,lockMetamask:()=>Lt,setCurrentLocale:()=>C,setCurrentWindowTab:()=>F,setLastActiveTime:()=>lt,updateAccountIdentities:()=>E,updateCurrentLocale:()=>N,updateMetamaskState:()=>A,updatePartialMetamaskState:()=>dt});function C(t,e,r,n,s,o){return{type:v,value:{locale:t,messages:e,okdMessages:r,dexMessages:n,discoverMessages:s,defiMessages:o}}}async function ft(){await u().getChainsFromServerAndSyncToControllers()}function N(t){return async e=>{try{let r=await d(t),n=await d(t,l.LOCALE_TYPE.okd),s=await d(t,l.LOCALE_TYPE.dex),o=await d(t,l.LOCALE_TYPE.discover),H=await d(t,l.LOCALE_TYPE.defi);await u().setCurrentLocale(t),e(C(t,r,n,s,o,H)),P(t)}catch(r){e(g(r.message))}}}function E(t,e,r=!0){Array.isArray(t.accountIdentities)&&Array.isArray(t.keyringIdentities)&&(e(j(M({accountIdentities:t.accountIdentities,keyringIdentities:t.keyringIdentities,multiAddressBaseChainsMap:t.multiAddressBaseChainsMap,selectedWallet:t.selectedWallet}))),r&&(delete t.accountIdentities,delete t.keyringIdentities,delete t.multiAddressBaseChainsMap,delete t.selectedWallet))}function A(t){return(e,r)=>{let{metamask:n}=r(),{currentLocale:s}=n,{currentLocale:o}=t;s&&o&&s!==o&&e(N(o)),E(t,e),e({type:h,value:t})}}async function mt(t){let e;try{e=await u().getStateByDomain()}catch(r){throw t(g(r.message)),r}return t(A(e)),e}function dt(t){return e=>{t.chainList&&w(t.chainList),E(t,e),e({type:h,value:t})}}function Lt(){return K.default.debug("background.setLocked"),async t=>{try{await gt(),await V(t),t({type:S})}catch{t({type:S})}}}function lt(){return async t=>{try{await u().setLastActiveTime()}catch(e){t(g(e.message))}}}function F(t){return{type:O,value:t}}function pt(){return async t=>{let e=await globalThis.platform.currentTab();t(F(e))}}var K,l,V,gt,_t=y(()=>{"use strict";f();m();K=p(I());nt();$();l=p(b());X();T();Y();tt();et();rt();V=async t=>{let e;try{e=await u().getState()}catch(r){throw t(g(r.message)),r}return t(A(e)),e};gt=async()=>{await u().setLocked()}});export{St as a,$ as b,ut as c,Bt as d,Y as e,ft as f,N as g,E as h,A as i,mt as j,V as k,dt as l,Lt as m,lt as n,pt as o,yt as p,_t as q};
//# sourceMappingURL=chunk-NUN72MDU.js.map
