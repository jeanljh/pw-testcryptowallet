import{a as _,b as Bt}from"./chunk-IEVC45OC.js";import{a as Nt}from"./chunk-VL3NMULI.js";import{a as It}from"./chunk-TULNXNFS.js";import"./chunk-PDSFU775.js";import{a as nt,b as kt}from"./chunk-5HEWLWJF.js";import{a as Ct}from"./chunk-ST36LCJU.js";import"./chunk-CRK64DJ6.js";import{a as V}from"./chunk-CNG7KSJN.js";import"./chunk-WY5R5HAR.js";import{c as G}from"./chunk-YTR7GLCK.js";import{a as At,b as xt,c as bt,d as wt}from"./chunk-GNW7QJWA.js";import"./chunk-3DJSYHH7.js";import{da as pt}from"./chunk-MSFAPAHB.js";import{b as W}from"./chunk-7MCLPJAH.js";import{a as ot}from"./chunk-WAIJPY5X.js";import"./chunk-XLG73W5Q.js";import{Xa as U,Ya as H}from"./chunk-GCS2RK7E.js";import"./chunk-5PRURJ2O.js";import"./chunk-47ZMUKCZ.js";import{o as ne}from"./chunk-Z62JX42S.js";import{Na as St}from"./chunk-2QHGKEME.js";import"./chunk-HAHRUU64.js";import{a as ht}from"./chunk-6PA65BO3.js";import{j as gt,q as oe}from"./chunk-NUN72MDU.js";import{c as yt,f as ee}from"./chunk-BFWVIVOY.js";import"./chunk-S3FOFXM7.js";import"./chunk-YIFLUVTR.js";import{c as O,e as ft}from"./chunk-EN2WHAVL.js";import"./chunk-CP2RIMI2.js";import{B as mt}from"./chunk-EFOY37CC.js";import{c as d}from"./chunk-HMTT52FG.js";import"./chunk-45NMMWRA.js";import"./chunk-GR7YC6C3.js";import"./chunk-O33H5V3V.js";import"./chunk-DJN2J7J5.js";import"./chunk-35ANKHOJ.js";import"./chunk-BI4OEIFC.js";import{B as at,C as ut,J as $t,ac as _t,nc as te}from"./chunk-COF7YKSN.js";import{A as l,K as F,o as E}from"./chunk-VZKEX7KP.js";import"./chunk-QCEQQDCM.js";import{D as L,q as ct,w as lt}from"./chunk-BJKBO23H.js";import"./chunk-IO3ALUOJ.js";import"./chunk-DJSNVDZI.js";import"./chunk-K336SGW3.js";import"./chunk-XFTQD4B2.js";import"./chunk-FOOC6LB7.js";import"./chunk-DHKS44RQ.js";import"./chunk-4DBVFCYR.js";import"./chunk-2IGQWLAB.js";import"./chunk-GVV6OTQP.js";import{z as g}from"./chunk-ZFVABNQN.js";import"./chunk-VYWNZTTM.js";import"./chunk-LBWWOQL4.js";import{a as dt}from"./chunk-4QGZDIBD.js";import{b as x}from"./chunk-73B6GL3S.js";import"./chunk-LVJGLJNA.js";import"./chunk-Z7PBP7IJ.js";import"./chunk-5F7M5EJ4.js";import"./chunk-RNWGOGLT.js";import"./chunk-UGJ3FMEQ.js";import"./chunk-H6JAOQCX.js";import"./chunk-Z2AIGJGI.js";import"./chunk-J6KTJ3IN.js";import"./chunk-5CQODPK7.js";import"./chunk-C5XO4JMZ.js";import"./chunk-HI3LE734.js";import"./chunk-RX4V72AK.js";import{f as p,o as e,q as o}from"./chunk-Y5OH3DDZ.js";e();o();var X=p(x()),M=p(ht());e();o();var v=p(x());e();o();var z=p(x());e();o();e();o();var Et=p(x());e();o();var P=ot(xt,wt),Y=ot(At,bt);e();o();var Tt=p(ht());function re(){let t=(0,Tt.useHistory)(),n=s=>(y=!0)=>{y?t.replace(s):t.push(s)},r=s=>t.location.pathname===s,i=n(H),u=n(U),m=r(U),a=r(H);return{isHomePage:m,isAddPage:a,gotoAddPage:i,gotoHomePage:u}}var j=re;function se(){let[t]=P(),{gotoHomePage:n,isHomePage:r}=j();(0,Et.useLayoutEffect)(()=>{!r&&!t&&n()},[n,r,t])}var Ft=se;function ie(){return Ft(),null}var Lt=ie;e();o();var rt={root:"_root_dowdc_1",header:"_header_dowdc_30"};function ae({children:t,hidden:n=!1}){return z.default.createElement(d.Box,{className:rt.root},z.default.createElement(It,{className:rt.header}),n?null:t,z.default.createElement(Lt,null))}var Z=ae;e();o();var b=p(x()),q=p(dt());F();$t();e();o();var k={root:"_root_1gfwy_1",actions:"_actions_1gfwy_21",adding:"_adding_1gfwy_38",finish:"_finish_1gfwy_52",tip:"_tip_1gfwy_88",hiddenTip:"_hiddenTip_1gfwy_154",mobileFinishActions:"_mobileFinishActions_1gfwy_162"};function ue(t){let{isSm:n}=G(),{status:r,cancel:i,download:u,finish:m}=t,a=r===_.ADDING,s=mt(),y=n?W:d.Box,S=n&&!a?{offsetBottom:0,className:(0,q.default)(k.actions,k.mobileFinishActions)}:{};return b.default.createElement(d.Box,{className:k.root},b.default.createElement(y,{className:(0,q.default)(k.actions,a?k.adding:k.finish),...S},a?b.default.createElement(b.default.Fragment,null,b.default.createElement(g,{category:g.CATEGORY.outline,type:g.TYPE.primary,onClick:i,size:g.SIZE.xl,block:!0},l("wallet_extension_addaccount_adding_btn_cancel"))):b.default.createElement(b.default.Fragment,null,s!==at&&s!==ut&&b.default.createElement(g,{category:g.CATEGORY.outline,type:g.TYPE.primary,size:g.SIZE.xl,onClick:kt(pt)(u),block:n},l("wallet_extension_addaccount_adding_btn_download_address")),b.default.createElement(g,{category:g.CATEGORY.fill,type:g.TYPE.highlight,size:g.SIZE.xl,onClick:m,block:n},l("wallet_extension_addaccount_adding_btn_confirm")))),b.default.createElement(d.Box,{className:(0,q.default)(k.tip,!a&&k.hiddenTip)},a?l("wallet_extension_addaccount_adding_text_not_close"):""))}var vt=ue;e();o();var J=p(x());F();e();o();var R={root:"_root_1n2pz_1",item:"_item_1n2pz_75",retry:"_retry_1n2pz_98"};e();o();F();var me=({status:t,success:n=0,total:r=0,failed:i=0})=>{let m=_.FINISHED===t?r-n:i,a={success:{key:"wallet_extension_addaccount_adding_text_create_success",params:{num:E.thousandFormat(n)}},failed:{key:"wallet_extension_addaccount_adding_text_create_failed",params:{num:E.thousandFormat(m)},withRetry:m>0},adding:{key:"wallet_extension_addaccount_remainder_created_account",params:{successnum:E.thousandFormat(n),totalnum:E.thousandFormat(r)}}};return{items:{[_.NONE]:[],[_.ADDING]:[a.adding],[_.FINISHED]:m>0?[a.success,a.failed]:[a.success],[_.FAILED]:[a.failed]}[t]}},Pt=me;function de(t){let{items:n=[]}=Pt({status:t.status,success:t.success,total:t.total,failed:t.failed}),{retry:r}=t;return J.default.createElement(d.Box,{className:R.root},n.map((i,u)=>{let{key:m,params:a,withRetry:s}=i;return J.default.createElement(d.Box,{key:u,className:R.item},l(m,a),s&&J.default.createElement(d.Box,{onClick:r,className:R.retry},l("wallet_extension_addaccount_adding_textbtn_retry")))}))}var Dt=de;e();o();var Ut=p(x()),Ht=p(dt());F();e();o();var Ot={root:"_root_x2b1d_1"};var ce=({status:t,className:n,walletName:r})=>{let u={[_.NONE]:null,[_.ADDING]:{key:"wallet_extension_addaccount_remainder_account_creating",params:{acctName:r}},[_.FINISHED]:{key:"wallet_extension_addaccount_remainder_account_created"},[_.FAILED]:{key:"wallet_extension_addaccount_adding_maintitle_create_failed"}}[t],m=u?l(u.key,u.params):"";return Ut.default.createElement(d.Box,{className:(0,Ht.default)(Ot.root,n)},m)},Kt=ce;e();o();var Mt={root:"_root_1uqqr_1"};e();o();var w=p(x()),Vt=p(St()),Yt=p(ne());e();o();var Wt=p(St());ee();oe();ft();var le=()=>{let t=(0,Wt.useDispatch)();return async(r,i=1)=>{try{return await O().addNewWallets(r,i)}catch(u){throw t(yt(u?.message)),u}finally{await gt(t)}}},Gt=le;ft();var _e=t=>{let{newAccountsSuccessCount:n,newAccountsFailedCount:r}=t.metamask;return{newAccountsSuccessCount:n,newAccountsFailedCount:r}},fe=t=>t>0,pe=(t,n,r)=>r!==void 0?!1:t>0||!fe(n),ye=t=>t||"",ge=t=>{let[n,r]=(0,w.useState)(_.NONE),{newAccountsSuccessCount:i,newAccountsFailedCount:u}=(0,Vt.useSelector)(_e),m=nt(),a=(0,w.useRef)({}),[s]=Y(),[y,S]=(0,w.useState)(0),[A,C]=(0,w.useState)(0),h=Gt(),N=s-y;(0,w.useEffect)(()=>{s<=0||(y===s&&r(_.FINISHED),A===s&&r(_.FAILED))},[A,y,s]);let B=async it=>{if(pe(y,s,it))return;let tt=it||s;r(_.ADDING);try{let et=await h(ye(t),tt);S(Xt=>Xt+et),C(tt-et)}catch{C(tt)}finally{r(_.FINISHED)}};return{start:B,cancel:()=>{r(_.FINISHED),a.current?.cancel?.(),O().stopBatchAddNewWallets()},retry:()=>{N>0&&(C(0),B(N))},failed:m?A+u:A,success:m?y+i:y,total:s,remain:N,status:n}},Ae=t=>{let{keyringIdentities:n,remainAccountAmount:r}=V(),i=n.find(m=>m.keyringId===t),u=i?.walletIdentities?.[0]?.walletId;return{keyring:i,walletId:u,remainAccountAmount:r}};function xe(){let[t]=P(),n=nt(),r=(0,Yt.useLatest)(n),{walletId:i,keyring:u,remainAccountAmount:m}=Ae(t),a=(0,w.useRef)(!1),{start:s,cancel:y,retry:S,success:A,failed:C,total:h,status:N}=ge(i),B=Nt();return(0,w.useEffect)(()=>{!a.current&&i&&m>0&&(s(),a.current=!0)},[i,m,s]),(0,w.useEffect)(()=>{let T=async()=>{r.current===!0&&O().stopBatchAddNewWallets()};return window.addEventListener("beforeunload",T),()=>{window.removeEventListener("beforeunload",T)}},[]),{start:s,cancel:y,retry:S,success:A,failed:C,total:h,keyring:u,status:N,onFinish:B}}var jt=xe;var be=()=>{let{cancel:t,retry:n,success:r,failed:i,total:u,keyring:m,status:a,onFinish:s}=jt(),{downloadAddress:y}=Ct();return v.default.createElement(Z,{hidden:a===_.NONE},v.default.createElement(d.Box,{className:Mt.root},v.default.createElement(Bt,{status:a}),v.default.createElement(Kt,{status:a,walletName:m?.keyringName}),v.default.createElement(Dt,{status:a,retry:n,total:u,failed:i,success:r}),v.default.createElement(vt,{status:a,cancel:t,download:y,finish:s})))},zt=be;e();o();var K=p(x());e();o();var f=p(x());F();e();o();var I={root:"_root_1umy7_2",confirm:"_confirm_1umy7_41",max:"_max_1umy7_55",label:"_label_1umy7_67",name:"_name_1umy7_73",nums:"_nums_1umy7_80",option:"_option_1umy7_86",icon:"_icon_1umy7_105"};e();o();var Zt=p(x());F();te();var we=t=>t.filter(n=>[_t.MNEMONIC].includes(n.keyringIdentityType)).filter(n=>n.walletIdentities.every(r=>r.needBackup!==1)),st=1;function Se(){let t=L.useForm(),{gotoAddPage:n}=j(),{keyringIdentities:r,remainAccountAmount:i}=V(),[,u]=Y(),[,m]=P(),a=h=>{if(Object.keys(t.getErrors()).length>0)return;let{keyringId:B,amount:T}=h;if(T==="0")return;let $=Number(T||st);!B||$>i||(u($),m(B),n())},s=(0,Zt.useMemo)(()=>we(r).map(h=>({value:h.keyringId,label:h.keyringName,len:h.walletIdentities.length})),[r]),y={keyringId:s[0]?.value,amount:""},S=(h,N=st)=>{if(Number(N||st)<=i&&i>0)return Promise.resolve();let T=l("wallet_extension_addaccount_remainder_added_upper_limits",{num:E.thousandFormat(i)});return Promise.reject(T)},A=()=>{t.setFieldsValue({amount:i})},C=i<=0||s.length<=0;return{initialValues:y,onSubmit:a,form:t,options:s,amountValidator:S,onSetMaxAmount:A,disableAdd:C}}var qt=Se;function he(){let{initialValues:t,onSubmit:n,form:r,options:i,amountValidator:u,onSetMaxAmount:m,disableAdd:a}=qt(),{isSm:s}=G(),y=s?W.FooterActions:f.default.Fragment,S=A=>f.default.createElement(f.default.Fragment,null,f.default.createElement("div",{className:I.name},A.label),f.default.createElement("div",{className:I.nums},l("wallet_extension_batch_modify_account_num",{num:A.len})));return f.default.createElement(d.Box,{className:I.root},f.default.createElement(L,{requiredMark:!0,initialValues:t,onSubmit:n,form:r},f.default.createElement(L.Item,{label:l("wallet_extension_addaccount_title_select_wallet"),name:"keyringId"},f.default.createElement(lt,{title:l("wallet_extension_addaccount_title_select_wallet"),options:i,searchable:!1,showSelectedIcon:!0,label:A=>f.default.createElement("div",{className:I.label},S(A)),renderOption:({option:A,activeIcon:C})=>f.default.createElement("div",{className:I.option},A&&f.default.createElement("div",null,S(A)),f.default.createElement("div",{className:I.icon},C))})),f.default.createElement(L.Item,{label:l("wallet_extension_addaccount_text_added_amount"),name:"amount",rules:[{validator:u}]},f.default.createElement(ct.Number,{placeholder:"1",precision:0,min:1,suffix:f.default.createElement(d.Box,{className:I.max,onClick:m},l("wallet_extension_addaccount_textbtn_max"))})),f.default.createElement(y,null,f.default.createElement(L.Item,{noStyle:!0,className:s?void 0:I.confirm},f.default.createElement(g,{category:g.CATEGORY.fill,type:g.TYPE.highlight,size:g.SIZE.xl,disabled:a,htmlType:"submit",block:!0},l("wallet_extension_addaccount_btn_add"))))))}var Rt=he;e();o();var Q=p(x());F();e();o();var D={root:"_root_5jwcg_1",titleBox:"_titleBox_5jwcg_17",title:"_title_5jwcg_17",subtitle:"_subtitle_5jwcg_112",add:"_add_5jwcg_131"};var Ce=()=>{let t=l("wallet_extension_addaccount_title_add_account"),n=l("wallet_extension_addaccount_subtitle_select_account");return Q.default.createElement(d.Box,{className:D.titleBox},Q.default.createElement(d.Box,{className:D.title},t),Q.default.createElement(d.Box,{className:D.subtitle},n))},Jt=Ce;var ke=()=>K.default.createElement(Z,null,K.default.createElement(d.Box,{className:D.root},K.default.createElement(Jt,null),K.default.createElement(Rt,null))),Qt=ke;var Ie=()=>X.default.createElement(M.Switch,null,X.default.createElement(M.Route,{path:U,component:Qt,exact:!0}),X.default.createElement(M.Route,{path:H,component:zt,exact:!0})),Hr=Ie;export{Hr as default};
//# sourceMappingURL=BatchAddAccount-G5DV2RU3.js.map
