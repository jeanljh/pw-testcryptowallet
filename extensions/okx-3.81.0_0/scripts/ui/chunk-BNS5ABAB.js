import{a as re}from"./chunk-WY5R5HAR.js";import{a as Pe,b as Te,d as Ae,g as j}from"./chunk-V7ZNWTMX.js";import{d as ee,e as ne}from"./chunk-MSP5TDR3.js";import{a as ue,c as pe,e as he,f as ge,g as X}from"./chunk-QKBWJPY2.js";import{K as ye,O as de,P as L,Q as J}from"./chunk-3ZKJXYZ4.js";import{a as $,b as M,c as be}from"./chunk-MDBKHBHQ.js";import{h as K}from"./chunk-YGMRSF47.js";import{f as Z}from"./chunk-FGAB46RQ.js";import{o as Y}from"./chunk-Z62JX42S.js";import{Ha as Ce,Na as W,l as me,la as _,ma as E}from"./chunk-2QHGKEME.js";import{a as x,b as I}from"./chunk-EFOY37CC.js";import{Wb as fe,_b as Ue,lb as ae,rb as le,tb as ke}from"./chunk-COF7YKSN.js";import{K as ie,o as w,u as G}from"./chunk-VZKEX7KP.js";import{I as z,M as N,f as se,va as We,z as V}from"./chunk-XFTQD4B2.js";import{b as H}from"./chunk-73B6GL3S.js";import{b as Fe}from"./chunk-Z7PBP7IJ.js";import{f as b,o as P,q as T}from"./chunk-Y5OH3DDZ.js";P();T();var A=b(H()),q=b(W()),p=b(Y());We();ie();P();T();var Be=b(H()),Se=b(W());function xe(){let e=M(),n=(0,Se.useDispatch)();return(0,Be.useCallback)(async t=>{let r=await n(Pe(t)),c={};return r&&Object.entries(r).forEach(([o,s])=>{let u=[];s.forEach(i=>{let l;"childrenCoin"in i&&i.childrenCoin?.length&&(l=i.childrenCoin?.map(m=>({...m,currencyAmount:x(m.currencyAmountUSD,e.usdToThisRate)}))),u.push({...i,childrenCoin:l,currencyAmount:x(i.currencyAmountUSD,e.usdToThisRate)})}),c[o]=u}),c},[e.usdToThisRate,n])}P();T();var Re=b(H()),we=b(W()),k=b(Y());var te=()=>{let e=(0,we.useSelector)(_),n=j();return(0,k.useCreation)(()=>{let t={},{symbol:r}=e;return Object.keys(n).forEach(c=>{t[c]={currencySymbol:r,usdPrice:n?.[c]?.coinToUSDRate,currencyPrice:x(n?.[c]?.coinToUSDRate,e?.usdToThisRate),priceChangePercent24h:n?.[c]?.coinPriceChangePercent24h}}),t},[n,e])},Ne=e=>{let n=te(),t=M(),{data:r,run:c}=(0,k.useRequest)(L,{manual:!0,ready:!0,retryCount:3,staleTime:36e5,cacheTime:864e5});return(0,Re.useEffect)(()=>{!n[e]&&ye(e)&&c(+e)},[n,e]),(0,k.useCreation)(()=>{let o=n[e];if(o)return o;if(r&&t){let{currencyAmount:s,priceChangePercent24h:u}=r;return{currencySymbol:t.symbol,usdPrice:s,currencyPrice:x(s,t.usdToThisRate),priceChangePercent24h:u}}return null},[n,e,t,r])};P();T();var _e=b(W());function oe(){return(0,_e.useSelector)(me)}ke();Ue();var ve=e=>!!e&&!Number.isNaN(e),U=(e={})=>{let n=re(),t=$(),r=oe(),c=te(),o=j(),s=(0,p.useLatest)(n),u=(0,p.useLatest)(c),i=(0,p.useLatest)(o),{withPrice:l=!1,withPriceChangePercent24h:m=!1}=e||{},[y,h]=(0,A.useState)(void 0),{runAsync:g}=(0,p.useRequest)(J,{manual:!0,cacheKey:y,retryCount:3,staleTime:36e5,cacheTime:864e5});return(0,A.useCallback)(async(f,a)=>{if(f===0||!r||Number.isNaN(f))return null;let d;if(typeof f<"u")d=s?.current?.[f];else if(a){let C=Object.values(n);if(a.aggregation&&a.symbol)return t[a.symbol]?{...t[a.symbol][0],childrenCoin:t[a.symbol]}:null;if(ne(a)){let R=G(C,a);R.length>0&&(d=R[0])}}if(!d&&f!==0){let C;typeof f<"u"&&!Number.isNaN(f)?C={coinId:f}:a&&(C=!z(a)&&de(a)?a:null),C&&(h(ee(C)),d=await g(C))}if(!d)return null;let B;if((l||m)&&!s?.current?.[f]&&(B=await L(d.coinId)),l){let{currencySymbol:C,usdPrice:S,currencyPrice:R}=u?.current?.[f]??B??{};d={...d,currencySymbol:C,usdPrice:S,currencyPrice:R}}if(m){let C=i?.current?.[f]?.coinPriceChangePercent24h??B?.priceChangePercent24h;d={...d,priceChangePercent24h:C}}return d},[l,m,n,t,g,r])},Oe=(e,n,t)=>(0,p.useCreation)(()=>{let r;if(!(t||e===0)&&(typeof e<"u"&&!Number.isNaN(e)?r={coinId:e}:r=z(n)?null:n,r))return ee(r)},[e,n,t]),D=(e,n={},t)=>{let r=$(),c=re(),o=oe(),{withPrice:s,withPriceChangePercent24h:u}=n,i=be(t),l=[e,c,r,i,o],m=[],y=(0,p.useCreation)(()=>{let C;if(e===0||!o||Number.isNaN(e))return null;if(typeof e<"u")C=c?.[e];else if(i){let S=Object.values(c);if(i.aggregation&&i.symbol)return r[i.symbol]?{...r[i.symbol][0],childrenCoin:r[i.symbol]}:null;if(ne(i)){let O=G(S,i);O.length>0&&(C=O[0])}}return C||null},l),h=!!y,g=Oe(e,i,h),{data:f,run:a}=(0,p.useRequest)(J,{manual:!0,ready:!0,cacheKey:g,retryCount:3,staleTime:36e5,cacheTime:864e5});(0,A.useEffect)(()=>{if(!h&&o&&!!g){let C=ve(e)?{coinId:e}:i;a(C)}},[h,o,g,e,i]);let d=y||f,B=Ne(s||u?d?.coinId:null);return m.push(d,B),(0,p.useCreation)(()=>{if(!d)return null;let C=d;if(s&&B){let{currencySymbol:S,usdPrice:R,currencyPrice:O}=B;C={...C,currencySymbol:S,usdPrice:R,currencyPrice:O}}if(u){let{priceChangePercent24h:S}=B;C={...C,priceChangePercent24h:S}}return C},m)},Ee=e=>{let n=U(e),t=K(),r=Ae(),c=xe();return(0,p.useMemoizedFn)(async(o,s)=>{let u=await n(o);if(!u)return null;let i;s&&s!==t?i=(await c({walletIds:[s],coinId:o,chainId:u.chainId,flatten:!0}))[s]??[]:i=r;let{coinAmountInt:l="0",currencyAmount:m="0",currencyAmountUSD:y="0"}=V(i,h=>h?.coinId===o)||{};return{...u,coinAmountInt:l,currencyAmount:m,currencyAmountUSD:y,coinAmount:I(l,10**u?.decimals)}},[r,t,n])};function Le(e,{key:n,coinId:t,addressType:r,localType:c}){return V(e,o=>{let s;if(n?s=o.key===n:s=o.coinId===t,r){let u=fe[le(c)]?.[r];s=s&&u===o?.addressType}return s})}function Ke(e,n,t){let{data:r,error:c,loading:o,runAsync:s}=(0,p.useRequest)(ge,{manual:!0}),u=M(),i=(0,q.useSelector)(Ce),l=K(),m=(0,q.useDispatch)(),y=(0,p.useMemoizedFn)(async()=>{if(e&&n){let g={userUniqueId:i,currentAccountId:l,coinId:e,accountIds:[n]};t&&(g.addressType=t);let f=await s(g);if(l!==n||!l||!f)return;if(he(l))m(X({walletIds:[l],pushData:{channel:"wallet-asset",data:f}}));else{let a=!1;try{a=await ue({accountId:l,coinId:e,balanceData:{coinAmount:f.coinAmountOriginalDec,coinAmountInt:f.coinAmount,currencyAmountUSD:f.currencyAmount},symbol:f.symbol,addressType:f.addressType,subBalanceType:f.subBalanceType})}catch{se()}a===null?m(X({walletIds:[l]})):a&&m(pe(a))}}});(0,A.useEffect)(()=>{y()},[e,n,l,i,y]),(0,A.useEffect)(()=>{},[e,n]);let h=(0,p.useCreation)(()=>{if(r)return{coinAmount:r.coinAmountOriginalDec,coinAmountInt:r.coinAmount,currencyAmount:x(r.currencyAmount,u?.usdToThisRate??"1")}},[r,u]);return{loading:o,error:c,balance:h,request:y}}var je=(e,n,t)=>{let{addressType:r,key:c,withBalanceStatus:o}=t||{},s=D(e,t,c?{key:c}:void 0),u=K(),i=n||u,l=Te(i),m=Ke(o?e:null,i,r),y=(0,p.useCreation)(()=>o?typeof m.balance<"u"||!!m.error:!!l,[o,m.balance,m.error,l]),h=(0,p.useCreation)(()=>N(e)&&N(c)?null:o?m.balance:Le(l?.coins||[],{key:c,coinId:e,addressType:r,localType:s?.localType}),[l?.coins,i,e,r,c,s?.localType,o,m.balance]),{coinAmountInt:g,currencyAmount:f}=h||{};return(0,p.useCreation)(()=>{if(N(e)&&N(c)||!s)return null;let a={...s,coinAmountInt:g,currencyAmount:f};return o&&(a.requestBalance=m.request,a.isBalanceLoading=!y,a.isBalanceLoadError=!!m.error),N(g)?y?(a.coinAmountInt="0",a.coinAmount="0",a.currencyAmount="0",a.currencyAmountUSD="0",a):(a.coinAmount=void 0,a):(a.coinAmount=I(g,10**s.decimals),a)},[s,g,y,l,o,e])},qe=(e,n)=>{let t=D(e,n),r=D(t?.baseCoinId,n);return[t,r||t]},Me=e=>{let n=U(e);return(0,p.useMemoizedFn)(async t=>{let r=await n(t),c=await n(r?.baseCoinId);return[r,c||r]},[n])};var Qe=(e={})=>{let n=Me(e);return(0,p.useMemoizedFn)(async t=>{let[,r]=await n(t),c=r?.coinId;return ae.indexOf(c)!==-1},[n])},vn=(e,n={})=>{let t=Qe(n),[r,c]=(0,A.useState)(!1);return(0,p.useAsyncEffect)(async()=>{let o=await t(e);c(o)},[t]),r};P();T();P();T();var Q=b(W()),v=b(Y()),ce=b(Fe());ie();var Ve=(e={})=>{let{currencyId:n,formatted:t=!0,useApproximate:r}=e||{},{symbol:c,usdToThisRate:o}=(0,Q.useSelector)(u=>typeof n!="number"?_(u):E(u,n)),s=U({withPrice:!0});return(0,v.useMemoizedFn)(async(u,i)=>{let l=await s(u),m=w.div(i,10**l?.decimals),y=w.mul(l?.usdPrice,o),h=w.mul(m,y);return t?Z(h,{useApproximate:r,currencySign:c}).value:h})},De=(e,n,t={})=>{let{currencyId:r,useMinPrecision:c=!0}=t||{},o=D(e,{withPrice:!0}),{usdToThisRate:s}=(0,Q.useSelector)(u=>typeof r!="number"?_(u):E(u,r));return(0,v.useCreation)(()=>{if((0,ce.isNil)(o?.usdPrice))return null;let u=c?w.div(n,10**o?.decimals):n,i=w.mul(o?.usdPrice,s);return w.mul(u,i)},[s,n,o?.usdPrice,o?.decimals,c])},ze=(e,n,t={})=>{let{currencyId:r,useApproximate:c}=t||{},o=De(e,n,t),{symbol:s}=(0,Q.useSelector)(u=>typeof r!="number"?_(u):E(u,r));return(0,v.useCreation)(()=>(0,ce.isNil)(o)?"":Z(o,{currencySign:s,useApproximate:c}).value,[s,o,c])};export{xe as a,oe as b,U as c,D as d,Ee as e,je as f,qe as g,vn as h,Ve as i,De as j,ze as k};
//# sourceMappingURL=chunk-BNS5ABAB.js.map
