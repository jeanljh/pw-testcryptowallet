import{o as y}from"./chunk-Z62JX42S.js";import{c as d,e as C}from"./chunk-EN2WHAVL.js";import{M as w,N as Y,c}from"./chunk-COF7YKSN.js";import{K as b,b as l}from"./chunk-VZKEX7KP.js";import{M as N,va as H}from"./chunk-XFTQD4B2.js";import{b as L}from"./chunk-73B6GL3S.js";import{f as r,o as n,q as t}from"./chunk-Y5OH3DDZ.js";n();t();var x=r(L()),A=r(y());C();n();t();var v=r(L());n();t();var I=r(c());C();var P={EXTENSION_INSTALLED:"EXTENSION_INSTALLED",EXTENSION_UNINSTALLED:"EXTENSION_UNINSTALLED"},j=e=>!!e?.type&&!!e?.data&&e.type===P.EXTENSION_INSTALLED,G=e=>!!e?.type&&!!e?.data&&e.type===P.EXTENSION_UNINSTALLED,O=e=>{let o=s=>{if(j(s)){let a=s?.data||[];e(a)}};return I.default.runtime.onMessage.addListener(o),d().addOnInstallExtensionListener(),()=>{I.default.runtime.onMessage.removeListener(o),d().removeOnInstallExtensionListener()}},U=e=>{let o=s=>{if(G(s)){let a=s?.data||[];e(a)}};return I.default.runtime.onMessage.addListener(o),d().addOnUnInstallExtensionListener(),()=>{I.default.runtime.onMessage.removeListener(o),d().removeOnUnInstallExtensionListener()}};var J=(e,o,s)=>{(0,v.useEffect)(()=>{if(!e)return()=>{};let a=o.listenInstall?O(s):void 0,m=o.listenUninstall?U(s):void 0;return()=>{e&&(a?.(),m?.())}},[e,o,s])},q=J;function he(e,o={}){let[s,a]=(0,x.useState)([]),[m,u]=(0,x.useState)(!0),[g,f]=(0,x.useState)(null),p=(0,A.useMemoizedFn)(async()=>{u(!0),f(null);try{let k=await d().getInstalledExtensions();a(k)}catch(k){f(k)}finally{u(!1)}});(0,x.useEffect)(()=>{!e||p()},[p,e]),q(e,o,p);let _=(0,x.useMemo)(()=>new Set((s??[]).map(k=>k.id)),[s]);return{extensions:s,loading:m,error:g,refresh:p,extensionIds:_}}n();t();var D=r(c());b();var W=()=>l.isEdge?"edge://extensions/":l.isFirefox?"about:addons":l.isOpera?"opera://extensions/":l.isBrave?"brave://extensions/":"chrome://extensions/";function Z(){let e=W();D.default.tabs.create({url:e})}var ee=Z;n();t();n();t();var R=r(c());b();var ne=()=>!(!R.default.permissions||!R.default.management||l.isOKXDesktop||l.isSafari||l.isFirefox),B=ne;var T=B;n();t();n();t();var re=r(c());n();t();var te=r(c());n();t();var oe=r(c());n();t();var me=r(c());n();t();var ie=r(c());n();t();var ue=r(c());n();t();var fe=r(c());n();t();var h=r(L()),E=r(y());C();function Pn(){let[e,o]=(0,E.useLocalStorageState)("managementPermission",{defaultValue:!1}),[s,a]=(0,h.useState)(!0),m=(0,h.useMemo)(()=>T(),[]),u=(0,E.useMemoizedFn)(async()=>{a(!0);let f=await d().checkManagementPermission();o(f),a(!1)}),g=(0,E.useMemoizedFn)(async()=>{if(!m)return!1;let f=await d().requestManagementPermission();return o(f),f});return(0,E.useMount)(()=>{m&&u()}),{hasPermission:!!e,loading:s,requestPermission:g,refresh:u,supportManagement:m}}n();t();var V=r(L()),S=r(y());H();n();t();Y();n();t();async function ce(e,o){await e.reduce(async(s,a,m,u)=>(await s,o(a,m,u)),Promise.resolve())}var F=ce;async function de(e,o){let s=`${e.id}-${e.version}`,a=await w.risk_extension,m=await a.get(s),u=Date.now();await a.set({riskExtensionKey:s,id:e.id,version:e.version,riskInfo:e.riskInfo,createTime:m?.createTime??o??u,updateTime:o??u})}async function K(e,o){await F(e,async s=>{await de(s,o)})}async function M(e){return await(await w.risk_extension).query(e)??[]}async function $(e){return await M({updateTime:e})}n();t();var z=r(y());var le="lastRiskExtensionRequestTime";function Q(){let[e,o]=(0,z.useLocalStorageState)(le,{defaultValue:0});return[e??0,o]}function Jn(e){let[o,s]=Q(),[a,m]=(0,V.useState)([]),u=(0,S.useMemoizedFn)(async()=>{try{return await M()}catch{return[]}});(0,S.useAsyncEffect)(async()=>{if(!N(o))try{let f=await $(o);m(f)}catch{}},[e]);let g=(0,S.useMemoizedFn)(async f=>{try{let p=Date.now();await K(f.map(_=>({id:_.id,version:_.version,riskInfo:_.riskInfo,name:_.name})),p),s(p)}catch{}});return{lastScannedRiskList:a,setLastScannedRiskList:m,getAllRiskExtensions:u,setRiskExtensionList:g,lastRequestTime:o}}export{he as a,ee as b,T as c,Pn as d,Jn as e};
//# sourceMappingURL=chunk-GYBRFZKR.js.map
