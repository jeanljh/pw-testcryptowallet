import{a as $}from"./chunk-VBBNSARN.js";import{a as L}from"./chunk-YYJBFMAM.js";import{b as G,d as w}from"./chunk-SLQQVCPY.js";import{c as j,o as p,p as f,q as P}from"./chunk-Y5OH3DDZ.js";var U=j(T=>{p();P();var Z=T&&T.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,o)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Y=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),z=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Z(e,r,t);return Y(e,r),e};Object.defineProperty(T,"__esModule",{value:!0});T.TrxWallet=void 0;var y=w(),x=w(),d=z(O());function k(r){if(!x.base.validateHexString(r))return!1;let e=x.base.fromHex(r.toLowerCase());return e.length==32&&!e.every(t=>t===0)}var D=class extends y.BaseWallet{async getDerivedPath(e){return`m/44'/195'/0'/0/${e.index}`}static toHexAddress(e){return d.toHexAddress(e)}static toBase58Address(e){let t=x.base.fromHex(e);return x.base.toBase58Check(t)}async getNewAddress(e){try{if(!k(e.privateKey))return Promise.reject(y.NewAddressError);let t=e.privateKey;e.privateKey.startsWith("0x")&&(t=x.base.stripHexPrefix(e.privateKey)),e.privateKey.startsWith("0X")&&(t=e.privateKey.substring(2));let s=t,o=d.getPubKeyFromPriKey(x.base.fromHex(s)),u={address:d.addressFromPrivate(s),publicKey:x.base.toHex(o)};return Promise.resolve(u)}catch{return Promise.reject(y.NewAddressError)}}async validPrivateKey(e){let s={isValid:k(e.privateKey),privateKey:e.privateKey};return Promise.resolve(s)}async validAddress(e){let t=e.address,s=!1;try{s=d.validateAddress(t)}catch{}return Promise.resolve({isValid:s,address:t})}async signTransaction(e){try{let t=e.privateKey,s=e.data;if(s.type==="transfer"){let o=s.data,c=d.transfer(o,t);return Promise.resolve(c)}else if(s.type==="assetTransfer"){let o=s.data,c=d.assetTransfer(o,t);return Promise.resolve(c)}else if(s.type==="tokenTransfer"){let o=s.data,c=d.tokenTransfer(o,t);return Promise.resolve(c)}else return Promise.reject(y.SignTxError)}catch{}return Promise.reject(y.SignTxError)}async signMessage(e){try{let t=x.base.stripHexPrefix(e.data.message),s=d.signMessage(e.data.type,t,e.privateKey,!0);return Promise.resolve(s)}catch{}return Promise.reject(y.SignMsgError)}static signRawTransaction(e){try{let t=x.base.stripHexPrefix(e.data.message),s=d.signMessage2(t,e.privateKey);return Promise.resolve(s)}catch{}return Promise.reject(y.SignMsgError)}async verifyMessage(e){let t=e.signature,s=e.data,o=e.address||"";return await this.ecRecover(s,t).then(c=>Promise.resolve(o.toLowerCase()===c.toLowerCase()))}async ecRecover(e,t){let s=d.verifySignature(e.message,t);return Promise.resolve(s||"")}getAddressByPublicKey(e){return Promise.resolve(d.addressFromPublic(e.publicKey))}async getMPCRawTransaction(e){try{return await this.signTransaction(e)}catch{return Promise.reject(y.GetMpcRawTransactionError)}}async getMPCTransaction(e){try{let t=d.getMPCTransaction(e.raw,e.sigs,e.publicKey);return Promise.resolve(t)}catch{return Promise.reject(y.GetMpcTransactionError)}}async getMPCRawMessage(e){try{let t=d.getUnsignedMessage(e.data.type,e.data.message,!0);return Promise.resolve({hash:t})}catch{return Promise.reject(y.GetMpcRawTransactionError)}}async getMPCSignedMessage(e){try{return Promise.resolve(d.getMPCSignedMessage(e.hash,e.sigs,e.publicKey,e.type,e.message))}catch{return Promise.reject(y.GetMpcTransactionError)}}async calcTxHash(e){try{if(typeof e.data=="string")return Promise.resolve(d.getTxIdBySignedTx(e.data));{let t=await this.signTransaction(e);return Promise.resolve(t.hash)}}catch{return Promise.reject(y.CalcTxHashError)}}async getHardWareRawTransaction(e){try{return await this.signTransaction(e)}catch{return Promise.reject(y.GetHardwareRawTransactionError)}}async getHardWareSignedTransaction(e){try{let t=d.getHardwareTransaction(e.raw,e.sig);return Promise.resolve(t)}catch{return Promise.reject(y.GetHardwareSignedTransactionError)}}async getHardWareMessageHash(e){try{let t=x.base.stripHexPrefix(e.data.message),s=d.getUnsignedMessage(e.data.type,t,!0);return Promise.resolve(s)}catch{}return Promise.reject(y.GetHardWareMessageHashError)}async validSignedTransaction(e){try{let t=e.data?e.data.publicKey:void 0,s=d.validSignedTransaction(e.tx,t);return Promise.resolve((0,y.jsonStringifyUniform)(s))}catch{return Promise.reject(y.validSignedTransactionError)}}};T.TrxWallet=D});var O=j(a=>{p();P();var K=a&&a.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,o)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Q=a&&a.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ee=a&&a.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&K(e,r,t);return Q(e,r),e},te=a&&a.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&K(e,r,t)};Object.defineProperty(a,"__esModule",{value:!0});a.validSignedTransaction=a.getHardwareTransaction=a.getMPCSignedMessage=a.getUnsignedMessage=a.getMPCTransaction=a.verifySignatureV2=a.verifySignature=a.signMessage2=a.signMessage=a.signByTxId=a.tokenTransfer=a.tokenTransferContract=a.getTransferData=a.assetTransfer=a.assetTransferContract=a.transfer=a.transferContract=a.getTxIdBySignedTx=a.signRawTransaction=a.createRawTransaction=a.toHexAddress=a.validateAddress=a.addressFromPublic=a.addressFromPrivate=a.computeAddress=a.getPubKeyFromPriKey=a.ADDRESS_PREFIX=a.ADDRESS_PREFIX_BYTE=a.HEX_ADDRESS_SIZE=void 0;var h=G(),n=w(),re=w(),i=$(),S=ee(L()),M=i.protocol.Transaction.Contract.ContractType;a.HEX_ADDRESS_SIZE=21;a.ADDRESS_PREFIX_BYTE=65;a.ADDRESS_PREFIX="41";var C=`TRON Signed Message:
32`,R=`Ethereum Signed Message:
32`;function I(r){return h.signUtil.secp256k1.publicKeyCreate(r,!1)}a.getPubKeyFromPriKey=I;function _(r){r.length===65&&(r=r.slice(1));let e=n.base.keccak256(r),t=[];return t.push(a.ADDRESS_PREFIX_BYTE),t.push(...e.slice(12)),f.Buffer.from(t)}a.computeAddress=_;function se(r){let e=I(n.base.fromHex(r)),t=_(e);return n.base.toBase58Check(t)}a.addressFromPrivate=se;function ne(r){let e=n.base.fromHex(r);if(e.length!==64){let s=h.signUtil.secp256k1.publicKeyConvert(e,!1);e=f.Buffer.from(s.slice(1))}let t=_(e);return n.base.toBase58Check(t)}a.addressFromPublic=ne;function ae(r){try{if(n.base.isHexString(r)||r.startsWith(a.ADDRESS_PREFIX)&&r.length==a.HEX_ADDRESS_SIZE*2){let t=n.base.fromHex(r);return t.length!=a.HEX_ADDRESS_SIZE?!1:t[0]===a.ADDRESS_PREFIX_BYTE}let e=n.base.fromBase58Check(r);return e.length!==a.HEX_ADDRESS_SIZE?!1:e[0]===a.ADDRESS_PREFIX_BYTE}catch{return!1}}a.validateAddress=ae;function oe(r){if(n.base.isHexString(r))return r;let e=n.base.fromBase58Check(r);return n.base.toHex(e)}a.toHexAddress=oe;function A(r,e){return i.protocol.Transaction.raw.create({refBlockBytes:n.base.fromHex(r.refBlockBytes),refBlockHash:n.base.fromHex(r.refBlockHash),expiration:r.expiration,timestamp:r.timeStamp,feeLimit:r.feeLimit,contract:e})}a.createRawTransaction=A;function E(r,e){let t=i.protocol.Transaction.create({rawData:r}),s=i.protocol.Transaction.raw.encode(r).finish(),o=n.base.sha256(s);if(!e)return{raw:n.base.toHex(s),hash:n.base.toHex(o)};let{signature:c,recovery:u}=h.signUtil.secp256k1.sign(f.Buffer.from(o),n.base.fromHex(e),!0),g=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(u)]);t.signature.push(g);let l=i.protocol.Transaction.encode(t).finish();return n.base.toHex(l)}a.signRawTransaction=E;function ce(r){let e=i.protocol.Transaction.decode(n.base.fromHex(r)),t=i.protocol.Transaction.raw.encode(e.rawData).finish();return n.base.toHex(n.base.sha256(t))}a.getTxIdBySignedTx=ce;function v(r){return n.base.isHexString(r)||r.startsWith(a.ADDRESS_PREFIX)&&r.length==a.HEX_ADDRESS_SIZE*2?n.base.fromHex(r):n.base.fromBase58Check(r)}function F(r){let e=[],t=i.protocol.TransferContract.create({ownerAddress:v(r.fromAddress),toAddress:v(r.toAddress),amount:n.Long.fromString(r.amount)}),s=i.protocol.Transaction.Contract.create({type:M.TransferContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TransferContract",value:i.protocol.TransferContract.encode(t).finish()})});return e.push(s),e}a.transferContract=F;function ie(r,e){let t=F(r),s=A(r,t);return E(s,e)}a.transfer=ie;function N(r){let e=[],t=i.protocol.TransferAssetContract.create({assetName:n.base.fromHex(r.assetName),ownerAddress:v(r.fromAddress),toAddress:v(r.toAddress),amount:n.Long.fromString(r.amount)}),s=i.protocol.Transaction.Contract.create({type:M.TransferAssetContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TransferAssetContract",value:i.protocol.TransferAssetContract.encode(t).finish()})});return e.push(s),e}a.assetTransferContract=N;function ue(r,e){let t=N(r),s=A(r,t);return E(s,e)}a.assetTransfer=ue;function X(r){let e="0x"+n.base.toHex(v(r.toAddress)).slice(2),t=n.base.keccak256(f.Buffer.from("transfer(address,uint256)")).slice(0,4);return f.Buffer.concat([t,re.abi.RawEncode(["address","uint256"],[e,r.amount])])}a.getTransferData=X;function V(r){let e=[],t=i.protocol.TriggerSmartContract.create({ownerAddress:v(r.fromAddress),contractAddress:v(r.contractAddress),data:X(r),callValue:0,callTokenValue:0}),s=i.protocol.Transaction.Contract.create({type:M.TriggerSmartContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TriggerSmartContract",value:i.protocol.TriggerSmartContract.encode(t).finish()})});return e.push(s),e}a.tokenTransferContract=V;function fe(r,e){let t=V(r),s=A(r,t);return E(s,e)}a.tokenTransfer=fe;function J(r,e){let t=f.Buffer.from(n.base.fromHex(r)),s=f.Buffer.from(n.base.fromHex(e)),{signature:o,recovery:c}=h.signUtil.secp256k1.sign(t,s,!1),u=[];return u.push(...o),u.push(c),n.base.toHex(u)}a.signByTxId=J;function ge(r,e,t,s=!0){if(r==="v2"){let o=f.Buffer.from(`TRON Signed Message:
${e.length.toString()}${e}`,"utf-8"),c=n.base.keccak256(o);if(!t)return n.base.toHex(c);let u=f.Buffer.from(n.base.fromHex(t)),{v:g,r:l,s:b}=S.ecdsaSign(S.toBuffer(c),u);return S.makeSignature(g,l,b)}else if(r==="hex"){let o=f.Buffer.from(n.base.fromHex(e)),c=f.Buffer.from(s?C:R),u=f.Buffer.concat([c,o],c.length+o.length),g=n.base.keccak256(u);if(!t)return n.base.toHex(g);let l=f.Buffer.from(n.base.fromHex(t)),{v:b,r:m,s:H}=S.ecdsaSign(S.toBuffer(g),l);return S.makeSignature(b,m,H)}else if(r==="legacy"){let o=JSON.parse(e);if("txID"in o){if(!t)return o.txID;let c=J(o.txID,t);return o.signature=[c],JSON.stringify(o)}else throw new Error("message must be hex or transaction object")}else if(r==="protobuf"){let o=JSON.parse(e),c=n.base.fromHex(o.raw_data_hex),u=i.protocol.Transaction.raw.decode(Uint8Array.from(c)),g=i.protocol.Transaction.create({rawData:u}),l=n.base.sha256(c),{signature:b,recovery:m}=h.signUtil.secp256k1.sign(f.Buffer.from(l),n.base.fromHex(t),!0),H=f.Buffer.concat([Uint8Array.from(b),Uint8Array.of(m)]);g.signature.push(H);let B=i.protocol.Transaction.encode(g).finish();return n.base.toHex(B)}else throw new Error("message must be hex or transaction object")}a.signMessage=ge;function le(r,e){let t=JSON.parse(r),s=n.base.fromHex(t.raw_data_hex),o=i.protocol.Transaction.raw.decode(Uint8Array.from(s)),c=i.protocol.Transaction.create({rawData:o}),u=n.base.sha256(s),{signature:g,recovery:l}=h.signUtil.secp256k1.sign(f.Buffer.from(u),n.base.fromHex(e),!0),b=f.Buffer.concat([Uint8Array.from(g),Uint8Array.of(l)]);c.signature.push(b);let m=i.protocol.Transaction.encode(c).finish();return n.base.toHex(m)}a.signMessage2=le;function de(r,e,t=!0){let s=n.base.fromHex(r),o=n.base.fromHex(e),c=f.Buffer.from(t?C:R),u=f.Buffer.concat([c,s],c.length+s.length),g=n.base.keccak256(u),l=n.base.stripHexPrefix(e).substring(128,130)=="1c"?1:0,b=h.signUtil.secp256k1.recover(o,l,g,!1);if(b==null)return null;let m=_(b);return n.base.toBase58Check(m)}a.verifySignature=de;function ye(r,e,t=!0){let s=f.Buffer.from(`TRON Signed Message:
${r.length.toString()}${r}`,"utf-8"),o=n.base.keccak256(s),c=n.base.fromHex(e),u=n.base.stripHexPrefix(e).substring(128,130)=="1c"?1:0,g=h.signUtil.secp256k1.recover(c,u,o,!1);if(g==null)return null;let l=_(g);return n.base.toBase58Check(l)}a.verifySignatureV2=ye;function be(r,e,t){let s=n.base.fromHex(r),o=i.protocol.Transaction.create({rawData:i.protocol.Transaction.raw.decode(s)}),c=n.base.fromHex(e),u=c.slice(0,32),g=c.slice(32,64),l=n.base.sha256(s),b=h.signUtil.secp256k1.getV(f.Buffer.from(l),n.base.toHex(u),n.base.toHex(g),n.base.fromHex(t)),m=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(b)]);o.signature.push(m);let H=i.protocol.Transaction.encode(o).finish();return n.base.toHex(H)}a.getMPCTransaction=be;function he(r,e,t=!0){if(r==="hex"){let s=f.Buffer.from(n.base.fromHex(e)),o=f.Buffer.from(t?C:R),c=f.Buffer.concat([o,s],o.length+s.length),u=n.base.keccak256(c);return n.base.toHex(u)}else if(r==="legacy"){let s=JSON.parse(e);if("txID"in s)return s.txID;throw new Error("message must be hex or transaction object")}else if(r==="protobuf"){let s=JSON.parse(e),o=n.base.fromHex(s.raw_data_hex),c=n.base.sha256(o);return n.base.toHex(c)}else throw new Error("message must be hex or transaction object")}a.getUnsignedMessage=he;function me(r,e,t,s,o){let c=n.base.fromHex(e),u=c.slice(0,32),g=c.slice(32,64);if(s==="hex"){let l=h.signUtil.secp256k1.getV(n.base.fromHex(r),n.base.toHex(u),n.base.toHex(g),n.base.fromHex(t))+27;return S.makeSignature(l,u,g)}else if(s==="legacy"){let l=JSON.parse(o),b=h.signUtil.secp256k1.getV(n.base.fromHex(r),n.base.toHex(u),n.base.toHex(g),n.base.fromHex(t),!1);return l.signature=[n.base.toHex(f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(b)]))],JSON.stringify(l)}else if(s==="protobuf"){let l=JSON.parse(o),b=n.base.fromHex(l.raw_data_hex),m=i.protocol.Transaction.raw.decode(Uint8Array.from(b)),H=i.protocol.Transaction.create({rawData:m}),B=h.signUtil.secp256k1.getV(n.base.fromHex(r),n.base.toHex(u),n.base.toHex(g),n.base.fromHex(t),!0),W=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(B)]);H.signature.push(W);let q=i.protocol.Transaction.encode(H).finish();return n.base.toHex(q)}}a.getMPCSignedMessage=me;function xe(r,e){let t=n.base.fromHex(r),s=i.protocol.Transaction.create({rawData:i.protocol.Transaction.raw.decode(t)});s.signature.push(n.base.fromHex(e));let o=i.protocol.Transaction.encode(s).finish();return n.base.toHex(o)}a.getHardwareTransaction=xe;function Te(r,e){let t=i.protocol.Transaction.decode(n.base.fromHex(r)),s=i.protocol.Transaction.raw.create(t.rawData),o=i.protocol.Transaction.raw.encode(s).finish(),c=n.base.sha256(o),u=t.signature[0];if(u=u.slice(0,u.length-1),e&&!h.signUtil.secp256k1.verifyWithNoRecovery(c,u,n.base.fromHex(e)))throw Error("signature error");return t}a.validSignedTransaction=Te;te(U(),a)});export{O as a};
//# sourceMappingURL=chunk-4FJOTLQK.js.map
