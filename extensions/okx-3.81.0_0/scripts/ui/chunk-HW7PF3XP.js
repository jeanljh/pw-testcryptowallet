import{a as P}from"./chunk-T4MGJ7E6.js";import{h as V}from"./chunk-QKBWJPY2.js";import{a as S}from"./chunk-PA7QUJH7.js";import{e as B,h as b,i as K}from"./chunk-YGMRSF47.js";import{a as k}from"./chunk-M2YY6A5T.js";import{o as Z}from"./chunk-Z62JX42S.js";import{La as x,Na as w}from"./chunk-2QHGKEME.js";import{a as J}from"./chunk-YIFLUVTR.js";import{c as _,e as h}from"./chunk-EN2WHAVL.js";import{b as A,c as Q}from"./chunk-GR7YC6C3.js";import{E as N,J as X}from"./chunk-O33H5V3V.js";import{a as O,ac as L,b as z,nc as Y}from"./chunk-COF7YKSN.js";import{b as W}from"./chunk-73B6GL3S.js";import{f as u,o as c,q as l}from"./chunk-Y5OH3DDZ.js";c();l();var U=(t=>(t.CREATE_FAIL_FROM_NETWORK_ERROR="CREATE_FAIL_FROM_NETWORK_ERROR",t.CREATE_FAIL_FROM_SERVER_ERROR="CREATE_FAIL_FROM_SERVER_ERROR",t.CREATE_FAIL_FROM_SERVER_LIMIT="CREATE_FAIL_FROM_SERVER_LIMIT",t.PENDING="PENDING",t))(U||{}),R={...U,...S};c();l();var s=u(W()),I=u(w()),j=u(Z());c();l();function C(e){let r=e?.type||e?.message;return r==="ERR_SERVER_TINE_LIMIT"?{type:"ERR_SERVER_TINE_LIMIT"}:r==="ERR_SERVER_LIMIT"?{type:"ERR_SERVER_LIMIT"}:r==="ERR_NETWORK"?{type:"ERR_NETWORK"}:r==="ERR_SERVER_COMMON"?{type:"ERR_SERVER_COMMON",msg:e?.message}:{type:"ERR_DEFAULT"}}h();c();l();var D=u(W());z();var G=()=>(0,D.useCallback)(e=>{try{let r=e===R.CREATE_FAIL_FROM_SERVER_ERROR?"Server":"Local";O.captureException(`CreateWalletToServerInHomePage-${r}`)}catch(r){console.log(r)}},[]);c();l();var f=u(W()),H=u(w()),q=u(J());h();Y();Q();X();var $=()=>{let e=B({keyringType:L.MPC}),r=(0,H.useSelector)(x),a=(0,f.useCallback)(async()=>{Promise.all(e.map(o=>{let t=o?.mpcId||"",n=o?.walletIdentities?.length-1;return N(A.syncMpcwallet,{mpcId:t,deriveIndex:n})})).then(o=>{_().setIsNeedSyncMpcIndex(!1)}).catch(o=>{q.default.debug("syncMpcWallet error:")})},[e?.length]);(0,f.useEffect)(()=>{e?.length&&r&&a()},[e?.length,a,r])};var ee=e=>{let{needSyncMap:r={},createdMap:a={}}=(0,I.useSelector)(({metamask:T})=>T),o=Boolean(a[e]),t=Boolean(r[e]),n=P(),i=!o||t||n,[E,p]=(0,s.useState)(i?R.PENDING:""),[m,y]=(0,s.useState)("");return(0,j.useUpdateEffect)(()=>{p(R.PENDING)},[e]),(0,s.useEffect)(()=>{!n&&o&&!t&&p("")},[n,o,t]),{errorMsg:m,errorType:E,isWalletCreated:o,isWalletNeedSync:t,setErrorMsg:y,setErrorType:p}},re=e=>{let{walletId:r,setErrorMsg:a,setErrorType:o}=e,t=G();return(0,s.useCallback)(async()=>{let i=await _().getWalletTypeCreated(r);o(R.PENDING);try{await _().createWalletToServer({walletId:r,walletType:i,noticeBackend:!0}),k()}catch(E){switch(E?.message){case"ERR_NETWORK":o(R.CREATE_FAIL_FROM_NETWORK_ERROR),t();break;case"ERR_SERVER_LIMIT":o(R.CREATE_FAIL_FROM_SERVER_LIMIT),t(R.CREATE_FAIL_FROM_SERVER_LIMIT);break;default:o(R.CREATE_FAIL_FROM_SERVER_ERROR),a(E?.message);break}}},[t,r])},te=e=>(0,s.useCallback)(async()=>{try{await _().syncWalletToServer(e)}catch{}},[e]),oe=({walletId:e,setErrorType:r,isWalletCreated:a,isWalletNeedSync:o,setErrorMsg:t})=>{let n=(0,I.useDispatch)(),i=(0,s.useCallback)(async()=>{try{await n(V(void 0,e))}catch(E){let{type:p,msg:m}=C(E);r(p),m!==void 0&&t(m)}},[t,r,n,e]);(0,s.useEffect)(()=>{(async()=>a&&!o&&(await i(),await _().getAccountKeys()))()},[i,a,o,e])};function we(...e){let[r]=e,a=(0,s.useRef)(Boolean(r));$();let o=b(),t=K(),n=a.current?r?.accountId:o,i=a.current?r?.teeId:t,{errorMsg:E,errorType:p,isWalletCreated:m,isWalletNeedSync:y,setErrorMsg:T,setErrorType:M}=ee(n),g=re({walletId:n,setErrorMsg:T,setErrorType:M}),F=te(n);oe({teeId:i,walletId:n,setErrorType:M,setErrorMsg:T,isWalletCreated:m,isWalletNeedSync:y});let v=(0,s.useCallback)(async()=>{m?y&&await F():await g()},[g,m,y,F]);return(0,s.useEffect)(()=>{v()},[v]),[{errorType:p,errorMsg:E},{createWalletToServer:g}]}export{C as a,R as b,we as c};
//# sourceMappingURL=chunk-HW7PF3XP.js.map
