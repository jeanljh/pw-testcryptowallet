import{b as m,d as P}from"./chunk-SLQQVCPY.js";import{k as X}from"./chunk-C5XO4JMZ.js";import{c as _,o as l,q as y}from"./chunk-Y5OH3DDZ.js";var A=_(o=>{l();y();Object.defineProperty(o,"__esModule",{value:!0});o.decrypt=o.encrypt=o.decodeBytes=o.nsecFromPrvKey=o.npubEncode=o.nsec=o.nostrHdp=void 0;var T=m(),u=P();typeof crypto<"u"&&!crypto.subtle&&crypto.webcrypto&&(crypto.subtle=crypto.webcrypto.subtle);o.nostrHdp="npub";o.nsec="nsec";function Q(e){return U("npub",e)}o.npubEncode=Q;function Y(e){return U("nsec",e)}o.nsecFromPrvKey=Y;function U(e,t){return u.base.toBech32(e,u.base.fromHex(t))}function M(e,t){try{let[r,n]=u.base.fromBech32(t);if(e!==r)throw new Error("invalid data");return u.base.toHex(n,!1)}catch(r){throw console.log(r),r}}o.decodeBytes=M;async function K(e,t,r){if(crypto==null)throw new Error("crypto is null");let n=T.secp256k1.getSharedSecret(M("nsec",e),"02"+u.base.stripHexPrefix(t)),a=z(n),p=Uint8Array.from(u.base.randomBytes(16)),v=u.base.toUtf8(r),C=await crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["encrypt"]),x=await crypto.subtle.encrypt({name:"AES-CBC",iv:p},C,v),j=u.base.toBase64(new Uint8Array(x)),H=u.base.toBase64(new Uint8Array(p.buffer));return`${j}?iv=${H}`}o.encrypt=K;async function ee(e,t,r){let[n,a]=r.split("?iv="),p=T.secp256k1.getSharedSecret(M("nsec",e),"02"+u.base.stripHexPrefix(t)),v=z(p),C=await crypto.subtle.importKey("raw",v,{name:"AES-CBC"},!1,["decrypt"]),x=u.base.fromBase64(n),j=u.base.fromBase64(a),H=await crypto.subtle.decrypt({name:"AES-CBC",iv:j},C,x);return u.base.fromUtf8(new Uint8Array(H))}o.decrypt=ee;function z(e){return e.slice(1,33)}});var S=_(b=>{l();y();Object.defineProperty(b,"__esModule",{value:!0});b.getPublicKey=b.generatePrivateKey=void 0;var F=m(),O=P();function te(){return O.base.toHex(F.secp256k1.utils.randomPrivateKey(),!1)}b.generatePrivateKey=te;function re(e){return O.base.toHex(F.secp256k1.schnorr.getPublicKey(O.base.stripHexPrefix(e)),!1)}b.getPublicKey=re});var k=_(s=>{l();y();Object.defineProperty(s,"__esModule",{value:!0});s.getSignature=s.signEvent=s.verifySignature=s.validateEvent=s.getEventHash=s.serializeEvent=s.finishEvent=s.getBlankEvent=s.Kind=s.verifiedSymbol=void 0;var ne=S(),se=m(),g=P(),I=se.signUtil.schnorr.secp256k1.schnorr;s.verifiedSymbol=Symbol("verified");var V;(function(e){e[e.Metadata=0]="Metadata",e[e.Text=1]="Text",e[e.RecommendRelay=2]="RecommendRelay",e[e.Contacts=3]="Contacts",e[e.EncryptedDirectMessage=4]="EncryptedDirectMessage",e[e.EventDeletion=5]="EventDeletion",e[e.Repost=6]="Repost",e[e.Reaction=7]="Reaction",e[e.BadgeAward=8]="BadgeAward",e[e.ChannelCreation=40]="ChannelCreation",e[e.ChannelMetadata=41]="ChannelMetadata",e[e.ChannelMessage=42]="ChannelMessage",e[e.ChannelHideMessage=43]="ChannelHideMessage",e[e.ChannelMuteUser=44]="ChannelMuteUser",e[e.Blank=255]="Blank",e[e.Report=1984]="Report",e[e.ZapRequest=9734]="ZapRequest",e[e.Zap=9735]="Zap",e[e.RelayList=10002]="RelayList",e[e.ClientAuth=22242]="ClientAuth",e[e.NwcRequest=23194]="NwcRequest",e[e.HttpAuth=27235]="HttpAuth",e[e.ProfileBadge=30008]="ProfileBadge",e[e.BadgeDefinition=30009]="BadgeDefinition",e[e.Article=30023]="Article",e[e.FileMetadata=1063]="FileMetadata"})(V=s.Kind||(s.Kind={}));function ae(e=V.Blank){return{kind:e,content:"",tags:[],created_at:0}}s.getBlankEvent=ae;function ie(e,t){let r=e;return r.pubkey=(0,ne.getPublicKey)(t),r.id=w(r),r.sig=q(r,t),r[s.verifiedSymbol]=!0,r}s.finishEvent=ie;function Z(e){if(!$(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}s.serializeEvent=Z;function w(e){let t=g.base.sha256(g.base.toUtf8(Z(e)));return g.base.toHex(t,!1)}s.getEventHash=w;var oe=e=>e instanceof Object;function $(e){if(!oe(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]=="object")return!1}return!0}s.validateEvent=$;function ce(e){if(typeof e[s.verifiedSymbol]=="boolean")return e[s.verifiedSymbol];let t=w(e);if(t!==e.id)return e[s.verifiedSymbol]=!1;try{return e[s.verifiedSymbol]=I.verify(e.sig,t,e.pubkey)}catch{return e[s.verifiedSymbol]=!1}}s.verifySignature=ce;function ue(e,t){return console.warn("nostr-tools: `signEvent` is deprecated and will be removed or changed in the future. Please use `getSignature` instead."),q(e,g.base.stripHexPrefix(t))}s.signEvent=ue;function q(e,t){return g.base.toHex(I.sign(w(e),g.base.stripHexPrefix(t)),!1)}s.getSignature=q});var J=_(i=>{l();y();var le=i&&i.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),ye=i&&i.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),fe=i&&i.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&le(t,e,r);return ye(t,e),t};Object.defineProperty(i,"__esModule",{value:!0});i.NostrAssetsWallet=i.NewAddressError=i.CryptTextParams=i.nipOpType=void 0;var c=P(),G=m(),f=A(),h=fe(X()),L=k(),W=S(),R;(function(e){e[e.NIP04_Encrypt=1]="NIP04_Encrypt",e[e.NIP04_Decrypt=2]="NIP04_Decrypt"})(R=i.nipOpType||(i.nipOpType={}));var D=class{constructor(t,r,n){this.type=t,this.pubkey=r,this.text=n}};i.CryptTextParams=D;typeof h<"u"&&!h.subtle&&h.webcrypto&&(h.subtle=h.webcrypto.subtle);i.NewAddressError="generate address error";var N=class extends c.BaseWallet{async getDerivedPath(t){return`m/44'/1237'/${t.index}'/0/0`}getDerivedPrivateKey(t){return G.bip39.mnemonicToSeedV2(t.mnemonic).then(r=>{let n=G.bip32.fromSeedV2(r,t.hdPath);return n.privateKey?Promise.resolve((0,f.nsecFromPrvKey)(c.base.toHex(n.privateKey,!1))):Promise.reject(c.GenPrivateKeyError)}).catch(r=>Promise.reject(c.GenPrivateKeyError))}getRandomPrivateKey(){try{for(;;){let t=c.base.randomBytes(32);if((0,c.secp256k1SignTest)(t))return Promise.resolve((0,f.nsecFromPrvKey)(c.base.toHex(t,!1)))}}catch{}return Promise.reject(c.GenPrivateKeyError)}async getNewAddress(t){try{let[r,n]=c.base.fromBech32(t.privateKey);if(!(f.nsec==r))return Promise.reject("invalid privateKey");let p=(0,W.getPublicKey)(c.base.toHex(n,!1)),v={address:(0,f.npubEncode)(p),publicKey:p};return Promise.resolve(v)}catch(r){return Promise.reject(r)}}async validPrivateKey(t){let[r]=c.base.fromBech32(t.privateKey),a={isValid:f.nsec==r,privateKey:t.privateKey};return Promise.resolve(a)}async validAddress(t){var r=!1;try{let[a]=c.base.fromBech32(t.address);r=f.nostrHdp==a}catch(a){console.log(a)}let n={isValid:r,address:t.address};return Promise.resolve(n)}async signCommonMsg(t){let[,r]=c.base.fromBech32(t.privateKey);return super.signCommonMsg({privateKey:t.privateKey,privateKeyHex:c.base.toHex(r,!1),message:t.message,signType:c.SignType.Secp256k1})}async signTransaction(t){if(Object.prototype.toString.call(t.data)==="[object Object]"&&t.data.isCryptText){let r=t.data;switch(r.type){case R.NIP04_Decrypt:return(0,f.decrypt)(t.privateKey,r.pubkey,r.text);case R.NIP04_Encrypt:return(0,f.encrypt)(t.privateKey,r.pubkey,r.text);default:return Promise.reject(c.NotImplementedError)}}else try{let r=(0,f.decodeBytes)(f.nsec,t.privateKey),n=t.data;return n.pubkey||(n.pubkey=(0,W.getPublicKey)(r)),n.id||(n.id=(0,L.getEventHash)(n)),n.sig=(0,L.getSignature)(n,r),Promise.resolve(n)}catch(r){return Promise.reject(r)}}};i.NostrAssetsWallet=N});var pe=_(d=>{l();y();var de=d&&d.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),B=d&&d.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&de(t,e,r)};Object.defineProperty(d,"__esModule",{value:!0});B(J(),d);B(A(),d);B(S(),d);B(k(),d)});export{pe as a};
//# sourceMappingURL=chunk-JBUTKOK2.js.map
