import{a as _e}from"./chunk-6XGS36TZ.js";import{a as ge}from"./chunk-M2YY6A5T.js";import{q as Ee,r as Ce,s as M}from"./chunk-GCS2RK7E.js";import{C as L,H as pe,Na as lr,aa as me,c as v,d as sr,xa as ye}from"./chunk-2QHGKEME.js";import{a as xe,b as we,g as Fe}from"./chunk-W4SQ6335.js";import{a as ur}from"./chunk-6PA65BO3.js";import{j as b,q as dr}from"./chunk-NUN72MDU.js";import{m as ue,n as fe,p as or}from"./chunk-YIFLUVTR.js";import{c as W,e as ir}from"./chunk-EN2WHAVL.js";import{a as he,b as Ae,c as Ie,d as Te,e as We}from"./chunk-3QLLFUC4.js";import{c as O,e as _}from"./chunk-E4OV5WXB.js";import{b as J,c as er}from"./chunk-GR7YC6C3.js";import{E as Z,J as ar}from"./chunk-O33H5V3V.js";import{$b as de,Sb as cr,Tb as E,Vb as oe,_b as ie,ac as C,la as k,na as ee,nc as le,oa as re,pa as te,qa as ne,rb as se,tb as ce,ua as ae,vb as T}from"./chunk-COF7YKSN.js";import{A as F,K as ve}from"./chunk-VZKEX7KP.js";import{I as S}from"./chunk-BJKBO23H.js";import{a as rr,b as tr,c as nr}from"./chunk-AHVVUOFF.js";import{va as Je,z as Q}from"./chunk-XFTQD4B2.js";import{b as Ze}from"./chunk-73B6GL3S.js";import{c as X,f as w,o as p,q as m}from"./chunk-Y5OH3DDZ.js";var Ne=X((Mr,Oe)=>{p();m();var Me="%[a-f0-9]{2}",Se=new RegExp(Me,"gi"),be=new RegExp("("+Me+")+","gi");function D(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],D(t),D(n))}function fr(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(Se),t=1;t<r.length;t++)e=D(r,t).join(""),r=e.match(Se);return e}}function pr(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=be.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=fr(t[0]);n!==t[0]&&(r[t[0]]=n)}t=be.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),r[s])}return e}Oe.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return pr(e)}}});var Pe=X(u=>{p();m();var mr=rr(),yr=Ne(),je=tr(),gr=nr(),hr=e=>e==null,P=Symbol("encodeFragmentIdentifier");function Ar(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),"[",a,"]"].join("")]:[...t,[i(r,e),"[",i(a,e),"]=",i(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),"[]"].join("")]:[...t,[i(r,e),"[]=",i(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),":list="].join("")]:[...t,[i(r,e),":list=",i(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[i(t,e),r,i(a,e)].join("")]:[[n,i(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,i(r,e)]:[...t,[i(r,e),"=",i(n,e)].join("")]}}function Ir(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let c=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!c&&h(n,e).includes(e.arrayFormatSeparator);n=s?h(n,e):n;let o=c||s?n.split(e.arrayFormatSeparator).map(l=>h(l,e)):n===null?n:h(n,e);a[t]=o};case"bracket-separator":return(t,n,a)=>{let c=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!c){a[t]=n&&h(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(o=>h(o,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function Be(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function i(e,r){return r.encode?r.strict?mr(e):encodeURIComponent(e):e}function h(e,r){return r.decode?yr(e):e}function $e(e){return Array.isArray(e)?e.sort():typeof e=="object"?$e(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function Re(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Tr(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Le(e){e=Re(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function ke(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function De(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),Be(r.arrayFormatSeparator);let t=Ir(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[c,s]=je(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:h(s,r),t(h(c,r),s,n)}for(let a of Object.keys(n)){let c=n[a];if(typeof c=="object"&&c!==null)for(let s of Object.keys(c))c[s]=ke(c[s],r);else n[a]=ke(c,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,c)=>{let s=n[c];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[c]=$e(s):a[c]=s,a},Object.create(null))}u.extract=Le;u.parse=De;u.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),Be(r.arrayFormatSeparator);let t=s=>r.skipNull&&hr(e[s])||r.skipEmptyString&&e[s]==="",n=Ar(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let c=Object.keys(a);return r.sort!==!1&&c.sort(r.sort),c.map(s=>{let o=e[s];return o===void 0?"":o===null?i(s,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?i(s,r)+"[]":o.reduce(n(s),[]).join("&"):i(s,r)+"="+i(o,r)}).filter(s=>s.length>0).join("&")};u.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=je(e,"#");return Object.assign({url:t.split("?")[0]||"",query:De(Le(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:h(n,r)}:{})};u.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[P]:!0},r);let t=Re(e.url).split("?")[0]||"",n=u.extract(e.url),a=u.parse(n,{sort:!1}),c=Object.assign(a,e.query),s=u.stringify(c,r);s&&(s=`?${s}`);let o=Tr(e.url);return e.fragmentIdentifier&&(o=`#${r[P]?i(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${o}`};u.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[P]:!1},t);let{url:n,query:a,fragmentIdentifier:c}=u.parseUrl(e,t);return u.stringifyUrl({url:n,query:gr(a,r),fragmentIdentifier:c},t)};u.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,c)=>!r(a,c);return u.pick(e,n,t)}});p();m();var d=w(Ze()),y=w(lr()),K=w(ur());var x=w(Pe()),ze=w(sr());ve();dr();le();or();cr();ce();ie();p();m();var Ue=()=>!!(window.navigator&&window.navigator.hid);ir();p();m();er();ar();var Ke=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await Z(J.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});p();m();Je();le();ce();ie();var He=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(a=>{let{hasBackup:c,keyringIdentityType:s}=a,o=typeof t=="boolean"?t===c:!0,l=!0;return n&&(l=(Array.isArray(n)?n:[n]).includes(s)),o&&l})},Ve=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),qe=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:t?.[0]?.needBackup!==1}}),Wr=(e={},r)=>{let t=[E.SEGWIT_NESTED,E.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(c=>{let s=r[c],o=t.find(f=>f!==s),l=Object.entries(e[c]).map(([f,A])=>({addressType:f,...A}));n[c]=l.filter(({addressType:f})=>f!==o)}),n},Ge=(e=[])=>e.map(r=>{let{walletIdentities:t}=r;return{...r,walletIdentities:t.map(n=>{let{walletId:a,accountsMap:c,addressType:s,segwitAddressType:o,...l}=n;return{walletId:a,selectedAddressType:s,addressType:Wr(n?.accountsMap,o),segwitAddressType:o,...l}})}});var Er=[ee,ae,re,te,ne],vr=(e,r=k,t)=>{if(Er.includes(r)&&t){let a=se(r),c=e?.addressType?.[a]||[];return Q(c,s=>s.addressType===t)?.address}return e?.account?.[r]};var Cr="syncMpcWalletErrorCode";var _r=(0,ze.createSelector)(({keyring:e})=>e.keyringIdentities,e=>Ge(v(e))),H=e=>{let r=(0,y.useSelector)(_r);return(0,d.useMemo)(()=>{let n=qe(r);return e?He(n,e):n},[e,r])},Ft=e=>{let r=(0,y.useSelector)(({keyring:t})=>t.keyringIdentities);return(0,d.useMemo)(()=>e?r.find(t=>t.keyringId===e):null,[r,e])},j=e=>{let r=H(e);return(0,d.useMemo)(()=>Ve(r||[]),[r])},xr=()=>(0,y.useSelector)(me),St=()=>(0,y.useSelector)(ye),B=(e,r=!0)=>{let t=xr(),n=e||t,a=j();return(0,d.useMemo)(()=>r===!1&&!e?null:a.find(c=>c?.walletId===n),[a,n,r,e])},bt=(e,r)=>B(e,!1)?.account?.[r],Mt=(e,r)=>{let t=j(r);return(0,d.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},Ot=()=>{let e=j();return(0,d.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},Nt=e=>B(e)?.keyringIdentityType===C.MPC,kt=e=>{let r=B(e);return We(r?.initialType)},jt=e=>{let r=H(),{keyringId:t}=B()||{},n=e||t;return(0,d.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},wr=()=>{let e=H();return(0,d.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var Ye=()=>{let e=(0,y.useDispatch)(),{successHaptic:r,impactHaptic:t}=_e();return(0,d.useCallback)(async(n,a={})=>{try{t();let{walletId:c}=await W().addNewWallet(n);return ge(),await b(e),r(),a.hideToast||S.success({title:F("wallet_addacount_toast_account_created")}),c}catch(c){return c.message===ue&&S.error(F("wallet_home_toast_network_error")),c.message===fe&&S.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3})),""}},[])},Fr=()=>{let e=(0,K.useHistory)();return(0,d.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Ue()){e.push(`${M}/${O.ledger}?${x.default.stringify({baseChain:k,type:_.addAccount,walletId:t})}`);return}let n=`${Ce}?${x.default.stringify({type:_.addAccount,walletId:t})}`;await Fe.hasConnectedLedger()?e.push(n):we.openModal(xe.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(Ee)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},Sr=()=>{let e=(0,K.useHistory)(),r=Fr(),t=j()?.length;return(0,d.useCallback)(async n=>{if(t===1e3){S.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3}));return}let{initialType:a}=n,c=n?.walletIdentities?.[0]?.walletId;switch(!0){case he(a):{r(n);break}case Ae(a):{globalThis.platform.openExtensionInBrowser(`${M}/${O.trezor}?${x.default.stringify({type:_.addAccount,walletId:c,hideBack:1})}`);break}case Ie(a):{e.push(`${M}/${O.keystone}?${x.default.stringify({walletId:c,type:_.addAccount})}`);break}case Te(a):{let{onekeyInfo:s}=n,{firstEvmAddress:o,connectId:l}=s;e.push(`${M}/${O.onekey}?${x.default.stringify({firstEvmAddress:o,connectId:l,type:_.addAccount})}`);break}default:break}},[])},Bt=()=>{let e=wr(),r=Ye(),t=Sr(),n=Ye(),{syncMpcWallet:a}=Ke();return(0,d.useCallback)(async(c,s)=>{if(c&&typeof c=="string"){let o=e(c),l=o?.walletIdentities?.[0]?.walletId;if(o?.keyringIdentityType===C.MNEMONIC)return await r(l,s);if(o?.keyringIdentityType===C.HARDWARE)return t(o);if(o?.keyringIdentityType===C.MPC){try{await a(o)}catch{return Promise.reject(new Error(Cr))}return await n(l)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},$t=()=>(0,d.useCallback)(async(e,r={})=>{let[t,n]=await Promise.all([W().getPrivateKeyMapByWalletId({__secretData__:{walletId:e}}),W().getWalletBaseCoins(e)]),{privateKeyMap:a={}}=t??{},c=await W().getWalletIdentityByWalletId(e),s=c?.account||{},o=[],l=c.initialType===de.SIMPLE_KEYRING;n.forEach(({localType:A,coinId:$,chainName:V,image:q,isHotNetwork:G,hotNetworkRank:Y})=>{if(pe({coinId:$})){let R=c?.accountsMap[T],Xe=c?.segwitAddressType?.[T],z=oe[T].reduce((I,g)=>((g===E.SEGWIT_NESTED_49||g===E.SEGWIT_NESTED)&&g!==Xe||(l?I[g]=a[T]:a[`${T}_${g}`]&&(I[g]=a[`${T}_${g}`])),I),{});Object.keys(z).forEach(I=>{let g=z[I],Qe=I;o.push({walletId:e,privateKey:g,address:R[I].address,shortenedAddress:L(s[T]),coinId:$,chainName:V,image:q,btcAddressType:Qe,isHotNetwork:G,hotNetworkRank:Y})})}else{let R=a[A];o.push({walletId:e,privateKey:R,address:s[A],shortenedAddress:L(s[A]),coinId:$,chainName:V,image:q,isHotNetwork:G,hotNetworkRank:Y})}});let f=o;return Array.isArray(r?.exclude)&&(f=f?.filter(({coinId:A})=>!r?.exclude?.includes(A))),f},[]);var Rt=()=>{let e=(0,y.useDispatch)();return(0,d.useCallback)(async(r,t)=>{await W().updateKeyringIdentityName(r,t),await b(e)},[])},Lt=()=>{let e=(0,y.useDispatch)();return(0,d.useCallback)(async(r,t)=>{await W().updateWalletIdentityName(r,t),await b(e)},[])},Dt=()=>{let e=(0,y.useDispatch)();return(0,d.useCallback)(async(r,t)=>{await W().updateKeyringIdentitiesOrder(r,t),await b(e)},[e])};export{Pe as a,Ue as b,vr as c,Cr as d,H as e,Ft as f,j as g,xr as h,St as i,B as j,bt as k,Mt as l,Ot as m,Nt as n,kt as o,jt as p,wr as q,Bt as r,$t as s,Rt as t,Lt as u,Dt as v};
//# sourceMappingURL=chunk-YGMRSF47.js.map
