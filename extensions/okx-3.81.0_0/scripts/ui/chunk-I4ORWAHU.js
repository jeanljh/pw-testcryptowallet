import{b as z,d as P}from"./chunk-SLQQVCPY.js";import{c as w,o as l,p as i,q as h}from"./chunk-Y5OH3DDZ.js";var x=w(S=>{l();h();Object.defineProperty(S,"__esModule",{value:!0});S.validate=void 0;function he(t,e){if(!t)throw new Error(e)}S.validate=he});var G=w(E=>{l();h();Object.defineProperty(E,"__esModule",{value:!0});E.convert=void 0;var F=x();function de(t,e,r,n){for(var s=n?Math.floor(t.length*e/r):Math.ceil(t.length*e/r),o=(1<<r)-1,c=new Uint8Array(s),u=0,y=0,d=0,B=0;B<t.length;++B){var m=t[B];for((0,F.validate)(0<=m&&m>>e===0,"Invalid value: "+m+"."),y=y<<e|m,d+=e;d>=r;)d-=r,c[u]=y>>d&o,++u}return n?(0,F.validate)(d<e&&(y<<r-d&o)===0,"Input cannot be converted to "+r+" bits without padding, but strict mode was used."):d>0&&(c[u]=y<<r-d&o,++u),c}E.convert=de});var J=w(_=>{l();h();Object.defineProperty(_,"__esModule",{value:!0});_.decode=_.encode=void 0;var W=x(),fe="qpzry9x8gf2tvdw0s3jn54khce6mua7l",R={q:0,p:1,z:2,r:3,y:4,9:5,x:6,8:7,g:8,f:9,2:10,t:11,v:12,d:13,w:14,0:15,s:16,3:17,j:18,n:19,5:20,4:21,k:22,h:23,c:24,e:25,6:26,m:27,u:28,a:29,7:30,l:31};function ge(t){for(var e="",r=0;r<t.length;++r){var n=t[r];(0,W.validate)(0<=n&&n<32,"Invalid value: "+n+"."),e+=fe[n]}return e}_.encode=ge;function ve(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;++r){var n=t[r];(0,W.validate)(n in R,"Invalid value: "+n+"."),e[r]=R[n]}return e}_.decode=ve});var q=w(f=>{l();h();var pe=f&&f.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),be=f&&f.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ye=f&&f.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&pe(e,t,r);return be(e,t),e};Object.defineProperty(f,"__esModule",{value:!0});f.payToAddrScript=f.encodePubKeyAddress=void 0;var O=x(),$=G(),X=ye(J()),we=P();function _e(t,e){let r=[0,0,0,0,0,0,0,0],n=Q(e).concat([0]),s=0,o=Array.prototype.slice.call(we.base.fromHex(t),0),c=(0,$.convert)(new Uint8Array([s].concat(o)),8,5,!1),u=new Uint8Array(n.length+c.length+r.length);u.set(n),u.set(c,n.length),u.set(r,n.length+c.length);let y=me(V(u)),d=new Uint8Array(c.length+y.length);return d.set(c),d.set(y,c.length),"kaspa:"+X.encode(d)}f.encodePubKeyAddress=_e;function Ie(t){(0,O.validate)(He(t),"Mixed case"),t=t.toLowerCase();let e=t.split(":");(0,O.validate)(e.length===2,"Invalid format: "+t);let r=e[0];(0,O.validate)(r==="kaspa","Invalid prefix: "+t);let n=e[1],s=X.decode(n);(0,O.validate)(Pe(r,s),"Invalid checksum: "+t);let o=(0,$.convert)(s.slice(0,-8),5,8,!0),c=o[0],u=o.slice(1);switch(c){case 0:if(u.length!==32)throw new Error("Invalid Schnorr public key length");return i.Buffer.concat([i.Buffer.from([32]),u,i.Buffer.from([172])]);case 1:if(u.length!==33)throw new Error("Invalid ECDSA public key length");return i.Buffer.concat([i.Buffer.from([33]),u,i.Buffer.from([171])]);case 8:if(u.length!==32)throw new Error("Invalid script hash length");return i.Buffer.concat([i.Buffer.from([170]),i.Buffer.from([32]),u,i.Buffer.from([135])]);default:throw new Error(`Unsupported address version: ${c}`)}}f.payToAddrScript=Ie;function He(t){return t===t.toLowerCase()||t===t.toUpperCase()}function Q(t){let e=[];for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r)&31);return e}function me(t){let e=[];for(let r=0;r<8;++r)e.push(t&31),t/=32;return e.reverse()}function Pe(t,e){let r=Q(t),n=new Uint8Array(t.length+1+e.length);return n.set(r),n.set([0],r.length),n.set(e,r.length+1),V(n)===0}var Y=[152,121,243,174,30],Se=[4072443489,3077413346,1046459332,783016616,1329849456];function V(t){for(var e=0,r=1,n=0,s=0;s<t.length;s++){n=e>>>3,e&=7,e<<=5,e|=r>>>27,r&=134217727,r<<=5,r^=t[s];for(var o=0;o<Y.length;++o)n&1<<o&&(e^=Y[o],r^=Se[o])}return r^=1,r<0&&(r^=1<<31,r+=(1<<30)*2),e*(1<<30)*4+r}});var T=w(g=>{l();h();Object.defineProperty(g,"__esModule",{value:!0});g.validateAddress=g.addressFromPrvKey=g.addressFromPubKey=g.checkPrvKey=g.pubKeyFromPrvKey=void 0;var K=P(),xe=z(),Z=q();function ee(t){if(!te(t))throw new Error("invalid key");return K.base.toHex(xe.signUtil.secp256k1.publicKeyCreate(K.base.fromHex(t.toLowerCase()),!0).slice(1))}g.pubKeyFromPrvKey=ee;function te(t){if(!K.base.validateHexString(t))return!1;let e=K.base.fromHex(t.toLowerCase());return e.length==32&&!e.every(r=>r===0)}g.checkPrvKey=te;function re(t){return(0,Z.encodePubKeyAddress)(t,"kaspa")}g.addressFromPubKey=re;function Ee(t){return re(ee(t))}g.addressFromPrvKey=Ee;function Oe(t){try{(0,Z.payToAddrScript)(t)}catch{return!1}return!0}g.validateAddress=Oe});var j=w(v=>{l();h();Object.defineProperty(v,"__esModule",{value:!0});v.Transaction=v.signMessage=v.calcTxHash=v.transfer=void 0;var a=P(),ie=z(),k=q(),Ke=i.Buffer.from("TransactionSigningHash"),Ae=i.Buffer.from("TransactionID"),Ue=i.Buffer.from("PersonalMessageSigningHash");function Ce(t,e){return I.fromTxData(t).sign(e).getMessage()}v.transfer=Ce;function Le(t){let e=new p;return e.writeUInt16LE(t.version),e.writeUInt64LE(BigInt(t.inputs.length)),t.inputs.forEach(r=>{e.writeHash(a.base.fromHex(r.previousOutpoint.transactionId)),e.writeUInt32LE(r.previousOutpoint.index),e.writeVarBytes(i.Buffer.alloc(0)),e.writeUInt64LE(BigInt(r.sequence))}),e.writeUInt64LE(BigInt(t.outputs.length)),t.outputs.forEach(r=>{e.writeUInt64LE(BigInt(r.amount)),e.writeUInt16LE(r.scriptPublicKey.version),e.writeVarBytes(a.base.fromHex(r.scriptPublicKey.scriptPublicKey))}),e.writeUInt64LE(BigInt(t.lockTime)),e.writeHash(a.base.fromHex(t.subnetworkId)),e.writeUInt64LE(0n),e.writeVarBytes(i.Buffer.alloc(0)),a.base.toHex(a.base.blake2(e.toBuffer(),256,Ae))}v.calcTxHash=Le;function Be(t,e){let r=a.base.blake2(i.Buffer.from(t),256,Ue),n=ie.signUtil.schnorr.secp256k1.schnorr.sign(r,a.base.toHex(a.base.fromHex(e)));return a.base.toHex(n)}v.signMessage=Be;var I=class{static fromTxData(e){return new I(e)}constructor(e){this.version=0,this.inputs=[],this.outputs=[],this.lockTime="0",this.subnetworkId="0000000000000000000000000000000000000000",this.utxos=[];let r=0n;e.inputs.forEach(o=>{this.inputs.push({previousOutpoint:{transactionId:o.txId,index:o.vOut},signatureScript:"",sequence:"0",sigOpCount:1}),this.utxos.push({pkScript:(0,k.payToAddrScript)(o.address),amount:o.amount}),r+=BigInt(o.amount)});let n=0n;e.outputs.forEach(o=>{this.outputs.push({scriptPublicKey:{version:0,scriptPublicKey:a.base.toHex((0,k.payToAddrScript)(o.address))},amount:o.amount}),n+=BigInt(o.amount)});let s=r-n-BigInt(e.fee);s>=BigInt(e.dustSize||546)&&this.outputs.push({scriptPublicKey:{version:0,scriptPublicKey:a.base.toHex((0,k.payToAddrScript)(e.address))},amount:s.toString()})}sign(e){return this.inputs.forEach((r,n)=>{let s=ke(this,ne,n,{}),o=ie.signUtil.schnorr.secp256k1.schnorr.sign(s,a.base.toHex(a.base.fromHex(e)));r.signatureScript=a.base.toHex(i.Buffer.concat([i.Buffer.from([65]),o,i.Buffer.from([ne])]))}),this}getMessage(){return JSON.stringify({transaction:{version:this.version,inputs:this.inputs,outputs:this.outputs,lockTime:this.lockTime,subnetworkId:this.subnetworkId},allowOrphan:!1})}};v.Transaction=I;var ne=1,qe=2,Te=4,se=128,oe=7;function ae(t){return(t&oe)===qe}function ce(t){return(t&oe)===Te}function M(t){return(t&se)===se}function ke(t,e,r,n={}){let s=new p;s.writeUInt16LE(t.version),s.writeHash(je(t,e,n)),s.writeHash(Ne(t,e,n)),s.writeHash(De(t,e,n));let o=t.inputs[r],c=t.utxos[r];return ue(s,o),s.writeUInt16LE(0),s.writeVarBytes(c.pkScript),s.writeUInt64LE(BigInt(c.amount)),s.writeUInt64LE(BigInt(o.sequence)),s.writeUInt8(1),s.writeHash(ze(t,r,e,n)),s.writeUInt64LE(BigInt(t.lockTime)),s.writeHash(Me()),s.writeUInt64LE(0n),s.writeHash(H()),s.writeUInt8(e),s.finalize()}function H(){return i.Buffer.alloc(32)}function Me(){return i.Buffer.alloc(20)}function je(t,e,r){if(M(e))return H();if(!r.previousOutputsHash){let n=new p;t.inputs.forEach(s=>ue(n,s)),r.previousOutputsHash=n.finalize()}return r.previousOutputsHash}function Ne(t,e,r){if(ce(e)||M(e)||ae(e))return H();if(!r.sequencesHash){let n=new p;t.inputs.forEach(s=>n.writeUInt64LE(BigInt(s.sequence))),r.sequencesHash=n.finalize()}return r.sequencesHash}function De(t,e,r){if(M(e))return H();if(!r.sigOpCountsHash){let n=new p;t.inputs.forEach(s=>n.writeUInt8(1)),r.sigOpCountsHash=n.finalize()}return r.sigOpCountsHash}function ze(t,e,r,n){if(ae(r))return H();if(ce(r))return e>=t.outputs.length?H():new p().finalize();if(!n.outputsHash){let s=new p;t.outputs.forEach(o=>Fe(s,o)),n.outputsHash=s.finalize()}return n.outputsHash}function ue(t,e){t.writeHash(a.base.fromHex(e.previousOutpoint.transactionId)),t.writeUInt32LE(e.previousOutpoint.index)}function Fe(t,e){t.writeUInt64LE(BigInt(e.amount)),t.writeUInt16LE(0),t.writeVarBytes(a.base.fromHex(e.scriptPublicKey.scriptPublicKey))}var p=class{constructor(){this.bufLen=0,this.bufs=[]}toBuffer(){return this.concat()}concat(){return i.Buffer.concat(this.bufs,this.bufLen)}write(e){return this.bufs.push(e),this.bufLen+=e.length,this}writeReverse(e){return this.bufs.push(e.reverse()),this.bufLen+=e.length,this}writeHash(e){return this.write(e),this}writeVarBytes(e){return this.writeUInt64LE(BigInt(e.length)),this.write(e),this}writeUInt8(e){let r=i.Buffer.alloc(1);return r.writeUInt8(e),this.write(r),this}writeUInt16LE(e){let r=i.Buffer.alloc(2);return r.writeUInt16LE(e),this.write(r),this}writeUInt32LE(e){let r=i.Buffer.alloc(4);return r.writeUInt32LE(e,0),this.write(r),this}writeUInt64LE(e){let r=i.Buffer.alloc(8);return r.writeBigUInt64LE(e),this.write(r),this}finalize(){return a.base.blake2(this.toBuffer(),256,Ke)}}});var le=w(L=>{l();h();Object.defineProperty(L,"__esModule",{value:!0});L.KaspaWallet=void 0;var A=P(),U=T(),C=j(),N=class extends A.BaseWallet{async getDerivedPath(e){return`m/44'/111111'/0'/0/${e.index}`}async getNewAddress(e){return Promise.resolve({address:(0,U.addressFromPrvKey)(e.privateKey),publicKey:(0,U.pubKeyFromPrvKey)(e.privateKey)})}async validPrivateKey(e){let n={isValid:(0,U.checkPrvKey)(e.privateKey),privateKey:e.privateKey};return Promise.resolve(n)}async validAddress(e){return Promise.resolve({isValid:(0,U.validateAddress)(e.address),address:e.address})}async signTransaction(e){try{return Promise.resolve((0,C.transfer)(e.data,e.privateKey))}catch{return Promise.reject(A.SignTxError)}}async calcTxHash(e){try{return typeof e.data=="string"?Promise.resolve((0,C.calcTxHash)(JSON.parse(e.data).transaction)):Promise.resolve((0,C.calcTxHash)(e.data.transaction))}catch{return Promise.reject(A.CalcTxHashError)}}async signMessage(e){try{return Promise.resolve((0,C.signMessage)(e.data.message,e.privateKey))}catch{return Promise.reject(A.SignTxError)}}};L.KaspaWallet=N});var Re=w(b=>{l();h();var Ge=b&&b.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),D=b&&b.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ge(e,t,r)};Object.defineProperty(b,"__esModule",{value:!0});D(le(),b);D(T(),b);D(j(),b)});export{Re as a};
//# sourceMappingURL=chunk-I4ORWAHU.js.map
