import{b as S,c as x}from"./chunk-MDBKHBHQ.js";import{a as v}from"./chunk-WRVJM3F3.js";import{a as W,b}from"./chunk-XVSXMJ3S.js";import{b as L}from"./chunk-XRCQOGA2.js";import{c as $,e as D,j as y,l as H,p as ne}from"./chunk-YGMRSF47.js";import{a as xe}from"./chunk-GCS2RK7E.js";import{f as Se}from"./chunk-VJI6MZK4.js";import{o as Je}from"./chunk-Z62JX42S.js";import{Na as te,la as Ee}from"./chunk-2QHGKEME.js";import{a as Ze}from"./chunk-B624VS3G.js";import{a as Xe}from"./chunk-6PA65BO3.js";import{h as ke,k as V,l as Ce}from"./chunk-YIFLUVTR.js";import{c as q,e as ze}from"./chunk-EN2WHAVL.js";import{a as I,b as pe,c as w,t as de}from"./chunk-EFOY37CC.js";import{c as qe}from"./chunk-GR7YC6C3.js";import{J as He}from"./chunk-O33H5V3V.js";import{i as B,n as he}from"./chunk-35ANKHOJ.js";import{$b as G,M as Ae,N as $e,Sb as Qe,ac as _e,la as E,na as Te,nc as ye,rb as we,tb as ge,ub as Y}from"./chunk-COF7YKSN.js";import{A as me,K as Ge}from"./chunk-VZKEX7KP.js";import{I as fe}from"./chunk-BJKBO23H.js";import{D as K,J as j,r as le,va as ee}from"./chunk-XFTQD4B2.js";import{b as _}from"./chunk-73B6GL3S.js";import{f as k,o as l,q as m}from"./chunk-Y5OH3DDZ.js";l();m();var Q=k(_());ge();var z=(e=E,n,t)=>{let o=y(n);return(0,Q.useMemo)(()=>$(o,e,t),[o,e,t])},oe=(e,n=E,t)=>{let o=H(e);return(0,Q.useMemo)(()=>o.map(r=>$(r,n,t)),[o,n,t])},je=(e=E,n,t)=>{let o=y(n),r=z(e,n,t);return{...o,address:r}},et=(e,n,t)=>{let o=H(e);return(0,Q.useMemo)(()=>o.map(r=>({...r,address:$(r,n,t)})),[o,n,t])},tt=(e,n,t=Te)=>{let o=we(t);return(y(n)?.addressType?.[o]||[]).find(i=>i.address===e)?.addressType};l();m();var Me=k(_()),Re=k(Xe());Ge();l();m();var be=k(te());l();m();Ce();$e();var nt=V({name:"assetsSlice",initialState:{assets:[]},reducers:{setAssets:(e,n)=>{e.assets=n.payload}}}),{actions:ot,reducer:rt}=nt,st=[],We=ke(e=>e.assetsSlice.assets??st,e=>e.reduce((n,t)=>n.set(t.walletId,t),new Map)),vt=()=>async e=>{(await Ae.assets).liveQuery().subscribe((t,o)=>{o||e(ot.setAssets(t))})},Dt=rt;function M(){return(0,be.useSelector)(We)}l();m();ye();ge();var R=({walletAccounts:e,rpcData:n,assetsMap:t,showNftAmount:o,selectedCurrency:r})=>{let s=e.map(c=>{if(!c)return{walletAsset:"0",platformAsset:"0"};let{walletId:a}=c;if(!!n){let{chainTokensAccountMap:C}=n,g=c?.account?.[E];if(!g||[G.HD_KEYRING,G.SIMPLE_KEYRING,G.MPC_KEYRING].indexOf(c?.initialType)<0)return{unsupported:!0,walletAsset:"0",platformAsset:"0",...c};let{balance:Z="0"}=C[g]?.filter(({address:X})=>!X)[0]||{};return{walletAsset:Z,platformAsset:"0",...c}}let d=t.get(a),f=(d?[d.tokenTotalAssetsUSD,d.defiTotalAssetsUSD,o?d.nftTotalAssetsUSD:"0"]:[]).reduce((C,g)=>w(C,g),"0");return{walletAsset:d?I(f,r.usdToThisRate):"--",platformAsset:d?d.platformTotalAssetsUSD:"--",...c}}),{walletAsset:i,platformAsset:u}=s.reduce((c,a)=>({walletAsset:w(c.walletAsset,a.walletAsset==="--"?"0":a.walletAsset),platformAsset:w(c.platformAsset,a.platformAsset==="--"?"0":a.platformAsset)}),{walletAsset:"0",platformAsset:"0"});return{walletAccountsWidthBalance:s,walletAsset:i,platformAsset:u}};var at=e=>{let n=(0,Re.useHistory)(),t=ne(e),[o]=b(W.showNftAmount),r=S(),s=x(r),i=M();return t||(fe.error(me("wallet_extension_top_error_parameters")),n.push(xe)),(0,Me.useMemo)(()=>{let{walletIdentities:u}=t,{walletAccountsWidthBalance:c,walletAsset:a,platformAsset:p}=R({walletAccounts:u,showNftAmount:o,rpcData:null,selectedCurrency:s,assetsMap:i});return{...t,walletAsset:a,platformAsset:p,walletIdentities:c}},[t,o,s,i])},ct=at;l();m();l();m();var Ne=k(_());var it=e=>{let[n]=b(W.showNftAmount),t=y(e),o=M(),r=S(),s=x(r);return(0,Ne.useMemo)(()=>{let{walletAccountsWidthBalance:i}=R({walletAccounts:[t],showNftAmount:n,rpcData:null,selectedCurrency:s,assetsMap:o});return i[0]},[t,n,s,o])},ut=it;l();m();var ue=k(_()),Ye=k(te());ee();l();m();var O=k(_()),T=k(te()),N=k(Je()),ie=k(Ze());ee();l();m();var Ie=k(_());l();m();he();var re={};async function lt(e){try{return await Promise.all([e.getBlockNumber(),e.getNetwork()]),!0}catch{return!1}}var mt=async e=>{let{ethers:n}=await B(),t=new n.JsonRpcProvider(e);return await lt(t)||(t=new n.JsonRpcProvider(e,null,{batchMaxCount:1})),re[e]=t,t},Pe=async e=>re[e]?re[e]:await mt(e);var F=(e="",n=null)=>{let t=v(),o=n||t;return(0,Ie.useCallback)(async()=>{let r=e||o?.rpcUrl;return r?await Pe(r):{}},[e,o?.rpcUrl])};l();m();var Be=k(_());function J(e,n,t){let o=Be.default.useRef({});return(!("value"in o.current)||t(o.current.condition,n))&&(o.current.value=e(),o.current.condition=n),o.current.value}he();ye();Qe();qe();He();l();m();var pt=6,dt=(e,n=pt)=>{if(!Number(e))return"0";let t=e?.toString();return(e.split(".")[1]||"")?.length>n?de(t,n&&Number(n)):t},ve=(e,n)=>{let{rpcUrl:t,chainId:o,account:r,existAccounts:s,isDeleted:i}=n;return Array.isArray(e)?e.filter(u=>{let c=u,a=!0;return o&&(a=a&&c.chainId===o),r&&(a=a&&c.account===r),Array.isArray(s)&&!!s?.length&&(a=a&&s?.includes(c.account)),i!==void 0&&(a=a&&(c.isDeleted||!1)===i),c.address||(a=a&&c.rpcUrl===t),a}):[]},De=(e,n={})=>{let{symbol:t,usdToThisRate:o,chainTokenPrice:r,chainTokenBalance:s}=n;return Array.isArray(e)?e.map(i=>{let u=i,c,a,{chainId:p,decimals:d}=u,h=t;u.address?(c=r?.[p]?.[u.address]||0,a=s?.[u.account]?.[p]?.[u.address]||0):(c=r?.[p]?.price||0,a=s?.[u.account]?.[p]?.balance||0);let f=a&&pe(a,10**d),C=dt(I(f,I(c,o)));return{price:c,balance:f,balanceInt:a,...u,moneySymbol:h,marketValue:C}}):[]};l();m();Ce();ze();l();m();ee();l();m();var Le="rpc",U={MANAGE_NET:"manageNet",EVM:"evm"},Fe={[U.MANAGE_NET]:"ManageNet",[U.EVM]:"Evm"};var Ue=le((e,n)=>{let t=Fe[e];if(!t)throw new Error("rpc type must in maps");if(!(typeof n=="string"&&/^[0-9a-zA-Z]+$/g.test(n)))throw new Error("scope name is invalid");return`${Le}${t}${n}`}),Kn=Ue(U.MANAGE_NET),Oe=Ue(U.EVM),Vn={"MNEMONIC WALLET":"seed_phrase","PRIVATE KEY WALLET":"private_key","MPC WALLET":"mpc","HARDWARE WALLET":"hardware"};var ft="Token",At=Oe(ft),ht={chainTokens:[],chainTokenPrice:{},chainTokenBalance:{}},se=e=>e.metamask.rpcEvmChainTokens||[],Ke=e=>e.metamask.rpcEvmChainTokenBalance||{},kt=V({name:At,initialState:ht,reducers:{}}),{reducer:Ct}=kt,Ve=e=>async()=>{await q().addChainToken(e)},ae=e=>async()=>{await q().updateChainToken(e)},ce=e=>async()=>{await q().updateChainTokenBalance(e)},zn=Ct;var P=(e,n,t=!0,o=null)=>{let r=v(),s=o||r,{chainId:i,rpcUrl:u}=s,c=(0,T.useSelector)(se),a=(0,T.useSelector)(Ke),{symbol:p,usdToThisRate:d}=(0,T.useSelector)(Ee),h=z(),f=oe(void 0,Y),C=(0,O.useMemo)(()=>ve(c,{chainId:i,rpcUrl:u,existAccounts:f,account:t?h:void 0,isDeleted:n?void 0:!1}),[i,h,f,c]);return(0,O.useMemo)(()=>e?C:De(C,{symbol:p,usdToThisRate:d,chainTokenBalance:a}),[p,C,d,a,e])},Co=(e,n,t)=>{let o=P(n,void 0,void 0,t);return(0,O.useMemo)(()=>o.find(r=>r.address===(e||void 0))||{},[e,o])};var Tt=(e,n)=>{let t=F(e,n);return(0,N.useMemoizedFn)(async o=>{let r=await t(),{ethers:s}=await B(),i=new s.Contract(o,ie.default,r),u=await i.symbol(),c=(await i.decimals()).toString();return{name:await i.name(),symbol:u,decimals:c}},[t])},wt=e=>{let n=F(void 0,e),t=L();return(0,N.useMemoizedFn)(async(o,r,s)=>{let i,u=s||await n(),c=r||t;if(!o)i=await u.getBalance(c,"latest"),i=i.toString();else{let{ethers:a}=await B();i=await new a.Contract(o,ie.default,u).balanceOf(c),i=i.toString()}return i},[n,t])};var To=()=>{let e=F(),n=(0,T.useDispatch)();return(0,N.useMemoizedFn)(async({chainId:t,injectProvider:o,wallets:r=[]})=>{let s=o||await e(),i=r.map(async u=>{let c=await s.getBalance(u,"latest");c=c.toString(),n(ce({chainId:t,balance:c,account:u}))});await Promise.all(i)})},gt=()=>{let e=(0,T.useDispatch)(),n=L(),t=wt();return(0,N.useMemoizedFn)(async({chainId:o,address:r,injectAccount:s,injectProvider:i})=>{let u=await t(r,s,i);return e(ce({chainId:o,balance:u,address:r,account:s||n})),!0},[t,n])},wo=e=>{let n=L(),t=v(),o=e||t,{chainId:r}=o,s=P(!0,!1,!1,e);return J(()=>({chainId:r,chainTokens:s}),{chainId:r,account:n,needPollChainTokens:s},(i,u)=>!j(i,u))},_t=18,yt=()=>{let e=(0,T.useDispatch)(),n=(0,T.useSelector)(se),t=L();return(0,N.useMemoizedFn)((o,r,s)=>{if(!o&&!t&&!s?.account)return!1;let{rpcUrl:i}=s,u=n.find(a=>{let p=a.chainId===o&&a.address===r&&a.account===(s?.account||t);return r||(p=p&&a.rpcUrl===i),p});if(u){if(u.isDeleted===!0){let a={...u,...s,chainId:o,address:r,isDeleted:!1};return e(ae(a)),!0}return!1}let c={chainId:o,address:r,isDeleted:!1,account:t,decimals:_t};return s&&typeof s=="object"&&Object.assign(c,s),e(Ve(c)),!0},[n,t])},go=e=>{let n=F(e),t=yt(),o=Tt(e),r=gt();return async(s,i)=>{let u=await o(i);if(t(s,i,u)){let a=await n();await r(s,i,a)}}},Et=(e={})=>{let n=D(e);return J(()=>n.reduce((t,o)=>{if(o.keyringIdentityType===_e.MNEMONIC)t.push(o);else{let r=o.walletIdentities.filter(s=>Boolean(s.account[Y]));r.length&&t.push({...o,walletIdentities:r})}return t},[]),n,(t,o)=>!j(t,o))},_o=(e={})=>{let n=Et(e),t=P(!1,!1,!1);return(0,O.useMemo)(()=>{let o=K(t||[],"account");return n?.map(r=>{let s="",i=r.walletIdentities?.map(c=>{let a=c?.account?.[Y],{balance:p,symbol:d}=o[a]?.filter(({address:h})=>!h)[0]||{};return s=d,{...c,balance:p,symbol:d}}),u=i.reduce((c,a)=>w(c,a.balance),0);return{...r,marketValue:u,marketValueSymbol:s,walletIdentities:i}})||[]},[t,n])},yo=()=>{let e=(0,T.useDispatch)(),n=P(!0,!1,!1);return t=>{n?.filter(({chainId:o,rpcUrl:r,address:s})=>!s&&o===t.chainId&&r===t.rpcUrl)?.forEach(({chainId:o,account:r})=>{e(ae({chainId:o,account:r,...t}))})}};var St=(e,n=!0)=>{let t=D(e),[o]=b(W.showNftAmount),r=S(),s=x(r),{isRpcMode:i}=(0,Ye.useSelector)(Se),u=P(!1,!1,!1),c=K(u||[],"account"),a=M(),p=(0,ue.useMemo)(()=>t.map(h=>{let{walletIdentities:f}=h,C=i?{chainTokensAccountMap:c}:null,{walletAccountsWidthBalance:g,walletAsset:Z,platformAsset:X}=R({walletAccounts:f,showNftAmount:o,rpcData:n?C:null,selectedCurrency:s,assetsMap:a});return{...h,walletAsset:Z,platformAsset:X,walletIdentities:g}}),[t,o,c,i,s,a]);return[(0,ue.useMemo)(()=>p?.reduce((h,f)=>({walletAsset:w(h.walletAsset,f.walletAsset==="--"?"0":f.walletAsset),platformAsset:w(h.platformAsset,f.platformAsset==="--"?"0":f.platformAsset),rpcModeCoinSymbol:h.rpcModeCoinSymbol||f?.rpcModeCoinSymbol}),{walletAsset:"0",platformAsset:"0",rpcModeCoinSymbol:""}),[p]),p]},xt=St;export{vt as a,Dt as b,mt as c,Pe as d,Kn as e,Oe as f,Vn as g,At as h,se as i,ae as j,ce as k,zn as l,z as m,je as n,et as o,tt as p,ut as q,ct as r,F as s,J as t,P as u,Co as v,Tt as w,wt as x,To as y,gt as z,wo as A,yt as B,go as C,Et as D,_o as E,yo as F,xt as G};
//# sourceMappingURL=chunk-ZOKF3EKQ.js.map
