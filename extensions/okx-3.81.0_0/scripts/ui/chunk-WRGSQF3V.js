import{a as se}from"./chunk-ELHHHA5F.js";import{a as st}from"./chunk-WST3WRLT.js";import{b as rt}from"./chunk-57D6LCV2.js";import{N as Re}from"./chunk-OQUE64GQ.js";import{A as we,B as Be}from"./chunk-Q7DF5H6O.js";import{d as W,g as Ie,i as ot}from"./chunk-BNS5ABAB.js";import{b as tt}from"./chunk-7HYQ2DGP.js";import{F as ze}from"./chunk-3ZKJXYZ4.js";import{c as re}from"./chunk-OOYDFTEF.js";import{a as nt}from"./chunk-U7IWD6UB.js";import{h as oe,m as Ee,n as Pe,s as fe}from"./chunk-YGMRSF47.js";import{a as Qe,f as et,h as be,u as K}from"./chunk-FGAB46RQ.js";import{o as pe}from"./chunk-Z62JX42S.js";import{Na as Rt,la as $e}from"./chunk-2QHGKEME.js";import{W as Ae,c as Ue}from"./chunk-WU2LB6XB.js";import{b as de}from"./chunk-GLL4BXR6.js";import{c as Z,e as Bt}from"./chunk-EN2WHAVL.js";import{a as Xe,b as Ye,c as He,j as Ge}from"./chunk-EFOY37CC.js";import{c as I}from"./chunk-HMTT52FG.js";import{b as ee,c as At}from"./chunk-GR7YC6C3.js";import{E as ne,J as bt}from"./chunk-O33H5V3V.js";import{b as te,f as le,n as Pt}from"./chunk-35ANKHOJ.js";import{Jb as qe,Sa as Ze,Sb as wt,dc as x,na as G,nc as _e,tb as It}from"./chunk-COF7YKSN.js";import{A as y,K as Fe,o as H}from"./chunk-VZKEX7KP.js";import{I as Je,d as Ne,o as me,r as Ve}from"./chunk-BJKBO23H.js";import{f as M,h as Et}from"./chunk-K336SGW3.js";import{aa as We,f as Ke,va as Ut}from"./chunk-XFTQD4B2.js";import{z as Q}from"./chunk-ZFVABNQN.js";import{a as je}from"./chunk-4QGZDIBD.js";import{b as ue}from"./chunk-73B6GL3S.js";import{f as L,o as A,p as v,q as E}from"./chunk-Y5OH3DDZ.js";A();E();var N=L(ue()),gt=L(Rt()),R=L(pe());Ut();Fe();Bt();Pt();_e();Et();wt();It();At();bt();A();E();var D=L(ue()),Ce=L(pe());A();E();function Dt(e,t,r,o,n=4){return(0,Ce.useMemoizedFn)(async(s,u)=>{let i=0;for(let a=0;a<n;a++){let c=await e(s,void 0,{tempFeeRate:Number(u.expectedFeeRate)});if(!c.length)return[];i=c.reduce((l,p)=>l+p.coinAmount,0);let m=await t({inputs:c,outputs:[{address:r,amount:o}],dustSize:i});if(i-(m+Number(u.increaseFee))>o)return[!0,!1,c,m];if(i>o&&a===n-1)return m=i-o,[!1,!0,c,m]}return[]})}function at(e){let[t,r]=(0,D.useState)({}),[o,n]=(0,D.useState)(0),[s,u]=(0,D.useState)([]),[i,a]=(0,D.useState)(void 0),{mainCoinId:c,address:m,btcSpeedUpInfo:_,txHash:l}=e,p=c,d=W(p),f=nt(),T=(0,D.useMemo)(()=>_?.cpfpSpeedUpUtxo?.map(w=>`${w.txHash}-${w.vout}`),[_]),[,g]=st({coinId:p,address:m,chainId:d?.chainId},{pollingInterval:20*1e3}),h=g?.minOutput||0,C=ge({coinId:p,fromAddr:m,output:[{to:m,value:h}],satBytes:t?.expectedFeeRate}),S=Te({coinId:p,address:m,walletId:f,utxoType:q.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:T}),{cancel:b}=(0,Ce.useRequest)(async()=>{let w=await ze({address:m,coinId:p,txHash:l});r(w);let B=await S(0,void 0,{tempFeeRate:t.expectedFeeRate});u(B),a(void 0)},{pollingInterval:20*1e3,onError:w=>{a(w),b()}});(0,D.useEffect)(()=>{if(t?.expectedFeeRate&&s.length){let w=s.reduce((B,V)=>B+V.coinAmount,0);C({inputs:s,outputs:[{address:m,amount:h}],satBytes:t.expectedFeeRate,dustSize:w}).then(B=>{let V=He(B,Number(t.increaseFee),h);n(V)}).catch(B=>{throw B})}},[m,h,t,s,t?.expectedFeeRate]);let k=Dt(S,C,m,h);return[o,t,h,k,i]}A();E();var P=L(ue()),pt=L(pe()),dt=L(je());Fe();_e();A();E();var F=L(ue()),mt=L(pe()),ye=L(je());Fe();_e();A();E();var U={"retina-border-basic":"_retina-border-basic_gm6nn_1",retinaBorderBasic:"_retina-border-basic_gm6nn_1",root:"_root_gm6nn_29",subTitle:"_subTitle_gm6nn_32",utxo:"_utxo_gm6nn_37",coin:"_coin_gm6nn_45",coinDetail:"_coinDetail_gm6nn_81",coinSymbol:"_coinSymbol_gm6nn_87",nftImage:"_nftImage_gm6nn_93",coinAmount:"_coinAmount_gm6nn_96",coinValue:"_coinValue_gm6nn_101",assetList:"_assetList_gm6nn_109",unresolvedTip:"_unresolvedTip_gm6nn_109",list:"_list_gm6nn_116",paddingTop:"_paddingTop_gm6nn_119",asset:"_asset_gm6nn_109",assetDetail:"_assetDetail_gm6nn_129",assetValue:"_assetValue_gm6nn_130",foldSwitch:"_foldSwitch_gm6nn_144",fold:"_fold_gm6nn_144"};var $=e=>[x.ARC_NFT,x.BRC_NFT,x.FRACTAL_ORDINAL,x.DRC_NFT,x.SRC_NFT].includes(e),lt=e=>$(e?.protocolId)?`${e.collectionName||""} ${e.inscriptionNumber||e.nftId||""}`:Qe(e.tokenAmount||"",{symbol:e.tokenSymbol||""}).value,_t=({asset:e,selectedCurrency:t,className:r})=>F.default.createElement(K.Text,{ellipsis:{tooltip:!0},className:r},Ge(e.usdAmount,0)?y("extension_defi_card_text_unknown_value"):et(H.mul(e.usdAmount,t.usdToThisRate),{currencySign:t.symbol}).value),Kt=({assetList:e,assetUnknown:t,selectedCurrency:r})=>{let o=e.length>3,[n,{toggle:s}]=(0,mt.useBoolean)(o),u=n?e.slice(0,3):e,i=!!t?.length;return F.default.createElement(I.Box,{className:U.assetList},i&&F.default.createElement(K.Text,{className:U.unresolvedTip},y("extension_defi_mid_alert_utxo_not_decode",{asset:t.join(y("extension_wallet_text_punctuation_mark"))})),u?.length?F.default.createElement(I.Box,{className:(0,ye.default)(U.list,{[U.paddingTop]:!i})},u.map(a=>F.default.createElement(I.Box,{className:U.asset},F.default.createElement(K.Text,{ellipsis:{tooltip:!0},className:U.assetDetail},lt(a)),F.default.createElement(_t,{asset:a,className:U.assetValue,selectedCurrency:r})))):null,!!o&&F.default.createElement(I.Box,{align:I.ALIGN.center,className:(0,ye.default)(U.foldSwitch,{[U.fold]:n}),onClick:s},F.default.createElement(I.Box,null,y(n?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),F.default.createElement(re,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},Wt=({title:e,utxoList:t,selectedCurrency:r})=>F.default.createElement(I.Box,{className:U.root},F.default.createElement(K.Text,{className:U.subTitle},e),t.map(o=>{let{mainAsset:n,protocolAssetList:s,assetUnknown:u}=o;return F.default.createElement(I.Box,{className:U.utxo},F.default.createElement(I.Box,{className:U.coin},F.default.createElement(I.Box,{className:U.coinDetail},F.default.createElement(re,{className:(0,ye.default)(U.coinSymbol,{[U.nftImage]:$(n.protocolId)}),radius:!1,size:$(n.protocolId)?be.sm:be.xs,src:n.image,text:n.tokenSymbol}),F.default.createElement(K.Text,{ellipsis:{tooltip:!0},className:U.coinAmount},lt(n))),F.default.createElement(_t,{className:U.coinValue,asset:n,selectedCurrency:r})),F.default.createElement(Kt,{assetList:s,assetUnknown:u,selectedCurrency:r}))})),Le=Wt;A();E();var O={"retina-border-basic":"_retina-border-basic_5grf2_1",retinaBorderBasic:"_retina-border-basic_5grf2_1",root:"_root_5grf2_29",header:"_header_5grf2_35",back:"_back_5grf2_42",main:"_main_5grf2_45",title:"_title_5grf2_51",text:"_text_5grf2_87",checkBox:"_checkBox_5grf2_92",footerWrap:"_footerWrap_5grf2_95",tipMessage:"_tipMessage_5grf2_131",submitButton:"_submitButton_5grf2_135"};var Xt=({conflictAssetUtxo:e,unlockFeeUtxo:t,selectedCurrency:r,protocolId:o,onConfirm:n,onCancel:s,coin:u,psbtTitle:i=""})=>{let[a,c]=(0,P.useState)(!1),m=(0,P.useRef)(),[_,l]=(0,P.useState)(!1);return(0,pt.useMount)(()=>{l(rt(m.current,"vertical"))}),P.default.createElement(I.Box,{className:O.root},P.default.createElement(I.Box,{className:O.header},P.default.createElement(re,{className:(0,dt.default)(O.back,"okx-wallet-plugin-back"),onClick:s})),P.default.createElement(I.Box,{ref:m,className:O.main},P.default.createElement(I.Box,{className:O.title},P.default.createElement(K.Text,{className:O.text},y("extension_defi_top_title_confirm_use_utxo"))),!!e.length&&P.default.createElement(Le,{title:$(o)?y("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):y("extension_defi_top_subtitle_utxo_lose_all_assets",{token:u.symbol}),utxoList:e,selectedCurrency:r}),!!t.length&&P.default.createElement(Le,{title:i||([x.ARC_20,x.RUNES,x.BRC_20,x.FRACTAL_BRC20,x.RUNEMAIN,x.FRACTAL_RUNES].includes(o)||$(o)?y("extension_defi_mid_subtitle_utxo_cover_fee_icu",{chainName:u?.chainName}):y("extension_defi_top_subtitle_use_utxo_lose_assets",{chainName:u?.chainName})),utxoList:t,selectedCurrency:r}),P.default.createElement(Ve,{className:O.checkBox,onChange:p=>{let d=p?.target?.checked;c(d)},checked:a},y("extension_defi_bot_checkbox_label_confirm_use_utxo"))),P.default.createElement(I.Box,{className:O.footerWrap},!a&&P.default.createElement(Ne,{desc:y(_?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:Ne.TYPE.info,closable:!1,className:O.tipMessage}),P.default.createElement(Q,{block:!0,className:O.submitButton,disabled:!a,category:Q.CATEGORY.fill,size:Q.SIZE.lg,type:Q.TYPE.highlight,onClick:n},y("extension_defi_bot_btn_continue"))))},ft=Xt;A();E();_e();A();E();var q={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},j={CAL_FEE:1,CONFIRM:2},X=546,Y={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114,CAT20:115},z={TRANSFER:1,PSBT:2,ACCELERATE:3};var Yt={BRC20:1,SRC20:101},ve=e=>{if(e===x.SRC_20)return Y.SRC20;if(e===x.ARC_20)return Y.ARC20;if(e===x.RUNES)return Y.RUNES;if(e===x.RUNEMAIN||e===x.FRACTAL_RUNES)return Y.RUNEMAIN;if(e===x.CAT_20)return Y.CAT20},Ht=({data:e,nftLocaltionVOs:t},r)=>Array.isArray(e)&&e?.length?{data:e}:!r||!t?.[0]?.nftId||!Array.isArray(t)?{}:r===x.ARC_20?{data:t.map(({nftId:o,tokenType:n,value:s})=>({atomicalId:o,type:n,amount:s}))}:r===x.RUNES?{data:t.map(({nftId:o,value:n})=>({id:o,amount:n}))}:r===x.RUNEMAIN||r===x.FRACTAL_RUNES?{data:t.map(({nftId:o,value:n})=>({id:o,amount:n}))}:{},ae=(e,t={},r)=>Array.isArray(e)?e.map(({txHash:o,vout:n,coinAmount:s,rawTransaction:u,...i})=>({vOut:n,amount:s,txId:o,rawTransaction:u,...Ht(i,r),...t})):[],xt=(e={},t,r)=>{let o=r===Yt.BRC20?"text/plain;charset=utf-8":"stamp:",n=e?.revealAddr,s=e?.contentType;return s||(s=o),n||(n=t),{...e,revealAddr:n,contentType:s}},Tt=({type:e,toAddr:t,fromAddr:r,satBytes:o,utxoList:n,privateKey:s,inscriptionData:u,inscriptionDataList:i,revealOutValue:a=X})=>({type:e,revealOutValue:a,changeAddress:r,commitFeeRate:o,revealFeeRate:o,commitTxPrevOutputList:ae(n,{privateKey:s,address:r}),inscriptionData:xt(u,t||r,e),inscriptionDataList:i?.length?i.map(c=>xt(c,t||r,e)):void 0}),Gt=({changeAddr:e,toAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:u,...i})=>({address:e,feePerB:r,inputs:ae([...s||[],...o]),outputs:u||[{address:t,amount:n}],...i}),jt=({changeAddr:e,toAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:u,protocolId:i,fromAddr:a,...c})=>{let m={feePerB:r,address:e,inputs:ae([...s||[],...o],{address:a||e},i),outputs:u||[{address:t,amount:n}],...c};return i===x.RUNES&&Object.assign(m,{runeData:{etching:null,burn:!1}}),(i===x.RUNEMAIN||i===x.FRACTAL_RUNES)&&Object.assign(m,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),i===x.CAT_20&&Object.assign(m,{feeRate:r,changeAddress:e,toAddress:t,tokenAmount:n,verifyScript:!0}),m},Vt=e=>[x.SRC_20,x.ARC_20,x.RUNES,x.RUNEMAIN,x.FRACTAL_RUNES,x.CAT_20].includes(e),xe=({toAddr:e,changeAddr:t,satBytes:r,utxoList:o=[],coinAmount:n,inputs:s,outputs:u,protocolId:i,...a})=>Vt(i)?jt({toAddr:e,changeAddr:t,satBytes:r,utxoList:o,coinAmount:n,inputs:s,outputs:u,protocolId:i,...a}):Gt({toAddr:e,changeAddr:t,satBytes:r,utxoList:o,coinAmount:n,inputs:s,outputs:u,...a});var Te=e=>{let{coinId:t,address:r,walletId:o,utxoType:n,satBytes:s,utxoRequests:u=[],...i}=e,a=W(t),c=a?.baseCoinId||a?.coinId;return(0,R.useMemoizedFn)(async(m,_,l={})=>{let p={coinId:c,utxoRequests:[{address:r,coinAmount:m,serviceCharge:_,utxoType:n||q.TRANSFER,...i,...l},...u]};try{let{data:d}=await ne(ee?.getBTCUTXO,p,{walletSignParams:{needWalletSign:!0,walletId:o}}),{utxoList:f}=d?.[0]||{};return f}catch(d){return Promise.reject(d)}},[c,r,o,n,i])},Jt=[],it=(e,t)=>{let{ready:r=!0,refreshDeps:o=[],...n}=t||{},{coinAmount:s="0",networkFee:u="0",...i}=e||{},a=Te(i),c={debounceWait:500,ready:r&&i?.address&&i?.walletId,refreshDeps:[s,u,a,...o],...n},{error:m,loading:_,data:l}=(0,R.useRequest)(async()=>await a(s,u),c);return[_,l||Jt,m]},ke=()=>(0,R.useMemoizedFn)(async({coinId:e,baseCoinId:t,satBytes:r,addressList:o,walletId:n,utxoType:s,...u})=>{let i=Array.isArray(o)?o:[o],a={coinId:t,utxoRequests:i.map(c=>({address:c,coinAmount:0,serviceCharge:0,utxoType:s||q.TRANSFER,...u}))};try{let{data:c}=await ne(ee?.getBTCUTXO,a,{walletSignParams:{needWalletSign:!0,walletId:n}});return i.map(m=>{let{canTransferAmount:_}=c.find(l=>l.address===m);return _})}catch(c){return Promise.reject(c)}}),kt=(e={},t)=>{let{address:r,coinId:o,...n}=e,{ready:s=!0,...u}=t||{},i=ke(),a=W(o),{loading:c,data:m,error:_}=(0,R.useRequest)(async()=>{try{return(await i({addressList:[r],baseCoinId:a.baseCoinId||o,coinId:o,...n}))?.[0]||"0"}catch{return"0"}},{ready:!!r&&s&&a?.baseCoinId!==void 0,...u});return[c,m,_]},Lt=(e={},t)=>{let{addressList:r,coinId:o,...n}=e,{ready:s=!0,...u}=t||{},i=ke(),a=W(o),{loading:c,data:m,error:_}=(0,R.useRequest)(async()=>await i({addressList:r,baseCoinId:a.baseCoinId||o,coinId:o,...n}),{ready:Array.isArray(r)&&r?.length&&s&&a?.baseCoinId!==void 0,...u});return[c,m||[],_]},Zt=0,ct=()=>(0,R.useMemoizedFn)((e,t)=>(e||[]).some(o=>o.status===Zt)?new Promise((o,n)=>{let s=me.warn({alignBottom:!1,title:y("extension_wallet_transaction_title_low_tradingfee"),text:y("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:y("wallet_extension_address_popup_btn_continue"),cancelText:y("wallet_extension_btn_general_cancel"),onCancel:()=>{s.destroy(),n(),t?.()},onConfirm:()=>{s.destroy(),o()}})}):Promise.resolve(),[]),qt=(e,t)=>{let[,r]=Ie(t);return(0,R.useMemoizedFn)(async o=>{if(r?.coinId!==Ze)return Promise.resolve();let{data:n}=await ne(ee.checkWalletCommonPending,{address:e,coinId:t});return n?new Promise((s,u)=>{let i=me.warn({alignBottom:!1,title:y("extension_defi_mid_title_reminder"),text:y("extension_defi_mid_subtitle_reminder_submit"),confirmText:y("extension_defi_mid_btn_cancel"),onConfirm:()=>{i.destroy(),u(),o?.()},cancelText:y("extension_defi_mid_btn_continue_submit"),onCancel:()=>{i.destroy(),s()}})}):Promise.resolve()})},$t=({address:e,coinId:t,protocolId:r,txType:o=Ue.TRANS_OUT,doubleConfirmSource:n=z.TRANSFER})=>{let[s,u]=Ie(t,{withPrice:!0});s=s||{},u=u||{};let i=(0,gt.useSelector)($e),{currencyId:a}=i,c=ot({currencyId:a});return(0,R.useMemoizedFn)(async m=>{let _={};return m.forEach(({txHash:l,resourceUrl:p})=>{_[l]=p}),new Promise((l,p)=>{(async()=>{try{let{data:{conflictAssetUtxo:d,unlockFeeUtxo:f}}=await ne(ee.doubleCheckUtxo,{utxoList:m.map(C=>{let S=We(C,["vout","nftId","txHash","status","coinAmount"]);return n!==z.PSBT?S.unlockUtxo=C?.utxoStatusType===1:S.unlockUtxo=!0,S}),address:e,txType:o,coinId:t});if(!d?.length&&!f?.length){l();return}let T=d?.map(C=>{let[S,...b]=C.protocolAssetList;return S.image=_[C.txHash]||s.image,{...C,mainAsset:S,protocolAssetList:b}})||[],g=f?.map(C=>{let S=Ye(C.coinAmount,H.pow(10,u.decimals||0));return C.mainAsset={tokenSymbol:u.symbol,tokenAmount:S,usdAmount:Xe(S,u.usdPrice||0),image:u.image},C})||[],h=me.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:N.default.createElement(ft,{coin:s,selectedCurrency:i,coinToCurrencyFn:c,protocolId:r,conflictAssetUtxo:T,unlockFeeUtxo:g,txType:o,onConfirm:()=>{l(),h.destroy()},onCancel:()=>{p(new Error(Re)),h.destroy()},psbtTitle:n=z.PSBT?y("extension_defi_top_toast_all_spent"):""})})}catch{Je.error(y("extension_defi_toast_textarea_create_order_fail")),p(new Error(Re))}})()})})},vt=({address:e,coinId:t,currencyId:r,txType:o=Ue.TRANS_OUT,protocolId:n,doubleConfirmSource:s=z.TRANSFER})=>{let u=$t({address:e,coinId:t,protocolId:n,txType:o,currencyId:r,doubleConfirmSource:s}),i=qt(e,t),a=ct();return(0,R.useMemoizedFn)(async(c,m=Ke)=>{try{return s===z.TRANSFER&&(await i(m),await a(c,m)),await u(c),Promise.resolve()}catch(_){return Promise.reject(_)}})};function Ct(e){return JSON.stringify({ecdsaShare2:tt(e)})}async function yt(e,t,{share:r,pShare:o,mpcId:n,deriveIndex:s}){let{networks:u}=await le(),i=se(),a=await i.exec("inscribeForMPCUnsigned",[t,u.bitcoin]),{commitTx:c,signHashList:m}=a;t.commitTx=c;let _={currency:M.BTC,baseChain:G,share:r,pShare:o,mpcId:n,signHashList:m,deriveIndex:s},l=await Z().mpcSignTransaction(e,G,_),p=JSON.parse(l).signatures;t.signatureList=p;let d=await i.exec("inscribeForMPCSigned",[t,u.bitcoin]);return delete d.signHashList,d}var Do=e=>{let t=Pe(),r=fe(),o=Ee(),n=(0,N.useCallback)((a,c,m="text/plain;charset=utf-8")=>{let _=[];return a.forEach(l=>{let p={...l};p.contentType||(p.contentType=m),p.revealAddr||(p.revealAddr=c),_.push(p)}),_},[]),s=(0,N.useCallback)(async a=>{let c=o(a),m=await Z().getMpcShare(a,G),{share:_,pShare:l}=m??{},{mpcId:p,deriveIndex:d,address:f}=c?.addressType?.bitcoin?.find(g=>g?.addressType===c?.selectedAddressType?.bitcoin)||{};return{publicKey:await Z().getPublicKey(f,G,a),share:_,pShare:l,mpcId:p,deriveIndex:d}},[]),u=(0,N.useCallback)(async(a,c)=>{let _=(await r(a))?.find(l=>l.address===c)?.privateKey;if(t){let{getRandomPrivateKey:l,getMidKey:p}=await te(),{networks:d,private2Wif:f}=await le();if(e===j.CAL_FEE)return await l(M.BTC);if(e===j.CONFIRM){let{share:T}=await s(a),g=await p(Ct(T),M.BTC);return f(v.Buffer.from(g),d.bitcoin)}}return _},[]);return(0,N.useCallback)(async({walletId:a,address:c,tx:m={},privateKey:_})=>{let l=_;l||(l=await u(a,c));let{publicKey:p}=await s(a),d=se(),{commitTxPrevOutputList:f,commitFeeRate:T,revealFeeRate:g,inscriptionData:h,inscriptionDataList:C,revealOutValue:S=546,changeAddress:b=c,toAddr:k}=m,B={commitTxPrevOutputList:f.map(J=>({...J,privateKey:l,publicKey:p,address:c})),commitFeeRate:T,revealFeeRate:g||T,inscriptionData:h,inscriptionDataList:n(C,k||c),revealOutValue:S,changeAddress:b,type:1};if(e===j.CONFIRM&&t){let J=await s(a);return await yt(a,B,J)}return await d.exec("signTransaction",[M.BTC,{data:B}])},[u,s,n,t,e])},Ko=e=>{let t=Pe(),r=fe(),o=Ee(),n=(0,N.useCallback)(async i=>{let a=await Z().getMpcShare(i,G),c=o(i),{share:m,pShare:_}=a??{},{mpcId:l,deriveIndex:p,address:d}=c?.addressType?.bitcoin?.find(T=>T?.addressType===c?.selectedAddressType?.bitcoin)||{};return{publicKey:await Z().getPublicKey(d,G,i),share:m,pShare:_,mpcId:l,deriveIndex:p}},[]),s=(0,N.useCallback)(async(i,a)=>{let m=(await r(i))?.find(_=>_.address===a)?.privateKey;if(t){let{getRandomPrivateKey:_,getMidKey:l}=await te(),{networks:p,private2Wif:d}=await le();if(e===j.CAL_FEE)return await _(M.BTC);if(e===j.CONFIRM){let{share:f}=await n(i),T=await l(Ct(f),M.BTC);return d(v.Buffer.from(T),p.bitcoin)}}return m},[]);return(0,N.useCallback)(async({walletId:i,address:a,tx:c={},privateKey:m,mintType:_=Ae.parallel})=>{let l=m;l||(l=await s(i,a));let{publicKey:p}=await n(i),d=se(),{input:f,outValue:T,inscriptions:g}=c,h=f.map(w=>({...w,privateKey:l,publicKey:p,address:a})),C={type:Y.RUNEMAIN,inputs:h,outputs:[{address:a,amount:T,data:g[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:g.length,serialMint:_===Ae.serial},...c},{estimateFee:S}=await te(),b=await S(M.BTC,{data:C});if(g.length===1&&(b=[b]),e===j.CONFIRM&&t){let w=await n(i),B=await yt(i,C,w);return{commitTx:B[0],revealTxs:B.slice(1),commitAddrs:[],commitTxFee:b[0],revealTxFees:b.slice(1)}}let k=await d.exec("signTransaction",[M.BTC,{data:C,privateKey:l}]);return g.length===1&&(k=[k]),{commitTx:k[0],revealTxs:k.slice(1),commitAddrs:[],commitTxFee:b[0],revealTxFees:b.slice(1)}},[s,n,t,e])},ht=({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,inscriptionData:s,inscriptionDataList:u,revealOutValue:i=790})=>{let a=oe(),c=o||a,m=fe();return(0,N.useCallback)(async({utxoList:_})=>{let p=(await m(c)).find(({address:f})=>f===r)?.privateKey,d=Tt({type:e,toAddr:t,satBytes:n,fromAddr:r,utxoList:_,privateKey:p,revealOutValue:i,inscriptionData:s,inscriptionDataList:u});try{return await se().exec("signTransaction",[M.BTC,{data:d}])}catch{throw Error("sign error")}},[m,c,e,t,n,r,i,s,u])},zt=({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,inscriptionData:s,inscriptionDataList:u,revealOutValue:i=X,onlyCommitTxFee:a})=>{let c=ht({type:e,toAddr:t,fromAddr:r,walletId:o,satBytes:n,revealOutValue:i,inscriptionData:s,inscriptionDataList:u});return(0,N.useCallback)(async({utxoList:m,..._})=>{let{commitTxFee:l,revealTxFees:p=[]}=await c({utxoList:m,..._});return a?l:{commitTxFee:l,totalRevealTxFee:(p||[]).reduce((d,f)=>H.add(d,f),0)}},[a,c])},Qt=({type:e,coinId:t,fromAddr:r,toAddr:o,satBytes:n,coinAmount:s,protocolId:u})=>{let a=W(t)?.baseCoinId||t;return(0,N.useCallback)(async({utxoList:c,...m})=>{if(!Number(n))return Promise.reject();let{estimateFee:_}=await te(),l=xe({type:e,toAddr:o,utxoList:c,satBytes:n,coinAmount:s,protocolId:u,changeAddr:r,...m}),d=qe({coinId:+a})?.coinType;try{return await _(d,{data:l,privateKey:""})}catch(f){return Promise.reject(f)}},[a,s,r,u,n,o,e])},ge=({coinId:e,fromAddr:t,toAddr:r,satBytes:o,coinAmount:n,protocolId:s,revealOutValue:u,inscriptionData:i,inscriptionDataList:a,...c})=>{let m=ve(s),_=Qt({coinId:e,satBytes:o,fromAddr:t,toAddr:r,coinAmount:n,protocolId:s,type:m,...c}),l=zt({coinId:e,toAddr:r,fromAddr:t,satBytes:o,coinAmount:n,protocolId:s,revealOutValue:u,inscriptionData:i,inscriptionDataList:a,type:m,onlyCommitTxFee:!0,...c});return s===x.SRC_20?l:_},Ot=(e,t)=>{let{coinId:r,walletId:o,toAddr:n,fromAddr:s,satBytes:u,networkFee:i,coinAmount:a,canTransferAmount:c,utxoParams:m={},inscriptionData:_,protocolId:l,inscriptionDataList:p,revealOutValue:d=X,inputs:f,...T}=e,g=W(r),h=g?.baseCoinId===0,C=l||g?.protocolId,{ready:S=!0,refreshDeps:b}=t||{},[k,{setTrue:w,setFalse:B}]=(0,R.useBoolean)(!1),[V,J]=(0,N.useState)(),Oe=oe(),St=o||Oe,[he,Ft]=(0,N.useState)(i),Me=ge({coinId:r,fromAddr:s,toAddr:n,satBytes:u,coinAmount:a,protocolId:C,revealOutValue:d,inscriptionData:_,inscriptionDataList:p}),De={coinAmount:a,networkFee:he||"0"};h&&c&&H.gt(H.add(a,he),c)&&(De={coinAmount:c,networkFee:0});let[Nt,ie]=it({coinId:r,address:s,walletId:St,...De,...m},{refreshDeps:b,ready:h&&!!c&&S||!h&&S}),Se=(0,N.useMemo)(()=>[...f||[],...ie||[]],[f,ie]);return(0,R.useDeepCompareEffect)(()=>{!Array.isArray(Se)||!Se?.length||(w(),Me({utxoList:Se,...T}).then(ce=>{J(!1),Ft(ce),t?.onSuccess?.(ce,ie)}).catch(ce=>{J(!0),t?.onError?.(ce)}).finally(()=>{B()}))},[ie,T,Me]),[k||Nt,he,V]},en=({type:e,coinId:t,toAddr:r,walletId:o,fromAddr:n,changeAddr:s,satBytes:u,localType:i,coinAmount:a,networkFee:c,protocolId:m,dustSize:_=X,...l})=>{let p=oe(),d=o||p,f=de(i),T=we({fromAddr:n,localType:f,walletId:d});return(0,N.useCallback)(async({utxoList:g,...h})=>{let C=xe({toAddr:r,satBytes:u,type:e,changeAddr:s||n,dustSize:_,coinAmount:a,utxoList:g,protocolId:m,...l,...h});return await T({params:C,...h})},[s,a,_,n,m,l,u,T,r,e])},ut=({coinId:e,toAddr:t,walletId:r,protocolId:o,fromAddr:n,changeAddr:s,satBytes:u,localType:i,coinAmount:a,networkFee:c,inscriptionData:m,inscriptionDataList:_,dustSize:l=X,...p})=>{let d=de(i),f=ve(o),T=en({coinId:e,toAddr:t,walletId:r,fromAddr:n,changeAddr:s,satBytes:u,localType:d,coinAmount:a,networkFee:c,dustSize:l,protocolId:o,type:f,...p}),g=ht({toAddr:t,fromAddr:n,walletId:r,satBytes:u,protocolId:o,inscriptionData:m,inscriptionDataList:_,type:f,...p});return o===x.SRC_20?g:T},Mt=({coinId:e,toAddr:t,txType:r,fromAddr:o,satBytes:n,walletId:s,localType:u,networkFee:i,coinAmount:a,protocolId:c,dustSize:m=X,extraPublishParams:_={},...l})=>{let p=oe(),d=s||p,f=de(u),T=ut({coinId:e,toAddr:t,walletId:s,fromAddr:o,satBytes:n,localType:f,coinAmount:a,networkFee:i,dustSize:m,protocolId:c,...l}),g=Be({coinId:e,txType:r,coinAmount:a,fromAddr:o,toAddr:t,localType:f,networkFee:i,walletId:d,extJson:JSON.stringify({protocolId:c}),..._});return(0,N.useCallback)(async({utxoList:h,...C})=>{let S=await T({utxoList:h,...C}),b=S;return c===x.SRC_20&&(b=S?.commitTx),await g(b)},[c,g,T])};export{at as a,q as b,j as c,X as d,z as e,Ht as f,ae as g,Vt as h,Te as i,it as j,kt as k,Lt as l,vt as m,Do as n,Ko as o,ge as p,Ot as q,ut as r,Mt as s};
//# sourceMappingURL=chunk-WRGSQF3V.js.map
