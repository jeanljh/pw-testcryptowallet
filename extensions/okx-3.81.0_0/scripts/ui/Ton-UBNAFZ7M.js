import{a as we,b as xe}from"./chunk-BV7GWY6A.js";import{a as _e,b as Te}from"./chunk-OG6R7EEA.js";import"./chunk-ZOPVBPAO.js";import"./chunk-XIUQW5OS.js";import"./chunk-JQ73YYWR.js";import"./chunk-RNB6EWQY.js";import"./chunk-MJKLSIQL.js";import"./chunk-WRGSQF3V.js";import"./chunk-ELHHHA5F.js";import"./chunk-7F5XJ2TU.js";import"./chunk-62VQDLH5.js";import"./chunk-QNQLOUVT.js";import{a as ge}from"./chunk-ZZ5BEB5E.js";import{a as pe}from"./chunk-T4CFY3IH.js";import"./chunk-EDJJACNG.js";import"./chunk-V7XA3BQU.js";import"./chunk-WST3WRLT.js";import"./chunk-6GOHKXI5.js";import"./chunk-PDSFU775.js";import{a as G}from"./chunk-PONOZOFT.js";import"./chunk-57D6LCV2.js";import"./chunk-KQ6OPOXD.js";import"./chunk-X7ACMHNF.js";import"./chunk-DEJA7CK3.js";import"./chunk-LS6URCUV.js";import"./chunk-XDEC3ZLT.js";import"./chunk-RGPNT5G7.js";import"./chunk-OQUE64GQ.js";import"./chunk-AQ4KTATJ.js";import{n as ue,t as de,x as q}from"./chunk-Q7DF5H6O.js";import"./chunk-G23O242T.js";import"./chunk-AQO2BBXJ.js";import{a as le}from"./chunk-GWMNMJND.js";import{y as me,z as fe}from"./chunk-2VUOGSTW.js";import"./chunk-P4PGYDTS.js";import"./chunk-S7VT2TWF.js";import"./chunk-HBNZZZEG.js";import"./chunk-3W4MTHFJ.js";import"./chunk-L2MGED7F.js";import{d as U}from"./chunk-BNS5ABAB.js";import"./chunk-UFGJXE4D.js";import"./chunk-7QX2TXNH.js";import"./chunk-ZDHJHPQ5.js";import"./chunk-DFPRATON.js";import"./chunk-WY5R5HAR.js";import"./chunk-GTQ5U6DA.js";import"./chunk-TE6AOABI.js";import"./chunk-63UDTGAT.js";import"./chunk-AZ2KZKVQ.js";import"./chunk-VCDDTW7H.js";import"./chunk-UULU72LG.js";import"./chunk-3MTWCI34.js";import"./chunk-E6XUX33V.js";import"./chunk-VTMJYROY.js";import"./chunk-ARK47WR5.js";import"./chunk-BEIWULHW.js";import"./chunk-DOCYQV54.js";import"./chunk-6T3CLU73.js";import"./chunk-STXPU7A6.js";import"./chunk-PFSPFZNW.js";import"./chunk-2JC6L37N.js";import"./chunk-BF6TFHGA.js";import"./chunk-57F7LIJM.js";import"./chunk-7OXXN2FT.js";import"./chunk-RK7WST36.js";import"./chunk-7Q4IDC7V.js";import"./chunk-F57QKCZQ.js";import"./chunk-HIVYZXF3.js";import"./chunk-JALTSNOZ.js";import"./chunk-4Y52FA3V.js";import"./chunk-B6WLGAPL.js";import"./chunk-ZYYACLV7.js";import"./chunk-TQMC5UQS.js";import"./chunk-ANWN6BF6.js";import"./chunk-XNP3OGQC.js";import"./chunk-A2QIZMPL.js";import"./chunk-HKU7TMFJ.js";import"./chunk-YTR7GLCK.js";import"./chunk-7I4OPLNV.js";import"./chunk-J3UBL564.js";import"./chunk-YMYQJ726.js";import"./chunk-FGRS6VIX.js";import"./chunk-INIQCRIO.js";import"./chunk-2P6PTKAN.js";import"./chunk-ZFBXO46L.js";import"./chunk-6Z5HVUBK.js";import"./chunk-ZBDGRK4Q.js";import"./chunk-XIYYKWE3.js";import"./chunk-GN2NRAOV.js";import"./chunk-SFFRTMXL.js";import"./chunk-RLY3NWVP.js";import"./chunk-U3KULTRT.js";import"./chunk-55T2IW2N.js";import"./chunk-WVUOJIBP.js";import"./chunk-JBROAQ6E.js";import"./chunk-LBCITKCK.js";import"./chunk-O4O5AL3V.js";import"./chunk-I56NHY6E.js";import"./chunk-GDQAWT2G.js";import"./chunk-QJ36ZOFH.js";import"./chunk-7HYQ2DGP.js";import"./chunk-G7XOYBNH.js";import"./chunk-JHO7RU36.js";import{d as ae,e as ie}from"./chunk-UOWKDFTX.js";import"./chunk-5A7EFNRM.js";import"./chunk-NA6P5YCH.js";import"./chunk-F2SPBGOT.js";import"./chunk-SYOIP55B.js";import"./chunk-V7ZNWTMX.js";import"./chunk-MSP5TDR3.js";import"./chunk-VWGNVM37.js";import"./chunk-QKBWJPY2.js";import"./chunk-XFPD3Q2E.js";import"./chunk-AFJBSSNA.js";import"./chunk-3ZKJXYZ4.js";import"./chunk-EBRJSEEJ.js";import"./chunk-PA7QUJH7.js";import"./chunk-MC7IOE6A.js";import"./chunk-N4IVZOUG.js";import"./chunk-JWVIZID6.js";import"./chunk-MSFAPAHB.js";import"./chunk-33XRMYWN.js";import{p as ce}from"./chunk-ZOKF3EKQ.js";import"./chunk-MDBKHBHQ.js";import"./chunk-WRVJM3F3.js";import"./chunk-NYBKFEEM.js";import"./chunk-XVSXMJ3S.js";import"./chunk-KQ66JTF7.js";import"./chunk-OOYDFTEF.js";import"./chunk-JNIP4OYT.js";import"./chunk-XRCQOGA2.js";import"./chunk-SWUBCABA.js";import"./chunk-QRAFULYC.js";import"./chunk-EEIYH3NC.js";import"./chunk-ITDLKQAF.js";import"./chunk-4W7LQOP5.js";import"./chunk-CIVR4FUI.js";import"./chunk-H7WHTGUY.js";import"./chunk-44SDMU5C.js";import"./chunk-U7IWD6UB.js";import"./chunk-CZBL7QEK.js";import"./chunk-PAJAZXOA.js";import"./chunk-7MCLPJAH.js";import"./chunk-WAIJPY5X.js";import"./chunk-YGMRSF47.js";import"./chunk-6XGS36TZ.js";import"./chunk-M2YY6A5T.js";import"./chunk-XLG73W5Q.js";import"./chunk-GCS2RK7E.js";import"./chunk-OIPQWTNV.js";import"./chunk-VJI6MZK4.js";import"./chunk-5PRURJ2O.js";import"./chunk-FGAB46RQ.js";import"./chunk-47ZMUKCZ.js";import{o as Le}from"./chunk-Z62JX42S.js";import{Na as We}from"./chunk-2QHGKEME.js";import"./chunk-HAHRUU64.js";import"./chunk-B624VS3G.js";import"./chunk-W4SQ6335.js";import"./chunk-YDSDBRIT.js";import"./chunk-6PA65BO3.js";import"./chunk-OIXGC4LI.js";import"./chunk-MAAUVUWY.js";import"./chunk-4X64L7DZ.js";import{da as W}from"./chunk-WU2LB6XB.js";import"./chunk-GLL4BXR6.js";import"./chunk-4L5HWMAA.js";import"./chunk-EZS2GR7E.js";import{j as se,q as Oe}from"./chunk-NUN72MDU.js";import"./chunk-BFWVIVOY.js";import"./chunk-S3FOFXM7.js";import"./chunk-YIFLUVTR.js";import{c as ne,e as ve}from"./chunk-EN2WHAVL.js";import"./chunk-CP2RIMI2.js";import"./chunk-3QLLFUC4.js";import{i as H}from"./chunk-EFOY37CC.js";import"./chunk-HMTT52FG.js";import"./chunk-45NMMWRA.js";import"./chunk-E4OV5WXB.js";import"./chunk-GR7YC6C3.js";import"./chunk-O33H5V3V.js";import"./chunk-DJN2J7J5.js";import{g as re,n as Ne}from"./chunk-35ANKHOJ.js";import"./chunk-BI4OEIFC.js";import{Ja as L,Wb as oe,_b as Ge,gb as P,tb as J}from"./chunk-COF7YKSN.js";import{A as _,K as te}from"./chunk-VZKEX7KP.js";import"./chunk-QCEQQDCM.js";import{I as X}from"./chunk-BJKBO23H.js";import"./chunk-IO3ALUOJ.js";import"./chunk-AHVVUOFF.js";import"./chunk-JLNZTUPO.js";import"./chunk-MSZOM4GC.js";import"./chunk-BYVN72KS.js";import"./chunk-ZUJLXC72.js";import"./chunk-DJSNVDZI.js";import"./chunk-K336SGW3.js";import{M as j,va as De}from"./chunk-XFTQD4B2.js";import"./chunk-DIZF7D6Q.js";import"./chunk-JHCCLVAB.js";import"./chunk-W7AONC6R.js";import"./chunk-FOOC6LB7.js";import"./chunk-SEAUBLKM.js";import"./chunk-UP4BZFYG.js";import"./chunk-DHKS44RQ.js";import"./chunk-4DBVFCYR.js";import"./chunk-2IGQWLAB.js";import"./chunk-GVV6OTQP.js";import"./chunk-ZFVABNQN.js";import"./chunk-VYWNZTTM.js";import"./chunk-LBWWOQL4.js";import"./chunk-4QGZDIBD.js";import{b as O}from"./chunk-73B6GL3S.js";import"./chunk-LVJGLJNA.js";import"./chunk-FYJQM2AY.js";import"./chunk-Z7PBP7IJ.js";import"./chunk-5F7M5EJ4.js";import"./chunk-RQWEJ5N6.js";import"./chunk-RNWGOGLT.js";import"./chunk-UGJ3FMEQ.js";import"./chunk-OPJRP6YV.js";import"./chunk-H6JAOQCX.js";import"./chunk-OJXBW2YQ.js";import"./chunk-PDRHBICP.js";import"./chunk-Z2AIGJGI.js";import"./chunk-SLQQVCPY.js";import"./chunk-ZRVP4J67.js";import"./chunk-YSKQ76UN.js";import"./chunk-A3W4ZDEQ.js";import"./chunk-VBZ4JSJ6.js";import"./chunk-LBYXY63E.js";import"./chunk-M4ANCDMF.js";import"./chunk-J6KTJ3IN.js";import"./chunk-5CQODPK7.js";import"./chunk-C5XO4JMZ.js";import"./chunk-HI3LE734.js";import"./chunk-RX4V72AK.js";import{f as F,o as f,q as u}from"./chunk-Y5OH3DDZ.js";f();u();var Fe=F(O());f();u();var y=F(O()),ke=F(We());te();ve();Oe();J();f();u();var T=F(O());De();J();Ge();var Be=({code:e,data:r,error_message:n,error:a})=>{if(e!==0||!r||r.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:n};let{gasLimit:s="0"}=r;return{...r,fee:s,feeError:!1,feeErrorMsg:""}},be=e=>e?.feeError&&e?.feeErrorMsg?e.feeErrorMsg:"",Ve=(e,r)=>{let n=j(e)||H(e,r),a=j(e)||H(e,0);return{isSufficientGas:n,isSufficientBalance:a}},Je=({coinId:e,unapproved:r,paramsInfo:n})=>{let{coin:a,toAdr:s,fromAddr:t,walletId:i,messages:o,network:c,validUntil:w}=n,{chainId:x,localType:m}=a||{},d=ce(t,r?.walletId,L),E=oe?.[L]?.[d],k=pe(e,r.walletId,{addressType:E})||{},{coinAmountInt:M}=k,h=q(),C=(0,T.useRef)(null),[R,g]=(0,T.useState)(!0),[l,v]=(0,T.useState)({}),[I,K]=(0,T.useState)({});(0,T.useEffect)(()=>{m&&e&&t&&i&&o&&(async()=>{try{g(!0);let p=await h({coinId:e,address:t,toAddr:s,fromAddr:t}),S=await me({nonce:p?.nonce,localType:m,fromAddr:t,walletId:i,messages:o,network:c,validUntil:w});K({signInfo:p,sequence:p?.nonce,inputData:JSON.stringify(S?.stringInputParams),transactionParams:S?.transactionParams})}catch(p){g(!1),v({feeError:!0,feeErrorMsg:p?.message})}})()},[m,e,t,i,o]),(0,T.useEffect)(()=>((()=>{let{inputData:p}=I;if(g(!0),p){let S=async()=>{let z=await fe({fromAddr:t,chainId:x,coinId:e,inputData:p}),Q=Be(z);g(!1),v(Q)};(()=>{clearInterval(C.current),S(),C.current=setInterval(S,7e3)})()}})(),()=>{clearInterval(C.current)}),[I.inputData,x,t,e]);let{isSufficientGas:b,isSufficientBalance:Y}=Ve(M,l?.fee),D=be(l);return{networkFeeProps:{coinId:e,loading:R,estimateFailed:l?.feeError,estimateFailedMsg:D,networkFee:l?.fee},isSufficientGas:b,isSufficientBalance:Y,estimateFailed:l?.feeError,estimateFailedMsg:D,extParams:{coinId:e,coinAmount:0,inputData:I?.inputData,fromAdr:t,toAdr:s,serviceCharge:l?.fee,extJson:JSON.stringify({nonce:I?.sequence}),txSource:2,accountId:r?.walletId,walletType:2,transactionParams:I?.transactionParams},coinWithBalance:k}},Ee=Je;f();u();J();function Ue(e){let r=U(P)||{},{address:n,walletId:a}=G(e),s=e?.params?.transaction||{},t=s?.messages||[],i=s?.network,o=s?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:r,fromAddr:n,walletId:a,messages:t,validUntil:o,network:i}}var Ce=Ue;f();u();var A=F(O());var qe=({origin:e,walletId:r,localType:n})=>{let a=de(),[s,t]=(0,A.useState)(!0),{host:i}=ge({origin:e}),o=G({walletId:r,localType:n}),[c,w]=(0,A.useState)({}),x=(0,A.useCallback)(async(E,k,M)=>{let h="";try{h=JSON.stringify(M)}catch{}let{coinId:C,chainId:R}=E,g=await a({coinId:C,checkTypes:[W.KYS,W.VERIFY_GAS_LIMIT],amount:0,from:o.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:k,chainId:R,additionalData:{tonSignData:h}});w(g),t(!1)},[i,a,o.address]),m=(0,A.useMemo)(()=>({loading:s,...c[W.KYS]||{}}),[s,c]),d=(0,A.useMemo)(()=>c[W.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:s,preExecute:x,preExecuteRet:c,verifyGasLimitRet:d}},Ie=qe;f();u();var Se=F(O()),Ae=F(Le());te();Ne();J();function Ke({transaction:e,fromAddress:r}){let{valid_until:n,network:a,from:s,messages:t}=e,[i,o]=(0,Se.useState)("");return(0,Ae.useAsyncEffect)(async()=>{if(a!==ae.MAINNET)o(_("wallet_extension_error_incorrect_destination_network"));else if(n<Math.floor(Date.now()/1e3))o(_("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)o(_("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await re(),w=new c;for(let d=0;d<t.length;d++){let E=t[d]?.address;if(!await le(E,P)){o(_("wallet_extension_error_incorrect_destination_network"));return}}let x=await w.convertAddress({address:r}),m=await w.convertAddress({address:s});x?.raw!==m?.raw&&o(_("wallet_extension_error_incorrect_receiving_address"))}},[n,a,s,r]),{checkParamsTipMessage:i?{message:i}:null,code:i?ie.BAD_REQUEST_ERROR:null}}var ye=Ke;var Ye=(0,y.memo)(({unapproved:e})=>{let r=(0,ke.useDispatch)(),n=U(P)||{},a=n?.coinId||P,{walletId:s,address:t,addressType:i}=G(e),o=Ce(e),w=(i?.[L]||[]).find(N=>N.address===t),x=q(),{networkFeeProps:m,isSufficientGas:d,estimateFailed:E,estimateFailedMsg:k,isSufficientBalance:M,extParams:h,coinWithBalance:C}=Ee({coinId:a,unapproved:e,paramsInfo:o}),{id:R,origin:g,localType:l}=e,v=Ie({origin:g,walletId:s,localType:l}),{inputData:I,transactionParams:K}=h,b=(0,y.useRef)(),{preExecute:Y,kysRet:D,verifyGasLimitRet:Z}=v,V=e?.params?.transaction||{};(0,y.useEffect)(()=>{n?.coinId&&!m?.loading&&!b.current&&(b.current=!0,Y(n,I,V))},[n?.coinId,m?.loading,I]);let p=_e({kysRet:D,baseCoin:n,estimateFailed:E,estimateFailedMsg:k,isSufficientGas:d,isSufficientBalance:M,verifyGasLimitRet:Z,coinWithBalance:C}),{checkParamsTipMessage:S,code:$}=ye({transaction:V,fromAddress:t}),z=we({id:R,walletId:s,origin:g,localType:l,extraParams:{code:$}}),Q=S||p,Pe=async()=>{try{let N=await x({coinId:a,address:o?.fromAddr,toAddr:o?.toAdr,fromAddr:o?.fromAddr}),ee=await ne().approveDappRequest(R,{...h,transactionParams:{...K,seqno:N?.nonce,walletVersion:w?.addressType},extJson:JSON.stringify({nonce:N?.nonce})});if(ee.code===10009){X.error(ee?.msg||_("wallet_extension_failure_subtitle_fail_resend"));return}await se(r)}catch(N){X.error(N?.msg||_("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:Me,handleCancel:Re}=xe({coinId:a,unapproved:e,preExecuteRet:v,feeLoading:m?.loading,estimateFailed:E,isSufficientGas:d,isSufficientBalance:M,disabledConfirmBtn:!!S,onConfirm:Pe,onCancel:z,coinWithBalance:C});return ue({kysRet:D,handleCancel:Re}),y.default.createElement(Te,{kysRet:D,unapproved:e,tipMessage:Q,buttonGroup:Me,networkFee:m})}),he=Ye;var zt=({unapproved:e})=>Fe.default.createElement(he,{unapproved:e});export{zt as default};
//# sourceMappingURL=Ton-UBNAFZ7M.js.map
