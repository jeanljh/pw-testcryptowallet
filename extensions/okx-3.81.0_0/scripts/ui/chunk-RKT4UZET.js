import{a as se}from"./chunk-PRGPMYUJ.js";import{a as Ve}from"./chunk-7F5XJ2TU.js";import{a as ze}from"./chunk-MI2Q756Z.js";import{a as qe}from"./chunk-SUQDM3DA.js";import{a as Ue}from"./chunk-GRN4OI4B.js";import{a as He}from"./chunk-62VQDLH5.js";import{a as ae}from"./chunk-QNQLOUVT.js";import{a as Be,b as We,c as ve}from"./chunk-32IFYA56.js";import{a as ie}from"./chunk-ZZ5BEB5E.js";import{a as te}from"./chunk-ELXRV4IW.js";import{a as Me}from"./chunk-T4CFY3IH.js";import{c as ge,p as Ge,q as re}from"./chunk-6PSK4535.js";import{a as Je}from"./chunk-MK5QRIIU.js";import{a as Re}from"./chunk-WST3WRLT.js";import{u as De,v as Le}from"./chunk-2VUOGSTW.js";import{d as G}from"./chunk-BNS5ABAB.js";import{i as Pe,j as Se,k as Fe,l as Ee,m as ke}from"./chunk-UOWKDFTX.js";import{b as ne}from"./chunk-GEL5KEYP.js";import{c as Oe}from"./chunk-EBRJSEEJ.js";import{m as oe}from"./chunk-ZOKF3EKQ.js";import{j as K}from"./chunk-YGMRSF47.js";import{a as ee}from"./chunk-FGAB46RQ.js";import{o as co}from"./chunk-Z62JX42S.js";import{Na as be}from"./chunk-2QHGKEME.js";import{F as w}from"./chunk-WU2LB6XB.js";import{e as xe}from"./chunk-3QLLFUC4.js";import{a as Ae,c as Z,h as fe}from"./chunk-EFOY37CC.js";import{R as J,S as Ne,Ua as we,ka as de,ra as $,tb as Ce}from"./chunk-COF7YKSN.js";import{A as Y,K as Te,o as ye}from"./chunk-VZKEX7KP.js";import{M as pe,f as _e,va as he}from"./chunk-XFTQD4B2.js";import{b as q}from"./chunk-73B6GL3S.js";import{f as k,o as m,q as u}from"./chunk-Y5OH3DDZ.js";m();u();var Ie=k(q());m();u();var W=k(q());Ce();m();u();var Ke=k(be());Ce();function lo({walletId:e,method:t,message:o,onConfirm:r}){let g=(0,Ke.useDispatch)();return async()=>{let d=await g(se({walletId:e,localType:$,method:t,params:{message:o}})),{publicKey:p,signature:h}=d||{},y=ke(Ee(p),h);return r(y)}}var Ye=lo;var je=e=>{let{walletId:t,method:o,params:r,source:g,onConfirm:i,onCancel:d}=e,p=g==="dapp",[h,y]=(0,W.useState)({}),a=typeof r?.message=="string"?r?.message:new TextDecoder().decode(r?.message),I=Ye({walletId:t,method:o,message:a,onConfirm:i}),c,C,T;p||(c=I,C=!0,T=d);let F=ie(e),A=G(we)||{},n=oe(A?.localType,t),b=(0,W.useMemo)(()=>({method:o,dappData:JSON.stringify({message:a}),dappInfo:p?F:{},from:n,message:a,chainIndex:A.chainId}),[n]),s=K(t),_=ze({unapproved:e,onConfirm:c,onConfirmReplace:C,onCancel:T,preExecInfo:h}),f=ae({initialType:s.initialType}),O=(0,W.useMemo)(()=>[f()].filter(Boolean),[f]);return W.default.createElement(re,{needPreExecFn:()=>!1,preExecParams:b,buttonGroup:_,txType:Ge.signMessage,handleCancel:T,walletAccount:s,onUpdatePreExecInfo:y,chainHeaderTips:O,localType:A?.localType,slot:{bottom:!!r?.isSilentSign&&W.default.createElement(te,{walletAccount:s})}})};m();u();var ce=k(q());m();u();var x=k(q()),$e=k(co());he();Te();de();m();u();var Xe=k(q());he();Te();m();u();var N=k(q());function mo({coinId:e,transactions:t,address:o,replace:r,disabled:g,unitLimits:i,signInfo:d,method:p}){let[h,y]=(0,N.useState)(0),[a,I]=(0,N.useState)(null),[c,C]=(0,N.useState)([]),[T,F]=(0,N.useState)("0"),[A,n]=(0,N.useState)([]),[b,s]=(0,N.useState)(!1),_=a?.fee||"0",[f,O]=(0,N.useState)(t||[]),z=Je(),D=G(e),{disabledSignInfo:L=!1,disabledPreExecute:H=!1}=g||{},[U,,V]=Re({coinId:e,address:o,chainId:D?.chainId},{ready:!!e&&!!o&&!L,onSuccess:I}),R=P=>{y(P?l=>l+1:l=>l-1)};return(0,N.useEffect)(()=>{i&&C(i)},[i]),(0,N.useEffect)(()=>{d&&I(d)},[d]),(0,N.useEffect)(()=>{V&&s(!0)},[V]),(0,N.useEffect)(()=>{(async function(){if(!(H||!e)&&!(!r||!D?.chainId)){R(!0);try{let l=await z({from:o,chainId:D.chainId,transactions:(t||[]).map(({serializedMessage:E})=>E),method:p});C(l.unitLimits),s(!1)}catch{s(!0)}finally{R(!1)}}})()},[t,r,o,D?.chainId,H,e,p]),(0,N.useEffect)(()=>{(async function(){if(!(r&&(!a||!c?.length))){R(!0);try{let l=t||[];r&&a&&(l=await Promise.all(l.map(async(M,j)=>{let{serializedMessage:Q,whetherModified:X,...le}=M,me=await Le(Q,a.computeUnitPrice,c[j],X);return{...le,serializedMessage:me,whetherModified:X}})));let{totalPriorityFee:E,priorityFees:S}=await De(l.map(({serializedMessage:M})=>M));F(E),O(l),n(S),s(!1)}catch{s(!0)}finally{R(!1)}}})()},[t,r,a,c]),{loading:h>0||U,baseFee:_,totalPriorityFee:T,priorityFees:A,totalFee:Z(Ae(_,(t||[]).length),T),signInfo:a,estimateFailed:b,replacedTransactions:f}}var Qe=mo;var uo=({from:e,coinId:t,preExecInfo:o,walletId:r,transactions:g,addPriorityFee:i,method:d})=>{let p=o?.loading,h=(0,Xe.useMemo)(()=>o?.unitGasLimitList||[],[o]),{loading:y,totalFee:a,baseFee:I,priorityFees:c,estimateFailed:C,signInfo:T,replacedTransactions:F}=Qe({coinId:t,transactions:g||[],address:e,replace:i,unitLimits:h,disabled:{disabledPreExecute:!0},method:d}),A=T?.solRent||"0",n=C||!p&&o.preExeStatus===!1,b=Me(t,r)||{},{coinAmountInt:s}=b,_=pe(s)||fe(s,a)||p,f=pe(s)||fe(s,Z(a,A))||p;return{loading:y,networkFeeProps:{loading:y,networkFee:a,estimateFailed:n,coinId:t},isSufficientGas:_,baseFee:I,priorityFees:c,networkFee:a,estimateFailed:n,estimateFailedMsg:n?Y("wallet_extension_alert_estimate_unavailable"):null,isSufficientBalance:f,selfRent:A,replacedTransactions:F,coinWithBalance:b}},Ze=uo;function po({txId:e,coinId:t,walletId:o,transactions:r=[],dappInfo:g={},showDappInfo:i=!0,addPriorityFee:d=!0,showSwitchNetwork:p=!0,onConfirm:h,onCancel:y,onAddressCopy:a=_e,onNetworkChange:I,method:c,providerType:C=J,slot:T={}}){let F=ne(C),A=t||F?.coinId,n=G(A)||{},b=n.localType,s=K(o),_=oe(b,o),[f,O]=(0,x.useState)({}),z=(0,x.useMemo)(()=>r.map(v=>{try{if(v.serializedMessage)return v;let ue=Fe(v);return{instanceType:ue,serializedMessage:Pe(v,ue),needToReplaceRecentBlockhash:!v.recentBlockhash}}catch{return null}}).filter(Boolean),[r.length]),{networkFee:D,isSufficientGas:L,networkFeeProps:H,estimateFailed:U,estimateFailedMsg:V,loading:R,isSufficientBalance:P,selfRent:l,replacedTransactions:E,coinWithBalance:S}=Ze({from:_,coinId:A,walletId:o,transactions:z,addPriorityFee:d,preExecInfo:f,method:c}),M=(0,x.useCallback)(()=>!P&&L?{renderMessage:()=>Y("wallet_extension_loading_text_reserve_rent_exempt",{num:ee(ye.div(l,10**n?.decimals),{precision:n?.displayPrecision,isStableCoin:n?.stableCoin,roundingMode:"CEIL"}).value,token:n?.symbol,balance:ee(S?.coinAmount,{useLargeNumberPrecision:!0,precision:S?.displayPrecision,isStableCoin:S?.stableCoin}).value}),level:761,type:ge.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:n?.coinId,address:_,walletId:o}:null,[P,L,e,n?.coinId,n?.decimals,n?.symbol,_,o,l,S?.coinAmount]),j=ae({initialType:s.initialType}),Q=(0,x.useCallback)(()=>f?.needFillUp?{renderMessage:()=>Y("wallet_extension_trade_text_insufficient_funds",{token:n?.symbol,balance:ee(S?.coinAmount,{useLargeNumberPrecision:!0,precision:S?.displayPrecision,isStableCoin:S?.stableCoin}).value}),level:825,type:ge.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:n?.coinId,address:_,walletId:o}:null,[n?.coinId,n?.symbol,_,f?.needFillUp,S?.coinAmount,e,o]),X=(0,x.useMemo)(()=>[M(),j(),Q()].filter(Boolean),[M,j,Q]),le=(0,x.useMemo)(()=>({dappData:JSON.stringify(z.map(v=>({transaction:v.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))),from:_,dappInfo:i?g:{},chainIndex:n?.chainId,method:c,forceLoading:!0}),[n?.chainId]),me=(0,$e.useMemoizedFn)(async()=>{await h({serviceCharge:D,replacedTransactions:E,serializedTransactions:z})}),{handleCancel:io,buttonGroup:ao}=ve({feeLoading:R,estimateFailed:U,isSufficientGas:L,isSufficientBalance:P,onCancel:y,onConfirm:me,chainConfirmDisabled:xe(s.initialType),coinWithBalance:S,preExecInfo:f}),so={txId:e,baseCoin:n,estimateFailed:U,isSufficientBalance:P,isSufficientGas:L,estimateFailedMsg:V,coinWithBalance:S};return x.default.createElement(re,{slot:{...T,top:p&&x.default.createElement(qe,{providerType:C,chainName:n?.chainName,onNetworkChange:I})},chainHeaderTips:X,networkFeeProps:H,preExecParams:le,onAddressCopy:a,walletAccount:s,handleCancel:io,buttonGroup:ao,localType:n?.localType,txState:so,onUpdatePreExecInfo:O})}var eo=po;de();m();u();de();function fo(e){let{coinId:t,showSwitchNetwork:o=!0}=e?.params?.extParams||{},{providerType:r=J}=e?.params||{},i=ne(r)?.coinId;return{coinId:t||i,showSwitchNetwork:r===Ne?!1:o}}var oo=fo;m();u();var no=k(be());Ce();function Co({coinId:e,walletId:t,method:o,okxArgs:r,onConfirm:g}){let i=(0,no.useDispatch)();return async({replacedTransactions:d,serviceCharge:p,serializedTransactions:h})=>{let I=await i(se({walletId:t,localType:$,method:o,params:{message:h,okxArgs:r},extraParams:{coinId:e,replacedTransactions:d,serviceCharge:p}})),c;if(o===w.SIGN_ALL_TRANSACTIONS)c=(I.signedTransactionResults||[]).map(({serializedTransaction:C,type:T})=>Se(C,T));else if(o===w.SIGN_TRANSACTION){let{instanceType:C}=h[0]||{};c=Se(I.serializedTransaction,C)}else o===w.SIGN_AND_SEND_TRANSACTION&&(c=I);return g(c)}}var to=Co;var ro=e=>{let{id:t,coinId:o,method:r,params:g,walletId:i,origin:d,source:p,dappInfo:h,showDappInfo:y=!0,addPriorityFee:a=!0,showSwitchNetwork:I,onConfirm:c,onCancel:C,onAddressCopy:T,okxArgs:F}=e,{providerType:A=J,isSilentSign:n}=g,{coinId:b,showSwitchNetwork:s}=oo(e),_=ie(e),f=o||b,O=Oe({coinId:f}),D=(G(f)||{}).localType,L=g?.message||[],H=K(i),U=We({id:t,extraParams:{coinId:f}}),V=Be({walletId:i,localType:D,id:t,origin:d}),R=Ve({walletId:i}),P=to({coinId:f,walletId:i,method:r,okxArgs:F,onConfirm:c}),l,E,S;p==="dapp"?(l=U,E=V,S=R):(l=P,E=C,S=T);let{loading:M}=Ue({unapproved:{origin:d,id:t},network:O?.chainName,providerType:A});return M?ce.default.createElement(He,null):ce.default.createElement(eo,{method:r,coinId:f,showSwitchNetwork:typeof I=="boolean"?I:s,slot:{bottom:n&&ce.default.createElement(te,{walletAccount:H})},txId:t,walletId:i,transactions:L,dappInfo:h||_,showDappInfo:y,addPriorityFee:a,onConfirm:l,onCancel:E,onAddressCopy:S,providerType:A})};function So(e){switch(e.method){case w.SIGN_TRANSACTION:case w.RPC_SIGN_TRANSACTION:case w.SIGN_AND_SEND_TRANSACTION:case w.RPC_SIGN_AND_SEND_TRANSACTION:case w.SIGN_ALL_TRANSACTIONS:case w.RPC_SIGN_ALL_TRANSACTIONS:return Ie.default.createElement(ro,{...e});case w.SIGN_MESSAGE:case w.RPC_SIGN_MESSAGE:return Ie.default.createElement(je,{...e});default:return""}}var jn=So;export{jn as a};
//# sourceMappingURL=chunk-RKT4UZET.js.map
