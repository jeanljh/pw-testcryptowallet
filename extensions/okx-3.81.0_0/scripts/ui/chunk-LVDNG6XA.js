import{a as E,b as f,k as Xe}from"./chunk-2UMIXQCO.js";import{a as Qe}from"./chunk-2FN5XB3U.js";import{a as Je}from"./chunk-3YSB4TUI.js";import{a as $e}from"./chunk-CIE6HRPG.js";import{a as Ze,c as z,d as je}from"./chunk-GCPFAJKK.js";import{b as Be}from"./chunk-Q7DF5H6O.js";import{a as ze}from"./chunk-SVG7BWFP.js";import{f as Le}from"./chunk-JZBABWUI.js";import{a as Ye,b as ne}from"./chunk-TF4QEXO7.js";import{a as He,e as Ke,f as Me}from"./chunk-GDQAWT2G.js";import{a as H}from"./chunk-7HYQ2DGP.js";import{c as Ve}from"./chunk-JHO7RU36.js";import{a as _}from"./chunk-UOWKDFTX.js";import{s as Fe,u as qe,w as Ge}from"./chunk-ZOKF3EKQ.js";import{a as be}from"./chunk-WRVJM3F3.js";import{b as W}from"./chunk-XRCQOGA2.js";import{e as De}from"./chunk-SWUBCABA.js";import{a as oe,k as We}from"./chunk-U7IWD6UB.js";import{Y as Ue}from"./chunk-GCS2RK7E.js";import{o as Oe}from"./chunk-Z62JX42S.js";import{Na as Y,W as xe,Y as we,ga as ve,ka as Ce,qa as ke,ra as he}from"./chunk-2QHGKEME.js";import{a as Et}from"./chunk-6PA65BO3.js";import{a as Ie,b as h}from"./chunk-MAAUVUWY.js";import{E as U,n as L}from"./chunk-WU2LB6XB.js";import{j as F,q as Se}from"./chunk-NUN72MDU.js";import{c as N,e as M}from"./chunk-EN2WHAVL.js";import{E as _e,p as ge}from"./chunk-EFOY37CC.js";import{a as V}from"./chunk-E4OV5WXB.js";import{g as Ae,i as Re,k as Rt}from"./chunk-O33H5V3V.js";import{O as At,a as pe,b as _t,la as Ee,ma as Ne,tb as ye}from"./chunk-COF7YKSN.js";import{A as C,K as Te}from"./chunk-VZKEX7KP.js";import{H as S,I as Pe}from"./chunk-BJKBO23H.js";import{M as de,Y as fe,f as le,va as Pt}from"./chunk-XFTQD4B2.js";import{b as te}from"./chunk-73B6GL3S.js";import{f as x,o as T,q as g}from"./chunk-Y5OH3DDZ.js";T();g();var O=x(Y());function Ut(){let e=(0,O.useSelector)(Me),t=e&&e.metadata?e.metadata.id:null,o=t?1:0,n=(0,O.useSelector)(we),r=n.length,s=(0,O.useSelector)(xe),c=(0,O.useSelector)(he),i=c.length,a=(0,O.useSelector)(ke),u=a.length,m=(0,O.useSelector)(Ke);return{unapprovedTxList:n,unapprovedTxCount:r,unapprovedSmCount:s,unapprovedStList:c,unapprovedStCount:i,unapprovedPermissionCount:o,unapprovedPermissionsRequestId:t,unapprovedSnList:a,unapprovedSnCount:u,realGeneralDappRequestsCount:m,unapprovedRequestCount:r+s+i+u+o+m}}T();g();T();g();var P=x(te()),ce=x(Y()),pt=x(Et());Te();T();g();var B=x(Y()),q=x(Oe()),I=x(At());Pt();_t();M();ye();T();g();M();var et=async e=>await N().rpcEvmAddTransaction(e),re=async e=>await N().rpcEvmUpdateTransaction(e),tt=async e=>await N().rpcEvmConfirmTransaction(e),nt=async e=>await N().rpcEvmFindTransaction(e),ot=async(e,t)=>await N().rpcEvmPublishTransaction(e,t);T();g();var rt=x(te());Te();var Nt=()=>{let e=Xe();return t=>{if(t){let{type:o,status:n,txHash:r,extraParams:s}=t,c={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_success",params:{first:s?.value,second:s?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_success"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_success",params:{first:s?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_success",params:{first:s?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployed_successfully"}},i={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_fail",params:{first:s?.value,second:s?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_fail"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_fail",params:{first:s?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_fail",params:{first:s?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployfailed"}},a,u,m,l,d;n===E.PENDING?(a=S.TYPE.success,o===f.CANCEL_AUTHORIZATION?(u="wallet_transfer_notif_cancel_approval_submit",m={first:s?.coinSymbol}):u="wallet_transfer_notif_transaction_submit"):(n===E.SUCCEED?(a=S.TYPE.success,u=c[o]?.key,m=c[o]?.params):(a=S.TYPE.error,u=i[o]?.key,m=i[o]?.params),n!==E.DROPPED&&(l=e(r),d="wallet_transfer_notif_view_on_explorer")),S[a]({title:C(u,m)||u,desc:l?rt.default.createElement(ze,{url:l,urlText:C(d)}):null,duration:3})}}},st=Nt;function yt(e){let t={to:e.to,value:(0,I.addHexPrefix)(h(e.value)),gasLimit:(0,I.addHexPrefix)(h(e.gasLimit)),nonce:(0,I.addHexPrefix)(h(e.nonce)),kaiaTxType:e.kaiaTxType,signFn:e.signFn};return e.type===L.FEE_MARKET?(t.maxFeePerGas=(0,I.addHexPrefix)(h(e.maxFeePerGas)),t.maxPriorityFeePerGas=(0,I.addHexPrefix)(h(e.maxPriorityFeePerGas)),t.type=e.type):(t.gasPrice=(0,I.addHexPrefix)(h(e.gasPrice)),e.type=L.LEGACY),e.data&&(t.data=e.data),t}function se(e){let t=be(),o=e||t,n=W();return(0,q.useMemoizedFn)(r=>{let{type:s,txParams:c,extraParams:i}=r,a=s;return a||(c.to?a=f.CONTRACT_CALL:a=f.CONTRACT_DEPLOY),{id:_e(),type:a,txParams:{...yt(c),from:c.from||n,chainId:o.chainId},status:E.UNAPPROVED,createTime:+new Date,txPool:[],isCanceling:!1,isSpeeding:!1,extraParams:i||{}}})}function ae(e){let t=st(),o=(0,B.useSelector)(Ce),n=oe();return(0,q.useMemoizedFn)(async(r,{walletId:s=n,signedCallback:c=le}={})=>{if(!r)throw new Error("tx meta error");let i;if(r.txParams?.result)i=r.txParams.result;else{let{from:u}=r.txParams||{};i=await N().signRpcEvmTransaction(r.txParams,u,o,s)}if(r?.txParams?.signFn===U.KAIA_SIGN_TRANSACTION)return{rawTx:i};let a=await Be(Ee,i);return await c({rawTx:i,txHash:a,status:E.PENDING}),new Promise((u,m)=>{ot({txId:r.id,rawTx:i},e).then(({error:l,data:d,tx:p})=>{if(l){(p?.status===E.PENDING||p?.status===E.DROPPED)&&t(p),m(l);let{type:A,txParams:k,extraParams:v}=r,{from:D,to:y,value:K,gasLimit:b,gasPrice:R,maxFeePerGas:Z,maxPriorityFeePerGas:j,data:$,nonce:J,chainId:Q}=k||{},{approvedAmount:X,coinSymbol:ue,tokenAddress:me,approvedAddress:ee,value:Tt,toAddress:gt}=v||{};pe.captureEvent({tags:{address:D},message:"API_ERROR_evm_rpc_send_tx",contexts:{report:{info:JSON.stringify({type:A,txParams:{from:D,to:y,value:K,gasLimit:b,gasPrice:R,maxFeePerGas:Z,maxPriorityFeePerGas:j,data:$,nonce:J,chainId:Q},extraParams:fe({approvedAmount:X,coinSymbol:ue,tokenAddress:me,approvedAddress:ee,value:Tt,toAddress:gt},de)})}},exception:{values:[{type:"API_ERROR_evm_rpc_send_tx",value:l?.message}]},level:"info"})}else t(p),u({id:r.id,txHash:d.result})}).catch(async l=>{await tt({txId:r.id,tx:{status:E.DROPPED,finishTime:+new Date,errorMessage:l?.message},checkPoolEmpty:!0}),m(l)})})})}var ie=()=>{let e=(0,B.useDispatch)(),t=oe();return async(o,n=t)=>{await e(Ve({walletId:n,txParams:o.txParams,isRpcMode:!0}));let{id:r}=o,s=await nt(r);if(s&&(s.status===E.SUCCEED||s.status===E.DROPPED||s.status===E.DROPPED))throw Error(V)}};function at(e){let t=se(e),o=ae(e),n=ie();return(0,q.useMemoizedFn)(async(r,s,c)=>{let i=t(r);return await n(i,s),o(i,{walletId:s,signedCallback:a=>{let u={...i,...a};try{c&&c(u)}catch{}return et(u)}})})}function _n(){let e=se(),t=ae(),o=ie();return(0,q.useMemoizedFn)(async(n,r)=>{let{type:s,txParams:c,extraParams:i}=n,a=e({type:s,txParams:{...c,...r},extraParams:i}),{id:u,txPool:m}=n;return n.id=a.id,a.id=u,n.txPool=[],await o(a),t(a,{signedCallback:l=>re({txId:u,tx:{...a,status:E.PENDING,isSpeeding:!0,txPool:[n,...m],...l}})})})}function Pn(){let e=qe(!0),t=se(),o=ae(),n=ie();return(0,q.useMemoizedFn)(async(r,s)=>{let{txParams:c,extraParams:i}=r,{from:a,nonce:u,type:m,chainId:l}=c,d=e.find(({address:v})=>!v),p=t({type:f.TRANS_OUT,txParams:{to:a,value:"0x0",nonce:u,chainId:l,type:m,...s},extraParams:i}),{id:A,txPool:k}=r;return r.id=p.id,p.id=A,r.txPool=[],await n(p),o(p,{signedCallback:v=>re({txId:A,tx:{...p,status:E.PENDING,isCanceling:!0,txPool:[r,...k],extraParams:{toAddress:a,tokenAddress:"",coinSymbol:d?.symbol,value:"0"},...v}})})})}T();g();var G=x(te()),it=x(Oe());M();function ct(e,t){let o=W(),n=e||o,[r,s]=(0,G.useState)(!1),[c,i]=(0,G.useState)(null),[a,u]=(0,G.useState)(null),m=N(),l=(0,it.useMemoizedFn)(async()=>{s(!0);try{let d=await m.rpcEvmGetNonce(n,t);if(d){let{nonce:p,suggestedNonce:A}=d;i(p),u(A)}}catch(d){let p=d;Pe.error({title:p?.data?.msg||p?.msg||p?.data?.originalError?.msg||p?.message})}finally{s(!1)}});return(0,G.useEffect)(()=>{l()},[n,t?.uniqueId]),{loadingNonce:r,nonce:c,suggestedNonce:a}}T();g();var ut=async(e,t)=>{let o;try{o=await t.getCode(e)}catch{o=null}return{isContractAddress:Boolean(o&&o!=="0x"&&o!=="0x0")}};T();g();function mt(e,{customPermissionAmount:t}){let o=H(e);if(o){if(o.name!==_.TOKEN_METHOD_APPROVE)throw new Error(`Invalid data; should be 'approve' method, but instead is '${o.name}'`)}else throw new Error("Invalid data");let n=z(o);n.startsWith("0x")&&(n=n.substring(2));let[r,s]=e.split(n);if(!r||!s)throw new Error("Invalid data");if(s.length!==64)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let c=h(t);if(c.length>64)throw new Error("Custom value is larger than u256");return c=c.padStart(s.length,"0"),`${r}${n}${c}`}function xt({data:e,to:t}){let o=Fe(),[n,r]=(0,P.useState)(""),[s,c]=(0,P.useState)(!1);return(0,P.useEffect)(()=>{(async()=>{if(e&&!t){r(_.DEPLOY_CONTRACT);return}try{let l=H(e)?.name,d=[_.TOKEN_METHOD_APPROVE,_.TOKEN_METHOD_TRANSFER,_.TOKEN_METHOD_TRANSFER_FROM].find(p=>p.toLowerCase()===l.toLowerCase());if(d){r(d);return}}catch{}c(!0);let a=await o(),{isContractAddress:u}=await ut(t,a);r(u?_.CONTRACT_INTERACTION:_.SENT_ETHER),c(!1)})()},[e,t,o]),[n,s]}function wt({data:e,type:t}){let o,n,r,s;try{let c=H(e),i=je(c);o=z(c),s=i,n=t===_.TOKEN_METHOD_APPROVE,r=n&&Number(s)===0}catch{}return{address:o,isApprove:n,isRevoke:r,amount:s}}function vt(e,t){let o=Ge(void 0,t),[n,r]=(0,P.useState)({}),[s,c]=(0,P.useState)(!1),i=async()=>{try{c(!0);let{symbol:a,decimals:u}=await o(e);r({symbol:a,decimals:u}),c(!1)}catch{c(!1)}};return(0,P.useEffect)(()=>{e&&i()},[e]),[n,s]}function Ct(e){let[t,o]=(0,P.useState)(-1),{isApprove:n,amount:r}=e;return(0,P.useEffect)(()=>{n&&o(r)},[n,r]),[{...e,customApproveAmount:t},o]}function kt({origin:e,isApprove:t,isRevoke:o,symbol:n,walletId:r}){let s=We(r),c=(0,ce.useSelector)(ve),i=r?s:c,u=(0,ce.useSelector)(He)[e]||{},[m,l]=(0,P.useState)({});return(0,P.useEffect)(()=>{let d=null,p=null,A=null;t?(d=null,p=n,A=o?C("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:n}):C("wallet_dapp_conncetion_alert_approve_tip",{name:u.name,tokenSymbol:n})):(d=u.icon,A=u.host,p=u.name),l({icon:d,host:A,name:p})},[o,n]),{...m,originInfo:u,wallet:`${i.keyringName} - ${i.walletName}`}}function ht(e,t){let{nonce:o,suggestedNonce:n}=ct(e,t),[r,s]=(0,P.useState)(0),[c,i]=(0,P.useState)(!0);return(0,P.useEffect)(()=>{s(n),i(!1)},[n]),[{suggested:o,custom:r,pending:c},s]}var St=({tx:e,nonce:t,txData:o,tokenInfo:n,chain:r,customGasInfo:s,approvedAmount:c,formattedAmount:i,txType:a})=>{let{from:u,to:m,value:l,data:d}=e,{isSupportEip1559:p,maxFeePerGas:A,maxPriorityFeePerGas:k,gasPrice:v,gasLimit:D}=s,y={from:u,to:m,value:l,gasLimit:D,nonce:t,data:d};p?(y.maxFeePerGas=A,y.maxPriorityFeePerGas=k,y.type=L.FEE_MARKET):(y.gasPrice=v,y.type=L.LEGACY),e?.method===U.KAIA_SIGN_TRANSACTION&&(y.signFn=U.KAIA_SIGN_TRANSACTION,y.kaiaTxType=e?.typeInt);let b={[_.DEPLOY_CONTRACT]:f.CONTRACT_DEPLOY,[_.CONTRACT_INTERACTION]:f.CONTRACT_CALL,[_.TOKEN_METHOD_APPROVE]:f.AUTHORIZATION,[_.SENT_ETHER]:f.TRANS_OUT,[_.TOKEN_METHOD_TRANSFER]:f.TRANS_OUT,[_.TOKEN_METHOD_TRANSFER_FROM]:f.TRANS_OUT}[a]||f.CONTRACT_CALL;o.isRevoke&&(b=f.CANCEL_AUTHORIZATION);let R={};return a===_.TOKEN_METHOD_APPROVE&&(R.approvedAmount=c,R.coinSymbol=n.symbol,R.tokenAddress=m,R.approvedAddress=o.address),a===_.SENT_ETHER&&(R.value=ge(Ie(l)),R.toAddress=m,R.coinSymbol=r.symbol),(a===_.TOKEN_METHOD_TRANSFER||a===_.TOKEN_METHOD_TRANSFER_FROM)&&(R.value=i,R.tokenAddress=m,R.toAddress=o.address,R.coinSymbol=n.symbol),{type:b,txParams:y,extraParams:R}};function Ot(e,t,o){let n=(0,pt.useHistory)(),r=Je(),s=Qe(),c=at(o),[i,a]=(0,P.useState)(!1);return[{sign:async(l,d)=>{a(!0),c(e,l,d).then(async({txHash:p,rawTx:A})=>{let k=e.signFn===U.KAIA_SIGN_TRANSACTION?{raw:A}:p;r({id:t,result:k}),n.push(Ue)}).catch(p=>{p.message!==V&&S.error({title:p?.message}),r({id:t,error:p?.message||"Transaction failed"}),a(!1)}).finally(()=>{n.go(0)})},cancel:async()=>{await s({id:t}),n.go(0)}},i]}function io(e,t){let[o]=xt(e),n=wt({data:e.data,type:o}),[r,s]=vt(e?.to,t),c=kt({walletId:e?.walletId,origin:e.origin,...n,...r}),i=(0,P.useMemo)(()=>Ze(n?.amount||0,r?.decimals),[n?.amount,r?.decimals]),[a,u]=Ct({...n,...r,formattedAmount:i}),[m,l]=(0,P.useState)(e.data);(0,P.useEffect)(()=>{if(o===_.TOKEN_METHOD_APPROVE)try{let ee=mt(e.data,{customPermissionAmount:a.customApproveAmount});l(ee)}catch{}},[a.customApproveAmount,e.data,r?.decimals,n,o]);let d={...t,name:t?.name||t?.chainName},[p,A]=ht(e.from,t),{setGasType:k,currentGasInfo:v,chainGasLevels:D,chainGasLoading:y,setCustomGasOption:K,chainGasError:b,chainGasLoadFailed:R,chainGasLimitLoadFailed:Z}=Le({to:e.to,from:e.from,value:e.value||"0x0",data:m,method:e.method},{gasLimit:e.gas||e.gasLimit,gasPrice:e.gasPrice,maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas},t),j=St({tx:{...e,data:m},nonce:p.custom||p.suggested,txData:n,tokenInfo:r,chain:d,customGasInfo:v,approvedAmount:a.customApproveAmount,formattedAmount:i,txType:o}),[{sign:$,cancel:J},Q]=Ot(j,e.id,t),X=(0,P.useMemo)(()=>{switch(o){case _.DEPLOY_CONTRACT:return C("developer_mode_history_title_contract_eployment");case _.TOKEN_METHOD_APPROVE:return n?.isRevoke?C("wallet_extension_popup_btn_revoke_approval"):C("wallet_extension_popup_btn_approve");default:return C("wallet_extension_popup_title_contract_interaction")}},[o,n?.isRevoke]);return[{type:o,title:X,auth:{...a,...r,formattedAmount:i},meta:c,chain:d,nonce:p,gas:{setGasType:k,chainGasLevels:D,currentGasInfo:v,setCustomGasOption:K,chainGasLoading:y,chainGasError:b,chainGasLoadFailed:R,chainGasLimitLoadFailed:Z},loading:{sign:Q,token:s},data:m},{sign:$,cancel:J,setNonce:A,setAuthAmount:u}]}T();g();var ft=x(Y());T();g();Se();M();function lt(e,t,o){return async n=>{await N().resolvePendingApproval(e,t);let{pendingApprovals:r}=await F(n);Object.values(r).length===0&&!o&&n(ne())}}function dt(e){return async t=>{await N().rejectPendingApproval(e);let{pendingApprovals:o}=await F(t);Object.values(o).length===0&&t(ne())}}Se();ye();function xo(e){let t=(0,ft.useDispatch)(),n=(i=>{let{id:a,origin:u,requestData:m,type:l,requestData:{chainId:d}}=i;return{id:a,origin:u,...m,requestData:m,chainIdToDisplay:parseInt(d,16),switchType:l,explorers:m.blockExplorerUrl}})(e),{addRpcNetwork:r}=De();return[n,{cancel:async()=>{await t(dt(n.id)),await F(t)},approve:async()=>{let{rpcUrl:i,ticker:a,blockExplorerUrl:u,chainId:m,faucetUrl:l,chainName:d}=n,p=await r({chainId:m,explorerUrl:u,faucetUrl:l,name:d,rpcUrl:i,symbol:a}),{uniqueId:A}=p;await t(Ye(Ne,i,a,d,m,{},!0,A)),await t($e({isRpcMode:!0,currentNetworkUniqueId:A})),await t(lt(n.id,n.requestData)),await F(t)}}]}T();g();Rt();function ho(e){return Ae(e?.image)?e.image=e.image[0]:Re(e?.image)&&(e.image=null),e}export{tt as a,nt as b,st as c,at as d,_n as e,Pn as f,ct as g,xt as h,wt as i,St as j,io as k,xo as l,Ut as m,ho as n};
//# sourceMappingURL=chunk-LVDNG6XA.js.map
