import{a as Le}from"./chunk-VEPTXEII.js";import{c as de,d as I}from"./chunk-A5U7X3LN.js";import{a as Fe}from"./chunk-SOSR34AP.js";import{d as N}from"./chunk-ZOKF3EKQ.js";import{a as W}from"./chunk-WRVJM3F3.js";import{e as Pe}from"./chunk-SWUBCABA.js";import{a as Ge}from"./chunk-FGAB46RQ.js";import{o as $}from"./chunk-Z62JX42S.js";import{G as ge}from"./chunk-2QHGKEME.js";import{c as ye}from"./chunk-XSVHDPBS.js";import{a as he,b as X}from"./chunk-MAAUVUWY.js";import{_ as E}from"./chunk-WU2LB6XB.js";import{D as z,c as w,d as b,e as ce,f as B,h as O,m as me,o as ue,p as le,t as U}from"./chunk-EFOY37CC.js";import{b as fe,c as Ye}from"./chunk-GR7YC6C3.js";import{A as pe,J as qe}from"./chunk-O33H5V3V.js";import{A as oe,K as Ve,o as _}from"./chunk-VZKEX7KP.js";import{I as se,M as ne,f as re,va as ae}from"./chunk-XFTQD4B2.js";import{b as H}from"./chunk-73B6GL3S.js";import{f as R,o as P,q as d}from"./chunk-Y5OH3DDZ.js";P();d();var h=R(H()),M=R($());ae();Ve();Ye();qe();P();d();var T=R(H()),be=R($());P();d();var ke=R(H()),D=R($());P();d();var Ce=async(e={})=>!(e?.baseFeePerGas===void 0||e?.baseFeePerGas===null),Q=e=>parseInt(e,16);function ze({baseFeePerGas:e,number:t}){return{number:t,baseFeePerGas:e,gasUsedRatio:null,priorityFeesByPercentile:null}}function $e({baseFeePerGas:e,number:t,blockIndex:s,gasUsedRatios:r,priorityFeePercentileGroups:i,percentiles:n}){let o=r[s],a=i[s],u=n.reduce((c,m,l)=>{let f=a[l];return{...c,[m]:Q(f)}},{});return{number:t,baseFeePerGas:e,gasUsedRatio:o,priorityFeesByPercentile:u}}async function xe({provider:e,numberOfBlocks:t,endBlockNumber:s,percentiles:r,includeNextBlock:i}){let n=z(X(t)),o=z(X(s)),a=await e.send("eth_feeHistory",[n,o,r]),u=Q(a.oldestBlock);if(a.baseFeePerGas!==void 0&&a.baseFeePerGas.length>0&&a.gasUsedRatio.length>0&&(a.reward===void 0||a.reward.length>0)){let c=i?a.baseFeePerGas:a.baseFeePerGas.slice(0,t),m=a.gasUsedRatio,l=a.reward??[],f=m.length;return c.map((F,p)=>{let G=Q(F),k=w(u,p);return p>=f?ze({baseFeePerGas:G,number:k}):$e({baseFeePerGas:G,number:k,blockIndex:p,gasUsedRatios:m,priorityFeePercentileGroups:l,percentiles:r})})}return[]}var J=1024;function Xe(e,t){B(e,t)&&(t=e);let s=[];for(let r=b(e,t);B(r,e);r=w(r,J)){let i=b(e,r),n=i<J?i:J,o=w(r,n);s.push({numberOfBlocks:n,endBlockNumber:o})}return s}var Ee=async({provider:e,numberOfBlocks:t,endBlock:s="latest",percentiles:r=[],includeNextBlock:i=!1})=>{let n=r.length>0?Array.from(new Set(r)).sort((c,m)=>c-m):[],a=Xe(s,t);return(await Promise.all(a.map(({numberOfBlocks:c,endBlockNumber:m},l)=>l===a.length-1?xe({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:n,includeNextBlock:i}):xe({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:n,includeNextBlock:!1})))).reduce((c,m)=>[...c,...m],[])};var Je=e=>e?N(e):{},Qe=["0x144","0x2105"],Ze=e=>(0,ke.useCallback)(async()=>e?(await Je(e)).getBlock("latest"):{},[e]),Re=e=>(0,D.useMemoizedFn)(async({to:t,from:s,value:r,data:i=""},n)=>{let o=!n,a="";i?I(i)?a=ge(i):a=de(i):o||(a=Fe(t,r||0));let u=await N(e),c={from:s,to:o?t:n};return o?c.value=r:c.value="0x0",a?c.data=a:c.data="0x",(await u.estimateGas(c)).toString()},[e]),Z=["low","medium","high"],we={low:{percentile:10,base:1.1,priority:.94,minSuggestedMaxPriorityFeePerGas:1e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:3e4}},medium:{percentile:20,base:1.2,priority:.97,minSuggestedMaxPriorityFeePerGas:15e8,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:45e3}},high:{percentile:30,base:1.25,priority:.98,minSuggestedMaxPriorityFeePerGas:2e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:6e4}}};function Ke(e){let t=e.slice().sort((i,n)=>B(b(i,n),0)?-1:1),s=t.length,r=Math.floor((s-1)/2);return t[r]}var je=(e,t,s)=>{let r=s[e],i=t[t.length-1].baseFeePerGas,n=t.map(u=>"priorityFeesByPercentile"in u?u?.priorityFeesByPercentile?.[r.percentile]:null).filter(Boolean),o=Ke(n),a=w(i,o);return{baseFeePerGas:U(i,0),maxFeePerGas:U(a,0),maxPriorityFeePerGas:U(o,0)}},et=(e,t)=>Z.reduce((s,r)=>{let i=je(r,e,t),{maxFeePerGas:n}=i;return[...s,{level:r,isSupportEip1559:!0,gasPrice:n,...i}]},[]),tt=(e,t)=>(0,D.useMemoizedFn)(async s=>{let r=await N(e),i=await Ee({provider:r,endBlock:s.number,numberOfBlocks:21,percentiles:[10,20,30]});return et(i,t)},[e]),it={low:{coefficient:1.1,level:"low"},medium:{coefficient:1.35,level:"medium"},high:{coefficient:1.7,level:"high"}},rt=(e,t)=>(0,D.useMemoizedFn)(async()=>{let i=(await(await N(e)).getFeeData()).gasPrice.toString();return Z.reduce((n,o)=>{let{level:a}=t[o];return[...n,{level:a,gasPrice:i}]},[])},[e]);function st(e){let{rpcNetworks:t}=Pe(),s=t.find(r=>r?.rpcUrl===e);return Z.reduce((r,i)=>{let n=s?.gasNormal?.[i]||it[i]?.coefficient,o=s?.gas1559?.[i]||we?.[i];return{evmNormalGasPrice:{...r.evmNormalGasPrice,[i]:{level:i,coefficient:n}},evm1559GasPrice:{...r.evm1559GasPrice,[i]:{...we[i],...o}}}},{})}var _e=(e,t={})=>{let s=st(e),r=Ze(e),i=rt(e,s?.evmNormalGasPrice),n=tt(e,s?.evm1559GasPrice),o=t?.method;return(0,D.useMemoizedFn)(async a=>{if(e){let u=await r(),c=!ye({chainId:a,method:o})&&!Qe.includes(a)&&await Ce(u),m,l=c?n:i;try{m=await l(u)}catch{m=await i(u)}return m}return[]},[e])};var nt=({txParams:e={}},t)=>{let{to:s,from:r,value:i,data:n,tokenAddress:o}=e,[a,u]=(0,T.useState)(""),[c,m]=(0,T.useState)(""),[l,f]=(0,T.useState)(!0),[F,p]=(0,T.useState)(!1),G=W(),y=Re((t||G)?.rpcUrl),{run:x}=(0,be.useDebounceFn)(async()=>{try{f(!0);let C=await y({to:s,from:r,value:i,data:n},o);u(C),p(!1)}catch(C){m(C?.message||""),p(!0)}finally{f(!1)}},{wait:500});return(0,T.useEffect)(()=>{x()},[s,r,i,n,o,x]),{chainGasLimit:a,chainGasLimitError:c,chainGasLimitLoading:l,chainGasLimitLoadFailed:F}},Te=nt;P();d();var L=R(H());ae();var at=({txParams:e={}},t)=>{let[s,r]=(0,L.useState)([]),[i,n]=(0,L.useState)(""),[o,a]=(0,L.useState)(!0),[u,c]=(0,L.useState)(!1),{rpcUrl:m,chainId:l}=t,f=_e(m,e),F=7e3,p=(0,L.useRef)(null),G=(0,L.useRef)(!0),k=()=>{G.current=null,p.current&&clearTimeout(p.current)},y=async(x=!1)=>{try{x&&a(!0);let C=await f(l);(x||G.current)&&(r(C),c(!1))}catch(C){x&&(n(C?.message||""),c(!0))}finally{a(!1),G.current&&(p.current=setTimeout(()=>{y()},F))}};return(0,L.useEffect)(()=>t?.rpcUrl?(y(!0),()=>{k()}):re,[t?.rpcUrl]),{isSupportEip1559:s[0]?.isSupportEip1559,chainGasPrices:s,chainGasPriceError:i,chainGasPriceLoading:o,chainGasPriceLoadFailed:u}},ve=at;var Be=e=>I(e)?he(e):e,Ne={gas1559:{low:{base:"1.1",priority:"1.1"},medium:{base:"1.2",priority:"1.2"},high:{base:"1.3",priority:"1.3"},minPriority:"0"},gasNormal:{low:"1.1",medium:"1.2",high:"1.3"},gasLimit:"1.5"},ot={low:E.SLOW,medium:E.STANDARD,high:E.FAST},ct={},mt=({chainGasLevels:e})=>e.find(({typeKey:t})=>t===E.STANDARD)||ct,ut=()=>(0,M.useMemoizedFn)(async e=>{try{let{data:t}=await pe(fe.getTestNetGasRate,{chainId:Be(e)});return t}catch{return Ne}}),lt=e=>{let t=ut(),[s,r]=(0,h.useState)(!0),[i,n]=(0,h.useState)(Ne);return(0,M.useAsyncEffect)(async()=>{if(e){let o=await t(e);n(o),r(!1)}},[e]),{loading:s,chainGasRate:i}},Se=(e,t)=>{let{maxFeePerGas:s,gasPrice:r,gasLimit:i}=e,n=s||r;return{...e,unitPrice:`${_.ceilShort(ue(n),2)} ${oe("extension_wallet_transaction_input_gwei")}`,totalPrice:Ge(le(_.ceilMul(n,i,0)),{symbol:t?.symbol}).value}},ft=({chainGasLevels:e=[],chainGasRate:t={}})=>e.map(r=>{let i=t?.gas1559?.[r.level]||{},{baseFeePerGas:n,maxFeePerGas:o,maxPriorityFeePerGas:a,gasPrice:u,...c}=r,m=_.ceilMul(n,i?.base,0),l=ce([_.ceilMul(a,i?.priority,0),t?.gas1559?.minPriority?me(t?.gas1559?.minPriority):0]),f=w(m,l),F=t?.gasNormal?.[r.level]||1;return{gasPrice:_.ceilMul(u,F,0),baseFeePerGas:m,maxPriorityFeePerGas:l,maxFeePerGas:f,...c}}),K=({key:e,validDappGas:t,standardLevel:s,dappInjectedGasInfo:r})=>t&&r[e]||s[e],pt=({gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:s,isSupportEip1559:r})=>{let i=!1;return ne(r)||(r?i=O(s,0)&&O(t,s):i=O(e,0)),i},gt=(e={},t={},s=void 0)=>{let r=W(),i=s||r,n=Le(i.chainId),{chainGasPrices:o,isSupportEip1559:a,chainGasPriceError:u,chainGasPriceLoading:c,chainGasPriceLoadFailed:m}=ve({dappInjectedGasInfo:t,txParams:e},i),{chainGasLimit:l,chainGasLimitLoading:f,chainGasLimitError:F,chainGasLimitLoadFailed:p}=Te({txParams:e,dappInjectedGasInfo:t},i),{chainGasRate:G,loading:k}=lt(i.chainId),[y,x]=(0,h.useState)(null),[C,Y]=(0,h.useState)(E.STANDARD),{gasPrice:De,maxFeePerGas:Me,maxPriorityFeePerGas:Ae}=t,v=pt({gasPrice:De,maxFeePerGas:Me,maxPriorityFeePerGas:Ae,isSupportEip1559:a});(0,h.useEffect)(()=>{v&&Y(E.CUSTOM)},[v]),(0,M.useAsyncEffect)(async()=>{if(i?.rpcUrl){let g=await n(i.chainId);se(g)||(Y(E.CUSTOM),x(g))}},[i?.rpcUrl]);let He=c||f||k,Oe=m||p,Ue=u||F,We=G.gasLimit,A=_.ceilMul(l,We,0),q=(0,h.useMemo)(()=>ft({chainGasRate:G,chainGasLevels:o}).map(ie=>Se({...ie,gasLimit:A,typeKey:ot[ie.level]},i)),[a,G,o,A,i]),S=mt({chainGasLevels:q}),j=(0,h.useMemo)(()=>{let g={...S,gasPrice:K({key:"gasPrice",standardLevel:S,validDappGas:v,dappInjectedGasInfo:t}),maxFeePerGas:K({key:"maxFeePerGas",standardLevel:S,validDappGas:v,dappInjectedGasInfo:t}),maxPriorityFeePerGas:K({key:"maxPriorityFeePerGas",standardLevel:S,validDappGas:v,dappInjectedGasInfo:t})};return g.baseFeePerGas=b(g.maxFeePerGas,g.maxPriorityFeePerGas),g},[S,t,v]),ee=(0,h.useMemo)(()=>{let g=A;return y?.gasLimit?g=y.gasLimit:t.gasLimit&&(g=Be(t.gasLimit)),{...y||j,gasLimit:g,typeKey:E.CUSTOM}},[A,y,j,t.gasLimit]),te=(0,h.useMemo)(()=>[...q,Se(ee,i)],[q,ee,i]),Ie=te.find(({typeKey:g})=>g===C)||{};return{setGasType:Y,chainGasLevels:te,currentGasInfo:Ie,setCustomGasOption:x,chainGasLoading:He,chainGasError:Ue,chainGasLoadFailed:Oe,chainGasPriceLoading:c,chainGasLimitLoading:f,chainGasPriceLoadFailed:m,chainGasLimitLoadFailed:p}},ti=gt;export{Re as a,_e as b,Ne as c,ut as d,ft as e,ti as f};
//# sourceMappingURL=chunk-JZBABWUI.js.map
