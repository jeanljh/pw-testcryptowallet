import{a as we,b as Ee}from"./chunk-OJWYRJWY.js";import{a as Fe}from"./chunk-7IP3VPVS.js";import{b as Le}from"./chunk-M3OTLMUB.js";import{b as Te,g as ge,i as xe,l as Ce,m as Ae,q as Ie,r as he}from"./chunk-WRGSQF3V.js";import{a as ye}from"./chunk-WST3WRLT.js";import{a as et,c as be,d as F}from"./chunk-KQ6OPOXD.js";import{a as Ne}from"./chunk-DEJA7CK3.js";import{a as Ct}from"./chunk-XDEC3ZLT.js";import{b as tt}from"./chunk-RGPNT5G7.js";import{B as _e,b as pe,l as Y}from"./chunk-Q7DF5H6O.js";import{d as ue,g as fe}from"./chunk-BNS5ABAB.js";import{b as gt}from"./chunk-TF4QEXO7.js";import{n as ne,o as ae}from"./chunk-7HYQ2DGP.js";import{e as xt}from"./chunk-SYOIP55B.js";import{c as de}from"./chunk-EBRJSEEJ.js";import{c as Tt}from"./chunk-OOYDFTEF.js";import{f as yt}from"./chunk-DK5VLY7L.js";import{b as me}from"./chunk-7MCLPJAH.js";import{j as ie,n as le,o as ce}from"./chunk-YGMRSF47.js";import{a as _t}from"./chunk-GCS2RK7E.js";import{u as b}from"./chunk-FGAB46RQ.js";import{o as re}from"./chunk-Z62JX42S.js";import{Na as oo}from"./chunk-2QHGKEME.js";import{a as ro}from"./chunk-6PA65BO3.js";import{_ as Q,c as X,ia as ee}from"./chunk-WU2LB6XB.js";import{b as se}from"./chunk-GLL4BXR6.js";import{j as oe,q as eo}from"./chunk-NUN72MDU.js";import{c as L}from"./chunk-HMTT52FG.js";import{b as q,c as zt}from"./chunk-GR7YC6C3.js";import{E as J,J as Vt}from"./chunk-O33H5V3V.js";import{Ub as $,_b as $t,a as vt,b as Qe,bc as Kt,dc as K,ic as Xt,kc as Qt,na as Gt,nb as Zt,nc as te,ob as qt,tb as Jt}from"./chunk-COF7YKSN.js";import{A as p,K as Z,o as S}from"./chunk-VZKEX7KP.js";import{H as Ht,d as Rt,o as jt}from"./chunk-BJKBO23H.js";import{I as Yt,va as to}from"./chunk-XFTQD4B2.js";import{b as U}from"./chunk-73B6GL3S.js";import{f as N,o as m,q as d}from"./chunk-Y5OH3DDZ.js";m();d();var t=N(U()),He=N(oo()),ze=N(ro()),ot=N(re());to();Z();eo();te();Jt();$t();m();d();var A=N(U());Z();$t();m();d();var ke={list:"_list_b7lh5_1"};var so=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let f=ue(e),I=_=>{let{addressType:y,address:g,canTransferAmount:w}=_;return A.default.createElement(xt.Card,{selected:n?.address===g,onClick:()=>{i?.(),u?.(_)}},A.default.createElement(L.Box,{style:{width:"100%"}},A.default.createElement(L.FlexBox,{justify:"space-between",align:L.ALIGN.center},A.default.createElement(b.Text,{strong:!0},p($[y])),A.default.createElement(b.DisplayAmount,{strong:!0,mode:b.CRYPTO,decimals:f?.decimals,precision:f?.displayPrecision,isStableCoin:f?.stableCoin},w)),A.default.createElement(L.FlexBox,{justify:"space-between",align:L.ALIGN.center},A.default.createElement(b.Address,{address:g,desensitize:!0,copyable:!1,size:b.SIZE.sm,type:b.TYPE.secondary}),A.default.createElement(b.Text,{type:b.TYPE.secondary,size:b.SIZE.xs},p("extension_wallet_available_coin_balance",{coin:f?.symbol})))))};return A.default.createElement(jt,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:p("btcnft_gas_title_pay_gas_with"),onClose:i},A.default.createElement(xt,{space:16,dataSource:o,renderItem:I,className:ke.list}))},Se=so;m();d();Qe();var Pe=N(U());var no=()=>(0,Pe.useCallback)(({value:e,message:n,reportParams:a})=>{try{vt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Be=no;m();d();var R=N(U());te();zt();Vt();function ao(e,n,a,i){let[o,u]=(0,R.useState)(a),[f,I]=(0,R.useState)([]);return(0,R.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let y=await J(q.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:Xt(i.chainId)});I(y?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:f.length>0}}var Oe=ao;m();d();var We=N(U());Z();var io=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u,addressCheckError:f=""})=>({tipMessageProps:(0,We.useMemo)(()=>e?{type:F.TIP_TYPE.COMMON_ERROR,message:p("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:F.TIP_TYPE.COMMON_ERROR,message:p("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:F.TIP_TYPE.FEE_ERROR}:i?o?{type:F.TIP_TYPE.COMMON_ERROR,message:p("wallet_info_dialog_dust_limit_individually")}:f?{type:F.TIP_TYPE.COMMON_ERROR,message:f}:{type:Rt.TYPE.warn,message:u}:{type:ee.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u,f])}),Ue=io;m();d();var De=N(re());Vt();zt();var lo=e=>{let{loading:n,data:a}=(0,De.useRequest)(async()=>(await J(q.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},Me=lo;m();d();var At=N(U());Z();Jt();var co=7*1e3,mo=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Gt})=>{let u=ie(e),f=(0,At.useMemo)(()=>{let g=se(o);return u?.addressType?.[g]||[]},[u?.walletId]),[I,_]=Ce({coinId:n,walletId:e,satBytes:a,addressList:f?.map(({address:g})=>g),needFilteredUtxo:i},{pollingInterval:co,ready:!!i?.length&&!!a}),y=(0,At.useMemo)(()=>f.map((w,x)=>({...w,canTransferAmount:_[x]}))?.sort((w,x)=>{let rt=S.sub(x.canTransferAmount,w.canTransferAmount);return Number(rt)}),[_,f]);return[I,y]},ve=mo;m();d();var It={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var Ye={Ordinals:"Ordinals",Atomicals:"Atomicals"},Re=2,je="NFT",uo=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=de({localType:a})?.coinId;o===void 0&&(o=qt(a));let[u,f]=fe(o),I=ce(n),_=e.params.transfer.from,y=e.params.transfer.to,{feeRate:g}=e.params.transfer.options||{},w=Be(),[,x]=ye({coinId:o,address:_,chainId:u?.chainId}),rt=x?.transferReminder,[ht,j]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[E,Nt]=(0,t.useState)(g&&typeof g=="number"?{satBytes:g,level:Q.CUSTOM}:{satBytes:x?.normal,level:Q.STANDARD});(0,t.useEffect)(()=>{!E?.satBytes&&x?.normal&&Nt({satBytes:x?.normal,level:Q.STANDARD})},[x,E]);let H=e.params.transfer.data,P=Array.isArray(H)&&H.length>1,{isDustLoading:bt,dustError:st}=Oe(y,H,P,f),[,l]=Me(H),D=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:r}]=l||[];if(r===Ye.Atomicals)return K.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[l]),[Lt,B]=ve({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:E?.satBytes}),[s,at]=(0,t.useState)({}),[it,{toggle:Ve}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let r=B?.[0];if(Yt(s)&&!!r&&r?.canTransferAmount&&at(r),B&&s.address&&s?.canTransferAmount){let c=B.find(({address:C})=>C===s?.address);c||w({value:c,reportParams:{payWallet:s,payWallets:B},message:`payWallet address get ${c}`}),c&&at(c)}},[w,s,B]);let M=(0,t.useMemo)(()=>l.map(r=>{let{tokenId:c,protocol:C}=r,{txId:v,outputIndex:G,outputValue:Xe}=r?.btcNftUtxoDetail||{},Mt={txHash:v,nftId:r.tokenId,status:1,address:_,vout:Number(G),coinAmount:Number(Xe),resourceUrl:r?.resourceUrl};return C===Ye.Atomicals&&Object.assign(Mt,{data:[{atomicalId:c,type:je,amount:1}]}),Mt}),[_,l]),wt=(0,t.useMemo)(()=>l.map(r=>{let c=r?.tokenId,{outputValue:C}=r?.btcNftUtxoDetail||{},v=Number(C);P||(v=S.lt(C,546)?546:Number(C));let G={amount:v,address:y};return D===K.ARC_20&&Object.assign(G,{data:[{atomicalId:c,type:je,amount:1}]}),G}),[P,l,D,y]),lt=(0,t.useMemo)(()=>{if(!P){let{outputValue:r=0}=l?.[0]?.btcNftUtxoDetail||{};if(r<546)return S.sub(546,r)}return 0},[P,l]),[ct,T,z]=Ie({coinId:o,protocolId:D,toAddr:y,coinAmount:lt,fromAddr:s?.address,satBytes:E?.satBytes,utxoParams:{satBytes:E?.satBytes,needFilteredUtxo:nt},canTransferAmount:s?.canTransferAmount,inputs:M,outputs:wt},{ready:!!M?.length}),mt=P?X.BTC_NFT_BULK_SEND:X.SEND_NFT,Et=he({coinId:o,walletId:n,protocolId:D,coinAmount:0,toAddr:y,fromAddr:_,changeAddr:s?.address,localType:u?.localType,dustSize:D===K.ARC_20?void 0:x?.minOutput,networkFee:T,satBytes:E.satBytes,inputs:M,outputs:wt}),dt=l.map(({tokenId:r})=>r),Ge=JSON.stringify({nftIds:dt,from:_,to:y,serviceCharge:T,gasFrom:s?.address}),Ft=_e({coinId:o,txType:mt,walletId:n,coinAmount:"0",fromAddr:_,toAddr:y,networkFee:T,localType:u?.localType,extJson:Ge,txSource:Kt.NFT}),kt=xe({coinId:o,walletId:n,address:s.address,utxoType:Te.TRANSFER,satBytes:E?.satBytes,needFilteredUtxo:nt}),h=(0,He.useDispatch)(),O=(0,ze.useHistory)(),St=Ae({coinId:o,txType:X.SEND_NFT,protocolId:Qt(u?.chainId),address:s.address}),ut=l?.length,Ze=(0,t.useMemo)(()=>(l?.slice(0,it?ut:Re)).map(({resourceUrl:c,name:C})=>({title:C,icon:{src:c}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(s?.canTransferAmount&&S.lt(s?.canTransferAmount,S.add(T,lt))),[T,lt,s?.canTransferAmount]),qe=le(n),[Je,ft]=(0,t.useState)(!1),V=(0,t.useCallback)(async()=>{e.id?(await h(ne(e.id)),await h(gt()),await oe(h)):(h(yt()),W?O.goBack():O.replace(_t)),ft(!1)},[h,O,W,e.id]),{addressCheckLoading:Pt,addressCheckError:pt}=Fe({from:_,chainIndex:Zt(a),handleCancel:V,method:e.method}),{tipMessageProps:$e}=Ue({isHardware:I,feeError:z,isSufficientGas:W,dustError:st,transferReminder:rt,addressCheckError:pt}),Bt=(0,t.useCallback)(async()=>{let r=await kt(0,T);await St([...M,...r],V),ft(!0);let c=await Et({utxoList:[],utxos:[{address:s.address,inputs:ge(r)}]}),C=await pe(u?.localType,c);try{e.id?(await h(ae(e.id,{coinId:o,txHash:C,signedTx:c,serviceCharge:T,gasFrom:s.address,txType:mt,nftIds:dt})),await h(gt())):(await Ft(c),h(yt()),Ht.success({title:p("wallet_transfer_notif_transaction_submit")})),O.push(_t)}catch{}finally{ft(!1)}},[V,St,u?.localType,h,T,kt,O,W,dt,s.address,Ft,Et,M,mt,e.id]),{loading:Ot,onClick:Wt}=Ct(Bt),{loading:Ut,onClick:Dt}=Ct(V),Ke=(0,t.useMemo)(()=>{let r={actionType:Y.ACTION_TYPE.CANCEL,btnText:p("wallet_dapp_connection_btn_reject"),onClick:Dt,loading:Ut},c={disabled:Lt||ct||z||I||!Number(T)||!l?.length||bt||st||pt,actionType:Y.ACTION_TYPE.CONFIRM,onClick:Wt,loading:Ot||Pt};return W||(c={coinId:o,walletId:n,address:s?.address,actionType:Y.ACTION_TYPE.FILL_UP}),[r,c]},[Lt,ct,z,I,T,l?.length,Bt,W,e.id,h,O,o,n,s?.address,bt,st,Ut,Ot,Dt,Wt,Pt,pt]);return t.default.createElement(L.Box,null,t.default.createElement(et,null,t.default.createElement(be,{space:24,title:p("wallet_extension_send_colored_send"),summaryList:Ze}),ut>Re&&t.default.createElement(L.FlexBox,{justify:"center",className:It["nft-transfer__extend"],onClick:Ve},t.default.createElement(Tt,{size:Tt.SIZE.xs,className:It["nft-transfer__icon"],icon:it?"okx-wallet-plugin-arrow-small-up":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(et,null,t.default.createElement(tt,{walletId:n,address:_,title:p("extension_send_mid_text_from")}),t.default.createElement(tt,{address:y,title:p("extension_send_mid_text_to")})),t.default.createElement(et,null,t.default.createElement(Ne,{coinId:o,loading:ct,estimateFailed:z,networkFee:T,onClick:()=>{j({networkFee:!0})}}),t.default.createElement(tt,{copyable:!1,address:s?.address,addressType:s?.addressType,title:p("btcnft_gas_label_pay_gas_with"),tags:[p($[s?.addressType])],onClick:()=>{j({payWallet:!0})}},t.default.createElement(we,{coinBalance:s.canTransferAmount,coinId:o}))),t.default.createElement(Se,{coinId:o,value:s,options:B,visible:ht.payWallet,onChange:at,onToggleVisible:()=>{j({payWallet:!1})}}),t.default.createElement(me,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(F,{coinId:o,...$e}),t.default.createElement(Y,{buttonGroup:Ke})),t.default.createElement(Le,{coinId:o,signInfo:x,visible:ht?.networkFee,value:E,estimatedFee:T,onChange:Nt,onToggleVisible:()=>{j({networkFee:!1})}}),t.default.createElement(Ee,{visible:qe&&Je}))},Kr=uo;export{Kr as a};
//# sourceMappingURL=chunk-LFKA2PUG.js.map
