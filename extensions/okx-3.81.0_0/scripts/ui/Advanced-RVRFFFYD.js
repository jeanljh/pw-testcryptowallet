import{a as qs,b as Re,c as Gs,d as Hs,e as Ks}from"./chunk-SK56UAUA.js";import{a as Ys}from"./chunk-KE4XREMT.js";import{a as Us,c as Qs,h as Vs,k as Lo}from"./chunk-BZ2IK5IM.js";import{i as Ws}from"./chunk-YI5V5HTO.js";import{a as Po,b as wo}from"./chunk-KDWSU3J6.js";import{a as fs,b as gs,e as Co,f as Io,g as _o,h as ys,i as bo,j as yo,k as Ro,l as Ms,m as Bs}from"./chunk-VCDDTW7H.js";import{c as Is,d as To,e as _s,f as Bt,g as ur,h as Ut,i as qt,j as ks,n as Ao,s as Ds}from"./chunk-UULU72LG.js";import"./chunk-3MTWCI34.js";import{h as So,n as ko,o as bs,p as mt}from"./chunk-VTMJYROY.js";import{a as it,c as As}from"./chunk-ARK47WR5.js";import{a as bt,b as Cs,c as go,f as Et,g as ye}from"./chunk-PFSPFZNW.js";import{c as Es,d as vs,i as pr,j as Eo,k as Ns,o as vo,q as mr,r as vt}from"./chunk-2JC6L37N.js";import{a as fo,b as cs,c as us,d as ve}from"./chunk-BF6TFHGA.js";import"./chunk-57F7LIJM.js";import"./chunk-7OXXN2FT.js";import{g as Rs,h as Ps,i as Ls,l as ws,t as pe,u as Fs,v as xs}from"./chunk-RK7WST36.js";import{g as Os}from"./chunk-7Q4IDC7V.js";import{a as ue,b as A}from"./chunk-F57QKCZQ.js";import{I as M,J as y,M as kt,Y as ss,d as Yn,l as ae,m as Zn}from"./chunk-HIVYZXF3.js";import"./chunk-JALTSNOZ.js";import{D as ce,_ as os,aa as ir,d as sr,l as lo,q as ts,z as es}from"./chunk-4Y52FA3V.js";import{b as O}from"./chunk-B6WLGAPL.js";import"./chunk-ZYYACLV7.js";import"./chunk-TQMC5UQS.js";import{a as Ss}from"./chunk-ANWN6BF6.js";import"./chunk-XNP3OGQC.js";import{a as is,c as as,e as Ee}from"./chunk-A2QIZMPL.js";import{a as Ft,b as xt,c as Mt,d as rs,e as be,f as ar,i as cr,w as ns,z as ho}from"./chunk-HKU7TMFJ.js";import{a as Kn}from"./chunk-YTR7GLCK.js";import{a as R,b as Ae,c as Jn}from"./chunk-7I4OPLNV.js";import{a as $}from"./chunk-WTUJ4OXT.js";import{b as ls,f as ds,g as hs}from"./chunk-J3UBL564.js";import{e as zn}from"./chunk-YMYQJ726.js";import{b as Qn,d as Nt,e as Vn,f as St,g as Wn,h as Hn,i as ke,j as mo,l as jn,q as Xn,r as $n,t as se,u as Dt,w as ie}from"./chunk-FGRS6VIX.js";import{$a as mn,B as E,C as oe,Cb as X,D as re,Db as G,E as on,G as Ot,H as Jo,Ia as or,Jc as On,K as io,Ka as an,Kc as Nn,La as cn,Lb as po,Lc as Dn,M as q,Mb as F,N as ht,O as Ct,Pb as ne,Q as Zo,Qc as Fn,R as rn,S as ft,Sc as xn,T as ao,Ta as rr,Tc as Mn,Ua as un,Va as It,Wc as Bn,X as tr,Xc as Un,Y as U,Z as st,Za as pn,_c as qn,a as Je,ab as ln,b as Ze,c as Ce,cc as hn,d as to,dc as fn,e as eo,ec as Sn,f as Ie,fa as co,fc as gn,g as zo,ga as pt,gc as Tn,h as oo,ha as uo,hc as Cn,i as ee,ia as Z,ic as In,id as Gn,j as zr,ja as ot,jc as _n,k as _e,ka as nn,kc as An,l as Jr,lc as kn,o as H,p as ro,q as K,qb as dn,qc as bn,rb as nr,rc as En,s as Zr,sc as vn,t as x,tb as C,u as no,v as tn,vc as yn,vd as f,w as en,wa as er,wc as Rn,xa as sn,xc as Pn,yc as Ln,z as so,zc as wn}from"./chunk-INIQCRIO.js";import{b as ps,h as ms}from"./chunk-2P6PTKAN.js";import{a as b,b as Ts,c as B}from"./chunk-ZFBXO46L.js";import{a as I}from"./chunk-6Z5HVUBK.js";import{G as v,S as Yr,T as te,U as $e,V as Kr,W as jr,X as Xr,b as Ye,ba as ze,ca as $r,d as Ke,da as W,f as ut,g as _t,h as At,j as nt,k as je,l as w,m as dt,n as Xe}from"./chunk-ZBDGRK4Q.js";import"./chunk-XIYYKWE3.js";import"./chunk-GN2NRAOV.js";import"./chunk-SFFRTMXL.js";import"./chunk-RLY3NWVP.js";import"./chunk-U3KULTRT.js";import"./chunk-55T2IW2N.js";import"./chunk-WVUOJIBP.js";import"./chunk-JBROAQ6E.js";import"./chunk-LBCITKCK.js";import"./chunk-O4O5AL3V.js";import"./chunk-HAHRUU64.js";import"./chunk-B624VS3G.js";import{a as Zt}from"./chunk-6PA65BO3.js";import"./chunk-VZKEX7KP.js";import"./chunk-QCEQQDCM.js";import{H as $o,I as J,k as Hr}from"./chunk-BJKBO23H.js";import"./chunk-IO3ALUOJ.js";import"./chunk-JLNZTUPO.js";import"./chunk-MSZOM4GC.js";import"./chunk-BYVN72KS.js";import"./chunk-ZUJLXC72.js";import{F as Br,I as et,K as Ur,P as Jt,W as qr,X as Gr,Z as Qr,aa as We,c as z,ea as He,f as rt,h as Tt,i as Ko,j as S,ka as jo,ma as Xo,pa as Vr,s as xr,ta as Te,va as P,x as Mr,z as Ve}from"./chunk-XFTQD4B2.js";import"./chunk-DIZF7D6Q.js";import"./chunk-SEAUBLKM.js";import"./chunk-DHKS44RQ.js";import"./chunk-4DBVFCYR.js";import"./chunk-2IGQWLAB.js";import"./chunk-GVV6OTQP.js";import{z as wt}from"./chunk-ZFVABNQN.js";import"./chunk-VYWNZTTM.js";import{f as Wr}from"./chunk-LBWWOQL4.js";import{a as ra}from"./chunk-4QGZDIBD.js";import{b as V}from"./chunk-73B6GL3S.js";import"./chunk-LVJGLJNA.js";import"./chunk-FYJQM2AY.js";import"./chunk-5F7M5EJ4.js";import"./chunk-OJXBW2YQ.js";import"./chunk-C5XO4JMZ.js";import"./chunk-HI3LE734.js";import"./chunk-RX4V72AK.js";import{f as N,h as n,o as p,q as m}from"./chunk-Y5OH3DDZ.js";p();m();var Yo=N(V()),oa=N(Zt());p();m();var Xs=N(V());p();m();var Oo=N(V());var js=({children:a,rootStore:t})=>{let e=Ts(t),o=(0,Oo.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return Oo.default.createElement(e.Provider,{value:o},a)};var $s=dt(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),s=o||r,i=a.getInstance();return s===F.BRIDGE&&(i=t.getInstance()),Xs.default.createElement(js,{rootStore:i},e)});p();m();var Do=N(V());p();m();p();m();var Pe=N(V()),zs=N(Zt());var na=()=>{let a=R.get(rr);if(a){if(R.remove(rr),a.startsWith(Kr))return It.MEME_BUY;if(a.startsWith(ot))return It.BRIDGE;if(a.startsWith(Z))return It.SWAP}return R.get(un)||It.SWAP},sa=a=>({[It.SWAP]:Z,[It.BRIDGE]:ot,[It.MEME_BUY]:jr,[It.MEME_SELL]:Xr})[a]||Z,ia=a=>{switch(a){case uo:case Z:return F.SWAP;case ot:return F.BRIDGE;default:return""}},Js=()=>{let{pathname:a}=(0,zs.useLocation)(),{params:t,replace:e}=pe(),{autoSwitch:o,from:r}=t,[s,i]=(0,Pe.useState)(""),[c,u]=(0,Pe.useState)(!0);return(0,Pe.useEffect)(()=>{let l=na(),d=sa(l);if(o===mr.BRIDGE&&!r.tokenContractAddress&&d!==a){e({pathname:d,params:{...t,autoSwitch:void 0}});return}let h=ia(a);h&&(async()=>{if(h===F.SWAP&&o===mr.BRIDGE){let _=await vt.judgeTabTypeByParams(t?.from,t?.to);_===F.BRIDGE&&e({pathname:ot,params:{...t,autoSwitch:void 0}}),i(_),u(!1)}else i(h),u(!1)})().catch(()=>{})},[a,o,r]),{tabType:s,autoSwitching:c}};p();m();var lr=N(V());var Zs=(a,t)=>{let{accountStore:e}=B(),{params:o}=pe(),{addressType:r}=o;(0,lr.useEffect)(()=>{e.setAddressType(r)},[]);let s=Fs();(0,lr.useEffect)(()=>{async function i(){let c=new vt(a,o),{from:u,to:l,tab:d,inputAmount:h,error:T}=await c.initTokenPair(t);T||s(u,l,h,d)}a&&i().catch(()=>{})},[a])};p();m();var ti=N(V()),ei=N(Zt());var oi=a=>{let{fromToStore:t}=B(),{from:e,to:o}=t,{params:r,replace:s}=pe(),{pathname:i}=(0,ei.useLocation)(),c=xs();(0,ti.useEffect)(()=>{let u=c(e,o);u&&a&&[Z,ot].includes(i)&&(new vt(a).writeTabInfoToLocalStorage(u),s({params:{...u,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,i])};var aa=a=>{let{tabType:t}=Js();Zs(t,a),oi(t)},ri=aa;p();m();var si=N(V());p();m();function ca(a){return new Promise(t=>setTimeout(t,a))}async function me(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(s){o=s,e&&r<t-1&&await ca(e)}throw o}function ua(a,t,e){let o=kt();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function pa(a,t,e){if(pt())return ua(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort(),abortController:o}}function ni(a,t){return pa(A.get,a,t)}function ii(){let{accountStore:a,receiveAddressStore:t}=B(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:s}=t,{specifiedAddress:i}=r||{};(0,si.useEffect)(()=>{let c=()=>{};if(e&&s){let{promise:u,cancel:l}=ni(Fn,{params:{userWalletAddress:e,receiveWalletAddress:i}});c=l,u.then(d=>{o(d?.data.blackListTypes||io)}).catch(()=>{o(io)})}else o(io);return c},[e,o,i,s])}p();m();var ai=N(V());function dr(){let{accountStore:{address:a}}=B();(0,ai.useEffect)(()=>{y.setTags({address:a})},[a])}p();m();var hr=N(V());P();var ma=()=>{let{quoteStore:a,accountStore:t,fromToStore:e,approveStore:o,recentTransactionStore:r,tokenModalStore:s}=B(),{computedAccountWalletAddresses:i}=t;(0,hr.useEffect)(()=>{let c=()=>{};return i&&(c=cs(i)),()=>{c?.()}},[i]),(0,hr.useEffect)(()=>{let c=fo({isPri:!0,needLogin:!0,subscribeParams:[{channel:ve.DEX_PUSH_ENGINE},{channel:ve.WALLET_ASSET}],onListenError:()=>{let u=S(a,"quote.bestRoute"),l={token:e.from,defiPlatformId:$.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,u),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{a.fetchQuote()}};o.onSocketError(l),r.onSocketError(),e.setNeedBalanceLoading(!1),e.getSwapTokenBalance(),s.reloadTokenList()},onListenData:(u,l)=>{if(!!u){if(l?.channel===ve.DEX_PUSH_ENGINE){r.onSocket(u);let d=S(a,"quote.bestRoute"),h={token:e.from,defiPlatformId:$.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,d),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{a.fetchQuote()}};o.onSocket({data:u,...h});return}l.channel===ve.WALLET_ASSET&&(s.updateAllTokenList(u),e.updateFromBalancePush(u))}}});return()=>{c?.()}},[r.onSocket,s.updateAllTokenList,e.updateFromBalancePush,t,a,r,s,e])},ci=ma;p();m();var fr=N(V());P();var ui=({token:a,onListenData:t=rt,globalPrice:e})=>{(0,fr.useEffect)(()=>{!Dt(a)||Ee(a,e)&&t(e)},[e,a?.chainId,a?.tokenContractAddress]),(0,fr.useEffect)(()=>{if(!Dt(a))return rt;if(Ee(a,e))return rt;let o=fo({subscribeParams:{channel:us.DEX_MARKET_TX_CHANNEL,chainId:String(a.chainId),tokenAddress:a.tokenContractAddress},onListenData:r=>{t(r?.[0]||{})},onListenError:rt});return()=>{o()}},[a?.chainId,a?.tokenContractAddress])},la=()=>{let{fromToStore:a={},commonMarketStore:t={}}=B(),{from:e,updateFromUsdPriceFromWs:o,to:r,updateToUsdPriceFromWs:s}=a,{globalPrice:i}=t;ui({token:e,onListenData:o,globalPrice:i}),ui({token:r,onListenData:s,globalPrice:i})},pi=la;p();m();var yt=N(V()),mi=N(Zt());Yn.setDataProxy(A);var da=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:s,t:i,dispatch:c,currentTab:u,onBack:l})=>{let{commonStore:d,accountStore:h,recentTransactionStore:T,reset:_}=B(),k=(0,mi.useHistory)();(0,yt.useEffect)(()=>{W.setRuntimeContext({history:k,toLocale:i,dispatch:c,walletInfo:e,onBack:l})},[i,k,c,e,l]),(0,yt.useEffect)(()=>(t&&(W.updateGlobal({currentWallet:t}),h.setWalletConfig(t)),()=>{h.cleanWalletConfig()}),[t]),(0,yt.useEffect)(()=>(d.getUserUnit(a),d.fetchChainList({businessLine:1,currentTab:u}).catch(()=>{d.setChainListLoadError(!0)}),()=>{_()}),[]),(0,yt.useEffect)(()=>{h.setAddressBookList(r)},[r]),(0,yt.useEffect)(()=>{h.setWalletList(s)},[s]),(0,yt.useEffect)(()=>{h.setKeyringIdentityTypeEnum(o)},[o]),(0,yt.useEffect)(()=>{t.walletId?T.updatePendingOrders(t.walletId):T.setPendingOrders([])},[t.walletId,u]),Us()},li=da;p();m();var j=N(V()),Rt=N(Zt());p();m();var le=N(V()),No=N(Zt()),gi=N(ra());p();m();var di=N(V());var ha=()=>{let{fromToStore:a}=B(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return di.default.createElement(qs,{visible:t,params:e,onBack:()=>{o()}})},hi=dt(ha);p();m();var fi=N(V());var Si=()=>{let{fromToStore:a}=B(),{closeAddFunds:t}=a;(0,fi.useEffect)(()=>{t()},[])};var fa=[Z,ot],Sa=({children:a,onBack:t})=>{let{showNavigator:e,title:o}=Gs(),r=(0,No.useLocation)(),s=(0,No.useHistory)(),{isTelegramMiniApp:i}=W.global,{Navigator:c}=W.components,u=r.pathname.includes(te);Si();let l=()=>{u&&ce({...mt(),button_name:"back"}),t?t(s.goBack,fa.includes(r.pathname)):s.goBack()},d=()=>i?Re.telegramContainer:e?Re.extensionContainer:Re.extensionContainerNoHeader,{recentTransactionStore:h}=B(),{dialogVisible:T,dialogOrderId:_,closeDialog:k}=h;return le.default.createElement("div",{className:(0,gi.default)("universe-swap background-base-primary",Re.wrapper)},e?le.default.createElement(c,{asPage:!0,title:o,onBack:l,closeable:!1}):null,le.default.createElement("div",{className:d()},a),le.default.createElement(hi,null),le.default.createElement(Bs,{orderId:_,visible:T,onClose:k}))},Ti=dt(Sa);var ga=(0,j.lazy)(()=>import("./Swap-3JJMAWSV.js")),Ta=(0,j.lazy)(()=>import("./Bridge-YGJUTPHS.js")),Ca=(0,j.lazy)(()=>import("./OrderDetail-MOXL3733.js")),Ia=(0,j.lazy)(()=>import("./Contract-TSRH5EZZ.js")),_a=(0,j.lazy)(()=>import("./Approve-DKJ3OTC5.js")),Aa=(0,j.lazy)(()=>import("./Solana-QESH7ZX4.js")),ka=(0,j.lazy)(()=>import("./Claim-DO7OL3YU.js")),ba=({onBack:a})=>{let t=(0,Rt.useLocation)();return j.default.createElement(Ti,{onBack:a},j.default.createElement(j.Suspense,null,j.default.createElement(Rt.Switch,null,[{path:Z,component:ga,exact:!0},{path:ot,component:Ta,exact:!0},{path:Yr,component:Ca,exact:!0},{path:te,component:Ia,exact:!0},{path:$e,component:_a,exact:!0},{path:ze,component:Aa,exact:!0},{path:$r,component:ka,exact:!0}].map((o,r)=>j.default.createElement(Rt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),j.default.createElement(Rt.Redirect,{from:uo,to:{pathname:Z,search:t.search},strict:!0,exact:!0}))))},Ci=ba;var Ea=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:s,onBack:i,t:c,dispatch:u,currentTab:l=F.SWAP})=>{ri(s.chainId),li({currency:a,currentWallet:t,walletInfo:s,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:u,currentTab:l,onBack:i}),ii(),ci(),dr(),pi();let{initialized:d}=Ds();return d?Do.default.createElement(Ci,{onBack:i}):null},Ii=(0,Do.memo)(dt(Ea));p();m();p();m();p();m();var Le=class{constructor(){this.isSwapLoading=!1;this.setSwapLoading=t=>{this.isSwapLoading=t};this.checkCancelLimitOrder=async()=>{};w(this)}};p();m();P();var we=class{constructor(t){n(this,"checkTokenValid",async t=>{if(!Dt(t))return!1;let[e,o]=await v(A.get(qn,{params:We(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,w(this,{},{autoBind:!0})}};var Gt=class{constructor(){Gt.instance?(this.commonStore=Gt.instance.commonStore,this.accountStore=Gt.instance.accountStore,this.checkTokenStore=Gt.instance.checkTokenStore,this.limitOrderConfirmStore=new Le(this)):(this.commonStore=new ks(this),this.accountStore=new _s(this),this.checkTokenStore=new we(this),this.limitOrderConfirmStore=new Le(this),Gt.instance=this)}},Qt=Gt;n(Qt,"instance",null);p();m();P();p();m();P();p();m();var Fo="NO_CHECK",Pt="0",Hp="0x".padEnd(66,"f");var Sr=class{constructor(){this.approveTokenDefaultConfig={status:E.Unknown,approvedAmount:Pt,tagStatus:E.Unknown,successCallback:void 0,isCombineApproveAndSwap:!1,transactionHash:void 0,approveInfo:null};this.approveTokensConfig={};this.bridgeApproveSocketError=!1;this.getApproveTokenMapKey=(t,e)=>{let o=as(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=S(this.approveTokensConfig,o);et(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),s=S(this.approveTokensConfig,r),i=et(s),c=s||this.approveTokenDefaultConfig;this.approveTokensConfig={...this.approveTokensConfig,[r]:{...c,...o}},i&&y.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return S(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=Gr(this.approveTokensConfig,e=>[E.Approving,E.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.getApprovalStatus=(t,e)=>this.getApproveTokenConfig(t,e).status;this.isApprovalCheckRequired=(t,e,o)=>{let{isNativeToken:r}=t;return(e?!0:o==="1")&&!r&&!ds(t.chainId)&&!hs(t.chainId)};this.validApproveAmountLessSwapAmount=(t,e)=>new I.BigNumber(t).isLessThan(e||Pt);this.isValidApprovalStatus=(t,e,o)=>{let r=Qn(t),s=this.validApproveAmountLessSwapAmount(t,e);return r?E.UnApproved:s&&o?E.CancelApprove:s?E.UnApproved:E.Approved};this.fetchApproveAllowance=async(t,e,o,r,s,i)=>{let c=()=>A.get(yn,{params:{userWalletAddress:e,tokenContractAddress:t.tokenContractAddress,chainId:t.chainId,defiPlatformIds:o}}).then(d=>d?.data),u=await c();return r&&u&&typeof u=="object"&&Object.keys(u).length>0&&Object.values(u).every(d=>d?.amount===Pt)?(y.info(M.APPROVE_RETRY,{approveEventType:i,fromAmount:t.amount,defiPlatformId:s,isCrossChain:!1}),c()):u};this.getApproveUrl=t=>t?{approveDataUrl:Pn,saveApproveUrl:wn}:{approveDataUrl:Rn,saveApproveUrl:Ln};this.parseApproveTxInfo=({approveTxInfo:t,params:e})=>{let{isCrossChain:o,...r}=e,{id:s,data:i,from:c,to:u,unsignedTx:l,gas:d,gasPrice:h,maxFeePerGas:T,maxPriorityFeePerGas:_,type:k,nonce:D}=t||{},L={data:i,from:c,to:u};e.teeSilentSignEnabled&&(L={...L,gas:d,gasPrice:h,maxFeePerGas:T,maxPriorityFeePerGas:_,type:k,nonce:D},L=gs(L));let Q={txSource:3};return ls(e.chainId)&&(L=JSON.parse(l),He(Q,"orderId",s)),o&&He(L,"extParams",Q),y.info(M.APPROVE_DATA,{id:s,transactionPayload:L,unsignedTx:l,cancelApproveTag:r.cancelApproveTag}),{transactionPayload:L,id:s,defiPlatformId:r.defiPlatformId}};this.fetchApproveData=({approveDataUrl:t,params:e,approveTxInfo:o})=>{if(o)return this.parseApproveTxInfo({approveTxInfo:o,params:e});let{isCrossChain:r,...s}=e;return A.get(t,{params:s}).then(i=>this.parseApproveTxInfo({approveTxInfo:i?.data,params:e}))};this.isApprovalStatusPending=(t,e)=>{let o=this.getApprovalStatus(t,e);return[E.Approving,E.CancelApproving].includes(o)};this.isCancelApproveStatus=(t,e)=>{let o=this.getApprovalStatus(t,e);return[E.CancelApprove,E.CancelApproving].includes(o)};this.isPendingNeedCheck=async t=>{this.isApprovalStatusPending(t.token,t.defiPlatformId)&&this.checkApprove({...t,needRetry:!0}).catch(()=>{})};this.isPendingNotCheck=async t=>{this.isApprovalStatusPending(t.token,t.defiPlatformId)||this.checkApprove({...t,needCheck:Fo}).catch(()=>{})};this.bridgePendingNotCheck=async t=>{(!this.isApprovalStatusPending(t.token,t.defiPlatformId)||this.bridgeApproveSocketError)&&(await this.checkApprove({...t,isCrossChain:!0,needCheck:Fo}),this.bridgeApproveSocketError=!1)};this.updateUnnecessaryApproveTokenStatus=(t,e)=>{e.forEach(o=>{this.registerApproveToken(t,o),this.updateApproveTokenConfig(t,o,{status:E.Approved,tagStatus:E.UnApproved})})};this.updateApproveConfigByAllowance=({allowanceData:t,token:e,defiPlatformId:o,needCheck:r})=>{if(!t||et(t)){this.updateApproveTokenConfig(e,o,{status:E.Unknown,approvedAmount:Pt,tagStatus:E.Unknown});return}r===Fo&&this.isApprovalStatusPending(e,o)||Object.keys(t).forEach(s=>{let i=t[s];this.calcApproveState({approveInfo:i,token:e,defiPlatformId:s})})};this.checkApprove=async({token:t,userWalletAddress:e,needApprove:o,defiPlatformIds:r,defiPlatformId:s,allowanceData:i={},needCheck:c="",isLimitOrder:u=!1,isCrossChain:l=!1,needRetry:d=!1,approveEventType:h})=>{if(!this.isApprovalCheckRequired(t,u,o)){this.updateUnnecessaryApproveTokenStatus(t,r);return}let{tokenContractAddress:T}=t;if(T&&e){if(!l){let[,_]=await v(this.fetchApproveAllowance(t,e,r,d,s,h));this.updateApproveConfigByAllowance({allowanceData:_,token:t,defiPlatformId:s,needCheck:c});return}this.updateApproveConfigByAllowance({allowanceData:i,token:t,defiPlatformId:s,needCheck:c})}};this.calcApproveState=({approveInfo:t,token:e,defiPlatformId:o})=>{let{decimals:r}=e,s=Number(t.status);if([E.Approving,E.CancelApprove].includes(s))return;let i=Number(t.status)===E.Approved?t.amount:Pt,c=mo(i,r)||Pt,u=t?.needCancelApproveToken,l=this.isValidApprovalStatus(c,e.amount||Pt,u);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:l,tagStatus:l,approvedAmount:c,approveInfo:t})};this.updateApproveState=({token:t,defiPlatformId:e,userWalletAddress:o,needApprove:r="1"})=>{if(!Dt(t))return;let s=this.getApproveTokenConfig(t,e);s?.approveInfo?this.calcApproveState({approveInfo:s?.approveInfo,token:t,defiPlatformId:e}):this.isPendingNotCheck({token:t,userWalletAddress:o,defiPlatformId:e,needApprove:r})};this.fetchApproveDataErrorTips=(t,e,o)=>{this.updateApproveTokenConfig(t,e,{status:E.UnApproved});let r=O(t?.tokenSymbol);Eo({title:o?f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:r}):f("swaptrade_toast_approve_fail",{tokenSymbol:r})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,defiPlatformId:s,cancelApproveTag:i})=>{y.error(M.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,defiPlatformId:s}),fs(t)||$o.error({title:f("swaptrade_home_toast_broadcast_failed"),placement:$o.DIRECTION.top}),this.updateApproveTokenConfig(r,s,{status:this.isCancelApprove(i)?E.CancelApprove:E.UnApproved})};this.isCancelApprove=t=>t===oe.CANCEL_APPROVE;this.setApprove=async({token:t,userWalletAddress:e,defiPlatformId:o,isCrossChain:r=!1,cancelApproveTag:s,approveAmount:i,approveTxInfo:c},{isSilentSign:u=!1,isCombineApproveAndSwap:l=!1,successCallback:d}={isSilentSign:!1})=>{let{chainId:h}=t;this.updateApproveTokenConfig(t,o,{status:this.isCancelApprove(s)?E.CancelApproving:E.Approving,isCombineApproveAndSwap:l,successCallback:d});try{let T={isCrossChain:r,userWalletAddress:e,tokenContractAddress:t.tokenContractAddress,chainId:t.chainId,defiPlatformId:o,cancelApproveTag:s,teeSilentSignEnabled:u};u&&!l&&(T.approveAmount=i);let{id:_,transactionPayload:k,defiPlatformId:D}=await this.fetchApproveData({approveTxInfo:c,approveDataUrl:this.getApproveUrl(r).approveDataUrl,params:T});await this.approveToken({chainId:h,transactionPayload:k},{isSilentSign:u}).then(async({result:L})=>{this.updateApproveTokenConfig(t,o,{transactionHash:L}),await this.saveApprove({id:_,chainId:h,transactionHash:L,userWalletAddress:e,isCrossChain:r,cancelApproveTag:s,defiPlatformId:D})}).catch(L=>{this.approveErrorTips({error:L,chainId:h,transactionPayload:k,token:t,defiPlatformId:D,cancelApproveTag:s})})}catch{this.fetchApproveDataErrorTips(t,o,s)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,userWalletAddress:r,isCrossChain:s,cancelApproveTag:i,defiPlatformId:c,refetchQuote:u})=>{if(!o)return;let l={id:t,transactionHash:o,chainId:e,userWalletAddress:r,cancelApproveTag:i};s&&He(l,"defiPlatformId",c),y.info(M.SAVE_APPROVE,l);let{saveApproveUrl:d}=this.getApproveUrl(s),[h]=await v(A.post(d,l));h&&y.info(M.SAVE_APPROVE_ERROR,{error:h?.message,...l}),s&&String(c)!==U&&u?.()};this.checkCurrentPushedApproveInfo=(t,e,o,r,s)=>{let{chainId:i,fromTokenAddress:c,platformId:u,defiPlatformId:l}=t,d=r?l:u,h={chainId:Number(i),tokenContractAddress:c},T=Ee(e,h),_=String(o)===String(d),k=t.transactionHash===s;return{isCurrentToken:T,isSamePlatform:_,isSameTransactionHash:k,pushedToken:h,pushedPlatformId:d}};this.handleCurrentPushedApproveToken=async({dexData:t,pushedPlatformId:e,token:o,isCrossChain:r,refetchQuote:s,userWalletAddress:i,needApprove:c,approveEventType:u})=>{if(!r)await this.isPendingNeedCheck({token:o,userWalletAddress:i,defiPlatformIds:[e],defiPlatformId:e,needApprove:c,approveEventType:u});else{let l={status:t.status,amount:t.approveAmount,needCancelApproveToken:t.needCancelApproveToken};this.calcApproveState({approveInfo:l,token:o,defiPlatformId:e}),s?.()}};this.onSocket=async({data:t,token:e,defiPlatformId:o,isCrossChain:r,refetchQuote:s},i)=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let c=t.dexData,{status:u,transactionHash:l,fromTokenSymbol:d,exploreUrl:h,solanaToast:T,userWalletAddress:_}=c,k=pt(),{isCombineApproveAndSwap:D,successCallback:L,transactionHash:Q}=this.getApproveTokenConfig(e,o),{isCurrentToken:tt,isSamePlatform:gt,isSameTransactionHash:at,pushedToken:ct,pushedPlatformId:Se}=this.checkCurrentPushedApproveInfo(c,e,o,r,Q);if(T==="1"){if(k)return;let Y=at&&D?"swaptrade_mid_dialog_toast_success_submitted":"swaptrade_transfer_notification_approval_submit";u===re.CANCEL_APPROVE_SUBMITTED&&(Y="swaptrade_transfer_toast_ccy_unrevoke_submit"),Ns({title:f(Y,{ccy:O(d)})});return}if(tt&&gt&&(y.info(M.APPROVE_SOCKET_SUCCESS,{fromAmount:e.amount,defiPlatformId:o,status:c.status,amount:c.approveAmount,needCancelApproveToken:c.needCancelApproveToken,isCrossChain:r}),await this.handleCurrentPushedApproveToken({dexData:c,pushedPlatformId:Se,token:e,isCrossChain:r,userWalletAddress:_,refetchQuote:s,needApprove:"1",approveEventType:"onSocket"})),(!tt||tt&&!gt)&&this.removeApproveTokenConfig(ct,Se),u===re.APPROVE_SUCCESS){let Y=f("swaptrade_toast_approve_success",{tokenSymbol:O(d)});!k&&pr({title:Y,exploreUrl:h}),vs.emit(Es.APPROVE,{data:l,status:0,message:Y}),at&&L?await L():i?.()}else if(u===re.APPROVE_FAILED&&!k){let Y=f("swaptrade_toast_approve_fail",{tokenSymbol:O(d)});Eo({title:Y,exploreUrl:h})}else if(u===re.CANCEL_APPROVE_SUCCESS&&!k){let Y=f("swaptrade_transfer_notification_title_ccy_revoked",{ccy:O(d)});at&&L&&await L(),pr({title:Y,exploreUrl:h})}else if(u===re.CANCEL_APPROVE_FAILED&&!k){let Y=f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:O(d)});Eo({title:Y,exploreUrl:h})}}};this.onSocketError=t=>{t.isCrossChain?this.bridgeApproveSocketError=!0:this.isPendingNeedCheck(t).catch(()=>{})}}approveToken(t,{isSilentSign:e}={isSilentSign:!1}){return Promise.resolve(t)}},_i=Sr;var Vt=class extends _i{constructor(e){super(e);n(this,"approveInfo",{});n(this,"setApproveInfo",e=>{this.approveInfo=e});n(this,"setApprove",async(e=oe.APPROVE)=>{let{fromToStore:o,quoteStore:r,accountStore:s}=this.rootStore,i=S(r,"quote.bestRoute"),c=$.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,i),u=o.from,{chainId:l,tokenContractAddress:d}=u,h=s.getAddressByChainId(l);this.updateApproveTokenConfig(u,c,{status:this.isCancelApprove(e)?E.CancelApproving:E.Approving});try{let{id:T,transactionPayload:_}=await this.fetchApproveData({approveDataUrl:this.getApproveUrl(o.computedIsCrossChain).approveDataUrl,params:{userWalletAddress:h,tokenContractAddress:d,chainId:l,defiPlatformId:c,cancelApproveTag:e}});this.setApproveInfo({chainId:l,id:T,transactionPayload:_,token:u,defiPlatformId:c,cancelApproveTag:e}),W.history?.push({pathname:$e})}catch{this.fetchApproveDataErrorTips(u,c,e)}});n(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),W.history?.goBack?.();let{fromToStore:o,quoteStore:r}=this.rootStore,s=S(r,"quote.bestRoute"),i=$.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,s),c=o.from;this.updateApproveTokenConfig(c,i,{status:this.isCancelApprove(e)?E.CancelApprove:E.UnApproved})});n(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{fromToStore:r,accountStore:s,quoteStore:i}=this.rootStore,{id:c,chainId:u,cancelApproveTag:l,defiPlatformId:d}=this.approveInfo;await this.saveApprove({id:c,chainId:u,transactionHash:e,userWalletAddress:s.getAddressByChainId(u),cancelApproveTag:l,defiPlatformId:d,isCrossChain:r.computedIsCrossChain,refetchQuote:()=>{i.fetchQuote()}}),W.history?.goBack?.(),this.setApproveInfo({})});it(this),this.rootStore=e}};p();m();P();p();m();var Ne=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:s}=b(),{from:i,to:c}=a,{receiveAddrObj:u}=e,{computedForbiddenBridge:l,address:d}=s,h=a.computedTypedValue&&a.computedTypedValue.endsWith(".")?a.computedTypedValue.slice(0,-1):a.computedTypedValue,_={...{chainId:i.chainId,toChainId:c.chainId,toTokenAddress:c.tokenContractAddress,fromTokenAddress:i.tokenContractAddress,amount:h,userWalletAddress:d},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:ie(l),dexIds:ie(ko?.computedDexIds),receiveWalletAddress:u?.specifiedAddress};return ae()?_:o.extendFeeConfig(_)},Lt=async()=>{let{fromToStore:a,accountStore:t}=b(),{from:e}=a,{computedSignWalletAddress:o}=t,r=await ss(o,e.chainId);return{...Ne(),refCode:Ws.refCode,...r}},Ai=()=>{let{quoteStore:a}=b();return{...Ne(),sort:a.bridgeSortType}},ki=()=>{let{quoteStore:a}=b(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:c,fromTokenAddress:u,toTokenAddress:l,amount:d}=Ne();return{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:c,fromTokenAddress:u,toTokenAddress:l,amount:d,bridgeId:e}};p();m();function va({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var xo=va;var bi=20,lt={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},gr=class{constructor(t){n(this,"quoteData",null);n(this,"preDataForSendBtc",null);n(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});n(this,"setQuoteData",t=>{this.quoteData=t});n(this,"quoteParams",async()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,s={...await Lt(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(s.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),s});n(this,"updating",!1);n(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let s={...await Lt(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},i=await e.extendSignParams(s),[c,u]=await v(A.post(`${Dn}`,i));if(this.updating=!1,xo({selector:"#wallet_scroll"}),c){J.error({title:c?.data?.msg||f("swaptrade_top_notif_data_failed")});return}let{callDataResult:l,quoteResult:d}=u?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:d}),l){let h=await this.getPreExecutionPayload({orderData:l,requestParams:i});ut(()=>{this.transactionPayload=h,this.orderId=l?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=ki();this.updating=!0;let[e,o]=await v(A.get(Bn,{params:{...t}}));if(this.updating=!1,xo({selector:"#wallet_scroll"}),e){J.error({title:e?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"updateSnapQuoteData",async()=>{let t=await Lt(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await v(A.get(xn,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,xo({selector:"#wallet_scroll"}),o){J.error({title:o?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:s}=r?.data||{};s&&this.rootStore.quoteStore.handleUpdateQuote({data:s}),this.initCountDown(),this.startCountdown()});n(this,"timer",null);n(this,"countdown",bi);n(this,"initCountDown",()=>{this.countdown=bi});n(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});n(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});n(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));n(this,"gasInfo",this.initGasInfo());n(this,"setGasInfo",t=>{this.gasInfo=t});n(this,"gasFee",0);n(this,"setGasFee",t=>{this.gasFee=t});n(this,"orderInfo",{});n(this,"transactionPayload",null);n(this,"orderId","");n(this,"solonaRent","");n(this,"getPreExecutionPayload",async({orderData:t,isSwapSolana:e,requestParams:o})=>{let{swapStore:r,quoteStore:s,fromToStore:i}=this.rootStore;r?.checkCallData?.({chainId:o?.chainId,responseData:t,isSingleChain:!0,requestParams:o}).catch(()=>{});let c=s?.quote?.bestRoute||{},{fromToken:u}=c,{computedIsSingleChain:l}=i,d=ys(u,{orderData:t},r);if(e){let k=await d.jitoTransaction();return this.solonaRent=ms(k),k}let h=l&&So.supportCustomGasFee,{payload:T,rent:_}=await d.preExecution({needGasPrice:h});return u.chainId===nr.SOLANA_MAINNET&&_&&(this.solonaRent=_),T});n(this,"setTransactionPayload",t=>{this.transactionPayload=t});n(this,"solanaSwapTransactionData",null);n(this,"setSolanaSwapTransactionData",t=>{this.solanaSwapTransactionData=t});n(this,"handleSolanaOfflineData",async t=>{let{offlineType:e,calldata:o,defiPlatformId:r}=t,{unsignedTx:s,quote:i}=o||{},c=await ps(s);this.solanaSwapTransactionData={transaction:c,offlineType:e,defiPlatformId:r,quote:i}});n(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=await t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),s,i,c=null;if(r){let l=t.extendSolanaCalldata(o);c=l,[s,i]=await t.getSolanaCalldata(l)}else[s,i]=await v(A.post(Nn,o));if(s){let l=s?.error_message;return J.error({title:l||f("swaptrade_top_notif_data_failed")}),!0}let u=await this.getPreExecutionPayload({orderData:i?.data||{},isSwapSolana:r,requestParams:c});return this.transactionPayload=u,this.orderId=i?.data?.orderId||"",!1});n(this,"preExecutionResult",{});n(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});n(this,"nativeCoin",null);n(this,"setNativeCoin",t=>{this.nativeCoin={...t}});n(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return I.BigNumber(r?o.availableBalance:mo(t,e))});n(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===ft.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=I.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?I.BigNumber(t.amount).plus(e):I.BigNumber(e)});n(this,"gasFeeLoading",!0);n(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});n(this,"gasLimitError",null);n(this,"setGasLimitError",t=>{this.gasLimitError=t});n(this,"maxGasFeeInt","");n(this,"setMaxGasFeeInt",t=>{this.maxGasFeeInt=t});n(this,"activityId",null);n(this,"setActivityId",t=>{this.activityId=t});n(this,"type",ft.SWAP);n(this,"setSwapType",t=>{this.type=t});n(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.orderId="",this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(ft.SWAP),this.clearTimer(),this.solonaRent=""});n(this,"starknetRegisterStatus","");n(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});n(this,"visibleStarknetRegister",!1);n(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});n(this,"onSwap",()=>{ce({...mt(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});n(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});n(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});n(this,"confirmSwapMap",{[ft.SWAP]:this.onSwap,[ft.REDEEM]:this.onRedeem,[ft.INTENT_SWAP]:this.onIntentSwap});n(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});n(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:s}=this.nativeCoin||{};return{[lt.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},btnText:f("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[lt.UPDATE]:{onClick:()=>{ce({...mt(),button_name:"update"}),this.updateQuoteData().catch(rt)},btnText:f("swaptrade_confirmswap_btn_update_price")},[lt.SNAP_UPDATE]:{onClick:()=>{ce({...mt(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(rt):this.updateSnapQuoteData().catch(rt)},btnText:f("swaptrade_confirmswap_btn_update_price")},[lt.FILL_UP]:{onClick:()=>{ir({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:s,receiveOnly:!1})},btnText:f("swaptrade_dialog_btn_supplement",{token:o})},[lt.CANCEL]:{onClick:()=>{ir({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:c}=W;c?.goBack()},btnText:f("swaptrade_top_btn_cancel")},default:{}}[t]});w(this),this.rootStore=t}get computedFormatTime(){return $n(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==nr.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),s=this.calcNativeCoinAmountChange();return r.gte(s.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=W;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=W.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let s=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?s:s||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(lt.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(lt.CANCEL)}get computedTipsBtnProps(){let t=lt.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=lt.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?lt.SNAP_UPDATE:lt.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},Mo=gr;p();m();P();p();m();var Tr=class{constructor(t){n(this,"signIntentSwap",async()=>[]);n(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId,tradeMode:ws.SWAP},[o,r]=await v(A.post(Mn,{...e}));return o&&(y.error(M.INTENT_ORDER_CREATE_ERROR,{error:o}),J.error({title:o?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),sr({...mt(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});n(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:s,accountStore:i}=this.rootStore,{quote:c,computedQuoteAmount:u}=o,{from:l,to:d}=s,{computedRealSlippageValue:h}=e,T=r?.receiveAddrObj?.specifiedAddress,_=h,k=c?.bestRoute?.bridge?.bridgeId,D=i?.address,L={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:T,fromChainId:l?.chainId,fromTokenAddress:l?.tokenContractAddress,fromAmount:u,toChainId:d.chainId,toTokenAddress:d.tokenContractAddress,toAmount:d.reverseReceiveAmount,walletAddress:D,bridgeId:k,minimumReceived:c?.bestRoute?.minimumReceived,slippage:_},[Q,tt]=await v(A.post(Un,{...L}));return Q&&(y.error(M.INTENT_ORDER_CREATE_ERROR,{error:Q}),J.error({title:Q?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),sr({...mt(),order_id:tt?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[Q,tt]});this.rootStore=t}},Ei=Tr;p();m();var vi=To(["isConfirmLoading"],[]);var Cr=class extends Ei{constructor(e){super(e);n(this,"isConfirmLoading",!1);n(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});n(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[s,i]=await r(o,e);return s&&(y.error(M.INTENT_SWAP_SIGN_ERROR,{error:s,msg:{chainId:e,unsignedTx:o}}),J.error({title:f("swaptrade_trading_mode_alert_order_fail")})),[s,i]});n(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});n(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),y.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:s,calldata:i,defiPlatformId:c}=o?.quote.bestRoute,{quote:u,unsignedTx:l}=i||{};if(!u||!l)return;let[d,h]=await this.signIntentSwap(r,l);if(d)return;let[T,_]=await this.createIntentOrder({quote:u,offlineType:s,signature:h,defiPlatformId:c});if(T)return;e.afterTransaction(_.data?.orderId)}catch(s){y.error(M.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),y.removeKeep()}});n(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),y.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:s}=o?.quote.bestRoute,{calldata:i,defiPlatformId:c}=s,{quote:u,unsignedTx:l}=i||{};if(!u||!l)return;let[d,h]=await this.signIntentSwap(r,l);if(d)return;let[T,_]=await this.bridgeSumbitIntentOrder({quote:u,signature:h,defiPlatformId:c});if(T)return;e.afterTransaction(_.data?.orderId)}catch(s){y.error(M.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),y.removeKeep()}});je(this,vi)}},Bo=Cr;p();m();P();p();m();P();p();m();P();P();var Ir=class{constructor(t){n(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:s,fromToken:i,toToken:c}=o;return!Number(r)&&!Number(s)?t=i.tokenSymbol===c.tokenSymbol?x.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:x.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=x.TO_TOKEN_PRICE_UNKNOWN):t=x.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o.showValueDiffDialog&&(t=r?x.VALUE_DIFFERENCE_TOO_MUCH_CROSS:x.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=x.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Jo.ENOUGH&&(t=x.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Ot.BTC_REPEAT?t=x.REPEAT_ORDER_BTC:o.repeatFlag===Ot.FACET_REPEAT?t=x.REPEAT_ORDER_FACET:o.enoughFlag!==Jo.ENOUGH&&(t=x.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||R.get(cn))return null;let s=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===Zo.FACET||Number(o.tokenType)===Zo.FACET)&&(s=x.FACET_SWAP_TIPS),{errorType:s,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!R.get(en)&&(t=x.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,s=o.quote.bestRoute,{toTokenPrice:i,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:u}=s,{BigNumber:l}=I;return(r?new l(u):new l(c)).gte(new l(i))&&(t=x.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,s=Number(e.to.chainId)===1;if(r&&s){let i=S(o,"quote.bestRoute.toSwapFeeUsd"),c=S(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),u=S(o,"quote.bestRoute.bridge.toRiskLimit");I.BigNumber(i).dividedBy(c).gte(u)&&(t=x.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:s}=t;if(o){if(!await s())throw Error("btc balance update failed");let c=e.computedInputVal,u=r.availableBalance;if(I.BigNumber(c).gt(u))return{errorType:x.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return Ur(e)&&e!==0?e===4&&R.get(`${no}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||R.get(`${no}_${e}`)?null:{errorType:x.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=R.get(`${no}_${tn}`);return!e&&!o?{errorType:x.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:x.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return As()?{errorType:x.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible,this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:s,continueToNextInterceptor:i}=await r.call(this)||{};if(s&&(t.push(s),!i))return t}return t}},yi=Ir;p();m();P();var ya=()=>{let{quoteStore:a}=b(),t=a.enableQuoteAggregates?S(a,"quote.bestRoute"):null;return S(t,"defiPlatformId")===U?f("swaptrade_trade_placeholder_okxdex"):S(t,"name")},_r=({disabled:a,toUsdPrice:t})=>{let{commonStore:e,fromToStore:o,buySellStore:r,quoteStore:s}=b();if(e.portal===co.MARKET){let l=S(s,"quote.bestRoute.receiveAmount");return l?f(r.tradeMode==="buy"?"swaptrade_market_placeorder_btn_buy_amt":"swaptrade_market_placeorder_btn_sell_amt",{amt:St(l,{needBillionMillionUnit:!0,useScientificNotation:!0}),token:Hn(o.to.tokenSymbol),price:Vn(e.currencyConversion(t).toString(),e.computedNowCurrencySymbol,{needPlaceholder:!0})}):r.tradeMode==="buy"?f("swaptrade_market_placeorder_btn_buy_symbol",{symbol:o.to.tokenSymbol}):f("swaptrade_market_placeorder_btn_sell_symbol",{symbol:o.from.tokenSymbol})}let u=(s.enableQuoteAggregates?S(s,"quote.bestRoute"):null)?zr:a?H:ee;if(o.computedIsSingleChain){let l=ya();return f(u,{provider:l})}return f(Jr)},Ri=()=>{let{commonStore:a,buySellStore:t}=b();return a.portal===co.MARKET?t.tradeMode==="buy"?wt.TYPE.green:wt.TYPE.red:null},Pi=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=b();return a.portal===co.MARKET?e.isConfirmLoading:t.swapBtnLoading};p();m();P();var Li=()=>{let{accountStore:a}=b(),t=S(a,"walletConfig.isWCApp"),e=S(a,"walletConfig.isOkxConnect"),o=f("swaptrade_card_swap_modal_btn_confirming_in_your_wallet"),r=f("swaptrade_modal_confirm_swap_btn_confirming_in_app");return t||e?r:o};var De=class{constructor(t){n(this,"swapBtnErrorTipsDialog",null);n(this,"swapInterceptor");n(this,"isInterceptionProcessing",!1);n(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));n(this,"notShowAgainCrossChainConfirm",!1);n(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});n(this,"tipsDialogInfo",this.defaultTipsDialogInfo());n(this,"swapBtnLoading",!1);n(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});n(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});n(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});n(this,"connectWallet",()=>{});n(this,"approve",()=>{});n(this,"cancelApprove",()=>{});n(this,"swap",()=>{});n(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;lo({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.showDappPanel()});n(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?_e:null});n(this,"checkBlackAddress",()=>{let{quoteStore:t}=this.rootStore,{quoteError:e}=t.quote;return e?.error_code===pn?H:null});n(this,"checkShowLimitRegion",()=>this.checkDappTrade()?null:Po.computedIsLimitRegion?H:null);n(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:s,quoteError:i,quoteNull:c}=e.quote,{from:u,to:l,computedTypedValue:d}=t,{tokenContractAddress:h}=u,{computedRealSlippageValue:T}=o;return c||!s&&i&&!r||!d||!l.tokenContractAddress||!h||T>50||T<0?H:null});n(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?H:null);n(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?H:null});n(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?H:null);n(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:H});n(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t,hasInitWalletInfo:e}}=this;return!t&&e?Ce:null});n(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?H:null});n(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?H:null});n(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?H:null});n(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===ro.BALANCE_REQUEST_FAILED?H:null});n(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?to:null);n(this,"approveStatus",()=>{let{fromToStore:t,quoteStore:e,approveStore:{getApprovalStatus:o}}=this,{from:r,computedIsCrossChain:s}=t,i=S(e,"quote.bestRoute"),c=$.getCurrentRouteDefiPlatformId(s,i),u=o(r,c);return on[u]||null});n(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?ee:null});n(this,"getBtnStatus",()=>{let t=[this.checkBlackAddress,this.checkShowLimitRegion,this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=H),e});n(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||J.warn({title:f("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:s,quoteStore:i,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=s,this.quoteStore=i,this.approveStore=c,this.swapInterceptor=new yi(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await v(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){y.error(M.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,s=()=>{r++;let i=r===o.length-1;this.showErrorTips(o[r],i?t:s)};s()}getBtnAllStatus({from:t,toUsdPrice:e}){return{[Ce]:{statusType:Ce,disabled:!1,toLocaleText:()=>f(Ce),onClick:this.connectWallet},[to]:{statusType:to,disabled:!this.fromToStore.computedShowAddFund||ae(),toLocaleText:()=>f(Ys["FILL_UP"],{token:O(t.tokenSymbol)}),onClick:()=>{this.fromToStore.onClickAddFunds()},symbol:t.tokenSymbol},[eo]:{statusType:eo,disabled:!1,toLocaleText:()=>f(eo,{tokenSymbol:O(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:wt.ICON_POSITION.leading},[Ie]:{statusType:Ie,loading:!0,disabled:!0,toLocaleText:()=>f(Ie)},[zo]:{statusType:Ie,disabled:!1,toLocaleText:()=>f(zo,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:wt.ICON_POSITION.leading},[oo]:{statusType:oo,loading:!0,disabled:!0,toLocaleText:()=>f(oo)},[H]:{statusType:H,disabled:!0,toLocaleText:()=>_r({disabled:!0,toUsdPrice:e})},[ee]:{statusType:ee,disabled:!1,loading:Pi(),toLocaleText:()=>_r({disabled:!1,toUsdPrice:e}),toLoadingLocaleText:()=>Li(),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:Ri()},[_e]:{statusType:_e,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>f(_e),icon:"okds-open-link",iconType:wt.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,s=e.from.balance,i=t.safeMoonStore.computedInputVal;return r?I.BigNumber(s||0).isLessThan(i):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e,to:o}=t,r=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading,toUsdPrice:S(o,"usdPrice")})[r]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:s,getGasTokenFeeLoading:i}=e,{fromTokenAmount:c="",inputToTokenAmount:u=""}=s?.bestRoute||{},l=!!r,d=l&&o&&I.BigNumber(r).isEqualTo(c),h=l&&!o&&I.BigNumber(r).isEqualTo(u);return!i&&(d||h)}};p();m();var wi=To(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);p();m();var kr=()=>{let{accountStore:a}=b();os({wallet_address:a.address,...bs()})};var Wt=class extends De{constructor(e){super(e);n(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:s}=this.rootStore,{from:i,cacheTokenInfo:c}=this.fromToStore;this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),y.info(M.CLICK_WALLET_SWAP_BUTTON,{chainId:i.chainId,tokenContractAddress:ho(i.tokenContractAddress),amountNum:i.balance}),I.eq(i.balance,c.amountNum)||y.info(M.BALANCE_IS_ERROR,{chainId:i.chainId,tokenContractAddress:ho(i.tokenContractAddress),amountNum:i.balance,cacheTokenInfo:{...c,tokenContractAddress:ho(c.tokenContractAddress)}});let{fromToken:u}=Te.get(e,"bestRoute",{});if(o){if(Ms(e?.bestRoute?.structureType)&&s.isSwapSolana(u.chainId)&&await this.walletContractStore.handleSolanaOfflineData(e?.bestRoute))return}else{let d=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,d)return}this.swapBtnLoading=!1;let l=o?ft.INTENT_SWAP:ft.SWAP;if(r.saveWalletAddressToStorage(this.fromToStore?.to),s.isSwapSolana(u.chainId)){W.history?.push({pathname:ze});return}W.history?.push({pathname:te,search:`needUpdate=${rn.on}&type=${l}`})});n(this,"swap",async()=>{let e=this.checkIsCurrentQuote(),{fromToStore:o,quoteStore:r}=this,{from:s,to:i}=o;lo({wallet_address:this.accountStore.address,button_name:"confirm",...mt()});let c=Te.get(r,"quote.bestRoute.serviceFeeInfo.serviceFeeUsd","0");es({fee_shown:c,from_token_symbol:s?.tokenSymbol,to_token_symbol:i?.tokenSymbol,from_to_pair_symbol:`${s?.tokenSymbol}:${i?.tokenSymbol}`,input_amount_usd:s?.usdPrice,source:Zn()?.source,terminal:ns.Plugin,selected_chain_id:s?.chainId,auto_confirm_enter:"off",chain_name:s?.chainName}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});n(this,"approve",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=Te.get(o,"quote.bestRoute"),s=$.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:E.Approving}),kr(),this.approveStore.setApprove()});n(this,"cancelApprove",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=Te.get(o,"quote.bestRoute"),s=$.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:E.CancelApproving}),kr(),this.approveStore.setApprove(oe.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,je(this,wi)}};p();m();P();P();p();m();P();P();p();m();p();m();var Oi=function(){return new Promise(function(t){setTimeout(t,1)})};p();m();var de=N(V());p();m();var Ra={["SWAP"]:"swap_used_chain_cache",["LIMIT_ORDER"]:"limit_used_chain_cache",["BRIDGE"]:"bridge_used_chain_cache"},Ni="USED_CHAIN_CACHE",br=4,Pa=a=>{let t=Ra[a],e=R.get(t)||[],o=R.get(Ni)||[];return e.length!==0&&R.remove(t),o.filter(Boolean)},La=({selectedChainIdList:a,chainList:t,cacheChainIdList:e})=>{t.sort((u,l)=>Number(l.popularWeight)-Number(u.popularWeight));let o=t.map(u=>u.chainId);if(e.length===0)return{sortedChainList:o.slice(0,br),cacheChainIds:o};let r=new Set(o),s=e.filter(u=>r.has(u)),i=[...e],c=[...s.slice(0,br)];return a.forEach(u=>{if(c.includes(u)||!u)return;let l=i.indexOf(u);l>-1&&i.splice(l,1),c.unshift(u),i.unshift(u)}),{sortedChainList:c.slice(0,br),cacheChainIds:i}},Di=(a,t,e)=>{y.info(M.GET_CHAINLIST_BY_STORAGE,{data:{fromAndToChainIdList:a,isChainListEmpty:t.length===0,hasUndefinedChain:t.some(i=>!i?.chainId),currentTab:e}});let o=Pa(e),{sortedChainList:r,cacheChainIds:s}=La({selectedChainIdList:a,chainList:t,cacheChainIdList:o});return R.set(Ni,s.filter(Boolean)),r.filter(Boolean)};p();m();var Fe=class{constructor(t){n(this,"id",1);n(this,"tokenSymbol","--");n(this,"tokenName","--");n(this,"decimals",6);n(this,"tokenContractAddress","");n(this,"tokenLogoUrl","");n(this,"type","");n(this,"amountNum",0);n(this,"currencyAmount",0);w(this),Object.assign(this,t),this.tokenModalStore=b().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=I.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?Nt(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===C.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===C.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return nt(this)}get computedTokenVolume(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.volume,{needPlaceholder:!0})}get computedTokenLiquidity(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.liquidity,{needPlaceholder:!0})}};p();m();var xe=(a={})=>({...G,logoUrl:G.logoUrl(),chainName:f(G.localKey),...a}),Uo=(a={})=>{let t=Hr();return{...X,get logoUrl(){return t===Wr.dark?X.darkLogoUrl():X.logoUrl()},chainName:f(X.localKey),...a}};var Fi="hide_collect_cancel_dialog",xi="hideTokenGuide",Ht=class{constructor(t){n(this,"searchValue","");n(this,"setSearchValue",t=>{this.searchValue=t});n(this,"fromTokenList",new Map);n(this,"toTokenList",new Map);n(this,"searchTokenList",{});n(this,"currentCollectionGroupId");n(this,"setCurrentCollectionGroupId",t=>{this.currentCollectionGroupId=t});n(this,"setCurrentCollectionGroupIdAndGetList",t=>{t&&t===this.currentCollectionGroupId||(this.setCurrentCollectionGroupId(t),this[`${this.tokenModalFromState}TokenList`].set(G.chainId),this.getTokenListByChainId().then(rt).catch(rt))});n(this,"error",!1);n(this,"tokenModalVisible",!1);n(this,"tokenModalFromState",C.FROM);n(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});n(this,"loading",{[C.FROM]:{},[C.TO]:{}});n(this,"initLoading",()=>{this.loading={[C.FROM]:{},[C.TO]:{}}});n(this,"importTokenInfo",{});n(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});n(this,"toSelectedChainId","");n(this,"fromSelectedChainId","");n(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});n(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});n(this,"fromSelectedChainAtSearch","");n(this,"toSelectedChainAtSearch","");n(this,"setFromSelectedChainAtSearch",t=>{this.fromSelectedChainAtSearch=t});n(this,"setToSelectedChainAtSearch",t=>{this.toSelectedChainAtSearch=t});n(this,"updateSelectedChainAtSearch",t=>{this.tokenModalFromState===C.FROM?this.setFromSelectedChainAtSearch(t):this.setToSelectedChainAtSearch(t)});n(this,"updateFromToSelectedChainIdAfterSearch",()=>{if(this.tokenModalFromState===C.FROM&&this.fromSelectedChainAtSearch!==this.fromSelectedChainId){this.setFromSelectedChainId(this.fromSelectedChainAtSearch);return}this.tokenModalFromState===C.TO&&this.toSelectedChainAtSearch!==this.toSelectedChainId&&this.setToSelectedChainId(this.toSelectedChainAtSearch)});n(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(z(o.chainId))).map(o=>{let r=new Fe(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice,formattedVolume:r.computedTokenVolume,formattedLiquidity:r.computedTokenLiquidity}}));n(this,"extendTokenList",(t=[],e=!0)=>et(t)?t:this.extendTokens(t,e));n(this,"importUserToken",At(function*(e,o=!0){let r=e.map(c=>{let{chainId:u,tokenContractAddress:l,tokenSymbol:d,decimals:h}=c;return{chainId:u,contractAddress:l,tokenSymbol:d,precision:h}}),s={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},i=[];try{i=(yield A.post(hn,s)).data}catch(c){throw J.error(f("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),i}));n(this,"sortTokens",t=>Qr(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));n(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===F.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));n(this,"formatTokenList",(t,e,o=!1)=>{let r=t;t.length>100&&e!==G.chainId&&(r=t.slice(0,100)),o&&(r=wo.filterHiddenTokenList(r));let s=this.extendTokenList(r,!0);return this.orderTokenList(s)});n(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});n(this,"clearCacheTokenList",()=>{});n(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===C.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===C.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===C.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===X.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===X.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===G.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===G.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(C.FROM,e.fromChainId):this.getTokenList(C.TO,e.toChainId,e.fromChainId)});n(this,"setTokenList",(t,e,o,r=!1)=>{let s=this.formatTokenList(e,t,r);this[`${o}TokenList`].set(t,s)});n(this,"cancelGetTokenListRef",null);n(this,"handleTokenList",At(function*(e){let{field:o,chainId:r,url:s,params:i,enableSmallAssetFilter:c,enableHiddenTokenFilter:u}=e;this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${o}TokenList`].get(r)||this.setLoading(o,r,!0),this.cancelGetTokenListRef=kt();let l={...i};if(c){yield wo.initializePromise;let d=wo.getMinAmountThresholdParam();d!==void 0&&(l.minAmountThreshold=d)}try{let{data:d}=yield A.get(s,{params:l,signal:this.cancelGetTokenListRef?.signal,isolate:!0}),h=this.toLowerCaseContractAddress(d);return this.setTokenList(r,h,o,u),this.setLoading(o,r,!1),{data:h}}catch(d){return this.isCancel(d)?null:(this.setTokenList(r,[],o,!1),this.setLoading(o,r,!1),this.setError(!0),d)}}).bind(this));n(this,"getCrossChainParams",(t,e,o)=>{switch(t){case F.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,targetChainId:e.targetChainId,targetWalletAddress:e.targetWalletAddress,walletAddress:e.walletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case F.SWAP:default:return e}});n(this,"getTokenList",At(function*(e,o,r){let s={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(s={...s,businessLine:ne.LIMIT_ORDER});let i=this.getCrossChainParams(this.commonStore.currentTab,s,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=z(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e,!1),{data:[]};let u=qt(Ut.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList({field:e,chainId:c,url:u,params:i,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getFromCollectedTokens",At(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ne.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Bt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:"",...this.computedCollectionGroupParams}),r=qt(Ut.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:C.FROM,chainId:G.chainId,url:r,params:o,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getToCollectedTokens",At(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ne.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Bt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress,...this.computedCollectionGroupParams}),s=qt(Ut.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:C.TO,chainId:G.chainId,url:s,params:r,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getFromAllNetworksTokens",At(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ne.LIMIT_ORDER});let o=qt(Ut.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Bt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList({field:C.FROM,chainId:X.chainId,url:o,params:r,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getToAllNetworksTokens",At(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ne.LIMIT_ORDER});let r=qt(Ut.ALL_NETWORK,this.commonStore.currentTab),s=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Bt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList({field:C.TO,chainId:X.chainId,url:r,params:s,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"cancelSearchRef",null);n(this,"needRemoveChainId",t=>[X.chainId,G.chainId].includes(z(t)));n(this,"getSearchChainType",()=>{let t=so.SINGLE;return this.computedCurrentSearchChainId===X.chainId&&(t=so.ALL_NETWORK),this.computedCurrentSearchChainId===G.chainId&&(t=so.COLLECT),t});n(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===C.FROM?Bt.FROM:Bt.TO);n(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses},r={},s={};return this.tokenModalFromState===C.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainAtSearch,chainId:this.fromSelectedChainAtSearch,toChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===C.TO&&(s={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainAtSearch)&&(delete s.toChainId,delete r.chainId)),{...o,...r,...s}});n(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=kt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=Xo(this.searchValue),e=this.getSearchParams(t);ts({keyword:t});let o=qt(Ut.SEARCH,this.commonStore.currentTab),[r,s]=await v(A.get(o,{params:e,signal:this.cancelSearchRef?.signal}));if(r&&!this.isCancel(r)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(s){let{data:i}=s;if(this.commonStore.currentTab===F.BRIDGE)this.setSearchTokenList({list:i});else{let{systemList:c,thirdPartyList:u}=s.data;this.setSearchTokenList({systemList:c,thirdPartyList:u})}this.updateFromToSelectedChainIdAfterSearch(),this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});n(this,"resetTokenModal",()=>{this.resetTokenData()});n(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});n(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:s}=e;for(let i=0;i<o.length;i++)if(this.commonStore.equalsToken(o[i],e)){o[i].amountNum=s,o[i].currencyAmount=r;break}return o});n(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=z(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(nt(r),t),C.FROM,!0);let s=this.toTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(nt(s),t),C.TO,!0)});n(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(h=>h.chainId===e.chainId&&!h.disabled))return r;let{dexDefaultFromToTokenShowVO:s}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:u}=s,l=o===F.BRIDGE,d;return l&&u?d=u:this.commonStore.equalsToken(t,c)?d=i:d=c,{toToken:d,isChanged:!0}}return r});n(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return nt(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});n(this,"hideCollectCancelConfirm",R.get(Fi));n(this,"showCollectOverLimitDialog",!1);n(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});n(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:s}=this.commonStore,i=t&&t.length>0?t:[e.chainId,o.chainId];return Di(i,r,s)});n(this,"tokenPageChainList",[]);n(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t?.filter(Boolean)||[]});n(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>z(e.chainId)===z(this.toSelectedChainId)));n(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>z(o.chainId)===z(t))===-1){let o=this.commonStore.chainList.find(s=>z(s.chainId)===z(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===C.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});n(this,"searchChainKeywords","");n(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});n(this,"filterChains",t=>Mr(t,e=>{let o=jo(Xo(this.searchChainKeywords));return jo(e.chainName).includes(o)}));n(this,"dialogIndex",or.TOKEN_LIST);n(this,"setDialogIndex",t=>{this.dialogIndex=t});n(this,"hideTokenGuide",!!R.get(xi));n(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,R.set(xi,"1")});n(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),is(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(or.TOKEN_LIST)});n(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});n(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await Oi(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:s,updateTo:i,setBalance:c,setFromBalanceRequestError:u,setToBalanceRequestError:l,to:d,computedIsExactIn:h,needCrossChainDoubleConfirm:T,setNeedCrossChainDoubleConfirm:_}=this.fromToStore,{clearReceiveAddressValue:k}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let D=this.tokenModalFromState===C.FROM,L=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),u(!1),c(C.FROM,t.balance)},Q=()=>{l(!1),c(C.TO,t.balance)};if(t.selected){D?Q():L(),this.fromToStore.onSwitchFromTo();return}D?L():Q();let tt=()=>{T||_(!0)};if(D){if(zn(t.chainId,d.chainId)&&this.commonStore.currentTab===F.BRIDGE){let gt=new vt(this.commonStore.currentTab,{}),[at,ct]=await gt.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:Se}=r,Y={...t},ge;at?(s({...Y,amount:Se}),ge=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,i({...ge})):(Y=ct.data.fromTokenInfo,ge=ct.data.toTokenInfo,s({...Y,amount:Se}),i(ge),tt(),this.fromToStore.getTokenBalanceByAccount("from",Y)),this.fromToStore.getTokenBalanceByAccount("to",ge)}else if(!this.commonStore.equalsToken(t,r)){let{amount:gt}=r;o.setQuoteNumber(2),s({...t,riskLevel:t.riskLevel,amount:gt});let{toToken:at,isChanged:ct}=this.checkFromToLegal(t,d);i(at),ct&&(tt(),this.fromToStore.getTokenBalanceByAccount("to",nt(at))),h&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,d)||(tt(),o.setQuoteNumber(0),i({...t,amount:""}),h||this.fromToStore.advanceSetTypedValue(""));k()});n(this,"updateTokenCollectionStatus",(t,e,o)=>{let r=!o?.length,s=this.currentCollectionGroupId&&!o.includes(this.currentCollectionGroupId);this.updateTokenCollectedLocal({...e,isCollectToken:r||s})});n(this,"memeTagConfig",{});n(this,"setMemeTagConfig",t=>{this.memeTagConfig=t});n(this,"fetchMemeTagConfig",async()=>{let[,t]=await v(A.get(Gn)),e=t?.data?.tagAndEmojiMap||{};return this.setMemeTagConfig(e),e});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}get computedCollectionGroupParams(){let t={accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress};return this.currentCollectionGroupId?{...t,groupId:this.currentCollectionGroupId}:t}get computedAdresses(){return S(this,"accountStore.computedMultiAddresses",{})}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===C.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return et(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return ue(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=xe(),e=Uo({});return[t,e,...nt(this.tokenPageChainList)]}get computedToChain(){let t=xe();if(se(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||se(this.toSelectedChainId)?this.toSelectedChainId:se(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?X.chainId:dn}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return Tt({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(s=>this.reassignTokenInfo(s,t,r)).filter(s=>this.filterCollectToken(s));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===C.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===C.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return z(this.tokenModalFromState===C.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedCurrentSearchChainId(){return z(this.tokenModalFromState===C.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch)}get computedIsCollectChain(){return this.computedCurrentChainId===G.chainId}setShowCollectCancelConfirm(t){R.set(Fi,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===C.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===C.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===C.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===C.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===C.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Ve(nt(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}get computedIsWatchListGroupShow(){return this.searchValue?!1:this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===G.chainId||this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===G.chainId}};var qo=class extends Ht{constructor(e){super(e);n(this,"showChainTab",!0);n(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});n(this,"extendTokenList",(e=[],o=!0)=>et(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));n(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=Ve(nt(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Jt([...r],"chainId")});n(this,"getCrossChainSearchType",()=>{let e=this.tokenModalFromState===C.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch;return Number(e)===G.chainId?ur.COLLECTION:ur.COMMON});n(this,"getToChainIdAtSearch",()=>{let e=this.toSelectedChainId;return this.tokenModalFromState===C.TO&&(e=this.toSelectedChainAtSearch),Number(e)===X.chainId?"":e});it(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===C.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],s=this.generateToChainMap();return e.forEach(i=>{let c={...i};c.disabled=!s[i.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],s=!1)=>{let i=[];return r?.forEach(c=>{let u=c?.tokenList.map(l=>this.reassignTokenInfo(l,e,s)).filter(l=>this.filterCollectToken(l));i.push({...c,tokenList:u})}),i};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=xe(),o=Uo({});if(se(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),s=[];return nt(this.tokenPageChainList).forEach(i=>{!i||i.chainId!==Number(this.fromToStore.from.chainId)&&s.push({...i,disabled:!r[i.chainId]})}),[e,o,...s]}return[e]}getSearchParams(e){let o={...this.computedAdresses};return this.tokenModalFromState===C.FROM&&(o={...o,fromChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&delete o.fromChainId),this.tokenModalFromState===C.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch},this.needRemoveChainId(this.toSelectedChainAtSearch)&&delete o.toChainId),{fromChainId:o.fromChainId??o?.chainId,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,targetChainId:o.targetChainId,targetWalletAddress:o.targetWalletAddress,walletAddress:this.accountStore.computedSignWalletAddress,inputContent:e,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.getToChainIdAtSearch(),fromTokenAddress:this.fromToStore.from?.tokenContractAddress||""}}};p();m();P();var{BigNumber:Mi}=I,Er="safemoon_slippage",vr="safemoon_is_changed",Bi=50,yr={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Yt=class{constructor(t){n(this,"isChanged",!1);n(this,"getSafemoonIsChangedLocal",()=>!!R.get(`${vr}_${this.computedSlippageTokenPair}`));n(this,"cacheSlippage",0);w(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,_t(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(R.get(`${vr}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(R.get(`${Er}_${this.computedSlippageTokenPair}`))}),_t(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(R.get(`${Er}_${this.computedSlippageTokenPair}`))}),_t(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t;let{computedIsSingleChain:e}=this.fromToStore;e||R.set(`${vr}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Mi(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),R.set(`${Er}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Mi(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return go(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=S(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===Bi?{type:yr.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:O(o),slippageTolerance:e}),inputWarning:f("swaptrade_adjustslip_modal_advise_givenslip")}:e>Bi?{type:yr.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:O(o)})}:{type:yr.AdviseSlip,safeMoonSlippage:e,tip:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:O(o)}),inputWarning:f("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return S(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return S(t,"isHoneypot")===1}get computedInputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[C.FROM]}get computedInputFiatVal(){let{computedFromLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[C.TO]}get computedOutputFiatVal(){let{computedToLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return Wn(t[C.TO])}};p();m();var Go=class{constructor(){n(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:R.get(tr)===Zr.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});n(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});n(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),R.set(tr,`${Number(t)}`)});n(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});w(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};p();m();var Rr=class{constructor(t){n(this,"isShowMev",!1);n(this,"setShowMev",t=>{this.isShowMev=t});n(this,"mevSwitchOpenStatue",ao.AUTO_OFF);n(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});n(this,"mevInfo",{});n(this,"setMevInfo",t=>{this.mevInfo=t});n(this,"walletMevControl",!1);n(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,w(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===ao.AUTO_ON||this.mevSwitchOpenStatue===ao.USER_ON)}},Qo=Rr;p();m();P();var Pr=class{constructor(t){n(this,"feeConfig",{});n(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!et(t)){this.feeConfig=t,Ae.set("feeConfig",t);return}let e=Ae.get("feeConfig"),o=We(e,["referrerAddress","feePercent"]);et(o)?(this.feeConfig={},Ae.remove("feeConfig")):this.feeConfig=o});n(this,"widgetFeeConfig",{});n(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});n(this,"receiveQuoteUrl",()=>this.isIframe?Sn:Tn);n(this,"aggregatorQuoteUrl",()=>In);n(this,"saveOrderUrl",()=>this.isIframe?kn:An);n(this,"illegalFeePercent",t=>{let{BigNumber:e}=I,o=e(t);return!!(o.isNaN()||o.gt(an)||o.lte(0))});n(this,"extendFeeConfig",(t={})=>{if(this.isWidget){let o=S(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=S(o,["referrerAddress",t.fromTokenAddress]),s=S(r,"account"),c=S(r,"feePercent")||o.feePercent;return s?{...t,referrerAddress:s,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=et(this.feeConfig)?Ae.get("feeConfig"):this.feeConfig;return{...t,...e}});w(this),this.rootStore=t,this.isIframe=!pt()&&Jn()&&!Ss,this.isWidget=!pt()&&ae()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},Vo=Pr;p();m();P();p();m();P();p();m();var Ui=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=b(),{from:s,to:i}=r;return!(!i?.tokenContractAddress||!s?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};p();m();p();m();var qi=a=>{let{fromToStore:t,quoteStore:e}=b(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s}=a,{computedIsSingleChain:i}=t,c=Number(o?.code)===ht.CROSS_CHAIN_INTERVAL,u=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(u),{isAutoError:c||(i?!s:!r?.length)}};var wa=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Oa=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s,swapType:i,intentCode:c,isSupportDappTrade:u,offlineType:l,traceData:d,serviceFeeInfo:h}=a,T={intentCode:c,offlineType:l,swapType:i,traceData:d},_=r?.map(D=>({...o,...D,...T,isSupportDappTrade:u}));return{bestRoute:t.computedIsSingleChain?{...o,...s,...T,serviceFeeInfo:h,intentInfo:a?.intentInfo||{},isSupportDappTrade:u}:e.pickBestRouterAccordingBridgeId(_)||{...o,...T,isSupportDappTrade:u},combineSelectionRouterList:_}},Na=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e,priorityFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:c})=>{c.updateSlippageInfoFetched(a),c.setQuote({...c.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1,priorityFeeInfo:o,jitoData:r,commonDexInfo:s}),i.quoteUpdateFromTo(a),i.computedIsSingleChain||c.setPathSelectionRouterList(t||[])},Lr=({isAutoError:a},{approveStore:t})=>{if(!a){let{fromToStore:e,quoteStore:o,accountStore:r}=b(),{needApprove:s,defiPlatformId:i,defiPlatformIds:c,allowanceData:u}=$.getApproveInfo(e.computedIsCrossChain,o);t.isPendingNotCheck({token:e.from,needApprove:s,defiPlatformIds:c,defiPlatformId:i,allowanceData:u,userWalletAddress:r.getAddressByChainId(e.from.chainId)}).catch(()=>{})}},Me=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),ut(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Da=a=>{let{solanaPriorityFeeStore:t}=b();t&&t.setJitoData(a?.priorityFeeInfo)},wr=a=>{(a?.newPriorityFeeInfo||a?.priorityFeeInfo)&&So.setPriorityFeeInfo(a?.priorityFeeInfo||a?.newPriorityFeeInfo)},Gi=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=b(),{isAutoError:r}=qi(a);wa({quoteStore:e,fromToStore:t});let{bestRoute:s,combineSelectionRouterList:i}=Oa(a,{fromToStore:t,quoteStore:e}),{priorityFeeInfo:c,newPriorityFeeInfo:u,jitoData:l,commonDexInfo:d}=a;Na({bestRoute:s,combineSelectionRouterList:i,isAutoError:r,jitoData:l,commonDexInfo:d,priorityFeeInfo:u||c},{fromToStore:t,quoteStore:e,approveStore:o}),Da(a),wr(a),Lr({isAutoError:r},{approveStore:o}),Me({isAutoError:r},{quoteStore:e})};p();m();var Be=class{constructor(t){n(this,"allTimerAndQuoteState",{[K.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[K.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>f(Je)},[K.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>f(Je)},[K.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>f(Ze)},[K.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>f(Ze)},[K.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>f(Je)},[K.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>f(Ze)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=I;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,s=this.fromToStore?.computedIfQuote,i=o!==null;return s?i?this.allTimerAndQuoteState[K.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[K.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[K.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[K.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[K.QUOTING]:this.allTimerAndQuoteState[K.DEFAULT]:this.allTimerAndQuoteState[K.TIMER]:this.allTimerAndQuoteState[K.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:xa,FACET_TOKEN_ERROR_TWO:Ma,FACET_TOKEN_ERROR_THREE:Ba}=ht,Kt=class{constructor(){n(this,"dialogCloseFlag",!1);n(this,"slippageInfoFetched",!1);n(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});n(this,"enableQuoteAggregates",!1);n(this,"dialogShowQuotationComparison",!1);n(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});n(this,"quoteNumber",0);n(this,"setQuoteNumber",t=>{this.quoteNumber=t});n(this,"aggregateSelectId",st);n(this,"isDialog",!1);n(this,"setIsDialog",t=>{this.isDialog=t});n(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});n(this,"isPickRouterFromWallet",!1);n(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});n(this,"quoteScope",null);n(this,"setQuoteScope",t=>{this.quoteScope=t});n(this,"fetchQuoteStatus",0);n(this,"quote",{...this.initQuote});n(this,"setQuote",t=>{this.quote=t});n(this,"pathSelectionRouterList",[]);n(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});n(this,"pickRouter",{});n(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});n(this,"showChainListModel",!1);n(this,"setShowChainListModel",t=>{this.showChainListModel=t});n(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});n(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});n(this,"currentBridgeId","");n(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});n(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});n(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==po.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});n(this,"quoteTimer",null);n(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});n(this,"cancelRef",null);n(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});n(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:s,computedIsExactIn:i}=this.fromToStore;return t===F.LIMIT_ORDER||!ke(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!i&&!s});n(this,"getQuoteData",async t=>{let e=await Lt();return v(me(()=>A.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),Ct.NUM,Ct.TIMER))});n(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Gi(e)}});n(this,"fetchQuote",async({source:t}={})=>{if(!Ui())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},er),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(1),this.setBridgeSelectId?.(st)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(st))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=kt();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!ue(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!ue(e)&&!this.dialogCloseFlag&&ut(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},er)}),Promise.resolve(!0)});n(this,"quotePending",!1);n(this,"debounceQuote",xr(this.fetchQuote,sn));n(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});n(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});n(this,"getGasTokenFeeLoading",!1);n(this,"getGasTokenFeeCancelRef",null);n(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});n(this,"cacheNativeGasFee","");n(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});n(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},s=qr(Ne(),["dexIds"]);this.getGasTokenFeeCancelRef=kt();let i=this.rootStore.fromToStore?.computedIsExactIn?fn:gn;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,u=e,[l,d]=await v(A.get(i,{params:{...s,amount:jn(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!ue(l)&&l)return-1;if(!l){let{data:h}=d||{},{commonDexInfo:T}=h||{};Number(T?.code)===0&&T?.estimateReserveGasTokenFee!==""&&(u=T.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(u),u})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=Cs({isSingleChain:t,autoSlippageInfo:e}),s=Ft.AUTO,i,c;return o&&(r=o.computedRealSlippageValue,s=o.getSlippageType(),i=t?o.computedRealCustomMaxSlippage:void 0,c=t?o.computedRealCustomSlippage:void 0),!this.slippageInfoFetched&&s===Ft.AUTO&&(s=Ft.DEFAULT),{slippage:r,slippageType:s,customSlippage:c,maxSlippage:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:s}=this.fromToStore,i=Number(e?.code)===ht.CROSS_CHAIN_INTERVAL,c=i?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:i||(s?!r:!o?.length)}}updateSlippageInfoFetched(t){let{referenceSlippage:e,autoSlippage:o,autoTotalSlippage:r}=t?.autoSlippageInfo||{};(e||o||r)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!I.BigNumber(e).lt(I.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Be(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return Kn()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===q.EMPTY}get computedShouldShowLimitRegionTip(){let t=!!Po.computedIsLimitRegion;return this.fromToStore?.computedIsSingleChain?t&&!this.quote?.bestRoute:t}get computedQuoteInterval(){let{fromToStore:t,approveStore:e,swapBtnStore:o,swapDappStore:r}=this.rootStore;if(this.quote?.bestRoute?.code===ln||this.quote?.bestRoute?.code===mn||t.computedFormToTokenIsLeverageToken)return{type:q.EMPTY};let s=Qs.handleQuoteErrorState({quote:this.quote,honeypotToken:S(this,"rootStore.safeMoonStore.computedHoneypot",!1),shouldShowLimitRegionTip:this.computedShouldShowLimitRegionTip})||this.accountStore.computedNonsupportChain,{from:i,computedNonsupportFacetToken:c}=this.fromToStore;if(s||c)return{type:q.EMPTY};if(r.checkShouldJumpToDapp())return{type:q.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:q.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:q.NOT_OKX_LIQUIDITY};let l=t.computedIsCrossChain?S(this.quote?.bestRoute,"bridge.defiPlatformId"):S(this.quote?.bestRoute,"defiPlatformId",U);if((!this.quoteScope||!t.computedIfQuote)&&this.fetchQuoteStatus!==3&&!e.isCancelApproveStatus(i,l)&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:q.EMPTY};if(this.computedCrossAccuracyLimit)return{type:q.CROSS_CHAIN_ACCURACY,text:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:i.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:O(i.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:q.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:d,crossMaxAmount:h}=this.quoteScope||{};if(I.BigNumber(i.amount).lt(I.BigNumber(d))){let T=St(d,{cutPriceText:!0,isFloor:!1});return{type:q.CROSS_CHAIN_MIN,text:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:T,symbol:i.tokenSymbol}),equation:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:T,symbol:O(i.tokenSymbol)})}}if(I.BigNumber(i.amount).gt(I.BigNumber(h))){let T=St(h,{cutPriceText:!0});return{type:q.CROSS_CHAIN_MAX,text:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:T,symbol:i.tokenSymbol}),equation:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:T,symbol:O(i.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:q.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:q.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:q.NOT_LIQUIDITY}:e.isCancelApproveStatus(i,l)&&!o.computedTooBalance?{type:q.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:q.PROVIDER_PRICE_WARN}:{type:q.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ht.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ht.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return I.BigNumber(t.amount).lte(o)&&I.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===U):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===ht.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[xa,Ma,Ba].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:s}=this.rootStore.fromToStore,{quoteError:i,quoteNull:c,bestRoute:u}=this.quote;if(!r||i||c||!u?.youSaveDTO||s)return{visible:!1};let{youSaveDTO:l,fromToken:d,toToken:h}=u,{topTenDexInfoList:T,youSaveMoney:_}=l,k=Number(_)>=.1&&T?.length>0&&!d.isHoneypot&&!h.isHoneypot,D=e(_).toString(),L=k?Nt(D,t,{isFloor:!1}):"",Q=k?T?.[1]?.dexName:"";return o&&(!s&&this.computedTopTenDexInfoList.length>0?k=!0:k=!1),{visible:k,youSaveStr:L,dexName:Q}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:s,price:i,dexAmountOut:c,amountOutOfMoney:u,gasOfMoney:l,isOkxDex:d})=>{let h=e(u)?.toString(),T=e(l)?.toString();return{logoUrl:o,dexName:r,comparePercent:s,price:i,isOkxDex:d,formatPrice:St(i),dexAmountOut:I.BigNumber(c).toString(),formatDexAmountOut:St(c),amountOutOfMoney:h,formatAmountOutOfMoney:Nt(h,t,{needBillionMillionUnit:!1}),gasOfMoney:Nt(T,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:s}=this.commonStore,{from:i}=this.fromToStore;return f("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${St(o)} ${i.tokenSymbol}`,fee:`${Nt(s(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===Ls.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Rs.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===Ps.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===U}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===U}get computedPriceWarn(){let t=I.BigNumber(this?.quote?.bestRoute?.reducePercent),e=I.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return Xn(this?.quote?.bestRoute?.reducePercent)}};p();m();P();var Ua=a=>{let{quoteStore:t,swapStore:e}=b();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},Wi=a=>Number(a.commonDexInfo?.code)===ht.CROSS_CHAIN_INTERVAL,qa=a=>!a.pathSelectionRouterList?.length,Ga=a=>Wi(a)||qa(a),Qa=a=>{let{quoteStore:t}=b(),e=Wi(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},Va=a=>{let{quoteStore:t}=b(),e=t.bridgeSelectId===st?a[0]:a?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return Ua(e),e||a[0]},Wa=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:s,isSupportDappTrade:i,offlineType:c,traceData:u}=a||{},l=r?.map((_,k)=>({commonDexInfo:t,..._,..._?.valueDiffInfo,isBest:k===0})),d={intentCode:s,offlineType:c,swapType:o,traceData:u},h={...e,...t,swapType:o,pathSelectionRouterList:l},T=l?.map(_=>({...t,..._,...d,isSupportDappTrade:i}));return{bestRoute:h,combineSelectionRouterList:T}},Ha=a=>{let{quoteStore:t,smartRouterStore:e}=b();if(e.showXRouteModal!==po.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},Ya=({isAutoError:a,approveStore:t})=>{if(!a){let{fromToStore:e,accountStore:o,quoteStore:r}=b(),{needApprove:s,defiPlatformId:i,defiPlatformIds:c,allowanceData:u}=$.getApproveInfo(e.computedIsCrossChain,r),l=S(e,"from.chainId");t.bridgePendingNotCheck({token:e.from,userWalletAddress:o.getAddressByChainId(l),needApprove:s,defiPlatformIds:c,defiPlatformId:i,allowanceData:u}).catch(()=>{})}},Ka=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:s,quoteStore:i})=>{let c=Tt({},a,t);i.updateSlippageInfoFetched(c),i.setBridgeSelectId(c?.bridge?.bridgeId),i.setQuote({...i.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),Qa(o),e&&i.setBridgeFetchStatus(3),s.quoteUpdateFromTo(c),s.computedIsCrossChain&&(i.setPathSelectionRouterList(r||[]),Ha(r||[]))},Hi=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=b(),{bestRoute:r,combineSelectionRouterList:s}=Wa({data:a}),i=Va(r.pathSelectionRouterList),c=Ga(a);e.setQuoteNumber(e.quoteNumber+1),Ka({bestRoute:r,bridgeInfo:i,isAutoError:c,originData:a,combineSelectionRouterList:s},{fromToStore:t,quoteStore:e}),Ya({isAutoError:c,approveStore:o}),Me({isAutoError:c},{quoteStore:e})};var Ue=class extends Kt{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeListPending=!1;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=Ai();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),v(me(()=>A.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw y.stuff(r),r}),Ct.NUM,Ct.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Hi(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};it(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await v(A.get(bn));if(e)throw e;return S(o,"data",[]).map(s=>({platformId:s.chainId,logo:s.logoUrl}))}get bridgeList(){return this.initialPropsStore.initialProps.bridgeList||[]}get computedIsBridgeListLoading(){return Xe()?!this.bridgeList?.length:this.bridgeListPending}async getBridgeList(){this.setBridgeListPending(!0),await v(this.initialPropsStore.getInitialProps({key:"bridgeList",callee:Ue})),this.setBridgeListPending(!1)}getQuoteStoreUrl(){return Cn}},Yi=Co(Ue);p();m();P();var za="1",Ja="2",Ki={minValue:.01,maxValue:.5},ji={minValue:.03,maxValue:.5},jt=class{constructor(t){n(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:"",mode:xt.DYNAMIC,level:Mt.LOW,customMax:""});n(this,"configSingle",Ki);n(this,"configCross",ji);n(this,"hasInit",!1);n(this,"inputCache","");n(this,"isFrozen",!1);n(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,w(this,{},{autoBind:!0})}setInputCache(t){this.inputCache=t}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=bt(this.rootStore);return t||this.isFrozen?{maxSlippage:this.computedRealCustomMaxSlippage,autoSlippageInfo:e}:{customSlippage:this.computedRealCustomSlippage,autoSlippageInfo:e}}get isSingleChain(){return this.rootStore.fromToStore.computedIsSingleChain}get minSlippage(){return this.isSingleChain?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.isSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return I.mul(this.minSlippage,100)}get maxSlippageShow(){return I.mul(this.maxSlippage,100)}get computedSupportCustomMax(){return S(bt(this.rootStore),"supportMaxSlippage",!1)}get computedFixedSlippageLevelMap(){if(!this.isSingleChain)return null;let t=S(bt(this.rootStore),"shortcutFixSlippage",Object.values(rs));return{low:Et(t[0]),medium:Et(t[1]),high:Et(t[2])}}get computedDynamicSlippageLimit(){let t=S(bt(this.rootStore),"dynamicSlippageRangeMin",be.DYNAMIC_MIN),e=S(bt(this.rootStore),"dynamicSlippageRangeMax",be.DYNAMIC_MAX),o=S(bt(this.rootStore),"recommendSlippageRangeMin",be.RECOMMEND_MIN),r=S(bt(this.rootStore),"recommendSlippageRangeMax",be.RECOMMEND_MAX);return{dynamicMin:Et(t),dynamicMax:Et(e),recommendMin:Et(o),recommendMax:Et(r)}}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=S(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return I.mul(e,100)}return go(this.rootStore)}get computedRealCustomSlippage(){let t=S(this,"slippageSetting.inputSlippage","");return t?ye(t):""}get computedRealCustomMaxSlippage(){let t=S(this,"slippageSetting.customMax","");return t?ye(t):""}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(ye(t))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:s,toPriceFluctuation:i,rateFluctuationThreshold:c,slippageFluctuationhold:u,rateFluctuation:l}=e,{from:d,to:h}=this.fromToStore,T=h?.tokenSymbol||"",_=d?.tokenSymbol||"",k=I.mul(u,100),D=I.mul(r,100),L=I.mul(c,100),Q=Number(l),tt=Number(c);if(t>k){if(Q<tt)return null}else if(t===k){let gt=Math.abs(s),at=Math.abs(i),ct=Number(r);if(gt>ct&&at>ct)return{tip:f("swaptrade_placeorder_alert_both_volatility",{payToken:_,receiveToken:T,value:D,min:o}),tipEquation:f("swaptrade_placeorder_alert_both_volatility",{payToken:O(_),receiveToken:O(T),value:D,min:o})};if(gt>ct)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:_,value:D,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:O(_),value:D,min:o})};if(at>ct)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:T,value:D,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:O(T),value:D,min:o})};if(Q>=tt)return{tip:f("swaptrade_settings_alert_both_exchange",{payToken:_,receiveToken:T,value:L,min:o}),tipEquation:f("swaptrade_settings_alert_both_exchange",{payToken:O(_),receiveToken:O(T),value:L,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0,mode:xt.DYNAMIC,level:Mt.LOW,customMax:""},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=Ko(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1,t.mode=xt.FIXED,t.level=Mt.CUSTOM,t.customMax="")}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?Ft.AUTO:Ft.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o,{computedIsSingleChain:s}=this.fromToStore;if(!r||s){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0,e.mode=xt.DYNAMIC,e.level=Mt.LOW;let c=Ko(i);o.isChanged&&c&&(e.inputSlippage=c,e.autoIsSelected=!1,e.mode=xt.FIXED,e.level=Mt.CUSTOM,e.customMax=""),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){this.hasInit=!0;try{let{data:t}=await A.get(On),e=t?.find(({configId:r})=>za===r),o=t?.find(({configId:r})=>Ja===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=Ki,this.configCross=ji}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:"",mode:xt.DYNAMIC,level:Mt.LOW,customMax:""},this.setSlippageSetting(e)}initReactions(){_t(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.initSlippageSetting()):!1,{equals:Ye.shallow}),_t(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:Ye.shallow}),_t(()=>{let{quote:t}=this.rootStore.quoteStore,e=S(t,"bestRoute.smartRoutingMenuVoList"),o=S(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===Vs.BRIDGE,{computedSafeMoonNotSupport:s}=this;return{computedSafeMoonNotSupport:s,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:Ye.shallow})}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},s=this.fromToStore.to?.tokenSymbol;if(!ke(o))return"--";let i=this.inputCache?ye(this.inputCache):this.computedRealSlippageValue,c=e?r:I.mul(o,1-(ke(i)?i:0));return I.BigNumber(c).lte(0)?"--":`${St(c,{needBillionMillionUnit:!1})} ${s}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=I.BigNumber(o);return!r.isZero()&&!r.isNaN()&&I.div(I.sub(r,e),r)>=.1}};p();m();P();var Nr=class{constructor(t){n(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:s}=e,i=S(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,u=s?.specifiedAddress;return{...r,fromSwapFeeUsd:i,bridgeId:c,receiveWalletAddress:u}});n(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:s}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:s.chainId,toTokenAddress:s.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});n(this,"repeatOrder",null);n(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=S(o.bestRoute,"fromSwapFeeUsd"),s={...e,chainId:t,fromSwapFeeUsd:r},[i,c]=await v(A.get(En,{params:s}));!i&&[Ot.COMMON_REPEAT,Ot.BTC_REPEAT,Ot.FACET_REPEAT].includes(c?.data.repeatFlag)&&ut(()=>{let{orderId:u,enoughFlag:l}=c?.data??{};this.repeatOrder={enoughFlag:l,repeatFlag:c?.data.repeatFlag,id:u}})});n(this,"checkSwapMoreInfo",null);n(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await v(A.post(vn,{...t}));e||ut(()=>{this.checkSwapMoreInfo=o?.data})});w(this),this.rootStore=t}},Wo=Nr;p();m();var Xt=class{constructor(t){n(this,"swapOnDappBtnLoading",!1);n(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});n(this,"dappPanelVisible",!1);n(this,"setDappPanelVisible",t=>{this.dappPanelVisible=t});n(this,"showDappPanel",()=>{this.setSwapOnDappBtnLoading(!0),this.setDappPanelVisible(!0)});n(this,"hideDappPanel",()=>{this.setSwapOnDappBtnLoading(!1),this.setDappPanelVisible(!1)});n(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),s=!!this.quoteStore?.computedSupportDappTradeByQuote,i=!o&&r,c=o&&r,u=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:s,balance:c||u,kline:c||u,klineJumpMarket:c||u,costValue:e&&c||u,valueDifference:u,liquidity:u,disableInput:i||c,showMax:u,showAddFund:u}});n(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:ro.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));n(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});n(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);n(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);n(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);n(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=ko?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});n(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,w(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,s=Array.isArray(r)&&r.find(i=>Number(i.chainId)===Number(e));return this.bridgeSupportDappTrade(s)}};p();m();P();var $t=class{constructor(){this.serviceStatus=null;w(this)}get maintenanceChainsMap(){return this.serviceStatus?Jt(this.serviceStatus?.maintenanceChains,"chainID")??{}:{}}async init(){if(this.serviceStatus!==null&&this.serviceStatus.maintenanceChains?.length===0)return;let t=await Os();ut(()=>{this.serviceStatus={...t}}),Ks.setServiceState(t)}};p();m();var zt=class{constructor({swapServStatusStore:t,chainIdList:e}){this.chainIdList=e,this.swapServStatusStore=t,w(this)}get currChainMaintenanceInfo(){let t=this.swapServStatusStore.maintenanceChainsMap,e=this.chainIdList?.get()?.slice()??[];if(!t||!e.length)return null;for(let o of e){let r=t[o];if(r)return r}return null}get isCurrChainInMaintenance(){return Boolean(this.currChainMaintenanceInfo)}};P();var he=class extends Qt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new _o(this),this.outerStore=new Vo(this),this.fromToStore=new Io(this),this.approveStore=new Vt(this),this.quoteStore=new Yi(this),this.tokenModalStore=new qo(this),this.safeMoonStore=new Yt(this),this.walletContractStore=new Mo(this),this.sendTransactionStore=new Ao(this),this.intentSwapStore=new Bo(this),this.swapCheckStore=new Wo(this),this.swapStore=new bo(this),this.swapBtnStore=new Wt(this),this.mevStore=new Qo(this),this.recentTransactionStore=new vo(this),this.facetStore=new yo(this),this.swapDappStore=new Xt(this),this.smartRouterStore=new Lo(this),this.slippageStore=new jt(this),this.oneMoreOrderStore=new Ro(this),this.gasDropStore=new Go,this.swapServStatusStore=new $t,this.chainMaintanceStore=new zt({swapServStatusStore:this.swapServStatusStore,chainIdList:Ke(()=>{let{from:e,to:o}=this.fromToStore;return Vr([e.chainId,o.chainId].filter(Boolean))})})});this.reset()}},qe=he;n(qe,"instance",null),n(qe,"getInstance",()=>(he.instance||(he.instance=new he),he.instance));var $i=qe;p();m();p();m();var Ho=class extends Ht{constructor(t){super(t),it(this)}getSearchParams(t){return this.singleSearchParams(t)}};p();m();P();p();m();P();var Za=a=>{let{quoteStore:t,swapStore:e}=b();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},tc=a=>{let{quoteStore:t}=b(),e=a.find(s=>s.defiPlatformId===U),o=t.aggregateSelectId===st?e:a.find(s=>s.defiPlatformId===t.aggregateSelectId),r=S(e,"dexRouterList",[]);return Za(o),Tt({},o||a[0],{dexRouterList:r})},ec=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:s,defiPlatformInfoList:i,traceData:c}=a,u=i.map((d,h)=>({...d,isBest:h===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?s:"0",swapType:r,defiPlatformInfoList:u,traceData:c}}},oc=({bestRoute:a,aggregateInfo:t,isAutoError:e,priorityFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:c})=>{let u=Tt({},a,t);c.updateSlippageInfoFetched(u),c.setAggregateSelectId(u.defiPlatformId),c.setQuote({...c.quote,bestRoute:u,quoteNull:e,quoteError:null,isFetchQuoting:!1,priorityFeeInfo:o,jitoData:r,commonDexInfo:s}),e&&c.setAggregateFetchStatus(4),i.quoteUpdateFromTo(u)},rc=a=>{let{solanaPriorityFeeStore:t}=b();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},zi=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=b(),r=e.aggregateFetchStatus===3,{bestRoute:s}=ec({data:a,isCompareResult:r}),i=tc(s.defiPlatformInfoList),c=r&&s.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1);let{priorityFeeInfo:u,jitoData:l,commonDexInfo:d}=a;oc({bestRoute:s,aggregateInfo:i,isAutoError:c,priorityFeeInfo:u,jitoData:l,commonDexInfo:d},{fromToStore:t,quoteStore:e}),rc(a),wr(a),Lr({isAutoError:c},{approveStore:o}),Me({isAutoError:c},{quoteStore:e})};var Ge=class extends Kt{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&A.get(this.outerStore.aggregatorQuoteUrl(),{params:Tt({},e,{defiPlatformIds:U}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{y.stuff(r)})};this.getWalletQuoteParams=e=>{if(this.compareVisible)return e;let o=[];return this.aggregateSelectId!==st&&this.aggregateSelectId!==U?o=[U,this.aggregateSelectId]:o=[U],{...e,defiPlatformIds:ie(o)}};this.handleQuoteParams=async()=>{let e=await Lt();if(!this.compareVisible&&pt()){let o=[];this.aggregateSelectId!==st&&this.aggregateSelectId!==U?o=[U,this.aggregateSelectId]:o=[U],e.defiPlatformIds=ie(o)}return e};this.getQuoteData=async e=>{let o=await this.handleQuoteParams();return pt()||this.fetchOKXQuote({params:o,signal:e}),v(me(()=>this.fetchAggregatesQuote({params:o,signal:e}),Ct.NUM,Ct.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;zi(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorListPending=!1;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=async()=>{this.setAggregatorListPending(!0),await v(this.initialPropsStore.getInitialProps({key:"aggregatorList",callee:Ge})),this.setAggregatorListPending(!1)};this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e,pt()&&this.fetchQuoteDebounce()};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};it(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await v(A.get(_n));if(e)throw e;return S(o,"data",[]).map(s=>({platformId:s.platformId,logo:s.logo}))}fetchAggregatesQuote({params:e,signal:o}){return A.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(st),this.setAggregateFetchStatus(3),r))}get aggregatorList(){return this.initialPropsStore.initialProps.aggregatorList||[]}get computedIsAggregatorListLoading(){return Xe()?!this.aggregatorList?.length:this.aggregatorListPending}get computedPriorityFeeInfo(){let e=S(this,"quote.priorityFeeInfo.normal",{})??{};return{mevPriorityFeeInfo:S(this,"quote.priorityFeeInfo.mev.[0]",{})??{},nonMevPriorityFeeInfo:e}}},Ji=Co(Ge);p();m();p();m();P();var Dr=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return cr.map(r=>({type:r,fee:a[`${r}Fee`],usd:a[`${r}FeeUsd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))},Zi=a=>{let t={},e=Jt(Dr(a),"type");return Br(cr).forEach(o=>{t[o]={amount:e[o]?.fee||"",price:e[o]?.usd||""}}),t};var Fr=class{constructor(t){n(this,"visible",!1);n(this,"setVisible",t=>{this.visible=t});n(this,"feeType",ar.MARKET);n(this,"setFeeType",t=>{this.feeType=t});n(this,"customFee",null);n(this,"setCustomFee",t=>{this.customFee=t});n(this,"jitoData",null);n(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,it(this)}get computedPriorityFeeList(){return Dr(this.jitoData)}get computedPriorityFeeMap(){return Zi(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===ar.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return I.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},ta=Fr;var fe=class extends Qt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new _o(this),this.outerStore=new Vo(this),this.fromToStore=new Io(this),this.approveStore=new Vt(this),this.quoteStore=new Ji(this),this.tokenModalStore=new Ho(this),this.safeMoonStore=new Yt(this),this.walletContractStore=new Mo(this),this.sendTransactionStore=new Ao(this),this.intentSwapStore=new Bo(this),this.swapCheckStore=new Wo(this),this.swapStore=new bo(this),this.swapBtnStore=new Wt(this),this.solanaPriorityFeeStore=new ta(this),this.mevStore=new Qo(this),this.recentTransactionStore=new vo(this),this.facetStore=new yo(this),this.swapDappStore=new Xt(this),this.smartRouterStore=new Lo(this),this.slippageStore=new jt(this),this.oneMoreOrderStore=new Ro(this),this.swapServStatusStore=new $t,this.chainMaintanceStore=new zt({swapServStatusStore:this.swapServStatusStore,chainIdList:Ke(()=>{let{from:e}=this.fromToStore;return e?.chainId?[e.chainId]:[]})})});this.reset()}},Qe=fe;n(Qe,"instance",null),n(Qe,"getInstance",()=>(fe.instance||(fe.instance=new fe),fe.instance));var ea=Qe;var nc=({localeData:a,...t})=>{Hs();let e=(0,oa.useLocation)(),o;return e.pathname.includes(ot)?o=F.BRIDGE:e.pathname.includes(nn)?o=F.LIMIT_ORDER:e.pathname===Z&&(o=F.SWAP),console.log("log-swap-localData",a),Yo.default.createElement(Is,{localeData:a,isDev:!0,noRemoteData:!0,customRender:r=>r},Yo.default.createElement($s,{swapRootStore:ea,bridgeRootStore:$i,initTab:o},Yo.default.createElement(Ii,{currentTab:o,...t})))},FI=dt(nc);export{FI as default};
//# sourceMappingURL=Advanced-RVRFFFYD.js.map
