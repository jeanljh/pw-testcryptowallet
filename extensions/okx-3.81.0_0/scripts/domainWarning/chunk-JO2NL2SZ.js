import{a as se}from"./chunk-YIOAXYID.js";import{a as re,c as Q}from"./chunk-GE2XQOPC.js";import{c as B,o as h,p as m,q as p}from"./chunk-4J7XGGEQ.js";var ae=B(M=>{h();p();Object.defineProperty(M,"__esModule",{value:!0});M.Assignable=M.Enum=void 0;var ie=class{constructor(e){if(Object.keys(e).length!==1)throw new Error("Enum can only take single value");Object.keys(e).map(r=>{this[r]=e[r],this.enum=r})}};M.Enum=ie;var oe=class{constructor(e){Object.keys(e).map(r=>{this[r]=e[r]})}};M.Assignable=oe});var ce=B(b=>{h();p();Object.defineProperty(b,"__esModule",{value:!0});b.BinaryReader=b.BinaryWriter=b.BorshError=b.deserialize=b.serialize=b.base_decode=b.base_encode=void 0;var T=se();Object.defineProperty(b,"base_encode",{enumerable:!0,get:function(){return T.baseEncode}});Object.defineProperty(b,"base_decode",{enumerable:!0,get:function(){return T.baseDecode}});Object.defineProperty(b,"serialize",{enumerable:!0,get:function(){return T.serialize}});Object.defineProperty(b,"deserialize",{enumerable:!0,get:function(){return T.deserialize}});Object.defineProperty(b,"BorshError",{enumerable:!0,get:function(){return T.BorshError}});Object.defineProperty(b,"BinaryWriter",{enumerable:!0,get:function(){return T.BinaryWriter}});Object.defineProperty(b,"BinaryReader",{enumerable:!0,get:function(){return T.BinaryReader}})});var de=B(E=>{h();p();Object.defineProperty(E,"__esModule",{value:!0});E.PublicKey=E.KeyType=void 0;var Be=ae(),le=ce(),Te=re(),U;(function(t){t[t.ED25519=0]="ED25519"})(U=E.KeyType||(E.KeyType={}));function Ee(t){switch(t){case U.ED25519:return"ed25519";default:throw new Error(`Unknown key type ${t}`)}}function Ce(t){switch(t.toLowerCase()){case"ed25519":return U.ED25519;default:throw new Error(`Unknown key type ${t}`)}}var P=class extends Be.Assignable{static fromRaw(e){return new P({keyType:U.ED25519,data:e})}static from(e){return typeof e=="string"?P.fromString(e):e}static fromString(e){let r=e.split(":");if(r.length===1)return new P({keyType:U.ED25519,data:(0,le.base_decode)(r[0])});if(r.length===2)return new P({keyType:Ce(r[0]),data:(0,le.base_decode)(r[1])});throw new Error("Invalid encoded key format, must be <curve>:<encoded key>")}toString(){return`${Ee(this.keyType)}:${(0,le.base_encode)(this.data)}`}verify(e,r){switch(this.keyType){case U.ED25519:return Te.signUtil.ed25519.verify(e,r,this.data);default:throw new Error(`Unknown key type ${this.keyType}`)}}};E.PublicKey=P});var ye=B(ne=>{h();p();Object.defineProperty(ne,"__esModule",{value:!0});ne.MessagePayload=void 0;var ue=class{constructor(e){this.tag=2147484061,this.message=e.message,this.nonce=e.nonce,this.recipient=e.recipient,e.callbackUrl&&(this.callbackUrl=e.callbackUrl)}};ne.MessagePayload=ue});var fe=B(s=>{h();p();Object.defineProperty(s,"__esModule",{value:!0});s.functionCallAccessKey=s.fullAccessKey=s.signTransaction=s.createTransaction=s.SCHEMA=s.SignedTransaction=s.Signature=s.Action=s.Transaction=s.deleteAccount=s.deleteKey=s.addKey=s.stake=s.transfer=s.functionCall=s.stringifyJsonOrBytes=s.deployContract=s.createAccount=s.DeleteAccount=s.DeleteKey=s.AddKey=s.Stake=s.Transfer=s.FunctionCall=s.DeployContract=s.CreateAccount=s.IAction=s.AccessKey=s.AccessKeyPermission=s.FullAccessPermission=s.FunctionCallPermission=void 0;var C=de(),k=ae(),Y=se(),Ke=re(),Z=Q(),Se=ce(),He=ye(),z=class extends k.Assignable{};s.FunctionCallPermission=z;var W=class extends k.Assignable{};s.FullAccessPermission=W;var S=class extends k.Enum{};s.AccessKeyPermission=S;var H=class extends k.Assignable{};s.AccessKey=H;var w=class extends k.Assignable{};s.IAction=w;var I=class extends w{};s.CreateAccount=I;var F=class extends w{};s.DeployContract=F;var j=class extends w{};s.FunctionCall=j;var R=class extends w{};s.Transfer=R;var $=class extends w{};s.Stake=$;var V=class extends w{};s.AddKey=V;var X=class extends w{};s.DeleteKey=X;var G=class extends w{};s.DeleteAccount=G;function je(){return new K({createAccount:new I({})})}s.createAccount=je;function Ne(t){return new K({deployContract:new F({code:t})})}s.deployContract=Ne;function ve(t){return t.byteLength!==void 0&&t.byteLength===t.length?t:m.Buffer.from(JSON.stringify(t))}s.stringifyJsonOrBytes=ve;function Oe(t,e,r=new Z.BN(0),i=new Z.BN(0),a=ve,l=!1){return l?new K({functionCall:new j({methodName:t,args:e,gas:r,deposit:i})}):new K({functionCall:new j({methodName:t,args:a(e),gas:r,deposit:i})})}s.functionCall=Oe;function De(t){return new K({transfer:new R({deposit:t})})}s.transfer=De;function Me(t,e){return new K({stake:new $({stake:t,publicKey:e})})}s.stake=Me;function qe(t,e){return new K({addKey:new V({publicKey:t,accessKey:e})})}s.addKey=qe;function Ue(t){return new K({deleteKey:new X({publicKey:t})})}s.deleteKey=Ue;function ze(t){return new K({deleteAccount:new G({beneficiaryId:t})})}s.deleteAccount=ze;var _=class extends k.Assignable{encode(){return(0,Y.serialize)(s.SCHEMA,this)}static decode(e){return(0,Y.deserialize)(s.SCHEMA,_,e)}};s.Transaction=_;var K=class extends k.Enum{};s.Action=K;var J=class extends k.Assignable{};s.Signature=J;var N=class extends k.Assignable{encode(){return(0,Y.serialize)(s.SCHEMA,this)}static decode(e){return(0,Y.deserialize)(s.SCHEMA,N,e)}};s.SignedTransaction=N;s.SCHEMA=new Map([[He.MessagePayload,{kind:"struct",fields:[["tag","u32"],["message","string"],["nonce",[32]],["recipient","string"],["callbackUrl",{kind:"option",type:"string"}]]}],[J,{kind:"struct",fields:[["keyType","u8"],["data",[64]]]}],[N,{kind:"struct",fields:[["transaction",_],["signature",J]]}],[_,{kind:"struct",fields:[["signerId","string"],["publicKey",C.PublicKey],["nonce","u64"],["receiverId","string"],["blockHash",[32]],["actions",[K]]]}],[C.PublicKey,{kind:"struct",fields:[["keyType","u8"],["data",[32]]]}],[H,{kind:"struct",fields:[["nonce","u64"],["permission",S]]}],[S,{kind:"enum",field:"enum",values:[["functionCall",z],["fullAccess",W]]}],[z,{kind:"struct",fields:[["allowance",{kind:"option",type:"u128"}],["receiverId","string"],["methodNames",["string"]]]}],[W,{kind:"struct",fields:[]}],[K,{kind:"enum",field:"enum",values:[["createAccount",I],["deployContract",F],["functionCall",j],["transfer",R],["stake",$],["addKey",V],["deleteKey",X],["deleteAccount",G]]}],[I,{kind:"struct",fields:[]}],[F,{kind:"struct",fields:[["code",["u8"]]]}],[j,{kind:"struct",fields:[["methodName","string"],["args",["u8"]],["gas","u64"],["deposit","u128"]]}],[R,{kind:"struct",fields:[["deposit","u128"]]}],[$,{kind:"struct",fields:[["stake","u128"],["publicKey",C.PublicKey]]}],[V,{kind:"struct",fields:[["publicKey",C.PublicKey],["accessKey",H]]}],[X,{kind:"struct",fields:[["publicKey",C.PublicKey]]}],[G,{kind:"struct",fields:[["beneficiaryId","string"]]}]]);function me(t,e,r,i,a,l){return new _({signerId:t,publicKey:e,nonce:i,receiverId:r,actions:a,blockHash:l})}s.createTransaction=me;async function pe(t,e){let r=(0,Y.serialize)(s.SCHEMA,t),i=Z.base.sha256(r),a=Z.base.fromHex(e),l=Ke.signUtil.ed25519.sign(i,a),n=new N({transaction:t,signature:new J({keyType:C.KeyType.ED25519,data:l})});return[i,n]}async function We(...t){if(t[0].constructor===_){let[e,r]=t;return pe(e,r)}else{let[e,r,i,a,l,n]=t,d=Ke.signUtil.ed25519.publicKeyCreate(Z.base.fromHex(l)),f=C.PublicKey.from((0,Se.base_encode)(d)),g=me(n,f,e,r,i,a);return pe(g,l)}}s.signTransaction=We;function Ie(){return new H({nonce:0,permission:new S({fullAccess:new W({})})})}s.fullAccessKey=Ie;function Fe(t,e,r){return new H({nonce:0,permission:new S({functionCall:new z({receiverId:t,allowance:r,methodNames:e})})})}s.functionCallAccessKey=Fe});var _e=B(D=>{h();p();Object.defineProperty(D,"__esModule",{value:!0});D.NearWallet=D.NearTypes=void 0;var y=Q(),ee=re(),o=Q(),c=ke(),Re=ye(),we=fe(),$e=se(),O;(function(t){t[t.TransferNear=0]="TransferNear",t[t.TransferToken=1]="TransferToken",t[t.DAppTx=2]="DAppTx",t[t.DAppTxs=3]="DAppTxs",t[t.AddKey=4]="AddKey",t[t.DelKey=5]="DelKey"})(O=D.NearTypes||(D.NearTypes={}));var be=class extends y.BaseWallet{async getDerivedPath(e){return`m/44'/397'/${e.index}'`}async getRandomPrivateKey(){try{let e=ee.signUtil.ed25519.ed25519_getRandomPrivateKey(!1,"hex"),r=o.base.toHex(ee.signUtil.ed25519.publicKeyCreate(o.base.fromHex(e)),!1);return Promise.resolve("ed25519:"+o.base.toBase58(o.base.fromHex(e+r)))}catch{return Promise.reject(y.GenPrivateKeyError)}}async getDerivedPrivateKey(e){try{let r=await ee.signUtil.ed25519.ed25519_getDerivedPrivateKey(e.mnemonic,e.hdPath,!1,"hex"),i=o.base.toHex(ee.signUtil.ed25519.publicKeyCreate(o.base.fromHex(r)));return Promise.resolve("ed25519:"+o.base.toBase58(o.base.fromHex(r+i)))}catch{return Promise.reject(y.GenPrivateKeyError)}}async getNewAddress(e){try{if(!e.privateKey)throw y.NewAddressError;if(e.privateKey.startsWith("0x")||e.privateKey.startsWith("0X")){let n=e.privateKey.substring(2);if(o.base.isHexString("0x"+n))return Promise.resolve({address:(0,c.getAddress)(e.privateKey),publicKey:(0,c.getPubkey)(e.privateKey)})}if(!e.privateKey.startsWith("0x")&&!e.privateKey.startsWith("0X")&&o.base.isHexString("0x"+e.privateKey))return Promise.resolve({address:(0,c.getAddress)(e.privateKey),publicKey:(0,c.getPubkey)(e.privateKey)});let r=e.privateKey.split(":");if(r.length!=2||r[0]!="ed25519")throw y.NewAddressError;let i=o.base.fromBase58(r[1]),a=o.base.toHex(i.slice(0,32)),l=(0,c.getAddress)(a);return Promise.resolve({address:l,publicKey:(0,c.getPubkey)(a)})}catch{return Promise.reject(y.NewAddressError)}}async validPrivateKey(e){let r=e.privateKey.startsWith("0x")?e.privateKey:"0x"+e.privateKey,i;if(o.base.isHexString(r))try{i=(0,c.checkPrivateKey)(e.privateKey)}catch{i=!1}else{let l=e.privateKey.split(":");if(l.length!=2||l[0]!="ed25519")i=!1;else{let n=o.base.fromBase58(l[1]),d=o.base.toHex(n.slice(0,32));try{i=(0,c.checkPrivateKey)(d)}catch{i=!1}}}let a={isValid:i,privateKey:e.privateKey};return Promise.resolve(a)}getBase58Address(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw y.NewAddressError;let i=o.base.fromBase58(r[1]),a=o.base.toHex(i.slice(0,32));return(0,c.getAddress)(a)}getPrvFromBase58(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw y.NewAddressError;let i=o.base.fromBase58(r[1]);return o.base.toHex(i)}getBase58Pubkey(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw y.NewAddressError;let i=o.base.fromBase58(r[1]),a=o.base.toHex(i.slice(0,32));return(0,c.publicKeyFromSeed)(a)}async signCommonMsg(e){let r=e.privateKey.startsWith("0x")||e.privateKey.startsWith("0X")?e.privateKey.substring(2):e.privateKey;if(!e.privateKey.startsWith("0x")&&!e.privateKey.startsWith("0X")&&!o.base.isHexString("0x"+e.privateKey)){let i=e.privateKey.split(":");if(i.length!=2||i[0]!="ed25519")throw Error("invalid privateKey");let a=o.base.fromBase58(i[1]);r=o.base.toHex(a.slice(0,32))}return super.signCommonMsg({privateKey:e.privateKey,privateKeyHex:r,message:e.message,signType:y.SignType.ED25519})}async signMessage(e){try{let r=e.data,{message:i,nonce:a,recipient:l,callbackUrl:n}=r,d=m.Buffer.from(a);if(d.length!==32)throw Error("Expected nonce to be a 32 bytes buffer");let f=new Re.MessagePayload({message:i,nonce:d,recipient:l,callbackUrl:n}),g=(0,$e.serialize)(c.SCHEMA,f),v=o.base.sha256(g),te=this.getPrvFromBase58(e.privateKey),L=o.base.fromHex(te),A=ee.signUtil.ed25519.sign(v,L);return Promise.resolve(m.Buffer.from(A).toString("base64"))}catch{return Promise.reject(y.SignMsgError)}}async signTransaction(e){try{let r=e.data.type||0,i=this.getBase58Address(e.privateKey),a=this.getBase58Pubkey(e.privateKey),l=this.getPrvFromBase58(e.privateKey);if(r===O.TransferNear){let n=e.data,d=(0,c.createTransaction)(n.from==null||null||n.from==""?i:n.from,a,n.receiverId,n.nonce,[],o.base.fromBase58(n.blockHash));d.actions.push((0,c.transfer)(new o.BN(n.amount)));let[f,g]=await(0,c.signTransaction)(d,l);return Promise.resolve(o.base.toBase64(g.encode()))}else if(r===O.AddKey){let n=e.data;if(n.publicKey==null||n.accessKeyReceiverId==null||n.accessKeyMethodNames==null||n.accessKeyAllowance==null)return Promise.reject(y.SignTxError);let d=(0,c.createTransaction)(n.from==null||null||n.from==""?i:n.from,a,n.receiverId,n.nonce,[],o.base.fromBase58(n.blockHash)),f=n.accessKeyUseFull?(0,we.fullAccessKey)():(0,we.functionCallAccessKey)(n.accessKeyReceiverId,n.accessKeyMethodNames,new o.BN(n.accessKeyAllowance));d.actions.push((0,c.addKey)((0,c.publicKeyFromBase58)(n.publicKey),f));let[g,v]=await(0,c.signTransaction)(d,l);return Promise.resolve(o.base.toBase64(v.encode()))}else if(r===O.DelKey){let n=e.data;if(n.publicKey==null)return Promise.reject(y.SignTxError);let d=(0,c.createTransaction)(n.from==null||null||n.from==""?i:n.from,a,n.receiverId,n.nonce,[],o.base.fromBase58(n.blockHash));d.actions.push((0,c.deleteKey)((0,c.publicKeyFromBase58)(n.publicKey)));let[f,g]=await(0,c.signTransaction)(d,l);return Promise.resolve(o.base.toBase64(g.encode()))}else if(r===O.TransferToken){let n=e.data,d=(0,c.createTransaction)(n.from==null||null||n.from==""?i:n.from,a,n.contract,n.nonce,[],o.base.fromBase58(n.blockHash));if(n.shouldDeposit){let L={account_id:n.receiverId},A=(0,c.functionCall)("storage_deposit",L,new o.BN(n.depositGas),new o.BN(n.depositValue));d.actions.push(A)}let f={amount:n.amount,receiver_id:n.receiverId},g=(0,c.functionCall)("ft_transfer",f,new o.BN(n.transferGas),new o.BN(n.minTransferTokenValue));d.actions.push(g);let[v,te]=await(0,c.signTransaction)(d,l);return Promise.resolve(o.base.toBase64(te.encode()))}else if(r===O.DAppTx){let n=e.data;if(n.actions==null||n.actions==null||n.actions.length==0)return Promise.reject(y.SignTxError);let d=n.actions.map(v=>(0,c.functionCall)(v.methodName,v.args,new o.BN(v.gas),new o.BN(v.deposit))),[f,g]=await(0,c.signTransaction)(n.receiverId,n.nonce,d,o.base.fromBase58(n.blockHash),l,n.from==null||null||n.from==""?i:n.from);return Promise.resolve(o.base.toBase64(g.encode()))}else if(r===O.DAppTxs){let n=e.data;if(n.transactions==null||n.transactions==null||n.transactions.length==0)return Promise.reject(y.SignTxError);let d=[];for(let f=0;f<n.transactions.length;f++){let g=n.transactions[f],v=g.actions.map(A=>(0,c.functionCall)(A.methodName,A.args,new o.BN(A.gas),new o.BN(A.deposit))),[te,L]=await(0,c.signTransaction)(g.receiverId,new o.BN(n.nonce).add(new o.BN(f)).toNumber(),v,o.base.fromBase58(n.blockHash),l,n.from==null||null||n.from==""?i:n.from);d.push(o.base.toBase64(L.encode()))}return Promise.resolve(d)}else return Promise.reject(y.SignTxError)}catch{return Promise.reject(y.SignTxError)}}async validAddress(e){let r=!1;try{r=(0,c.validateAddress)(e.address)}catch{}let i={isValid:r,address:e.address};return Promise.resolve(i)}async calcTxHash(e){try{let r=c.SignedTransaction.decode(m.Buffer.from(o.base.fromBase64(e.data))),i=o.base.toBase58(o.base.sha256(r.transaction.encode()));return Promise.resolve(i)}catch{throw y.CalcTxHashError}}};D.NearWallet=be});var ke=B(u=>{h();p();var Ve=u&&u.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var a=Object.getOwnPropertyDescriptor(e,r);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,a)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),xe=u&&u.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ve(e,t,r)};Object.defineProperty(u,"__esModule",{value:!0});u.publicKeyFromBase58=u.publicKeyFromSeed=u.checkName=u.validateAddress=u.getPubkey=u.checkPrivateKey=u.getAddress=void 0;var Ae=de(),x=Q(),ge=re(),Xe=Q();xe(fe(),u);xe(_e(),u);function Ge(t){if(!he(t))throw new Error("invalid key");let r=t;(t.startsWith("0x")||t.startsWith("0X"))&&(r=t.substring(2));let i=ge.signUtil.ed25519.publicKeyCreate(x.base.fromHex(r));return x.base.toHex(i)}u.getAddress=Ge;function he(t){if(!t)throw new Error("invalid key");let e="";if(t.startsWith("0x")||t.startsWith("0X")){if(e=t.substring(2),!x.base.isHexString("0x"+e))throw new Error("invalid key");if(t.length!=130&&t.length!=66)throw new Error("invalid key")}else{if(!x.base.isHexString("0x"+t))throw new Error("invalid key");if(t.length!=128&&t.length!=64)throw new Error("invalid key");e=t}let r=x.base.fromHex(e);if(r.length!=64&&r.length!=32||r.every(i=>i===0))throw new Error("invalid key");return!0}u.checkPrivateKey=he;function Je(t){he(t);let e=ge.signUtil.ed25519.publicKeyCreate(x.base.fromHex(t));return"ed25519:"+x.base.toBase58(e)}u.getPubkey=Je;function Le(t){return t.length>=2&&t.length<=64&&Pe(t)}u.validateAddress=Le;function Pe(t){return new RegExp("^(([a-z\\d]+[\\-_])*[a-z\\d]+\\.)*([a-z\\d]+[\\-_])*[a-z\\d]+$").test(t)}u.checkName=Pe;function Qe(t){let e=ge.signUtil.ed25519.publicKeyCreate(x.base.fromHex(t));return Ae.PublicKey.fromRaw(e)}u.publicKeyFromSeed=Qe;function Ye(t){let e=t.split(":");if(e.length!=2||e[0]!="ed25519")throw Xe.SignTxError;return Ae.PublicKey.fromRaw(x.base.fromBase58(e[1]))}u.publicKeyFromBase58=Ye});export{ke as a};
//# sourceMappingURL=chunk-JO2NL2SZ.js.map
