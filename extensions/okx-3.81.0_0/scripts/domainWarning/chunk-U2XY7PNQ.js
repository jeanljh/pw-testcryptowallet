import{a as F,c as S}from"./chunk-GE2XQOPC.js";import{c as w,o as l,p as i,q as h}from"./chunk-4J7XGGEQ.js";var E=w(x=>{l();h();Object.defineProperty(x,"__esModule",{value:!0});x.validate=void 0;function de(t,e){if(!t)throw new Error(e)}x.validate=de});var R=w(O=>{l();h();Object.defineProperty(O,"__esModule",{value:!0});O.convert=void 0;var G=E();function fe(t,e,r,n){for(var s=n?Math.floor(t.length*e/r):Math.ceil(t.length*e/r),o=(1<<r)-1,c=new Uint8Array(s),u=0,y=0,d=0,q=0;q<t.length;++q){var P=t[q];for((0,G.validate)(0<=P&&P>>e===0,"Invalid value: "+P+"."),y=y<<e|P,d+=e;d>=r;)d-=r,c[u]=y>>d&o,++u}return n?(0,G.validate)(d<e&&(y<<r-d&o)===0,"Input cannot be converted to "+r+" bits without padding, but strict mode was used."):d>0&&(c[u]=y<<r-d&o,++u),c}O.convert=fe});var Y=w(I=>{l();h();Object.defineProperty(I,"__esModule",{value:!0});I.decode=I.encode=void 0;var J=E(),ge="qpzry9x8gf2tvdw0s3jn54khce6mua7l",W={q:0,p:1,z:2,r:3,y:4,9:5,x:6,8:7,g:8,f:9,2:10,t:11,v:12,d:13,w:14,0:15,s:16,3:17,j:18,n:19,5:20,4:21,k:22,h:23,c:24,e:25,6:26,m:27,u:28,a:29,7:30,l:31};function ve(t){for(var e="",r=0;r<t.length;++r){var n=t[r];(0,J.validate)(0<=n&&n<32,"Invalid value: "+n+"."),e+=ge[n]}return e}I.encode=ve;function pe(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;++r){var n=t[r];(0,J.validate)(n in W,"Invalid value: "+n+"."),e[r]=W[n]}return e}I.decode=pe});var T=w(f=>{l();h();var be=f&&f.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),ye=f&&f.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),we=f&&f.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&be(e,t,r);return ye(e,t),e};Object.defineProperty(f,"__esModule",{value:!0});f.payToAddrScript=f.encodePubKeyAddress=void 0;var K=E(),X=R(),Q=we(Y()),_e=S();function Ie(t,e){let r=[0,0,0,0,0,0,0,0],n=V(e).concat([0]),s=0,o=Array.prototype.slice.call(_e.base.fromHex(t),0),c=(0,X.convert)(new Uint8Array([s].concat(o)),8,5,!1),u=new Uint8Array(n.length+c.length+r.length);u.set(n),u.set(c,n.length),u.set(r,n.length+c.length);let y=Pe(Z(u)),d=new Uint8Array(c.length+y.length);return d.set(c),d.set(y,c.length),"kaspa:"+Q.encode(d)}f.encodePubKeyAddress=Ie;function He(t){(0,K.validate)(me(t),"Mixed case"),t=t.toLowerCase();let e=t.split(":");(0,K.validate)(e.length===2,"Invalid format: "+t);let r=e[0];(0,K.validate)(r==="kaspa","Invalid prefix: "+t);let n=e[1],s=Q.decode(n);(0,K.validate)(Se(r,s),"Invalid checksum: "+t);let o=(0,X.convert)(s.slice(0,-8),5,8,!0),c=o[0],u=o.slice(1);switch(c){case 0:if(u.length!==32)throw new Error("Invalid Schnorr public key length");return i.Buffer.concat([i.Buffer.from([32]),u,i.Buffer.from([172])]);case 1:if(u.length!==33)throw new Error("Invalid ECDSA public key length");return i.Buffer.concat([i.Buffer.from([33]),u,i.Buffer.from([171])]);case 8:if(u.length!==32)throw new Error("Invalid script hash length");return i.Buffer.concat([i.Buffer.from([170]),i.Buffer.from([32]),u,i.Buffer.from([135])]);default:throw new Error(`Unsupported address version: ${c}`)}}f.payToAddrScript=He;function me(t){return t===t.toLowerCase()||t===t.toUpperCase()}function V(t){let e=[];for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r)&31);return e}function Pe(t){let e=[];for(let r=0;r<8;++r)e.push(t&31),t/=32;return e.reverse()}function Se(t,e){let r=V(t),n=new Uint8Array(t.length+1+e.length);return n.set(r),n.set([0],r.length),n.set(e,r.length+1),Z(n)===0}var $=[152,121,243,174,30],xe=[4072443489,3077413346,1046459332,783016616,1329849456];function Z(t){for(var e=0,r=1,n=0,s=0;s<t.length;s++){n=e>>>3,e&=7,e<<=5,e|=r>>>27,r&=134217727,r<<=5,r^=t[s];for(var o=0;o<$.length;++o)n&1<<o&&(e^=$[o],r^=xe[o])}return r^=1,r<0&&(r^=1<<31,r+=(1<<30)*2),e*(1<<30)*4+r}});var k=w(g=>{l();h();Object.defineProperty(g,"__esModule",{value:!0});g.validateAddress=g.addressFromPrvKey=g.addressFromPubKey=g.checkPrvKey=g.pubKeyFromPrvKey=void 0;var A=S(),Ee=F(),ee=T();function te(t){if(!re(t))throw new Error("invalid key");return A.base.toHex(Ee.signUtil.secp256k1.publicKeyCreate(A.base.fromHex(t.toLowerCase()),!0).slice(1))}g.pubKeyFromPrvKey=te;function re(t){if(!A.base.validateHexString(t))return!1;let e=A.base.fromHex(t.toLowerCase());return e.length==32&&!e.every(r=>r===0)}g.checkPrvKey=re;function ne(t){return(0,ee.encodePubKeyAddress)(t,"kaspa")}g.addressFromPubKey=ne;function Oe(t){return ne(te(t))}g.addressFromPrvKey=Oe;function Ke(t){try{(0,ee.payToAddrScript)(t)}catch{return!1}return!0}g.validateAddress=Ke});var N=w(v=>{l();h();Object.defineProperty(v,"__esModule",{value:!0});v.Transaction=v.signMessage=v.calcTxHash=v.transfer=void 0;var a=S(),oe=F(),M=T(),Ae=i.Buffer.from("TransactionSigningHash"),Ue=i.Buffer.from("TransactionID"),Ce=i.Buffer.from("PersonalMessageSigningHash");function Le(t,e){return H.fromTxData(t).sign(e).getMessage()}v.transfer=Le;function Be(t){let e=new p;return e.writeUInt16LE(t.version),e.writeUInt64LE(BigInt(t.inputs.length)),t.inputs.forEach(r=>{e.writeHash(a.base.fromHex(r.previousOutpoint.transactionId)),e.writeUInt32LE(r.previousOutpoint.index),e.writeVarBytes(i.Buffer.alloc(0)),e.writeUInt64LE(BigInt(r.sequence))}),e.writeUInt64LE(BigInt(t.outputs.length)),t.outputs.forEach(r=>{e.writeUInt64LE(BigInt(r.amount)),e.writeUInt16LE(r.scriptPublicKey.version),e.writeVarBytes(a.base.fromHex(r.scriptPublicKey.scriptPublicKey))}),e.writeUInt64LE(BigInt(t.lockTime)),e.writeHash(a.base.fromHex(t.subnetworkId)),e.writeUInt64LE(0n),e.writeVarBytes(i.Buffer.alloc(0)),a.base.toHex(a.base.blake2(e.toBuffer(),256,Ue))}v.calcTxHash=Be;function qe(t,e){let r=a.base.blake2(i.Buffer.from(t),256,Ce),n=oe.signUtil.schnorr.secp256k1.schnorr.sign(r,a.base.toHex(a.base.fromHex(e)));return a.base.toHex(n)}v.signMessage=qe;var H=class{static fromTxData(e){return new H(e)}constructor(e){this.version=0,this.inputs=[],this.outputs=[],this.lockTime="0",this.subnetworkId="0000000000000000000000000000000000000000",this.utxos=[];let r=0n;e.inputs.forEach(o=>{this.inputs.push({previousOutpoint:{transactionId:o.txId,index:o.vOut},signatureScript:"",sequence:"0",sigOpCount:1}),this.utxos.push({pkScript:(0,M.payToAddrScript)(o.address),amount:o.amount}),r+=BigInt(o.amount)});let n=0n;e.outputs.forEach(o=>{this.outputs.push({scriptPublicKey:{version:0,scriptPublicKey:a.base.toHex((0,M.payToAddrScript)(o.address))},amount:o.amount}),n+=BigInt(o.amount)});let s=r-n-BigInt(e.fee);s>=BigInt(e.dustSize||546)&&this.outputs.push({scriptPublicKey:{version:0,scriptPublicKey:a.base.toHex((0,M.payToAddrScript)(e.address))},amount:s.toString()})}sign(e){return this.inputs.forEach((r,n)=>{let s=Me(this,se,n,{}),o=oe.signUtil.schnorr.secp256k1.schnorr.sign(s,a.base.toHex(a.base.fromHex(e)));r.signatureScript=a.base.toHex(i.Buffer.concat([i.Buffer.from([65]),o,i.Buffer.from([se])]))}),this}getMessage(){return JSON.stringify({transaction:{version:this.version,inputs:this.inputs,outputs:this.outputs,lockTime:this.lockTime,subnetworkId:this.subnetworkId},allowOrphan:!1})}};v.Transaction=H;var se=1,Te=2,ke=4,ie=128,ae=7;function ce(t){return(t&ae)===Te}function ue(t){return(t&ae)===ke}function j(t){return(t&ie)===ie}function Me(t,e,r,n={}){let s=new p;s.writeUInt16LE(t.version),s.writeHash(Ne(t,e,n)),s.writeHash(De(t,e,n)),s.writeHash(ze(t,e,n));let o=t.inputs[r],c=t.utxos[r];return le(s,o),s.writeUInt16LE(0),s.writeVarBytes(c.pkScript),s.writeUInt64LE(BigInt(c.amount)),s.writeUInt64LE(BigInt(o.sequence)),s.writeUInt8(1),s.writeHash(Fe(t,r,e,n)),s.writeUInt64LE(BigInt(t.lockTime)),s.writeHash(je()),s.writeUInt64LE(0n),s.writeHash(m()),s.writeUInt8(e),s.finalize()}function m(){return i.Buffer.alloc(32)}function je(){return i.Buffer.alloc(20)}function Ne(t,e,r){if(j(e))return m();if(!r.previousOutputsHash){let n=new p;t.inputs.forEach(s=>le(n,s)),r.previousOutputsHash=n.finalize()}return r.previousOutputsHash}function De(t,e,r){if(ue(e)||j(e)||ce(e))return m();if(!r.sequencesHash){let n=new p;t.inputs.forEach(s=>n.writeUInt64LE(BigInt(s.sequence))),r.sequencesHash=n.finalize()}return r.sequencesHash}function ze(t,e,r){if(j(e))return m();if(!r.sigOpCountsHash){let n=new p;t.inputs.forEach(s=>n.writeUInt8(1)),r.sigOpCountsHash=n.finalize()}return r.sigOpCountsHash}function Fe(t,e,r,n){if(ce(r))return m();if(ue(r))return e>=t.outputs.length?m():new p().finalize();if(!n.outputsHash){let s=new p;t.outputs.forEach(o=>Ge(s,o)),n.outputsHash=s.finalize()}return n.outputsHash}function le(t,e){t.writeHash(a.base.fromHex(e.previousOutpoint.transactionId)),t.writeUInt32LE(e.previousOutpoint.index)}function Ge(t,e){t.writeUInt64LE(BigInt(e.amount)),t.writeUInt16LE(0),t.writeVarBytes(a.base.fromHex(e.scriptPublicKey.scriptPublicKey))}var p=class{constructor(){this.bufLen=0,this.bufs=[]}toBuffer(){return this.concat()}concat(){return i.Buffer.concat(this.bufs,this.bufLen)}write(e){return this.bufs.push(e),this.bufLen+=e.length,this}writeReverse(e){return this.bufs.push(e.reverse()),this.bufLen+=e.length,this}writeHash(e){return this.write(e),this}writeVarBytes(e){return this.writeUInt64LE(BigInt(e.length)),this.write(e),this}writeUInt8(e){let r=i.Buffer.alloc(1);return r.writeUInt8(e),this.write(r),this}writeUInt16LE(e){let r=i.Buffer.alloc(2);return r.writeUInt16LE(e),this.write(r),this}writeUInt32LE(e){let r=i.Buffer.alloc(4);return r.writeUInt32LE(e,0),this.write(r),this}writeUInt64LE(e){let r=i.Buffer.alloc(8);return r.writeBigUInt64LE(e),this.write(r),this}finalize(){return a.base.blake2(this.toBuffer(),256,Ae)}}});var he=w(B=>{l();h();Object.defineProperty(B,"__esModule",{value:!0});B.KaspaWallet=void 0;var U=S(),C=k(),L=N(),D=class extends U.BaseWallet{async getDerivedPath(e){return`m/44'/111111'/0'/0/${e.index}`}async getNewAddress(e){return Promise.resolve({address:(0,C.addressFromPrvKey)(e.privateKey),publicKey:(0,C.pubKeyFromPrvKey)(e.privateKey)})}async validPrivateKey(e){let n={isValid:(0,C.checkPrvKey)(e.privateKey),privateKey:e.privateKey};return Promise.resolve(n)}async validAddress(e){return Promise.resolve({isValid:(0,C.validateAddress)(e.address),address:e.address})}async signTransaction(e){try{return Promise.resolve((0,L.transfer)(e.data,e.privateKey))}catch{return Promise.reject(U.SignTxError)}}async calcTxHash(e){try{return typeof e.data=="string"?Promise.resolve((0,L.calcTxHash)(JSON.parse(e.data).transaction)):Promise.resolve((0,L.calcTxHash)(e.data.transaction))}catch{return Promise.reject(U.CalcTxHashError)}}async signMessage(e){try{return Promise.resolve((0,L.signMessage)(e.data.message,e.privateKey))}catch{return Promise.reject(U.SignTxError)}}};B.KaspaWallet=D});var We=w(b=>{l();h();var Re=b&&b.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),z=b&&b.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Re(e,t,r)};Object.defineProperty(b,"__esModule",{value:!0});z(he(),b);z(k(),b);z(N(),b)});export{We as a};
//# sourceMappingURL=chunk-U2XY7PNQ.js.map
