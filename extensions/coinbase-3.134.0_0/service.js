/*! For license information please see service.js.LICENSE.txt */
try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="030896e0-0886-4a2c-b8b8-ec3ffd5d61a6",e._sentryDebugIdIdentifier="sentry-dbid-030896e0-0886-4a2c-b8b8-ec3ffd5d61a6")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"3.134.0-bffc4d"}}catch(e){}}(),(()=>{var e={34767:(e,t,n)=>{"use strict";n.d(t,{$s:()=>gt,DD:()=>Jt,I5:()=>f,N8:()=>wt,Po:()=>Qt,TT:()=>g,Ts:()=>jt,X2:()=>y,br:()=>zt,ls:()=>Bt,om:()=>Yt,vj:()=>m});var i=n(18047),r=n.n(i),a=n(68839);n(14041);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,s,o=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=a.call(n)).done)&&(o.push(i.value),o.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let h=function(e){return e.fbclid="fbclid",e.gclid="gclid",e.msclkid="msclkid",e.ptclid="ptclid",e.ttclid="ttclid",e.utm_source="utm_source",e.utm_medium="utm_medium",e.utm_campaign="utm_campaign",e.utm_term="utm_term",e.utm_content="utm_content",e}({});let p=function(e){return e.low="low",e.high="high",e}({}),m=function(e){return e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram",e}({}),f=function(e){return e.unknown="unknown",e.banner="banner",e.button="button",e.card="card",e.chart="chart",e.content_script="content_script",e.dropdown="dropdown",e.link="link",e.page="page",e.modal="modal",e.table="table",e.search_bar="search_bar",e.service_worker="service_worker",e.text="text",e.text_input="text_input",e.tray="tray",e.checkbox="checkbox",e.icon="icon",e.app="app",e}({}),y=function(e){return e.unknown="unknown",e.blur="blur",e.click="click",e.change="change",e.dismiss="dismiss",e.focus="focus",e.hover="hover",e.select="select",e.measurement="measurement",e.move="move",e.process="process",e.render="render",e.scroll="scroll",e.view="view",e.search="search",e.keyPress="keyPress",e}({}),g=function(e){return e.unknown="unknown",e.web="web",e.android="android",e.ios="ios",e.mobile_web="mobile_web",e.tablet_web="tablet_web",e.server="server",e.windows="windows",e.macos="macos",e.extension="extension",e}({}),b=function(e){return e[e.notLoggedIn=0]="notLoggedIn",e[e.loggedIn=1]="loggedIn",e}({}),w=function(e){return e.ac="ac",e.af="af",e.ah="ah",e.al="al",e.am="am",e.ar="ar",e.as="as",e}({}),_=function(e){return e.pv="pv",e}({}),v=function(e){return e.xs="xs",e.s="s",e.m="m",e.l="l",e.xl="xl",e.xxl="xxl",e}({});const E="https://analytics-service-dev.cbhq.net",T=5e3,N="analytics-db",A="experiment-exposure-db",S="Analytics SDK:",x=Object.values(h),C="pageview",M="session_duration",R={navigationTiming:{eventName:"perf_navigation_timing"},redirectTime:{eventName:"perf_redirect_time"},RT:{eventName:"perf_redirect_time"},TTFB:{eventName:"perf_time_to_first_byte"},networkInformation:{eventName:"perf_network_information"},storageEstimate:{eventName:"perf_storage_estimate"},FCP:{eventName:"perf_first_contentful_paint"},FID:{eventName:"perf_first_input_delay"},LCP:{eventName:"perf_largest_contentful_paint"},CLS:{eventName:"perf_cumulative_layout_shift"},TBT:{eventName:"perf_total_blocking_time"},NTBT:{eventName:"perf_navigation_total_blocking_time"},INP:{eventName:"perf_interact_to_next_paint"},ET:{eventName:"perf_element_timing"},userJourneyStep:{eventName:"perf_user_journey_step"}},k="1",O="web",I=["access_token","refresh_token","reset_token"],P=/^(https?:\/\/)/;function D(e){return{eventsEndpoint:e+"/amp",metricsEndPoint:e+"/metrics",exposureEndpoint:e+"/track-exposures",tracesEndpoint:e+"/traces"}}const L=l(l({authCookie:"logged_in",amplitudeApiKey:"",batchEventsPeriod:T,batchEventsThreshold:30,batchMetricsPeriod:T,batchMetricsThreshold:30,batchTracesPeriod:T,batchTracesThreshold:30,headers:{},interactionManager:null,isAlwaysAuthed:!1,isProd:!1,isInternalApplication:!1,onError:(e,t)=>{console.error(S,e,t)},platform:g.unknown,projectName:"",ricTimeoutScheduleEvent:1e3,ricTimeoutSetDevice:500,showDebugLogging:!1,trackUserId:!1,version:null,apiEndpoint:E},D(E)),{},{steps:{},disableReporting:!1});const q=function(e,...t){return t.reduce(((e,t)=>n=>e(t(n))),e)}((e=>{if(!e.isProd)return e.isInternalApplication?(e.apiEndpoint="https://analytics-service-internal-dev.cbhq.net",l(l({},e),D(e.apiEndpoint))):e;const t=(e=>e.apiEndpoint?P.test(e.apiEndpoint)?e.apiEndpoint:`https://${e.apiEndpoint}`:e.isInternalApplication?"https://analytics-service-internal.cbhq.net":"https://as.coinbase.com")(e);return l(l({},e),{},{apiEndpoint:t},D(t))}),(function(e){const t=e.revokedQueryParams?e.revokedQueryParams:[];return l(l({},e),{},{revokedQueryParams:I.concat(t)})}),(function(e){return e.disableReporting&&Object.assign(e,l(l({},e),{},{onError:()=>{}})),l({},e)})),$=e=>{const t=[e.batchEventsThreshold,e.batchMetricsThreshold,e.batchTracesThreshold];for(const e of t)if((e||0)>30){console.warn("You are setting the threshhold for the batch limit to be greater than 30. This may cause request overload.");break}Object.assign(L,q(e))},j=[g.web,g.mobile_web,g.tablet_web],B=560,U=1024;function V(){return"android"===L.platform}function F(){return"ios"===L.platform}function K(){return j.includes(L.platform)}function W(e){if(K()&&navigator&&"serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage(e)}catch(e){e instanceof Error&&L.onError(e)}}const H={amplitudeOSName:null,amplitudeOSVersion:null,amplitudeDeviceModel:null,browserName:null,browserMajor:null,osName:null,userAgent:null,width:null,height:null},Q={countryCode:null,deviceId:null,device_os:null,isOptOut:!1,locale:null,jwt:null,session_lcc_id:null,userAgent:null,userId:null},z=e=>e?(e^16*Math.random()>>e/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,z),G=()=>L.isAlwaysAuthed||!!Q.userId,Y=()=>{const e={};return Q.countryCode&&(e.country_code=Q.countryCode),e},J=()=>{const e=L.platform;if(e===g.web)switch(!0){case window.matchMedia(`(max-width: ${B}px)`).matches:return g.mobile_web;case window.matchMedia(`(max-width: ${U}px, min-width: ${B+1}px)`).matches:return g.tablet_web}return e},X=()=>{K()?("requestIdleCallback"in window?window.requestIdleCallback(ne,{timeout:L.ricTimeoutSetDevice}):ne(),H.userAgent=window?.navigator?.userAgent||null,ee({height:window?.innerHeight??null,width:window?.innerWidth??null})):(F()||V())&&(H.userAgent=Q.userAgent,H.userAgent&&ne())},Z=e=>{Object.assign(Q,e),K()&&W({identity:{isAuthed:!!Q.userId,locale:Q.locale||null}})},ee=e=>{H.height=e.height,H.width=e.width},te=()=>{$({platform:J()}),K()&&W({config:{platform:L.platform}})},ne=()=>{performance.mark&&performance.mark("ua_parser_start");const e=new(r())(H.userAgent??"").getResult();H.browserName=e.browser.name||null,H.browserMajor=e.browser.major||null,H.osName=e.os.name||null,H.amplitudeOSName=H.browserName,H.amplitudeOSVersion=H.browserMajor,H.amplitudeDeviceModel=H.osName,W({device:{browserName:H.browserName,osName:H.osName}}),performance.mark&&(performance.mark("ua_parser_end"),performance.measure("ua_parser","ua_parser_start","ua_parser_end"))},ie={breadcrumbs:[],initialUAAData:{},pageKey:"",pageKeyRegex:{},pagePath:"",prevPageKey:"",prevPagePath:""};const re={eventId:0,sequenceNumber:0,sessionId:0,lastEventTime:0,sessionStart:0,sessionUUID:null,userId:null,ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0};function ae(e){Object.assign(re,e)}function se(){return document?.referrer??""}const oe=()=>K()?(Object.keys(ie.initialUAAData).length>0||(new URLSearchParams(de()),ie.initialUAAData=l(l(l({},le()),ce()),(()=>{const e=se();if(!e)return{};const t=new URL(e);return t.hostname===ue()?{}:{referrer:e,referring_domain:t.hostname}})())),ie.initialUAAData):ie.initialUAAData,ce=()=>{const e=new URLSearchParams(de()),t={};return x.forEach((n=>{e.has(n)&&(t[n]=(e.get(n)||"").toLowerCase())})),t},le=()=>{const e={};return x.forEach((t=>{re[t]&&(e[t]=re[t])})),e},ue=()=>window?.location?.hostname||"",de=()=>L.revokedQueryParams?function(e,t){const n=new RegExp(`[&?]${t.join("=.*?(&|$)|")}=.*?(&|$)`,"g");return e.replace(n,"").replace(/^&/,"?")}(window?.location?.search||"",L.revokedQueryParams):window?.location?.search||"",he=()=>window?.location?.pathname||"",pe=()=>{const e=L.overrideWindowLocation?ie.pagePath:he()+de();e&&e!==ie.pagePath&&(e!==ie.pagePath&&me(),ie.pagePath=e,ie.pageKeyRegex&&Object.keys(ie.pageKeyRegex).some((e=>{if(ie.pageKeyRegex[e].test(ie.pagePath))return ie.pageKey=e,!0})))},me=()=>{if(K()){const e=se();if(!ie.prevPagePath&&e){const t=new URL(e);if(t.hostname===ue())return void(ie.prevPagePath=t.pathname)}}ie.prevPagePath=ie.pagePath,ie.prevPageKey=ie.pageKey},fe=e=>{K()&&Object.assign(e,oe())},ye=/^[a-zd]+(_[a-zd]+)*$/;const ge=["action","component_type","component_name","context","logging_id"],be=["num_non_hardware_accounts","ujs"],we={};function _e(e){const t=Object.entries(e).reduce(((e,t)=>{const n=s(t,2),i=n[0],r=n[1];return!ge.includes(i)&&be.includes(i)?function(e){return ye.test(e)}(i)?l(l({},e),{},{[i]:r}):(L.onError(new Error("IdentityFlow property names must have snake case format"),{[i]:r}),e):e}),{});t.ujs?.length&&(t.ujs=t.ujs.map((e=>`ujs_${e}`))),Object.assign(we,t)}function ve(){return L.platform!==g.unknown||(L.onError(new Error("SDK platform not initialized")),!1)}const Ee={eventsQueue:[],eventsScheduled:!1,metricsQueue:[],metricsScheduled:!1,tracesQueue:[],tracesScheduled:!1};function Te(e){Object.assign(Ee,e)}const Ne={ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0},Ae={ac:20,af:5,ah:1,al:1,am:0,ar:10,as:20},Se={pv:25},xe=15,Ce=60,Me=240,Re=960,ke=3840,Oe={xs:0,s:1,m:1,l:2,xl:2,xxl:2},Ie=e=>e<xe?v.xs:e<Ce?v.s:e<Me?v.m:e<Re?v.l:e<ke?v.xl:v.xxl,Pe=e=>{Object.assign(Ne,e)},De=e=>{(e=>{switch(e.action){case y.click:Ne.ac+=1;break;case y.focus:Ne.af+=1;break;case y.hover:Ne.ah+=1;break;case y.move:Ne.am+=1;break;case y.scroll:Ne.al+=1;break;case y.search:Ne.ar+=1;break;case y.select:Ne.as+=1}})(e),e.event_type!==C?e.event_type===M&&((e=>{if(!e.session_rank)return;const t=e.session_rank;Object.values(w).forEach((e=>{Ne.sqs+=Ne[e]*Ae[e]})),Object.values(_).forEach((e=>{Ne.sqs+=Ne[e]*Se[e]})),Ne.sqs*=Oe[t]})(e),Object.assign(e,Ne),Pe({ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0})):Ne.pv+=1};function Le(){return(new Date).getTime()}const qe={timeStart:Le(),timeOnPagePath:0,timeOnPageKey:0,prevTimeOnPagePath:0,prevTimeOnPageKey:0,sessionDuration:0,sessionEnd:0,sessionStart:0,prevSessionDuration:0};function $e(e){Object.assign(qe,e)}const je={isReady:!1,idbKeyval:null};function Be(e){Object.assign(je,e)}const Ue=async()=>{let e;try{if(K()&&window?.indexedDB){const t=await(0,a.P2)("keyval-store",1,{upgrade(e){e.createObjectStore("keyval")}});e={get:async e=>t.get("keyval",e),set:async(e,n)=>t.put("keyval",n,e),delete:async e=>t.delete("keyval",e),keys:async()=>t.getAllKeys("keyval")}}}catch(e){let t=e;L.onError(t,{type:"openDB",message:t.message})}e=e??function(){const e={};return{get:async t=>Promise.resolve(e[t]),set:async(t,n)=>(e[t]=n,Promise.resolve(t)),delete:async t=>(delete e[t],Promise.resolve()),keys:async()=>Promise.resolve(Object.keys(e))}}(),Be({idbKeyval:e})},Ve=async e=>{if(!je.idbKeyval)return Promise.resolve(null);try{return await je.idbKeyval.get(e)}catch{return L.onError(new Error("IndexedDB:Get:InternalError")),Promise.resolve(null)}},Fe=async(e,t)=>{if(je.idbKeyval)try{await je.idbKeyval.set(e,t)}catch{L.onError(new Error("IndexedDB:Set:InternalError"))}},Ke=()=>{"server"!==L.platform&&(ae({sessionStart:qe.sessionStart,ac:Ne.ac,af:Ne.af,ah:Ne.ah,al:Ne.al,am:Ne.am,ar:Ne.ar,as:Ne.as,pv:Ne.pv}),Q.userId&&ae({userId:Q.userId}),Fe(N,re))},We="rgb(5,177,105)",He=11,Qe=e=>{const t=e.metricName,n=e.data,i=e.importance||p.low;if(!L.showDebugLogging||!console)return;const r=`%c ${S}`,a=`color:${We};font-size:${He}px;`,s=`Importance: ${i}`;console.group(r,a,t,s),n.forEach((e=>{e.event_type?console.log(e.event_type,e):console.log(e)})),console.groupEnd()},ze=e=>{const t=e.metricName,n=e.data,i=e.importance||p.low;if(!L.showDebugLogging||!console)return;const r=`color:${We};font-size:${He}px;`,a=`%c ${S}`,s=`Importance: ${i}`;console.log(a,r,t,n,s)},Ge=e=>e-re.lastEventTime>18e5,Ye=e=>{De(e);const t=e.event_type;delete e.event_type;const n=e.deviceId?e.deviceId:null,i=e.timestamp;return delete e.timestamp,ae({eventId:re.eventId+1}),ae({sequenceNumber:re.sequenceNumber+1}),(()=>{const e=Le();re.sessionId&&re.lastEventTime&&re.sessionUUID&&!Ge(e)||(re.sessionId=e,re.sessionUUID=z(),$e({sessionStart:e}),ze({metricName:"Started new session:",data:{persistentData:re,timeStone:qe}})),re.lastEventTime=e})(),Ke(),{device_id:Q.deviceId||n||null,user_id:Q.userId,timestamp:i,event_id:re.eventId,session_id:re.sessionId||-1,event_type:t,version_name:L.version||null,platform:L.platform||null,os_name:H.amplitudeOSName,os_version:H.amplitudeOSVersion,device_model:H.amplitudeDeviceModel,language:Q.locale,event_properties:l(l({},e),{},{session_uuid:re.sessionUUID,height:H.height,width:H.width}),user_properties:Y(),uuid:z(),library:{name:"@cbhq/client-analytics",version:"11.0.5"},sequence_number:re.sequenceNumber,user_agent:H.userAgent||Q.userAgent}},Je=e=>e.map((e=>Ye(e))),Xe=e=>e.map((e=>(e=>{const t=e.tags||{},n=l(l({authed:G()?"true":"false",platform:L.platform},t),{},{project_name:L.projectName,version_name:L.version||null});return{metric_name:e.metricName,page_path:e.pagePath||null,value:e.value,tags:n,type:e.metricType}})(e))),Ze=e=>0!==Ee.metricsQueue.length&&(Ee.metricsQueue.length>=L.batchMetricsThreshold||(Ee.metricsScheduled||(Ee.metricsScheduled=!0,setTimeout((()=>{Ee.metricsScheduled=!1,e(Xe(Ee.metricsQueue)),Ee.metricsQueue=[]}),L.batchMetricsPeriod)),!1)),et=e=>0!==Ee.tracesQueue.length&&(Ee.tracesQueue.length>=L.batchTracesThreshold||(Ee.tracesScheduled||(Ee.tracesScheduled=!0,setTimeout((()=>{Ee.tracesScheduled=!1,e(Ee.tracesQueue),Ee.tracesQueue=[]}),L.batchTracesPeriod)),!1)),tt=e=>{K()&&window?.requestIdleCallback?window.requestIdleCallback(e,{timeout:L.ricTimeoutScheduleEvent}):(V()||F())&&L.interactionManager?L.interactionManager.runAfterInteractions(e):e()},nt="application/x-www-form-urlencoded; charset=UTF-8";const it=e=>{const t=e.data,n=e.importance,i=e.isJSON,r=e.onError,a=e.url,s=n||p.low,o=function({isJSON:e,data:t}){const n=!K()||e;return{contentType:n?"application/json":nt,body:n?JSON.stringify(t):new URLSearchParams(t).toString()}}({isJSON:i,data:t}),c=o.body,u=o.contentType;function d(){const e=new XMLHttpRequest;e.open("POST",a,!0),Object.keys(L.headers||{}).forEach((t=>{e.setRequestHeader(t,L.headers[t])})),e.setRequestHeader("Content-Type",nt),Q.jwt&&e.setRequestHeader("authorization",`Bearer ${Q.jwt}`),e.send(c)}if(!K()||i||!("sendBeacon"in navigator)||s!==p.low||L.headers&&0!==Object.keys(L.headers).length)if(K()&&!i)d();else{const e=l(l({},L.headers),{},{"Content-Type":u});Q.jwt&&(e.Authorization=`Bearer ${Q.jwt}`),fetch(a,{method:"POST",mode:"no-cors",headers:e,body:c}).catch((e=>{r(e,{context:"AnalyticsSDKApiError"})}))}else{const e=new Blob([c],{type:nt});try{navigator.sendBeacon.bind(navigator)(a,e)||d()}catch(e){L.onError(e),d()}}};class rt extends Error{constructor(e){super(e),this.name="CircularJsonReference",this.message=e,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(e).stack}}class at extends rt{constructor(...e){super(...e),this.name="DomReferenceInAnalyticsEvent"}}const st=(e,t=p.low)=>{var n;(e&&Ee.eventsQueue.push(e),je.isReady)&&(!L.trackUserId||Q.userId?(t===p.high||(n=ot,0!==Ee.eventsQueue.length&&(Ee.eventsQueue.length>=L.batchEventsThreshold||(Ee.eventsScheduled||(Ee.eventsScheduled=!0,setTimeout((()=>{Ee.eventsScheduled=!1,n(Je(Ee.eventsQueue)),Ee.eventsQueue=[]}),L.batchEventsPeriod)),0))))&&ct(t):Ee.eventsQueue.length>10&&(L.trackUserId=!1,L.onError(new Error("userId not set in Logged-in"))))},ot=(e,t=p.low)=>{if(Q.isOptOut||0===e.length)return;let n;try{n=JSON.stringify(e)}catch(t){const i=e.map((e=>e.event_type)).join(", "),r=s((e=>{try{const n=[];for(const i of e){const e=l({},i);i.event_properties&&(e.event_properties=l(l({},e.event_properties),{},{currentTarget:null,target:null,relatedTarget:null,_dispatchInstances:null,_targetInst:null,view:(t=i.event_properties.view,["string","number","boolean"].includes(typeof t)?i.event_properties.view:null)})),n.push(e)}return[!0,JSON.stringify(n)]}catch(e){return[!1,""]}var t})(e),2),a=r[0],o=r[1];if(!a)return void L.onError(new rt(t instanceof Error?t.message:"unknown"),{listEventType:i});n=o,L.onError(new at("Found DOM element reference"),{listEventType:i,stringifiedEventData:n})}const i=l(l({},{e:n,v:"2",upload_time:Le().toString()}),{},{client:L.amplitudeApiKey});it({url:L.eventsEndpoint,data:i,importance:t,onError:L.onError}),Qe({metricName:"Batch Events",data:e,importance:t})},ct=(e=p.low)=>{ot(Je(Ee.eventsQueue),e),Te({eventsQueue:[]})},lt=Object.values(y),ut=Object.values(f),dt=e=>lt.includes(e)?e:y.unknown,ht=e=>ut.includes(e)?e:f.unknown,pt=(e,t,n)=>{const i={auth:G()?b.loggedIn:b.notLoggedIn,action:dt(e),component_type:ht(t),logging_id:n,platform:L.platform,project_name:L.projectName};return"number"==typeof Q.userTypeEnum&&(i.user_type_enum=Q.userTypeEnum),i},mt=e=>{const t=Le();if(!e)return L.onError(new Error("missing logData")),l(l({},pt(y.unknown,f.unknown)),{},{locale:Q.locale,session_lcc_id:Q.session_lcc_id,timestamp:t,time_start:qe.timeStart});const n=l(l(l({},e),pt(e.action,e.componentType,e.loggingId)),{},{locale:Q.locale,session_lcc_id:Q.session_lcc_id,timestamp:t,time_start:qe.timeStart});return delete n.componentType,delete n.loggingId,n},ft={blacklistRegex:[],isEnabled:!1};function yt(){return{page_key:ie.pageKey,page_path:ie.pagePath,prev_page_key:ie.prevPageKey,prev_page_path:ie.prevPagePath}}function gt(e,t,n=p.low){if(Q.isOptOut)return;if(!ve())return;const i=mt(t);!function(e){ft.isEnabled&&(pe(),Object.assign(e,yt()))}(i),fe(i),function(e){Object.keys(we).length>0&&Object.assign(e,we)}(i),i.has_double_fired=!1,i.event_type=e,n===p.high?st(i,n):tt((()=>{st(i)}))}function bt(e,t=!1){t?it({url:L.metricsEndPoint,data:{metrics:e},isJSON:!0,onError:L.onError}):tt((()=>{it({url:L.metricsEndPoint,data:{metrics:e},isJSON:!0,onError:L.onError})})),Qe({metricName:"Batch Metrics",data:e})}function wt(e){if(!ve())return;g.server!==L.platform&&!e.pagePath&&ie.pagePath&&(e.pagePath=ie.pagePath);const t=l(!Object.keys(we).length?l({},e.tags):l(l({},e.tags),we),{},{locale:Q.locale});if(t&&Object.assign(e,{tags:t}),Ee.metricsQueue.push(e),Ze(bt)){bt(Xe(Ee.metricsQueue)),Ee.metricsQueue=[]}}function _t(e){return e.toLowerCase()}let vt={};const Et=(e,t)=>{L?.onMarkStep&&L.onMarkStep(e,t),_e({ujs:t})};let Tt;const Nt={Perfume:()=>{},markStep:e=>{},markStepOnce:e=>{},incrementUjNavigation:()=>{}},At=()=>{if(K())try{const e=n(73623);Nt.markStep=e.markStep,Nt.markStepOnce=e.markStepOnce,Nt.incrementUjNavigation=e.incrementUjNavigation,Tt=new e.Perfume({analyticsTracker:e=>{const t=e.data,n=e.attribution,i=e.metricName,r=e.navigatorInformation,a=e.rating,s=R[i];if(!s&&!n?.category)return;const o=r?.deviceMemory||0,c=r?.hardwareConcurrency||0,u=r?.isLowEndDevice||!1,d=r?.isLowEndExperience||!1,h=r?.serviceWorkerStatus||"unsupported",p=l({deviceMemory:o,hardwareConcurrency:c,isLowEndDevice:u,isLowEndExperience:d,serviceWorkerStatus:h},vt),g={is_low_end_device:u,is_low_end_experience:d,page_key:ie.pageKey||"",save_data:t.saveData||!1,service_worker:h,is_perf_metric:!0};if("navigationTiming"===i)t&&"number"==typeof t.redirectTime&&wt({metricName:R.redirectTime.eventName,metricType:m.histogram,tags:g,value:t.redirectTime||0});else if("TTFB"===i)gt(s.eventName,l({action:y.measurement,componentType:f.page,duration:t||null,vitalsScore:a||null},p)),wt({metricName:R.TTFB.eventName,metricType:m.histogram,tags:l({},g),value:t}),a&&wt({metricName:`perf_web_vitals_ttfb_${a}`,metricType:m.count,tags:g,value:1});else if("networkInformation"===i)t?.effectiveType&&(vt=t,gt(s.eventName,{action:y.measurement,componentType:f.page,networkInformationDownlink:t.downlink,networkInformationEffectiveType:t.effectiveType,networkInformationRtt:t.rtt,networkInformationSaveData:t.saveData,navigatorDeviceMemory:o,navigatorHardwareConcurrency:c}));else if("storageEstimate"===i)gt(s.eventName,l(l({action:y.measurement,componentType:f.page},t),p)),wt({metricName:"perf_storage_estimate_caches",metricType:m.histogram,tags:g,value:t.caches}),wt({metricName:"perf_storage_estimate_indexed_db",metricType:m.histogram,tags:g,value:t.indexedDB});else if("CLS"===i)gt(s.eventName,l({action:y.measurement,componentType:f.page,score:100*t||null,vitalsScore:a||null},p)),a&&wt({metricName:`perf_web_vitals_cls_${a}`,metricType:m.count,tags:g,value:1});else if("FID"===i){const e=n?.performanceEntry||null,i=parseInt(e?.processingStart||"");gt(s.eventName,l({action:y.measurement,componentType:f.page,duration:t||null,processingStart:e?.processingStart?i:null,startTime:e?.startTime?parseInt(e.startTime):null,vitalsScore:a||null},p)),a&&wt({metricName:`perf_web_vitals_fidVitals_${a}`,metricType:m.count,tags:g,value:1})}else"userJourneyStep"===i?(gt("perf_user_journey_step",l({action:y.measurement,componentType:f.page,duration:t||null,rating:a??null,step_name:n?.stepName||""},p)),wt({metricName:`user_journey_step.${L.projectName}.${L.platform}.${n?.stepName||""}_vitals_${a}`,metricType:m.count,tags:g,value:1}),wt({metricName:`user_journey_step.${L.projectName}.${L.platform}.${n?.stepName||""}`,metricType:m.distribution,tags:g,value:t||null})):R[i]&&t&&(gt(s.eventName,l({action:y.measurement,componentType:f.page,duration:t||null,vitalsScore:a||null},p)),a&&(wt({metricName:`perf_web_vitals_${_t(i)}_${a}`,metricType:m.count,tags:g,value:1}),"LCP"===i&&wt({metricName:`perf_web_vitals_${_t(i)}`,metricType:m.distribution,tags:g,value:t})))},maxMeasureTime:3e4,steps:L.steps,onMarkStep:Et})}catch(e){e instanceof Error&&L.onError(e)}};let St=!1,xt=!1;const Ct=e=>{St=!e.persisted},Mt=(e,t="hidden",n=!1)=>{xt||(addEventListener("pagehide",Ct),addEventListener("beforeunload",(()=>{})),xt=!0),addEventListener("visibilitychange",(({timeStamp:n})=>{document.visibilityState===t&&e({timeStamp:n,isUnloading:St})}),{capture:!0,once:n})};const Rt=36e3;function kt(){const e=Ge(Le());if(e&&(x.forEach((e=>{re[e]&&delete re[e]})),Ke()),!re.lastEventTime||!qe.sessionStart||!e)return;const t=Math.round((re.lastEventTime-qe.sessionStart)/1e3);if(t<1||t>Rt)return;const n=Ie(t);gt(M,{action:y.measurement,componentType:f.page,session_duration:t,session_end:re.lastEventTime,session_start:qe.sessionStart,session_rank:n})}function Ot(){var e;K()&&(e=()=>{te(),ee({width:window?.innerWidth??null,height:window?.innerHeight??null})},addEventListener("resize",(()=>{requestAnimationFrame((()=>{e()}))})))}const It=[],Pt=[],Dt=async()=>{const e=await Ve(N);Be({isReady:!0}),Lt(),e&&(qt(),ae({eventId:e.eventId||re.eventId,sequenceNumber:e.sequenceNumber||re.sequenceNumber,sessionId:e.sessionId||re.sessionId,lastEventTime:e.lastEventTime||re.lastEventTime,sessionUUID:e.sessionUUID||re.sessionUUID}),function(e){ae(l(l({},function(e){const t={};return x.forEach((n=>{e[n]&&(t[n]=e[n])})),t}(e)),ce()))}(e),$e({sessionStart:e.sessionStart||re.sessionStart}),Pe({ac:e.ac||Ne.ac,af:e.af||Ne.af,ah:e.ah||Ne.ah,al:e.al||Ne.al,am:e.am||Ne.am,ar:e.ar||Ne.ar,as:e.as||Ne.as,pv:e.pv||Ne.pv}),L.trackUserId&&Z({userId:e.userId||Q.userId}),kt(),ze({metricName:"Initialized Analytics IndexedDB:",data:e}))},Lt=()=>{const e=It.shift();e&&e()},qt=()=>{const e=Pt.shift();e&&e()};let $t={};const jt=e=>{$(e),K()&&(Q.locale=navigator?.languages[0]||navigator?.language||""),te(),Ue(),ze({metricName:"Initialized Analytics:",data:{deviceId:Q.deviceId}}),It.push((()=>{st()})),Dt(),async function(){Ve(A).then((e=>{$t=e??{}})).catch((e=>{e instanceof Error&&L.onError(e)}))}(),X(),K()&&(Mt((()=>{ae({lastEventTime:Le()}),Ke(),ct()}),"hidden"),Mt((()=>{kt()}),"visible")),Ot(),At()},Bt=e=>{Z(e),e.userAgent&&X(),ze({metricName:"Identify:",data:{countryCode:Q.countryCode,deviceId:Q.deviceId,userId:Q.userId}})},Ut={Button:{label:"cb_button",uuid:"e921a074-40e6-4371-8700-134d5cd633e6",componentType:f.button}};function Vt(e,t,n){const i=n.componentName,r=n.data;gt(e.label,l({componentType:e.componentType,action:t,loggingId:e.uuid,component_name:i},r))}y.click,y.hover,y.click,y.hover;function Ft(e,t=!1){t?it({url:L.tracesEndpoint,data:{traces:e},isJSON:!0,onError:L.onError}):tt((()=>{it({url:L.tracesEndpoint,data:{traces:e},isJSON:!0,onError:L.onError})})),Qe({metricName:"Batch Traces",data:e})}const Kt=1e6;function Wt(e){return e*Kt}function Ht(e=function(){return window?.crypto}()){const t=new Uint32Array(2);e?.getRandomValues(t);return((BigInt(t[0])<<BigInt(32))+BigInt(t[1])).toString()}function Qt(e){return t=e.trace_id,{"x-datadog-origin":"rum","x-datadog-parent-id":e.span_id,"x-datadog-sampling-priority":"1","x-datadog-trace-id":t};var t}function zt(e){const t=e.name,n=e.traceId,i=e.spanId,r=e.start,a=e.duration,s=e.resource,o=e.meta,c=e.parentId;return{duration:a?Wt(a):0,name:t,resource:s,service:L.projectName,span_id:i??Ht(),start:r?Wt(r):0,trace_id:n??Ht(),parent_id:c??k,type:O,meta:l(l(l({platform:L.platform},ie.pageKey?{page_key:ie.pageKey}:{}),we.ujs?.length?{last_ujs:we.ujs[we.ujs.length-1]}:{}),o??{})}}function Gt(e,t){e.forEach((e=>function(e,t){const n=l(l({},e.meta),t.meta),i={start:t.start?Wt(t.start):e.start,duration:t.duration?Wt(t.duration):e.duration};Object.assign(e,t,l({meta:n},i))}(e,t)))}function Yt(e,t){ve()&&function(e){return e.length>0}(e)&&(t&&Gt(e,t),Ee.tracesQueue.push(e),et(Ft)&&(Ft(Ee.tracesQueue),Ee.tracesQueue=[]))}function Jt(){return{"X-CB-Device-ID":Q.deviceId||"unknown","X-CB-Is-Logged-In":Q.userId?"true":"false","X-CB-Pagekey":ie.pageKey||"unknown","X-CB-UJS":(e=we.ujs,void 0===e||0===e.length?"":e.join(",")),"X-CB-Platform":L.platform||"unknown","X-CB-Project-Name":L.projectName||"unknown","X-CB-Session-UUID":re.sessionUUID||"unknown","X-CB-Version-Name":L.version?String(L.version):"unknown"};var e}},86740:(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i=n(24783),r=n(1572);class a{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,t){return null!=e.version&&r.g.isGreaterOrEqual(e.version,t)}static isPostgresFamily(e){return["postgres","aurora-postgres"].includes(e.options.type)}static buildDriverOptions(e,t){if(e.url){const n=this.parseConnectionUrl(e.url);t&&t.useSid&&n.database&&(n.sid=n.database);for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return Object.assign({},e,n)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,t){if(e.url){const n=this.parseMongoDBConnectionUrl(e.url);t&&t.useSid&&n.database&&(n.sid=n.database);for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return Object.assign({},e,n)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},t,...n){"string"==typeof t?(n.unshift(t),t={shorten:!1,joiner:"_"}):t=Object.assign({shorten:!1,joiner:"_"},t);const r=1===n.length?n[0]:n.join(t.joiner);if(e&&e>0&&r.length>e){if(!0===t.shorten){const t=(0,i.ml)(r);if(t.length<e)return t}return(0,i.tW)(r,{length:e})}return r}static buildColumnAlias({maxAliasLength:e},t,...n){return this.buildAlias({maxAliasLength:e},t,...n)}static parseConnectionUrl(e){const t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),r=i.indexOf("/"),a=-1!==r?i.substr(0,r):i;let s=-1!==r?i.substr(r+1):void 0;s&&-1!==s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));const o=a.lastIndexOf("@"),c=a.substr(0,o),l=a.substr(o+1);let u=c,d="";const h=c.indexOf(":");-1!==h&&(u=c.substr(0,h),d=c.substr(h+1));const[p,m]=l.split(":");return{type:t,host:p,username:decodeURIComponent(u),password:decodeURIComponent(d),port:m?parseInt(m):void 0,database:s||void 0}}static parseMongoDBConnectionUrl(e){const t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),r=i.indexOf("/"),a=-1!==r?i.substr(0,r):i;let s,o,c,l,u=-1!==r?i.substr(r+1):void 0,d="",h={};if(u&&-1!==u.indexOf("?")){d=u.substr(u.indexOf("?")+1,u.length);let e,t;d.split("&").forEach((n=>{e=n.split("=")[0],t=n.split("=")[1],h[e]=t})),l=h.replicaSet,u=u.substr(0,u.indexOf("?"))}const p=a.lastIndexOf("@"),m=a.substr(0,p),f=a.substr(p+1);let y=m,g="";const b=m.indexOf(":");-1!==b&&(y=m.substr(0,b),g=m.substr(b+1)),l?c=f:[s,o]=f.split(":");let w={type:t,host:s,hostReplicaSet:c,username:decodeURIComponent(y),password:decodeURIComponent(g),port:o?parseInt(o):void 0,database:u||void 0};for(const[e,t]of Object.entries(h))w[e]=t;return w}}},47037:(e,t,n)=>{"use strict";var i=n(93499);i.V},34165:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Cannot attach entity "${e}" to its parent. Please make sure parent is saved in the database before saving children nodes.`)}}},28028:(e,t,n)=>{"use strict";n.d(t,{m:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super();const n=e.primaryColumns.reduce(((e,t,n)=>(t.setEntityValue(e,n+1),e)),{});this.message=`Cannot use given entity id "${t}" because "${e.targetName}" contains multiple primary columns, you must provide object in following form: ${JSON.stringify(n)} as an id.`}}},11866:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Cannot ${e}, given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.`)}}},80601:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Circular relations detected: ${e}. To resolve this issue you need to set nullable: true somewhere in this dependency structure.`)}}},80345:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super(`Column type for ${e.constructor.name}#${t} is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.`)}}},55854:(e,t,n)=>{"use strict";n.d(t,{e:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Connection with ${e} database is not established. Check connection configuration.`)}}},1430:(e,t,n)=>{"use strict";var i=n(93499);i.V},4857:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Custom repository ${"function"==typeof e?e.name:e.constructor.name} does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? `)}}},72287:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Custom repository ${"function"==typeof e?e.name:e.constructor.name} was not found. Did you forgot to put @EntityRepository decorator on it?`)}}},19108:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var i=n(93499);class r extends i.V{constructor(e,t,n){super();const i="string"==typeof t?t:t.name;this.message=`Data type "${i}" in "${e.entityMetadata.targetName}.${e.propertyName}" is not supported by "${n}" database.`}}},59855:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Driver option (${e}) is not set. Please set it to perform connection to the database.`)}}},50722:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super(`${e} package has not been found installed. Try to install it: npm install ${t} --save`)}}},81719:(e,t,n)=>{"use strict";n.d(t,{p:()=>s});var i=n(93499),r=n(91481),a=n(5471);class s extends i.V{constructor(e,t){super(),this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(t)}`}stringifyTarget(e){return a.t.isEntitySchema(e)?e.options.name:"function"==typeof e||r.B.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e}}},45200:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super(e),Object.setPrototypeOf(this,r.prototype),this.message=`Property "${e}" was not found in "${t.targetName}". Make sure your query is correct.`}}},94086:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(),1===e.length?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map((e=>`"${e}"`)).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}},13149:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "${e.entityMetadata.targetName}#${e.propertyPath}". This is ORM requirement to make relations to work properly. Refer docs for more information.`)}}},28412:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var i=n(93499);class r extends i.V{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}},71365:(e,t,n)=>{"use strict";n.d(t,{r:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}},95601:(e,t,n)=>{"use strict";n.d(t,{t:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Locking not supported on given driver.")}}},3864:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}},86741:(e,t,n)=>{"use strict";n.d(t,{d:()=>r});var i=n(93499);class r extends i.V{constructor(e,t=[]){super(`Wrong driver: "${e}" given. Supported drivers are: ${t.map((e=>`"${e}"`)).join(", ")}.`)}}},57719:(e,t,n)=>{"use strict";n.d(t,{$:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Entity "${e.name}" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.`)}}},854:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super(`Cannot ${e}, given value must be an entity, instead "${t}" is given.`)}}},63849:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Option "${e}" is not set in your connection options, please define "${e}" option in your connection options or ormconfig.json`)}}},52738:(e,t,n)=>{"use strict";n.d(t,{e:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")}}},19174:(e,t,n)=>{"use strict";n.d(t,{G:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}},86192:(e,t,n)=>{"use strict";n.d(t,{w:()=>r});var i=n(93499);class r extends i.V{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}},9772:(e,t,n)=>{"use strict";n.d(t,{M:()=>r});var i=n(93499);class r extends i.V{constructor(){super("The optimistic lock can be used only with getOne() method.")}}},97201:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var i=n(93499);class r extends i.V{constructor(e,t,n){super(`The optimistic lock on entity ${e} failed, version ${t} was expected, but is actually ${n}.`)}}},54770:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(93499);class r extends i.V{constructor(){super("An open transaction is required for pessimistic lock.")}}},52806:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});var i=n(93499);class r extends i.V{constructor(e,t){super(`Primary column ${e.constructor.name}#${t} cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.`)}}},75672:(e,t,n)=>{"use strict";n.d(t,{C:()=>a});var i=n(91481),r=n(93499);class a extends r.V{constructor(e,t,n){if(super(n.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,"")),this.query=e,this.parameters=t,this.driverError=n,n){const{name:e,...t}=n;i.B.assign(this,{...t})}}}},76320:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Query runner already released. Cannot run queries anymore.")}}},76965:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")}}},43025:(e,t,n)=>{"use strict";n.d(t,{J:()=>r});var i=n(93499);class r extends i.V{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}},83159:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Removed entity "${e.metadata.name}" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).`)}}},45046:(e,t,n)=>{"use strict";n.d(t,{S:()=>r});var i=n(93499);class r extends i.V{constructor(e){super(`Internal error. Subject ${e.metadata.targetName} must have an identifier to perform operation.`)}}},60765:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var i=n(93499);class r extends i.V{constructor(){super("Transaction is not started yet, start transaction before committing or rolling it back.")}}},93499:(e,t,n)=>{"use strict";n.d(t,{V:()=>i});class i extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}},14268:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var i=n(93499);class r extends i.V{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}},26883:(e,t,n)=>{"use strict";n.d(t,{tX:()=>r,Xp:()=>f,IU:()=>d,zB:()=>s.z,lG:()=>m.l,WZ:()=>p.W,Yg:()=>u,hz:()=>h.h,ol:()=>o,ku:()=>a,VR:()=>i.V});var i=n(93499);i.V;n(47037),n(45046);class r extends i.V{constructor(e){super(`Cannot create a "${e}" connection because connection to the database already established.`)}}n(95601),n(55854),n(28028);i.V;n(11866),n(14268);class a extends i.V{constructor(e){super(`Tree repositories are not supported in ${e.options.type} driver.`)}}var s=n(72287);n(60765);class o extends i.V{constructor(){super("Transaction already started for the given connection, commit current transaction before starting a new one.")}}n(81719);var c=n(91481),l=n(5471);class u extends i.V{constructor(e){super(),this.message=`No metadata for "${this.stringifyTarget(e)}" was found.`}stringifyTarget(e){return l.t.isEntitySchema(e)?e.options.name:"function"==typeof e||c.B.isObject(e)&&"name"in e?e.name:e}}n(854),n(97201),n(71365),n(52806);class d extends i.V{constructor(e){super(`Custom entity repository ${"function"==typeof e?e.name:e.constructor.name}  cannot inherit Repository class without entity being set in the @EntityRepository decorator.`)}}var h=n(76965);n(34165),n(4857),n(3864);i.V;n(80601),n(43025);i.V;i.V;n(57719),n(45200),n(86741);var p=n(50722);i.V;n(1430),n(19174),n(28412),n(9772);i.V;var m=n(59855);n(94086);i.V;n(54770);i.V;n(19108),n(13149);i.V;n(75672),n(52738);i.V;i.V;n(83159);i.V;i.V;n(80345),n(76320),n(86192);class f extends i.V{constructor(e){super(`Cannot execute operation on "${e}" connection because connection is not yet established.`)}}n(63849)},41598:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var i=n(5471);class r{constructor(e,t,n=!0,i=!1,r,a){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=i,this._getSql=r,this._objectLiteralParameters=a}get useParameter(){return i.t.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return i.t.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return i.t.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return i.t.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(i.t.isFindOperator(this._value))return this._value}get getSql(){return i.t.isFindOperator(this._value)?this._value.getSql:this._getSql}}},68625:(e,t,n)=>{"use strict";n.d(t,{H:()=>a});var i=n(94086),r=n(86740);class a{static isFindOneOptions(e){const t=e;return t&&(Array.isArray(t.select)||Array.isArray(t.relations)||"object"==typeof t.select||"object"==typeof t.relations||"object"==typeof t.where||"object"==typeof t.join||"object"==typeof t.order||"object"==typeof t.cache||"boolean"==typeof t.cache||"number"==typeof t.cache||"string"==typeof t.comment||"object"==typeof t.lock||"object"==typeof t.loadRelationIds||"boolean"==typeof t.loadRelationIds||"boolean"==typeof t.loadEagerRelations||"boolean"==typeof t.withDeleted||"string"==typeof t.relationLoadStrategy||"boolean"==typeof t.transaction)}static isFindManyOptions(e){const t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,t){if(null==t?void 0:t.relations){const n=[...t.relations];if(a.applyRelationsRecursively(e,n,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),n.length>0)throw new i.u(n)}return e}static applyRelationsRecursively(e,t,n,i,a){let s=[];if(a){const e=new RegExp("^"+a.replace(".","\\.")+"\\.");s=t.filter((t=>t.match(e))).map((t=>t.replace(e,""))).filter((e=>i.findRelationWithPropertyPath(e)))}else s=t.filter((e=>i.findRelationWithPropertyPath(e)));s.forEach((s=>{let o=r.I.buildAlias(e.connection.driver,{joiner:"__"},n,s);const c=n+"."+s;e.leftJoinAndSelect(c,o),t.splice(t.indexOf(a?a+"."+s:s),1);const l=e.expressionMap.joinAttributes.find((e=>e.entityOrProperty===c));this.applyRelationsRecursively(e,t,l.alias.name,l.metadata,a?a+"."+s:s);const u=i.relations.find((e=>e.propertyName===s));u&&this.joinEagerRelations(e,o,u.inverseEntityMetadata)}))}static joinEagerRelations(e,t,n){n.eagerRelations.forEach((n=>{let i=r.I.buildAlias(e.connection.driver,e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath)),a=!0;for(const r of e.expressionMap.joinAttributes)if(void 0===r.condition&&void 0===r.mapToProperty&&void 0===r.isMappingMany&&"LEFT"===r.direction&&r.entityOrProperty===`${t}.${n.propertyPath}`){a=!1,i=r.alias.name;break}a&&e.leftJoin(t+"."+n.propertyPath,i);let s=!0;for(const t of e.expressionMap.selects)if(void 0===t.aliasName&&void 0===t.virtual&&t.selection===i){s=!1;break}s&&e.addSelect(i),this.joinEagerRelations(e,i,n.inverseEntityMetadata)}))}}},80211:(e,t,n)=>{"use strict";n.d(t,{In:()=>r});var i=n(41598);function r(e){return new i.q("in",e,!0,!0)}},24611:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AuroraMysqlDriver:()=>c,AuroraPostgresDriver:()=>u,BetterSqlite3Driver:()=>y,CockroachDriver:()=>l,MongoDriver:()=>i,MongoEntityManager:()=>a,MongoQueryRunner:()=>r,MongoRepository:()=>s,MysqlDriver:()=>p,OracleDriver:()=>m,PostgresDriver:()=>o,SapDriver:()=>h,SqlServerDriver:()=>d,SqliteDriver:()=>f});class i{}class r{}class a{}class s{}class o{}class c{}class l{}class u{}class d{}class h{}class p{}class m{}class f{}class y{}},62392:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class i{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}},7109:(e,t,n)=>{"use strict";n.d(t,{N:()=>o});var i=n(50504),r=n(38689),a=n(43025),s=n(5471);class o extends i.o{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),e.trim()}async execute(){const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();let i=!1;try{!0===this.expressionMap.useTransaction&&!1===n.isTransactionActive&&(await n.startTransaction(),i=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await n.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const a=await n.query(e,t,!0),s=r.P.from(a);return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await n.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),i&&await n.commitTransaction(),s}catch(e){if(i)try{await n.rollbackTransaction()}catch(e){}throw e}finally{n!==this.queryRunner&&await n.release()}}from(e,t){e=s.t.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new a.J;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression("delete");return""===n?`DELETE FROM ${e}${t}`:"mssql"===this.connection.driver.options.type?`DELETE FROM ${e} OUTPUT ${n}${t}`:`DELETE FROM ${e}${t} RETURNING ${n}`}}},98947:(e,t,n)=>{"use strict";n.d(t,{v:()=>m});var i=n(50504),r=n(49015),a=n(43025),s=n(28412),o=n(89547),c=n(1746),l=n(26883),u=n(77981),d=n(86740),h=n(91481),p=n(5471);class m extends i.o{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),e.trim()}async execute(){const e=this.getValueSets();if(0===e.length)return new r.T;const t=this.obtainQueryRunner();let n=!1;try{if(!0===this.expressionMap.useTransaction&&!1===t.isTransactionActive&&(await t.startTransaction(),n=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata){const n=new c.M;e.forEach((e=>{t.broadcaster.broadcastBeforeInsertEvent(n,this.expressionMap.mainAlias.metadata,e)})),await n.wait()}let i=null,a=null;const s=new o.V(t,this.expressionMap),l=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const e of this.expressionMap.returning)l.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(e));!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&"oracle"===this.connection.driver.options.type||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),l.push(...this.expressionMap.extraReturningColumns.filter((e=>!l.includes(e))))),l.length>0&&"mssql"===this.connection.driver.options.type&&(i=this.connection.driver.buildTableVariableDeclaration("@OutputTable",l),a="SELECT * FROM @OutputTable");const[u,d]=this.getQueryAndParameters(),h=[i,u,a].filter((e=>null!=e)).join(";\n\n"),p=await t.query(h,d,!0),m=r.T.from(p);if(!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&await s.insert(m,e),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata){const n=new c.M;e.forEach((e=>{t.broadcaster.broadcastAfterInsertEvent(n,this.expressionMap.mainAlias.metadata,e)})),await n.wait()}return n&&await t.commitTransaction(),m}catch(e){if(n)try{await t.rollbackTransaction()}catch(e){}throw e}finally{t!==this.queryRunner&&await t.release()}}into(e,t){e=p.t.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new a.J;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,t,n){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:t,skipUpdateIfNoValuesChanged:null==n?void 0:n.skipUpdateIfNoValuesChanged},this):(this.expressionMap.onUpdate={conflict:null==e?void 0:e.conflict_target,columns:null==e?void 0:e.columns,overwrite:null==e?void 0:e.overwrite,skipUpdateIfNoValuesChanged:null==n?void 0:n.skipUpdateIfNoValuesChanged},this)}createInsertExpression(){const e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n="oracle"===this.connection.driver.options.type&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),i=this.createColumnNamesExpression();let r="INSERT ";if((d.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type)&&(r+=""+(this.expressionMap.onIgnore?" IGNORE ":"")),r+=`INTO ${e}`,this.alias!==this.getMainTableName()&&d.I.isPostgresFamily(this.connection.driver)&&(r+=` AS "${this.alias}"`),i?r+=`(${i})`:t||!d.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||(r+="()"),n&&"mssql"===this.connection.driver.options.type&&(r+=` OUTPUT ${n}`),t?"oracle"===this.connection.driver.options.type&&this.getValueSets().length>1?r+=` ${t}`:r+=` VALUES ${t}`:d.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type?r+=" VALUES ()":r+=" DEFAULT VALUES","on-conflict-do-update"===this.connection.driver.supportedUpsertType){if(this.expressionMap.onIgnore)r+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)r+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:t,columns:n,conflict:i,skipUpdateIfNoValuesChanged:a}=this.expressionMap.onUpdate;let s="ON CONFLICT";Array.isArray(i)?s+=` ( ${i.map((e=>this.escape(e))).join(", ")} )`:i&&(s+=` ON CONSTRAINT ${this.escape(i)}`),Array.isArray(t)?(r+=` ${s} DO UPDATE SET `,r+=null==t?void 0:t.map((e=>`${this.escape(e)} = EXCLUDED.${this.escape(e)}`)).join(", "),r+=" "):n&&(r+=` ${s} DO UPDATE SET `,r+=n.map((e=>`${this.escape(e)} = :${e}`)).join(", "),r+=" "),Array.isArray(t)&&a&&d.I.isPostgresFamily(this.connection.driver)&&(r+=" WHERE (",r+=t.map((t=>`${e}.${this.escape(t)} IS DISTINCT FROM EXCLUDED.${this.escape(t)}`)).join(" OR "),r+=") ")}}else if("on-duplicate-key-update"===this.connection.driver.supportedUpsertType){if(this.expressionMap.onUpdate){const{overwrite:e,columns:t}=this.expressionMap.onUpdate;Array.isArray(e)?(r+=" ON DUPLICATE KEY UPDATE ",r+=e.map((e=>`${this.escape(e)} = VALUES(${this.escape(e)})`)).join(", "),r+=" "):Array.isArray(t)&&(r+=" ON DUPLICATE KEY UPDATE ",r+=t.map((e=>`${this.escape(e)} = :${e}`)).join(", "),r+=" ")}}else if(this.expressionMap.onUpdate)throw new l.VR("onUpdate is not supported by the current database driver");return n&&(d.I.isPostgresFamily(this.connection.driver)||"oracle"===this.connection.driver.options.type||"cockroachdb"===this.connection.driver.options.type||d.I.isMySQLFamily(this.connection.driver))&&(r+=` RETURNING ${n}`),"mssql"===this.connection.driver.options.type&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter((e=>this.expressionMap.insertColumns.length>0?-1!==this.expressionMap.insertColumns.indexOf(e.propertyPath):e.isInsert)).some((e=>this.isOverridingAutoIncrementBehavior(e)))&&(r=`SET IDENTITY_INSERT ${e} ON; ${r}; SET IDENTITY_INSERT ${e} OFF`),r}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter((e=>this.expressionMap.insertColumns.length?-1!==this.expressionMap.insertColumns.indexOf(e.propertyPath):!!e.isInsert&&!!(!e.isGenerated||"increment"!==e.generationStrategy||"spanner"===this.connection.driver.options.type||"oracle"===this.connection.driver.options.type||d.I.isSQLiteFamily(this.connection.driver)||d.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"mssql"===this.connection.driver.options.type&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map((e=>this.escape(e.databaseName))).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const e=this.getValueSets();if(1===e.length)return Object.keys(e[0]).map((e=>this.escape(e))).join(", ")}return this.expressionMap.insertColumns.map((e=>this.escape(e))).join(", ")}createValuesExpression(){const e=this.getValueSets(),t=this.getInsertedColumns();if(t.length>0){let n="";return e.forEach(((i,r)=>{t.forEach(((a,s)=>{0===s&&("oracle"===this.connection.driver.options.type&&e.length>1||"sap"===this.connection.driver.options.type&&e.length>1?n+=" SELECT ":n+="(");let o=a.getEntityValue(i);if("function"!=typeof o&&(o=this.connection.driver.preparePersistentValue(o,a)),a.isVersion&&void 0===o)n+="1";else if(a.isDiscriminator)n+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(a.isGenerated&&"uuid"===a.generationStrategy&&!this.connection.driver.isUUIDGenerationSupported()&&void 0===o)o=(0,u.A)(),n+=this.createParameter(o),r in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[r]={}),a.setEntityValue(this.expressionMap.locallyGenerated[r],o);else if(void 0===o)"oracle"===this.connection.driver.options.type&&e.length>1||d.I.isSQLiteFamily(this.connection.driver)||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?void 0!==a.default&&null!==a.default?n+=this.connection.driver.normalizeDefault(a):n+="NULL":n+="DEFAULT";else if(null===o&&"spanner"===this.connection.driver.options.type)n+="NULL";else if("function"==typeof o)n+=o();else{"mssql"===this.connection.driver.options.type&&(o=this.connection.driver.parametrizeValue(a,o));const e=this.createParameter(o);if(!d.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||-1===this.connection.driver.spatialTypes.indexOf(a.type))d.I.isPostgresFamily(this.connection.driver)&&-1!==this.connection.driver.spatialTypes.indexOf(a.type)?null!=a.srid?n+=`ST_SetSRID(ST_GeomFromGeoJSON(${e}), ${a.srid})::${a.type}`:n+=`ST_GeomFromGeoJSON(${e})::${a.type}`:"mssql"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(a.type)?n+=a.type+"::STGeomFromText("+e+", "+(a.srid||"0")+")":n+=e;else{const t=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=a.srid?n+=`${t}(${e}, ${a.srid})`:n+=`${t}(${e})`}}s===t.length-1?r===e.length-1?"oracle"===this.connection.driver.options.type&&e.length>1?n+=" FROM DUAL ":"sap"===this.connection.driver.options.type&&e.length>1?n+=" FROM dummy ":n+=")":"oracle"===this.connection.driver.options.type&&e.length>1?n+=" FROM DUAL UNION ALL ":"sap"===this.connection.driver.options.type&&e.length>1?n+=" FROM dummy UNION ALL ":n+="), ":n+=", "}))})),"()"===n?"":n}{let t="";return e.forEach(((n,i)=>{Object.keys(n).forEach(((r,a)=>{0===a&&(t+="(");const s=n[r];"function"==typeof s?t+=s():void 0===s?"oracle"===this.connection.driver.options.type&&e.length>1||d.I.isSQLiteFamily(this.connection.driver)||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?t+="NULL":t+="DEFAULT":null===s&&"spanner"===this.connection.driver.options.type||(t+=this.createParameter(s)),a===Object.keys(n).length-1?i===e.length-1?t+=")":t+="), ":t+=", "}))})),"()"===t?"":t}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(h.B.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new s.s}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&"increment"===e.generationStrategy&&this.getValueSets().some((t=>void 0!==e.getEntityValue(t)&&null!==e.getEntityValue(t)))}}},29333:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var i=n(77253),r=n(91481),a=n(26883),s=n(86740);class o{constructor(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r.B.assign(this,n||{})}get isMany(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const e of this.queryExpressionMap.selects){if(e.selection===this.alias.name)return!0;if(this.metadata&&this.metadata.columns.find((t=>e.selection===this.alias.name+"."+t.propertyPath)))return!0}return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(i.n.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(i.n.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!i.n.isAliasProperty(this.entityOrProperty))return;const e=this.queryExpressionMap.findAliasByName(this.parentAlias);let t=e.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(t)return t;if(e.metadata.parentEntityMetadata&&(t=e.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),t))return t;throw new a.VR(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0}get junctionAlias(){if(!this.relation)throw new a.VR("Cannot get junction table for join without relation.");return this.relation.isOwning?s.I.buildAlias(this.connection.driver,this.parentAlias,this.alias.name):s.I.buildAlias(this.connection.driver,this.alias.name,this.parentAlias)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}},50504:(e,t,n)=>{"use strict";n.d(t,{o:()=>y});var i=n(91481),r=n(26883);class a{constructor(e){i.B.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new r.VR(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}var s=n(29333),o=n(34851),c=n(25579);class l{constructor(e){this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy)}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce(((t,n)=>(t[this.mainAlias.name+"."+n]=e[n],t)),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let t=e.name;!t&&e.tablePath&&(t=e.tablePath),t||"function"!=typeof e.target||(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);const n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n}findAliasByName(e){const t=this.aliases.find((t=>t.name===e));if(!t)throw new r.VR(`"${e}" alias was not found. Maybe you forgot to join it?`);return t}findColumnByAliasExpression(e){const[t,n]=e.split(".");return this.findAliasByName(t).metadata.findColumnWithPropertyName(n)}get relationMetadata(){if(!this.mainAlias)throw new r.VR("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new r.VR(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new l(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map((e=>e)),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach((t=>e.aliases.push(new a(t)))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map((e=>new s.L(this.connection,this,e))),e.relationIdAttributes=this.relationIdAttributes.map((e=>new o.q(this,e))),e.relationCountAttributes=this.relationCountAttributes.map((e=>new c.m(this,e))),e.wheres=this.wheres.map((e=>({...e}))),e.havings=this.havings.map((e=>({...e}))),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map((e=>e)),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map((e=>({alias:e.alias,queryBuilder:"string"==typeof e.queryBuilder?e.queryBuilder:e.queryBuilder.clone(),options:e.options}))),e}}var u=n(62392),d=n(41598),h=n(80211),p=n(45200),m=n(5471);const f=/[.*+\-?^${}()|[\]\\]/g;class y{constructor(e,t){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,m.t.isQueryBuilder(e)?(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone()):(this.connection=e,this.queryRunner=t,this.expressionMap=new l(this.connection))}get alias(){if(!this.expressionMap.mainAlias)throw new r.VR("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map((e=>({selection:e}))):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);const i=n(17915).w;return m.t.isSelectQueryBuilder(this)?this:new i(this)}insert(){this.expressionMap.queryType="insert";const e=n(98947).v;return m.t.isInsertQueryBuilder(this)?this:new e(this)}update(e,t){const i=t||e;if("function"==typeof(e=m.t.isEntitySchema(e)?e.options.name:e)||"string"==typeof e){const t=this.createFromAlias(e);this.expressionMap.setMainAlias(t)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=i;const r=n(61035).b;return m.t.isUpdateQueryBuilder(this)?this:new r(this)}delete(){this.expressionMap.queryType="delete";const e=n(7109).N;return m.t.isDeleteQueryBuilder(this)?this:new e(this)}softDelete(){this.expressionMap.queryType="soft-delete";const e=n(79081).x;return m.t.isSoftDeleteQueryBuilder(this)?this:new e(this)}restore(){this.expressionMap.queryType="restore";const e=n(79081).x;return m.t.isSoftDeleteQueryBuilder(this)?this:new e(this)}relation(e,t){const i=2===arguments.length?e:void 0,r=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=r,i){const e=this.createFromAlias(i);this.expressionMap.setMainAlias(e)}const a=n(29225).M;return m.t.isRelationQueryBuilder(this)?this:new a(this)}hasRelation(e,t){const n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every((e=>!!n.findRelationWithPropertyPath(e)))}hasParameter(e){var t;return(null===(t=this.parentQueryBuilder)||void 0===t?void 0:t.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,t){if("function"==typeof t)throw new r.VR(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new r.VR("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,t),this.expressionMap.parameters[e]=t,this}setParameters(e){for(const[t,n]of Object.entries(e))this.setParameter(t,n);return this}createParameter(e){let t;do{t="orm_param_"+this.parameterIndex++}while(this.hasParameter(t));return this.setParameter(t,e),`:${t}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach((t=>{this.expressionMap.nativeParameters[t]=e[t]})),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){const n=t.childEntityMetadatas.filter((e=>e.discriminatorColumn)).map((e=>e.discriminatorValue));n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e}printSql(){const[e,t]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,t),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)}async execute(){const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();try{return await n.query(e,t)}finally{n!==this.queryRunner&&await n.release()}}createQueryBuilder(){return new this.constructor(this.connection,this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,t,n){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:t,options:n||{}}),this}getTableName(e){return e.split(".").map((e=>""===e?e:this.escape(e))).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new r.VR('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,t){if(this.connection.hasMetadata(e)){const n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}{if("string"==typeof e){const n="("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:n?void 0:e,subQuery:n?e:void 0})}const n=e(this.subQuery());this.setParameters(n.getParameters());const i=n.getQuery();return this.expressionMap.createAlias({type:"from",name:t,subQuery:i})}}replacePropertyNames(e){for(const n of this.expressionMap.aliases){if(!n.hasMetadata)continue;const i=this.expressionMap.aliasNamePrefixingEnabled?`${n.name}.`:"",r=this.expressionMap.aliasNamePrefixingEnabled?`${this.escape(n.name)}.`:"",a={};for(const e of n.metadata.relations)e.joinColumns.length>0&&(a[e.propertyPath]=e.joinColumns[0].databaseName);for(const e of n.metadata.relations)for(const t of[...e.joinColumns,...e.inverseJoinColumns]){const n=`${e.propertyPath}.${t.referencedColumn.propertyPath}`;a[n]=t.databaseName}for(const e of n.metadata.columns)a[e.databaseName]=e.databaseName;for(const e of n.metadata.columns)a[e.propertyName]=e.databaseName;for(const e of n.metadata.columns)a[e.propertyPath]=e.databaseName;e=e.replace(new RegExp(`([ =(]|^.{0})${t=i,t.replace(f,"\\$&")}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),((e,t,n)=>a[n]?`${t}${r}${this.escape(a[n])}`:e))}var t;return e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace("*/","")} */ `:""}createWhereExpression(){const e=[],t=this.createWhereClausesExpression(this.expressionMap.wheres);if(t.length>0&&"1=1"!==t&&e.push(this.replacePropertyNames(t)),this.expressionMap.mainAlias.hasMetadata){const t=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){const n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,i=`${this.replacePropertyNames(n)} IS NULL`;e.push(i)}if(t.discriminatorColumn&&t.parentEntityMetadata){const n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,i=`${this.replacePropertyNames(n)} IN (:...discriminatorColumnValues)`;e.push(i)}}if(this.expressionMap.extraAppendedAndWhereCondition){const t=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(t)}return e.length?1===e.length?` WHERE ${e[0]}`:` WHERE ( ${e.join(" ) AND ( ")} )`:""}createReturningExpression(e){const t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported(e)&&t.push(...this.expressionMap.extraReturningColumns.filter((e=>-1===t.indexOf(e)))),t.length){let e=t.map((e=>{const t=this.escape(e.databaseName);return"mssql"===n.options.type?"insert"===this.expressionMap.queryType||"update"===this.expressionMap.queryType||"soft-delete"===this.expressionMap.queryType||"restore"===this.expressionMap.queryType?"INSERTED."+t:this.escape(this.getMainTableName())+"."+t:t})).join(", ");return"oracle"===n.options.type&&(e+=" INTO "+t.map((e=>this.createParameter({type:n.columnTypeToNativeParameter(e.type),dir:n.oracle.BIND_OUT}))).join(", ")),"mssql"===n.options.type&&("insert"!==this.expressionMap.queryType&&"update"!==this.expressionMap.queryType||(e+=" INTO @OutputTable")),e}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach((t=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(t))})),e}createWhereClausesExpression(e){return e.map(((e,t)=>{const n=this.createWhereConditionExpression(e.condition);switch(e.type){case"and":return(t>0?"AND ":"")+n;case"or":return(t>0?"OR ":"")+n}return n})).join(" ").trim()}createWhereConditionExpression(e,t=!1){if("string"==typeof e)return e;if(Array.isArray(e))return 0===e.length?"1=1":1!==e.length||t?"("+this.createWhereClausesExpression(e)+")":this.createWhereClausesExpression(e);const{driver:n}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return"postgres"===n.options.type||"cockroachdb"===n.options.type?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`}throw new TypeError(`Unsupported FindOperator ${d.q.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map((t=>{const n="string"==typeof t.queryBuilder?t.queryBuilder:t.queryBuilder.getQuery();if("string"!=typeof t.queryBuilder){if(t.queryBuilder.hasCommonTableExpressions())throw new r.VR(`Nested CTEs aren't supported (CTE: ${t.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!m.t.isSelectQueryBuilder(t.queryBuilder))throw new r.VR(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${t.alias})`);this.setParameters(t.queryBuilder.getParameters())}let i=this.escape(t.alias);if(t.options.columnNames){const e=t.options.columnNames.map((e=>this.escape(e)));if(m.t.isSelectQueryBuilder(t.queryBuilder)&&t.queryBuilder.expressionMap.selects.length&&t.options.columnNames.length!==t.queryBuilder.expressionMap.selects.length)throw new r.VR(`cte.options.columnNames length (${t.options.columnNames.length}) doesn't match subquery select list length ${t.queryBuilder.expressionMap.selects.length} (CTE: ${t.alias})`);i+=`(${e.join(", ")})`}return[t.options.recursive&&e?"RECURSIVE":"",i,t.options.materialized&&this.connection.driver.cteCapabilities.materializedHint?"MATERIALIZED":"","AS",`(${n})`].filter(Boolean).join(" ")})).join(", ")+" "}getWhereInIdsCondition(e){const t=this.expressionMap.mainAlias.metadata,n=(Array.isArray(e)?e:[e]).map((e=>t.ensureEntityIdMap(e)));if(!t.hasMultiplePrimaryKeys){const e=t.primaryColumns[0];if(!e.transformer&&!e.relationMetadata&&!e.embeddedMetadata)return{[e.propertyName]:(0,h.In)(n.map((t=>e.getEntityValue(t,!1))))}}return new u.A((e=>{for(const t of n)e.orWhere(new u.A((e=>e.where(t))))}))}findColumnsForPropertyPath(e){let t=this.expressionMap.mainAlias;const n=[],i=e.split(".");for(;i.length>1;){const e=i[0];if(!(null==t?void 0:t.hasMetadata))break;if(t.metadata.hasEmbeddedWithPropertyPath(e))i.unshift(`${i.shift()}.${i.shift()}`);else{if(!t.metadata.hasRelationWithPropertyPath(e))break;{const r=this.expressionMap.joinAttributes.find((t=>t.relationPropertyPath===e));if(!(null==r?void 0:r.alias)){const t=n.length>0?`${n.join(".")}.${e}`:e;throw new Error(`Cannot find alias for relation at ${t}`)}t=r.alias,n.push(...e.split(".")),i.shift()}}}if(!t)throw new Error(`Cannot find alias for property ${e}`);const r=i.join("."),a=t.metadata.findColumnsWithPropertyPath(r);if(!a.length)throw new p.K(e,t.metadata);return[t,n,a]}createPropertyPath(e,t,n=""){const i=[];for(const r of Object.keys(t)){const a=n?`${n}.${r}`:r;if(null===t[r]||"object"!=typeof t[r]||m.t.isFindOperator(t[r]))i.push(a);else if(e.hasEmbeddedWithPropertyPath(a)){const n=this.createPropertyPath(e,t[r],a);i.push(...n)}else if(e.hasRelationWithPropertyPath(a)){const n=e.findRelationWithPropertyPath(a);if("one-to-one"===n.relationType||"many-to-one"===n.relationType){const e=n.joinColumns.map((e=>e.referencedColumn)).filter((e=>!!e));if(e.length>0&&e.every((e=>e.getEntityValue(t[r],!1)))){i.push(a);continue}}if("one-to-many"===n.relationType||"many-to-many"===n.relationType)throw new Error(`Cannot query across ${n.relationType} for property ${a}`);const s=n.inverseEntityMetadata.primaryColumns;if(s.length>0&&s.every((e=>e.getEntityValue(t[r],!1)))){const e=s.map((e=>`${a}.${e.propertyPath}`));i.push(...e);continue}const o=this.createPropertyPath(n.inverseEntityMetadata,t[r]).map((e=>`${a}.${e}`));i.push(...o)}else i.push(a)}return i}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const t=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const n of t){const[t,i,r]=this.findColumnsForPropertyPath(n);for(const n of r){let r=e;for(const e of i){if(!r||!(e in r)){r={};break}r=r[e]}const a=this.expressionMap.aliasNamePrefixingEnabled?`${t.name}.${n.propertyPath}`:n.propertyPath,s=n.getEntityValue(r,!0);yield[a,s]}}}else for(const t of Object.keys(e)){const n=e[t],i=this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${t}`:t;yield[i,n]}}getWherePredicateCondition(e,t){if(m.t.isFindOperator(t)){let n=[];if(t.useParameter)if(t.objectLiteralParameters)this.setParameters(t.objectLiteralParameters);else if(t.multipleParameters)for(const e of t.value)n.push(this.createParameter(e));else n.push(this.createParameter(t.value));return"raw"===t.type?t.getSql?t.getSql(e):{operator:"equal",parameters:[e,t.value]}:"not"===t.type?t.child?{operator:t.type,condition:this.getWherePredicateCondition(e,t.child)}:{operator:"notEqual",parameters:[e,...n]}:{operator:t.type,parameters:[e,...n]}}return{operator:"equal",parameters:[e,this.createParameter(t)]}}getWhereCondition(e){if("string"==typeof e)return e;if(m.t.isBrackets(e)){const t=this.createQueryBuilder();return t.parentQueryBuilder=this,t.expressionMap.mainAlias=this.expressionMap.mainAlias,t.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,t.expressionMap.parameters=this.expressionMap.parameters,t.expressionMap.nativeParameters=this.expressionMap.nativeParameters,t.expressionMap.wheres=[],e.whereFactory(t),{operator:m.t.isNotBrackets(e)?"not":"brackets",condition:t.expressionMap.wheres}}if("function"==typeof e)return e(this);const t=Array.isArray(e)?e:[e],n=[];for(const e of t){const t=[];for(const[n,i]of this.getPredicates(e))t.push({type:"and",condition:this.getWherePredicateCondition(n,i)});n.push({type:"or",condition:t})}return 1===n.length?n[0].condition:n}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}},77253:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});class i{static isAliasProperty(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;const[t,n]=e.split(".");return!(!t||!n)&&(-1===e.indexOf("(")&&-1===e.indexOf(")"))}}},29225:(e,t,n)=>{"use strict";n.d(t,{M:()=>c});var i=n(50504),r=n(26883),a=n(91481);class s{constructor(e,t){this.queryBuilder=e,this.expressionMap=t}async update(e){const t=this.expressionMap.relationMetadata;if(t.isManyToOne||t.isOneToOneOwner){const n=t.joinColumns.reduce(((t,n)=>{const i=a.B.isObject(e)?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,i),t}),{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(n).whereInIds(this.expressionMap.of).execute()}else if((t.isOneToOneNotOwner||t.isOneToMany)&&null===e){const e={};t.inverseRelation.joinColumns.forEach((t=>{e[t.propertyName]=null}));const n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i={},r=[];n.forEach(((e,n)=>{t.inverseRelation.joinColumns.map(((t,s)=>{const o="joinColumn_"+n+"_"+s;i[o]=a.B.isObject(e)?t.referencedColumn.getEntityValue(e):e,r.push(`${t.propertyPath} = :${o}`)}))}));const s=r.map((e=>"("+e+")")).join(" OR ");if(!s)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(e).where(s).setParameters(i).execute()}else if(t.isOneToOneNotOwner||t.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new r.VR("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const n=this.expressionMap.of,i=t.inverseRelation.joinColumns.reduce(((e,t)=>{const i=a.B.isObject(n)?t.referencedColumn.getEntityValue(n):n;return t.setEntityValue(e,i),e}),{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).whereInIds(e).execute()}else{const n=t.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],r=Array.isArray(e)?e:[e],s=t.isManyToManyOwner?i:r,o=t.isManyToManyOwner?r:i,c=[];if(s.forEach((e=>{o.forEach((t=>{const i={};n.ownerColumns.forEach((t=>{i[t.databaseName]=a.B.isObject(e)?t.referencedColumn.getEntityValue(e):e})),n.inverseColumns.forEach((e=>{i[e.databaseName]=a.B.isObject(t)?e.referencedColumn.getEntityValue(t):t})),c.push(i)}))})),!c.length)return;"oracle"===this.queryBuilder.connection.driver.options.type||"sap"===this.queryBuilder.connection.driver.options.type?await Promise.all(c.map((e=>this.queryBuilder.createQueryBuilder().insert().into(n.tableName).values(e).execute()))):await this.queryBuilder.createQueryBuilder().insert().into(n.tableName).values(c).execute()}}}class o{constructor(e,t){this.queryBuilder=e,this.expressionMap=t}async remove(e){const t=this.expressionMap.relationMetadata;if(t.isOneToMany){const n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],r={};t.inverseRelation.joinColumns.forEach((e=>{r[e.propertyName]=null}));const s={},o=[];n.forEach(((e,n)=>{o.push(...i.map(((i,r)=>[...t.inverseRelation.joinColumns.map(((t,i)=>{const o="joinColumn_"+n+"_"+r+"_"+i;return s[o]=a.B.isObject(e)?t.referencedColumn.getEntityValue(e):e,`${t.propertyPath} = :${o}`})),...t.inverseRelation.entityMetadata.primaryColumns.map(((e,t)=>{const n="primaryColumn_"+r+"_"+r+"_"+t;return s[n]=a.B.isObject(i)?e.getEntityValue(i):i,`${e.propertyPath} = :${n}`}))].join(" AND "))))}));const c=o.map((e=>"("+e+")")).join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(r).where(c).setParameters(s).execute()}else{const n=t.junctionEntityMetadata,i=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],r=Array.isArray(e)?e:[e],s=t.isManyToManyOwner?i:r,o=t.isManyToManyOwner?r:i,c={},l=[];s.forEach(((e,t)=>{l.push(...o.map(((i,r)=>[...n.ownerColumns.map(((n,i)=>{const s="firstValue_"+t+"_"+r+"_"+i;return c[s]=a.B.isObject(e)?n.referencedColumn.getEntityValue(e):e,`${n.databaseName} = :${s}`})),...n.inverseColumns.map(((e,n)=>{const s="secondValue_"+t+"_"+r+"_"+n;return c[s]=a.B.isObject(i)?e.referencedColumn.getEntityValue(i):i,`${e.databaseName} = :${s}`}))].join(" AND "))))}));const u=l.map((e=>"("+e+")")).join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(n.tableName).where(u).setParameters(c).execute()}}}class c extends i.o{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new r.VR("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new r.VR(`Set operation is only supported for many-to-one and one-to-one relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .add() method instead.`);if(t.joinColumns&&t.joinColumns.length>1&&(!a.B.isObject(e)||Object.keys(e).length<t.joinColumns.length))throw new r.VR('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new s(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&0===e.length)return;const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new r.VR("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new r.VR(`Add operation is only supported for many-to-many and one-to-many relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .set() method instead.`);if(t.joinColumns&&t.joinColumns.length>1&&(!a.B.isObject(e)||Object.keys(e).length<t.joinColumns.length))throw new r.VR('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new s(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&0===e.length)return;const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new r.VR("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new r.VR(`Add operation is only supported for many-to-many and one-to-many relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .set(null) method instead.`);return new o(this,this.expressionMap).remove(e)}async addAndRemove(e,t){await this.remove(t),await this.add(e)}async loadOne(){return this.loadMany().then((e=>e[0]))}async loadMany(){let e=this.expressionMap.of;if(!a.B.isObject(e)){const t=this.expressionMap.mainAlias.metadata;if(t.hasMultiplePrimaryKeys)throw new r.VR("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}},89547:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var i=n(26883);class r{constructor(e,t){this.queryRunner=e,this.expressionMap=t}async update(e,t){const n=this.expressionMap.mainAlias.metadata;await Promise.all(t.map((async(t,r)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){"oracle"===this.queryRunner.connection.driver.options.type&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(((e,t,n)=>(e[this.expressionMap.extraReturningColumns[n].databaseName]=t[0],e)),{}));const i=Array.isArray(e.raw)?e.raw[r]:e.raw,a=this.queryRunner.connection.driver.createGeneratedMap(n,i);a&&(this.queryRunner.manager.merge(n.target,t,a),e.generatedMaps.push(a))}else{const r=this.expressionMap.extraReturningColumns;if(r.length>0){const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(t);if(!a)throw new i.VR("Cannot update entity because entity id is not set in the entity.");const s=await this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((e=>n.targetName+"."+e.propertyPath))).addSelect(r.map((e=>n.targetName+"."+e.propertyPath))).from(n.target,n.targetName).where(a).withDeleted().setOption("create-pojo").getOne();s&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s))}}})))}async insert(e,t){const n=this.expressionMap.mainAlias.metadata;let r=n.getInsertionReturningColumns();const a=this.queryRunner.connection.driver.isReturningSqlSupported("insert");r=r.filter((e=>!e.isGenerated||!0===a));const s=t.map(((i,r)=>{"oracle"===this.queryRunner.connection.driver.options.type&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(((e,t,n)=>(e[this.expressionMap.extraReturningColumns[n].databaseName]=t[0],e)),{}));const a=Array.isArray(e.raw)?e.raw[r]:e.raw,s=this.queryRunner.connection.driver.createGeneratedMap(n,a,r,t.length)||{};return r in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(n.target,s,this.expressionMap.locallyGenerated[r]),this.queryRunner.manager.merge(n.target,i,s),s}));if(r.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const e=t.map((e=>{const t=n.getEntityIdMap(e);if(!t)throw new i.VR("Cannot update entity because entity id is not set in the entity.");return t})),a=await this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((e=>n.targetName+"."+e.propertyPath))).addSelect(r.map((e=>n.targetName+"."+e.propertyPath))).from(n.target,n.targetName).where(e).setOption("create-pojo").getMany();t.forEach(((e,t)=>{this.queryRunner.manager.merge(n.target,s[t],a[t]),this.queryRunner.manager.merge(n.target,e,a[t])}))}t.forEach(((t,i)=>{const r=n.getEntityIdMap(t);e.identifiers.push(r),e.generatedMaps.push(s[i])}))}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter((e=>e.isUpdateDate||e.isVersion))}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter((e=>e.isUpdateDate||e.isVersion||e.isDeleteDate))}}},17915:(e,t,n)=>{"use strict";n.d(t,{w:()=>M});var i=n(33324),r=n(86740),a=n(91481),s=n(1048).Buffer;class o{constructor(e,t,n,i,r){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=i,this.queryRunner=r}transform(e,t){const n=this.group(e,t),i=[];if("TxOrUserOpDMO_id"in(e[0]||{})&&e.every((e=>"TxOrUserOpDMO_id"in e))){let n=t.metadata;if(n.discriminatorColumn){const i=e.map((e=>e[r.I.buildAlias(this.driver,t.name,t.metadata.discriminatorColumn.databaseName)])),a=n.childEntityMetadatas.find((e=>void 0!==i.find((t=>t===e.discriminatorValue))));a&&(n=a)}const a=[];n.columns.forEach((e=>{e.name__=`TxOrUserOpDMO_${e.databaseName}`,a.push(e)}));for(let t=0;t<e.length;++t){const n=e[t];let r={},s=!1;for(let e=0;e<a.length;++e){const t=a[e],i=n[t.name__];void 0===i||t.isVirtual||(r[t.databaseName]=this.driver.prepareHydratedValue(i,t),null!==i&&(s=!0))}s&&i.push(r)}return i}return n.forEach((e=>{const n=this.transformRawResultsGroup(e,t);void 0===n||Object.values(n).every((e=>null===e))||i.push(n)})),i}group(e,t){const n=new Map,i=[];return"view"===t.metadata.tableType?i.push(...t.metadata.columns.map((e=>r.I.buildAlias(this.driver,t.name,e.databaseName)))):i.push(...t.metadata.primaryColumns.map((e=>r.I.buildAlias(this.driver,t.name,e.databaseName)))),e.forEach((e=>{const t=i.map((t=>{const n=e[t];return s.isBuffer(n)?n.toString("hex"):a.B.isObject(n)?JSON.stringify(n):n})).join("_"),r=n.get(t);r?r.push(e):n.set(t,[e])})),n}transformRawResultsGroup(e,t){let n=t.metadata;if(n.discriminatorColumn){const i=e.map((e=>e[r.I.buildAlias(this.driver,t.name,t.metadata.discriminatorColumn.databaseName)])),a=n.childEntityMetadatas.find((e=>void 0!==i.find((t=>t===e.discriminatorValue))));a&&(n=a)}let i=n.create(this.queryRunner,{fromDeserializer:!0,pojo:-1!==this.expressionMap.options.indexOf("create-pojo")});const a=this.transformColumns(e,t,i,n),s=this.transformJoins(e,i,t,n),o=this.transformRelationIds(e,t,i,n),c=this.transformRelationCounts(e,t,i);if(a)return i;return 0===n.primaryColumns.filter((e=>!1===e.isVirtual)).length&&(s||o||c)?i:void 0}transformColumns(e,t,n,i){let a=!1;return i.columns.forEach((s=>{if(i.childEntityMetadatas.length>0&&-1!==i.childEntityMetadatas.findIndex((e=>e.target===s.target)))return;const o=e[0][r.I.buildAlias(this.driver,t.name,s.databaseName)];void 0===o||s.isVirtual||this.expressionMap.selects.find((e=>e.selection===t.name||e.selection===t.name+"."+s.propertyPath))&&(s.setEntityValue(n,this.driver.prepareHydratedValue(o,s)),null!==o&&(a=!0))})),a}transformJoins(e,t,n,i){let r=!1;return this.expressionMap.joinAttributes.forEach((a=>{if(!a.metadata)return;if(!a.isSelected)return;if(a.relation&&!i.relations.find((e=>e===a.relation)))return;if(a.mapToProperty){if(a.mapToPropertyParentAlias!==n.name)return}else if(!a.relation||a.parentAlias!==n.name||a.relationPropertyPath!==a.relation.propertyPath)return;let s=this.transform(e,a.alias);s=a.isMany?s:s[0],s=a.isMany||void 0!==s?s:null,void 0!==s&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=s:a.relation.setEntityValue(t,s),r=!0)})),r}transformRelationIds(e,t,n,i){let r=!1;return this.rawRelationIdResults.forEach(((i,a)=>{if(i.relationIdAttribute.parentAlias!==t.name)return;const s=i.relationIdAttribute.relation,o=this.createValueMapFromJoinColumns(s,i.relationIdAttribute.parentAlias,e);if(null==o)return;this.prepareDataForTransformRelationIds();const c=this.hashEntityIds(s,o),l=this.relationIdMaps[a][c]||[],u=i.relationIdAttribute.mapToPropertyPropertyPath.split("."),d=(e,t,n)=>{const i=e.shift();return i&&0===e.length?(t[i]=n,t):i&&e.length>0?void d(e,t[i],n):t};s.isOneToOne||s.isManyToOne?void 0!==l[0]&&(d(u,n,l[0]),r=!0):(d(u,n,l),r=r||l.length>0)})),r}transformRelationCounts(e,t,n){let i=!1;return this.rawRelationCountResults.filter((e=>e.relationCountAttribute.parentAlias===t.name)).forEach((a=>{const s=a.relationCountAttribute.relation;let o;o=s.isOneToMany?s.inverseRelation.joinColumns[0].referencedColumn.databaseName:s.isOwning?s.joinColumns[0].referencedColumn.databaseName:s.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=e[0][r.I.buildAlias(this.driver,t.name,o)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter((e=>e.parentId===c)).forEach((e=>{n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0})))})),i}createValueMapFromJoinColumns(e,t,n){let i;return i=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((e=>e)):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((e=>e)):e.isOwning?e.joinColumns.map((e=>e)):e.inverseRelation.inverseJoinColumns.map((e=>e)),i.reduce(((i,a)=>(n.forEach((n=>{e.isManyToOne||e.isOneToOneOwner?i[a.databaseName]=this.driver.prepareHydratedValue(n[r.I.buildAlias(this.driver,t,a.databaseName)],a):i[a.databaseName]=this.driver.prepareHydratedValue(n[r.I.buildAlias(this.driver,t,a.referencedColumn.databaseName)],a)})),i)),{})}extractEntityPrimaryIds(e,t){let n;return n=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((e=>e)):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((e=>e)):e.isOwning?e.joinColumns.map((e=>e)):e.inverseRelation.inverseJoinColumns.map((e=>e)),n.reduce(((e,n)=>(e[n.databaseName]=t[n.databaseName],e)),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map((e=>{const t=e.relationIdAttribute.relation;let n;return n=t.isManyToOne||t.isOneToOneOwner?t.joinColumns:t.isOneToMany||t.isOneToOneNotOwner?t.inverseEntityMetadata.primaryColumns:t.isOwning?t.inverseJoinColumns:t.inverseRelation.joinColumns,e.results.reduce(((r,a)=>{let s=n.reduce(((e,n)=>{let r=a[n.databaseName];return t.isOneToMany||t.isOneToOneNotOwner?(n.isVirtual&&n.referencedColumn&&n.referencedColumn.propertyName!==n.propertyName&&(r=n.referencedColumn.createValueMap(r)),i.m.mergeDeep(e,n.createValueMap(r))):(!n.isPrimary&&n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),i.m.mergeDeep(e,n.referencedColumn.createValueMap(r)))}),{});if(1!==n.length||e.relationIdAttribute.disableMixedMap||(s=t.isOneToMany||t.isOneToOneNotOwner?n[0].getEntityValue(s):n[0].referencedColumn.getEntityValue(s)),void 0!==s){const e=this.hashEntityIds(t,a);r[e]?r[e].push(s):r[e]=[s]}return r}),{})})))}hashEntityIds(e,t){const n=this.extractEntityPrimaryIds(e,t);return JSON.stringify(n)}}var c=n(54770),l=n(19174),u=n(97201),d=n(9772),h=n(29333),p=n(34851),m=n(25579),f=n(93499);class y{constructor(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}async load(e){const t=this.relationIdAttributes.map((async t=>{if(t.relation.isManyToOne||t.relation.isOneToOneOwner){if(t.queryBuilderFactory)throw new f.V("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const n={},i=e.map((e=>{const i={},a=[];t.relation.joinColumns.forEach((n=>{i[n.databaseName]=this.connection.driver.prepareHydratedValue(e[r.I.buildAlias(this.connection.driver,t.parentAlias,n.databaseName)],n.referencedColumn);const s=`${n.databaseName}:${i[n.databaseName]}`;-1===a.indexOf(s)&&a.push(s)})),t.relation.entityMetadata.primaryColumns.forEach((n=>{i[n.databaseName]=this.connection.driver.prepareHydratedValue(e[r.I.buildAlias(this.connection.driver,t.parentAlias,n.databaseName)],n);const s=`${n.databaseName}:${i[n.databaseName]}`;-1===a.indexOf(s)&&a.push(s)})),a.sort();const s=a.join("::");return n[s]?null:(n[s]=!0,i)})).filter((e=>e));return{relationIdAttribute:t,results:i}}if(t.relation.isOneToMany||t.relation.isOneToOneNotOwner){const n=t.relation,a=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,s=n.inverseEntityMetadata.target,o=n.inverseEntityMetadata.tableName,c=t.alias||o,l={},u={},d=e.map(((e,n)=>{const i=[],s={},o=a.map((a=>{const o=a.databaseName+n,l=e[r.I.buildAlias(this.connection.driver,t.parentAlias,a.referencedColumn.databaseName)],u=`${c}:${a.propertyPath}:${l}`;return-1!==i.indexOf(u)?"":(i.push(u),s[o]=l,c+"."+a.propertyPath+" = :"+o)})).filter((e=>e)).join(" AND ");i.sort();const d=i.join("::");return l[d]?"":(l[d]=!0,Object.assign(u,s),o)})).filter((e=>e)).map((e=>"("+e+")")).join(" OR ");if(!d)return{relationIdAttribute:t,results:[]};const h=this.connection.createQueryBuilder(this.queryRunner);i.m.uniq([...a,...n.inverseRelation.entityMetadata.primaryColumns],(e=>e.propertyPath)).forEach((e=>{h.addSelect(c+"."+e.propertyPath,e.databaseName)})),h.from(s,c).where("("+d+")").setParameters(u),t.queryBuilderFactory&&t.queryBuilderFactory(h);const p=await h.getRawMany();return p.forEach((e=>{a.forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t)}))})),{relationIdAttribute:t,results:p}}{const n=t.relation,i=n.isOwning?n.joinColumns:n.inverseRelation.inverseJoinColumns,a=n.isOwning?n.inverseJoinColumns:n.inverseRelation.joinColumns,s=t.junctionAlias,o=t.joinInverseSideMetadata.tableName,c=t.alias||o,l=n.isOwning?n.junctionEntityMetadata.tableName:n.inverseRelation.junctionEntityMetadata.tableName,u=e.map((e=>i.reduce(((n,i)=>(n[i.propertyPath]=e[r.I.buildAlias(this.connection.driver,t.parentAlias,i.referencedColumn.databaseName)],n)),{})));if(0===u.length)return{relationIdAttribute:t,results:[]};const d={},h={},p=u.map(((e,t)=>{const n=[],i={},r=Object.keys(e).map((r=>{const a=r+t,o=e[r],c=`${s}:${r}:${o}`;return-1!==n.indexOf(c)?"":(n.push(c),i[a]=o,s+"."+r+" = :"+a)})).filter((e=>e)).join(" AND ");n.sort();const a=n.join("::");return h[a]?"":(h[a]=!0,Object.assign(d,i),r)})).filter((e=>e)),m=a.map((e=>s+"."+e.propertyPath+" = "+c+"."+e.referencedColumn.propertyPath)).join(" AND "),f=p.map((e=>"("+e+" AND "+m+")")).join(" OR "),y=this.connection.createQueryBuilder(this.queryRunner);a.forEach((e=>{y.addSelect(s+"."+e.propertyPath,e.databaseName).addOrderBy(s+"."+e.propertyPath)})),i.forEach((e=>{y.addSelect(s+"."+e.propertyPath,e.databaseName).addOrderBy(s+"."+e.propertyPath)})),y.from(o,c).innerJoin(l,s,f).setParameters(d),t.queryBuilderFactory&&t.queryBuilderFactory(y);const g=await y.getRawMany();return g.forEach((e=>{[...i,...a].forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}))})),{relationIdAttribute:t,results:g}}}));return Promise.all(t)}}class g{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach((e=>{const t=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(t)})),this.expressionMap.joinAttributes.forEach((e=>{e.metadata&&!e.metadata.isJunction&&e.metadata.relationIds.forEach((t=>{const n=this.metadataToAttribute(e.alias.name,t);this.expressionMap.relationIdAttributes.push(n)}))}))}metadataToAttribute(e,t){return new p.q(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})}}class b{constructor(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}async load(e){const t=(e,t,n)=>n.indexOf(e)===t,n=this.relationCountAttributes.map((async n=>{if(n.relation.isOneToMany){const i=n.relation,r=i.inverseRelation,a=r.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,o=i.inverseEntityMetadata.tableName,c=n.alias||o,l=r.propertyName;let u=e.map((e=>e[n.parentAlias+"_"+a])).filter((e=>!!e));if(u=u.filter(t),0===u.length)return{relationCountAttribute:n,results:[]};const d=this.connection.createQueryBuilder(this.queryRunner);return d.select(c+"."+l,"parentId").addSelect("COUNT(*)","cnt").from(s,c).where(c+"."+l+" IN (:...ids)").addGroupBy(c+"."+l).setParameter("ids",u),n.queryBuilderFactory&&n.queryBuilderFactory(d),{relationCountAttribute:n,results:await d.getRawMany()}}{let i,r,a,s;n.relation.isOwning?(i=n.relation.joinColumns[0].referencedColumn.databaseName,r=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,a=n.relation.junctionEntityMetadata.columns[0],s=n.relation.junctionEntityMetadata.columns[1]):(i=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,r=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,a=n.relation.junctionEntityMetadata.columns[1],s=n.relation.junctionEntityMetadata.columns[0]);let o=e.map((e=>e[n.parentAlias+"_"+i])).filter((e=>!!e));if(o=o.filter(t),0===o.length)return{relationCountAttribute:n,results:[]};const c=n.junctionAlias,l=n.joinInverseSideMetadata.tableName,u=n.alias||l,d=n.relation.junctionEntityMetadata.tableName,h=c+"."+a.propertyName+" IN ("+o.map((e=>isNaN(e)?"'"+e+"'":e))+") AND "+c+"."+s.propertyName+" = "+u+"."+r,p=this.connection.createQueryBuilder(this.queryRunner);return p.select(c+"."+a.propertyName,"parentId").addSelect("COUNT("+p.escape(u)+"."+p.escape(r)+")","cnt").from(l,u).innerJoin(d,c,h).addGroupBy(c+"."+a.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(p),{relationCountAttribute:n,results:await p.getRawMany()}}}));return Promise.all(n)}}class w{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach((e=>{const t=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(t)})),this.expressionMap.joinAttributes.forEach((e=>{e.metadata&&!e.metadata.isJunction&&e.metadata.relationCounts.forEach((t=>{const n=this.metadataToAttribute(e.alias.name,t);this.expressionMap.relationCountAttributes.push(n)}))}))}metadataToAttribute(e,t){return new m.m(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})}}var _=n(50504),v=n(95601),E=n(86192),T=n(81719),N=n(26883),A=n(68625),S=n(88272),x=n(45200),C=n(5471);class M extends _.o{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),e}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map((e=>({selection:e})));else if("function"==typeof e){const n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this}addSelect(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map((e=>({selection:e}))));else if("function"==typeof e){const n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}from(e,t){const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}addFrom(e,t){const n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this}innerJoin(e,t,n,i){return this.join("INNER",e,t,n,i),this}leftJoin(e,t,n,i){return this.join("LEFT",e,t,n,i),this}innerJoinAndSelect(e,t,n,i){return this.addSelect(t),this.innerJoin(e,t,n,i),this}leftJoinAndSelect(e,t,n,i){return this.addSelect(t),this.leftJoin(e,t,n,i),this}innerJoinAndMapMany(e,t,n,i,r){return this.addSelect(n),this.join("INNER",t,n,i,r,e,!0),this}innerJoinAndMapOne(e,t,n,i,r){return this.addSelect(n),this.join("INNER",t,n,i,r,e,!1),this}leftJoinAndMapMany(e,t,n,i,r){return this.addSelect(n),this.join("LEFT",t,n,i,r,e,!0),this}leftJoinAndMapOne(e,t,n,i,r){return this.addSelect(n),this.join("LEFT",t,n,i,r,e,!1),this}loadRelationIdAndMap(e,t,n,i){const r=new p.q(this.expressionMap);return r.mapToProperty=e,r.relationName=t,"string"==typeof n&&(r.alias=n),"object"==typeof n&&n.disableMixedMap&&(r.disableMixedMap=!0),r.queryBuilderFactory=i,this.expressionMap.relationIdAttributes.push(r),r.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:r.junctionAlias,metadata:r.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,t,n,i){const r=new m.m(this.expressionMap);return r.mapToProperty=e,r.relationName=t,r.alias=n,r.queryBuilderFactory=i,this.expressionMap.relationCountAttributes.push(r),this.expressionMap.createAlias({type:"other",name:r.junctionAlias}),r.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:r.junctionAlias,metadata:r.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach((t=>{void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(t.propertyPath)||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+t.propertyPath,this.expressionMap.mainAlias.name+"."+t.propertyPath,e)})),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this}andHaving(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this}orHaving(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this}groupBy(e){return this.expressionMap.groupBys=e?[e]:[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}orderBy(e,t="ASC",n){if(void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new N.VR('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new N.VR('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){if(void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new N.VR('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new N.VR('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new N.VR('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new N.VR('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new N.VR('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new N.VR('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,t,n){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this.expressionMap.lockTables=n,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if("optimistic"===this.expressionMap.lockMode)throw new d.M;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0);const n=await this.loadRawResults(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!0;const n=await this.executeEntitiesAndRawResults(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion){const t=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const n=t.updateDateColumn.getEntityValue(e);if(n.getTime()!==this.expressionMap.lockVersion.getTime())throw new u.z(t.name,this.expressionMap.lockVersion,n)}else{const n=t.versionColumn.getEntityValue(e);if(n!==this.expressionMap.lockVersion)throw new u.z(t.name,this.expressionMap.lockVersion,n)}}return void 0===e?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new T.p(this.expressionMap.mainAlias.target,this);return e}async getMany(){if("optimistic"===this.expressionMap.lockMode)throw new d.M;return(await this.getRawAndEntities()).entities}async getCount(){if("optimistic"===this.expressionMap.lockMode)throw new d.M;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!1;const n=await this.executeCountQuery(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if("optimistic"===this.expressionMap.lockMode)throw new d.M;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!0;const n=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const i=this.expressionMap.cacheId;this.expressionMap.cacheId=i?`${i}-count`:i;const r=await this.executeCountQuery(e),a=[n.entities,r];return t&&await e.commitTransaction(),a}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();let i=!1;try{!0===this.expressionMap.useTransaction&&!1===n.isTransactionActive&&(await n.startTransaction(),i=!0);const r=()=>{if(n!==this.queryRunner)return n.release()},a=n.stream(e,t,r,r);return i&&await n.commitTransaction(),a}catch(e){if(i)try{await n.rollbackTransaction()}catch(e){}throw e}}cache(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,t,n,i,r,a,s){this.setParameters(r||{});const o=new h.L(this.connection,this.expressionMap);if(o.direction=e,o.mapToProperty=a,o.isMappingMany=s,o.entityOrProperty=t,o.condition=i||void 0,this.expressionMap.joinAttributes.push(o),o.metadata){if(o.metadata.deleteDateColumn&&!this.expressionMap.withDeleted){const e=`${n}.${o.metadata.deleteDateColumn.propertyName} IS NULL`;o.condition=o.condition?` ${o.condition} AND ${e}`:`${e}`}o.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:o.metadata}),o.relation&&o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata})}else{let e="";if("function"==typeof t){const n=t(this.subQuery());this.setParameters(n.getParameters()),e=n.getQuery()}else e=t;const i="function"==typeof t||"("===t.substr(0,1)&&")"===t.substr(-1);o.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===i?t:void 0,subQuery:!0===i?e:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new N.VR("Cannot build query because main alias is not set (call qb#from method)");const e=[],t=[];if(this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,n)),t.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,n))}this.expressionMap.joinAttributes.forEach((n=>{if(n.metadata)e.push(...this.buildEscapedEntityColumnSelects(n.alias.name,n.metadata)),t.push(...this.findEntityColumnSelects(n.alias.name,n.metadata));else{const i=this.expressionMap.selects.some((e=>e.selection===n.alias.name));if(i){e.push({selection:this.escape(n.alias.name)+".*"});const i=this.expressionMap.selects.find((e=>e.selection===n.alias.name));t.push(i)}}})),this.expressionMap.selects.filter((e=>-1===t.indexOf(e))).forEach((t=>e.push({selection:this.replacePropertyNames(t.selection),aliasName:t.aliasName}))),0===e.length&&e.push({selection:"*"});let n="";this.expressionMap.useIndex&&r.I.isMySQLFamily(this.connection.driver)&&(n=` USE INDEX (${this.expressionMap.useIndex})`);const i=this.expressionMap.aliases.filter((e=>"from"===e.type&&(e.tablePath||e.subQuery))).map((e=>e.subQuery?e.subQuery+" "+this.escape(e.name):this.getTableName(e.tablePath)+" "+this.escape(e.name))),a=this.createSelectDistinctExpression(),s=e.map((e=>e.selection+(e.aliasName?" AS "+this.escape(e.aliasName):""))).join(", ");return a+s+" FROM "+i.join(", ")+this.createTableLockExpression()+n}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:t,maxExecutionTime:n}=this.expressionMap,{driver:i}=this.connection;let a="SELECT ";if(n>0&&r.I.isMySQLFamily(i)&&(a+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),r.I.isPostgresFamily(i)&&t.length>0){a=`SELECT DISTINCT ON (${t.map((e=>this.replacePropertyNames(e))).join(", ")}) `}else e&&(a="SELECT DISTINCT ");return a}createJoinExpression(){return this.expressionMap.joinAttributes.map((e=>{const t=e.relation,n=e.tablePath,i=e.alias.name;let r=e.condition?" AND ("+e.condition+")":"";const a=e.parentAlias;if(!a||!t){const t=e.alias.subQuery?e.alias.subQuery:this.getTableName(n);return" "+e.direction+" JOIN "+t+" "+this.escape(i)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(t.isManyToOne||t.isOneToOneOwner){const s=t.joinColumns.map((e=>i+"."+e.referencedColumn.propertyPath+"="+a+"."+t.propertyPath+"."+e.referencedColumn.propertyPath)).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+r)}if(t.isOneToMany||t.isOneToOneNotOwner){const s=t.inverseRelation.joinColumns.map((e=>("entity-child"===t.inverseEntityMetadata.tableType&&t.inverseEntityMetadata.discriminatorColumn&&(r+=" AND "+i+"."+t.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+t.inverseEntityMetadata.discriminatorValue+"'"),i+"."+t.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+a+"."+e.referencedColumn.propertyPath))).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+r)}{const s=t.junctionEntityMetadata.tablePath,o=e.junctionAlias;let c="",l="";return t.isOwning?(c=t.joinColumns.map((e=>o+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath)).join(" AND "),l=t.inverseJoinColumns.map((e=>i+"."+e.referencedColumn.propertyPath+"="+o+"."+e.propertyPath)).join(" AND ")):(c=t.inverseRelation.inverseJoinColumns.map((e=>o+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath)).join(" AND "),l=t.inverseRelation.joinColumns.map((e=>i+"."+e.referencedColumn.propertyPath+"="+o+"."+e.propertyPath)).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(s)+" "+this.escape(o)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(c)+" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(i)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l+r)}})).join(" ")}createGroupByExpression(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitOffsetExpression(){let e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),"mssql"===this.connection.driver.options.type){let n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(r.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new E.w}else if(r.I.isSQLiteFamily(this.connection.driver)){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if("oracle"===this.connection.driver.options.type){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if("mssql"===this.connection.driver.options.type)switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let t="";if(this.expressionMap.lockTables){if(!r.I.isPostgresFamily(e)&&"cockroachdb"!==e.options.type)throw new N.VR("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new N.VR("lockTables cannot be an empty array");t=" OF "+this.expressionMap.lockTables.join(", ")}let n="";switch("nowait"===this.expressionMap.onLocked?n=" NOWAIT":"skip_locked"===this.expressionMap.onLocked&&(n=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if("mysql"===e.options.type||"aurora-mysql"===e.options.type)return r.I.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+t+n:" LOCK IN SHARE MODE";if("mariadb"===e.options.type)return" LOCK IN SHARE MODE";if(r.I.isPostgresFamily(e))return" FOR SHARE"+t+n;if("oracle"===e.options.type)return" FOR UPDATE";if("mssql"===e.options.type)return"";throw new v.t;case"pessimistic_write":if(r.I.isMySQLFamily(e)||"aurora-mysql"===e.options.type||"oracle"===e.options.type)return" FOR UPDATE"+n;if(r.I.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR UPDATE"+t+n;if("mssql"===e.options.type)return"";throw new v.t;case"pessimistic_partial_write":if(r.I.isPostgresFamily(e))return" FOR UPDATE"+t+" SKIP LOCKED";if(r.I.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new v.t;case"pessimistic_write_or_fail":if(r.I.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR UPDATE"+t+" NOWAIT";if(r.I.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new v.t;case"for_no_key_update":if(r.I.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR NO KEY UPDATE"+t+n;throw new v.t;case"for_key_share":if(r.I.isPostgresFamily(e))return" FOR KEY SHARE"+t+n;throw new v.t;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map(((e,t)=>{switch(e.type){case"and":return(t>0?"AND ":"")+this.replacePropertyNames(e.condition);case"or":return(t>0?"OR ":"")+this.replacePropertyNames(e.condition);default:return this.replacePropertyNames(e.condition)}})).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,t){const n=this.expressionMap.selects.some((t=>t.selection===e)),i=[];if(n&&i.push(...t.columns.filter((e=>!0===e.isSelect))),i.push(...t.columns.filter((t=>this.expressionMap.selects.some((n=>n.selection===e+"."+t.propertyPath))))),0===i.length)return[];const a=this.expressionMap.queryEntity?t.primaryColumns.filter((e=>-1===i.indexOf(e))):[],s=[...i,...a],o=[];return s.forEach((t=>{let i=this.escape(e)+"."+this.escape(t.databaseName);if(-1!==this.connection.driver.spatialTypes.indexOf(t.type)){if(r.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type){const e=this.connection.driver.options.legacySpatialSupport;i=`${e?"AsText":"ST_AsText"}(${i})`}r.I.isPostgresFamily(this.connection.driver)&&(i=t.precision?`ST_AsGeoJSON(${i}, ${t.precision})::json`:`ST_AsGeoJSON(${i})::json`),"mssql"===this.connection.driver.options.type&&(i=`${i}.ToString()`)}const a=this.expressionMap.selects.filter((n=>n.selection===e+"."+t.propertyPath));a.length?a.forEach((n=>{o.push({selection:i,aliasName:n.aliasName?n.aliasName:r.I.buildAlias(this.connection.driver,e,t.databaseName),virtual:n.virtual})})):o.push({selection:i,aliasName:r.I.buildAlias(this.connection.driver,e,t.databaseName),virtual:n})})),o}findEntityColumnSelects(e,t){const n=this.expressionMap.selects.find((t=>t.selection===e));return n?[n]:this.expressionMap.selects.filter((n=>t.columns.some((t=>n.selection===e+"."+t.propertyPath))))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,t=this.expressionMap.mainAlias.metadata.primaryColumns,n=this.escape(e);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if("cockroachdb"===this.connection.driver.options.type||r.I.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", ")+"))";if(r.I.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", ")+")";if("mssql"===this.connection.driver.options.type){const e=t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", '|;|', ");return 1===t.length?`COUNT(DISTINCT(${e}))`:`COUNT(DISTINCT(CONCAT(${e})))`}if("spanner"===this.connection.driver.options.type){if(1===t.length)return`COUNT(DISTINCT(${n}.${this.escape(t[0].databaseName)}))`;return`COUNT(DISTINCT(CONCAT(${t.map((e=>`CAST(${n}.${this.escape(e.databaseName)} AS STRING)`)).join(", '|;|', ")})))`}return"COUNT(DISTINCT("+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const t=this.computeCountExpression(),n=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(t,"cnt").setOption("disable-global-order").loadRawResults(e);return n&&n[0]&&n[0].cnt?parseInt(n[0].cnt):0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?i.m.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?i.m.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,"object"==typeof this.findOptions.select?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),!1!==this.findOptions.loadEagerRelations&&"join"===this.expressionMap.relationLoadStrategy&&this.buildEagerRelations(e,"object"==typeof this.findOptions.select?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere("("!==this.conditions.substr(0,1)?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach((e=>{e.select&&!e.selection?"inner"===e.type?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):"inner"===e.type?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)})),void 0!==this.findOptions.skip&&this.skip(this.findOptions.skip),void 0!==this.findOptions.take&&this.take(this.findOptions.take),"number"==typeof this.findOptions.cache||"boolean"==typeof this.findOptions.cache?this.cache(this.findOptions.cache):"object"==typeof this.findOptions.cache&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach((e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)})),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach((e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)})),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach((e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)})),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach((e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)}))),this.findOptions.lock)if("optimistic"===this.findOptions.lock.mode)this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if("pessimistic_read"===this.findOptions.lock.mode||"pessimistic_write"===this.findOptions.lock.mode||"dirty_read"===this.findOptions.lock.mode||"pessimistic_partial_write"===this.findOptions.lock.mode||"pessimistic_write_or_fail"===this.findOptions.lock.mode||"for_no_key_update"===this.findOptions.lock.mode||"for_key_share"===this.findOptions.lock.mode){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map((e=>{const t=this.expressionMap.aliases.find((t=>t.metadata.tableNameWithoutPrefix===e));if(!t)throw new N.VR(`"${e}" is not part of this query`);return this.escape(t.name)})):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}!0===this.findOptions.loadRelationIds?this.loadAllRelationIds():"object"==typeof this.findOptions.loadRelationIds&&this.loadAllRelationIds(this.findOptions.loadRelationIds),!1!==this.findOptions.loadEagerRelations&&A.H.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),!0===this.findOptions.transaction&&(this.expressionMap.useTransaction=!0)}}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new N.VR('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode||"for_key_share"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new c.A;if("optimistic"===this.expressionMap.lockMode){const e=this.expressionMap.mainAlias.metadata;if(!e.versionColumn&&!e.updateDateColumn)throw new l.G(e.name)}const t=new y(this.connection,e,this.expressionMap.relationIdAttributes),n=new b(this.connection,e,this.expressionMap.relationCountAttributes);new g(this.expressionMap).transform();new w(this.expressionMap).transform();let a=[],s=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[t,n]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),i=this.expressionMap.mainAlias.metadata,s=this.expressionMap.mainAlias.name,o=i.primaryColumns.map((e=>{const t=this.escape("distinctAlias"),i=this.escape(r.I.buildAlias(this.connection.driver,s,e.databaseName));n[i]||(n[i]="ASC");const a=r.I.buildAlias(this.connection.driver,"ids_"+s,e.databaseName);return`${t}.${i} AS ${this.escape(a)}`}));if(a=await new M(this.connection,e).select(`DISTINCT ${o.join(", ")}`).addSelect(t).from(`(${this.clone().orderBy().getQuery()})`,"distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(n).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),a.length>0){let t="";const n={};if(i.hasMultiplePrimaryKeys)t=a.map(((e,t)=>i.primaryColumns.map((i=>{const r=`orm_distinct_ids_${t}_${i.databaseName}`;return n[r]=e[`ids_${s}_${i.databaseName}`],`${s}.${i.propertyPath}=:${r}`})).join(" AND "))).join(" OR ");else{const e=r.I.buildAlias(this.connection.driver,"ids_"+s,i.primaryColumns[0].databaseName),o=a.map((t=>t[e]));o.every((e=>"number"==typeof e))?t=`${s}.${i.primaryColumns[0].propertyPath} IN (${o.join(", ")})`:(n.orm_distinct_ids=o,t=s+"."+i.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}a=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:t}).setParameters(n).loadRawResults(e)}}else a=await this.loadRawResults(e);if(a.length>0){const i=await t.load(a),r=await n.load(a),c=new o(this.expressionMap,this.connection.driver,i,r,this.queryRunner);s=c.transform(a,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,s)}return"query"===this.expressionMap.relationLoadStrategy&&await Promise.all(this.relationMetadatas.map((async e=>{const t=e.inverseEntityMetadata.target,n=e.inverseEntityMetadata.targetName,r=Array.isArray(this.findOptions.select)?i.m.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,a=Array.isArray(this.findOptions.relations)?i.m.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,o=this.createQueryBuilder().select(n).from(t,n).setFindOptions({select:r?i.m.deepValue(r,e.propertyPath):void 0,order:this.findOptions.order?i.m.deepValue(this.findOptions.order,e.propertyPath):void 0,relations:a?i.m.deepValue(a,e.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(s.length>0){const t=await this.connection.relationIdLoader.loadManyToManyRelationIdsAndGroup(e,s,void 0,o);s.forEach((n=>{const i=t.find((e=>e.entity===n));if(i){const t=void 0===i.related?null:i.related;e.setEntityValue(n,t)}}))}}))),{raw:a,entities:s}}createOrderByCombinedWithSelectExpression(e){const t=this.expressionMap.allOrderBys,n=Object.keys(t).map((t=>{if(-1!==t.indexOf(".")){const n=t.split("."),i=n[0],a=n.slice(1).join("."),s=this.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyPath(a);return this.escape(e)+"."+this.escape(r.I.buildAlias(this.connection.driver,i,s.databaseName))}return this.expressionMap.selects.find((e=>e.selection===t||e.aliasName===t))?this.escape(e)+"."+t:""})).join(", "),i={};return Object.keys(t).forEach((n=>{if(-1!==n.indexOf(".")){const a=n.split("."),s=a[0],o=a.slice(1).join("."),c=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(o);i[this.escape(e)+"."+this.escape(r.I.buildAlias(this.connection.driver,s,c.databaseName))]=t[n]}else this.expressionMap.selects.find((e=>e.selection===n||e.aliasName===n))?i[this.escape(e)+"."+n]=t[n]:i[n]=t[n]})),[n,i]}async loadRawResults(e){const[t,n]=this.getQueryAndParameters(),i=t+" -- PARAMETERS: "+JSON.stringify(n),r="object"==typeof this.connection.options.cache?this.connection.options.cache:{};let a,s=!1;if(this.connection.queryResultCache&&(this.expressionMap.cache||r.alwaysEnabled))try{if(a=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:i,duration:this.expressionMap.cacheDuration||r.duration||1e3},e),a&&!this.connection.queryResultCache.isExpired(a))return JSON.parse(a.result)}catch(e){if(!r.ignoreErrors)throw e;s=!0}const o=await e.query(t,n,!0);if(!s&&this.connection.queryResultCache&&(this.expressionMap.cache||r.alwaysEnabled))try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:i,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||r.duration||1e3,result:JSON.stringify(o.records)},a,e)}catch(e){if(!r.ignoreErrors)throw e}return o.records}mergeExpressionMap(e){return a.B.assign(this.expressionMap,e),this}normalizeNumber(e){return"number"==typeof e||null==e?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner("slave")}buildSelect(e,t,n,i){for(let r in e){if(void 0===e[r]||!1===e[r])continue;const a=i?i+"."+r:r,s=t.findColumnWithPropertyPathStrict(a),o=t.findEmbeddedWithPropertyPath(a),c=t.findRelationWithPropertyPath(a);if(!o&&!s&&!c)throw new x.K(a,t);s?this.selects.push(n+"."+a):o&&this.buildSelect(e[r],t,n,r)}}buildRelations(e,t,n,a,s){e&&Object.keys(e).forEach((o=>{const c=e[o],l=s?s+"."+o:o,u=n.findEmbeddedWithPropertyPath(l),d=n.findRelationWithPropertyPath(l);if(!u&&!d)throw new x.K(l,n);if(u)this.buildRelations(c,"object"==typeof t?i.m.deepValue(t,u.propertyPath):void 0,n,a,l);else if(d){let e=a+"_"+l.replace(".","_");e=r.I.buildAlias(this.connection.driver,{joiner:"__"},a,e),!0!==c&&"object"!=typeof c||("query"===this.expressionMap.relationLoadStrategy?this.relationMetadatas.push(d):(this.joins.push({type:"left",select:!0,selection:t&&"object"==typeof t[o]?t[o]:void 0,alias:e,parentAlias:a,relationMetadata:d}),t&&"object"==typeof t[o]&&this.buildSelect(t[o],d.inverseEntityMetadata,e))),"object"==typeof c&&"join"===this.expressionMap.relationLoadStrategy&&this.buildRelations(c,"object"==typeof t?i.m.deepValue(t,d.propertyPath):void 0,d.inverseEntityMetadata,e,void 0)}}))}buildEagerRelations(e,t,n,a,s){e&&Object.keys(e).forEach((o=>{const c=e[o],l=s?s+"."+o:o,u=n.findEmbeddedWithPropertyPath(l),d=n.findRelationWithPropertyPath(l);if(!u&&!d)throw new x.K(l,n);if(u)this.buildEagerRelations(c,"object"==typeof t?i.m.deepValue(t,u.propertyPath):void 0,n,a,l);else if(d){let e=a+"_"+l.replace(".","_");e=r.I.buildAlias(this.connection.driver,{joiner:"__"},a,e),!0!==c&&"object"!=typeof c||d.inverseEntityMetadata.eagerRelations.forEach((n=>{let i=e+"_"+n.propertyPath.replace(".","_");i=r.I.buildAlias(this.connection.driver,{joiner:"__"},e,i);this.joins.find((e=>e.alias===i))||this.joins.push({type:"left",select:!0,alias:i,parentAlias:e,selection:void 0,relationMetadata:n}),t&&"object"==typeof t[o]&&this.buildSelect(t[o],d.inverseEntityMetadata,e)})),"object"==typeof c&&this.buildEagerRelations(c,"object"==typeof t?i.m.deepValue(t,d.propertyPath):void 0,d.inverseEntityMetadata,e,void 0)}}))}buildOrder(e,t,n,i){for(let a in e){if(void 0===e[a])continue;const s=i?i+"."+a:a,o=t.findColumnWithPropertyPathStrict(s),c=t.findEmbeddedWithPropertyPath(s),l=t.findRelationWithPropertyPath(s);if(!c&&!o&&!l)throw new x.K(s,t);if(o){let t="object"==typeof e[a]?e[a].direction:e[a];t="DESC"===t||"desc"===t||-1===t?"DESC":"ASC";let i="object"==typeof e[a]?e[a].nulls:void 0;i="first"===(null==i?void 0:i.toLowerCase())?"NULLS FIRST":"last"===(null==i?void 0:i.toLowerCase())?"NULLS LAST":void 0,this.addOrderBy(`${n}.${s}`,t,i)}else if(c)this.buildOrder(e[a],t,n,s);else if(l){let t=n+"_"+s.replace(".","_");t=r.I.buildAlias(this.connection.driver,{joiner:"__"},n,t);this.joins.find((e=>e.alias===t))||this.joins.push({type:"left",select:!1,alias:t,parentAlias:n,selection:void 0,relationMetadata:l}),this.buildOrder(e[a],l.inverseEntityMetadata,t)}}}buildWhere(e,t,n,i){let a="";if(Array.isArray(e))a="("+e.map((e=>this.buildWhere(e,t,n,i))).filter((e=>!!e)).map((e=>"("+e+")")).join(" OR ")+")";else{let s=[];for(let a in e){if(void 0===e[a]||null===e[a])continue;const o=i?i+"."+a:a,c=t.findColumnWithPropertyPathStrict(o),l=t.findEmbeddedWithPropertyPath(o),u=t.findRelationWithPropertyPath(o);if(!l&&!c&&!u)throw new x.K(o,t);if(c){const t=`${n}.${o}`;let i=e[a];C.t.isEqualOperator(e[a])&&(i=e[a].value),c.transformer&&(i=S.W.transformTo(c.transformer,i)),s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(t,i)))}else if(l){const i=this.buildWhere(e[a],t,n,o);i&&s.push(i)}else if(u){if("object"==typeof e[a]){if(Object.keys(e[a]).every((t=>void 0===e[a][t])))continue}if(C.t.isFindOperator(e[a]))if("moreThan"===e[a].type||"lessThan"===e[a].type){const t="moreThan"===e[a].type?">":"<",i=this.subQuery();if(u.isManyToManyOwner)i.select("COUNT(*)").from(u.joinTableName,u.joinTableName).where(u.joinColumns.map((e=>`${u.joinTableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "));else if(u.isManyToManyNotOwner)i.select("COUNT(*)").from(u.inverseRelation.joinTableName,u.inverseRelation.joinTableName).where(u.inverseRelation.inverseJoinColumns.map((e=>`${u.inverseRelation.joinTableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "));else{if(!u.isOneToMany)throw new Error("This relation isn't supported by given find operator");i.select("COUNT(*)").from(u.inverseEntityMetadata.target,u.inverseEntityMetadata.tableName).where(u.inverseRelation.joinColumns.map((e=>`${u.inverseEntityMetadata.tableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "))}this.andWhere(i.getSql()+" "+t+" "+parseInt(e[a].value))}else{if(!(u.isManyToOne||u.isOneToOne&&u.isOneToOneOwner))throw new Error("This relation isn't supported by given find operator");{const t=`${n}.${o}`;s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(t,e[a])))}}else{let t=n+"_"+u.propertyPath.replace(".","_");t=r.I.buildAlias(this.connection.driver,{joiner:"__"},n,t);const i=this.joins.find((e=>e.alias===t));i?"left"===i.type&&(i.type="inner"):this.joins.push({type:"inner",select:!1,selection:void 0,alias:t,parentAlias:n,relationMetadata:u});const o=this.buildWhere(e[a],u.inverseEntityMetadata,t);o&&s.push(o)}}}a=s.join(" AND ")}return a}}},79081:(e,t,n)=>{"use strict";n.d(t,{x:()=>p});var i=n(50504),r=n(46763),a=n(43025),s=n(89547),o=n(71365),c=n(3864),l=n(14268),u=n(26883),d=n(86740),h=n(5471);class p extends i.o{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e.trim()}async execute(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&("soft-delete"===this.expressionMap.queryType?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):"restore"===this.expressionMap.queryType&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const n=new s.V(e,this.expressionMap);!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getSoftDeletionReturningColumns());const[i,a]=this.getQueryAndParameters(),o=await e.query(i,a,!0),c=r.L.from(o);return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await n.update(c,this.expressionMap.whereEntities),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&("soft-delete"===this.expressionMap.queryType?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):"restore"===this.expressionMap.queryType&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),t&&await e.commitTransaction(),c}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}from(e,t){e=h.t.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new a.J;return this.expressionMap.returning=e,this}orderBy(e,t="ASC",n){return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new u.VR(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const t=Array.isArray(e)?e:[e];return t.forEach((e=>{const t=this.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!t)throw new u.VR("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(t)})),this.expressionMap.whereEntities=t,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new u.VR(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new c.A(e);const t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new u.VR('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new l.E;const n=this.createWhereExpression(),i=this.createReturningExpression("update");return""===i?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")}${n}`:"mssql"===this.connection.driver.options.type?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")} OUTPUT ${i}${n}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")}${n} RETURNING ${i}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(d.I.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new o.r}return""}}},61035:(e,t,n)=>{"use strict";n.d(t,{b:()=>p});var i=n(50504),r=n(46763),a=n(43025),s=n(89547),o=n(71365),c=n(14268),l=n(26883),u=n(45200),d=n(86740),h=n(1048).Buffer;class p extends i.o{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e.trim()}async execute(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let n=null,i=null;const a=new s.V(e,this.expressionMap),o=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const e of this.expressionMap.returning)o.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(e));!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=a.getUpdationReturningColumns(),o.push(...this.expressionMap.extraReturningColumns.filter((e=>!o.includes(e))))),o.length>0&&"mssql"===this.connection.driver.options.type&&(n=this.connection.driver.buildTableVariableDeclaration("@OutputTable",o),i="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),u=[n,c,i],d=await e.query(u.filter((e=>null!=e)).join(";\n\n"),l,!0),h=r.L.from(d);return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await a.update(h,this.expressionMap.whereEntities),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),t&&await e.commitTransaction(),h}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new a.J;return this.expressionMap.returning=e,this}orderBy(e,t="ASC",n){return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new l.VR(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const t=Array.isArray(e)?e:[e];return t.forEach((e=>{const t=this.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!t)throw new l.VR("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(t)})),this.expressionMap.whereEntities=t,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),t=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,n={};for(let t in e)void 0!==e[t]&&(n[t]=e[t]);const i=[],r=[];if(t?(this.createPropertyPath(t,n).forEach((e=>{const a=t.findColumnsWithPropertyPath(e);if(a.length<=0)throw new u.K(e,t);a.forEach((e=>{if(!e.isUpdate||r.includes(e))return;r.push(e);let t=e.getEntityValue(n);if(!e.referencedColumn||"object"!=typeof t||t instanceof Date||null===t||h.isBuffer(t)?"function"!=typeof t&&(t=this.connection.driver.preparePersistentValue(t,e)):t=e.referencedColumn.getEntityValue(t),"function"==typeof t)i.push(this.escape(e.databaseName)+" = "+t());else if("sap"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type||null!==t){"mssql"===this.connection.driver.options.type&&(t=this.connection.driver.parametrizeValue(e,t));const n=this.createParameter(t);let r=null;if(!d.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||-1===this.connection.driver.spatialTypes.indexOf(e.type))r="postgres"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(e.type)?null!=e.srid?`ST_SetSRID(ST_GeomFromGeoJSON(${n}), ${e.srid})::${e.type}`:`ST_GeomFromGeoJSON(${n})::${e.type}`:"mssql"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(e.type)?e.type+"::STGeomFromText("+n+", "+(e.srid||"0")+")":n;else{const t=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";r=null!=e.srid?`${t}(${n}, ${e.srid})`:`${t}(${n})`}i.push(this.escape(e.databaseName)+" = "+r)}else i.push(this.escape(e.databaseName)+" = NULL")}))})),(i.length>0||0===Object.keys(n).length)&&(t.versionColumn&&-1===r.indexOf(t.versionColumn)&&i.push(this.escape(t.versionColumn.databaseName)+" = "+this.escape(t.versionColumn.databaseName)+" + 1"),t.updateDateColumn&&-1===r.indexOf(t.updateDateColumn)&&i.push(this.escape(t.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(n).map((e=>{let t=n[e];if("function"==typeof t)i.push(this.escape(e)+" = "+t());else if("sap"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type||null!==t){const n=this.createParameter(t);i.push(this.escape(e)+" = "+n)}else i.push(this.escape(e)+" = NULL")})),i.length<=0)throw new c.E;const a=this.createWhereExpression(),s=this.createReturningExpression("update");return""===s?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${a}`:"mssql"===this.connection.driver.options.type?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")} OUTPUT ${s}${a}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${i.join(", ")}${a} RETURNING ${s}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(d.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type)return" LIMIT "+e;throw new o.r}return""}getValueSet(){if("object"==typeof this.expressionMap.valuesSet)return this.expressionMap.valuesSet;throw new c.E}}},25579:(e,t,n)=>{"use strict";n.d(t,{m:()=>s});var i=n(77253),r=n(91481),a=n(93499);class s{constructor(e,t){this.expressionMap=e,r.B.assign(this,t||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,t]=this.relationName.split(".");return e+"_"+t+"_rc"}get relation(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value is a string representation of alias property");const[e,t]=this.relationName.split("."),n=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(t);if(!n)throw new a.V(`Relation with property path ${t} in entity was not found.`);return n}get metadata(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}},34851:(e,t,n)=>{"use strict";n.d(t,{q:()=>s});var i=n(77253),r=n(91481),a=n(93499);class s{constructor(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,r.B.assign(this,t||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!i.n.isAliasProperty(this.relationName))throw new a.V("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new a.V(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,t]=this.relationName.split(".");return e+"_"+t+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}},38689:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});class i{static from(e){const t=new this;return t.raw=e.records,t.affected=e.affected,t}}},49015:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});class i{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const t=new this;return t.raw=e.raw,t}}},46763:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});class i{constructor(){this.generatedMaps=[]}static from(e){const t=new this;return t.raw=e.records,t.affected=e.affected,t}}},1746:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});class i{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}},88272:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});class i{static transformFrom(e,t){if(Array.isArray(e)){return e.slice().reverse().reduce(((e,t)=>t.from(e)),t)}return e.from(t)}static transformTo(e,t){return Array.isArray(e)?e.reduce(((e,t)=>t.to(e)),t):e.to(t)}}},5471:(e,t,n)=>{"use strict";n.d(t,{t:()=>i});class i{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isQueryBuilder(e){return this.check(e,"QueryBuilder")||this.check(e,"SelectQueryBuilder")||this.check(e,"InsertQueryBuilder")||this.check(e,"DeleteQueryBuilder")||this.check(e,"UpdateQueryBuilder")||this.check(e,"SoftDeleteQueryBuilder")||this.check(e,"RelationQueryBuilder")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return"function"==typeof e&&"function"==typeof e.hasId&&"function"==typeof e.save&&"function"==typeof e.useDataSource}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,t){return"object"==typeof e&&null!==e&&e["@instanceof"]===Symbol.for(t)}}},91481:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});class i{static isObject(e){return null!==e&&"object"==typeof e}static assign(e,...t){for(const n of t)for(const t of Object.getOwnPropertyNames(n))e[t]=n[t]}static mixedListToArray(e){return null!==e&&"object"==typeof e?Object.keys(e).map((t=>e[t])):e}}},33324:(e,t,n)=>{"use strict";n.d(t,{m:()=>i});class i{static chunk(e,t){return Array.from(Array(Math.ceil(e.length/t)),((n,i)=>e.slice(i*t,i*t+t)))}static splitClassesAndStrings(e){return[e.filter((e=>"string"!=typeof e)),e.filter((e=>"string"==typeof e))]}static groupBy(e,t){return e.reduce(((e,n)=>{const i=t(n);let r=e.find((e=>e.id===i));return r||(r={id:i,items:[]},e.push(r)),r.items.push(n),e}),[])}static uniq(e,t){return e.reduce(((e,n)=>{let i=!1;if("function"==typeof t){const r=t(n);i=!!e.find((e=>t(e)===r))}else i="string"==typeof t?!!e.find((e=>e[t]===n[t])):-1!==e.indexOf(n);return i||e.push(n),e}),[])}static isPlainObject(e){return null!=e&&(!e.constructor||e.constructor===Object)}static mergeArrayKey(e,t,n,i){i.has(n)?e[t]=i.get(n):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||(e[t]=Array.isArray(n)?[]:{}),i.set(n,e[t]),this.merge(e[t],n,i),i.delete(n)):e[t]=n)}static mergeObjectKey(e,t,n,i){i.has(n)?Object.assign(e,{[t]:i.get(n)}):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||Object.assign(e,{[t]:Array.isArray(n)?[]:{}}),i.set(n,e[t]),this.merge(e[t],n,i),i.delete(n)):Object.assign(e,{[t]:n}))}static merge(e,t,n=new Map){if(this.isPlainObject(e)&&this.isPlainObject(t))for(const i of Object.keys(t))"__proto__"!==i&&this.mergeObjectKey(e,i,t[i],n);if(Array.isArray(e)&&Array.isArray(t))for(let i=0;i<t.length;i++)this.mergeArrayKey(e,i,t[i],n)}static mergeDeep(e,...t){if(!t.length)return e;for(const n of t)i.merge(e,n);return e}static deepCompare(...e){let t,n,i,r;if(arguments.length<1)return!0;for(t=1,n=arguments.length;t<n;t++)if(i=[],r=[],!this.compare2Objects(i,r,arguments[0],arguments[t]))return!1;return!0}static deepValue(e,t){const n=t.split(".");for(let t=0,i=n.length;t<i;t++)e=e[n[t]];return e}static replaceEmptyObjectsWithBooleans(e){for(let t in e)e[t]&&"object"==typeof e[t]&&(0===Object.keys(e[t]).length?e[t]=!0:this.replaceEmptyObjectsWithBooleans(e[t]))}static propertyPathsToTruthyObject(e){let t={};for(let n of e){const e=n.split(".");if(!e.length)continue;t[e[0]]&&!0!==t[e[0]]||(t[e[0]]={});let i=t[e[0]];for(let[t,n]of e.entries())0!==t&&(i[n]?i=i[n]:t===e.length-1?(i[n]={},i=null):(i[n]={},i=i[n]))}return this.replaceEmptyObjectsWithBooleans(t),t}static compareIds(e,t){return null!=e&&null!=t&&(("string"==typeof e.id&&"string"==typeof t.id||"number"==typeof e.id&&"number"==typeof t.id)&&1===Object.keys(e).length&&1===Object.keys(t).length?e.id===t.id:i.deepCompare(e,t))}static toBoolean(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0}static zipObject(e,t){return e.reduce(((e,n,i)=>(e[n]=t[i],e)),{})}static isArraysEqual(e,t){return e.length===t.length&&e.every((e=>-1!==t.indexOf(e)))}static areMutuallyExclusive(...e){return!e.some((t=>{const n=e.filter((e=>e!==t));return t.some((e=>n.some((t=>t.includes(e)))))}))}static compare2Objects(e,t,n,i){let r;if(Number.isNaN(n)&&Number.isNaN(i))return!0;if(n===i)return!0;if(null===n||null===i||void 0===n||void 0===i)return!1;if(("function"==typeof n.equals||"function"==typeof n.equals)&&n.equals(i))return!0;if("function"==typeof n&&"function"==typeof i||n instanceof Date&&i instanceof Date||n instanceof RegExp&&i instanceof RegExp||"string"==typeof n&&"string"==typeof i||"number"==typeof n&&"number"==typeof i)return n.toString()===i.toString();if("object"!=typeof n||"object"!=typeof i)return!1;if(n.isPrototypeOf(i)||i.isPrototypeOf(n))return!1;if(n.constructor!==i.constructor)return!1;if(n.prototype!==i.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(i)>-1)return!1;for(r in i){if(i.hasOwnProperty(r)!==n.hasOwnProperty(r))return!1;if(typeof i[r]!=typeof n[r])return!1}for(r in n){if(i.hasOwnProperty(r)!==n.hasOwnProperty(r))return!1;if(typeof i[r]!=typeof n[r])return!1;switch(typeof n[r]){case"object":case"function":if(e.push(n),t.push(i),!this.compare2Objects(e,t,n[r],i[r]))return!1;e.pop(),t.pop();break;default:if(n[r]!==i[r])return!1}}return!0}}},24783:(e,t,n)=>{"use strict";n.d(t,{LW:()=>s,ml:()=>c,nx:()=>o,tW:()=>l,xQ:()=>a});var i=n(13229),r=n.n(i);function a(e,t=!1){return e.replace(/^([A-Z])|[\s-_](\w)/g,(function(e,n,i,r){return!0===t&&0===r?n:i?i.toUpperCase():n.toLowerCase()}))}function s(e){return e.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}function o(e){return e.replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()))}function c(e,t={}){const{segmentLength:n=4,separator:i="__",termLength:r=2}=t;return e.split(i).reduce(((e,t)=>{const i=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),a=i.length>1?r:n,s=i.map((e=>e.substr(0,a))).join("");return e.push(s),e}),[]).join(i)}function l(e,t={}){const n=r()("sha256");n.update(e,"utf8");const i=n.digest("hex");return t.length?i.slice(0,t.length):i}},1572:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});class i{static isGreaterOrEqual(e,t){const n=r(e),i=r(t);return n[0]>i[0]||n[0]===i[0]&&n[1]>i[1]||n[0]===i[0]&&n[1]===i[1]&&n[2]>=i[2]}}function r(e=""){const t=[0,0,0];return e.split(".").forEach(((e,n)=>t[n]=parseInt(e,10))),t}},47778:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorValues=t.standardErrorCodes=void 0,t.standardErrorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901,unsupportedChain:4902}},t.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}}},63496:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardErrors=void 0;const i=n(47778),r=n(66394);function a(e,t){const[n,i]=o(t);return new c(e,n||(0,r.getMessageFromCode)(e),i)}function s(e,t){const[n,i]=o(t);return new l(e,n||(0,r.getMessageFromCode)(e),i)}function o(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t||void 0,n]}}return[]}t.standardErrors={rpc:{parse:e=>a(i.standardErrorCodes.rpc.parse,e),invalidRequest:e=>a(i.standardErrorCodes.rpc.invalidRequest,e),invalidParams:e=>a(i.standardErrorCodes.rpc.invalidParams,e),methodNotFound:e=>a(i.standardErrorCodes.rpc.methodNotFound,e),internal:e=>a(i.standardErrorCodes.rpc.internal,e),server:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return a(t,e)},invalidInput:e=>a(i.standardErrorCodes.rpc.invalidInput,e),resourceNotFound:e=>a(i.standardErrorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>a(i.standardErrorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>a(i.standardErrorCodes.rpc.transactionRejected,e),methodNotSupported:e=>a(i.standardErrorCodes.rpc.methodNotSupported,e),limitExceeded:e=>a(i.standardErrorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>s(i.standardErrorCodes.provider.userRejectedRequest,e),unauthorized:e=>s(i.standardErrorCodes.provider.unauthorized,e),unsupportedMethod:e=>s(i.standardErrorCodes.provider.unsupportedMethod,e),disconnected:e=>s(i.standardErrorCodes.provider.disconnected,e),chainDisconnected:e=>s(i.standardErrorCodes.provider.chainDisconnected,e),unsupportedChain:e=>s(i.standardErrorCodes.provider.unsupportedChain,e),custom:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:n,data:i}=e;if(!n||"string"!=typeof n)throw new Error('"message" must be a nonempty string');return new l(t,n,i)}}};class c extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}}class l extends c{constructor(e,t,n){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}}},2719:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardErrors=t.standardErrorCodes=t.serializeError=t.getMessageFromCode=t.getErrorCode=void 0;const i=n(47778);Object.defineProperty(t,"standardErrorCodes",{enumerable:!0,get:function(){return i.standardErrorCodes}});const r=n(63496);Object.defineProperty(t,"standardErrors",{enumerable:!0,get:function(){return r.standardErrors}});const a=n(95085);Object.defineProperty(t,"serializeError",{enumerable:!0,get:function(){return a.serializeError}});const s=n(66394);Object.defineProperty(t,"getErrorCode",{enumerable:!0,get:function(){return s.getErrorCode}}),Object.defineProperty(t,"getMessageFromCode",{enumerable:!0,get:function(){return s.getMessageFromCode}})},95085:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serializeError=void 0;const i=n(42331),r=n(14892),a=n(47778),s=n(66394);t.serializeError=function(e,t){const n=(0,s.serialize)(function(e){if("string"==typeof e)return{message:e,code:a.standardErrorCodes.rpc.internal};if((0,i.isErrorResponse)(e))return Object.assign(Object.assign({},e),{message:e.errorMessage,code:e.errorCode,data:{method:e.method}});return e}(e),{shouldIncludeStack:!0}),o=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors");o.searchParams.set("version",r.LIB_VERSION),o.searchParams.set("code",n.code.toString());const c=function(e,t){const n=null==e?void 0:e.method;if(n)return n;if(void 0===t)return;if("string"==typeof t)return t;if(!Array.isArray(t))return t.method;if(t.length>0)return t[0].method;return}(n.data,t);return c&&o.searchParams.set("method",c),o.searchParams.set("message",n.message),Object.assign(Object.assign({},n),{docUrl:o.href})}},66394:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.getErrorCode=t.isValidCode=t.getMessageFromCode=t.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const i=n(47778),r="Unspecified error message.";function a(e,n=r){if(e&&Number.isInteger(e)){const n=e.toString();if(l(i.errorValues,n))return i.errorValues[n].message;if(o(e))return t.JSON_RPC_SERVER_ERROR_MESSAGE}return n}function s(e){if(!Number.isInteger(e))return!1;const t=e.toString();return!!i.errorValues[t]||!!o(e)}function o(e){return e>=-32099&&e<=-32e3}function c(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){return"object"==typeof e&&null!==e&&t in e&&"string"==typeof e[t]}t.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.",t.getMessageFromCode=a,t.isValidCode=s,t.getErrorCode=function(e){var t;return"number"==typeof e?e:function(e){return"object"==typeof e&&null!==e&&("number"==typeof e.code||"number"==typeof e.errorCode)}(e)?null!==(t=e.code)&&void 0!==t?t:e.errorCode:void 0},t.serialize=function(e,{shouldIncludeStack:t=!1}={}){const n={};if(e&&"object"==typeof e&&!Array.isArray(e)&&l(e,"code")&&s(e.code)){const t=e;n.code=t.code,t.message&&"string"==typeof t.message?(n.message=t.message,l(t,"data")&&(n.data=t.data)):(n.message=a(n.code),n.data={originalError:c(e)})}else n.code=i.standardErrorCodes.rpc.internal,n.message=u(e,"message")?e.message:r,n.data={originalError:c(e)};return t&&(n.stack=u(e,"stack")?e.stack:void 0),n}},6496:(e,t)=>{"use strict";function n(){return e=>e}var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderType=t.RegExpString=t.IntNumber=t.BigIntString=t.AddressString=t.HexString=t.OpaqueType=void 0,t.OpaqueType=n,t.HexString=e=>e,t.AddressString=e=>e,t.BigIntString=e=>e,t.IntNumber=function(e){return Math.floor(e)},t.RegExpString=e=>e,function(e){e.CoinbaseWallet="CoinbaseWallet",e.MetaMask="MetaMask",e.Unselected=""}(i||(t.ProviderType=i={}))},29740:function(e,t,n){"use strict";var i=n(1048).Buffer,r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isMobileWeb=t.getLocation=t.isInIFrame=t.createQrUrl=t.getFavicon=t.range=t.isBigNumber=t.ensureParsedJSONObject=t.ensureBN=t.ensureRegExpString=t.ensureIntNumber=t.ensureBuffer=t.ensureAddressString=t.ensureEvenLengthHexString=t.ensureHexString=t.isHexString=t.prepend0x=t.strip0x=t.has0xPrefix=t.hexStringFromIntNumber=t.intNumberFromHexString=t.bigIntStringFromBN=t.hexStringFromBuffer=t.hexStringToUint8Array=t.uint8ArrayToHex=t.randomBytesHex=void 0;const a=r(n(82823)),s=n(2719),o=n(6496),c=/^[0-9]*$/,l=/^[a-f0-9]*$/;function u(e){return[...e].map((e=>e.toString(16).padStart(2,"0"))).join("")}function d(e){return e.startsWith("0x")||e.startsWith("0X")}function h(e){return d(e)?e.slice(2):e}function p(e){return d(e)?`0x${e.slice(2)}`:`0x${e}`}function m(e){if("string"!=typeof e)return!1;const t=h(e).toLowerCase();return l.test(t)}function f(e,t=!1){if("string"==typeof e){const n=h(e).toLowerCase();if(l.test(n))return(0,o.HexString)(t?`0x${n}`:n)}throw s.standardErrors.rpc.invalidParams(`"${String(e)}" is not a hexadecimal string`)}function y(e,t=!1){let n=f(e,!1);return n.length%2==1&&(n=(0,o.HexString)(`0${n}`)),t?(0,o.HexString)(`0x${n}`):n}function g(e){if("number"==typeof e&&Number.isInteger(e))return(0,o.IntNumber)(e);if("string"==typeof e){if(c.test(e))return(0,o.IntNumber)(Number(e));if(m(e))return(0,o.IntNumber)(new a.default(y(e,!1),16).toNumber())}throw s.standardErrors.rpc.invalidParams(`Not an integer: ${String(e)}`)}function b(e){if(null==e||"function"!=typeof e.constructor)return!1;const{constructor:t}=e;return"function"==typeof t.config&&"number"==typeof t.EUCLID}function w(){try{return null!==window.frameElement}catch(e){return!1}}t.randomBytesHex=function(e){return u(crypto.getRandomValues(new Uint8Array(e)))},t.uint8ArrayToHex=u,t.hexStringToUint8Array=function(e){return new Uint8Array(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))},t.hexStringFromBuffer=function(e,t=!1){const n=e.toString("hex");return(0,o.HexString)(t?`0x${n}`:n)},t.bigIntStringFromBN=function(e){return(0,o.BigIntString)(e.toString(10))},t.intNumberFromHexString=function(e){return(0,o.IntNumber)(new a.default(y(e,!1),16).toNumber())},t.hexStringFromIntNumber=function(e){return(0,o.HexString)(`0x${new a.default(e).toString(16)}`)},t.has0xPrefix=d,t.strip0x=h,t.prepend0x=p,t.isHexString=m,t.ensureHexString=f,t.ensureEvenLengthHexString=y,t.ensureAddressString=function(e){if("string"==typeof e){const t=h(e).toLowerCase();if(m(t)&&40===t.length)return(0,o.AddressString)(p(t))}throw s.standardErrors.rpc.invalidParams(`Invalid Ethereum address: ${String(e)}`)},t.ensureBuffer=function(e){if(i.isBuffer(e))return e;if("string"==typeof e){if(m(e)){const t=y(e,!1);return i.from(t,"hex")}return i.from(e,"utf8")}throw s.standardErrors.rpc.invalidParams(`Not binary data: ${String(e)}`)},t.ensureIntNumber=g,t.ensureRegExpString=function(e){if(e instanceof RegExp)return(0,o.RegExpString)(e.toString());throw s.standardErrors.rpc.invalidParams(`Not a RegExp: ${String(e)}`)},t.ensureBN=function(e){if(null!==e&&(a.default.isBN(e)||b(e)))return new a.default(e.toString(10),10);if("number"==typeof e)return new a.default(g(e));if("string"==typeof e){if(c.test(e))return new a.default(e,10);if(m(e))return new a.default(y(e,!1),16)}throw s.standardErrors.rpc.invalidParams(`Not an integer: ${String(e)}`)},t.ensureParsedJSONObject=function(e){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw s.standardErrors.rpc.invalidParams(`Not a JSON string or an object: ${String(e)}`)},t.isBigNumber=b,t.range=function(e,t){return Array.from({length:t-e},((t,n)=>e+n))},t.getFavicon=function(){const e=document.querySelector('link[sizes="192x192"]')||document.querySelector('link[sizes="180x180"]')||document.querySelector('link[rel="icon"]')||document.querySelector('link[rel="shortcut icon"]'),{protocol:t,host:n}=document.location,i=e?e.getAttribute("href"):null;return!i||i.startsWith("javascript:")||i.startsWith("vbscript:")?null:i.startsWith("http://")||i.startsWith("https://")||i.startsWith("data:")?i:i.startsWith("//")?t+i:`${t}//${n}${i}`},t.createQrUrl=function(e,t,n,i,r,a){return`${n}/#/link?${new URLSearchParams({[i?"parent-id":"id"]:e,secret:t,server:n,v:r,chainId:a.toString()}).toString()}`},t.isInIFrame=w,t.getLocation=function(){try{return w()&&window.top?window.top.location:window.location}catch(e){return window.location}},t.isMobileWeb=function(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent)}},42331:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isErrorResponse=void 0,t.isErrorResponse=function(e){return void 0!==e.errorMessage}},14892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIB_VERSION=void 0,t.LIB_VERSION="3.9.0"},59092:(e,t,n)=>{"use strict";var i,r=n(34767),a=n(55452);e=n.hmd(e),(i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&i(e);var s,o;"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;function c(e){var t=e.successes,n=e.fails,i=e.criticalFails;t>0&&(0,a.N8)({metricName:"exchange_rate_fetch_success",metricType:r.vj.count,value:t}),n>0&&(0,a.N8)({metricName:"exchange_rate_fetch_fail",metricType:r.vj.count,value:n}),i.forEach((function(e,t){(0,a.N8)({metricName:"critical_exchange_rate_fail",metricType:r.vj.count,value:e,tags:{asset:t}})}))}(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&s.register(c,"logRateResults","/workspaces/libs/analytics/data/Portfolio.tsx"),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&o(e)},84213:(e,t,n)=>{"use strict";var i,r=n(34767),a=n(55452);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e=n.hmd(e),(i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&i(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var u,d,h="task.receive_transaction.tx_received";function p(e){(0,a.Np)("confirm_transaction.gas_price_failure",c({loggingId:"26ee3024-b786-48e0-9554-f8458664821a"},e))}function m(e){(0,a.Np)("confirm_transaction.fee_wallet_balance_mismatch",c({},e))}function f(e){var t,n;(0,a.Np)("confirm_transaction.gas_price_success",{loggingId:"5735417b-822e-43ee-8747-5bebb2c4d5ef",chainId:null!==(t=e.chainId)&&void 0!==t?t:"",blockchain:e.blockchain,chainName:null!==(n=e.chainName)&&void 0!==n?n:""})}function y(){(0,a.Np)("eth_tx_accepted_but_reverted",{loggingId:"740f6ed8-0a25-4ce5-ab5f-c14815a3faa6"})}function g(){(0,a.Np)("solana_tx_accepted_but_reverted",{loggingId:"b15cba39-3793-42cf-b8d6-93f30842234e"})}function b(e){(0,a.Np)("task.resubmit_transaction.fail",{loggingId:"3450e9d1-0cc4-445d-a3b0-9afb2063aa4b",networkRawValue:e})}function w(e){var t=e.data,n=e.errorMessage;(0,a.Np)("nudge.invalid_data",{loggingId:"542ab748-a8a2-4b05-b9f0-7d9b64e60eea",data:t,errorMessage:n})}function _(e){(0,a.Np)("nudge.connection_error",{loggingId:"53e4f5df-968b-4284-bdcf-dc679c58119a",event:JSON.stringify(e)})}function v(){(0,a.Np)("nudge.connection_opened",{loggingId:"ce58aee7-cd4b-4c30-a004-d4e342d9ac4a"})}function E(e){var t=e.txSource,n=e.blockchain,i=e.chainId,r=e.chainName,s=e.txHash,o=e.isContractDeploy,c=e.isFirstPartyRPC,l=e.isSponsoredTx,u=e.isGaslessSwap;(0,a.Np)("tx_dropped",{loggingId:"eab43568-c7da-4527-9ccd-d6695088d93c",txSource:t,blockchain:n,chainId:i,chainName:r,txHash:s,isContractDeploy:o,isFirstPartyRPC:c,isSponsoredTx:l,isGaslessSwap:u})}function T(e){var t=e.txSource,n=e.blockchain,i=e.chainId,r=e.chainName,s=e.txHash,o=e.isContractDeploy,c=e.isFirstPartyRPC,l=e.isSponsoredTx,u=e.isGaslessSwap;(0,a.Np)("tx_failed",{loggingId:"a75f8247-37fa-4414-92b7-7f4bc0f84cbd",txSource:t,blockchain:n,chainId:i,chainName:r,txHash:s,isContractDeploy:o,isFirstPartyRPC:c,isSponsoredTx:l,isGaslessSwap:u})}function N(e){var t,n;(0,a.Np)("tx_confirmed",c(c({},e),{},{chainId:null!==(t=e.chainId)&&void 0!==t?t:-1,chainName:null!==(n=e.chainName)&&void 0!==n?n:""}))}function A(e){var t,n;(0,a.Np)(h,c(c({},e),{},{chainId:null!==(t=e.chainId)&&void 0!==t?t:-1,chainName:null!==(n=e.chainName)&&void 0!==n?n:""}))}function S(e){(0,a.Np)("tx_dropped_by_relayer",c({},e))}function x(e){var t=e.blockchain,n=e.chainId,i=e.chainName,r=e.currencyCode,s=e.contractAddress,o=e.networkName;(0,a.Np)("potential_exchange_rate_issue",{loggingId:"7c067630-bb8c-11ec-8422-0242ac120002",blockchain:t,currencyCode:r,contractAddress:null!=s?s:"",networkName:o,chainName:null!=i?i:"",chainId:null!=n?n:""})}function C(e){return(0,a.N8)({metricName:"transactions.sync.start",metricType:r.vj.count,value:1,tags:c({},e)})}function M(e){return(0,a.N8)({metricName:"transactions.sync.success",metricType:r.vj.count,value:1,tags:c({},e)})}function R(e){return(0,a.N8)({metricName:"transactions.sync.fail",metricType:r.vj.count,value:1,tags:c({},e)})}function k(){return(0,a.N8)({metricName:"transactions.had_malicious_zero_value_transfer",metricType:r.vj.count,value:1})}(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register("task.tx_generation.start","txGenerationStart","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.tx_generation.success","txGenerationSuccess","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.tx_generation.fail","txGenerationFail","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.confirm_transaction.tx_submitted.start","txSubmittedStart","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.confirm_transaction.tx_submitted.success","txSubmittedSuccess","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.confirm_transaction.tx_submitted.fail","txSubmittedFail","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(h,"txReceived","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.message_generation.start","messageGenerationStart","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.message_generation.success","messageGenerationSuccess","/workspaces/libs/analytics/data/Transactions.tsx"),u.register("task.message_generation.fail","messageGenerationFail","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(p,"logConfirmTransactionGasPriceFailure","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(m,"logConfirmTransactionFeeWalletBalanceMismatch","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(f,"logConfirmTransactionGasPriceSuccess","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(y,"logEthTransactionAcceptedButReverted","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(g,"logSolanaTxAcceptedButReverted","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(b,"logResubmitTransactionFail","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(w,"logNudgeInvalidData","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(_,"logNudgeConnectionError","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(v,"logNudgeConnectionOpened","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(E,"logTxDropped","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(T,"logTxFailed","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(N,"logTxConfirmed","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(A,"logTxRecieved","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(S,"logTxDroppedByRelayer","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(x,"logPotentialExchangeRateIssue","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(C,"triggerSyncTransactionsStart","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(M,"triggerSyncTransactionsSuccess","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(R,"triggerSyncTransactionsFail","/workspaces/libs/analytics/data/Transactions.tsx"),u.register(k,"triggerHadMaliciousZeroValueTransfer","/workspaces/libs/analytics/data/Transactions.tsx")),(d="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&d(e)},86125:function(e,t,n){var i;e=n.nmd(e),function(r){var a=t,s=(e&&e.exports,"object"==typeof n.g&&n.g);s.global!==s&&s.window;var o=function(e){this.message=e};(o.prototype=new Error).name="InvalidCharacterError";var c=function(e){throw new o(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,d={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n,i,r,a=e.length%3,s="",o=-1,u=e.length-a;++o<u;)t=e.charCodeAt(o)<<16,n=e.charCodeAt(++o)<<8,i=e.charCodeAt(++o),s+=l.charAt((r=t+n+i)>>18&63)+l.charAt(r>>12&63)+l.charAt(r>>6&63)+l.charAt(63&r);return 2==a?(t=e.charCodeAt(o)<<8,n=e.charCodeAt(++o),s+=l.charAt((r=t+n)>>10)+l.charAt(r>>4&63)+l.charAt(r<<2&63)+"="):1==a&&(r=e.charCodeAt(o),s+=l.charAt(r>>2)+l.charAt(r<<4&63)+"=="),s},decode:function(e){var t=(e=String(e).replace(u,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var n,i,r=0,a="",s=-1;++s<t;)i=l.indexOf(e.charAt(s)),n=r%4?64*n+i:i,r++%4&&(a+=String.fromCharCode(255&n>>(-2*r&6)));return a},version:"1.0.0"};void 0===(i=function(){return d}.call(t,n,t,e))||(e.exports=i)}()},47403:(e,t,n)=>{"use strict";var i=n(25636).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var a=e.charAt(r),s=a.charCodeAt(0);if(255!==t[s])throw new TypeError(a+" is ambiguous");t[s]=r}var o=e.length,c=e.charAt(0),l=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return i.alloc(0);for(var n=0,r=0,a=0;e[n]===c;)r++,n++;for(var s=(e.length-n)*l+1>>>0,u=new Uint8Array(s);e[n];){var d=t[e.charCodeAt(n)];if(255===d)return;for(var h=0,p=s-1;(0!==d||h<a)&&-1!==p;p--,h++)d+=o*u[p]>>>0,u[p]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");a=h,n++}for(var m=s-a;m!==s&&0===u[m];)m++;var f=i.allocUnsafe(r+(s-m));f.fill(0,0,r);for(var y=r;m!==s;)f[y++]=u[m++];return f}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=i.from(t)),!i.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var n=0,r=0,a=0,s=t.length;a!==s&&0===t[a];)a++,n++;for(var l=(s-a)*u+1>>>0,d=new Uint8Array(l);a!==s;){for(var h=t[a],p=0,m=l-1;(0!==h||p<r)&&-1!==m;m--,p++)h+=256*d[m]>>>0,d[m]=h%o>>>0,h=h/o>>>0;if(0!==h)throw new Error("Non-zero carry");r=p,a++}for(var f=l-r;f!==l&&0===d[f];)f++;for(var y=c.repeat(n);f<l;++f)y+=e.charAt(d[f]);return y},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw new Error("Non-base"+o+" character")}}}},7991:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,a=o(e),s=a[0],c=a[1],l=new r(function(e,t,n){return 3*(t+n)/4-n}(0,s,c)),u=0,d=c>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===c&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[u++]=255&t);1===c&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,a=[],s=16383,o=0,l=i-r;o<l;o+=s)a.push(c(e,o,o+s>l?l:o+s));1===r?(t=e[i-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,i){for(var r,a,s=[],o=t;o<i;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},82823:function(e,t,n){!function(e,t){"use strict";function i(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function a(e,t,n){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(n=t,t=10),this._init(e||0,t||10,n||"be"))}var s;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n(8379).Buffer}catch(e){}function o(e,t){var n=e.charCodeAt(t);return n>=48&&n<=57?n-48:n>=65&&n<=70?n-55:n>=97&&n<=102?n-87:void i(!1,"Invalid character in "+e)}function c(e,t,n){var i=o(e,n);return n-1>=t&&(i|=o(e,n-1)<<4),i}function l(e,t,n,r){for(var a=0,s=0,o=Math.min(e.length,n),c=t;c<o;c++){var l=e.charCodeAt(c)-48;a*=r,s=l>=49?l-49+10:l>=17?l-17+10:l,i(l>=0&&s<r,"Invalid character"),a+=s}return a}function u(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}if(a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),i(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,n):(this._parseBase(e,t,r),"le"===n&&this._initArray(this.toArray(),t,n)))},a.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(i(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},a.prototype._initArray=function(e,t,n){if(i("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,s,o=0;if("be"===n)for(r=e.length-1,a=0;r>=0;r-=3)s=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=s<<o&67108863,this.words[a+1]=s>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===n)for(r=0,a=0;r<e.length;r+=3)s=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=s<<o&67108863,this.words[a+1]=s>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this._strip()},a.prototype._parseHex=function(e,t,n){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var r,a=0,s=0;if("be"===n)for(i=e.length-1;i>=t;i-=2)r=c(e,t,i)<<a,this.words[s]|=67108863&r,a>=18?(a-=18,s+=1,this.words[s]|=r>>>26):a+=8;else for(i=(e.length-t)%2==0?t+1:t;i<e.length;i+=2)r=c(e,t,i)<<a,this.words[s]|=67108863&r,a>=18?(a-=18,s+=1,this.words[s]|=r>>>26):a+=8;this._strip()},a.prototype._parseBase=function(e,t,n){this.words=[0],this.length=1;for(var i=0,r=1;r<=67108863;r*=t)i++;i--,r=r/t|0;for(var a=e.length-n,s=a%i,o=Math.min(a,a-s)+n,c=0,u=n;u<o;u+=i)c=l(e,u,u+i,t),this.imuln(r),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var d=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)d*=t;this.imuln(d),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype._move=function(e){u(e,this)},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{a.prototype[Symbol.for("nodejs.util.inspect.custom")]=d}catch(e){a.prototype.inspect=d}else a.prototype.inspect=d;function d(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],p=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],m=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];a.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var r=0,a=0,s=0;s<this.length;s++){var o=this.words[s],c=(16777215&(o<<r|a)).toString(16);a=o>>>24-r&16777215,(r+=2)>=26&&(r-=26,s--),n=0!==a||s!==this.length-1?h[6-c.length]+c+n:c+n}for(0!==a&&(n=a.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=p[e],u=m[e];n="";var d=this.clone();for(d.negative=0;!d.isZero();){var f=d.modrn(u).toString(e);n=(d=d.idivn(u)).isZero()?f+n:h[l-f.length]+f+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}i(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16,2)},s&&(a.prototype.toBuffer=function(e,t){return this.toArrayLike(s,e,t)}),a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};function f(e,t,n){n.negative=t.negative^e.negative;var i=e.length+t.length|0;n.length=i,i=i-1|0;var r=0|e.words[0],a=0|t.words[0],s=r*a,o=67108863&s,c=s/67108864|0;n.words[0]=o;for(var l=1;l<i;l++){for(var u=c>>>26,d=67108863&c,h=Math.min(l,t.length-1),p=Math.max(0,l-e.length+1);p<=h;p++){var m=l-p|0;u+=(s=(r=0|e.words[m])*(a=0|t.words[p])+d)/67108864|0,d=67108863&s}n.words[l]=0|d,c=0|u}return 0!==c?n.words[l]=0|c:n.length--,n._strip()}a.prototype.toArrayLike=function(e,t,n){this._strip();var r=this.byteLength(),a=n||Math.max(1,r);i(r<=a,"byte array longer than desired length"),i(a>0,"Requested array length <= 0");var s=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,a);return this["_toArrayLike"+("le"===t?"LE":"BE")](s,r),s},a.prototype._toArrayLikeLE=function(e,t){for(var n=0,i=0,r=0,a=0;r<this.length;r++){var s=this.words[r]<<a|i;e[n++]=255&s,n<e.length&&(e[n++]=s>>8&255),n<e.length&&(e[n++]=s>>16&255),6===a?(n<e.length&&(e[n++]=s>>24&255),i=0,a=0):(i=s>>>24,a+=2)}if(n<e.length)for(e[n++]=i;n<e.length;)e[n++]=0},a.prototype._toArrayLikeBE=function(e,t){for(var n=e.length-1,i=0,r=0,a=0;r<this.length;r++){var s=this.words[r]<<a|i;e[n--]=255&s,n>=0&&(e[n--]=s>>8&255),n>=0&&(e[n--]=s>>16&255),6===a?(n>=0&&(e[n--]=s>>24&255),i=0,a=0):(i=s>>>24,a+=2)}if(n>=0)for(e[n--]=i;n>=0;)e[n--]=0},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,n=0;return t>=4096&&(n+=13,t>>>=13),t>=64&&(n+=7,t>>>=7),t>=8&&(n+=4,t>>>=4),t>=2&&(n+=2,t>>>=2),n+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,n=0;return 0==(8191&t)&&(n+=13,t>>>=13),0==(127&t)&&(n+=7,t>>>=7),0==(15&t)&&(n+=4,t>>>=4),0==(3&t)&&(n+=2,t>>>=2),0==(1&t)&&n++,n},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var n=this._zeroBits(this.words[t]);if(e+=n,26!==n)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},a.prototype.ior=function(e){return i(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]&e.words[n];return this.length=t.length,this._strip()},a.prototype.iand=function(e){return i(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,n;this.length>e.length?(t=this,n=e):(t=e,n=this);for(var i=0;i<n.length;i++)this.words[i]=t.words[i]^n.words[i];if(this!==t)for(;i<t.length;i++)this.words[i]=t.words[i];return this.length=t.length,this._strip()},a.prototype.ixor=function(e){return i(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){i("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return n>0&&(this.words[r]=~this.words[r]&67108863>>26-n),this._strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){i("number"==typeof e&&e>=0);var n=e/26|0,r=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<r:this.words[n]&~(1<<r),this._strip()},a.prototype.iadd=function(e){var t,n,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(n=this,i=e):(n=e,i=this);for(var r=0,a=0;a<i.length;a++)t=(0|n.words[a])+(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<n.length;a++)t=(0|n.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=n.length,0!==r)this.words[this.length]=r,this.length++;else if(n!==this)for(;a<n.length;a++)this.words[a]=n.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var n,i,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(n=this,i=e):(n=e,i=this);for(var a=0,s=0;s<i.length;s++)a=(t=(0|n.words[s])-(0|i.words[s])+a)>>26,this.words[s]=67108863&t;for(;0!==a&&s<n.length;s++)a=(t=(0|n.words[s])+a)>>26,this.words[s]=67108863&t;if(0===a&&s<n.length&&n!==this)for(;s<n.length;s++)this.words[s]=n.words[s];return this.length=Math.max(this.length,s),n!==this&&(this.negative=1),this._strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var y=function(e,t,n){var i,r,a,s=e.words,o=t.words,c=n.words,l=0,u=0|s[0],d=8191&u,h=u>>>13,p=0|s[1],m=8191&p,f=p>>>13,y=0|s[2],g=8191&y,b=y>>>13,w=0|s[3],_=8191&w,v=w>>>13,E=0|s[4],T=8191&E,N=E>>>13,A=0|s[5],S=8191&A,x=A>>>13,C=0|s[6],M=8191&C,R=C>>>13,k=0|s[7],O=8191&k,I=k>>>13,P=0|s[8],D=8191&P,L=P>>>13,q=0|s[9],$=8191&q,j=q>>>13,B=0|o[0],U=8191&B,V=B>>>13,F=0|o[1],K=8191&F,W=F>>>13,H=0|o[2],Q=8191&H,z=H>>>13,G=0|o[3],Y=8191&G,J=G>>>13,X=0|o[4],Z=8191&X,ee=X>>>13,te=0|o[5],ne=8191&te,ie=te>>>13,re=0|o[6],ae=8191&re,se=re>>>13,oe=0|o[7],ce=8191&oe,le=oe>>>13,ue=0|o[8],de=8191&ue,he=ue>>>13,pe=0|o[9],me=8191&pe,fe=pe>>>13;n.negative=e.negative^t.negative,n.length=19;var ye=(l+(i=Math.imul(d,U))|0)+((8191&(r=(r=Math.imul(d,V))+Math.imul(h,U)|0))<<13)|0;l=((a=Math.imul(h,V))+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,i=Math.imul(m,U),r=(r=Math.imul(m,V))+Math.imul(f,U)|0,a=Math.imul(f,V);var ge=(l+(i=i+Math.imul(d,K)|0)|0)+((8191&(r=(r=r+Math.imul(d,W)|0)+Math.imul(h,K)|0))<<13)|0;l=((a=a+Math.imul(h,W)|0)+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,i=Math.imul(g,U),r=(r=Math.imul(g,V))+Math.imul(b,U)|0,a=Math.imul(b,V),i=i+Math.imul(m,K)|0,r=(r=r+Math.imul(m,W)|0)+Math.imul(f,K)|0,a=a+Math.imul(f,W)|0;var be=(l+(i=i+Math.imul(d,Q)|0)|0)+((8191&(r=(r=r+Math.imul(d,z)|0)+Math.imul(h,Q)|0))<<13)|0;l=((a=a+Math.imul(h,z)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,i=Math.imul(_,U),r=(r=Math.imul(_,V))+Math.imul(v,U)|0,a=Math.imul(v,V),i=i+Math.imul(g,K)|0,r=(r=r+Math.imul(g,W)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,W)|0,i=i+Math.imul(m,Q)|0,r=(r=r+Math.imul(m,z)|0)+Math.imul(f,Q)|0,a=a+Math.imul(f,z)|0;var we=(l+(i=i+Math.imul(d,Y)|0)|0)+((8191&(r=(r=r+Math.imul(d,J)|0)+Math.imul(h,Y)|0))<<13)|0;l=((a=a+Math.imul(h,J)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,i=Math.imul(T,U),r=(r=Math.imul(T,V))+Math.imul(N,U)|0,a=Math.imul(N,V),i=i+Math.imul(_,K)|0,r=(r=r+Math.imul(_,W)|0)+Math.imul(v,K)|0,a=a+Math.imul(v,W)|0,i=i+Math.imul(g,Q)|0,r=(r=r+Math.imul(g,z)|0)+Math.imul(b,Q)|0,a=a+Math.imul(b,z)|0,i=i+Math.imul(m,Y)|0,r=(r=r+Math.imul(m,J)|0)+Math.imul(f,Y)|0,a=a+Math.imul(f,J)|0;var _e=(l+(i=i+Math.imul(d,Z)|0)|0)+((8191&(r=(r=r+Math.imul(d,ee)|0)+Math.imul(h,Z)|0))<<13)|0;l=((a=a+Math.imul(h,ee)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,i=Math.imul(S,U),r=(r=Math.imul(S,V))+Math.imul(x,U)|0,a=Math.imul(x,V),i=i+Math.imul(T,K)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(N,K)|0,a=a+Math.imul(N,W)|0,i=i+Math.imul(_,Q)|0,r=(r=r+Math.imul(_,z)|0)+Math.imul(v,Q)|0,a=a+Math.imul(v,z)|0,i=i+Math.imul(g,Y)|0,r=(r=r+Math.imul(g,J)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,J)|0,i=i+Math.imul(m,Z)|0,r=(r=r+Math.imul(m,ee)|0)+Math.imul(f,Z)|0,a=a+Math.imul(f,ee)|0;var ve=(l+(i=i+Math.imul(d,ne)|0)|0)+((8191&(r=(r=r+Math.imul(d,ie)|0)+Math.imul(h,ne)|0))<<13)|0;l=((a=a+Math.imul(h,ie)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,i=Math.imul(M,U),r=(r=Math.imul(M,V))+Math.imul(R,U)|0,a=Math.imul(R,V),i=i+Math.imul(S,K)|0,r=(r=r+Math.imul(S,W)|0)+Math.imul(x,K)|0,a=a+Math.imul(x,W)|0,i=i+Math.imul(T,Q)|0,r=(r=r+Math.imul(T,z)|0)+Math.imul(N,Q)|0,a=a+Math.imul(N,z)|0,i=i+Math.imul(_,Y)|0,r=(r=r+Math.imul(_,J)|0)+Math.imul(v,Y)|0,a=a+Math.imul(v,J)|0,i=i+Math.imul(g,Z)|0,r=(r=r+Math.imul(g,ee)|0)+Math.imul(b,Z)|0,a=a+Math.imul(b,ee)|0,i=i+Math.imul(m,ne)|0,r=(r=r+Math.imul(m,ie)|0)+Math.imul(f,ne)|0,a=a+Math.imul(f,ie)|0;var Ee=(l+(i=i+Math.imul(d,ae)|0)|0)+((8191&(r=(r=r+Math.imul(d,se)|0)+Math.imul(h,ae)|0))<<13)|0;l=((a=a+Math.imul(h,se)|0)+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,i=Math.imul(O,U),r=(r=Math.imul(O,V))+Math.imul(I,U)|0,a=Math.imul(I,V),i=i+Math.imul(M,K)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(R,K)|0,a=a+Math.imul(R,W)|0,i=i+Math.imul(S,Q)|0,r=(r=r+Math.imul(S,z)|0)+Math.imul(x,Q)|0,a=a+Math.imul(x,z)|0,i=i+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,J)|0)+Math.imul(N,Y)|0,a=a+Math.imul(N,J)|0,i=i+Math.imul(_,Z)|0,r=(r=r+Math.imul(_,ee)|0)+Math.imul(v,Z)|0,a=a+Math.imul(v,ee)|0,i=i+Math.imul(g,ne)|0,r=(r=r+Math.imul(g,ie)|0)+Math.imul(b,ne)|0,a=a+Math.imul(b,ie)|0,i=i+Math.imul(m,ae)|0,r=(r=r+Math.imul(m,se)|0)+Math.imul(f,ae)|0,a=a+Math.imul(f,se)|0;var Te=(l+(i=i+Math.imul(d,ce)|0)|0)+((8191&(r=(r=r+Math.imul(d,le)|0)+Math.imul(h,ce)|0))<<13)|0;l=((a=a+Math.imul(h,le)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,i=Math.imul(D,U),r=(r=Math.imul(D,V))+Math.imul(L,U)|0,a=Math.imul(L,V),i=i+Math.imul(O,K)|0,r=(r=r+Math.imul(O,W)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,W)|0,i=i+Math.imul(M,Q)|0,r=(r=r+Math.imul(M,z)|0)+Math.imul(R,Q)|0,a=a+Math.imul(R,z)|0,i=i+Math.imul(S,Y)|0,r=(r=r+Math.imul(S,J)|0)+Math.imul(x,Y)|0,a=a+Math.imul(x,J)|0,i=i+Math.imul(T,Z)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(N,Z)|0,a=a+Math.imul(N,ee)|0,i=i+Math.imul(_,ne)|0,r=(r=r+Math.imul(_,ie)|0)+Math.imul(v,ne)|0,a=a+Math.imul(v,ie)|0,i=i+Math.imul(g,ae)|0,r=(r=r+Math.imul(g,se)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,se)|0,i=i+Math.imul(m,ce)|0,r=(r=r+Math.imul(m,le)|0)+Math.imul(f,ce)|0,a=a+Math.imul(f,le)|0;var Ne=(l+(i=i+Math.imul(d,de)|0)|0)+((8191&(r=(r=r+Math.imul(d,he)|0)+Math.imul(h,de)|0))<<13)|0;l=((a=a+Math.imul(h,he)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,i=Math.imul($,U),r=(r=Math.imul($,V))+Math.imul(j,U)|0,a=Math.imul(j,V),i=i+Math.imul(D,K)|0,r=(r=r+Math.imul(D,W)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,W)|0,i=i+Math.imul(O,Q)|0,r=(r=r+Math.imul(O,z)|0)+Math.imul(I,Q)|0,a=a+Math.imul(I,z)|0,i=i+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,J)|0)+Math.imul(R,Y)|0,a=a+Math.imul(R,J)|0,i=i+Math.imul(S,Z)|0,r=(r=r+Math.imul(S,ee)|0)+Math.imul(x,Z)|0,a=a+Math.imul(x,ee)|0,i=i+Math.imul(T,ne)|0,r=(r=r+Math.imul(T,ie)|0)+Math.imul(N,ne)|0,a=a+Math.imul(N,ie)|0,i=i+Math.imul(_,ae)|0,r=(r=r+Math.imul(_,se)|0)+Math.imul(v,ae)|0,a=a+Math.imul(v,se)|0,i=i+Math.imul(g,ce)|0,r=(r=r+Math.imul(g,le)|0)+Math.imul(b,ce)|0,a=a+Math.imul(b,le)|0,i=i+Math.imul(m,de)|0,r=(r=r+Math.imul(m,he)|0)+Math.imul(f,de)|0,a=a+Math.imul(f,he)|0;var Ae=(l+(i=i+Math.imul(d,me)|0)|0)+((8191&(r=(r=r+Math.imul(d,fe)|0)+Math.imul(h,me)|0))<<13)|0;l=((a=a+Math.imul(h,fe)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,i=Math.imul($,K),r=(r=Math.imul($,W))+Math.imul(j,K)|0,a=Math.imul(j,W),i=i+Math.imul(D,Q)|0,r=(r=r+Math.imul(D,z)|0)+Math.imul(L,Q)|0,a=a+Math.imul(L,z)|0,i=i+Math.imul(O,Y)|0,r=(r=r+Math.imul(O,J)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,J)|0,i=i+Math.imul(M,Z)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(R,Z)|0,a=a+Math.imul(R,ee)|0,i=i+Math.imul(S,ne)|0,r=(r=r+Math.imul(S,ie)|0)+Math.imul(x,ne)|0,a=a+Math.imul(x,ie)|0,i=i+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(N,ae)|0,a=a+Math.imul(N,se)|0,i=i+Math.imul(_,ce)|0,r=(r=r+Math.imul(_,le)|0)+Math.imul(v,ce)|0,a=a+Math.imul(v,le)|0,i=i+Math.imul(g,de)|0,r=(r=r+Math.imul(g,he)|0)+Math.imul(b,de)|0,a=a+Math.imul(b,he)|0;var Se=(l+(i=i+Math.imul(m,me)|0)|0)+((8191&(r=(r=r+Math.imul(m,fe)|0)+Math.imul(f,me)|0))<<13)|0;l=((a=a+Math.imul(f,fe)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,i=Math.imul($,Q),r=(r=Math.imul($,z))+Math.imul(j,Q)|0,a=Math.imul(j,z),i=i+Math.imul(D,Y)|0,r=(r=r+Math.imul(D,J)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,J)|0,i=i+Math.imul(O,Z)|0,r=(r=r+Math.imul(O,ee)|0)+Math.imul(I,Z)|0,a=a+Math.imul(I,ee)|0,i=i+Math.imul(M,ne)|0,r=(r=r+Math.imul(M,ie)|0)+Math.imul(R,ne)|0,a=a+Math.imul(R,ie)|0,i=i+Math.imul(S,ae)|0,r=(r=r+Math.imul(S,se)|0)+Math.imul(x,ae)|0,a=a+Math.imul(x,se)|0,i=i+Math.imul(T,ce)|0,r=(r=r+Math.imul(T,le)|0)+Math.imul(N,ce)|0,a=a+Math.imul(N,le)|0,i=i+Math.imul(_,de)|0,r=(r=r+Math.imul(_,he)|0)+Math.imul(v,de)|0,a=a+Math.imul(v,he)|0;var xe=(l+(i=i+Math.imul(g,me)|0)|0)+((8191&(r=(r=r+Math.imul(g,fe)|0)+Math.imul(b,me)|0))<<13)|0;l=((a=a+Math.imul(b,fe)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,i=Math.imul($,Y),r=(r=Math.imul($,J))+Math.imul(j,Y)|0,a=Math.imul(j,J),i=i+Math.imul(D,Z)|0,r=(r=r+Math.imul(D,ee)|0)+Math.imul(L,Z)|0,a=a+Math.imul(L,ee)|0,i=i+Math.imul(O,ne)|0,r=(r=r+Math.imul(O,ie)|0)+Math.imul(I,ne)|0,a=a+Math.imul(I,ie)|0,i=i+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(R,ae)|0,a=a+Math.imul(R,se)|0,i=i+Math.imul(S,ce)|0,r=(r=r+Math.imul(S,le)|0)+Math.imul(x,ce)|0,a=a+Math.imul(x,le)|0,i=i+Math.imul(T,de)|0,r=(r=r+Math.imul(T,he)|0)+Math.imul(N,de)|0,a=a+Math.imul(N,he)|0;var Ce=(l+(i=i+Math.imul(_,me)|0)|0)+((8191&(r=(r=r+Math.imul(_,fe)|0)+Math.imul(v,me)|0))<<13)|0;l=((a=a+Math.imul(v,fe)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,i=Math.imul($,Z),r=(r=Math.imul($,ee))+Math.imul(j,Z)|0,a=Math.imul(j,ee),i=i+Math.imul(D,ne)|0,r=(r=r+Math.imul(D,ie)|0)+Math.imul(L,ne)|0,a=a+Math.imul(L,ie)|0,i=i+Math.imul(O,ae)|0,r=(r=r+Math.imul(O,se)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,se)|0,i=i+Math.imul(M,ce)|0,r=(r=r+Math.imul(M,le)|0)+Math.imul(R,ce)|0,a=a+Math.imul(R,le)|0,i=i+Math.imul(S,de)|0,r=(r=r+Math.imul(S,he)|0)+Math.imul(x,de)|0,a=a+Math.imul(x,he)|0;var Me=(l+(i=i+Math.imul(T,me)|0)|0)+((8191&(r=(r=r+Math.imul(T,fe)|0)+Math.imul(N,me)|0))<<13)|0;l=((a=a+Math.imul(N,fe)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,i=Math.imul($,ne),r=(r=Math.imul($,ie))+Math.imul(j,ne)|0,a=Math.imul(j,ie),i=i+Math.imul(D,ae)|0,r=(r=r+Math.imul(D,se)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,se)|0,i=i+Math.imul(O,ce)|0,r=(r=r+Math.imul(O,le)|0)+Math.imul(I,ce)|0,a=a+Math.imul(I,le)|0,i=i+Math.imul(M,de)|0,r=(r=r+Math.imul(M,he)|0)+Math.imul(R,de)|0,a=a+Math.imul(R,he)|0;var Re=(l+(i=i+Math.imul(S,me)|0)|0)+((8191&(r=(r=r+Math.imul(S,fe)|0)+Math.imul(x,me)|0))<<13)|0;l=((a=a+Math.imul(x,fe)|0)+(r>>>13)|0)+(Re>>>26)|0,Re&=67108863,i=Math.imul($,ae),r=(r=Math.imul($,se))+Math.imul(j,ae)|0,a=Math.imul(j,se),i=i+Math.imul(D,ce)|0,r=(r=r+Math.imul(D,le)|0)+Math.imul(L,ce)|0,a=a+Math.imul(L,le)|0,i=i+Math.imul(O,de)|0,r=(r=r+Math.imul(O,he)|0)+Math.imul(I,de)|0,a=a+Math.imul(I,he)|0;var ke=(l+(i=i+Math.imul(M,me)|0)|0)+((8191&(r=(r=r+Math.imul(M,fe)|0)+Math.imul(R,me)|0))<<13)|0;l=((a=a+Math.imul(R,fe)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,i=Math.imul($,ce),r=(r=Math.imul($,le))+Math.imul(j,ce)|0,a=Math.imul(j,le),i=i+Math.imul(D,de)|0,r=(r=r+Math.imul(D,he)|0)+Math.imul(L,de)|0,a=a+Math.imul(L,he)|0;var Oe=(l+(i=i+Math.imul(O,me)|0)|0)+((8191&(r=(r=r+Math.imul(O,fe)|0)+Math.imul(I,me)|0))<<13)|0;l=((a=a+Math.imul(I,fe)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,i=Math.imul($,de),r=(r=Math.imul($,he))+Math.imul(j,de)|0,a=Math.imul(j,he);var Ie=(l+(i=i+Math.imul(D,me)|0)|0)+((8191&(r=(r=r+Math.imul(D,fe)|0)+Math.imul(L,me)|0))<<13)|0;l=((a=a+Math.imul(L,fe)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863;var Pe=(l+(i=Math.imul($,me))|0)+((8191&(r=(r=Math.imul($,fe))+Math.imul(j,me)|0))<<13)|0;return l=((a=Math.imul(j,fe))+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,c[0]=ye,c[1]=ge,c[2]=be,c[3]=we,c[4]=_e,c[5]=ve,c[6]=Ee,c[7]=Te,c[8]=Ne,c[9]=Ae,c[10]=Se,c[11]=xe,c[12]=Ce,c[13]=Me,c[14]=Re,c[15]=ke,c[16]=Oe,c[17]=Ie,c[18]=Pe,0!==l&&(c[19]=l,n.length++),n};function g(e,t,n){n.negative=t.negative^e.negative,n.length=e.length+t.length;for(var i=0,r=0,a=0;a<n.length-1;a++){var s=r;r=0;for(var o=67108863&i,c=Math.min(a,t.length-1),l=Math.max(0,a-e.length+1);l<=c;l++){var u=a-l,d=(0|e.words[u])*(0|t.words[l]),h=67108863&d;o=67108863&(h=h+o|0),r+=(s=(s=s+(d/67108864|0)|0)+(h>>>26)|0)>>>26,s&=67108863}n.words[a]=o,i=s,s=r}return 0!==i?n.words[a]=i:n.length--,n._strip()}function b(e,t,n){return g(e,t,n)}function w(e,t){this.x=e,this.y=t}Math.imul||(y=f),a.prototype.mulTo=function(e,t){var n=this.length+e.length;return 10===this.length&&10===e.length?y(this,e,t):n<63?f(this,e,t):n<1024?g(this,e,t):b(this,e,t)},w.prototype.makeRBT=function(e){for(var t=new Array(e),n=a.prototype._countBits(e)-1,i=0;i<e;i++)t[i]=this.revBin(i,n,e);return t},w.prototype.revBin=function(e,t,n){if(0===e||e===n-1)return e;for(var i=0,r=0;r<t;r++)i|=(1&e)<<t-r-1,e>>=1;return i},w.prototype.permute=function(e,t,n,i,r,a){for(var s=0;s<a;s++)i[s]=t[e[s]],r[s]=n[e[s]]},w.prototype.transform=function(e,t,n,i,r,a){this.permute(a,e,t,n,i,r);for(var s=1;s<r;s<<=1)for(var o=s<<1,c=Math.cos(2*Math.PI/o),l=Math.sin(2*Math.PI/o),u=0;u<r;u+=o)for(var d=c,h=l,p=0;p<s;p++){var m=n[u+p],f=i[u+p],y=n[u+p+s],g=i[u+p+s],b=d*y-h*g;g=d*g+h*y,y=b,n[u+p]=m+y,i[u+p]=f+g,n[u+p+s]=m-y,i[u+p+s]=f-g,p!==o&&(b=c*d-l*h,h=c*h+l*d,d=b)}},w.prototype.guessLen13b=function(e,t){var n=1|Math.max(t,e),i=1&n,r=0;for(n=n/2|0;n;n>>>=1)r++;return 1<<r+1+i},w.prototype.conjugate=function(e,t,n){if(!(n<=1))for(var i=0;i<n/2;i++){var r=e[i];e[i]=e[n-i-1],e[n-i-1]=r,r=t[i],t[i]=-t[n-i-1],t[n-i-1]=-r}},w.prototype.normalize13b=function(e,t){for(var n=0,i=0;i<t/2;i++){var r=8192*Math.round(e[2*i+1]/t)+Math.round(e[2*i]/t)+n;e[i]=67108863&r,n=r<67108864?0:r/67108864|0}return e},w.prototype.convert13b=function(e,t,n,r){for(var a=0,s=0;s<t;s++)a+=0|e[s],n[2*s]=8191&a,a>>>=13,n[2*s+1]=8191&a,a>>>=13;for(s=2*t;s<r;++s)n[s]=0;i(0===a),i(0==(-8192&a))},w.prototype.stub=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t},w.prototype.mulp=function(e,t,n){var i=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(i),a=this.stub(i),s=new Array(i),o=new Array(i),c=new Array(i),l=new Array(i),u=new Array(i),d=new Array(i),h=n.words;h.length=i,this.convert13b(e.words,e.length,s,i),this.convert13b(t.words,t.length,l,i),this.transform(s,a,o,c,i,r),this.transform(l,a,u,d,i,r);for(var p=0;p<i;p++){var m=o[p]*u[p]-c[p]*d[p];c[p]=o[p]*d[p]+c[p]*u[p],o[p]=m}return this.conjugate(o,c,i),this.transform(o,c,h,a,i,r),this.conjugate(h,a,i),this.normalize13b(h,i),n.negative=e.negative^t.negative,n.length=e.length+t.length,n._strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),b(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){var t=e<0;t&&(e=-e),i("number"==typeof e),i(e<67108864);for(var n=0,r=0;r<this.length;r++){var a=(0|this.words[r])*e,s=(67108863&a)+(67108863&n);n>>=26,n+=a/67108864|0,n+=s>>>26,this.words[r]=67108863&s}return 0!==n&&(this.words[r]=n,this.length++),t?this.ineg():this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),n=0;n<t.length;n++){var i=n/26|0,r=n%26;t[n]=e.words[i]>>>r&1}return t}(e);if(0===t.length)return new a(1);for(var n=this,i=0;i<t.length&&0===t[i];i++,n=n.sqr());if(++i<t.length)for(var r=n.sqr();i<t.length;i++,r=r.sqr())0!==t[i]&&(n=n.mul(r));return n},a.prototype.iushln=function(e){i("number"==typeof e&&e>=0);var t,n=e%26,r=(e-n)/26,a=67108863>>>26-n<<26-n;if(0!==n){var s=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,c=(0|this.words[t])-o<<n;this.words[t]=c|s,s=o>>>26-n}s&&(this.words[t]=s,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this._strip()},a.prototype.ishln=function(e){return i(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,n){var r;i("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,s=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,c=n;if(r-=s,r=Math.max(0,r),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=r);l--){var d=0|this.words[l];this.words[l]=u<<26-a|d>>>a,u=d&o}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},a.prototype.ishrn=function(e,t,n){return i(0===this.negative),this.iushrn(e,t,n)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){i("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,r=1<<t;return!(this.length<=n)&&!!(this.words[n]&r)},a.prototype.imaskn=function(e){i("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this._strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return i("number"==typeof e),i(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(i("number"==typeof e),i(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,n){var r,a,s=e.length+n;this._expand(s);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+n])+o;var c=(0|e.words[r])*t;o=((a-=67108863&c)>>26)-(c/67108864|0),this.words[r+n]=67108863&a}for(;r<this.length-n;r++)o=(a=(0|this.words[r+n])+o)>>26,this.words[r+n]=67108863&a;if(0===o)return this._strip();for(i(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this._strip()},a.prototype._wordDiv=function(e,t){var n=(this.length,e.length),i=this.clone(),r=e,s=0|r.words[r.length-1];0!==(n=26-this._countBits(s))&&(r=r.ushln(n),i.iushln(n),s=0|r.words[r.length-1]);var o,c=i.length-r.length;if("mod"!==t){(o=new a(null)).length=c+1,o.words=new Array(o.length);for(var l=0;l<o.length;l++)o.words[l]=0}var u=i.clone()._ishlnsubmul(r,1,c);0===u.negative&&(i=u,o&&(o.words[c]=1));for(var d=c-1;d>=0;d--){var h=67108864*(0|i.words[r.length+d])+(0|i.words[r.length+d-1]);for(h=Math.min(h/s|0,67108863),i._ishlnsubmul(r,h,d);0!==i.negative;)h--,i.negative=0,i._ishlnsubmul(r,1,d),i.isZero()||(i.negative^=1);o&&(o.words[d]=h)}return o&&o._strip(),i._strip(),"div"!==t&&0!==n&&i.iushrn(n),{div:o||null,mod:i}},a.prototype.divmod=function(e,t,n){return i(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(s=o.mod.neg(),n&&0!==s.negative&&s.iadd(e)),{div:r,mod:s}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(s=o.mod.neg(),n&&0!==s.negative&&s.isub(e)),{div:o.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modrn(e.words[0]))}:this._wordDiv(e,t);var r,s,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var n=0!==t.div.negative?t.mod.isub(e):t.mod,i=e.ushrn(1),r=e.andln(1),a=n.cmp(i);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modrn=function(e){var t=e<0;t&&(e=-e),i(e<=67108863);for(var n=(1<<26)%e,r=0,a=this.length-1;a>=0;a--)r=(n*r+(0|this.words[a]))%e;return t?-r:r},a.prototype.modn=function(e){return this.modrn(e)},a.prototype.idivn=function(e){var t=e<0;t&&(e=-e),i(e<=67108863);for(var n=0,r=this.length-1;r>=0;r--){var a=(0|this.words[r])+67108864*n;this.words[r]=a/e|0,n=a%e}return this._strip(),t?this.ineg():this},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){i(0===e.negative),i(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),s=new a(0),o=new a(0),c=new a(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var u=n.clone(),d=t.clone();!t.isZero();){for(var h=0,p=1;0==(t.words[0]&p)&&h<26;++h,p<<=1);if(h>0)for(t.iushrn(h);h-- >0;)(r.isOdd()||s.isOdd())&&(r.iadd(u),s.isub(d)),r.iushrn(1),s.iushrn(1);for(var m=0,f=1;0==(n.words[0]&f)&&m<26;++m,f<<=1);if(m>0)for(n.iushrn(m);m-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(u),c.isub(d)),o.iushrn(1),c.iushrn(1);t.cmp(n)>=0?(t.isub(n),r.isub(o),s.isub(c)):(n.isub(t),o.isub(r),c.isub(s))}return{a:o,b:c,gcd:n.iushln(l)}},a.prototype._invmp=function(e){i(0===e.negative),i(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,s=new a(1),o=new a(0),c=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var d=0,h=1;0==(n.words[0]&h)&&d<26;++d,h<<=1);if(d>0)for(n.iushrn(d);d-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(o)):(n.isub(t),o.isub(s))}return(r=0===t.cmpn(1)?s:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),n=e.clone();t.negative=0,n.negative=0;for(var i=0;t.isEven()&&n.isEven();i++)t.iushrn(1),n.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;n.isEven();)n.iushrn(1);var r=t.cmp(n);if(r<0){var a=t;t=n,n=a}else if(0===r||0===n.cmpn(1))break;t.isub(n)}return n.iushln(i)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){i("number"==typeof e);var t=e%26,n=(e-t)/26,r=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=r,this;for(var a=r,s=n;0!==a&&s<this.length;s++){var o=0|this.words[s];a=(o+=a)>>>26,o&=67108863,this.words[s]=o}return 0!==a&&(this.words[s]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this._strip(),this.length>1)t=1;else{n&&(e=-e),i(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,n=this.length-1;n>=0;n--){var i=0|this.words[n],r=0|e.words[n];if(i!==r){i<r?t=-1:i>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new S(e)},a.prototype.toRed=function(e){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return i(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return i(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var _={k256:null,p224:null,p192:null,p25519:null};function v(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function E(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function T(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function N(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function A(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else i(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function x(e){S.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},v.prototype.ireduce=function(e){var t,n=e;do{this.split(n,this.tmp),t=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(t>this.n);var i=t<this.n?-1:n.ucmp(this.p);return 0===i?(n.words[0]=0,n.length=1):i>0?n.isub(this.p):void 0!==n.strip?n.strip():n._strip(),n},v.prototype.split=function(e,t){e.iushrn(this.n,0,t)},v.prototype.imulK=function(e){return e.imul(this.k)},r(E,v),E.prototype.split=function(e,t){for(var n=4194303,i=Math.min(e.length,9),r=0;r<i;r++)t.words[r]=e.words[r];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&n,r=10;r<e.length;r++){var s=0|e.words[r];e.words[r-10]=(s&n)<<4|a>>>22,a=s}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},E.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,n=0;n<e.length;n++){var i=0|e.words[n];t+=977*i,e.words[n]=67108863&t,t=64*i+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(T,v),r(N,v),r(A,v),A.prototype.imulK=function(e){for(var t=0,n=0;n<e.length;n++){var i=19*(0|e.words[n])+t,r=67108863&i;i>>>=26,e.words[n]=r,t=i}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(_[e])return _[e];var t;if("k256"===e)t=new E;else if("p224"===e)t=new T;else if("p192"===e)t=new N;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new A}return _[e]=t,t},S.prototype._verify1=function(e){i(0===e.negative,"red works only with positives"),i(e.red,"red works only with red numbers")},S.prototype._verify2=function(e,t){i(0==(e.negative|t.negative),"red works only with positives"),i(e.red&&e.red===t.red,"red works only with red numbers")},S.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(u(e,e.umod(this.m)._forceRed(this)),e)},S.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},S.prototype.add=function(e,t){this._verify2(e,t);var n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},S.prototype.iadd=function(e,t){this._verify2(e,t);var n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n},S.prototype.sub=function(e,t){this._verify2(e,t);var n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},S.prototype.isub=function(e,t){this._verify2(e,t);var n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n},S.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},S.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},S.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},S.prototype.isqr=function(e){return this.imul(e,e.clone())},S.prototype.sqr=function(e){return this.mul(e,e)},S.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(i(t%2==1),3===t){var n=this.m.add(new a(1)).iushrn(2);return this.pow(e,n)}for(var r=this.m.subn(1),s=0;!r.isZero()&&0===r.andln(1);)s++,r.iushrn(1);i(!r.isZero());var o=new a(1).toRed(this),c=o.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new a(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var d=this.pow(u,r),h=this.pow(e,r.addn(1).iushrn(1)),p=this.pow(e,r),m=s;0!==p.cmp(o);){for(var f=p,y=0;0!==f.cmp(o);y++)f=f.redSqr();i(y<m);var g=this.pow(d,new a(1).iushln(m-y-1));h=h.redMul(g),d=g.redSqr(),p=p.redMul(d),m=y}return h},S.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},S.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var n=new Array(16);n[0]=new a(1).toRed(this),n[1]=e;for(var i=2;i<n.length;i++)n[i]=this.mul(n[i-1],e);var r=n[0],s=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var l=t.words[i],u=c-1;u>=0;u--){var d=l>>u&1;r!==n[0]&&(r=this.sqr(r)),0!==d||0!==s?(s<<=1,s|=d,(4===++o||0===i&&0===u)&&(r=this.mul(r,n[s]),o=0,s=0)):o=0}c=26}return r},S.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},S.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new x(e)},r(x,S),x.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},x.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},x.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var n=e.imul(t),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=n.isub(i).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},x.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var n=e.mul(t),i=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=n.isub(i).iushrn(this.shift),s=r;return r.cmp(this.m)>=0?s=r.isub(this.m):r.cmpn(0)<0&&(s=r.iadd(this.m)),s._forceRed(this)},x.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=n.nmd(e),this)},39216:(e,t,n)=>{var i=n(47403);e.exports=i("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},1048:(e,t,n)=>{"use strict";const i=n(7991),r=n(39318),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|f(e,t);let i=o(n);const r=i.write(e,t);r!==n&&(i=i.slice(0,r));return i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return c.from(i,t,n);const r=function(e){if(c.isBuffer(e)){const t=0|m(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Y(e.length)?o(0):h(e);if("Buffer"===e.type&&Array.isArray(e.data))return h(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),o(e<0?0:0|m(e))}function h(e){const t=e.length<0?0:0|m(e.length),n=o(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,c.prototype),i}function m(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Q(e).length;default:if(r)return i?-1:H(e).length;t=(""+t).toLowerCase(),r=!0}}function y(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:w(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function w(e,t,n,i,r){let a,s=1,o=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,o/=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){let i=-1;for(a=n;a<o;a++)if(l(e,a)===l(t,-1===i?0:a-i)){if(-1===i&&(i=a),a-i+1===c)return i*s}else-1!==i&&(a-=a-i),i=-1}else for(n+c>o&&(n=o-c),a=n;a>=0;a--){let n=!0;for(let i=0;i<c;i++)if(l(e,a+i)!==l(t,i)){n=!1;break}if(n)return a}return-1}function _(e,t,n,i){n=Number(n)||0;const r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;const a=t.length;let s;for(i>a/2&&(i=a/2),s=0;s<i;++s){const i=parseInt(t.substr(2*s,2),16);if(Y(i))return s;e[n+s]=i}return s}function v(e,t,n,i){return z(H(t,e.length-n),e,n,i)}function E(e,t,n,i){return z(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function T(e,t,n,i){return z(Q(t),e,n,i)}function N(e,t,n,i){return z(function(e,t){let n,i,r;const a=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),i=n>>8,r=n%256,a.push(r),a.push(i);return a}(t,e.length-n),e,n,i)}function A(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);const i=[];let r=t;for(;r<n;){const t=e[r];let a=null,s=t>239?4:t>223?3:t>191?2:1;if(r+s<=n){let n,i,o,c;switch(s){case 1:t<128&&(a=t);break;case 2:n=e[r+1],128==(192&n)&&(c=(31&t)<<6|63&n,c>127&&(a=c));break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(c=(15&t)<<12|(63&n)<<6|63&i,c>2047&&(c<55296||c>57343)&&(a=c));break;case 4:n=e[r+1],i=e[r+2],o=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&o)&&(c=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&o,c>65535&&c<1114112&&(a=c))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),r+=s}return function(e){const t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=x));return n}(i)}t.kMaxLength=s,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},c.allocUnsafe=function(e){return d(e)},c.allocUnsafeSlow=function(e){return d(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(G(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const i=c.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if(G(t,Uint8Array))r+t.length>i.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,r)}r+=t.length}return i},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):y.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(c.prototype[a]=c.prototype.inspect),c.prototype.compare=function(e,t,n,i,r){if(G(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0);const o=Math.min(a,s),l=this.slice(i,r),u=e.slice(t,n);for(let e=0;e<o;++e)if(l[e]!==u[e]){a=l[e],s=u[e];break}return a<s?-1:s<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let a=!1;for(;;)switch(i){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const x=4096;function C(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function M(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function R(e,t,n){const i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=J[e[i]];return r}function k(e,t,n){const i=e.slice(t,n);let r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,i,r,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function P(e,t,n,i,r){V(t,i,r,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function D(e,t,n,i,r){V(t,i,r,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function L(e,t,n,i,r,a){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,i,a){return t=+t,n>>>=0,a||L(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function $(e,t,n,i,a){return t=+t,n>>>=0,a||L(e,0,n,8),r.write(e,t,n,i,52,8),n+8}c.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,c.prototype),i},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);let i=this[e],r=1,a=0;for(;++a<t&&(r*=256);)i+=this[e+a]*r;return i},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=X((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),c.prototype.readBigUInt64BE=X((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);let i=this[e],r=1,a=0;for(;++a<t&&(r*=256);)i+=this[e+a]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);let i=t,r=1,a=this[e+--i];for(;i>0&&(r*=256);)a+=this[e+--i]*r;return r*=128,a>=r&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=X((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=X((function(e){F(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){I(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){I(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=X((function(e,t=0){return P(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=X((function(e,t=0){return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=0,a=1,s=0;for(this[t]=255&e;++r<n&&(a*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/a>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=n-1,a=1,s=0;for(this[t+r]=255&e;--r>=0&&(a*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/a>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=X((function(e,t=0){return P(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=X((function(e,t=0){return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return $(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return $(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);const r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const a=c.isBuffer(e)?e:c.from(e,i),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=a[r%s]}return this};const j={};function B(e,t,n){j[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function U(e){let t="",n=e.length;const i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function V(e,t,n,i,r,a){if(e>n||e<t){const i="bigint"==typeof t?"n":"";let r;throw r=a>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(a+1)}${i}`:`>= -(2${i} ** ${8*(a+1)-1}${i}) and < 2 ** ${8*(a+1)-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new j.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){F(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||K(t,e.length-(n+1))}(i,r,a)}function F(e,t){if("number"!=typeof e)throw new j.ERR_INVALID_ARG_TYPE(t,"number",e)}function K(e,t,n){if(Math.floor(e)!==e)throw F(e,n),new j.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new j.ERR_BUFFER_OUT_OF_BOUNDS;throw new j.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}B("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),B("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),B("ERR_OUT_OF_RANGE",(function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=U(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=U(r)),r+="n"),i+=` It must be ${t}. Received ${r}`,i}),RangeError);const W=/[^+/0-9A-Za-z-_]/g;function H(e,t){let n;t=t||1/0;const i=e.length;let r=null;const a=[];for(let s=0;s<i;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function Q(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},43934:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=t},30242:e=>{var t,n;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,i=0;n<e.length;n++,i+=8)t[i>>>5]|=e[n]<<24-i%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],i=0;i<e.length;i+=3)for(var r=e[i]<<16|e[i+1]<<8|e[i+2],a=0;a<4;a++)8*i+6*a<=8*e.length?n.push(t.charAt(r>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],i=0,r=0;i<e.length;r=++i%4)0!=r&&n.push((t.indexOf(e.charAt(i-1))&Math.pow(2,-2*r+8)-1)<<2*r|t.indexOf(e.charAt(i))>>>6-2*r);return n}},e.exports=n},20124:(e,t,n)=>{var i=n(39907);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}!e&&void 0!==i&&"env"in i&&(e="MISSING_ENV_VAR".DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(27891)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},27891:(e,t,n)=>{e.exports=function(e){function t(e){let n,r,a,s=null;function o(...e){if(!o.enabled)return;const i=o,r=Number(new Date),a=r-(n||r);i.diff=a,i.prev=n,i.curr=r,n=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,r)=>{if("%%"===n)return"%";s++;const a=t.formatters[r];if("function"==typeof a){const t=e[s];n=a.call(i,t),e.splice(s,1),s--}return n})),t.formatArgs.call(i,e);(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(r!==t.namespaces&&(r=t.namespaces,a=t.enabled(e)),a),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,n){const i=t(this.namespace+(void 0===n?":":n)+e);return i.log=this.log,i}function r(e,t){let n=0,i=0,r=-1,a=0;for(;n<e.length;)if(i<t.length&&(t[i]===e[n]||"*"===t[i]))"*"===t[i]?(r=i,a=n,i++):(n++,i++);else{if(-1===r)return!1;i=r+1,a++,n=a}for(;i<t.length&&"*"===t[i];)i++;return i===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=n(27250),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},89029:function(e,t,n){var i;!function(r){"use strict";var a,s,o,c=9e15,l=1e9,u="0123456789abcdef",d="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",h="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",p={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-c,maxE:c,crypto:!1},m=!0,f="[DecimalError] ",y=f+"Invalid argument: ",g=f+"Precision limit exceeded",b=f+"crypto unavailable",w="[object Decimal]",_=Math.floor,v=Math.pow,E=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,T=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,N=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,A=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,S=1e7,x=7,C=d.length-1,M=h.length-1,R={toStringTag:w};function k(e){var t,n,i,r=e.length-1,a="",s=e[0];if(r>0){for(a+=s,t=1;t<r;t++)i=e[t]+"",(n=x-i.length)&&(a+=V(n)),a+=i;s=e[t],(n=x-(i=s+"").length)&&(a+=V(n))}else if(0===s)return"0";for(;s%10==0;)s/=10;return a+s}function O(e,t,n){if(e!==~~e||e<t||e>n)throw Error(y+e)}function I(e,t,n,i){var r,a,s,o;for(a=e[0];a>=10;a/=10)--t;return--t<0?(t+=x,r=0):(r=Math.ceil((t+1)/x),t%=x),a=v(10,x-t),o=e[r]%a|0,null==i?t<3?(0==t?o=o/100|0:1==t&&(o=o/10|0),s=n<4&&99999==o||n>3&&49999==o||5e4==o||0==o):s=(n<4&&o+1==a||n>3&&o+1==a/2)&&(e[r+1]/a/100|0)==v(10,t-2)-1||(o==a/2||0==o)&&0==(e[r+1]/a/100|0):t<4?(0==t?o=o/1e3|0:1==t?o=o/100|0:2==t&&(o=o/10|0),s=(i||n<4)&&9999==o||!i&&n>3&&4999==o):s=((i||n<4)&&o+1==a||!i&&n>3&&o+1==a/2)&&(e[r+1]/a/1e3|0)==v(10,t-3)-1,s}function P(e,t,n){for(var i,r,a=[0],s=0,o=e.length;s<o;){for(r=a.length;r--;)a[r]*=t;for(a[0]+=u.indexOf(e.charAt(s++)),i=0;i<a.length;i++)a[i]>n-1&&(void 0===a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/n|0,a[i]%=n)}return a.reverse()}R.absoluteValue=R.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),L(e)},R.ceil=function(){return L(new this.constructor(this),this.e+1,2)},R.clampedTo=R.clamp=function(e,t){var n=this,i=n.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(y+t);return n.cmp(e)<0?e:n.cmp(t)>0?t:new i(n)},R.comparedTo=R.cmp=function(e){var t,n,i,r,a=this,s=a.d,o=(e=new a.constructor(e)).d,c=a.s,l=e.s;if(!s||!o)return c&&l?c!==l?c:s===o?0:!s^c<0?1:-1:NaN;if(!s[0]||!o[0])return s[0]?c:o[0]?-l:0;if(c!==l)return c;if(a.e!==e.e)return a.e>e.e^c<0?1:-1;for(t=0,n=(i=s.length)<(r=o.length)?i:r;t<n;++t)if(s[t]!==o[t])return s[t]>o[t]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1},R.cosine=R.cos=function(){var e,t,n=this,i=n.constructor;return n.d?n.d[0]?(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+x,i.rounding=1,n=function(e,t){var n,i,r;if(t.isZero())return t;i=t.d.length,i<32?r=(1/X(4,n=Math.ceil(i/3))).toString():(n=16,r="2.3283064365386962890625e-10");e.precision+=n,t=J(e,1,t.times(r),new e(1));for(var a=n;a--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}(i,Z(i,n)),i.precision=e,i.rounding=t,L(2==o||3==o?n.neg():n,e,t,!0)):new i(1):new i(NaN)},R.cubeRoot=R.cbrt=function(){var e,t,n,i,r,a,s,o,c,l,u=this,d=u.constructor;if(!u.isFinite()||u.isZero())return new d(u);for(m=!1,(a=u.s*v(u.s*u,1/3))&&Math.abs(a)!=1/0?i=new d(a.toString()):(n=k(u.d),(a=((e=u.e)-n.length+1)%3)&&(n+=1==a||-2==a?"0":"00"),a=v(n,1/3),e=_((e+1)/3)-(e%3==(e<0?-1:2)),(i=new d(n=a==1/0?"5e"+e:(n=a.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=u.s),s=(e=d.precision)+3;;)if(l=(c=(o=i).times(o).times(o)).plus(u),i=D(l.plus(u).times(o),l.plus(c),s+2,1),k(o.d).slice(0,s)===(n=k(i.d)).slice(0,s)){if("9999"!=(n=n.slice(s-3,s+1))&&(r||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(L(i,e+1,1),t=!i.times(i).times(i).eq(u));break}if(!r&&(L(o,e+1,0),o.times(o).times(o).eq(u))){i=o;break}s+=4,r=1}return m=!0,L(i,e,d.rounding,t)},R.decimalPlaces=R.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=((e=t.length-1)-_(this.e/x))*x,e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},R.dividedBy=R.div=function(e){return D(this,new this.constructor(e))},R.dividedToIntegerBy=R.divToInt=function(e){var t=this.constructor;return L(D(this,new t(e),0,1,1),t.precision,t.rounding)},R.equals=R.eq=function(e){return 0===this.cmp(e)},R.floor=function(){return L(new this.constructor(this),this.e+1,3)},R.greaterThan=R.gt=function(e){return this.cmp(e)>0},R.greaterThanOrEqualTo=R.gte=function(e){var t=this.cmp(e);return 1==t||0===t},R.hyperbolicCosine=R.cosh=function(){var e,t,n,i,r,a=this,s=a.constructor,o=new s(1);if(!a.isFinite())return new s(a.s?1/0:NaN);if(a.isZero())return o;n=s.precision,i=s.rounding,s.precision=n+Math.max(a.e,a.sd())+4,s.rounding=1,(r=a.d.length)<32?t=(1/X(4,e=Math.ceil(r/3))).toString():(e=16,t="2.3283064365386962890625e-10"),a=J(s,1,a.times(t),new s(1),!0);for(var c,l=e,u=new s(8);l--;)c=a.times(a),a=o.minus(c.times(u.minus(c.times(u))));return L(a,s.precision=n,s.rounding=i,!0)},R.hyperbolicSine=R.sinh=function(){var e,t,n,i,r=this,a=r.constructor;if(!r.isFinite()||r.isZero())return new a(r);if(t=a.precision,n=a.rounding,a.precision=t+Math.max(r.e,r.sd())+4,a.rounding=1,(i=r.d.length)<3)r=J(a,2,r,r,!0);else{e=(e=1.4*Math.sqrt(i))>16?16:0|e,r=J(a,2,r=r.times(1/X(5,e)),r,!0);for(var s,o=new a(5),c=new a(16),l=new a(20);e--;)s=r.times(r),r=r.times(o.plus(s.times(c.times(s).plus(l))))}return a.precision=t,a.rounding=n,L(r,t,n,!0)},R.hyperbolicTangent=R.tanh=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+7,i.rounding=1,D(n.sinh(),n.cosh(),i.precision=e,i.rounding=t)):new i(n.s)},R.inverseCosine=R.acos=function(){var e,t=this,n=t.constructor,i=t.abs().cmp(1),r=n.precision,a=n.rounding;return-1!==i?0===i?t.isNeg()?B(n,r,a):new n(0):new n(NaN):t.isZero()?B(n,r+4,a).times(.5):(n.precision=r+6,n.rounding=1,t=t.asin(),e=B(n,r+4,a).times(.5),n.precision=r,n.rounding=a,e.minus(t))},R.inverseHyperbolicCosine=R.acosh=function(){var e,t,n=this,i=n.constructor;return n.lte(1)?new i(n.eq(1)?0:NaN):n.isFinite()?(e=i.precision,t=i.rounding,i.precision=e+Math.max(Math.abs(n.e),n.sd())+4,i.rounding=1,m=!1,n=n.times(n).minus(1).sqrt().plus(n),m=!0,i.precision=e,i.rounding=t,n.ln()):new i(n)},R.inverseHyperbolicSine=R.asinh=function(){var e,t,n=this,i=n.constructor;return!n.isFinite()||n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,i.rounding=1,m=!1,n=n.times(n).plus(1).sqrt().plus(n),m=!0,i.precision=e,i.rounding=t,n.ln())},R.inverseHyperbolicTangent=R.atanh=function(){var e,t,n,i,r=this,a=r.constructor;return r.isFinite()?r.e>=0?new a(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(e=a.precision,t=a.rounding,i=r.sd(),Math.max(i,e)<2*-r.e-1?L(new a(r),e,t,!0):(a.precision=n=i-r.e,r=D(r.plus(1),new a(1).minus(r),n+e,1),a.precision=e+4,a.rounding=1,r=r.ln(),a.precision=e,a.rounding=t,r.times(.5))):new a(NaN)},R.inverseSine=R.asin=function(){var e,t,n,i,r=this,a=r.constructor;return r.isZero()?new a(r):(t=r.abs().cmp(1),n=a.precision,i=a.rounding,-1!==t?0===t?((e=B(a,n+4,i).times(.5)).s=r.s,e):new a(NaN):(a.precision=n+6,a.rounding=1,r=r.div(new a(1).minus(r.times(r)).sqrt().plus(1)).atan(),a.precision=n,a.rounding=i,r.times(2)))},R.inverseTangent=R.atan=function(){var e,t,n,i,r,a,s,o,c,l=this,u=l.constructor,d=u.precision,h=u.rounding;if(l.isFinite()){if(l.isZero())return new u(l);if(l.abs().eq(1)&&d+4<=M)return(s=B(u,d+4,h).times(.25)).s=l.s,s}else{if(!l.s)return new u(NaN);if(d+4<=M)return(s=B(u,d+4,h).times(.5)).s=l.s,s}for(u.precision=o=d+10,u.rounding=1,e=n=Math.min(28,o/x+2|0);e;--e)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(m=!1,t=Math.ceil(o/x),i=1,c=l.times(l),s=new u(l),r=l;-1!==e;)if(r=r.times(c),a=s.minus(r.div(i+=2)),r=r.times(c),void 0!==(s=a.plus(r.div(i+=2))).d[t])for(e=t;s.d[e]===a.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),m=!0,L(s,u.precision=d,u.rounding=h,!0)},R.isFinite=function(){return!!this.d},R.isInteger=R.isInt=function(){return!!this.d&&_(this.e/x)>this.d.length-2},R.isNaN=function(){return!this.s},R.isNegative=R.isNeg=function(){return this.s<0},R.isPositive=R.isPos=function(){return this.s>0},R.isZero=function(){return!!this.d&&0===this.d[0]},R.lessThan=R.lt=function(e){return this.cmp(e)<0},R.lessThanOrEqualTo=R.lte=function(e){return this.cmp(e)<1},R.logarithm=R.log=function(e){var t,n,i,r,a,s,o,c,l=this,u=l.constructor,d=u.precision,h=u.rounding;if(null==e)e=new u(10),t=!0;else{if(n=(e=new u(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new u(NaN);t=e.eq(10)}if(n=l.d,l.s<0||!n||!n[0]||l.eq(1))return new u(n&&!n[0]?-1/0:1!=l.s?NaN:n?0:1/0);if(t)if(n.length>1)a=!0;else{for(r=n[0];r%10==0;)r/=10;a=1!==r}if(m=!1,s=Q(l,o=d+5),i=t?j(u,o+10):Q(e,o),I((c=D(s,i,o,1)).d,r=d,h))do{if(s=Q(l,o+=10),i=t?j(u,o+10):Q(e,o),c=D(s,i,o,1),!a){+k(c.d).slice(r+1,r+15)+1==1e14&&(c=L(c,d+1,0));break}}while(I(c.d,r+=10,h));return m=!0,L(c,d,h)},R.minus=R.sub=function(e){var t,n,i,r,a,s,o,c,l,u,d,h,p=this,f=p.constructor;if(e=new f(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new f(e.d||p.s!==e.s?p:NaN):e=new f(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(l=p.d,h=e.d,o=f.precision,c=f.rounding,!l[0]||!h[0]){if(h[0])e.s=-e.s;else{if(!l[0])return new f(3===c?-0:0);e=new f(p)}return m?L(e,o,c):e}if(n=_(e.e/x),u=_(p.e/x),l=l.slice(),a=u-n){for((d=a<0)?(t=l,a=-a,s=h.length):(t=h,n=u,s=l.length),a>(i=Math.max(Math.ceil(o/x),s)+2)&&(a=i,t.length=1),t.reverse(),i=a;i--;)t.push(0);t.reverse()}else{for((d=(i=l.length)<(s=h.length))&&(s=i),i=0;i<s;i++)if(l[i]!=h[i]){d=l[i]<h[i];break}a=0}for(d&&(t=l,l=h,h=t,e.s=-e.s),s=l.length,i=h.length-s;i>0;--i)l[s++]=0;for(i=h.length;i>a;){if(l[--i]<h[i]){for(r=i;r&&0===l[--r];)l[r]=S-1;--l[r],l[i]+=S}l[i]-=h[i]}for(;0===l[--s];)l.pop();for(;0===l[0];l.shift())--n;return l[0]?(e.d=l,e.e=$(l,n),m?L(e,o,c):e):new f(3===c?-0:0)},R.modulo=R.mod=function(e){var t,n=this,i=n.constructor;return e=new i(e),!n.d||!e.s||e.d&&!e.d[0]?new i(NaN):!e.d||n.d&&!n.d[0]?L(new i(n),i.precision,i.rounding):(m=!1,9==i.modulo?(t=D(n,e.abs(),0,3,1)).s*=e.s:t=D(n,e,0,i.modulo,1),t=t.times(e),m=!0,n.minus(t))},R.naturalExponential=R.exp=function(){return H(this)},R.naturalLogarithm=R.ln=function(){return Q(this)},R.negated=R.neg=function(){var e=new this.constructor(this);return e.s=-e.s,L(e)},R.plus=R.add=function(e){var t,n,i,r,a,s,o,c,l,u,d=this,h=d.constructor;if(e=new h(e),!d.d||!e.d)return d.s&&e.s?d.d||(e=new h(e.d||d.s===e.s?d:NaN)):e=new h(NaN),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(l=d.d,u=e.d,o=h.precision,c=h.rounding,!l[0]||!u[0])return u[0]||(e=new h(d)),m?L(e,o,c):e;if(a=_(d.e/x),i=_(e.e/x),l=l.slice(),r=a-i){for(r<0?(n=l,r=-r,s=u.length):(n=u,i=a,s=l.length),r>(s=(a=Math.ceil(o/x))>s?a+1:s+1)&&(r=s,n.length=1),n.reverse();r--;)n.push(0);n.reverse()}for((s=l.length)-(r=u.length)<0&&(r=s,n=u,u=l,l=n),t=0;r;)t=(l[--r]=l[r]+u[r]+t)/S|0,l[r]%=S;for(t&&(l.unshift(t),++i),s=l.length;0==l[--s];)l.pop();return e.d=l,e.e=$(l,i),m?L(e,o,c):e},R.precision=R.sd=function(e){var t,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(y+e);return n.d?(t=U(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},R.round=function(){var e=this,t=e.constructor;return L(new t(e),e.e+1,t.rounding)},R.sine=R.sin=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+x,i.rounding=1,n=function(e,t){var n,i=t.d.length;if(i<3)return t.isZero()?t:J(e,2,t,t);n=(n=1.4*Math.sqrt(i))>16?16:0|n,t=t.times(1/X(5,n)),t=J(e,2,t,t);for(var r,a=new e(5),s=new e(16),o=new e(20);n--;)r=t.times(t),t=t.times(a.plus(r.times(s.times(r).minus(o))));return t}(i,Z(i,n)),i.precision=e,i.rounding=t,L(o>2?n.neg():n,e,t,!0)):new i(NaN)},R.squareRoot=R.sqrt=function(){var e,t,n,i,r,a,s=this,o=s.d,c=s.e,l=s.s,u=s.constructor;if(1!==l||!o||!o[0])return new u(!l||l<0&&(!o||o[0])?NaN:o?s:1/0);for(m=!1,0==(l=Math.sqrt(+s))||l==1/0?(((t=k(o)).length+c)%2==0&&(t+="0"),l=Math.sqrt(t),c=_((c+1)/2)-(c<0||c%2),i=new u(t=l==1/0?"5e"+c:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+c)):i=new u(l.toString()),n=(c=u.precision)+3;;)if(i=(a=i).plus(D(s,a,n+2,1)).times(.5),k(a.d).slice(0,n)===(t=k(i.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(L(i,c+1,1),e=!i.times(i).eq(s));break}if(!r&&(L(a,c+1,0),a.times(a).eq(s))){i=a;break}n+=4,r=1}return m=!0,L(i,c,u.rounding,e)},R.tangent=R.tan=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+10,i.rounding=1,(n=n.sin()).s=1,n=D(n,new i(1).minus(n.times(n)).sqrt(),e+10,0),i.precision=e,i.rounding=t,L(2==o||4==o?n.neg():n,e,t,!0)):new i(NaN)},R.times=R.mul=function(e){var t,n,i,r,a,s,o,c,l,u=this,d=u.constructor,h=u.d,p=(e=new d(e)).d;if(e.s*=u.s,!(h&&h[0]&&p&&p[0]))return new d(!e.s||h&&!h[0]&&!p||p&&!p[0]&&!h?NaN:h&&p?0*e.s:e.s/0);for(n=_(u.e/x)+_(e.e/x),(c=h.length)<(l=p.length)&&(a=h,h=p,p=a,s=c,c=l,l=s),a=[],i=s=c+l;i--;)a.push(0);for(i=l;--i>=0;){for(t=0,r=c+i;r>i;)o=a[r]+p[i]*h[r-i-1]+t,a[r--]=o%S|0,t=o/S|0;a[r]=(a[r]+t)%S|0}for(;!a[--s];)a.pop();return t?++n:a.shift(),e.d=a,e.e=$(a,n),m?L(e,d.precision,d.rounding):e},R.toBinary=function(e,t){return ee(this,2,e,t)},R.toDecimalPlaces=R.toDP=function(e,t){var n=this,i=n.constructor;return n=new i(n),void 0===e?n:(O(e,0,l),void 0===t?t=i.rounding:O(t,0,8),L(n,e+n.e+1,t))},R.toExponential=function(e,t){var n,i=this,r=i.constructor;return void 0===e?n=q(i,!0):(O(e,0,l),void 0===t?t=r.rounding:O(t,0,8),n=q(i=L(new r(i),e+1,t),!0,e+1)),i.isNeg()&&!i.isZero()?"-"+n:n},R.toFixed=function(e,t){var n,i,r=this,a=r.constructor;return void 0===e?n=q(r):(O(e,0,l),void 0===t?t=a.rounding:O(t,0,8),n=q(i=L(new a(r),e+r.e+1,t),!1,e+i.e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},R.toFraction=function(e){var t,n,i,r,a,s,o,c,l,u,d,h,p=this,f=p.d,g=p.constructor;if(!f)return new g(p);if(l=n=new g(1),i=c=new g(0),s=(a=(t=new g(i)).e=U(f)-p.e-1)%x,t.d[0]=v(10,s<0?x+s:s),null==e)e=a>0?t:l;else{if(!(o=new g(e)).isInt()||o.lt(l))throw Error(y+o);e=o.gt(t)?a>0?t:l:o}for(m=!1,o=new g(k(f)),u=g.precision,g.precision=a=f.length*x*2;d=D(o,t,0,1,1),1!=(r=n.plus(d.times(i))).cmp(e);)n=i,i=r,r=l,l=c.plus(d.times(r)),c=r,r=t,t=o.minus(d.times(r)),o=r;return r=D(e.minus(n),i,0,1,1),c=c.plus(r.times(l)),n=n.plus(r.times(i)),c.s=l.s=p.s,h=D(l,i,a,1).minus(p).abs().cmp(D(c,n,a,1).minus(p).abs())<1?[l,i]:[c,n],g.precision=u,m=!0,h},R.toHexadecimal=R.toHex=function(e,t){return ee(this,16,e,t)},R.toNearest=function(e,t){var n=this,i=n.constructor;if(n=new i(n),null==e){if(!n.d)return n;e=new i(1),t=i.rounding}else{if(e=new i(e),void 0===t?t=i.rounding:O(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(m=!1,n=D(n,e,0,t,1).times(e),m=!0,L(n)):(e.s=n.s,n=e),n},R.toNumber=function(){return+this},R.toOctal=function(e,t){return ee(this,8,e,t)},R.toPower=R.pow=function(e){var t,n,i,r,a,s,o=this,c=o.constructor,l=+(e=new c(e));if(!(o.d&&e.d&&o.d[0]&&e.d[0]))return new c(v(+o,l));if((o=new c(o)).eq(1))return o;if(i=c.precision,a=c.rounding,e.eq(1))return L(o,i,a);if((t=_(e.e/x))>=e.d.length-1&&(n=l<0?-l:l)<=9007199254740991)return r=F(c,o,n,i),e.s<0?new c(1).div(r):L(r,i,a);if((s=o.s)<0){if(t<e.d.length-1)return new c(NaN);if(0==(1&e.d[t])&&(s=1),0==o.e&&1==o.d[0]&&1==o.d.length)return o.s=s,o}return(t=0!=(n=v(+o,l))&&isFinite(n)?new c(n+"").e:_(l*(Math.log("0."+k(o.d))/Math.LN10+o.e+1)))>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(m=!1,c.rounding=o.s=1,n=Math.min(12,(t+"").length),(r=H(e.times(Q(o,i+n)),i)).d&&I((r=L(r,i+5,1)).d,i,a)&&(t=i+10,+k((r=L(H(e.times(Q(o,t+n)),t),t+5,1)).d).slice(i+1,i+15)+1==1e14&&(r=L(r,i+1,0))),r.s=s,m=!0,c.rounding=a,L(r,i,a))},R.toPrecision=function(e,t){var n,i=this,r=i.constructor;return void 0===e?n=q(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(O(e,1,l),void 0===t?t=r.rounding:O(t,0,8),n=q(i=L(new r(i),e,t),e<=i.e||i.e<=r.toExpNeg,e)),i.isNeg()&&!i.isZero()?"-"+n:n},R.toSignificantDigits=R.toSD=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(O(e,1,l),void 0===t?t=n.rounding:O(t,0,8)),L(new n(this),e,t)},R.toString=function(){var e=this,t=e.constructor,n=q(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},R.truncated=R.trunc=function(){return L(new this.constructor(this),this.e+1,1)},R.valueOf=R.toJSON=function(){var e=this,t=e.constructor,n=q(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var D=function(){function e(e,t,n){var i,r=0,a=e.length;for(e=e.slice();a--;)i=e[a]*t+r,e[a]=i%n|0,r=i/n|0;return r&&e.unshift(r),e}function t(e,t,n,i){var r,a;if(n!=i)a=n>i?1:-1;else for(r=a=0;r<n;r++)if(e[r]!=t[r]){a=e[r]>t[r]?1:-1;break}return a}function n(e,t,n,i){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*i+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(i,r,a,o,c,l){var u,d,h,p,m,f,y,g,b,w,v,E,T,N,A,C,M,R,k,O,I=i.constructor,P=i.s==r.s?1:-1,D=i.d,q=r.d;if(!(D&&D[0]&&q&&q[0]))return new I(i.s&&r.s&&(D?!q||D[0]!=q[0]:q)?D&&0==D[0]||!q?0*P:P/0:NaN);for(l?(m=1,d=i.e-r.e):(l=S,m=x,d=_(i.e/m)-_(r.e/m)),k=q.length,M=D.length,w=(b=new I(P)).d=[],h=0;q[h]==(D[h]||0);h++);if(q[h]>(D[h]||0)&&d--,null==a?(N=a=I.precision,o=I.rounding):N=c?a+(i.e-r.e)+1:a,N<0)w.push(1),f=!0;else{if(N=N/m+2|0,h=0,1==k){for(p=0,q=q[0],N++;(h<M||p)&&N--;h++)A=p*l+(D[h]||0),w[h]=A/q|0,p=A%q|0;f=p||h<M}else{for((p=l/(q[0]+1)|0)>1&&(q=e(q,p,l),D=e(D,p,l),k=q.length,M=D.length),C=k,E=(v=D.slice(0,k)).length;E<k;)v[E++]=0;(O=q.slice()).unshift(0),R=q[0],q[1]>=l/2&&++R;do{p=0,(u=t(q,v,k,E))<0?(T=v[0],k!=E&&(T=T*l+(v[1]||0)),(p=T/R|0)>1?(p>=l&&(p=l-1),1==(u=t(y=e(q,p,l),v,g=y.length,E=v.length))&&(p--,n(y,k<g?O:q,g,l))):(0==p&&(u=p=1),y=q.slice()),(g=y.length)<E&&y.unshift(0),n(v,y,E,l),-1==u&&(u=t(q,v,k,E=v.length))<1&&(p++,n(v,k<E?O:q,E,l)),E=v.length):0===u&&(p++,v=[0]),w[h++]=p,u&&v[0]?v[E++]=D[C]||0:(v=[D[C]],E=1)}while((C++<M||void 0!==v[0])&&N--);f=void 0!==v[0]}w[0]||w.shift()}if(1==m)b.e=d,s=f;else{for(h=1,p=w[0];p>=10;p/=10)h++;b.e=h+d*m-1,L(b,c?a+b.e+1:a,o,f)}return b}}();function L(e,t,n,i){var r,a,s,o,c,l,u,d,h,p=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(r=1,o=d[0];o>=10;o/=10)r++;if((a=t-r)<0)a+=x,s=t,c=(u=d[h=0])/v(10,r-s-1)%10|0;else if((h=Math.ceil((a+1)/x))>=(o=d.length)){if(!i)break e;for(;o++<=h;)d.push(0);u=c=0,r=1,s=(a%=x)-x+1}else{for(u=o=d[h],r=1;o>=10;o/=10)r++;c=(s=(a%=x)-x+r)<0?0:u/v(10,r-s-1)%10|0}if(i=i||t<0||void 0!==d[h+1]||(s<0?u:u%v(10,r-s-1)),l=n<4?(c||i)&&(0==n||n==(e.s<0?3:2)):c>5||5==c&&(4==n||i||6==n&&(a>0?s>0?u/v(10,r-s):0:d[h-1])%10&1||n==(e.s<0?8:7)),t<1||!d[0])return d.length=0,l?(t-=e.e+1,d[0]=v(10,(x-t%x)%x),e.e=-t||0):d[0]=e.e=0,e;if(0==a?(d.length=h,o=1,h--):(d.length=h+1,o=v(10,x-a),d[h]=s>0?(u/v(10,r-s)%v(10,s)|0)*o:0),l)for(;;){if(0==h){for(a=1,s=d[0];s>=10;s/=10)a++;for(s=d[0]+=o,o=1;s>=10;s/=10)o++;a!=o&&(e.e++,d[0]==S&&(d[0]=1));break}if(d[h]+=o,d[h]!=S)break;d[h--]=0,o=1}for(a=d.length;0===d[--a];)d.pop()}return m&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function q(e,t,n){if(!e.isFinite())return z(e);var i,r=e.e,a=k(e.d),s=a.length;return t?(n&&(i=n-s)>0?a=a.charAt(0)+"."+a.slice(1)+V(i):s>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(e.e<0?"e":"e+")+e.e):r<0?(a="0."+V(-r-1)+a,n&&(i=n-s)>0&&(a+=V(i))):r>=s?(a+=V(r+1-s),n&&(i=n-r-1)>0&&(a=a+"."+V(i))):((i=r+1)<s&&(a=a.slice(0,i)+"."+a.slice(i)),n&&(i=n-s)>0&&(r+1===s&&(a+="."),a+=V(i))),a}function $(e,t){var n=e[0];for(t*=x;n>=10;n/=10)t++;return t}function j(e,t,n){if(t>C)throw m=!0,n&&(e.precision=n),Error(g);return L(new e(d),t,1,!0)}function B(e,t,n){if(t>M)throw Error(g);return L(new e(h),t,n,!0)}function U(e){var t=e.length-1,n=t*x+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function V(e){for(var t="";e--;)t+="0";return t}function F(e,t,n,i){var r,a=new e(1),s=Math.ceil(i/x+4);for(m=!1;;){if(n%2&&te((a=a.times(t)).d,s)&&(r=!0),0===(n=_(n/2))){n=a.d.length-1,r&&0===a.d[n]&&++a.d[n];break}te((t=t.times(t)).d,s)}return m=!0,a}function K(e){return 1&e.d[e.d.length-1]}function W(e,t,n){for(var i,r=new e(t[0]),a=0;++a<t.length;){if(!(i=new e(t[a])).s){r=i;break}r[n](i)&&(r=i)}return r}function H(e,t){var n,i,r,a,s,o,c,l=0,u=0,d=0,h=e.constructor,p=h.rounding,f=h.precision;if(!e.d||!e.d[0]||e.e>17)return new h(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(m=!1,c=f):c=t,o=new h(.03125);e.e>-2;)e=e.times(o),d+=5;for(c+=i=Math.log(v(2,d))/Math.LN10*2+5|0,n=a=s=new h(1),h.precision=c;;){if(a=L(a.times(e),c,1),n=n.times(++u),k((o=s.plus(D(a,n,c,1))).d).slice(0,c)===k(s.d).slice(0,c)){for(r=d;r--;)s=L(s.times(s),c,1);if(null!=t)return h.precision=f,s;if(!(l<3&&I(s.d,c-i,p,l)))return L(s,h.precision=f,p,m=!0);h.precision=c+=10,n=a=o=new h(1),u=0,l++}s=o}}function Q(e,t){var n,i,r,a,s,o,c,l,u,d,h,p=1,f=e,y=f.d,g=f.constructor,b=g.rounding,w=g.precision;if(f.s<0||!y||!y[0]||!f.e&&1==y[0]&&1==y.length)return new g(y&&!y[0]?-1/0:1!=f.s?NaN:y?0:f);if(null==t?(m=!1,u=w):u=t,g.precision=u+=10,i=(n=k(y)).charAt(0),!(Math.abs(a=f.e)<15e14))return l=j(g,u+2,w).times(a+""),f=Q(new g(i+"."+n.slice(1)),u-10).plus(l),g.precision=w,null==t?L(f,w,b,m=!0):f;for(;i<7&&1!=i||1==i&&n.charAt(1)>3;)i=(n=k((f=f.times(e)).d)).charAt(0),p++;for(a=f.e,i>1?(f=new g("0."+n),a++):f=new g(i+"."+n.slice(1)),d=f,c=s=f=D(f.minus(1),f.plus(1),u,1),h=L(f.times(f),u,1),r=3;;){if(s=L(s.times(h),u,1),k((l=c.plus(D(s,new g(r),u,1))).d).slice(0,u)===k(c.d).slice(0,u)){if(c=c.times(2),0!==a&&(c=c.plus(j(g,u+2,w).times(a+""))),c=D(c,new g(p),u,1),null!=t)return g.precision=w,c;if(!I(c.d,u-10,b,o))return L(c,g.precision=w,b,m=!0);g.precision=u+=10,l=s=f=D(d.minus(1),d.plus(1),u,1),h=L(f.times(f),u,1),r=o=1}c=l,r+=2}}function z(e){return String(e.s*e.s/0)}function G(e,t){var n,i,r;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),i=0;48===t.charCodeAt(i);i++);for(r=t.length;48===t.charCodeAt(r-1);--r);if(t=t.slice(i,r)){if(r-=i,e.e=n=n-i-1,e.d=[],i=(n+1)%x,n<0&&(i+=x),i<r){for(i&&e.d.push(+t.slice(0,i)),r-=x;i<r;)e.d.push(+t.slice(i,i+=x));t=t.slice(i),i=x-t.length}else i-=r;for(;i--;)t+="0";e.d.push(+t),m&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Y(e,t){var n,i,r,s,o,c,l,u,d;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),A.test(t))return G(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(T.test(t))n=16,t=t.toLowerCase();else if(E.test(t))n=2;else{if(!N.test(t))throw Error(y+t);n=8}for((s=t.search(/p/i))>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),o=(s=t.indexOf("."))>=0,i=e.constructor,o&&(s=(c=(t=t.replace(".","")).length)-s,r=F(i,new i(n),s,2*s)),s=d=(u=P(t,n,S)).length-1;0===u[s];--s)u.pop();return s<0?new i(0*e.s):(e.e=$(u,d),e.d=u,m=!1,o&&(e=D(e,r,4*c)),l&&(e=e.times(Math.abs(l)<54?v(2,l):a.pow(2,l))),m=!0,e)}function J(e,t,n,i,r){var a,s,o,c,l=e.precision,u=Math.ceil(l/x);for(m=!1,c=n.times(n),o=new e(i);;){if(s=D(o.times(c),new e(t++*t++),l,1),o=r?i.plus(s):i.minus(s),i=D(s.times(c),new e(t++*t++),l,1),void 0!==(s=o.plus(i)).d[u]){for(a=u;s.d[a]===o.d[a]&&a--;);if(-1==a)break}a=o,o=i,i=s,s=a}return m=!0,s.d.length=u+1,s}function X(e,t){for(var n=e;--t;)n*=e;return n}function Z(e,t){var n,i=t.s<0,r=B(e,e.precision,1),a=r.times(.5);if((t=t.abs()).lte(a))return o=i?4:1,t;if((n=t.divToInt(r)).isZero())o=i?3:2;else{if((t=t.minus(n.times(r))).lte(a))return o=K(n)?i?2:3:i?4:1,t;o=K(n)?i?1:4:i?3:2}return t.minus(r).abs()}function ee(e,t,n,i){var r,a,o,c,d,h,p,m,f,y=e.constructor,g=void 0!==n;if(g?(O(n,1,l),void 0===i?i=y.rounding:O(i,0,8)):(n=y.precision,i=y.rounding),e.isFinite()){for(g?(r=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):r=t,(o=(p=q(e)).indexOf("."))>=0&&(p=p.replace(".",""),(f=new y(1)).e=p.length-o,f.d=P(q(f),10,r),f.e=f.d.length),a=d=(m=P(p,10,r)).length;0==m[--d];)m.pop();if(m[0]){if(o<0?a--:((e=new y(e)).d=m,e.e=a,m=(e=D(e,f,n,i,0,r)).d,a=e.e,h=s),o=m[n],c=r/2,h=h||void 0!==m[n+1],h=i<4?(void 0!==o||h)&&(0===i||i===(e.s<0?3:2)):o>c||o===c&&(4===i||h||6===i&&1&m[n-1]||i===(e.s<0?8:7)),m.length=n,h)for(;++m[--n]>r-1;)m[n]=0,n||(++a,m.unshift(1));for(d=m.length;!m[d-1];--d);for(o=0,p="";o<d;o++)p+=u.charAt(m[o]);if(g){if(d>1)if(16==t||8==t){for(o=16==t?4:3,--d;d%o;d++)p+="0";for(d=(m=P(p,r,t)).length;!m[d-1];--d);for(o=1,p="1.";o<d;o++)p+=u.charAt(m[o])}else p=p.charAt(0)+"."+p.slice(1);p=p+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)p="0"+p;p="0."+p}else if(++a>d)for(a-=d;a--;)p+="0";else a<d&&(p=p.slice(0,a)+"."+p.slice(a))}else p=g?"0p+0":"0";p=(16==t?"0x":2==t?"0b":8==t?"0o":"")+p}else p=z(e);return e.s<0?"-"+p:p}function te(e,t){if(e.length>t)return e.length=t,!0}function ne(e){return new this(e).abs()}function ie(e){return new this(e).acos()}function re(e){return new this(e).acosh()}function ae(e,t){return new this(e).plus(t)}function se(e){return new this(e).asin()}function oe(e){return new this(e).asinh()}function ce(e){return new this(e).atan()}function le(e){return new this(e).atanh()}function ue(e,t){e=new this(e),t=new this(t);var n,i=this.precision,r=this.rounding,a=i+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?B(this,i,r):new this(0)).s=e.s:!e.d||t.isZero()?(n=B(this,a,1).times(.5)).s=e.s:t.s<0?(this.precision=a,this.rounding=1,n=this.atan(D(e,t,a,1)),t=B(this,a,1),this.precision=i,this.rounding=r,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(D(e,t,a,1)):(n=B(this,a,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function de(e){return new this(e).cbrt()}function he(e){return L(e=new this(e),e.e+1,2)}function pe(e,t,n){return new this(e).clamp(t,n)}function me(e){if(!e||"object"!=typeof e)throw Error(f+"Object expected");var t,n,i,r=!0===e.defaults,a=["precision",1,l,"rounding",0,8,"toExpNeg",-c,0,"toExpPos",0,c,"maxE",0,c,"minE",-c,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(n=a[t],r&&(this[n]=p[n]),void 0!==(i=e[n])){if(!(_(i)===i&&i>=a[t+1]&&i<=a[t+2]))throw Error(y+n+": "+i);this[n]=i}if(n="crypto",r&&(this[n]=p[n]),void 0!==(i=e[n])){if(!0!==i&&!1!==i&&0!==i&&1!==i)throw Error(y+n+": "+i);if(i){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(b);this[n]=!0}else this[n]=!1}return this}function fe(e){return new this(e).cos()}function ye(e){return new this(e).cosh()}function ge(e,t){return new this(e).div(t)}function be(e){return new this(e).exp()}function we(e){return L(e=new this(e),e.e+1,3)}function _e(){var e,t,n=new this(0);for(m=!1,e=0;e<arguments.length;)if((t=new this(arguments[e++])).d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return m=!0,new this(1/0);n=t}return m=!0,n.sqrt()}function ve(e){return e instanceof a||e&&e.toStringTag===w||!1}function Ee(e){return new this(e).ln()}function Te(e,t){return new this(e).log(t)}function Ne(e){return new this(e).log(2)}function Ae(e){return new this(e).log(10)}function Se(){return W(this,arguments,"lt")}function xe(){return W(this,arguments,"gt")}function Ce(e,t){return new this(e).mod(t)}function Me(e,t){return new this(e).mul(t)}function Re(e,t){return new this(e).pow(t)}function ke(e){var t,n,i,r,a=0,s=new this(1),o=[];if(void 0===e?e=this.precision:O(e,1,l),i=Math.ceil(e/x),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));a<i;)(r=t[a])>=429e7?t[a]=crypto.getRandomValues(new Uint32Array(1))[0]:o[a++]=r%1e7;else{if(!crypto.randomBytes)throw Error(b);for(t=crypto.randomBytes(i*=4);a<i;)(r=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+((127&t[a+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,a):(o.push(r%1e7),a+=4);a=i/4}else for(;a<i;)o[a++]=1e7*Math.random()|0;for(i=o[--a],e%=x,i&&e&&(r=v(10,x-e),o[a]=(i/r|0)*r);0===o[a];a--)o.pop();if(a<0)n=0,o=[0];else{for(n=-1;0===o[0];n-=x)o.shift();for(i=1,r=o[0];r>=10;r/=10)i++;i<x&&(n-=x-i)}return s.e=n,s.d=o,s}function Oe(e){return L(e=new this(e),e.e+1,this.rounding)}function Ie(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function Pe(e){return new this(e).sin()}function De(e){return new this(e).sinh()}function Le(e){return new this(e).sqrt()}function qe(e,t){return new this(e).sub(t)}function $e(){var e=0,t=arguments,n=new this(t[e]);for(m=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return m=!0,L(n,this.precision,this.rounding)}function je(e){return new this(e).tan()}function Be(e){return new this(e).tanh()}function Ue(e){return L(e=new this(e),e.e+1,1)}a=function e(t){var n,i,r;function a(e){var t,n,i,r=this;if(!(r instanceof a))return new a(e);if(r.constructor=a,ve(e))return r.s=e.s,void(m?!e.d||e.e>a.maxE?(r.e=NaN,r.d=null):e.e<a.minE?(r.e=0,r.d=[0]):(r.e=e.e,r.d=e.d.slice()):(r.e=e.e,r.d=e.d?e.d.slice():e.d));if("number"===(i=typeof e)){if(0===e)return r.s=1/e<0?-1:1,r.e=0,void(r.d=[0]);if(e<0?(e=-e,r.s=-1):r.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;return void(m?t>a.maxE?(r.e=NaN,r.d=null):t<a.minE?(r.e=0,r.d=[0]):(r.e=t,r.d=[e]):(r.e=t,r.d=[e]))}return 0*e!=0?(e||(r.s=NaN),r.e=NaN,void(r.d=null)):G(r,e.toString())}if("string"!==i)throw Error(y+e);return 45===(n=e.charCodeAt(0))?(e=e.slice(1),r.s=-1):(43===n&&(e=e.slice(1)),r.s=1),A.test(e)?G(r,e):Y(r,e)}if(a.prototype=R,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.EUCLID=9,a.config=a.set=me,a.clone=e,a.isDecimal=ve,a.abs=ne,a.acos=ie,a.acosh=re,a.add=ae,a.asin=se,a.asinh=oe,a.atan=ce,a.atanh=le,a.atan2=ue,a.cbrt=de,a.ceil=he,a.clamp=pe,a.cos=fe,a.cosh=ye,a.div=ge,a.exp=be,a.floor=we,a.hypot=_e,a.ln=Ee,a.log=Te,a.log10=Ae,a.log2=Ne,a.max=Se,a.min=xe,a.mod=Ce,a.mul=Me,a.pow=Re,a.random=ke,a.round=Oe,a.sign=Ie,a.sin=Pe,a.sinh=De,a.sqrt=Le,a.sub=qe,a.sum=$e,a.tan=je,a.tanh=Be,a.trunc=Ue,void 0===t&&(t={}),t&&!0!==t.defaults)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<r.length;)t.hasOwnProperty(i=r[n++])||(t[i]=this[i]);return a.config(t),a}(p),a.prototype.constructor=a,a.default=a.Decimal=a,d=new a(d),h=new a(h),void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()},39318:(e,t)=>{t.read=function(e,t,n,i,r){var a,s,o=8*r-i-1,c=(1<<o)-1,l=c>>1,u=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,a=p&(1<<-u)-1,p>>=-u,u+=o;u>0;a=256*a+e[t+d],d+=h,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=i;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===a)a=1-l;else{if(a===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),a-=l}return(p?-1:1)*s*Math.pow(2,a-i)},t.write=function(e,t,n,i,r,a){var s,o,c,l=8*a-r-1,u=(1<<l)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,m=i?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(o=0,s=u):s+d>=1?(o=(t*c-1)*Math.pow(2,r),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&o,p+=m,o/=256,r-=8);for(s=s<<r|o,l+=r;l>0;e[n+p]=255&s,p+=m,s/=256,l-=8);e[n+p-m]|=128*f}},35615:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},85703:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},33103:(e,t,n)=>{var i=n(94715)(n(78942),"DataView");e.exports=i},25098:(e,t,n)=>{var i=n(23305),r=n(39361),a=n(11112),s=n(25276),o=n(57452);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},1386:(e,t,n)=>{var i=n(12393),r=n(62049),a=n(7144),s=n(7452),o=n(13964);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},19770:(e,t,n)=>{var i=n(94715)(n(78942),"Map");e.exports=i},68250:(e,t,n)=>{var i=n(49753),r=n(5681),a=n(80088),s=n(54732),o=n(59068);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},89413:(e,t,n)=>{var i=n(94715)(n(78942),"Promise");e.exports=i},64512:(e,t,n)=>{var i=n(94715)(n(78942),"Set");e.exports=i},65650:(e,t,n)=>{var i=n(78942).Symbol;e.exports=i},19270:(e,t,n)=>{var i=n(94715)(n(78942),"WeakMap");e.exports=i},97034:(e,t,n)=>{var i=n(46285);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},87379:(e,t,n)=>{var i=n(65650),r=n(8870),a=n(29005),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):a(e)}},56027:(e,t,n)=>{var i=n(87379),r=n(80547);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},89624:(e,t,n)=>{var i=n(93655),r=n(64759),a=n(41580),s=n(64066),o=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||r(e))&&(i(e)?h:o).test(s(e))}},70674:(e,t,n)=>{var i=n(87379),r=n(65387),a=n(80547),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&r(e.length)&&!!s[i(e)]}},195:(e,t,n)=>{var i=n(84882),r=n(98121),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},73501:e=>{e.exports=function(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(r);++i<r;)a[i]=e[i+t];return a}},86403:(e,t,n)=>{var i=n(62945),r=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(r,""):e}},49460:e=>{e.exports=function(e){return function(t){return e(t)}}},41950:(e,t,n)=>{var i=n(78942)["__core-js_shared__"];e.exports=i},74967:(e,t,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=i},44700:(e,t,n)=>{var i=n(79067);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},94715:(e,t,n)=>{var i=n(89624),r=n(20155);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},8870:(e,t,n)=>{var i=n(65650),r=Object.prototype,a=r.hasOwnProperty,s=r.toString,o=i?i.toStringTag:void 0;e.exports=function(e){var t=a.call(e,o),n=e[o];try{e[o]=void 0;var i=!0}catch(e){}var r=s.call(e);return i&&(t?e[o]=n:delete e[o]),r}},28486:(e,t,n)=>{var i=n(33103),r=n(19770),a=n(89413),s=n(64512),o=n(19270),c=n(87379),l=n(64066),u="[object Map]",d="[object Promise]",h="[object Set]",p="[object WeakMap]",m="[object DataView]",f=l(i),y=l(r),g=l(a),b=l(s),w=l(o),_=c;(i&&_(new i(new ArrayBuffer(1)))!=m||r&&_(new r)!=u||a&&_(a.resolve())!=d||s&&_(new s)!=h||o&&_(new o)!=p)&&(_=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,i=n?l(n):"";if(i)switch(i){case f:return m;case y:return u;case g:return d;case b:return h;case w:return p}return t}),e.exports=_},20155:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},23305:(e,t,n)=>{var i=n(94497);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},39361:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},11112:(e,t,n)=>{var i=n(94497),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},25276:(e,t,n)=>{var i=n(94497),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},57452:(e,t,n)=>{var i=n(94497);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},69632:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var i=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==i||"symbol"!=i&&t.test(e))&&e>-1&&e%1==0&&e<n}},74535:(e,t,n)=>{var i=n(46285),r=n(36529),a=n(69632),s=n(41580);e.exports=function(e,t,n){if(!s(n))return!1;var o=typeof t;return!!("number"==o?r(n)&&a(t,n.length):"string"==o&&t in n)&&i(n[t],e)}},79067:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},64759:(e,t,n)=>{var i,r=n(41950),a=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!a&&a in e}},84882:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},12393:e=>{e.exports=function(){this.__data__=[],this.size=0}},62049:(e,t,n)=>{var i=n(97034),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0)&&(n==t.length-1?t.pop():r.call(t,n,1),--this.size,!0)}},7144:(e,t,n)=>{var i=n(97034);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},7452:(e,t,n)=>{var i=n(97034);e.exports=function(e){return i(this.__data__,e)>-1}},13964:(e,t,n)=>{var i=n(97034);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},49753:(e,t,n)=>{var i=n(25098),r=n(1386),a=n(19770);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(a||r),string:new i}}},5681:(e,t,n)=>{var i=n(44700);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},80088:(e,t,n)=>{var i=n(44700);e.exports=function(e){return i(this,e).get(e)}},54732:(e,t,n)=>{var i=n(44700);e.exports=function(e){return i(this,e).has(e)}},59068:(e,t,n)=>{var i=n(44700);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},94497:(e,t,n)=>{var i=n(94715)(Object,"create");e.exports=i},98121:(e,t,n)=>{var i=n(3766)(Object.keys,Object);e.exports=i},2306:(e,t,n)=>{e=n.nmd(e);var i=n(74967),r=t&&!t.nodeType&&t,a=r&&e&&!e.nodeType&&e,s=a&&a.exports===r&&i.process,o=function(){try{var e=a&&a.require&&a.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=o},29005:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},3766:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},78942:(e,t,n)=>{var i=n(74967),r="object"==typeof self&&self&&self.Object===Object&&self,a=i||r||Function("return this")();e.exports=a},64066:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},62945:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},88126:(e,t,n)=>{var i=n(73501),r=n(74535),a=n(67642),s=Math.ceil,o=Math.max;e.exports=function(e,t,n){t=(n?r(e,t,n):void 0===t)?1:o(a(t),0);var c=null==e?0:e.length;if(!c||t<1)return[];for(var l=0,u=0,d=Array(s(c/t));l<c;)d[u++]=i(e,l,l+=t);return d}},46285:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},3283:(e,t,n)=>{var i=n(56027),r=n(80547),a=Object.prototype,s=a.hasOwnProperty,o=a.propertyIsEnumerable,c=i(function(){return arguments}())?i:function(e){return r(e)&&s.call(e,"callee")&&!o.call(e,"callee")};e.exports=c},53142:e=>{var t=Array.isArray;e.exports=t},36529:(e,t,n)=>{var i=n(93655),r=n(65387);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},22563:(e,t,n)=>{var i=n(87379),r=n(80547);e.exports=function(e){return!0===e||!1===e||r(e)&&"[object Boolean]"==i(e)}},75853:(e,t,n)=>{e=n.nmd(e);var i=n(78942),r=n(34772),a=t&&!t.nodeType&&t,s=a&&e&&!e.nodeType&&e,o=s&&s.exports===a?i.Buffer:void 0,c=(o?o.isBuffer:void 0)||r;e.exports=c},3514:(e,t,n)=>{var i=n(195),r=n(28486),a=n(3283),s=n(53142),o=n(36529),c=n(75853),l=n(84882),u=n(8666),d=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(o(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||a(e)))return!e.length;var t=r(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(l(e))return!i(e).length;for(var n in e)if(d.call(e,n))return!1;return!0}},93655:(e,t,n)=>{var i=n(87379),r=n(41580);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},65387:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},41580:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},80547:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},51187:(e,t,n)=>{var i=n(87379),r=n(80547);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},8666:(e,t,n)=>{var i=n(70674),r=n(49460),a=n(2306),s=a&&a.isTypedArray,o=s?r(s):i;e.exports=o},69011:(e,t,n)=>{var i=n(68250);function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],a=n.cache;if(a.has(r))return a.get(r);var s=e.apply(this,i);return n.cache=a.set(r,s)||a,s};return n.cache=new(r.Cache||i),n}r.Cache=i,e.exports=r},34772:e=>{e.exports=function(){return!1}},43301:(e,t,n)=>{var i=n(6131),r=1/0;e.exports=function(e){return e?(e=i(e))===r||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},67642:(e,t,n)=>{var i=n(43301);e.exports=function(e){var t=i(e),n=t%1;return t==t?n?t-n:t:0}},6131:(e,t,n)=>{var i=n(86403),r=n(41580),a=n(51187),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=o.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):s.test(e)?NaN:+e}},89150:(e,t,n)=>{var i,r,a,s,o;i=n(30242),r=n(43934).utf8,a=n(85703),s=n(43934).bin,(o=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?s.stringToBytes(e):r.stringToBytes(e):a(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=i.bytesToWords(e),c=8*e.length,l=1732584193,u=-271733879,d=-1732584194,h=271733878,p=0;p<n.length;p++)n[p]=16711935&(n[p]<<8|n[p]>>>24)|4278255360&(n[p]<<24|n[p]>>>8);n[c>>>5]|=128<<c%32,n[14+(c+64>>>9<<4)]=c;var m=o._ff,f=o._gg,y=o._hh,g=o._ii;for(p=0;p<n.length;p+=16){var b=l,w=u,_=d,v=h;l=m(l,u,d,h,n[p+0],7,-680876936),h=m(h,l,u,d,n[p+1],12,-389564586),d=m(d,h,l,u,n[p+2],17,606105819),u=m(u,d,h,l,n[p+3],22,-1044525330),l=m(l,u,d,h,n[p+4],7,-176418897),h=m(h,l,u,d,n[p+5],12,1200080426),d=m(d,h,l,u,n[p+6],17,-1473231341),u=m(u,d,h,l,n[p+7],22,-45705983),l=m(l,u,d,h,n[p+8],7,1770035416),h=m(h,l,u,d,n[p+9],12,-1958414417),d=m(d,h,l,u,n[p+10],17,-42063),u=m(u,d,h,l,n[p+11],22,-1990404162),l=m(l,u,d,h,n[p+12],7,1804603682),h=m(h,l,u,d,n[p+13],12,-40341101),d=m(d,h,l,u,n[p+14],17,-1502002290),l=f(l,u=m(u,d,h,l,n[p+15],22,1236535329),d,h,n[p+1],5,-165796510),h=f(h,l,u,d,n[p+6],9,-1069501632),d=f(d,h,l,u,n[p+11],14,643717713),u=f(u,d,h,l,n[p+0],20,-373897302),l=f(l,u,d,h,n[p+5],5,-701558691),h=f(h,l,u,d,n[p+10],9,38016083),d=f(d,h,l,u,n[p+15],14,-660478335),u=f(u,d,h,l,n[p+4],20,-405537848),l=f(l,u,d,h,n[p+9],5,568446438),h=f(h,l,u,d,n[p+14],9,-1019803690),d=f(d,h,l,u,n[p+3],14,-187363961),u=f(u,d,h,l,n[p+8],20,1163531501),l=f(l,u,d,h,n[p+13],5,-1444681467),h=f(h,l,u,d,n[p+2],9,-51403784),d=f(d,h,l,u,n[p+7],14,1735328473),l=y(l,u=f(u,d,h,l,n[p+12],20,-1926607734),d,h,n[p+5],4,-378558),h=y(h,l,u,d,n[p+8],11,-2022574463),d=y(d,h,l,u,n[p+11],16,1839030562),u=y(u,d,h,l,n[p+14],23,-35309556),l=y(l,u,d,h,n[p+1],4,-1530992060),h=y(h,l,u,d,n[p+4],11,1272893353),d=y(d,h,l,u,n[p+7],16,-155497632),u=y(u,d,h,l,n[p+10],23,-1094730640),l=y(l,u,d,h,n[p+13],4,681279174),h=y(h,l,u,d,n[p+0],11,-358537222),d=y(d,h,l,u,n[p+3],16,-722521979),u=y(u,d,h,l,n[p+6],23,76029189),l=y(l,u,d,h,n[p+9],4,-640364487),h=y(h,l,u,d,n[p+12],11,-421815835),d=y(d,h,l,u,n[p+15],16,530742520),l=g(l,u=y(u,d,h,l,n[p+2],23,-995338651),d,h,n[p+0],6,-198630844),h=g(h,l,u,d,n[p+7],10,1126891415),d=g(d,h,l,u,n[p+14],15,-1416354905),u=g(u,d,h,l,n[p+5],21,-57434055),l=g(l,u,d,h,n[p+12],6,1700485571),h=g(h,l,u,d,n[p+3],10,-1894986606),d=g(d,h,l,u,n[p+10],15,-1051523),u=g(u,d,h,l,n[p+1],21,-2054922799),l=g(l,u,d,h,n[p+8],6,1873313359),h=g(h,l,u,d,n[p+15],10,-30611744),d=g(d,h,l,u,n[p+6],15,-1560198380),u=g(u,d,h,l,n[p+13],21,1309151649),l=g(l,u,d,h,n[p+4],6,-145523070),h=g(h,l,u,d,n[p+11],10,-1120210379),d=g(d,h,l,u,n[p+2],15,718787259),u=g(u,d,h,l,n[p+9],21,-343485551),l=l+b>>>0,u=u+w>>>0,d=d+_>>>0,h=h+v>>>0}return i.endian([l,u,d,h])})._ff=function(e,t,n,i,r,a,s){var o=e+(t&n|~t&i)+(r>>>0)+s;return(o<<a|o>>>32-a)+t},o._gg=function(e,t,n,i,r,a,s){var o=e+(t&i|n&~i)+(r>>>0)+s;return(o<<a|o>>>32-a)+t},o._hh=function(e,t,n,i,r,a,s){var o=e+(t^n^i)+(r>>>0)+s;return(o<<a|o>>>32-a)+t},o._ii=function(e,t,n,i,r,a,s){var o=e+(n^(t|~i))+(r>>>0)+s;return(o<<a|o>>>32-a)+t},o._blocksize=16,o._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=i.wordsToBytes(o(e,t));return t&&t.asBytes?n:t&&t.asString?s.bytesToString(n):i.bytesToHex(n)}},27250:e=>{var t=1e3,n=60*t,i=60*n,r=24*i,a=7*r,s=365.25*r;function o(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}e.exports=function(e,c){c=c||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*a;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*i;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===l&&isFinite(e))return c.long?function(e){var a=Math.abs(e);if(a>=r)return o(e,a,r,"day");if(a>=i)return o(e,a,i,"hour");if(a>=n)return o(e,a,n,"minute");if(a>=t)return o(e,a,t,"second");return e+" ms"}(e):function(e){var a=Math.abs(e);if(a>=r)return Math.round(e/r)+"d";if(a>=i)return Math.round(e/i)+"h";if(a>=n)return Math.round(e/n)+"m";if(a>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},73623:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Perfume:()=>Fe,incrementUjNavigation:()=>$e,markStep:()=>Be,markStepOnce:()=>Ue});var i,r,a={isResourceTiming:!1,isElementTiming:!1,maxTime:3e4,reportOptions:{},enableNavigationTracking:!0},s=window,o=s.console,c=s.navigator,l=s.performance,u=function(){return c.deviceMemory},d=function(){return c.hardwareConcurrency},h="mark.",p=function(){return l&&!!l.getEntriesByType&&!!l.now&&!!l.mark},m="4g",f=!1,y={},g={value:0},b={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},w={value:0},_={value:0},v={},E={isHidden:!1,didChange:!1},T=function(){E.isHidden=!1,document.hidden&&(E.isHidden=document.hidden,E.didChange=!0)},N=function(e,t){try{var n=new PerformanceObserver((function(e){t(e.getEntries())}));return n.observe({type:e,buffered:!0}),n}catch(e){o.warn("Perfume.js:",e)}return null},A=function(){return!!(d()&&d()<=4)||!!(u()&&u()<=4)},S=function(e,t){switch(e){case"slow-2g":case"2g":case"3g":return!0;default:return A()||t}},x=function(e){return parseFloat(e.toFixed(4))},C=function(e){return"number"!=typeof e?null:x(e/Math.pow(1024,2))},M=function(e,t,n,i,r){var o,l=function(){a.analyticsTracker&&(E.isHidden&&!["CLS","INP"].includes(e)||a.analyticsTracker({attribution:i,metricName:e,data:t,navigatorInformation:c?{deviceMemory:u()||0,hardwareConcurrency:d()||0,serviceWorkerStatus:"serviceWorker"in c?c.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:A(),isLowEndExperience:S(m,f)}:{},rating:n,navigationType:r}))};["CLS","INP"].includes(e)?l():(o=l,"requestIdleCallback"in s?s.requestIdleCallback(o,{timeout:3e3}):o())},R=function(e){e.forEach((function(e){if(!("self"!==e.name||e.startTime<g.value)){var t=e.duration-50;t>0&&(w.value+=t,_.value+=t)}}))};!function(e){e.instant="instant",e.quick="quick",e.moderate="moderate",e.slow="slow",e.unavoidable="unavoidable"}(i||(i={}));var k,O,I,P,D,L=((r={})[i.instant]={vitalsThresholds:[100,200],maxOutlierThreshold:1e4},r[i.quick]={vitalsThresholds:[200,500],maxOutlierThreshold:1e4},r[i.moderate]={vitalsThresholds:[500,1e3],maxOutlierThreshold:1e4},r[i.slow]={vitalsThresholds:[1e3,2e3],maxOutlierThreshold:1e4},r[i.unavoidable]={vitalsThresholds:[2e3,5e3],maxOutlierThreshold:2e4},r),q={RT:[100,200],TBT:[200,600],NTBT:[200,600]},$=function(e,t){return q[e]?t<=q[e][0]?"good":t<=q[e][1]?"needsImprovement":"poor":null},j=function(e,t,n){Object.keys(t).forEach((function(e){"number"==typeof t[e]&&(t[e]=x(t[e]))})),M(e,t,null,n||{})},B=function(e){var t=e.attribution,n=e.name,i=e.rating,r=e.value,s=e.navigationType;"FCP"===n&&(g.value=r),["FCP","LCP"].includes(n)&&!v[0]&&(v[0]=N("longtask",R)),"FID"===n&&setTimeout((function(){E.didChange||(B({attribution:t,name:"TBT",rating:$("TBT",w.value),value:w.value,navigationType:s}),j("dataConsumption",b.value))}),1e4);var o=x(r);o<=a.maxTime&&o>=0&&M(n,o,i,t,s)},U=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},V=function(e){if("loading"===document.readyState)return"loading";var t=U();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},F=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},K=function(e,t){var n="";try{for(;e&&9!==e.nodeType;){var i=e,r=i.id?"#"+i.id:F(i)+(i.className&&i.className.length?"."+i.className.replace(/\s+/g,"."):"");if(n.length+r.length>(t||100)-1)return n||r;if(n=n?r+">"+n:r,i.id)break;e=i.parentNode}}catch(e){}return n},W=-1,H=function(){return W},Q=function(e){addEventListener("pageshow",(function(t){t.persisted&&(W=t.timeStamp,e(t))}),!0)},z=function(){var e=U();return e&&e.activationStart||0},G=function(e,t){var n=U(),i="navigate";return H()>=0?i="back-forward-cache":n&&(i=document.prerendering||z()>0?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},Y=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var i=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return i.observe(Object.assign({type:e,buffered:!0},n||{})),i}}catch(e){}},J=function(e,t){var n=function n(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},X=function(e,t,n,i){var r,a;return function(s){t.value>=0&&(s||i)&&((a=t.value-(r||0))||void 0===r)&&(r=t.value,t.delta=a,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},Z=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},ee=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},te=-1,ne=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},ie=function(e){"hidden"===document.visibilityState&&te>-1&&(te="visibilitychange"===e.type?e.timeStamp:0,ae())},re=function(){addEventListener("visibilitychange",ie,!0),addEventListener("prerenderingchange",ie,!0)},ae=function(){removeEventListener("visibilitychange",ie,!0),removeEventListener("prerenderingchange",ie,!0)},se=function(){return te<0&&(te=ne(),re(),Q((function(){setTimeout((function(){te=ne(),re()}),0)}))),{get firstHiddenTime(){return te}}},oe=function(e,t){t=t||{},ee((function(){var n,i=[1800,3e3],r=se(),a=G("FCP"),s=Y("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<r.firstHiddenTime&&(a.value=Math.max(e.startTime-z(),0),a.entries.push(e),n(!0)))}))}));s&&(n=X(e,a,i,t.reportAllChanges),Q((function(r){a=G("FCP"),n=X(e,a,i,t.reportAllChanges),Z((function(){a.value=performance.now()-r.timeStamp,n(!0)}))})))}))},ce={passive:!0,capture:!0},le=new Date,ue=function(e,t){k||(k=t,O=e,I=new Date,pe(removeEventListener),de())},de=function(){if(O>=0&&O<I-le){var e={entryType:"first-input",name:k.type,target:k.target,cancelable:k.cancelable,startTime:k.timeStamp,processingStart:k.timeStamp+O};P.forEach((function(t){t(e)})),P=[]}},he=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){ue(e,t),r()},i=function(){r()},r=function(){removeEventListener("pointerup",n,ce),removeEventListener("pointercancel",i,ce)};addEventListener("pointerup",n,ce),addEventListener("pointercancel",i,ce)}(t,e):ue(t,e)}},pe=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,he,ce)}))},me=0,fe=1/0,ye=0,ge=function(e){e.forEach((function(e){e.interactionId&&(fe=Math.min(fe,e.interactionId),ye=Math.max(ye,e.interactionId),me=ye?(ye-fe)/7+1:0)}))},be=function(){return D?me:performance.interactionCount||0},we=0,_e=function(){return be()-we},ve=[],Ee={},Te=function(e){var t=ve[ve.length-1],n=Ee[e.interactionId];if(n||ve.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var i={id:e.interactionId,latency:e.duration,entries:[e]};Ee[i.id]=i,ve.push(i)}ve.sort((function(e,t){return t.latency-e.latency})),ve.splice(10).forEach((function(e){delete Ee[e.id]}))}},Ne=function(e,t){!function(e,t){t=t||{},ee((function(){var n=[200,500];"interactionCount"in performance||D||(D=Y("event",ge,{type:"event",buffered:!0,durationThreshold:0}));var i,r=G("INP"),a=function(e){e.forEach((function(e){e.interactionId&&Te(e),"first-input"===e.entryType&&!ve.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))&&Te(e)}));var t,n=(t=Math.min(ve.length-1,Math.floor(_e()/50)),ve[t]);n&&n.latency!==r.value&&(r.value=n.latency,r.entries=n.entries,i())},s=Y("event",a,{durationThreshold:t.durationThreshold||40});i=X(e,r,n,t.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),J((function(){a(s.takeRecords()),r.value<0&&_e()>0&&(r.value=0,r.entries=[]),i(!0)})),Q((function(){ve=[],we=be(),r=G("INP"),i=X(e,r,n,t.reportAllChanges)})))}))}((function(t){!function(e){if(e.entries.length){var t=e.entries.sort((function(e,t){return t.duration-e.duration||t.processingEnd-t.processingStart-(e.processingEnd-e.processingStart)}))[0];e.attribution={eventTarget:K(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:V(t.startTime)}}else e.attribution={}}(t),e(t)}),t)},Ae={},Se=function e(t){document.prerendering?ee((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},xe=function(e,t){t=t||{};var n=[800,1800],i=G("TTFB"),r=X(e,i,n,t.reportAllChanges);Se((function(){var a=U();if(a){var s=a.responseStart;if(s<=0||s>performance.now())return;i.value=Math.max(s-z(),0),i.entries=[a],r(!0),Q((function(){i=G("TTFB",0),(r=X(e,i,n,t.reportAllChanges))(!0)}))}}))},Ce=function(e){e.forEach((function(e){e.identifier&&B({attribution:{identifier:e.identifier},name:"ET",rating:null,value:e.startTime})}))},Me=function(e){e.forEach((function(e){if(a.isResourceTiming&&j("resourceTiming",e),e.decodedBodySize&&e.initiatorType){var t=e.decodedBodySize/1e3;b.value[e.initiatorType]+=t,b.value.total+=t}}))},Re=function(){!function(e,t){xe((function(e){!function(e){if(e.entries.length){var t=e.entries[0],n=t.activationStart||0,i=Math.max(t.domainLookupStart-n,0),r=Math.max(t.connectStart-n,0),a=Math.max(t.requestStart-n,0);e.attribution={waitingTime:i,dnsTime:r-i,connectionTime:a-r,requestTime:e.value-a,navigationEntry:t}}else e.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}}(e),function(e){e.value>0&&B(e)}(e)}),t)}(0,a.reportOptions.ttfb),function(e,t){!function(e,t){t=t||{},ee((function(){var n,i=[.1,.25],r=G("CLS"),a=-1,s=0,o=[],c=function(t){a>-1&&e(t)},l=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],i=o[o.length-1];s&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(s+=e.value,o.push(e)):(s=e.value,o=[e]),s>r.value&&(r.value=s,r.entries=o,n())}}))},u=Y("layout-shift",l);u&&(n=X(c,r,i,t.reportAllChanges),oe((function(e){a=e.value,r.value<0&&(r.value=0,n())})),J((function(){l(u.takeRecords()),n(!0)})),Q((function(){s=0,a=-1,r=G("CLS",0),n=X(c,r,i,t.reportAllChanges),Z((function(){return n()}))})))}))}((function(e){!function(e){if(e.entries.length){var t=e.entries.reduce((function(e,t){return e&&e.value>t.value?e:t}));if(t&&t.sources&&t.sources.length){var n=(i=t.sources).find((function(e){return e.node&&1===e.node.nodeType}))||i[0];if(n)return void(e.attribution={largestShiftTarget:K(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:V(t.startTime)})}}var i;e.attribution={}}(e),function(e){B(e)}(e)}),t)}(0,a.reportOptions.cls),function(e,t){oe((function(e){!function(e){if(e.entries.length){var t=U(),n=e.entries[e.entries.length-1];if(t){var i=t.activationStart||0,r=Math.max(0,t.responseStart-i);return void(e.attribution={timeToFirstByte:r,firstByteToFCP:e.value-r,loadState:V(e.entries[0].startTime),navigationEntry:t,fcpEntry:n})}}e.attribution={timeToFirstByte:0,firstByteToFCP:e.value,loadState:V(H())}}(e),function(e){B(e)}(e)}),t)}(0,a.reportOptions.fcp),function(e,t){!function(e,t){t=t||{},ee((function(){var n,i=[100,300],r=se(),a=G("FID"),s=function(e){e.startTime<r.firstHiddenTime&&(a.value=e.processingStart-e.startTime,a.entries.push(e),n(!0))},o=function(e){e.forEach(s)},c=Y("first-input",o);n=X(e,a,i,t.reportAllChanges),c&&J((function(){o(c.takeRecords()),c.disconnect()}),!0),c&&Q((function(){var r;a=G("FID"),n=X(e,a,i,t.reportAllChanges),P=[],O=-1,k=null,pe(addEventListener),r=s,P.push(r),de()}))}))}((function(e){!function(e){var t=e.entries[0];e.attribution={eventTarget:K(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:V(t.startTime)}}(e),function(e){B(e)}(e)}),t)}(0,a.reportOptions.fid),function(e,t){!function(e,t){t=t||{},ee((function(){var n,i=[2500,4e3],r=se(),a=G("LCP"),s=function(e){var t=e[e.length-1];if(t){var i=Math.max(t.startTime-z(),0);i<r.firstHiddenTime&&(a.value=i,a.entries=[t],n())}},o=Y("largest-contentful-paint",s);if(o){n=X(e,a,i,t.reportAllChanges);var c=function(){Ae[a.id]||(s(o.takeRecords()),o.disconnect(),Ae[a.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),J(c,!0),Q((function(r){a=G("LCP"),n=X(e,a,i,t.reportAllChanges),Z((function(){a.value=performance.now()-r.timeStamp,Ae[a.id]=!0,n(!0)}))}))}}))}((function(e){!function(e){if(e.entries.length){var t=U();if(t){var n=t.activationStart||0,i=e.entries[e.entries.length-1],r=i.url&&performance.getEntriesByType("resource").filter((function(e){return e.name===i.url}))[0],a=Math.max(0,t.responseStart-n),s=Math.max(a,r?(r.requestStart||r.startTime)-n:0),o=Math.max(s,r?r.responseEnd-n:0),c=Math.max(o,i?i.startTime-n:0),l={element:K(i.element),timeToFirstByte:a,resourceLoadDelay:s-a,resourceLoadTime:o-s,elementRenderDelay:c-o,navigationEntry:t,lcpEntry:i};return i.url&&(l.url=i.url),r&&(l.lcpResourceEntry=r),void(e.attribution=l)}}e.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:e.value}}(e),function(e){B(e)}(e)}),t)}(0,a.reportOptions.lcp),Ne((function(e){return B(e)}),a.reportOptions.inp),a.isResourceTiming&&N("resource",Me),a.isElementTiming&&N("element",Ce)},ke=function(e){var t="usageDetails"in e?e.usageDetails:{};j("storageEstimate",{quota:C(e.quota),usage:C(e.usage),caches:C(t.caches),indexedDB:C(t.indexedDB),serviceWorker:C(t.serviceWorkerRegistrations)})},Oe={finalMarkToStepsMap:{},startMarkToStepsMap:{},active:{},navigationSteps:{}},Ie=function(e){delete Oe.active[e]},Pe=function(){return Oe.navigationSteps},De=function(e){var t;return null!==(t=Pe()[e])&&void 0!==t?t:{}},Le=function(e,t,n){var i="step."+e,r=l.getEntriesByName(h+t).length>0;if(l.getEntriesByName(h+n).length>0&&a.steps){var s=L[a.steps[e].threshold],o=s.maxOutlierThreshold,c=s.vitalsThresholds;if(r){var u=l.measure(i,h+t,h+n),d=u.duration;if(d<=o){var p=function(e,t){return e<=t[0]?"good":e<=t[1]?"needsImprovement":"poor"}(d,c);d>=0&&(M("userJourneyStep",d,p,{stepName:e},void 0),l.measure("step.".concat(e,"_vitals_").concat(p),{start:u.startTime+u.duration,end:u.startTime+u.duration,detail:{type:"stepVital",duration:d}}))}}}},qe=function(){var e=Pe(),t=Oe.startMarkToStepsMap,n=Object.keys(e).length;if(0===n)return{};var i={},r=n-1,a=De(r);if(Object.keys(a).forEach((function(e){var n,r=null!==(n=t[e])&&void 0!==n?n:[];Object.keys(r).forEach((function(e){i[e]=!0}))})),n>1){var s=De(r-1);Object.keys(s).forEach((function(e){var n,r=null!==(n=t[e])&&void 0!==n?n:[];Object.keys(r).forEach((function(e){i[e]=!0}))}))}return i},$e=function(){var e,t=Object.keys(Oe.navigationSteps).length;Oe.navigationSteps[t]={};var n=qe();null===(e=a.onMarkStep)||void 0===e||e.call(a,"",Object.keys(n))},je=function(e){var t,n,i,r,s,o,c;if(Oe.finalMarkToStepsMap[e]){!function(e){var t=Oe.navigationSteps,n=Oe.finalMarkToStepsMap,i=Object.keys(t).length;if(0!==i){var r=i-1,a=De(r);if(a&&n[e]){var s=n[e];s&&Object.keys(s).forEach((function(e){if(a[e]){var n=De(r)||{};n[e]=!1,t[r]=n}if(i>1){var s=r-1,o=De(s);o[e]&&(o[e]=!1,t[s]=o)}}))}}}(e);var l=Oe.finalMarkToStepsMap[e];Object.keys(l).forEach((function(t){var n=l[t];n.forEach(Ie),Promise.all(n.map((function(n){return function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((i=i.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function(){return function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(i){switch(i.label){case 0:return[4,Le(n,t,e)];case 1:return i.sent(),[2]}}))}))}))).catch((function(){}))}))}else i=e,r=Oe.navigationSteps,s=Object.keys(r).length,(c=De(o=(s>0?s:1)-1)||[])[i]=!0,r[o]=c,function(e){var t,n=null!==(t=Oe.startMarkToStepsMap[e])&&void 0!==t?t:[];Object.keys(n).forEach((function(e){Oe.active[e]||(Oe.active[e]=!0)}))}(e);if(a.enableNavigationTracking){var u=qe();null===(t=a.onMarkStep)||void 0===t||t.call(a,e,Object.keys(u))}else null===(n=a.onMarkStep)||void 0===n||n.call(a,e,Object.keys(Oe.active))},Be=function(e){l.mark(h+e),je(e)},Ue=function(e){0===l.getEntriesByName(h+e).length&&(l.mark(h+e),je(e))},Ve=0,Fe=function(){function e(e){if(void 0===e&&(e={}),this.v="9.0.0-rc.3",a.analyticsTracker=e.analyticsTracker,a.isResourceTiming=!!e.resourceTiming,a.isElementTiming=!!e.elementTiming,a.maxTime=e.maxMeasureTime||a.maxTime,a.reportOptions=e.reportOptions||a.reportOptions,a.steps=e.steps,a.onMarkStep=e.onMarkStep,a.enableNavigationTracking=e.enableNavigationTracking,p()){"PerformanceObserver"in s&&Re(),void 0!==document.hidden&&document.addEventListener("visibilitychange",T);var t=function(){if(!p())return{};var e=l.getEntriesByType("navigation")[0];if(!e)return{};var t=e.responseStart,n=e.responseEnd;return{fetchTime:n-e.fetchStart,workerTime:e.workerStart>0?n-e.workerStart:0,totalTime:n-e.requestStart,downloadTime:n-t,timeToFirstByte:t-e.requestStart,headerSize:e.transferSize-e.encodedBodySize||0,dnsLookupTime:e.domainLookupEnd-e.domainLookupStart,redirectTime:e.redirectEnd-e.redirectStart}}();j("navigationTiming",t),t.redirectTime&&B({attribution:{},name:"RT",rating:$("RT",t.redirectTime),value:t.redirectTime}),j("networkInformation",function(){if("connection"in c){var e=c.connection;return"object"!=typeof e?{}:(m=e.effectiveType,f=!!e.saveData,{downlink:e.downlink,effectiveType:e.effectiveType,rtt:e.rtt,saveData:!!e.saveData})}return{}}()),c&&c.storage&&"function"==typeof c.storage.estimate&&c.storage.estimate().then(ke),a.steps&&a.steps&&(Oe.startMarkToStepsMap={},Oe.finalMarkToStepsMap={},Oe.active={},Oe.navigationSteps={},Object.entries(a.steps).forEach((function(e){var t,n,i=e[0],r=e[1].marks,a=r[0],s=r[1],o=null!==(n=Oe.startMarkToStepsMap[a])&&void 0!==n?n:{};if(o[i]=!0,Oe.startMarkToStepsMap[a]=o,Oe.finalMarkToStepsMap[s]){var c=Oe.finalMarkToStepsMap[s][a]||[];c.push(i),Oe.finalMarkToStepsMap[s][a]=c}else Oe.finalMarkToStepsMap[s]=((t={})[a]=[i],t)})))}}return e.prototype.start=function(e){p()&&!y[e]&&(y[e]=!0,l.mark("mark_".concat(e,"_start")))},e.prototype.end=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!0),p()&&y[e]){l.mark("mark_".concat(e,"_end")),delete y[e];var i=function(e){l.measure(e,"mark_".concat(e,"_start"),"mark_".concat(e,"_end"));var t=l.getEntriesByName(e).pop();return t&&"measure"===t.entryType?t.duration:-1}(e);n&&j(e,x(i),t)}},e.prototype.endPaint=function(e,t){var n=this;setTimeout((function(){n.end(e,t)}))},e.prototype.clear=function(e){delete y[e],l.clearMarks&&(l.clearMarks("mark_".concat(e,"_start")),l.clearMarks("mark_".concat(e,"_end")))},e.prototype.markNTBT=function(){var e=this;this.start("ntbt"),_.value=0,clearTimeout(Ve),Ve=setTimeout((function(){e.end("ntbt",{},!1),B({attribution:{},name:"NTBT",rating:$("NTBT",_.value),value:_.value}),_.value=0}),2e3)},e}()},39907:e=>{var t,n,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o,c=[],l=!1,u=-1;function d(){l&&o&&(l=!1,o.length?c=o.concat(c):u=-1,c.length&&h())}function h(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(o=c,c=[];++u<t;)o&&o[u].run();u=-1,t=c.length}o=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},1359:(e,t)=>{"use strict";var n=Object.prototype.hasOwnProperty;function i(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function r(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,a,s=[];for(a in"string"!=typeof t&&(t="?"),e)if(n.call(e,a)){if((i=e[a])||null!=i&&!isNaN(i)||(i=""),a=r(a),i=r(i),null===a||null===i)continue;s.push(a+"="+i)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var a=i(t[1]),s=i(t[2]);null===a||null===s||a in r||(r[a]=s)}return r}},12310:(e,t,n)=>{"use strict";var i=n(14041);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(r(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},o=Symbol.for("react.portal");var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.unstable_batchedUpdates=function(e,t){return e(t)}},43144:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(12310)},61197:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element");function i(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var a in i={},t)"key"!==a&&(i[a]=t[a]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}Symbol.for("react.fragment")},42062:(e,t,n)=>{"use strict";var i=n(39907),r=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),f=Symbol.iterator;var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,b={};function w(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}function _(){}function v(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}w.prototype.isReactComponent={},w.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},w.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=w.prototype;var E=v.prototype=new _;E.constructor=v,g(E,w.prototype),E.isPureReactComponent=!0;var T=Array.isArray,N={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function S(e,t,n,i,a,s){return n=s.ref,{$$typeof:r,type:e,key:t,ref:void 0!==n?n:null,props:s}}function x(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,i={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,(function(e){return i[e]}))):t.toString(36);var n,i}function R(){}function k(e,t,n,i,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c,l,u=!1;if(null===e)u=!0;else switch(o){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case r:case a:u=!0;break;case m:return k((u=e._init)(e._payload),t,n,i,s)}}if(u)return s=s(e),u=""===i?"."+M(e,0):i,T(s)?(n="",null!=u&&(n=u.replace(C,"$&/")+"/"),k(s,t,n,"",(function(e){return e}))):null!=s&&(x(s)&&(c=s,l=n+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+u,s=S(c.type,l,void 0,0,0,c.props)),t.push(s)),1;u=0;var d,h=""===i?".":i+":";if(T(e))for(var p=0;p<e.length;p++)u+=k(i=e[p],t,n,o=h+M(i,p),s);else if("function"==typeof(p=null===(d=e)||"object"!=typeof d?null:"function"==typeof(d=f&&d[f]||d["@@iterator"])?d:null))for(e=p.call(e),p=0;!(i=e.next()).done;)u+=k(i=i.value,t,n,o=h+M(i,p++),s);else if("object"===o){if("function"==typeof e.then)return k(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(R,R):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,n,i,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function O(e,t,n){if(null==e)return e;var i=[],r=0;return k(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof i&&"function"==typeof i.emit)return void i.emit("uncaughtException",e);console.error(e)};function D(){}t.Children={map:O,forEach:function(e,t,n){O(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return O(e,(function(){t++})),t},toArray:function(e){return O(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=w,t.Fragment=s,t.Profiler=c,t.PureComponent=v,t.StrictMode=o,t.Suspense=h,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var i=g({},e.props),r=e.key;if(null!=t)for(a in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!A.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(i[a]=t[a]);var a=arguments.length-2;if(1===a)i.children=n;else if(1<a){for(var s=Array(a),o=0;o<a;o++)s[o]=arguments[o+2];i.children=s}return S(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:l,_context:e},e},t.createElement=function(e,t,n){var i,r={},a=null;if(null!=t)for(i in void 0!==t.key&&(a=""+t.key),t)A.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var o=Array(s),c=0;c<s;c++)o[c]=arguments[c+2];r.children=o}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===r[i]&&(r[i]=s[i]);return S(e,a,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:d,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.T,n={};N.T=n;try{var i=e(),r=N.S;null!==r&&r(n,i),"object"==typeof i&&null!==i&&"function"==typeof i.then&&i.then(D,P)}catch(e){P(e)}finally{N.T=t}},t.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},t.use=function(e){return N.H.use(e)},t.useActionState=function(e,t,n){return N.H.useActionState(e,t,n)},t.useCallback=function(e,t){return N.H.useCallback(e,t)},t.useContext=function(e){return N.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return N.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return N.H.useEffect(e,t)},t.useId=function(){return N.H.useId()},t.useImperativeHandle=function(e,t,n){return N.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.H.useMemo(e,t)},t.useOptimistic=function(e,t){return N.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return N.H.useReducer(e,t,n)},t.useRef=function(e){return N.H.useRef(e)},t.useState=function(e){return N.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.H.useTransition()},t.version="19.0.0"},14041:(e,t,n)=>{"use strict";e.exports=n(42062)},31085:(e,t,n)=>{"use strict";n(61197)},52326:(e,t,n)=>{var i,r=n(39907);!function(e){!function(t){var i="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),a=s(e);function s(e,t){return function(n,i){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:i}),t&&t(n,i)}}void 0===i.Reflect?i.Reflect=e:a=s(i.Reflect,a),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,c=!s&&!o,l={create:s?function(){return re(Object.create(null))}:o?function(){return re({__proto__:null})}:function(){return re({})},has:c?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:c?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),d="object"==typeof r&&"true"==="MISSING_ENV_VAR".REFLECT_METADATA_USE_MAP_POLYFILL,h=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,p=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?ne():Set,m=new(d||"function"!=typeof WeakMap?ie():WeakMap);function f(e,t,n,i){if(L(n)){if(!W(e))throw new TypeError;if(!Q(t))throw new TypeError;return A(e,t)}if(!W(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(i)&&!L(i)&&!q(i))throw new TypeError;return q(i)&&(i=void 0),S(e,t,n=K(n),i)}function y(e,t){function n(n,i){if(!j(n))throw new TypeError;if(!L(i)&&!z(i))throw new TypeError;O(e,t,n,i)}return n}function g(e,t,n,i){if(!j(n))throw new TypeError;return L(i)||(i=K(i)),O(e,t,n,i)}function b(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=K(n)),C(e,t,n)}function w(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=K(n)),M(e,t,n)}function _(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=K(n)),R(e,t,n)}function v(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=K(n)),k(e,t,n)}function E(e,t){if(!j(e))throw new TypeError;return L(t)||(t=K(t)),I(e,t)}function T(e,t){if(!j(e))throw new TypeError;return L(t)||(t=K(t)),P(e,t)}function N(e,t,n){if(!j(t))throw new TypeError;L(n)||(n=K(n));var i=x(t,n,!1);if(L(i))return!1;if(!i.delete(e))return!1;if(i.size>0)return!0;var r=m.get(t);return r.delete(n),r.size>0||m.delete(t),!0}function A(e,t){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t);if(!L(i)&&!q(i)){if(!Q(i))throw new TypeError;t=i}}return t}function S(e,t,n,i){for(var r=e.length-1;r>=0;--r){var a=(0,e[r])(t,n,i);if(!L(a)&&!q(a)){if(!j(a))throw new TypeError;i=a}}return i}function x(e,t,n){var i=m.get(e);if(L(i)){if(!n)return;i=new h,m.set(e,i)}var r=i.get(t);if(L(r)){if(!n)return;r=new h,i.set(t,r)}return r}function C(e,t,n){if(M(e,t,n))return!0;var i=ee(t);return!q(i)&&C(e,i,n)}function M(e,t,n){var i=x(t,n,!1);return!L(i)&&V(i.has(e))}function R(e,t,n){if(M(e,t,n))return k(e,t,n);var i=ee(t);return q(i)?void 0:R(e,i,n)}function k(e,t,n){var i=x(t,n,!1);if(!L(i))return i.get(e)}function O(e,t,n,i){x(n,i,!0).set(e,t)}function I(e,t){var n=P(e,t),i=ee(e);if(null===i)return n;var r=I(i,t);if(r.length<=0)return n;if(n.length<=0)return r;for(var a=new p,s=[],o=0,c=n;o<c.length;o++){var l=c[o];a.has(l)||(a.add(l),s.push(l))}for(var u=0,d=r;u<d.length;u++){l=d[u];a.has(l)||(a.add(l),s.push(l))}return s}function P(e,t){var n=[],i=x(e,t,!1);if(L(i))return n;for(var r=Y(i.keys()),a=0;;){var s=X(r);if(!s)return n.length=a,n;var o=J(s);try{n[a]=o}catch(e){try{Z(r)}finally{throw e}}a++}}function D(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function L(e){return void 0===e}function q(e){return null===e}function $(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function B(e,t){switch(D(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=G(e,i);if(void 0!==r){var a=r.call(e,n);if(j(a))throw new TypeError;return a}return U(e,"default"===n?"number":n)}function U(e,t){if("string"===t){var n=e.toString;if(H(n))if(!j(r=n.call(e)))return r;if(H(i=e.valueOf))if(!j(r=i.call(e)))return r}else{var i;if(H(i=e.valueOf))if(!j(r=i.call(e)))return r;var r,a=e.toString;if(H(a))if(!j(r=a.call(e)))return r}throw new TypeError}function V(e){return!!e}function F(e){return""+e}function K(e){var t=B(e,3);return $(t)?t:F(t)}function W(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function H(e){return"function"==typeof e}function Q(e){return"function"==typeof e}function z(e){switch(D(e)){case 3:case 4:return!0;default:return!1}}function G(e,t){var n=e[t];if(null!=n){if(!H(n))throw new TypeError;return n}}function Y(e){var t=G(e,a);if(!H(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function J(e){return e.value}function X(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return t;var r=i.constructor;return"function"!=typeof r||r===e?t:r}function te(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,i)},t.prototype.values=function(){return new n(this._keys,this._values,r)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function r(e,t){return t}function s(e,t){return[e,t]}}function ne(){return function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}()}function ie(){var e=16,n=l.create(),i=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+c()}while(l.has(n,e));return n[e]=!0,e}function a(e,n){if(!t.call(e,i)){if(!n)return;Object.defineProperty(e,i,{value:l.create()})}return e[i]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function c(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<e;++i){var r=t[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}function re(e){return e.__=void 0,delete e.__,e}e("decorate",f),e("metadata",y),e("defineMetadata",g),e("hasMetadata",b),e("hasOwnMetadata",w),e("getMetadata",_),e("getOwnMetadata",v),e("getMetadataKeys",E),e("getOwnMetadataKeys",T),e("deleteMetadata",N)}(a)}()}(i||(i={}))},33062:e=>{"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},25636:(e,t,n)=>{var i=n(1048),r=i.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(a(i,t),t.Buffer=s),s.prototype=Object.create(r.prototype),a(r,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},1229:(e,t,n)=>{var i=n(25636).Buffer;function r(e,t){this._block=i.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}r.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=i.from(e,t));for(var n=this._block,r=this._blockSize,a=e.length,s=this._len,o=0;o<a;){for(var c=s%r,l=Math.min(a-o,r-c),u=0;u<l;u++)n[c+u]=e[o+u];o+=l,(s+=l)%r==0&&this._update(n)}return this._len+=a,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var i=(4294967295&n)>>>0,r=(n-i)/4294967296;this._block.writeUInt32BE(r,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},13229:(e,t,n)=>{var i=e.exports=function(e){e=e.toLowerCase();var t=i[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};i.sha=n(93675),i.sha1=n(28980),i.sha224=n(20947),i.sha256=n(52826),i.sha384=n(19922),i.sha512=n(13699)},93675:(e,t,n)=>{var i=n(35615),r=n(1229),a=n(25636).Buffer,s=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,r.call(this,64,56)}function l(e){return e<<30|e>>>2}function u(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,d=0;d<16;++d)n[d]=e.readInt32BE(4*d);for(;d<80;++d)n[d]=n[d-3]^n[d-8]^n[d-14]^n[d-16];for(var h=0;h<80;++h){var p=~~(h/20),m=0|((t=i)<<5|t>>>27)+u(p,r,a,o)+c+n[h]+s[p];c=o,o=a,a=l(r),r=i,i=m}this._a=i+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},28980:(e,t,n)=>{var i=n(35615),r=n(1229),a=n(25636).Buffer,s=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,r.call(this,64,56)}function l(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function d(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=(t=n[h-3]^n[h-8]^n[h-14]^n[h-16])<<1|t>>>31;for(var p=0;p<80;++p){var m=~~(p/20),f=l(i)+d(m,r,a,o)+c+n[p]+s[m]|0;c=o,o=a,a=u(r),r=i,i=f}this._a=i+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},20947:(e,t,n)=>{var i=n(35615),r=n(52826),a=n(1229),s=n(25636).Buffer,o=new Array(64);function c(){this.init(),this._w=o,a.call(this,64,56)}i(c,r),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},52826:(e,t,n)=>{var i=n(35615),r=n(1229),a=n(25636).Buffer,s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function c(){this.init(),this._w=o,r.call(this,64,56)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function d(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function h(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function p(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}i(c,r),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,m=0|this._f,f=0|this._g,y=0|this._h,g=0;g<16;++g)n[g]=e.readInt32BE(4*g);for(;g<64;++g)n[g]=0|(((t=n[g-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[g-7]+p(n[g-15])+n[g-16];for(var b=0;b<64;++b){var w=y+h(c)+l(c,m,f)+s[b]+n[b]|0,_=d(i)+u(i,r,a)|0;y=f,f=m,m=c,c=o+w|0,o=a,a=r,r=i,i=w+_|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0,this._f=m+this._f|0,this._g=f+this._g|0,this._h=y+this._h|0},c.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},19922:(e,t,n)=>{var i=n(35615),r=n(13699),a=n(1229),s=n(25636).Buffer,o=new Array(160);function c(){this.init(),this._w=o,a.call(this,128,112)}i(c,r),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(48);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},13699:(e,t,n)=>{var i=n(35615),r=n(1229),a=n(25636).Buffer,s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function c(){this.init(),this._w=o,r.call(this,128,112)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function d(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function h(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function m(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function f(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function g(e,t){return e>>>0<t>>>0?1:0}i(c,r),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._ah,i=0|this._bh,r=0|this._ch,a=0|this._dh,o=0|this._eh,c=0|this._fh,b=0|this._gh,w=0|this._hh,_=0|this._al,v=0|this._bl,E=0|this._cl,T=0|this._dl,N=0|this._el,A=0|this._fl,S=0|this._gl,x=0|this._hl,C=0;C<32;C+=2)t[C]=e.readInt32BE(4*C),t[C+1]=e.readInt32BE(4*C+4);for(;C<160;C+=2){var M=t[C-30],R=t[C-30+1],k=p(M,R),O=m(R,M),I=f(M=t[C-4],R=t[C-4+1]),P=y(R,M),D=t[C-14],L=t[C-14+1],q=t[C-32],$=t[C-32+1],j=O+L|0,B=k+D+g(j,O)|0;B=(B=B+I+g(j=j+P|0,P)|0)+q+g(j=j+$|0,$)|0,t[C]=B,t[C+1]=j}for(var U=0;U<160;U+=2){B=t[U],j=t[U+1];var V=u(n,i,r),F=u(_,v,E),K=d(n,_),W=d(_,n),H=h(o,N),Q=h(N,o),z=s[U],G=s[U+1],Y=l(o,c,b),J=l(N,A,S),X=x+Q|0,Z=w+H+g(X,x)|0;Z=(Z=(Z=Z+Y+g(X=X+J|0,J)|0)+z+g(X=X+G|0,G)|0)+B+g(X=X+j|0,j)|0;var ee=W+F|0,te=K+V+g(ee,W)|0;w=b,x=S,b=c,S=A,c=o,A=N,o=a+Z+g(N=T+X|0,T)|0,a=r,T=E,r=i,E=v,i=n,v=_,n=Z+te+g(_=X+ee|0,X)|0}this._al=this._al+_|0,this._bl=this._bl+v|0,this._cl=this._cl+E|0,this._dl=this._dl+T|0,this._el=this._el+N|0,this._fl=this._fl+A|0,this._gl=this._gl+S|0,this._hl=this._hl+x|0,this._ah=this._ah+n+g(this._al,_)|0,this._bh=this._bh+i+g(this._bl,v)|0,this._ch=this._ch+r+g(this._cl,E)|0,this._dh=this._dh+a+g(this._dl,T)|0,this._eh=this._eh+o+g(this._el,N)|0,this._fh=this._fh+c+g(this._fl,A)|0,this._gh=this._gh+b+g(this._gl,S)|0,this._hh=this._hh+w+g(this._hl,x)|0},c.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},55452:(e,t,n)=>{"use strict";n.d(t,{$s:()=>f,N8:()=>b,Np:()=>y});n(14041);var i=n(34767);let r=()=>{},a=()=>{},s=()=>{},o={},c="superapp",l={},u={};const d={},h={};let p={};function m(e){return{...e,...o,...l,...u,...h,...d,...p,currentAppMode:c}}function f(e,t,n,r=!1){w(e,t,r),a(e);const s=m(t);return(0,i.$s)(e,s,n)}function y(e,t,n,r=!1){const{action:a,componentType:s}=t,o=m(t),c={isDiagnostic:!0,action:a??i.X2.measurement,componentType:s??i.I5.unknown};return w(e,c,r),(0,i.$s)(e,{...o,...c},n)}const g={};function b(e){const t={...e,tags:{...e.tags,...g}};return s(t),(0,i.N8)(t)}function w(e,t,n=!1){const{loggingId:i,...a}=t;r(e,{isNoisy:n,properties:a,globalProperties:m({})})}},18047:function(e,t,n){var i;!function(r,a){"use strict";var s="function",o="undefined",c="object",l="string",u="major",d="model",h="name",p="type",m="vendor",f="version",y="architecture",g="console",b="mobile",w="tablet",_="smarttv",v="wearable",E="embedded",T="Amazon",N="Apple",A="ASUS",S="BlackBerry",x="Browser",C="Chrome",M="Firefox",R="Google",k="Huawei",O="LG",I="Microsoft",P="Motorola",D="Opera",L="Samsung",q="Sharp",$="Sony",j="Xiaomi",B="Zebra",U="Facebook",V="Chromium OS",F="Mac OS",K=" Browser",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},H=function(e,t){return typeof e===l&&-1!==Q(t).indexOf(Q(e))},Q=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===l)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},G=function(e,t){for(var n,i,r,o,l,u,d=0;d<t.length&&!l;){var h=t[d],p=t[d+1];for(n=i=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(r=0;r<p.length;r++)u=l[++i],typeof(o=p[r])===c&&o.length>0?2===o.length?typeof o[1]==s?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==s||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):a:this[o[0]]=u?o[1].call(this,u,o[2]):a:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):a):this[o]=u||a;d+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(H(t[n][i],e))return"?"===n?a:n}else if(H(t[n],e))return"?"===n?a:n;return t.hasOwnProperty("*")?t["*"]:e},J={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,f],[/opios[\/ ]+([\w\.]+)/i],[f,[h,D+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[h,D+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[h,D]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[h,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,f],[/quark(?:pc)?\/([-\w\.]+)/i],[f,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[f,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[h,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[h,"Smart Lenovo "+x]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+x],f],[/\bfocus\/([\w\.]+)/i],[f,[h,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[h,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[h,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[h,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[f,[h,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360"+K]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],f],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+K],f],[/samsungbrowser\/([\w\.]+)/i],[f,[h,L+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],f],[/metasr[\/ ]?([\d\.]+)/i],[f,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[h,f],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,U],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[h,C+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,C+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[h,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[f,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],f],[/(wolvic)\/([\w\.]+)/i],[h,f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[h,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[f,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,Q]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,"",Q]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,Q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,L],[p,w]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,L],[p,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,N],[p,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,N],[p,w]],[/(macintosh);/i],[d,[m,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,q],[p,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,k],[p,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,k],[p,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[m,j],[p,b]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,j],[p,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[p,b]],[/\b(opd2\d{3}a?) bui/i],[d,[m,"OPPO"],[p,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[p,b]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[p,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,P],[p,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,P],[p,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,O],[p,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,O],[p,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[p,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[p,b]],[/(pixel c)\b/i],[d,[m,R],[p,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,R],[p,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,$],[p,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,$],[p,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[p,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,T],[p,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,T],[p,b]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[p,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,S],[p,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,A],[p,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,A],[p,b]],[/(nexus 9)/i],[d,[m,"HTC"],[p,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[p,b]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[m,"TCL"],[p,w]],[/(itel) ((\w+))/i],[[m,Q],d,[p,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[p,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[p,b]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[m,"Ulefone"],[p,b]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[m,"Nothing"],[p,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[p,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[p,w]],[/(surface duo)/i],[d,[m,I],[p,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[p,b]],[/(u304aa)/i],[d,[m,"AT&T"],[p,b]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[p,b]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[p,w]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[p,w]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[p,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[p,w]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[p,w]],[/\b(k88) b/i],[d,[m,"ZTE"],[p,w]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[p,b]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[p,b]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[p,w]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[p,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[p,w]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[p,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[p,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[p,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[p,b]],[/\b(ph-1) /i],[d,[m,"Essential"],[p,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[p,w]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[p,w]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[p,w]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[p,w]],[/(sprint) (\w+)/i],[m,d,[p,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,I],[p,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,B],[p,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,B],[p,b]],[/smart-tv.+(samsung)/i],[m,[p,_]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,L],[p,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,O],[p,_]],[/(apple) ?tv/i],[m,[d,N+" TV"],[p,_]],[/crkey/i],[[d,C+"cast"],[m,R],[p,_]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,T],[p,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,q],[p,_]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,$],[p,_]],[/(mitv-\w{5}) bui/i],[d,[m,j],[p,_]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[p,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,z],[d,z],[p,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[p,g]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[p,g]],[/(playstation [345portablevi]+)/i],[d,[m,$],[p,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,I],[p,g]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[m,L],[p,v]],[/((pebble))app/i],[m,d,[p,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,N],[p,v]],[/droid.+; (glass) \d/i],[d,[m,R],[p,v]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,B],[p,v]],[/(quest( \d| pro)?)/i],[d,[m,U],[p,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[p,E]],[/(aeobc)\b/i],[d,[m,T],[p,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[p,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[p,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,b]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,f],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[f,Y,J]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,Y,J],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,F],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,f],[/\(bb(10);/i],[f,[h,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[h,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[h,C+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,V],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,f],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,f]]},Z=function(e,t){if(typeof e===c&&(t=e,e=a),!(this instanceof Z))return new Z(e,t).getResult();var n=typeof r!==o&&r.navigator?r.navigator:a,i=e||(n&&n.userAgent?n.userAgent:""),g=n&&n.userAgentData?n.userAgentData:a,_=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(X,t):X,v=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t[h]=a,t[f]=a,G.call(t,i,_.browser),t[u]=typeof(e=t[f])===l?e.replace(/[^\d\.]/g,"").split(".")[0]:a,v&&n&&n.brave&&typeof n.brave.isBrave==s&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[y]=a,G.call(e,i,_.cpu),e},this.getDevice=function(){var e={};return e[m]=a,e[d]=a,e[p]=a,G.call(e,i,_.device),v&&!e[p]&&g&&g.mobile&&(e[p]=b),v&&"Macintosh"==e[d]&&n&&typeof n.standalone!==o&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[d]="iPad",e[p]=w),e},this.getEngine=function(){var e={};return e[h]=a,e[f]=a,G.call(e,i,_.engine),e},this.getOS=function(){var e={};return e[h]=a,e[f]=a,G.call(e,i,_.os),v&&!e[h]&&g&&g.platform&&"Unknown"!=g.platform&&(e[h]=g.platform.replace(/chrome os/i,V).replace(/macos/i,F)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===l&&e.length>500?z(e,500):e,this},this.setUA(i),this};Z.VERSION="1.0.39",Z.BROWSER=W([h,f,u]),Z.CPU=W([y]),Z.DEVICE=W([d,m,p,g,b,_,w,v,E]),Z.ENGINE=Z.OS=W([h,f]),typeof t!==o?(e.exports&&(t=e.exports=Z),t.UAParser=Z):n.amdO?(i=function(){return Z}.call(t,n,t,e))===a||(e.exports=i):typeof r!==o&&(r.UAParser=Z);var ee=typeof r!==o&&(r.jQuery||r.Zepto);if(ee&&!ee.ua){var te=new Z;ee.ua=te.getResult(),ee.ua.get=function(){return te.getUA()},ee.ua.set=function(e){te.setUA(e);var t=te.getResult();for(var n in t)ee.ua[n]=t[n]}}}("object"==typeof window?window:this)},52225:(e,t,n)=>{"use strict";var i=n(33062),r=n(1359),a=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,c=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,u=/^[a-zA-Z]:/;function d(e){return(e||"").toString().replace(a,"")}var h=[["#","hash"],["?","query"],function(e,t){return f(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function m(e){var t,i=("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{}).location||{},r={},a=typeof(e=e||i);if("blob:"===e.protocol)r=new g(unescape(e.pathname),{});else if("string"===a)for(t in r=new g(e,{}),p)delete r[t];else if("object"===a){for(t in e)t in p||(r[t]=e[t]);void 0===r.slashes&&(r.slashes=o.test(e.href))}return r}function f(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function y(e,t){e=(e=d(e)).replace(s,""),t=t||{};var n,i=l.exec(e),r=i[1]?i[1].toLowerCase():"",a=!!i[2],o=!!i[3],c=0;return a?o?(n=i[2]+i[3]+i[4],c=i[2].length+i[3].length):(n=i[2]+i[4],c=i[2].length):o?(n=i[3]+i[4],c=i[3].length):n=i[4],"file:"===r?c>=2&&(n=n.slice(2)):f(r)?n=i[4]:r?a&&(n=n.slice(2)):c>=2&&f(t.protocol)&&(n=i[4]),{protocol:r,slashes:a||f(r),slashesCount:c,rest:n}}function g(e,t,n){if(e=(e=d(e)).replace(s,""),!(this instanceof g))return new g(e,t,n);var a,o,c,l,p,b,w=h.slice(),_=typeof t,v=this,E=0;for("object"!==_&&"string"!==_&&(n=t,t=null),n&&"function"!=typeof n&&(n=r.parse),a=!(o=y(e||"",t=m(t))).protocol&&!o.slashes,v.slashes=o.slashes||a&&t.slashes,v.protocol=o.protocol||t.protocol||"",e=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||u.test(e))||!o.slashes&&(o.protocol||o.slashesCount<2||!f(v.protocol)))&&(w[3]=[/(.*)/,"pathname"]);E<w.length;E++)"function"!=typeof(l=w[E])?(c=l[0],b=l[1],c!=c?v[b]=e:"string"==typeof c?~(p="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof l[2]?(v[b]=e.slice(0,p),e=e.slice(p+l[2])):(v[b]=e.slice(p),e=e.slice(0,p))):(p=c.exec(e))&&(v[b]=p[1],e=e.slice(0,p.index)),v[b]=v[b]||a&&l[3]&&t[b]||"",l[4]&&(v[b]=v[b].toLowerCase())):e=l(e,v);n&&(v.query=n(v.query)),a&&t.slashes&&"/"!==v.pathname.charAt(0)&&(""!==v.pathname||""!==t.pathname)&&(v.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),i=n.length,r=n[i-1],a=!1,s=0;i--;)"."===n[i]?n.splice(i,1):".."===n[i]?(n.splice(i,1),s++):s&&(0===i&&(a=!0),n.splice(i,1),s--);return a&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}(v.pathname,t.pathname)),"/"!==v.pathname.charAt(0)&&f(v.protocol)&&(v.pathname="/"+v.pathname),i(v.port,v.protocol)||(v.host=v.hostname,v.port=""),v.username=v.password="",v.auth&&(~(p=v.auth.indexOf(":"))?(v.username=v.auth.slice(0,p),v.username=encodeURIComponent(decodeURIComponent(v.username)),v.password=v.auth.slice(p+1),v.password=encodeURIComponent(decodeURIComponent(v.password))):v.username=encodeURIComponent(decodeURIComponent(v.auth)),v.auth=v.password?v.username+":"+v.password:v.username),v.origin="file:"!==v.protocol&&f(v.protocol)&&v.host?v.protocol+"//"+v.host:"null",v.href=v.toString()}g.prototype={set:function(e,t,n){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||r.parse)(t)),a[e]=t;break;case"port":a[e]=t,i(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,c.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!n;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";a[e]=t.charAt(0)!==s?s+t:t}else a[e]=t;break;case"username":case"password":a[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(a.username=t.slice(0,o),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=t.slice(o+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(t))}for(var l=0;l<h.length;l++){var u=h[l];u[4]&&(a[u[1]]=a[u[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&f(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=r.stringify);var t,n=this,i=n.host,a=n.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var s=a+(n.protocol&&n.slashes||f(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&f(n.protocol)&&!i&&"/"!==n.pathname&&(s+="@"),(":"===i[i.length-1]||c.test(n.hostname)&&!n.port)&&(i+=":"),s+=i+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}},g.extractProtocol=y,g.location=m,g.trimLeft=d,g.qs=r,e.exports=g},60788:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},48062:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>a});var r=new Uint8Array(16);function a(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}},99834:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});for(var i=n(94321),r=[],a=0;a<256;++a)r.push((a+256).toString(16).substr(1));const s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase();if(!(0,i.A)(n))throw TypeError("Stringified UUID is invalid");return n}},77981:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(48062),r=n(99834);const a=function(e,t,n){var a=(e=e||{}).random||(e.rng||i.A)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=a[s];return t}return(0,r.A)(a)}},94321:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(60788);const r=function(e){return"string"==typeof e&&i.A.test(e)}},8379:()=>{},81465:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Dexie:()=>Fn,RangeSet:()=>Dn,default:()=>Fn,liveQuery:()=>Qn,mergeRanges:()=>qn,rangesOverlap:()=>$n});const i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,r=Object.keys,a=Array.isArray;function s(e,t){return"object"!=typeof t||r(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);const o=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function u(e,t){"function"==typeof t&&(t=t(o(e))),("undefined"==typeof Reflect?r:Reflect.ownKeys)(t).forEach((n=>{h(e,n,t[n])}))}const d=Object.defineProperty;function h(e,t,n,i){d(e,t,s(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:u.bind(null,e.prototype)}}}}const m=Object.getOwnPropertyDescriptor;function f(e,t){let n;return m(e,t)||(n=o(e))&&f(n,t)}const y=[].slice;function g(e,t,n){return y.call(e,t,n)}function b(e,t){return t(e)}function w(e){if(!e)throw new Error("Assertion Failed")}function _(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function v(e,t){return e.reduce(((e,n,i)=>{var r=t(n,i);return r&&(e[r[0]]=r[1]),e}),{})}function E(e,t){if(l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],i=0,r=t.length;i<r;++i){var a=E(e,t[i]);n.push(a)}return n}var s=t.indexOf(".");if(-1!==s){var o=e[t.substr(0,s)];return void 0===o?void 0:E(o,t.substr(s+1))}}function T(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){w("string"!=typeof n&&"length"in n);for(var i=0,r=t.length;i<r;++i)T(e,t[i],n[i])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),c=t.substr(s+1);if(""===c)void 0===n?a(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var u=e[o];u&&l(e,o)||(u=e[o]={}),T(u,c,n)}}else void 0===n?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function N(e){var t={};for(var n in e)l(e,n)&&(t[n]=e[n]);return t}const A=[].concat;function S(e){return A.apply([],e)}const x="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(S([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>i[e])),C=x.map((e=>i[e]));v(x,(e=>[e,!0]));let M=null;function R(e){M="undefined"!=typeof WeakMap&&new WeakMap;const t=k(e);return M=null,t}function k(e){if(!e||"object"!=typeof e)return e;let t=M&&M.get(e);if(t)return t;if(a(e)){t=[],M&&M.set(e,t);for(var n=0,i=e.length;n<i;++n)t.push(k(e[n]))}else if(C.indexOf(e.constructor)>=0)t=e;else{const n=o(e);for(var r in t=n===Object.prototype?{}:Object.create(n),M&&M.set(e,t),e)l(e,r)&&(t[r]=k(e[r]))}return t}const{toString:O}={};function I(e){return O.call(e).slice(8,-1)}const P="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",D="symbol"==typeof P?function(e){var t;return null!=e&&(t=e[P])&&t.apply(e)}:function(){return null},L={};function q(e){var t,n,i,r;if(1===arguments.length){if(a(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(r=D(e)){for(n=[];!(i=r.next()).done;)n.push(i.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const $="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var j="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function B(e,t){j=e,U=t}var U=()=>!0;const V=!new Error("").stack;function F(){if(V)try{throw F.arguments,new Error}catch(e){return e}return new Error}function K(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(U).map((e=>"\n"+e)).join("")):""}var W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],H=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),Q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function z(e,t){this._e=F(),this.name=e,this.message=t}function G(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Y(e,t,n,i){this._e=F(),this.failures=t,this.failedKeys=i,this.successCount=n,this.message=G(e,t)}function J(e,t){this._e=F(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=G(e,t)}p(z).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+K(this._e,2))}},toString:function(){return this.name+": "+this.message}}),p(Y).from(z),p(J).from(z);var X=H.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Z=z;var ee=H.reduce(((e,t)=>{var n=t+"Error";function i(e,i){this._e=F(),this.name=n,e?"string"==typeof e?(this.message=`${e}${i?"\n "+i:""}`,this.inner=i||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=Q[t]||n,this.inner=null)}return p(i).from(Z),e[t]=i,e}),{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=W.reduce(((e,t)=>(e[t+"Error"]=ee[t],e)),{}),ne=H.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e)),{});function ie(){}function re(e){return e}function ae(e,t){return null==e||e===re?t:function(n){return t(e(n))}}function se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function oe(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var i=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?se(i,this.onsuccess):i),r&&(this.onerror=this.onerror?se(r,this.onerror):r),void 0!==a?a:n}}function ce(e,t){return e===ie?t:function(){e.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?se(n,this.onsuccess):n),i&&(this.onerror=this.onerror?se(i,this.onerror):i)}}function le(e,t){return e===ie?t:function(n){var i=e.apply(this,arguments);s(n,i);var r=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?se(r,this.onsuccess):r),a&&(this.onerror=this.onerror?se(a,this.onerror):a),void 0===i?void 0===o?void 0:o:s(i,o)}}function ue(e,t){return e===ie?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function de(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var i=this,r=arguments.length,a=new Array(r);r--;)a[r]=arguments[r];return n.then((function(){return t.apply(i,a)}))}return t.apply(this,arguments)}}ne.ModifyError=Y,ne.DexieError=z,ne.BulkError=J;var he={};const[pe,me,fe]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,o(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,o(t),e]})(),ye=me&&me.then,ge=pe&&pe.constructor,be=!!fe;var we=!1,_e=fe?()=>{fe.then(Fe)}:i.setImmediate?setImmediate.bind(null,Fe):i.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Fe(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Fe,0)},ve=function(e,t){Re.push([e,t]),Te&&(_e(),Te=!1)},Ee=!0,Te=!0,Ne=[],Ae=[],Se=null,xe=re,Ce={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{pt(e[0],e[1])}catch(e){}}))}},Me=Ce,Re=[],ke=0,Oe=[];function Ie(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ie,this._lib=!1;var t=this._PSD=Me;if(j&&(this._stackHolder=F(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==he)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&qe(this,this._value))}this._state=null,this._value=null,++t.ref,Le(this,e)}const Pe={get:function(){var e=Me,t=Ze;function n(n,i){var r=!e.global&&(e!==Me||t!==Ze);const a=r&&!it();var s=new Ie(((t,s)=>{je(this,new De(dt(n,e,r,a),dt(i,e,r,a),t,s,e))}));return j&&Ve(s,this),s}return n.prototype=he,n},set:function(e){h(this,"then",e&&e.prototype===he?Pe:{get:function(){return e},set:Pe.set})}};function De(e,t,n,i,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=i,this.psd=r}function Le(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ke();t&&"function"==typeof t.then?Le(e,((e,n)=>{t instanceof Ie?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,$e(e)),n&&We()}}),qe.bind(null,e))}catch(t){qe(e,t)}}function qe(e,t){if(Ae.push(t),null===e._state){var n=e._lib&&Ke();t=xe(t),e._state=!1,e._value=t,j&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=f(t,"stack");t._promise=e,h(t,"stack",{get:()=>we?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Ne.some((t=>t._value===e._value))||Ne.push(e)}(e),$e(e),n&&We()}}function $e(e){var t=e._listeners;e._listeners=[];for(var n=0,i=t.length;n<i;++n)je(e,t[n]);var r=e._PSD;--r.ref||r.finalize(),0===ke&&(++ke,ve((()=>{0==--ke&&He()}),[]))}function je(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ke,ve(Be,[n,e,t])}else e._listeners.push(t)}function Be(e,t,n){try{Se=t;var i,r=t._value;t._state?i=e(r):(Ae.length&&(Ae=[]),i=e(r),-1===Ae.indexOf(r)&&function(e){for(var t=Ne.length;t;)if(Ne[--t]._value===e._value)return void Ne.splice(t,1)}(t)),n.resolve(i)}catch(e){n.reject(e)}finally{Se=null,0==--ke&&He(),--n.psd.ref||n.psd.finalize()}}function Ue(e,t,n){if(t.length===n)return t;var i="";if(!1===e._state){var r,a,s=e._value;null!=s?(r=s.name||"Error",a=s.message||s,i=K(s,0)):(r=s,a=""),t.push(r+(a?": "+a:"")+i)}return j&&((i=K(e._stackHolder,2))&&-1===t.indexOf(i)&&t.push(i),e._prev&&Ue(e._prev,t,n)),t}function Ve(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Fe(){Ke()&&We()}function Ke(){var e=Ee;return Ee=!1,Te=!1,e}function We(){var e,t,n;do{for(;Re.length>0;)for(e=Re,Re=[],n=e.length,t=0;t<n;++t){var i=e[t];i[0].apply(null,i[1])}}while(Re.length>0);Ee=!0,Te=!0}function He(){var e=Ne;Ne=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Oe.slice(0),n=t.length;n;)t[--n]()}function Qe(e){return new Ie(he,!1,e)}function ze(e,t){var n=Me;return function(){var i=Ke(),r=Me;try{return ot(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ot(r,!1),i&&We()}}}u(Ie.prototype,{then:Pe,_then:function(e,t){je(this,new De(null,null,e,t,Me))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Qe(e))):this.then(null,(e=>e&&e.name===t?n(e):Qe(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Qe(t))))},stack:{get:function(){if(this._stack)return this._stack;try{we=!0;var e=Ue(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{we=!1}}},timeout:function(e,t){return e<1/0?new Ie(((n,i)=>{var r=setTimeout((()=>i(new ee.Timeout(t))),e);this.then(n,i).finally(clearTimeout.bind(null,r))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),Ce.env=ct(),u(Ie,{all:function(){var e=q.apply(null,arguments).map(rt);return new Ie((function(t,n){0===e.length&&t([]);var i=e.length;e.forEach(((r,a)=>Ie.resolve(r).then((n=>{e[a]=n,--i||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ie)return e;if(e&&"function"==typeof e.then)return new Ie(((t,n)=>{e.then(t,n)}));var t=new Ie(he,!0,e);return Ve(t,Se),t},reject:Qe,race:function(){var e=q.apply(null,arguments).map(rt);return new Ie(((t,n)=>{e.map((e=>Ie.resolve(e).then(t,n)))}))},PSD:{get:()=>Me,set:e=>Me=e},totalEchoes:{get:()=>Ze},newPSD:tt,usePSD:lt,scheduler:{get:()=>ve,set:e=>{ve=e}},rejectionMapper:{get:()=>xe,set:e=>{xe=e}},follow:(e,t)=>new Ie(((n,i)=>tt(((t,n)=>{var i=Me;i.unhandleds=[],i.onunhandled=n,i.finalize=se((function(){!function(e){Oe.push((function t(){e(),Oe.splice(Oe.indexOf(t),1)})),++ke,ve((()=>{0==--ke&&He()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),i.finalize),e()}),t,n,i)))}),ge&&(ge.allSettled&&h(Ie,"allSettled",(function(){const e=q.apply(null,arguments).map(rt);return new Ie((t=>{0===e.length&&t([]);let n=e.length;const i=new Array(n);e.forEach(((e,r)=>Ie.resolve(e).then((e=>i[r]={status:"fulfilled",value:e}),(e=>i[r]={status:"rejected",reason:e})).then((()=>--n||t(i)))))}))})),ge.any&&"undefined"!=typeof AggregateError&&h(Ie,"any",(function(){const e=q.apply(null,arguments).map(rt);return new Ie(((t,n)=>{0===e.length&&n(new AggregateError([]));let i=e.length;const r=new Array(i);e.forEach(((e,a)=>Ie.resolve(e).then((e=>t(e)),(e=>{r[a]=e,--i||n(new AggregateError(r))}))))}))})));const Ge={awaits:0,echoes:0,id:0};var Ye=0,Je=[],Xe=0,Ze=0,et=0;function tt(e,t,n,i){var r=Me,a=Object.create(r);a.parent=r,a.ref=0,a.global=!1,a.id=++et;var o=Ce.env;a.env=be?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject,nthen:ht(o.nthen,a),gthen:ht(o.gthen,a)}:{},t&&s(a,t),++r.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=lt(a,e,n,i);return 0===a.ref&&a.finalize(),c}function nt(){return Ge.id||(Ge.id=++Ye),++Ge.awaits,Ge.echoes+=100,Ge.id}function it(){return!!Ge.awaits&&(0==--Ge.awaits&&(Ge.id=0),Ge.echoes=100*Ge.awaits,!0)}function rt(e){return Ge.echoes&&e&&e.constructor===ge?(nt(),e.then((e=>(it(),e)),(e=>(it(),mt(e))))):e}function at(e){++Ze,Ge.echoes&&0!=--Ge.echoes||(Ge.echoes=Ge.id=0),Je.push(Me),ot(e,!0)}function st(){var e=Je[Je.length-1];Je.pop(),ot(e,!1)}function ot(e,t){var n=Me;if((t?!Ge.echoes||Xe++&&e===Me:!Xe||--Xe&&e===Me)||ut(t?at.bind(null,e):st),e!==Me&&(Me=e,n===Ce&&(Ce.env=ct()),be)){var r=Ce.env.Promise,a=e.env;me.then=a.nthen,r.prototype.then=a.gthen,(n.global||e.global)&&(Object.defineProperty(i,"Promise",a.PromiseProp),r.all=a.all,r.race=a.race,r.resolve=a.resolve,r.reject=a.reject,a.allSettled&&(r.allSettled=a.allSettled),a.any&&(r.any=a.any))}}function ct(){var e=i.Promise;return be?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:me.then,gthen:e.prototype.then}:{}}function lt(e,t,n,i,r){var a=Me;try{return ot(e,!0),t(n,i,r)}finally{ot(a,!1)}}function ut(e){ye.call(pe,e)}function dt(e,t,n,i){return"function"!=typeof e?e:function(){var r=Me;n&&nt(),ot(t,!0);try{return e.apply(this,arguments)}finally{ot(r,!1),i&&ut(it)}}}function ht(e,t){return function(n,i){return e.call(this,dt(n,t),dt(i,t))}}function pt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,a={promise:t,reason:e};if(i.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),s(r,a)):i.CustomEvent&&s(r=new CustomEvent("unhandledrejection",{detail:a}),a),r&&i.dispatchEvent&&(dispatchEvent(r),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(r)}catch(e){}j&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+ye).indexOf("[native code]")&&(nt=it=ie);var mt=Ie.reject;function ft(e,t,n,i){if(e.idbdb&&(e._state.openComplete||Me.letThrough||e._vip)){var r=e._createTransaction(t,n,e._dbSchema);try{r.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>ft(e,t,n,i)))):mt(r)}return r._promise(t,((e,t)=>tt((()=>(Me.trans=r,i(e,t,r)))))).then((e=>r._completion.then((()=>e))))}if(e._state.openComplete)return mt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return mt(new ee.DatabaseClosed);e.open().catch(ie)}return e._state.dbReadyPromise.then((()=>ft(e,t,n,i)))}const yt=String.fromCharCode(65535),gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bt=[],wt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),_t=wt,vt=wt,Et=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Tt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Nt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function At(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=R(t))[e],t)}class St{_trans(e,t,n){const i=this._tx||Me.trans,r=this.name;function a(e,n,i){if(!i.schema[r])throw new ee.NotFound("Table "+r+" not part of transaction");return t(i.idbtrans,i)}const s=Ke();try{return i&&i.db===this.db?i===Me.trans?i._promise(e,a,n):tt((()=>i._promise(e,a,n)),{trans:i,transless:Me.transless||Me}):ft(this.db,e,[this.name],a)}finally{s&&We()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=r(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==yt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&j&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(e,t){try{return 0===s.cmp(e,t)}catch(e){return!1}}const[c,l]=t.reduce((([t,n],r)=>{const s=i[r],c=e[r];return[t||s,t||!s?Tt(n,s&&s.multi?e=>{const t=E(e,r);return a(t)&&t.some((e=>o(c,e)))}:e=>o(c,E(e,r))):n]}),[null,null]);return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var i in t)if(l(t,i))try{n[i]=t[i]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){s(this,e)}))}add(e,t){const{auto:n,keyPath:i}=this.schema.primKey;let r=e;return i&&n&&(r=At(i)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[r]}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):e.lastResult)).then((t=>{if(i)try{T(e,i,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||a(e))return this.where(":id").equals(e).modify(t);{const n=E(e,this.schema.primKey.keyPath);if(void 0===n)return mt(new ee.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?r(t).forEach((n=>{T(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:i}=this.schema.primKey;let r=e;return i&&n&&(r=At(i)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[r],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):e.lastResult)).then((t=>{if(i)try{T(e,i,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Nt}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const i=Array.isArray(t)?t:void 0,r=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:a}=this.schema.primKey;if(a&&i)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let o=a&&n?e.map(At(a)):e;return this.core.mutate({trans:t,type:"add",keys:i,values:o,wantResults:r}).then((({numFailures:e,results:t,lastResult:n,failures:i})=>{if(0===e)return r?t:n;throw new J(`${this.name}.bulkAdd(): ${e} of ${s} operations failed`,i)}))}))}bulkPut(e,t,n){const i=Array.isArray(t)?t:void 0,r=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:a}=this.schema.primKey;if(a&&i)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let o=a&&n?e.map(At(a)):e;return this.core.mutate({trans:t,type:"put",keys:i,values:o,wantResults:r}).then((({numFailures:e,results:t,lastResult:n,failures:i})=>{if(0===e)return r?t:n;throw new J(`${this.name}.bulkPut(): ${e} of ${s} operations failed`,i)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:i})=>{if(0===e)return n;throw new J(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,i)}))}}function xt(e){var t={},n=function(n,i){if(i){for(var r=arguments.length,a=new Array(r-1);--r;)a[r-1]=arguments[r];return t[n].subscribe.apply(null,a),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var i=1,s=arguments.length;i<s;++i)o(arguments[i]);return n;function o(e,i,r){if("object"==typeof e)return c(e);i||(i=ue),r||(r=ie);var a={subscribers:[],fire:r,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=i(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter((function(t){return t!==e})),a.fire=a.subscribers.reduce(i,r)}};return t[e]=n[e]=a,a}function c(e){r(e).forEach((function(t){var n=e[t];if(a(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ee.InvalidArgument("Invalid event config");var i=o(t,re,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];i.subscribers.forEach((function(e){_((function(){e.apply(null,t)}))}))}))}}))}}function Ct(e,t){return p(t).from({prototype:e}),t}function Mt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Rt(e,t){e.filter=Tt(e.filter,t)}function kt(e,t,n){var i=e.replayFilter;e.replayFilter=i?()=>Tt(i(),t()):t,e.justLimit=n&&!i}function Ot(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function It(e,t,n){const i=Ot(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:i,range:e.range}})}function Pt(e,t,n,i){const r=e.replayFilter?Tt(e.filter,e.replayFilter()):e.filter;if(e.or){const a={},s=(e,n,i)=>{if(!r||r(n,i,(e=>n.stop(e)),(e=>n.fail(e)))){var s=n.primaryKey,o=""+s;"[object ArrayBuffer]"===o&&(o=""+new Uint8Array(s)),l(a,o)||(a[o]=!0,t(e,n,i))}};return Promise.all([e.or._iterate(s,n),Dt(It(e,i,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Dt(It(e,i,n),Tt(e.algorithm,r),t,!e.keysOnly&&e.valueMapper)}function Dt(e,t,n,i){var r=ze(i?(e,t,r)=>n(i(e),t,r):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=ie}),(t=>{e.fail(t),n=ie}))||r(e.value,e,(e=>n=e)),n()}))}))}function Lt(e,t){try{const n=qt(e),i=qt(t);if(n!==i)return"Array"===n?1:"Array"===i?-1:"binary"===n?1:"binary"===i?-1:"string"===n?1:"string"===i?-1:"Date"===n?1:"Date"!==i?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,i=t.length,r=n<i?n:i;for(let n=0;n<r;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===i?0:n<i?-1:1}($t(e),$t(t));case"Array":return function(e,t){const n=e.length,i=t.length,r=n<i?n:i;for(let n=0;n<r;++n){const i=Lt(e[n],t[n]);if(0!==i)return i}return n===i?0:n<i?-1:1}(e,t)}}catch(e){}return NaN}function qt(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=I(e);return"ArrayBuffer"===n?"binary":n}function $t(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class jt{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Tt(t.algorithm,e)}_iterate(e,t){return Pt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Pt(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Mt(t,!0))return n.count({trans:e,query:{index:Ot(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var i=0;return Pt(t,(()=>(++i,!1)),e,n).then((()=>i))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),i=n[0],r=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[i]}var s="next"===this._ctx.dir?1:-1;function o(e,t){var n=a(e,r),i=a(t,r);return n<i?-s:n>i?s:0}return this.toArray((function(e){return e.sort(o)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Mt(t,!0)&&t.limit>0){const{valueMapper:n}=t,i=Ot(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:i,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Pt(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Mt(t)?kt(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):kt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),kt(this._ctx,(()=>{var t=e;return function(e,n,i){return--t<=0&&n(i),t>=0}}),!0),this}until(e,t){return Rt(this._ctx,(function(n,i,r){return!e(n.value)||(i(r),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Rt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Tt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Mt(t,!0)&&t.limit>0)return this._read((e=>{var n=Ot(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Rt(this._ctx,(function(e){var t=e.primaryKey.toString(),i=l(n,t);return n[t]=!0,!i})),this}modify(e){var t=this._ctx;return this._write((n=>{var i;if("function"==typeof e)i=e;else{var a=r(e),s=a.length;i=function(t){for(var n=!1,i=0;i<s;++i){var r=a[i],o=e[r];E(t,r)!==o&&(T(t,r,o),n=!0)}return n}}const o=t.table.core,{outbound:c,extractKey:l}=o.schema.primaryKey,u=this.db._options.modifyChunkSize||200,d=[];let h=0;const p=[],m=(e,t)=>{const{failures:n,numFailures:i}=t;h+=e-i;for(let e of r(n))d.push(n[e])};return this.clone().primaryKeys().then((r=>{const a=s=>{const d=Math.min(u,r.length-s);return o.getMany({trans:n,keys:r.slice(s,s+d),cache:"immutable"}).then((h=>{const p=[],f=[],y=c?[]:null,g=[];for(let e=0;e<d;++e){const t=h[e],n={value:R(t),primKey:r[s+e]};!1!==i.call(n,n.value,n)&&(null==n.value?g.push(r[s+e]):c||0===Lt(l(t),l(n.value))?(f.push(n.value),c&&y.push(r[s+e])):(g.push(r[s+e]),p.push(n.value)))}const b=Mt(t)&&t.limit===1/0&&("function"!=typeof e||e===Bt)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&o.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);m(p.length,e)}))).then((()=>(f.length>0||b&&"object"==typeof e)&&o.mutate({trans:n,type:"put",keys:y,values:f,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>m(f.length,e))))).then((()=>(g.length>0||b&&e===Bt)&&o.mutate({trans:n,type:"delete",keys:g,criteria:b}).then((e=>m(g.length,e))))).then((()=>r.length>s+d&&a(s+u)))}))};return a(0).then((()=>{if(d.length>0)throw new Y("Error modifying one or more objects",d,h,p);return r.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Mt(e)&&(e.isPrimKey&&!vt||3===t.type)?this._write((n=>{const{primaryKey:i}=e.table.core.schema,r=t;return e.table.core.count({trans:n,query:{index:i,range:r}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:r}).then((({failures:e,lastResult:n,results:i,numFailures:r})=>{if(r)throw new Y("Could not delete some values",Object.keys(e).map((t=>e[t])),t-r);return t-r}))))})):this.modify(Bt)}}const Bt=(e,t)=>t.value=null;function Ut(e,t){return e<t?-1:e===t?0:1}function Vt(e,t){return e>t?-1:e===t?0:1}function Ft(e,t,n){var i=e instanceof Gt?new e.Collection(e):e;return i._ctx.error=n?new n(t):new TypeError(t),i}function Kt(e){return new e.Collection(e,(()=>zt(""))).limit(0)}function Wt(e,t,n,i,r,a){for(var s=Math.min(e.length,i.length),o=-1,c=0;c<s;++c){var l=t[c];if(l!==i[c])return r(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):r(e[c],i[c])<0?e.substr(0,c)+i[c]+n.substr(c+1):o>=0?e.substr(0,o)+t[o]+n.substr(o+1):null;r(e[c],l)<0&&(o=c)}return s<i.length&&"next"===a?e+n.substr(e.length):s<e.length&&"prev"===a?e.substr(0,n.length):o<0?null:e.substr(0,o)+i[o]+n.substr(o+1)}function Ht(e,t,n,i){var r,a,s,o,c,l,u,d=n.length;if(!n.every((e=>"string"==typeof e)))return Ft(e,"String expected.");function h(e){r=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),a=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),s="next"===e?Ut:Vt;var t=n.map((function(e){return{lower:a(e),upper:r(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));o=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),l=e,u="next"===e?"":i}h("next");var p=new e.Collection(e,(()=>Qt(o[0],c[d-1]+i)));p._ondirectionchange=function(e){h(e)};var m=0;return p._addAlgorithm((function(e,n,i){var r=e.key;if("string"!=typeof r)return!1;var h=a(r);if(t(h,c,m))return!0;for(var p=null,f=m;f<d;++f){var y=Wt(r,h,o[f],c[f],s,l);null===y&&null===p?m=f+1:(null===p||s(p,y)>0)&&(p=y)}return n(null!==p?function(){e.continue(p+u)}:i),!1})),p}function Qt(e,t,n,i){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:i}}function zt(e){return{type:1,lower:e,upper:e}}class Gt{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,i){n=!1!==n,i=!0===i;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||i)&&(!n||!i)?Kt(this):new this.Collection(this,(()=>Qt(e,t,!n,!i)))}catch(e){return Ft(this,gt)}}equals(e){return null==e?Ft(this,gt):new this.Collection(this,(()=>zt(e)))}above(e){return null==e?Ft(this,gt):new this.Collection(this,(()=>Qt(e,void 0,!0)))}aboveOrEqual(e){return null==e?Ft(this,gt):new this.Collection(this,(()=>Qt(e,void 0,!1)))}below(e){return null==e?Ft(this,gt):new this.Collection(this,(()=>Qt(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Ft(this,gt):new this.Collection(this,(()=>Qt(void 0,e)))}startsWith(e){return"string"!=typeof e?Ft(this,"String expected."):this.between(e,e+yt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):Ht(this,((e,t)=>0===e.indexOf(t[0])),[e],yt)}equalsIgnoreCase(e){return Ht(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=q.apply(L,arguments);return 0===e.length?Kt(this):Ht(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=q.apply(L,arguments);return 0===e.length?Kt(this):Ht(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,yt)}anyOf(){const e=q.apply(L,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Ft(this,gt)}if(0===e.length)return Kt(this);const n=new this.Collection(this,(()=>Qt(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let i=0;return n._addAlgorithm(((n,r,a)=>{const s=n.key;for(;t(s,e[i])>0;)if(++i,i===e.length)return r(a),!1;return 0===t(s,e[i])||(r((()=>{n.continue(e[i])})),!1)})),n}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=q.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Ft(this,gt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,i=this._ascending,r=this._descending,a=this._min,s=this._max;if(0===e.length)return Kt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0)))return Ft(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);const o=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let l,u=i;function d(e,t){return u(e[0],t[0])}try{l=e.reduce((function(e,t){let i=0,r=e.length;for(;i<r;++i){const r=e[i];if(n(t[0],r[1])<0&&n(t[1],r[0])>0){r[0]=a(r[0],t[0]),r[1]=s(r[1],t[1]);break}}return i===r&&e.push(t),e}),[]),l.sort(d)}catch(e){return Ft(this,gt)}let h=0;const p=c?e=>i(e,l[h][1])>0:e=>i(e,l[h][1])>=0,m=o?e=>r(e,l[h][0])>0:e=>r(e,l[h][0])>=0;let f=p;const y=new this.Collection(this,(()=>Qt(l[0][0],l[l.length-1][1],!o,!c)));return y._ondirectionchange=e=>{"next"===e?(f=p,u=i):(f=m,u=r),l.sort(d)},y._addAlgorithm(((e,t,n)=>{for(var r=e.key;f(r);)if(++h,h===l.length)return t(n),!1;return!!function(e){return!p(e)&&!m(e)}(r)||(0===this._cmp(r,l[h][1])||0===this._cmp(r,l[h][0])||t((()=>{u===i?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),y}startsWithAnyOf(){const e=q.apply(L,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Kt(this):this.inAnyRange(e.map((e=>[e,e+yt]))):Ft(this,"startsWithAnyOf() only works with strings")}}function Yt(e){return ze((function(t){return Jt(t),e(t.target.error),!1}))}function Jt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Xt=xt(null,"storagemutated");class Zt{_lock(){return w(!Me.global),++this._reculock,1!==this._reculock||Me.global||(Me.lockOwnerFor=this),this}_unlock(){if(w(!Me.global),0==--this._reculock)for(Me.global||(Me.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Me.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(w(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(n);case"MissingAPIError":throw new ee.MissingAPI(n.message,n);default:throw new ee.OpenFailed(n)}if(!this.active)throw new ee.TransactionInactive;return w(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ze((t=>{Jt(t),this._reject(e.error)})),e.onabort=ze((t=>{Jt(t),this.active&&this._reject(new ee.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=ze((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ee.TransactionInactive);if(this._locked())return new Ie(((i,r)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(i,r)},Me])}));if(n)return tt((()=>{var e=new Ie(((e,n)=>{this._lock();const i=t(e,n,this);i&&i.then&&i.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var i=new Ie(((e,n)=>{var i=t(e,n,this);i&&i.then&&i.then(e,n)}));return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ie.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=e)}()}var r=t._waitingFor;return new Ie(((e,i)=>{n.then((n=>t._waitingQueue.push(ze(e.bind(null,n)))),(e=>t._waitingQueue.push(ze(i.bind(null,e))))).finally((()=>{t._waitingFor===r&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];const n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),t[e]=i,i}}function en(e,t,n,i,r,a,s){return{name:e,keyPath:t,unique:n,multi:i,auto:r,compound:a,src:(n&&!s?"&":"")+(i?"*":"")+(r?"++":"")+tn(t)}}function tn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:v(n,(e=>[e.name,e]))}}let rn=e=>{try{return e.only([[]]),rn=()=>[[]],[[]]}catch(e){return rn=()=>yt,yt}};function an(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>E(t,e)}(e):t=>E(t,e)}function sn(e){return[].slice.call(e)}let on=0;function cn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ln(e,t,n){function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:i,lowerOpen:r,upperOpen:a}=e;return void 0===n?void 0===i?null:t.upperBound(i,!!a):void 0===i?t.lowerBound(n,!!r):t.bound(n,i,!!r,!!a)}const{schema:r,hasGetAll:s}=function(e,t){const n=sn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,i=a(t),r=null==t,s={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:r,compound:i,keyPath:t,autoIncrement:n,unique:!0,extractKey:an(t)},indexes:sn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:i,keyPath:r}=e,o={name:t,compound:a(r),keyPath:r,unique:n,multiEntry:i,extractKey:an(r)};return s[cn(r)]=o,o})),getIndexByKeyPath:e=>s[cn(e)]};return s[":id"]=o.primaryKey,null!=t&&(s[cn(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=r.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:r,values:a,range:s}){return new Promise(((o,c)=>{o=ze(o);const l=e.objectStore(t),u=null==l.keyPath,d="put"===n||"add"===n;if(!d&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:h}=r||a||{length:1};if(r&&a&&r.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return o({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const m=[],f=[];let y=0;const g=e=>{++y,Jt(e)};if("deleteRange"===n){if(4===s.type)return o({numFailures:y,failures:f,results:[],lastResult:void 0});3===s.type?m.push(p=l.clear()):m.push(p=l.delete(i(s)))}else{const[e,t]=d?u?[a,r]:[a,null]:[r,null];if(d)for(let i=0;i<h;++i)m.push(p=t&&void 0!==t[i]?l[n](e[i],t[i]):l[n](e[i])),p.onerror=g;else for(let t=0;t<h;++t)m.push(p=l[n](e[t])),p.onerror=g}const b=e=>{const t=e.target.result;m.forEach(((e,t)=>null!=e.error&&(f[t]=e.error))),o({numFailures:y,failures:f,results:"delete"===n?r:m.map((e=>e.result)),lastResult:t})};p.onerror=e=>{g(e),b(e)},p.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((i,r)=>{i=ze(i);const a=e.objectStore(t),s=n.length,o=new Array(s);let c,l=0,u=0;const d=e=>{const t=e.target;o[t._pos]=t.result,++u===l&&i(o)},h=Yt(r);for(let e=0;e<s;++e)null!=n[e]&&(c=a.get(n[e]),c._pos=e,c.onsuccess=d,c.onerror=h,++l);0===l&&i(o)})),get:({trans:e,key:n})=>new Promise(((i,r)=>{i=ze(i);const a=e.objectStore(t).get(n);a.onsuccess=e=>i(e.target.result),a.onerror=Yt(r)})),query:function(e){return n=>new Promise(((r,a)=>{r=ze(r);const{trans:s,values:o,limit:c,query:l}=n,u=c===1/0?void 0:c,{index:d,range:h}=l,p=s.objectStore(t),m=d.isPrimaryKey?p:p.index(d.name),f=i(h);if(0===c)return r({result:[]});if(e){const e=o?m.getAll(f,u):m.getAllKeys(f,u);e.onsuccess=e=>r({result:e.target.result}),e.onerror=Yt(a)}else{let e=0;const t=o||!("openKeyCursor"in m)?m.openCursor(f):m.openKeyCursor(f),n=[];t.onsuccess=i=>{const a=t.result;return a?(n.push(o?a.value:a.primaryKey),++e===c?r({result:n}):void a.continue()):r({result:n})},t.onerror=Yt(a)}}))}(s),openCursor:function({trans:e,values:n,query:r,reverse:a,unique:s}){return new Promise(((o,c)=>{o=ze(o);const{index:l,range:u}=r,d=e.objectStore(t),h=l.isPrimaryKey?d:d.index(l.name),p=a?s?"prevunique":"prev":s?"nextunique":"next",m=n||!("openKeyCursor"in h)?h.openCursor(i(u),p):h.openKeyCursor(i(u),p);m.onerror=Yt(c),m.onsuccess=ze((t=>{const n=m.result;if(!n)return void o(null);n.___id=++on,n.done=!1;const i=n.continue.bind(n);let r=n.continuePrimaryKey;r&&(r=r.bind(n));const a=n.advance.bind(n),s=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=ze(c),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=ze(e),m.onerror=Yt(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=s,e(t)}})),o=()=>{if(m.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return m.onsuccess=ze((e=>{m.onsuccess=o,o()})),n.continue=i,n.continuePrimaryKey=r,n.advance=a,o(),t},o(n)}),c)}))},count({query:e,trans:n}){const{index:r,range:a}=e;return new Promise(((e,s)=>{const o=n.objectStore(t),c=r.isPrimaryKey?o:o.index(r.name),l=i(a),u=l?c.count(l):c.count();u.onsuccess=ze((t=>e(t.target.result))),u.onerror=Yt(s)}))}}}(e))),c={};return o.forEach((e=>c[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!c[e])throw new Error(`Table '${e}' not found`);return c[e]},MIN_KEY:-1/0,MAX_KEY:rn(t),schema:r}}function un({_novip:e},t){const n=t.db,i=function(e,t,{IDBKeyRange:n,indexedDB:i},r){const a=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(ln(t,n,r),e.dbcore);return{dbcore:a}}(e._middlewares,n,e._deps,t);e.core=i.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function dn({_novip:e},t,n,i){n.forEach((n=>{const r=i[n];t.forEach((t=>{const i=f(t,n);(!i||"value"in i&&void 0===i.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,n,{get(){return this.table(n)},set(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,r))}))}))}function hn({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function pn(e,t){return e._cfg.version-t._cfg.version}function mn(e,t,n,i){const a=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,a);s.create(n),s._completion.catch(i);const o=s._reject.bind(s),c=Me.transless||Me;tt((()=>{Me.trans=s,Me.transless=c,0===t?(r(a).forEach((e=>{yn(n,e,a[e].primKey,a[e].indexes)})),un(e,n),Ie.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,n,i){const a=[],s=e._versions;let o=e._dbSchema=bn(e,e.idbdb,i),c=!1;return s.filter((e=>e._cfg.version>=t)).forEach((s=>{a.push((()=>{const a=o,l=s._cfg.dbschema;wn(e,a,i),wn(e,l,i),o=e._dbSchema=l;const u=fn(a,l);u.add.forEach((e=>{yn(i,e[0],e[1].primKey,e[1].indexes)})),u.change.forEach((e=>{if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");{const t=i.objectStore(e.name);e.add.forEach((e=>gn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),gn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const d=s._cfg.contentUpgrade;if(d&&s._cfg.version>t){un(e,i),n._memoizedTables={},c=!0;let t=N(l);u.del.forEach((e=>{t[e]=a[e]})),hn(e,[e.Transaction.prototype]),dn(e,[e.Transaction.prototype],r(t),t),n.schema=t;const s=$(d);let o;s&&nt();const h=Ie.follow((()=>{if(o=d(n),o&&s){var e=it.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?Ie.resolve(o):h.then((()=>o))}})),a.push((t=>{c&&_t||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(s._cfg.dbschema,t),hn(e,[e.Transaction.prototype]),dn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return a.length?Ie.resolve(a.shift()(n.idbtrans)).then(e):Ie.resolve()}().then((()=>{var e,t;t=i,r(e=o).forEach((n=>{t.db.objectStoreNames.contains(n)||yn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,s,n).catch(o)}))}function fn(e,t){const n={del:[],add:[],change:[]};let i;for(i in e)t[i]||n.del.push(i);for(i in t){const r=e[i],a=t[i];if(r){const e={name:i,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||r.primKey.auto!==a.primKey.auto&&!wt)e.recreate=!0,n.change.push(e);else{const t=r.idxByName,i=a.idxByName;let s;for(s in t)i[s]||e.del.push(s);for(s in i){const n=t[s],r=i[s];n?n.src!==r.src&&e.change.push(r):e.add.push(r)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([i,a])}return n}function yn(e,t,n,i){const r=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach((e=>gn(r,e))),r}function gn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function bn(e,t,n){const i={};return g(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let r=t.keyPath;const a=en(tn(r),r||"",!1,!1,!!t.autoIncrement,r&&"string"!=typeof r,!0),s=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);r=n.keyPath;var o=en(n.name,r,!!n.unique,!!n.multiEntry,!1,r&&"string"!=typeof r,!1);s.push(o)}i[e]=nn(e,a,s)})),i}function wn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const a=r[i],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(let e=0;e<s.indexNames.length;++e){const n=s.indexNames[e],i=s.index(n).keyPath,r="string"==typeof i?i:"["+g(i).join("+")+"]";if(t[a]){const e=t[a].idxByName[r];e&&(e.name=n,delete t[a].idxByName[r],t[a].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class _n{_parseStoresSpec(e,t){r(e).forEach((n=>{if(null!==e[n]){var i=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return en(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(i),0===t)})),r=i.shift();if(r.multi)throw new ee.Schema("Primary key cannot be multi-valued");i.forEach((e=>{if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")})),t[n]=nn(n,r,i)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e;const n=t._versions,i={};let a={};return n.forEach((e=>{s(i,e._cfg.storesSource),a=e._cfg.dbschema={},e._parseStoresSpec(i,a)})),t._dbSchema=a,hn(t,[t._allTables,t,t.Transaction.prototype]),dn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],r(a),a),t._storeNames=r(a),this}upgrade(e){return this._cfg.contentUpgrade=de(this._cfg.contentUpgrade||ie,e),this}}function vn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Fn("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function En(e){return e&&"function"==typeof e.databases}function Tn(e){return tt((function(){return Me.letThrough=!0,e()}))}function Nn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function An(e){var t=t=>e.next(t),n=r(t),i=r((t=>e.throw(t)));function r(e){return t=>{var r=e(t),s=r.value;return r.done?s:s&&"function"==typeof s.then?s.then(n,i):a(s)?Promise.all(s).then(n,i):n(s)}}return r(t)()}function Sn(e,t,n){var i=arguments.length;if(i<2)throw new ee.InvalidArgument("Too few arguments");for(var r=new Array(i-1);--i;)r[i-1]=arguments[i];return n=r.pop(),[e,S(r),n]}function xn(e,t,n,i,r){return Ie.resolve().then((()=>{const a=Me.transless||Me,s=e._createTransaction(t,n,e._dbSchema,i),o={trans:s,transless:a};if(i)s.idbtrans=i.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>xn(e,t,n,null,r)))):mt(i)}const c=$(r);let l;c&&nt();const u=Ie.follow((()=>{if(l=r.call(s,s),l)if(c){var e=it.bind(null,null);l.then(e,e)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=An(l))}),o);return(l&&"function"==typeof l.then?Ie.resolve(l).then((e=>s.active?e:mt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>l))).then((e=>(i&&s._resolve(),s._completion.then((()=>e))))).catch((e=>(s._reject(e),mt(e))))}))}function Cn(e,t,n){const i=a(e)?e.slice():[e];for(let e=0;e<n;++e)i.push(t);return i}const Mn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:i}=n,r={},a=[];function s(e,t,n){const i=cn(e),o=r[i]=r[i]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,u={...n,isVirtual:l,keyTail:t,keyLength:c,extractKey:an(e),unique:!l&&n.unique};return o.push(u),u.isPrimaryKey||a.push(u),c>1&&s(2===c?e[0]:e.slice(0,c-1),t+1,n),o.sort(((e,t)=>e.keyTail-t.keyTail)),u}const o=s(i.primaryKey.keyPath,0,i.primaryKey);r[":id"]=[o];for(const e of i.indexes)s(e.keyPath,0,e);function c(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(i=t.query.range,r=n.keyTail,{type:1===i.type?2:i.type,lower:Cn(i.lower,i.lowerOpen?e.MAX_KEY:e.MIN_KEY,r),lowerOpen:!0,upper:Cn(i.upper,i.upperOpen?e.MIN_KEY:e.MAX_KEY,r),upperOpen:!0})}}:t;var i,r}const l={...n,schema:{...i,primaryKey:o,indexes:a,getIndexByKeyPath:function(e){const t=r[cn(e)];return t&&t[0]}},count:e=>n.count(c(e)),query:e=>n.query(c(e)),openCursor(t){const{keyTail:i,isVirtual:r,keyLength:a}=t.query.index;return r?n.openCursor(c(t)).then((n=>n&&function(n){const r=Object.create(n,{continue:{value:function(r){null!=r?n.continue(Cn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value(t,r){n.continuePrimaryKey(Cn(t,e.MAX_KEY,i),r)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:()=>n.value}});return r}(n))):n.openCursor(t)}};return l}}}};function Rn(e,t,n,i){return n=n||{},i=i||"",r(e).forEach((r=>{if(l(t,r)){var a=e[r],s=t[r];if("object"==typeof a&&"object"==typeof s&&a&&s){const e=I(a);e!==I(s)?n[i+r]=t[r]:"Object"===e?Rn(a,s,n,i+r+"."):a!==s&&(n[i+r]=t[r])}else a!==s&&(n[i+r]=t[r])}else n[i+r]=void 0})),r(t).forEach((r=>{l(e,r)||(n[i+r]=t[r])})),n}const kn={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:i}=n.schema,r={...n,mutate(e){const r=Me.trans,{deleting:a,creating:s,updating:o}=r.table(t).hook;switch(e.type){case"add":if(s.fire===ie)break;return r._promise("readwrite",(()=>c(e)),!0);case"put":if(s.fire===ie&&o.fire===ie)break;return r._promise("readwrite",(()=>c(e)),!0);case"delete":if(a.fire===ie)break;return r._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(a.fire===ie)break;return r._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function c(e){const t=Me.trans,r=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(i,e);if(!r)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:r}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,r).then((c=>{const u=r.map(((n,r)=>{const u=c[r],d={onerror:null,onsuccess:null};if("delete"===e.type)a.fire.call(d,n,u,t);else if("add"===e.type||void 0===u){const a=s.fire.call(d,n,e.values[r],t);null==n&&null!=a&&(n=a,e.keys[r]=n,i.outbound||T(e.values[r],i.keyPath,n))}else{const i=Rn(u,e.values[r]),a=o.fire.call(d,i,n,u,t);if(a){const t=e.values[r];Object.keys(a).forEach((e=>{l(t,e)?t[e]=a[e]:T(t,e,a[e])}))}}return d}));return n.mutate(e).then((({failures:t,results:n,numFailures:i,lastResult:a})=>{for(let i=0;i<r.length;++i){const a=n?n[i]:r[i],s=u[i];null==a?s.onerror&&s.onerror(t[i]):s.onsuccess&&s.onsuccess("put"===e.type&&c[i]?e.values[i]:a)}return{failures:t,results:n,numFailures:i,lastResult:a}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,r){return n.query({trans:e,values:!1,query:{index:i,range:t},limit:r}).then((({result:n})=>c({type:"delete",keys:n,trans:e}).then((i=>i.numFailures>0?Promise.reject(i.failures[0]):n.length<r?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:n[n.length-1],lowerOpen:!0},r)))))}}};return r}})};function On(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const i=[];for(let r=0,a=0;r<t.keys.length&&a<e.length;++r)0===Lt(t.keys[r],e[a])&&(i.push(n?R(t.values[r]):t.values[r]),++a);return i.length===e.length?i:null}catch(e){return null}}const In={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=On(e.keys,e.trans._cache,"clone"===e.cache);return t?Ie.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?R(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Pn(e){return!("from"in e)}const Dn=function(e,t){if(!this){const t=new Dn;return e&&"d"in e&&s(t,e),t}s(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Ln(e,t,n){const i=Lt(t,n);if(isNaN(i))return;if(i>0)throw RangeError();if(Pn(e))return s(e,{from:t,to:n,d:1});const r=e.l,a=e.r;if(Lt(n,e.from)<0)return r?Ln(r,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Bn(e);if(Lt(t,e.to)>0)return a?Ln(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Bn(e);Lt(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),Lt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;r&&!e.l&&qn(e,r),a&&o&&qn(e,a)}function qn(e,t){Pn(t)||function e(t,{from:n,to:i,l:r,r:a}){Ln(t,n,i),r&&e(t,r),a&&e(t,a)}(e,t)}function $n(e,t){const n=jn(t);let i=n.next();if(i.done)return!1;let r=i.value;const a=jn(e);let s=a.next(r.from),o=s.value;for(;!i.done&&!s.done;){if(Lt(o.from,r.to)<=0&&Lt(o.to,r.from)>=0)return!0;Lt(r.from,o.from)<0?r=(i=n.next(o.from)).value:o=(s=a.next(r.from)).value}return!1}function jn(e){let t=Pn(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Lt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Lt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Bn(e){var t,n;const i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),r=i>1?"r":i<-1?"l":"";if(r){const t="r"===r?"l":"r",n={...e},i=e[r];e.from=i.from,e.to=i.to,e[r]=i[r],n[r]=i[t],e[t]=n,n.d=Un(n)}e.d=Un(e)}function Un({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}u(Dn.prototype,{add(e){return qn(this,e),this},addKey(e){return Ln(this,e,e),this},addKeys(e){return e.forEach((e=>Ln(this,e,e))),this},[P](){return jn(this)}});const Vn={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Dn(e.MIN_KEY,e.MAX_KEY);return{...e,table:i=>{const s=e.table(i),{schema:o}=s,{primaryKey:c}=o,{extractKey:l,outbound:u}=c,d={...s,mutate:e=>{const r=e.trans,c=r.mutatedParts||(r.mutatedParts={}),l=e=>{const n=`idb://${t}/${i}/${e}`;return c[n]||(c[n]=new Dn)},u=l(""),d=l(":dels"),{type:h}=e;let[p,m]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const f=e.trans._cache;return s.mutate(e).then((e=>{if(a(p)){"delete"!==h&&(p=e.results),u.addKeys(p);const t=On(p,f);t||"add"===h||d.addKeys(p),(t||m)&&function(e,t,n,i){t.indexes.forEach((function(t){const r=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&a(e)?e.forEach((e=>r.addKey(e))):r.addKey(e);(n||i).forEach(((e,t)=>{const r=n&&s(n[t]),a=i&&s(i[t]);0!==Lt(r,a)&&(null!=r&&o(r),null!=a&&o(a))}))}))}(l,o,t,m)}else if(p){const e={from:p.lower,to:p.upper};d.add(e),u.add(e)}else u.add(n),d.add(n),o.indexes.forEach((e=>l(e.name).add(n)));return e}))}},h=({query:{index:t,range:n}})=>{var i,r;return[t,new Dn(null!==(i=n.lower)&&void 0!==i?i:e.MIN_KEY,null!==(r=n.upper)&&void 0!==r?r:e.MAX_KEY)]},p={get:e=>[c,new Dn(e.key)],getMany:e=>[c,(new Dn).addKeys(e.keys)],count:h,query:h,openCursor:h};return r(p).forEach((e=>{d[e]=function(r){const{subscr:a}=Me;if(a){const o=e=>{const n=`idb://${t}/${i}/${e}`;return a[n]||(a[n]=new Dn)},c=o(""),d=o(":dels"),[h,m]=p[e](r);if(o(h.name||"").add(m),!h.isPrimaryKey){if("count"!==e){const t="query"===e&&u&&r.values&&s.query({...r,values:!1});return s[e].apply(this,arguments).then((n=>{if("query"===e){if(u&&r.values)return t.then((({result:e})=>(c.addKeys(e),n)));const e=r.values?n.result.map(l):n.result;r.values?c.addKeys(e):d.addKeys(e)}else if("openCursor"===e){const e=n,t=r.values;return e&&Object.create(e,{key:{get:()=>(d.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return d.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return n}))}d.add(n)}}return s[e].apply(this,arguments)}})),d}}}};class Fn{constructor(e,t){this._middlewares={},this.verno=0;const n=Fn.dependencies;this._options=t={addons:Fn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;r.dbReadyPromise=new Ie((e=>{r.dbReadyResolve=e})),r.openCanceller=new Ie(((e,t)=>{r.cancelOpen=t})),this._state=r,this.name=e,this.on=xt(this,"populate","blocked","versionchange","close",{ready:[de,ie]}),this.on.ready.subscribe=b(this.on.ready.subscribe,(e=>(t,n)=>{Fn.vip((()=>{const i=this._state;if(i.openComplete)i.dbOpenError||Ie.resolve().then(t),n&&e(t);else if(i.onReadyBeingFired)i.onReadyBeingFired.push(t),n&&e(t);else{e(t);const i=this;n||e((function e(){i.on.ready.unsubscribe(t),i.on.ready.unsubscribe(e)}))}}))})),this.Collection=(a=this,Ct(jt.prototype,(function(e,t){this.db=a;let n=Nt,i=null;if(t)try{n=t()}catch(e){i=e}const r=e._ctx,s=r.table,o=s.hook.reading.fire;this._ctx={table:s,index:r.index,isPrimKey:!r.index||s.schema.primKey.keyPath&&r.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:r.or,valueMapper:o!==re?o:null}}))),this.Table=function(e){return Ct(St.prototype,(function(t,n,i){this.db=e,this._tx=i,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:xt(null,{creating:[oe,ie],reading:[ae,re],updating:[le,ie],deleting:[ce,ie]})}))}(this),this.Transaction=function(e){return Ct(Zt.prototype,(function(t,n,i,r,a){this.db=e,this.mode=t,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=xt(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),mt(e)}))}))}(this),this.Version=function(e){return Ct(_n.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Ct(Gt.prototype,(function(t,n,i){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:i};const r=e._deps.indexedDB;if(!r)throw new ee.MissingAPI;this._cmp=this._ascending=r.cmp.bind(r),this._descending=(e,t)=>r.cmp(t,e),this._max=(e,t)=>r.cmp(e,t)>0?e:t,this._min=(e,t)=>r.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=rn(t.IDBKeyRange),this._createTransaction=(e,t,n,i)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,i),this._fireOnBlocked=e=>{this.on("blocked").fire(e),bt.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Mn),this.use(kn),this.use(Vn),this.use(In),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(pn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Me.letThrough||this._vip)?e():new Ie(((e,t)=>{if(this._state.openComplete)return t(new ee.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new ee.DatabaseClosed);this.open().catch(ie)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:i}){i&&this.unuse({stack:e,name:i});const r=this._middlewares[e]||(this._middlewares[e]=[]);return r.push({stack:e,create:t,level:null==n?10:n,name:i}),r.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?mt(t.dbOpenError):e));j&&(t.openCanceller._stackHolder=F()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const i=t.openCanceller;function a(){if(t.openCanceller!==i)throw new ee.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,c=!1;return Ie.race([i,("undefined"==typeof navigator?Ie.resolve():Nn()).then((()=>new Ie(((i,s)=>{if(a(),!n)throw new ee.MissingAPI;const l=e.name,u=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!u)throw new ee.MissingAPI;u.onerror=Yt(s),u.onblocked=ze(e._fireOnBlocked),u.onupgradeneeded=ze((i=>{if(o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=Jt,o.abort(),u.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=ze((()=>{s(new ee.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=Yt(s);var r=i.oldVersion>Math.pow(2,62)?0:i.oldVersion;c=r<1,e._novip.idbdb=u.result,mn(e,r/10,o,s)}}),s),u.onsuccess=ze((()=>{o=null;const n=e._novip.idbdb=u.result,a=g(n.objectStoreNames);if(a.length>0)try{const i=n.transaction(1===(s=a).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const i=e._dbSchema=bn(0,t,n);e._storeNames=g(t.objectStoreNames,0),dn(e,[e._allTables],r(i),i)}(e,n,i):(wn(e,e._dbSchema,i),function(e,t){const n=fn(bn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,i)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),un(e,i)}catch(e){}var s;bt.push(e),n.onversionchange=ze((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=ze((t=>{e.on("close").fire(t)})),c&&function({indexedDB:e,IDBKeyRange:t},n){!En(e)&&"__dbnames"!==n&&vn(e,t).put({name:n}).catch(ie)}(e._deps,l),i()}),s)}))))]).then((()=>(a(),t.onReadyBeingFired=[],Ie.resolve(Tn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let i=t.onReadyBeingFired.reduce(de,ie);return t.onReadyBeingFired=[],Ie.resolve(Tn((()=>i(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{o&&o.abort()}catch(e){}return i===t.openCanceller&&e._close(),mt(n)})).finally((()=>{t.openComplete=!0,s()}))}(this)}_close(){const e=this._state,t=bt.indexOf(this);if(t>=0&&bt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ie((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ie(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new ee.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ie(((n,i)=>{const r=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=ze((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!En(e)&&"__dbnames"!==n&&vn(e,t).delete(n).catch(ie)}(this._deps,this.name),n()})),e.onerror=Yt(i),e.onblocked=this._fireOnBlocked};if(e)throw new ee.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(r):r()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return r(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Sn.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let i=Me.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);const r=-1!==e.indexOf("?");let a,s;e=e.replace("!","").replace("?","");try{if(s=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)a="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new ee.InvalidArgument("Invalid transaction mode: "+e);a="readwrite"}if(i){if("readonly"===i.mode&&"readwrite"===a){if(!r)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach((e=>{if(i&&-1===i.storeNames.indexOf(e)){if(!r)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),r&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,((t,n)=>{n(e)})):mt(e)}const o=xn.bind(null,this,a,s,i,n);return i?i._promise(a,o,"lock"):Me.trans?lt(Me.transless,(()=>this._whenReady(o))):this._whenReady(o)}table(e){if(!l(this._allTables,e))throw new ee.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Kn="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Wn{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[Kn](){return this}}function Hn(e,t){return r(t).forEach((n=>{qn(e[n]||(e[n]=new Dn),t[n])})),e}function Qn(e){return new Wn((t=>{const n=$(e);let i=!1,a={},s={};const o={get closed(){return i},unsubscribe:()=>{i=!0,Xt.storagemutated.unsubscribe(d)}};t.start&&t.start(o);let c=!1,l=!1;function u(){return r(s).some((e=>a[e]&&$n(a[e],s[e])))}const d=e=>{Hn(a,e),u()&&h()},h=()=>{if(c||i)return;a={};const r={},p=function(t){n&&nt();const i=()=>tt(e,{subscr:t,trans:null}),r=Me.trans?lt(Me.transless,i):i();return n&&r.then(it,it),r}(r);l||(Xt("storagemutated",d),l=!0),c=!0,Promise.resolve(p).then((e=>{c=!1,i||(u()?h():(a={},s=r,t.next&&t.next(e)))}),(e=>{c=!1,t.error&&t.error(e),o.unsubscribe()}))};return h(),o}))}let zn;try{zn={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(i){zn={indexedDB:null,IDBKeyRange:null}}const Gn=Fn;function Yn(e){let t=Jn;try{Jn=!0,Xt.storagemutated.fire(e)}finally{Jn=t}}u(Gn,{...ne,delete:e=>new Gn(e,{addons:[]}).delete(),exists:e=>new Gn(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return En(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):vn(e,t).toCollection().primaryKeys()}(Gn.dependencies).then(e)}catch(e){return mt(new ee.MissingAPI)}},defineClass:()=>function(e){s(this,e)},ignoreTransaction:e=>Me.trans?lt(Me.transless,e):e(),vip:Tn,async:function(e){return function(){try{var t=An(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ie.resolve(t)}catch(e){return mt(e)}}},spawn:function(e,t,n){try{var i=An(e.apply(n,t||[]));return i&&"function"==typeof i.then?i:Ie.resolve(i)}catch(e){return mt(e)}},currentTransaction:{get:()=>Me.trans||null},waitFor:function(e,t){const n=Ie.resolve("function"==typeof e?Gn.ignoreTransaction(e):e).timeout(t||6e4);return Me.trans?Me.trans.waitFor(n):n},Promise:Ie,debug:{get:()=>j,set:e=>{B(e,"dexie"===e?()=>!0:Et)}},derive:p,extend:s,props:u,override:b,Events:xt,on:Xt,liveQuery:Qn,extendObservabilitySet:Hn,getByKeyPath:E,setByKeyPath:T,delByKeyPath:function(e,t){"string"==typeof t?T(e,t,void 0):"length"in t&&[].map.call(t,(function(t){T(e,t,void 0)}))},shallowClone:N,deepClone:R,getObjectDiff:Rn,cmp:Lt,asap:_,minKey:-1/0,addons:[],connections:bt,errnames:X,dependencies:zn,semVer:"3.2.2",version:"3.2.2".split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),Gn.maxKey=rn(Gn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Xt("storagemutated",(e=>{if(!Jn){let t;wt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Jn=!0,dispatchEvent(t),Jn=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Jn||Yn(e)})));let Jn=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");Xt("storagemutated",(t=>{Jn||e.postMessage(t)})),e.onmessage=e=>{e.data&&Yn(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Xt("storagemutated",(e=>{try{Jn||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Yn(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Yn(e.changedParts)}))}Ie.rejectionMapper=function(e,t){if(!e||e instanceof z||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&h(n,"stack",{get:function(){return this.inner.stack}}),n},B(j,Et)},68839:(e,t,n)=>{"use strict";n.d(t,{P2:()=>r});var i=n(61075);function r(e,t,{blocked:n,upgrade:r,blocking:a,terminated:s}={}){const o=indexedDB.open(e,t),c=(0,i.w)(o);return r&&o.addEventListener("upgradeneeded",(e=>{r((0,i.w)(o.result),e.oldVersion,e.newVersion,(0,i.w)(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),c.then((e=>{s&&e.addEventListener("close",(()=>s())),a&&e.addEventListener("versionchange",(e=>a(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),c}const a=["get","getKey","getAll","getAllKeys","count"],s=["put","add","delete","clear"],o=new Map;function c(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(o.get(t))return o.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=s.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!a.includes(n))return;const c=async function(e,...t){const a=this.transaction(e,r?"readwrite":"readonly");let s=a.store;return i&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),r&&a.done]))[0]};return o.set(t,c),c}(0,i.r)((e=>({...e,get:(t,n,i)=>c(t,n)||e.get(t,n,i),has:(t,n)=>!!c(t,n)||e.has(t,n)})))},61075:(e,t,n)=>{"use strict";n.d(t,{r:()=>h,w:()=>f});const i=(e,t)=>t.some((t=>e instanceof t));let r,a;const s=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function h(e){d=e(d)}function p(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),f(s.get(this))}:function(...t){return f(e.apply(y(this),t))}:function(t,...n){const i=e.call(y(this),t,...n);return c.set(i,t.sort?t.sort():[t]),f(i)}}function m(e){return"function"==typeof e?p(e):(e instanceof IDBTransaction&&function(e){if(o.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",a),e.removeEventListener("abort",a)},r=()=>{t(),i()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",a),e.addEventListener("abort",a)}));o.set(e,t)}(e),i(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",a)},r=()=>{t(f(e.result)),i()},a=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&s.set(t,e)})).catch((()=>{})),u.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=m(e);return t!==e&&(l.set(e,t),u.set(t,e)),t}const y=e=>u.get(e)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e=n(2719);new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked");const t=new Error("request for lock canceled");var i=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((i=i.apply(e,t||[])).next())}))};class r{constructor(e,n=t){if(this._maxConcurrency=e,this._cancelError=n,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){const e=this.isLocked(),t=new Promise(((e,t)=>this._queue.push({resolve:e,reject:t})));return e||this._dispatch(),t}runExclusive(e){return i(this,void 0,void 0,(function*(){const[t,n]=yield this.acquire();try{return yield e(t)}finally{n()}}))}waitForUnlock(){return i(this,void 0,void 0,(function*(){if(!this.isLocked())return Promise.resolve();return new Promise((e=>this._waiters.push({resolve:e})))}))}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){const e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach((e=>e.reject(this._cancelError))),this._queue=[]}_dispatch(){const e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach((e=>e.resolve())),this._waiters=[]}}var a=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((i=i.apply(e,t||[])).next())}))};class s{constructor(e){this._semaphore=new r(1,e)}acquire(){return a(this,void 0,void 0,(function*(){const[,e]=yield this._semaphore.acquire();return e}))}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}}function o(e,t=!1){let n="";try{n=new URL(e).hostname.toLocaleLowerCase(),t&&(n=n.replace(/^www\./,""))}catch{n=""}return n}var c=n(34767),l=n(55452);const u="web3.reject_deprecated_method";const d="ETHEREUM_CHAIN",h="ETH";const p={kill_windows_passkey_explainer:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_verify_address_tray:{android:!1,ios:!1,web:!0,extension:!0},kill_tba_sell:{android:!1,ios:!1,web:!0,extension:!0},kill_switch_to_scw_v2:{android:!1,ios:!1,web:!1,extension:!1},kill_switch_to_ext_v2:{android:!1,ios:!1,web:!1,extension:!1},kill_user_interests_quiz:{android:!1,ios:!1,extension:!0,web:!0},kill_asset_details_watch_button:{android:!1,ios:!1,extension:!1,web:!0},kill_txhistory_service_v3_network_base_sepolia:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_holesky:{rn:!1,extension:!1,web:!1},kill_scw_add_sub_account_creation:{android:!1,ios:!1,web:!1,extension:!1},kill_scw_connect_as_sub_account:{web:!1,android:!1,ios:!1,extension:!1},kill_txhistory_service_v3_network_sepolia:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_optimism_sepolia:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_ftm_testnet:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_polygon_testnet:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_arbitrum_sepolia:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_avax_fuji:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_bnb_testnet:{rn:!0,extension:!1,web:!1},kill_txhistory_service_v3_network_lordchain_testnet:{rn:!0,extension:!0,web:!0},kill_txhistory_service_v3_network_sandbox_testnet:{rn:!0,extension:!0,web:!0},kill_txhistory_service_v3_network_metacade_testnet:{rn:!0,extension:!0,web:!0},kill_nft_nux_v2:{ios:!0,android:!0,web:!0,extension:!0},kill_nft_ticketing:{ios:!0,android:!0,web:!0,extension:!0},kill_global_trays_on_qr_code_scan:{ios:!0,android:!0,web:!0,extension:!0},kill_top_up_for_all_supported_assets:{ios:!0,android:!0,web:!0,extension:!0},kill_handle_wallet_not_found_error:{ios:!1,android:!1,web:!0,extension:!0},kill_dynamic_send_via_link_adp_banner:{ios:!1,android:!1,web:!0,extension:!0},kill_dynamic_send_via_link:{ios:!1,android:!1,web:!0,extension:!0},kill_send_via_link_qr_code:{ios:!1,android:!1,web:!0,extension:!0},kill_send_flow_pfp:{ios:!1,android:!1,web:!1,extension:!0},kill_send_confirmation_gasless_upsell:{android:!1,ios:!1,web:!0,extension:!0},kill_send_success_gasless_upsell:{android:!1,ios:!1,web:!0,extension:!0},kill_address_book_send:{ios:!1,android:!1,web:!0,extension:!0},kill_send_predictive_search:{android:!1,ios:!1,web:!1,extension:!0},kill_search_receive_asset:{rn:!1,web:!0,extension:!0},kill_edit_qr_code:{ios:!1,android:!1,web:!0,extension:!0},kill_standardized_qr_codes:{ios:!1,android:!1,web:!0,extension:!0},kill_receive_wallet_group_infos:{ios:!1,android:!1,web:!0,extension:!0},enable_address_observability:{ios:!1,android:!1,web:!1,extension:!1},kill_dapp_profile_page:{rn:!0,extension:!0,web:!1},kill_private_key_import:{ios:!0,android:!0,web:!0,extension:!0},kill_profile:{rn:!1,web:!0,extension:!0},kill_sprig:{rn:!1,web:!1,extension:!0},kill_defi_tab:{rn:!1,extension:!1,web:!0},kill_defi_protocol_assets:{rn:!1,extension:!1,web:!1},kill_cross_chain_swap:{extension:!1,web:!1,ios:!1,android:!1},kill_watchlist:{rn:!1,extension:!1,web:!0},kill_attestations:{rn:!1,web:!0,extension:!0},kill_switch_profiles_balance_parity:{rn:!1,web:!0,extension:!0},kill_asset_management:{rn:!1,extension:!1,web:!0},kill_cloud_backup_trays:{rn:!1,web:!0,extension:!0},kill_cross_platform_hidden_assets:{rn:!1,extension:!1,web:!1},enable_new_settings_multi_account:{rn:!1,extension:!1,web:!1},kill_multiaccount_announcement:{ios:!1,android:!1,extension:!1,web:!0},kill_multi_wallet_assets_long_press:{rn:!1,web:!0,extension:!0},kill_mismatched_address_force_signout:{rn:!1,web:!0,extension:!0},kill_cache_retail_accounts:{ios:!1,android:!1,web:!0,extension:!0},kill_tabbar_visibility_toggle:{rn:!1,web:!0,extension:!0},kill_search_result_avatar:{rn:!1,web:!0,extension:!0},kill_coinbase_connect_wrss_sync:{ios:!1,android:!1,web:!0,extension:!0},kill_blocked_dns_screen:{ios:!1,android:!1,web:!0,extension:!0},kill_txhistory_service_v3_network_eth:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_bsc:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_ftm:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_gnosis:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_lordchain:{rn:!0,extension:!0,web:!0},kill_txhistory_service_v3_network_metacade:{rn:!0,extension:!0,web:!0},kill_txhistory_service_v3_network_polygon:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_optimism:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_arbitrum:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_avalanche_c:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_etc:{rn:!1,extension:!1,web:!1},kill_txhistory_service_sol_v3:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_base_v2:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_zetachain:{rn:!1,extension:!1,web:!1},kill_txhistory_service_v3_network_zora:{rn:!1,extension:!1,web:!1},kill_tx_history_gasless_upsell:{ios:!0,android:!0,web:!0,extension:!0},kill_address_history_transactions:{ios:!1,android:!1,extension:!1,web:!1},kill_solana_websocket_nudges:{ios:!1,android:!1,extension:!1,web:!1},kill_unsandboxed_nfts:{rn:!1,web:!0,extension:!0},kill_switch_nft_portfolio_tab:{rn:!1,extension:!1,web:!0},kill_switch_nft_offers_tab:{rn:!1,extension:!1,web:!0},kill_switch_nft_history_tab:{rn:!1,extension:!1,web:!0},kill_switch_aggregate_bids:{rn:!1,extension:!1,web:!0},kill_switch_aggregate_listings:{rn:!1,extension:!1,web:!1},kill_gnosis_poaps:{rn:!1,extension:!1,web:!1},kill_gnosis_poaps_send:{rn:!1,extension:!1,web:!0},kill_switch_recent_collectibles:{rn:!1,extension:!1,web:!0},kill_switch_accept_bids:{ios:!1,android:!1,extension:!1,web:!0},kill_nft_native_buy:{ios:!1,android:!1,extension:!1,web:!1},kill_nft_marketplace_links:{ios:!1,android:!1,extension:!1,web:!0},kill_polygon_nfts:{rn:!1,extension:!1,web:!1},kill_use_floor_price:{rn:!1,extension:!1,web:!0},kill_nft_collection_sort_by_chain:{rn:!1,extension:!1,web:!1},kill_nft_offers_alert_tray:{ios:!1,android:!1,web:!0,extension:!0},kill_nft_round_corners:{rn:!1,extension:!1,web:!1},kill_switch_nft_send:{android:!1,ios:!0,extension:!1,web:!0},kill_switch_view_solana_nft:{rn:!1,extension:!1,web:!1},kill_switch_paginated_collections:{rn:!1,extension:!1,web:!0},kill_solana_nft_refresh:{rn:!1,web:!0,extension:!0},kill_optimism_nfts:{ios:!1,android:!1,extension:!1,web:!1},kill_optimism_nfts_send:{ios:!1,android:!1,extension:!1,web:!0},kill_switch_reservoir_notification:{ios:!1,android:!1,extension:!1,web:!0},kill_base_nfts:{ios:!1,android:!1,extension:!1,web:!1},kill_base_nfts_send:{ios:!1,android:!1,extension:!1,web:!0},kill_wallet_music_nfts:{ios:!1,android:!1,web:!0,extension:!0},kill_backend_based_nft_chain_config:{ios:!1,android:!1,extension:!1,web:!1},kill_nft_pfp:{ios:!1,android:!1,extension:!1,web:!1},enable_wallet_pfp:{ios:!0,android:!0,extension:!0,web:!1},kill_nft_grid_view:{ios:!1,android:!1,extension:!1,web:!0},kill_collections_grid_view:{ios:!1,android:!1,extension:!1,web:!0},kill_switch_pending_collectible:{ios:!1,android:!1,extension:!1,web:!1},enable_nft_grid_increased_page_size:{ios:!1,android:!1,extension:!1,web:!1},enable_nft_tab_sorting:{ios:!1,android:!1,extension:!1,web:!1},kill_mesh_connect:{ios:!1,android:!1,web:!0,extension:!0},kill_nft_aggregated_oe721s:{ios:!1,android:!1,extension:!1,web:!1},kill_retail_suggested_destination:{rn:!1,web:!0,extension:!0},kill_dapp_browser_ios:{rn:!1,web:!0,extension:!0},kill_dapp_browser_android:{rn:!1,web:!0,extension:!0},kill_dapp_browser_deeplinks_ios:{rn:!1,web:!0,extension:!0},kill_dapp_browser_deeplinks_android:{rn:!1,web:!0,extension:!0},kill_dapp_lists:{ios:!1,android:!1,web:!0,extension:!0},kill_browser_tab_screenshot:{ios:!1,android:!1,web:!0,extension:!0},kill_browser_cache_clear:{ios:!1,android:!1,web:!0,extension:!0},enable_browser_loading_status_animation:{ios:!0,android:!0,web:!1,extension:!1},kill_browser_nav_redesign:{rn:!1,web:!0,extension:!0},kill_browser_mute_media_injected_js:{ios:!1,android:!1,web:!0,extension:!0},kill_browser_pull_to_refresh:{ios:!1,android:!1,web:!0,extension:!0},kill_dapp_browser_category_fetch:{ios:!1,android:!1,web:!0,extension:!0},kill_swap_ethereum:{rn:!1,extension:!1,web:!1},kill_swap_polygon:{rn:!1,extension:!1,web:!1},kill_swap_avax:{rn:!1,extension:!1,web:!1},kill_swap_solana:{rn:!1,extension:!1,web:!1},kill_swap_bsc:{rn:!1,extension:!1,web:!1},kill_swap_base:{rn:!1,extension:!1,web:!1},kill_swap_optimism:{rn:!1,extension:!1,web:!1},kill_swap:{rn:!1,extension:!1,web:!1},kill_free_usdc_swap:{rn:!1,extension:!1,web:!0},kill_private_pool:{rn:!1,extension:!1,web:!1},kill_swap_coinbase_fee:{rn:!1,extension:!1,web:!1},kill_dex_deposit_gas:{ios:!1,android:!1,extension:!1,web:!1},kill_standardize_errors_dex:{ios:!1,android:!1,extension:!1,web:!1},kill_gasless_swap_eth:{ios:!1,android:!1,extension:!1,web:!1},kill_gasless_swap_polygon:{ios:!1,android:!1,extension:!1,web:!1},kill_backend_driven_gasless_eligibility:{ios:!1,android:!1,extension:!1,web:!1},kill_adjustable_slippage:{ios:!1,android:!1,extension:!1,web:!1},kill_fiat_ui_copies:{ios:!1,android:!1,extension:!1,web:!1},kill_bridge:{rn:!1,extension:!1,web:!0},kill_real_time_send_gas_fee:{rn:!1,extension:!1,web:!0},kill_recipient_suggestions_my_addresses_tab:{rn:!1,extension:!1,web:!0},kill_recipient_suggestions_recents_tab:{rn:!0,extension:!0,web:!0},kill_warning_on_send_confirmation:{rn:!1,web:!0,extension:!0},kill_solana_transaction_priority_fee:{ios:!1,android:!1,extension:!1,web:!1},kill_send_blockchain_all:{rn:!1,extension:!1,web:!1},kill_send_blockchain_eth:{rn:!1,extension:!1,web:!1},kill_send_blockchain_sol:{rn:!1,extension:!1,web:!1},kill_send_blockchain_btc:{rn:!1,extension:!1,web:!0},kill_send_blockchain_doge:{rn:!1,extension:!1,web:!0},kill_send_blockchain_ltc:{rn:!1,extension:!1,web:!0},kill_send_network_eth:{rn:!1,extension:!1,web:!1},kill_send_network_etc:{rn:!1,extension:!1,web:!1},kill_send_network_bsc:{rn:!1,extension:!1,web:!1},kill_send_network_ftm:{rn:!1,extension:!1,web:!1},kill_send_network_gnosis:{rn:!1,extension:!1,web:!1},kill_send_network_lordchain:{rn:!1,extension:!1,web:!1},kill_send_network_metacade:{rn:!1,extension:!1,web:!1},kill_send_network_polygon:{rn:!1,extension:!1,web:!1},kill_send_network_optimism:{rn:!1,extension:!1,web:!1},kill_send_network_arbitrum:{rn:!1,extension:!1,web:!1},kill_send_network_avalanche_c:{rn:!1,extension:!1,web:!1},kill_send_network_base_v2:{rn:!1,extension:!1,web:!1},kill_send_network_zetachain:{rn:!1,extension:!1,web:!1},kill_send_network_zora:{rn:!1,extension:!1,web:!1},kill_send_network_base_sepolia:{rn:!1,extension:!1,web:!1},kill_send_network_holesky:{rn:!1,extension:!1,web:!1},kill_send_network_sepolia:{rn:!1,extension:!1,web:!1},kill_send_network_optimism_sepolia:{rn:!1,extension:!1,web:!1},kill_send_network_ftm_testnet:{rn:!1,extension:!1,web:!1},kill_send_network_polygon_testnet:{rn:!1,extension:!1,web:!1},kill_send_network_arbitrum_sepolia:{rn:!1,extension:!1,web:!1},kill_send_network_avax_fuji:{rn:!1,extension:!1,web:!1},kill_send_network_bnb_testnet:{rn:!1,extension:!1,web:!1},kill_send_network_lordchain_testnet:{rn:!1,extension:!1,web:!1},kill_send_network_sandbox_testnet:{rn:!1,extension:!1,web:!1},kill_send_network_metacade_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_all:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_eth:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_sol:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_btc:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_doge:{rn:!1,extension:!1,web:!1},kill_dapp_tx_blockchain_ltc:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_eth:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_etc:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_bsc:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_ftm:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_gnosis:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_lordchain:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_metacade:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_polygon:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_optimism:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_arbitrum:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_avalanche_c:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_base_v2:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_zetachain:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_zora:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_base_sepolia:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_holesky:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_sepolia:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_optimism_sepolia:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_ftm_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_polygon_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_arbitrum_sepolia:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_avax_fuji:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_bnb_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_lordchain_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_sandbox_testnet:{rn:!1,extension:!1,web:!1},kill_dapp_tx_network_metacade_testnet:{rn:!1,extension:!1,web:!1},kill_repair_db_with_wallets_if_needed:{ios:!1,android:!1,extension:!1,web:!1},enable_mnemonic_escape_hatch:{ios:!1,android:!1,extension:!1,web:!1},kill_repair_mnemonic_accounts:{ios:!1,android:!1,extension:!1,web:!0},kill_data_migration_runner:{rn:!1,extension:!1,web:!1},enable_mnemonic_account_consistency_check:{android:!1,ios:!1,extension:!1,web:!1},kill_show_notifications_permissions_post_onboarding:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_settings_hub_notif_optin:{ios:!1,android:!1,web:!0,extension:!0},kill_load_existing_browser_tab:{ios:!1,android:!1,web:!0,extension:!0},kill_chain_network_eth:{rn:!1,extension:!1,web:!1},kill_chain_network_polygon:{rn:!1,extension:!1,web:!1},kill_chain_network_bsc:{rn:!1,extension:!1,web:!1},kill_chain_network_ftm:{rn:!1,extension:!1,web:!1},kill_chain_network_arbitrum:{rn:!1,extension:!1,web:!1},kill_chain_network_lordchain:{rn:!1,extension:!1,web:!1},kill_chain_network_metacade:{rn:!1,extension:!1,web:!1},kill_chain_network_gnosis:{rn:!1,extension:!1,web:!1},kill_chain_network_avalanche_c:{rn:!1,extension:!1,web:!1},kill_chain_network_optimism:{rn:!1,extension:!1,web:!1},kill_chain_network_etc:{rn:!1,extension:!1,web:!1},kill_chain_network_base_v2:{rn:!1,extension:!1,web:!1},kill_chain_network_zetachain:{rn:!1,extension:!1,web:!1},kill_chain_network_zora:{rn:!1,extension:!1,web:!1},kill_chain_network_base_sepolia:{rn:!1,extension:!1,web:!1},kill_chain_network_holesky:{rn:!1,extension:!1,web:!1},kill_chain_network_sepolia:{rn:!1,extension:!1,web:!1},kill_chain_network_optimism_sepolia:{rn:!1,extension:!1,web:!1},kill_chain_network_ftm_testnet:{rn:!1,extension:!1,web:!1},kill_chain_network_polygon_testnet:{rn:!1,extension:!1,web:!1},kill_chain_network_arbitrum_sepolia:{rn:!1,extension:!1,web:!1},kill_chain_network_avax_fuji:{rn:!1,extension:!1,web:!1},kill_chain_network_bnb_testnet:{rn:!1,extension:!1,web:!1},kill_chain_network_lordchain_testnet:{rn:!1,extension:!1,web:!1},kill_chain_network_sandbox_testnet:{rn:!1,extension:!1,web:!1},kill_chain_network_metacade_testnet:{rn:!1,extension:!1,web:!1},kill_cb_one_swap_fees:{rn:!1,extension:!1,web:!0},kill_cbpay:{rn:!1,extension:!1,web:!0},enable_cbpay_sdk:{ios:!1,android:!1,web:!1,extension:!1},enable_apollo_new_cbpay_params:{rn:!1,web:!1,extension:!1},enable_add_card_header:{rn:!1,web:!1,extension:!1},kill_explore_multichain:{android:!1,ios:!1,extension:!1,web:!0},kill_explore_nft:{android:!1,ios:!1,extension:!1,web:!0},kill_explore_search:{android:!1,ios:!1,extension:!1,web:!0},kill_explore_tab:{android:!1,ios:!1,extension:!1,web:!0},kill_explore_quests:{ios:!1,android:!1,web:!0,extension:!0},kill_explore_mint_streaks:{ios:!1,android:!1,extension:!1,web:!0},kill_explore_dynamic_module:{ios:!1,android:!1,extension:!1,web:!0},kill_explore_nux_screen:{rn:!1,web:!0,extension:!0},kill_explore_minting_service_collections:{rn:!1,extension:!1,web:!0},kill_explore_mint_dot_fun_collections:{ios:!1,android:!1,extension:!1,web:!0},enable_mint_streak_collection_gtm:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_last_used_provider:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_apple_pay_card_guest_checkout:{ios:!1,android:!1,web:!1,extension:!1},enable_cbpay_provider_interstitial:{ios:!1,android:!1,web:!1,extension:!1},kill_explore_cb_nft_collections:{ios:!1,android:!1,extension:!1,web:!0},kill_explore_trending_collections_tab:{ios:!1,android:!1,extension:!1,web:!0},kill_gas_tracker:{ios:!1,android:!1,web:!0,extension:!0},kill_streaks_v2:{ios:!1,android:!1,web:!0,extension:!0},kill_stake:{ios:!1,android:!1,extension:!1,web:!1},kill_staking_top_up:{rn:!1,extension:!1,web:!1},kill_stake_multi_provider:{rn:!1,extension:!1,web:!1},kill_stake_matic:{ios:!1,android:!1,extension:!1,web:!1},kill_delegator_staking:{ios:!1,android:!1,extension:!1,web:!1},kill_earn_balance:{ios:!1,android:!1,extension:!1,web:!1},kill_switch_transaction_preview:{rn:!1,extension:!1,web:!1},kill_tx_scanner_simulation:{rn:!1,extension:!1,web:!0},kill_switch_token_approvals:{rn:!1,extension:!1,web:!0},kill_transaction_preview_solana:{ios:!1,android:!1,extension:!1,web:!1},kill_message_scan_v1:{rn:!1,extension:!1,web:!0},kill_message_scan_v2:{ios:!1,android:!1,extension:!1,web:!1},kill_message_scan_seaport_warning:{ios:!1,android:!1,extension:!1,web:!1},kill_eoa_approval_fraud_warning:{android:!1,ios:!1,extension:!1,web:!0},kill_dapp_tx_confirmation_scam_warning:{android:!1,ios:!1,extension:!1,web:!1},kill_utxo_tx_cancel:{android:!1,ios:!1,extension:!1,web:!1},kill_eth_tx_cancel:{android:!1,ios:!1,extension:!1,web:!1},kill_utxo_tx_speed_up:{android:!1,ios:!1,extension:!1,web:!1},kill_eth_tx_speed_up:{android:!1,ios:!1,extension:!1,web:!1},kill_recent_recipients_tab_v3:{ios:!1,android:!1,extension:!1,web:!1},kill_txhistory_nudge_blockchain_eth:{rn:!1,extension:!1,web:!1},kill_txhistory_nudge_blockchain_sol:{rn:!1,extension:!1,web:!1},kill_balance_nudge_blockchain_eth:{rn:!1,extension:!1,web:!1},kill_balance_nudge_blockchain_sol:{rn:!1,extension:!1,web:!1},kill_das_api_blockchain_sol:{rn:!1,extension:!1,web:!1},enable_balance_fetching_throttle:{ios:!1,android:!1,extension:!1,web:!1},kill_onramp_on_send:{rn:!1,extension:!1,web:!0},kill_onramp_on_receive:{rn:!1,extension:!1,web:!0},kill_minting_service_collections:{rn:!1,web:!0,extension:!0},kill_mint_dot_fun_collections:{ios:!1,android:!1,web:!0,extension:!0},kill_cb_nft_collections:{ios:!1,android:!1,web:!0,extension:!0},kill_trending_collections_tab:{ios:!1,android:!1,web:!0,extension:!0},kill_umo:{rn:!1,web:!0,extension:!0},kill_guest_checkout:{ios:!1,android:!1,web:!0,extension:!0},kill_unified_login:{ios:!1,android:!1,web:!0,extension:!0},kill_buy_add_payment_method:{rn:!1,web:!0,extension:!0},kill_quick_buy_eth_modal:{rn:!1,web:!0,extension:!0},kill_gasless_purchase_modal:{rn:!1,web:!0,extension:!0},kill_top_up_for_web3_transactions:{ios:!1,android:!1,web:!0,extension:!0},kill_top_up_v2:{ios:!1,android:!1,web:!0,extension:!0},kill_cbke:{ios:!1,android:!1,web:!0,extension:!0},kill_pending_asset:{rn:!1,web:!0,extension:!0},kill_usdc_rewards:{ios:!1,android:!1,web:!0,extension:!0},kill_usdc_rewards_summary:{ios:!1,android:!1,web:!0,extension:!0},kill_usdc_rewards_unenrollment_toggle:{ios:!1,android:!1,web:!0,extension:!0},kill_usdc_rewards_united_states_only:{ios:!1,android:!1,web:!0,extension:!0},kill_usdc_rewards_reconnect_banner:{ios:!1,android:!1,web:!0,extension:!0},enable_force_skip_tracking_onramp_experiment:{rn:!1,web:!1,extension:!1},enable_nux_nft_incentive_entry_modal:{ios:!1,android:!1,web:!1,extension:!1},enable_browser_nux_tray:{ios:!1,android:!1,web:!1,extension:!1},enable_base_browser_nux_tray:{ios:!1,android:!1,web:!1,extension:!1},enable_assets_tab_nux_cards:{ios:!1,android:!1,web:!1,extension:!1},enable_fund_and_swap_on_explore:{ios:!1,android:!1,web:!1,extension:!1},enable_instant_funding_flow:{ios:!1,android:!1,web:!1,extension:!1},enable_web3_starter_kit_on_asset_list:{ios:!1,android:!1,web:!1,extension:!1},enable_initialize_local_currency:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_currency_selector:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_swap_assets:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_native_buy:{ios:!1,android:!1,web:!1,extension:!1},enable_scw_onramp_native_buy:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_ocb_deeplink:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_cb_native_buy:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_unsupported_payment_method_tray:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_mgx_unconnected_state:{ios:!1,android:!1,web:!1,extension:!1},enable_onramp_confirmation_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_cb_onramp_session_token:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_cb_onramp_session_token:{ios:!1,android:!1,web:!1,extension:!1},enable_scw_magic_spend:{ios:!1,android:!1,web:!1,extension:!1},enable_nft_incentive_with_usdc:{ios:!1,android:!1,web:!1,extension:!1},kill_authenticated_webview_wsst_flow:{ios:!1,android:!1,web:!1,extension:!1},kill_blocklist_integration:{rn:!1,extension:!1,web:!0},kill_notification_settings_account_activity:{rn:!1,extension:!1,web:!0},kill_notification_settings_product_announcement:{rn:!1,extension:!1,web:!0},kill_notification_settings_promotion:{rn:!1,extension:!1,web:!0},kill_notification_settings_price_alert:{rn:!1,extension:!1,web:!0},kill_notification_settings_price_alert_btc:{rn:!1,extension:!1,web:!0},kill_notification_settings_price_alert_eth:{rn:!1,extension:!1,web:!0},kill_notification_settings_price_alert_owned:{rn:!1,extension:!1,web:!0},kill_notification_settings_price_alert_trending:{rn:!1,extension:!1,web:!0},kill_notification_settings_network_fee_alert_ethereum:{rn:!1,extension:!1,web:!0},kill_notification_settings_feature_tip:{rn:!1,extension:!1,web:!0},kill_notification_settings_trending_dapp:{rn:!1,extension:!1,web:!0},kill_notification_settings_wallet_activity:{rn:!1,extension:!1,web:!0},kill_notification_settings_nft_offers_alert:{rn:!1,extension:!1,web:!0},kill_notifications_hub_v2:{rn:!1,web:!0,extension:!0},kill_notification_settings_wallet_messaging:{rn:!1,extension:!1,web:!0},kill_notification_hub_library:{ios:!1,android:!1,web:!0,extension:!0},kill_solana_web3:{ios:!1,android:!1,extension:!1,web:!0},kill_quests:{ios:!1,android:!1,web:!0,extension:!0},kill_referral_hub:{rn:!1,web:!0,extension:!0},kill_native_sdk:{rn:!1,web:!0,extension:!0},kill_check_auth_state_and_accounts_sign_out:{ios:!1,android:!1,web:!0,extension:!0},kill_native_asset_max_button_send:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_bridge_chain_1:{android:!1,ios:!1,extension:!1,web:!0},kill_native_asset_max_button_bridge_chain_137:{android:!1,ios:!1,extension:!1,web:!0},kill_native_asset_max_button_stake_chain_1:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_1:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_137:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_56:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_43114:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_10:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_101:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_8453:{android:!1,ios:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_42161:{ios:!1,android:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_17000:{ios:!1,android:!1,extension:!1,web:!1},kill_native_asset_max_button_swap_chain_7777777:{ios:!1,android:!1,extension:!1,web:!1},kill_native_asset_max_button_bridge_chain_8453:{ios:!1,android:!1,extension:!1,web:!0},kill_native_asset_max_button_bridge_chain_10:{ios:!1,android:!1,extension:!1,web:!0},kill_native_asset_max_button_bridge_chain_42161:{ios:!1,android:!1,extension:!1,web:!0},kill_native_asset_max_button_buy:{android:!1,ios:!1,web:!0,extension:!0},kill_revoke_approvals:{rn:!1,extension:!1,web:!0},kill_subdomain_claiming:{ios:!1,android:!1,extension:!1,web:!0},enable_did_non_primary_wallets:{ios:!1,android:!1,extension:!1,web:!1},enable_export_private_key:{ios:!1,android:!1,extension:!1,web:!1},kill_create_new_mnemonic_account:{ios:!1,android:!1,extension:!1,web:!0},kill_import_new_mnemonic_account:{ios:!1,android:!1,extension:!1,web:!0},kill_error_boundary_escape_hatch:{ios:!1,android:!1,extension:!1,web:!0},kill_messaging:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_payment_request:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_attachments:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_attachment_sends:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_mute_conversation:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_subscribe:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_suggestions:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_report_wallet_address:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_address_scoring:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_chatbot_referral_processing:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_fsto:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_tab_counts:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_read_receipts:{ios:!1,android:!1,web:!0,extension:!0},kill_request_management:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_subscription_discovery:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_inbox_subscription_discovery:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_xmtp_rn_conversation_status:{ios:!1,android:!1,web:!0,extension:!0},kill_xmtp_onboarding_setup:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_xmtp_rn_sdk:{ios:!1,android:!1,web:!0,extension:!0},kill_messaging_xmtp_rn_sdk_listener_v2:{android:!1,ios:!1,web:!0,extension:!0},kill_messaging_open_frames:{ios:!1,android:!1,web:!0,extension:!0},kill_missing_mnemonic_escape_hatch:{ios:!1,android:!1,web:!0,extension:!0},kill_utxo_blockheight_syncing:{rn:!1,extension:!1,web:!0},kill_utxo_pending_tx_tray:{android:!1,ios:!1,extension:!1,web:!0},kill_pending_utxo_aware_balances:{android:!1,ios:!1,extension:!1,web:!0},kill_utxo_transaction_blockheight_syncing:{ios:!1,android:!1,extension:!1,web:!1},kill_utxo_script_from_transaction:{ios:!1,android:!1,extension:!1,web:!1},kill_utxo_replace_by_fee:{android:!1,ios:!1,web:!0,extension:!0},kill_widgets_announcement:{ios:!1,android:!1,web:!0,extension:!0},kill_web3_starter_kit:{ios:!1,android:!1,web:!0,extension:!0},kill_spam_score:{rn:!1,extension:!1,web:!1},kill_asset_metadata_v4_migration:{ios:!1,android:!1,extension:!1,web:!1},kill_switch_layout_animation:{android:!1,ios:!1,web:!0,extension:!0},kill_wallet_backfilling:{ios:!1,android:!1,extension:!1,web:!0},enable_replace_existing_wallets:{ios:!1,android:!1,web:!1,extension:!1},kill_utxo_announcement_banner:{ios:!1,android:!1,extension:!1,web:!0},kill_payments_risk_threatmetrix_config:{rn:!1,web:!0,extension:!0},kill_solarisbank_skip:{rn:!1,web:!0,extension:!0},kill_switch_sponsored_dapp:{ios:!1,android:!1,extension:!1,web:!0},kill_contentful_announcements:{ios:!1,android:!1,extension:!1,web:!0},kill_switch_onchain_summer_upcoming_drops:{ios:!1,android:!1,extension:!1,web:!0},kill_switch_onchain_summer_minting:{ios:!1,android:!1,extension:!1,web:!0},kill_explore_upcoming_drop_notification_link:{ios:!1,android:!1,web:!0,extension:!0},kill_defi_education:{ios:!1,android:!1,extension:!1,web:!0},kill_recovery_mode:{ios:!1,android:!1,web:!0,extension:!0},kill_testnet_mode_enabled:{rn:!1,extension:!1,web:!0},kill_account_backup_reminders:{ios:!1,android:!1,web:!0,extension:!0},kill_instant_onboarding_full_screen_reminder:{ios:!1,android:!1,web:!0,extension:!0},kill_translate_branch_into_static_deeplink:{ios:!0,android:!0,web:!0,extension:!0},enable_wallets_atom_debounce:{rn:!1,extension:!1,web:!1},kill_onramp_provider_tray:{ios:!1,android:!1,web:!0,extension:!0},enable_onboarding_accounts_guardrail:{android:!1,ios:!1,web:!1,extension:!1},kill_landing_accounts_guardrail:{android:!1,ios:!1,web:!0,extension:!0},kill_payments_mode:{ios:!0,android:!0,extension:!0,web:!0},kill_referral:{ios:!1,android:!1,web:!0,extension:!0},kill_address_scanner:{ios:!1,android:!1,extension:!1,web:!1},kill_instant_onboarding_did_claim_takeover:{ios:!1,android:!1,web:!0,extension:!0},kill_upsell_announcement_banner:{ios:!1,android:!1,extension:!0,web:!0},kill_rp_secure_indicator:{ios:!1,android:!1,web:!0,extension:!0},kill_guided_import_paths:{ios:!1,android:!1,web:!0,extension:!0},kill_skip_restore_wallet:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_group_balances:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_extension_promotion_announcement:{ios:!1,android:!1,web:!0,extension:!0},kill_base_rebrand_takeover:{ios:!1,android:!1,web:!0,extension:!0},kill_fe_tracing:{ios:!1,android:!1,extension:!1,web:!1},kill_offline_notification:{rn:!1,web:!0,extension:!0},kill_switch_explore_partner_drops:{ios:!1,android:!1,web:!0,extension:!0},enable_cashout:{ios:!1,android:!1,web:!1,extension:!1},enable_cashout_international_mvp:{ios:!1,android:!1,web:!1,extension:!1},kill_cashout_asset_details:{ios:!1,android:!1,web:!0,extension:!0},kill_sponsored_cashout:{ios:!1,android:!1,web:!1,extension:!1},kill_sponsored_cashout_scw:{ios:!1,android:!1,web:!1,extension:!1},kill_delete_invalid_accounts_recovery:{ios:!1,android:!1,extension:!1,web:!0},kill_account_limit_increase:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_group_limit_increase:{ios:!1,android:!1,extension:!1,web:!1},kill_test_kill_switch:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_global_search:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_global_search_using_nlp:{ios:!1,android:!1,web:!1,extension:!0},kill_wallet_global_search_using_social:{ios:!1,android:!1,web:!1,extension:!1},kill_wallet_global_search_using_nft:{ios:!1,android:!1,web:!1,extension:!1},kill_wallet_global_search_recent_searches:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_global_search_settings:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_global_search_typeahead_search:{ios:!1,android:!1,web:!1,extension:!0},kill_wallet_global_search_using_wac:{ios:!1,android:!1,web:!1,extension:!0},kill_receive:{ios:!1,android:!1,web:!1,extension:!1},kill_send_nft:{ios:!1,android:!1,web:!1,extension:!1},kill_wallet_app_architecture:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_app_architecture_messaging:{ios:!0,android:!0,web:!0,extension:!0},kill_wallet_locale_setting:{ios:!1,android:!1,web:!0,extension:!0},kill_walletlink_gns_migration:{ios:!1,android:!1,web:!0,extension:!0},kill_hide_profile_assets:{ios:!1,android:!1,web:!0,extension:!0},kill_user_events_action_service:{ios:!1,android:!1,web:!0,extension:!0},kill_txn_complete_notif_optin:{ios:!1,android:!1,extension:!1,web:!1},kill_coin_tracker_promo:{ios:!1,android:!1,extension:!1,web:!1},kill_crypto_tax_calculator_promo:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_provider_coinbase_wallet:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_provider_phantom:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_provider_walletconnect:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_provider_mipd:{ios:!1,android:!1,extension:!1,web:!1},kill_native_storage_logging:{ios:!1,android:!1,web:!0,extension:!0},kill_auth_gate_root_stack:{android:!1,ios:!1,extension:!1,web:!0},kill_exchange_rate_override:{ios:!1,android:!1,extension:!0,web:!1},kill_test_switch_wallet:{extension:!1,web:!0,rn:!0},kill_ledger_onboarding:{web:!0,extension:!0,rn:!0},kill_announcement_banner:{extension:!1,web:!0,rn:!0},kill_switch_aggregate_bids_ext:{web:!0,extension:!0,rn:!0},kill_solana_nft_refresh_ext:{web:!0,extension:!0,rn:!0},kill_adjustable_miner_fee:{extension:!1,web:!0,rn:!0},kill_cb_generic_sign_and_submit:{extension:!1,web:!0,rn:!0},kill_delete_accounts_with_no_mnemonic:{extension:!1,web:!0,rn:!0},kill_explore_cta_tray:{extension:!0,web:!0,rn:!0},kill_community_tab:{extension:!1,web:!0,rn:!0},kill_switch_transaction_preview_native_send:{extension:!1,web:!0,rn:!0},kill_notifications_hub:{extension:!1,web:!0,rn:!0},kill_solana_web3_provider:{extension:!1,web:!0,rn:!0},kill_testnet_faucet:{extension:!1,web:!0,rn:!0},kill_testnet_faucet_bridge:{extension:!1,web:!0,rn:!0},kill_testnet_tab:{extension:!1,web:!0,rn:!0},utxo_cancel_bip_125:{extension:!1,web:!1,rn:!1},kill_permissions_prompt:{extension:!1,web:!0,rn:!0},kill_dapp_linkout_v2:{extension:!1,web:!0,rn:!0},kill_display_cbpay_buy_button_navbar:{web:!1,extension:!0,rn:!0},kill_native_asset_max_button_swap_chain_250:{web:!1,extension:!0,rn:!0},kill_native_asset_max_button_swap_chain_11155111:{web:!1,extension:!0,rn:!0},enable_eth_denver_2024:{web:!1,extension:!1,rn:!1},kill_send_network_base:{web:!1,extension:!0,rn:!0},kill_scw:{web:!1,extension:!0,rn:!0},kill_scw_magic_link:{web:!1,extension:!0,rn:!0},enable_scw_spend_permissions:{web:!1,extension:!1,ios:!1,android:!1},enable_scw_iframe_buy:{web:!1,extension:!1,rn:!1},kill_txn_link_form:{web:!1,extension:!0,rn:!0},kill_txn_link_whatsabi:{web:!1,extension:!0,rn:!0},kill_scw_magic_spend:{web:!1,extension:!0,rn:!0},kill_scw_magic_spend_2fa:{web:!1,extension:!0,rn:!0},enable_scw_usdc_magic_spend:{web:!1,extension:!1,rn:!1},kill_scw_magic_spend_v2:{web:!1,extension:!1,rn:!1},kill_scw_mainnet_chains:{web:!1,extension:!0,ios:!1,android:!1},kill_scw_display_cbpay_buy_button_navbar:{web:!1,extension:!0,rn:!0},kill_scw_swap:{web:!1,extension:!0,rn:!0},kill_scw_send_blockchain_all:{web:!1,extension:!0,rn:!0},kill_scw_add_wallet:{web:!1,extension:!0,rn:!0},kill_scw_sign_in_with_ethereum_auth:{web:!0,extension:!0,rn:!0},enable_scw_onboarding_fund_wallet:{web:!1,extension:!1,rn:!1},enable_did_non_primary:{web:!1,extension:!1,rn:!1},kill_wallet:{web:!1,extension:!0,rn:!0},kill_dapps_page:{web:!1,extension:!0,rn:!0},kill_global_search:{web:!1,extension:!0,rn:!0},kill_referral_claim_cta:{web:!0,extension:!0,ios:!0,android:!0},kill_swap_asset_ribbon:{ios:!1,android:!1,web:!1,extension:!1},kill_swap_share_card:{ios:!1,android:!1,web:!1,extension:!1},kill_mnemonic_salt_recovery:{ios:!1,android:!1,web:!0,extension:!0},kill_walletlink_onboarding:{rn:!0,web:!0,extension:!1},kill_wallet_redesign_payments_tab:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_redesign_browser_trending_dapps:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_redesign_top_level_messaging_tab:{android:!1,ios:!1,web:!0,extension:!0},kill_wallet_redesign_miami_vice_theme_colors:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_redesign_miami_vice:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_redesign_fsto:{android:!1,ios:!1,web:!0,extension:!0},kill_wallet_redesign_miami_button:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_redesign_transactions_tab:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_view_profile:{android:!1,ios:!1,web:!0,extension:!0},kill_wallet_redesign_avatars:{android:!1,ios:!1,web:!1,extension:!0},kill_wallet_hide_no_quote_with_low_balance:{android:!1,ios:!1,web:!1,extension:!1},kill_wallet_swap_prioritize_base_wallet:{android:!1,ios:!1,web:!1,extension:!0},kill_dapp_assets_crypto_tab:{rn:!0,extension:!0,web:!1},kill_dapp_assets_nft_tab:{rn:!0,extension:!0,web:!0},kill_dapp_assets_defi_tab:{rn:!0,extension:!0,web:!1},kill_dapp_assets_transactions_tab:{rn:!0,extension:!0,web:!1},kill_dapp_assets_creations_tab:{rn:!0,extension:!0,web:!0},kill_scw_recovery:{rn:!1,extension:!1,web:!1},kill_scw_recovery_promotional_banner:{rn:!1,extension:!1,web:!1},kill_scw_auto_switch_payment_method:{rn:!1,extension:!1,web:!1},kill_drops_page:{ios:!1,android:!1,web:!1,extension:!1},kill_social_native_mint:{ios:!0,android:!0,web:!1,extension:!0},kill_social_mint_explore:{ios:!0,android:!0,web:!0,extension:!0},kill_social_page:{ios:!1,android:!1,web:!1,extension:!1},enable_scw_buy_button:{ios:!1,android:!1,extension:!1,web:!1},kill_filter_poisonous_transactions:{ios:!1,android:!1,extension:!1,web:!1},kill_dapp_datadog_synthetics_page:{web:!1,extension:!0,rn:!0},enable_address_poisoning_check:{ios:!1,android:!1,extension:!1,web:!1},enable_alternate_address_poisoning_check:{ios:!1,android:!1,extension:!1,web:!1},kill_connect_to_coinbase:{ios:!1,android:!1,extension:!1,web:!1},kill_send_spam_token_warning:{ios:!1,android:!1,extension:!1,web:!1},kill_dapp_mint_reservoir:{ios:!1,android:!1,extension:!1,web:!1},kill_dapp_mint_native:{ios:!1,android:!1,extension:!1,web:!1},kill_wallet_tab_long_press:{ios:!1,android:!1,extension:!0,web:!0},kill_dapp_assets_filters_revamp:{ios:!1,android:!1,extension:!1,web:!1},kill_add_fund_web3_starter_kit_action:{ios:!1,android:!1,web:!1,extension:!1},kill_ocs_coffee_days:{ios:!1,android:!1,web:!1,extension:!1},kill_tron_usdt_receive:{ios:!0,android:!0,web:!0,extension:!0},kill_explore_pages:{ios:!1,android:!1,web:!0,extension:!1},kill_one_product_shop:{ios:!1,android:!1,web:!1,extension:!1},kill_social_feed:{ios:!1,android:!1,web:!1,extension:!1},kill_explore_on_home_redesign:{ios:!1,android:!1,web:!1,extension:!1},kill_watchlist_notif_opt_in:{ios:!1,android:!1,web:!0,extension:!0},kill_add_to_watchlist_tray:{ios:!1,android:!1,web:!0,extension:!0},enable_preference_all_smart_wallet:{ios:!1,android:!1,web:!0,extension:!1},kill_scw_chain_arbitrum:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_avalanche:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_base:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_bsc:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_lordchain:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_metacade:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_mainnet:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_optimism:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_polygon:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_chain_zora:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_app_paymasters:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_cloud_paymasters:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_sepolia_paymaster:{ios:!1,android:!1,web:!1,extension:!1},kill_warm_welcome:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_onboarding:{ios:!1,android:!1,web:!1,extension:!1},kill_warn_sends_to_known_contracts:{ios:!1,android:!1,web:!1,extension:!1},enable_wallet_tap_to_pay_v2:{ios:!1,android:!1,web:!1,extension:!1},enable_wallet_tap_to_pay_v2_merchant:{ios:!1,android:!1,web:!1,extension:!1},enable_wallet_tap_to_pay_v2_customer:{ios:!1,android:!1,web:!1,extension:!1},enable_legacy_blink_tray:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_extension_option:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_walletlink_option:{ios:!1,android:!1,web:!1,extension:!1},kill_import_mnemonic_warning:{ios:!1,android:!1,web:!1,extension:!1},kill_adp_actions_new_layout:{ios:!1,android:!1,web:!1,extension:!1},kill_mint_by_credit_card:{ios:!1,android:!1,web:!1,extension:!1},kill_assets_percentage_change:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_replays:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_retries:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_webauthn_p256_registration:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_skip_transaction_confirmation:{ios:!1,android:!1,web:!1,extension:!1},kill_gallery_page:{ios:!1,android:!1,web:!0,extension:!1},kill_create_gallery:{ios:!0,android:!0,web:!0,extension:!0},kill_gallery_creations_tab:{ios:!0,android:!0,web:!0,extension:!0},kill_mev_protection:{ios:!1,android:!1,web:!0,extension:!0},kill_app_mode_notification_preferences:{ios:!1,android:!1,web:!0,extension:!0},kill_simple_mode_notifications:{rn:!1,web:!0,extension:!0},enable_wallet_card:{ios:!1,android:!1,web:!1,extension:!1},kill_explore_search_refresh:{ios:!1,android:!1,web:!1,extension:!1},kill_ripio_payment_method_screen_upsell:{ios:!1,android:!1,web:!0,extension:!0},enable_deeplinks_v2_delegation:{ios:!1,android:!1,web:!1,extension:!1},kill_pano_svl_receive:{ios:!0,android:!0,web:!1,extension:!1},kill_send_recipient_display_my_address_as_address:{ios:!0,android:!0,web:!1,extension:!0},kill_scw_rn_import:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_rn_multi_account:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_rn_create:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_rn_deeplink_override_create:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_rn_deeplink_override_import:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_rn_deeplink_override_cdi:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_rn_payments:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_rn_send_user_op_service:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_cross_device_import:{ios:!1,android:!1,web:!1,extension:!0},kill_scw_import_gtm_banner:{ios:!0,android:!0,web:!1,extension:!1},kill_usd_van_accounts:{ios:!1,android:!1,web:!0,extension:!0},kill_usd_van_accounts_us:{ios:!1,android:!1,web:!0,extension:!0},kill_usd_van_accounts_global:{ios:!1,android:!1,web:!0,extension:!0},kill_usd_van_accounts_microdeposits:{ios:!1,android:!1,web:!0,extension:!0},kill_tx_confirmation_rearchitecture_swap:{ios:!1,android:!1,web:!0,extension:!0},enable_walletlink_modal_v2:{ios:!1,android:!1,web:!1,extension:!1},kill_pano_swap_disconnected_state:{ios:!1,android:!1,web:!1,extension:!1},kill_tx_confirmation_rearchitecture_bridge:{ios:!1,android:!1,web:!1,extension:!1},kill_cashout_erc20_to_ach:{ios:!1,android:!1,web:!1,extension:!1},kill_swap_fee:{ios:!1,android:!1,web:!1,extension:!1},kill_wallets_rn_filter_network:{ios:!1,android:!1,web:!0,extension:!0},kill_wallets_intuitive_import:{ios:!1,android:!1,web:!0,extension:!0},kill_wallet_atom_debounce_2:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_share_user_id_with_pano:{ios:!1,android:!1,web:!1,extension:!1},kill_mint_feed:{ios:!1,android:!1,web:!1,extension:!1},kill_mint_feed_on_explore:{ios:!1,android:!1,web:!1,extension:!1},kill_social_trending_swap:{ios:!1,android:!1,web:!1,extension:!1},kill_social_video_feed:{ios:!1,android:!1,web:!1,extension:!1},kill_social_video_feed_comments_tray:{ios:!1,android:!1,web:!1,extension:!1},kill_social_video_feed_inline_comments:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_social_create_composer_actions:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_create_add_photo:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_create_add_camera:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_jit_social_onboarding:{ios:!1,android:!1,web:!1,extension:!1},kill_social_basename_override:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_stub_toasts:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_profile:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_rainbow_pull_to_refresh:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_transact_request_tap_to_pay:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_browser_rainbow_pull_to_refresh:{ios:!1,android:!1,web:!1,extension:!1},kill_composer_actions:{ios:!1,android:!1,web:!1,extension:!1},kill_social_trending_mint:{ios:!1,android:!1,web:!1,extension:!1},kill_ocs_coming_soon:{ios:!1,android:!1,web:!1,extension:!1},kill_introducing_smart_wallet_mint:{ios:!1,android:!1,web:!1,extension:!1},kill_notification_settings_personalization:{rn:!1,extension:!1,web:!0},kill_cross_chain_swap_bridge_redirect:{ios:!0,android:!0,web:!1,extension:!1},kill_wallet_hide_unhide_assets:{ios:!1,android:!1,web:!1,extension:!1},kill_cross_chain_swap_slippage:{ios:!0,android:!0,web:!0,extension:!0},kill_signout_flow_v2:{ios:!1,android:!1,web:!0,extension:!0},kill_error_fallback_v2:{ios:!1,android:!1,web:!0,extension:!0},kill_linkdrop_unstable_version:{ios:!1,android:!1,web:!0,extension:!0},kill_defi_tab_all_networks_rn:{ios:!1,android:!1,web:!0,extension:!0},kill_trading_activity_adp:{ios:!1,android:!1,web:!1,extension:!1},kill_sync_secrets_storage:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_txl_full_screen_disclaimer:{ios:!1,android:!1,web:!1,extension:!1},kill_real_time_swap_sends:{ios:!1,android:!1,web:!0,extension:!0},kill_real_time_swap_sends_pay_with_usdc:{ios:!1,android:!1,web:!0,extension:!0},kill_extension_slimming:{ios:!1,android:!1,web:!1,extension:!1},kill_extension_slimming_tx_history_link_dapp:{ios:!1,android:!1,web:!1,extension:!1},kill_extension_slimming_swap_link_dapp:{ios:!1,android:!1,web:!1,extension:!1},kill_extension_slimming_send_link_dapp:{ios:!0,android:!0,web:!0,extension:!0},kill_extension_slimming_nfts_link_dapp:{ios:!0,android:!0,web:!0,extension:!0},kill_extension_slimming_defi_link_dapp:{ios:!0,android:!0,web:!0,extension:!0},kill_social_frames:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_mini_app_inline_actions:{ios:!0,android:!0,web:!0,extension:!0},kill_social_create_account:{ios:!1,android:!1,web:!1,extension:!1},kill_social_connect_account:{ios:!1,android:!1,web:!1,extension:!1},kill_social_create_post:{ios:!1,android:!1,web:!1,extension:!1},kill_social_channels:{ios:!1,android:!1,web:!1,extension:!1},kill_social_profiles:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_profile_social_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_rn_adp_redesign:{ios:!1,android:!1,web:!1,extension:!1},kill_swap_sweepstakes:{ios:!0,android:!0,web:!1,extension:!0},enable_card_verification_graphql_migration:{ios:!0,android:!0,web:!1,extension:!1},enable_runtime_translations:{ios:!0,android:!0,web:!1,extension:!1},enable_send_flow_degradation_banner:{ios:!1,android:!1,web:!1,extension:!1},enable_send_request:{ios:!0,android:!0,web:!1,extension:!1},enable_tba_adp_share:{ios:!1,android:!1,web:!1,extension:!1},kill_magic_spend_swap:{ios:!0,android:!0,web:!1,extension:!0},kill_recovery_phrase_warning:{ios:!0,android:!0,web:!0,extension:!0},kill_scw_rn_eip_5792:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_rn_replays:{ios:!1,android:!1,web:!0,extension:!0},kill_scw_rn_replay_retries:{ios:!1,android:!1,web:!0,extension:!0},kill_ota_foreground_check:{ios:!1,android:!1,web:!1,extension:!1},kill_ota_foreground_apply:{ios:!1,android:!1,web:!1,extension:!1},kill_tx_confirmation_redesign_web3:{ios:!1,android:!1,web:!0,extension:!0},kill_auto_app_reset:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_grant_permission_new_design_nov_2024:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_simplified_tx_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_static_analysis_routing:{ios:!1,android:!1,web:!1,extension:!1},enable_cb_autoconnect:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_data_suffix:{ios:!1,android:!1,web:!1,extension:!1},enable_l1_high_fee_warning:{web:!1,rn:!1,extension:!1},kill_tokenforge_v2:{web:!1,rn:!1,extension:!1},kill_token_hub:{ios:!0,android:!0,web:!0,extension:!0},kill_scw_universal_erc20_paymaster:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_guest_checkout_magic_spend:{ios:!1,android:!1,web:!1,extension:!1},kill_sign_message_redesign:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_linked_accounts:{ios:!0,android:!0,web:!0,extension:!0},kill_scw_wallet_connect:{ios:!0,android:!0,web:!0,extension:!0},kill_messaging_v2_sunset:{ios:!1,android:!1,web:!1,extension:!1},kill_pricecharts_v4:{ios:!1,android:!1,web:!1,extension:!1},kill_quotes_v3:{ios:!1,android:!1,web:!1,extension:!1},enable_walletlink_deprecation_modal:{ios:!1,android:!1,web:!1,extension:!1},kill_walletlink_go_back_to_browser_tray:{ios:!1,android:!0,web:!0,extension:!0},kill_walletlink_redirect_after_completion:{ios:!0,android:!1,web:!0,extension:!0},kill_scw_prepare_calls_integration:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_user_profiles:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_data_callback:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_base_pay_magic_spend:{ios:!1,android:!1,web:!1,extension:!1},kill_points_system:{ios:!1,android:!1,web:!1,extension:!1},kill_global_search_on_wallet_tab:{ios:!0,android:!1,web:!1,extension:!1},kill_points_deprecation_banner:{ios:!1,android:!1,web:!0,extension:!1},kill_balance_nudge_portfolio_service_api:{ios:!1,android:!1,web:!1,extension:!1},enable_notification_hub_tabs:{ios:!1,android:!1,web:!1,extension:!1},kill_messaging_tba_attachments:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_chat_invite_links:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_chat_swipe_to_reply:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_messaging_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_messaging_search:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_following_list:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_sync_follow_status:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_auto_approve_followed_users:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_auto_approve_invite_links:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_inbox_profile_search:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_messaging_mentions:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_messaging_social_share:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_messaging_bot_discovery:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_chat_spam_scores:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_chat_theming:{ios:!1,android:!1,web:!1,extension:!1},kill_app_mode_switch_warm_welcome_animation:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_mode_toggle:{ios:!1,android:!1,web:!1,extension:!1},kill_eoa_upgrade:{android:!0,ios:!0,web:!0,extension:!0},kill_tba_onboarding_user_interests_quiz:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_low_priority_settings:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_blocklist:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_blocklist_caching:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_blocklist_run_before_render:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_wsst_gql_mutation:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_buy:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_balance_live_ticker:{ios:!1,android:!1,web:!1,extension:!1},kill_social_share:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_wallet_sign:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_spindl_spotlight:{ios:!1,android:!1,web:!1,extension:!1},kill_spindl_spotlight_aspect_ratio:{ios:!0,android:!0,web:!0,extension:!0},kill_composer_actions_deeplinks:{ios:!1,android:!1,web:!1,extension:!1},kill_nft_legacy:{ios:!0,android:!1,web:!1,extension:!1},kill_nft_legacy_prime:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_tap_to_pay:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_send_via_link:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_send:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_legacy_gns_token_registration:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_social_coin_feed:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_receive:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_receive_qr_code:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_receive_qr_code_scan:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_send_to_phone_contacts:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_web3_connectivity:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_frame_connectivity:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_swap:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_swap_shows_quote:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_cross_chain_swap:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_edit_profile:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_social_notifications:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_transact_tab:{ios:!1,android:!1,web:!0,extension:!0},enable_platform_nfc_override:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_transact_request_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_transact_request_tab_navbar:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_transact_send_tab:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_transact_trending_coins_preload:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_trending_tokens_filters:{ios:!0,android:!0,web:!1,extension:!1},enable_tba_token_top_holders:{ios:!0,android:!0,web:!1,extension:!1},enable_tba_wallet_tab_preload:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_apps_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_coining_education_tray:{ios:!1,android:!1,web:!0,extension:!0},enable_tba_social_connect_to_zora_tray:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_profile_header_zora_tag:{ios:!1,android:!1,web:!0,extension:!0},enable_tba_apps_home_tab:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_featured_apps_by_category:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_feed_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_notifications_tab:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_notifications_nav_bar:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_social_cast_details:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_featured_apps:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_apps_tab_chat:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_trending_mini_apps:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_app_categories:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_apps_balance_widget:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_frame_actions_ready:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_set_primary_button:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_add_mini_app:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_view_profile:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_open_url:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_open_mini_app:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_view_token:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_send_token:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_actions_swap_token:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frames_siwf:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frames_siwf_blindsign:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_frame_camera_and_microphone_access:{android:!1,ios:!1,web:!1,extension:!1},kill_scw_open_in_chrome:{ios:!1,android:!1,web:!1,extension:!1},kill_send_confirmation_allow_tipping:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_cloudinary_video_upload:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_pinata_video_upload:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_rebrand:{ios:!0,android:!0,web:!1,extension:!1},kill_send_via_link_contacts_sync_nux:{ios:!0,android:!0,web:!0,extension:!0},kill_base_account_apps:{ios:!0,android:!0,web:!1,extension:!0},kill_connected_apps_tab:{ios:!0,android:!0,web:!0,extension:!0},kill_connected_app_crypto_tab:{ios:!0,android:!0,web:!1,extension:!0},kill_connected_app_nft_tab:{ios:!0,android:!0,web:!1,extension:!0},kill_connected_app_spend_limit_tab:{ios:!0,android:!0,web:!1,extension:!0},kill_connected_app_signers_tab:{ios:!0,android:!0,web:!1,extension:!0},kill_new_tx_history:{ios:!0,android:!0,web:!0,extension:!0},kill_social_connect_account_banner:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_connect_account:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_general_feedback:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_social_create_account:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_blind_signing:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_social_coining_v2:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_stablecoin_rewards:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_stablecoin_rewards_projection:{ios:!1,android:!1,extension:!1,web:!1},kill_tba_pinata_processing_delay:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_social_large_file_upload:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_sliding_button:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_social_incentives_ui:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_apps_videos_widget:{ios:!1,android:!1,web:!1,extension:!1},kill_wallet_send_calls_messages:{ios:!1,android:!1,web:!1,extension:!1},kill_transaction_reference_messages:{ios:!1,android:!1,web:!1,extension:!1},kill_quick_actions_messages:{ios:!0,android:!0,web:!0,extension:!0},kill_intent_messages:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_chat_markdown_messages:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_transact_tap_to_pay:{ios:!1,android:!0,web:!1,extension:!1},enable_tba_transact_sell:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_transact_sell_to_coins:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_points:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_points_intent:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_theme_selector:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_theme_editor:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_custom_theme:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_theme_preview_screens:{ios:!1,android:!1,web:!1,extension:!1},enable_scw_local_signer_creation:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_local_signer_usage:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_notification_settings:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_trade_settings:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_notification_request_banner:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_notifications_v2:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_mini_app_notifications:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_app_icon_switching:{ios:!1,android:!1,web:!1,extension:!1},kill_ticker_cast_embed:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_24h_total_price_change:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_your_apps_nux:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_your_apps_browser:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_search_tab_v2:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_mini_app_entrypoints:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_prefetching:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_quotes_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_mentions_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_replies_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_recasts_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_likes_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_social_follows_notification:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_feed_user_profile_link:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_link:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_messaging_profile_button:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_recent_searches_profile:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_searches_profile:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_messaging_mention_message:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_frame_profile_tray_profile_button:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_cast:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_notifications_navigation_icon:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_wallet_navigation_icon:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_feed_navigation_icon:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_transact_navigation_icon:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_transact_trade_button:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_trade_from_asset_selector:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_trade_from_payment_selector:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_buy_payment_asset_list_selector:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_messaging_navigation_icon:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_global_search_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_wallet_screen_cash_section_header:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_wallet_screen_coins_section_header:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_wallet_screen_activity_list_item:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_trending_tokens_filter:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_asset_top_holders_see_more:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_asset_detail_top_holders_preview:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_tabs_social_posts:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_tabs_social_replies:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_tabs_social_likes:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_tabs_assets:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_subtabs_assets_coins:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_profile_subtabs_assets_collected:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_search_screen_browse_button:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_prefetching_component_debug_search_tab_cell:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_prefetching_target_social_cast_details:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_social_connections_followers:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_create_cast_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_notifications_social_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_wallet_init_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_feed_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_trade_from_asset_list:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_buy_payment_method_list:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_trade_to_asset_list:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_messaging_inbox_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_messaging_identities_batch_prefetch:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_recent_searches_content:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_crypto_list_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_activity_details_screen:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_trending_tokens_list:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_all_holders_tray:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_social_posts:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_social_replies:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_social_likes:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_assets_coins:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_simplified_assets_coins:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_assets_collected:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_screen_header_theming:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_quick_trade_posts:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_transact_svl_nfc_write:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_sybil_turnstile:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_minimum_version_enforcement:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_adp_prefetch_query:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_component_trade_to_asset_selector:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_basepay_onramp:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_sponsored_fee_hidden:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_memory_efficient_video_player:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_messaging_store_text_metadata:{ios:!1,android:!1,web:!0,extension:!0},kill_chat_privacy_settings:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_invite:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_invite_ga:{ios:!0,android:!0,web:!0,extension:!0},kill_hide_price_in_swap:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_repurpose:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_pix_qr_code:{android:!1,ios:!1,web:!1,extension:!1},kill_home_gab:{ios:!0,android:!0,web:!1,extension:!1},enable_homebase_share_links:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_settings_content_coin_pairing:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_settings_content_coin_pairing_cbbtc:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_settings_connect_to_zora:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_content_coin_pairing_search:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_settings_social_and_creators:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_underpriced_vgl_user_ops_flow:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_video_player_playback_caching:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_coin_optimistic_txn_success:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_dynamic_resizable_tray:{ios:!1,android:!1,extension:!1,web:!1},kill_scw_skip_syncing_for_active_signer:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_profile_edit_username:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_profile_add_basename_proof:{ios:!1,android:!1,web:!0,extension:!0},enable_tba_creator_coin_ux:{ios:!1,android:!1,web:!1,extension:!1},enable_tba_paired_token_banner:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_post_earnings_about_tray:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_rewards_earnings_nux_tray:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_dynamic_screen_tray:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_cloudinary_image_upload:{ios:!0,android:!0,web:!1,extension:!1},kill_tba_dynamic_screen_deeplinking:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_create_cast_screen_v2:{android:!1,ios:!1,web:!0,extension:!0},kill_tba_creator_rewards:{ios:!0,android:!0,web:!0,extension:!0},kill_tba_new_composer_flow:{android:!0,ios:!0,web:!0,extension:!0},kill_tba_social_multi_media_selection:{ios:!0,android:!0,web:!0,extension:!0},kill_base_pay_with_app_tray:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_scw_underpriced_vgl_user_ops_flow:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_feed_video_player_thumbnails:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_earnings_hub_v2:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_browser_fingerprinting:{web:!1,extension:!0,rn:!0},kill_tba_stealth_mode:{ios:!1,android:!1,web:!1,extension:!1},kill_tba_prefetching_target_profile_coined_posts:{android:!1,ios:!1,extension:!0,web:!0},kill_tba_prefetching_target_mini_app_store_front_screen:{ios:!1,android:!1,web:!0,extension:!0},kill_tba_prefetching_target_search_screen:{ios:!1,android:!1,web:!0,extension:!0},kill_account_wallet_auth_required:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_wallet_infinite_scroll_coins:{ios:!1,android:!1,web:!1,extension:!1},kill_scw_basepay_onboarding:{android:!1,ios:!1,web:!1,extension:!1},kill_app_resilience_education:{android:!1,ios:!1,web:!1,extension:!1},kill_tba_app_resilience_education:{android:!1,ios:!1,web:!1,extension:!1}},m={kill_sponsored_gas_send_rn2:!0,kill_sponsored_gas_send_extension2:!0,kill_experiments_local_override:!0,kill_miami_illustrations:!1,kill_switch_test:!1,enable_switch_test:!1,kill_profile_list_cell_follow_button:!1,kill_profile_follow_counts:!1,kill_profile_pfp_list_cell:!1,kill_terms_of_service_update:!1,kill_switch_eth_pow_fork_warning:!0,kill_quick_buy_eth_card:!1,kill_cbpay_buy_default_experiment:!1,kill_browser_persistent_nux_cards:!1,kill_nux_nft_incentive_retry_air_drop:!1,kill_bbml2_app_to_app_oauth2_v2:!1,kill_dapp_browser_top_dapps_solana:!1,kill_ledger_onboarding:!1,kill_switch_aggregate_bids_ext:!1,kill_solana_nft_refresh_ext:!1,kill_walletlink_link:!1},f={};for(const[e,t]of Object.entries(m))"enable_switch_test"!==e&&(f[e]=t);const y={};Object.keys(p).forEach((function(e){const t=p[e];Object.entries(t).forEach((([t,n])=>{y[`${e}_${t}`]=n}));for(const[e,t]of Object.entries(m))y[e]=t}));const g=new Set;Object.keys(y).forEach((e=>{g.add(e)}));const b={...y,...(w=y,Object.entries(w).reduce((function(e,[t,n]){const i=`${t}_prime`,r=i.startsWith("enable_")?i.replace("enable_","kill_"):i.replace("kill_","enable_");return e[i]=n,e[r]=!n,e}),{}))};var w;var _=n(69011),v=n.n(_),E=n(89150),T=n.n(E);const N=v()((function(e){return T()(e.message+e.stack).substring(0,8)}),(e=>e.message+e.stack));const A="%c Error Reporting:",S="color:red;";let x=(C=function(e){const{severity:t}=e,n=function(e){switch(e){case"debug":return console.debug;case"warning":return console.warn;default:return console.error}}(t),i="MISSING_ENV_VAR".TARGET_ENV;i&&"local"!==i?(e.stack=e.error.stack,n(JSON.stringify(e))):n(A,S,e)},e=>{let t;e instanceof Error?(t={error:e,context:"unknown",severity:"error",isHandled:!1},console.warn(A,S,"reportError called incorrectly (reportError(error) rather than reportError({error}))")):"object"==typeof e?(t=e,t.error instanceof Error||(console.warn(A,S,"reportError called incorrectly with something other than an error object",e),t.metadata={...t.metadata,originalErrorData:JSON.stringify(t.error)},t.error=new Error("Unspecified error."))):(t={error:new Error("Unspecified error."),context:"unknown",severity:"error",metadata:{originalErrorData:JSON.stringify(e)},isHandled:!1},console.warn(A,S,"reportError called incorrectly"));const{error:n}=t,i=N(n);return function(e){return!("reportError"in e)||e.reportError}(n)&&C(t,i),{errorHash:i}});var C;const M=["MISSING_INSTANCEID_SERVICE","SERVICE_NOT_AVAILABLE","TOO_MANY_REGISTRATIONS","AUTHENTICATION_FAILED","PHONE_REGISTRATION_ERROR"],R=["address/network pair not in address book","A minimum balance must remain on the Solana address.","transaction is not enabled for creation","destination wallet does not support the asset","destination wallet is not on the same network","has no permission [initiate] for entity","some or all the programIDs not in address book","address not in address book"];function k(e){try{return M.some((t=>e.error?.message?.includes(t)))||R.some((t=>e.error?.message?.includes(t)))?x({...e,severity:"warning"}):x(e)}catch(e){return console.error(A,S,"Error reporting error",e),{}}}const O=k,I="true"==="MISSING_ENV_VAR".IS_PRIME;class P{constructor(e,t,n){this.id=e,this.uuid=t,this.kind=n,this.name=[this.id,t,n].filter((e=>e)).join("_")}}var D;!function(e){e[e.LocalStorage=0]="LocalStorage",e[e.Memory=1]="Memory"}(D||(D={}));class L extends P{constructor(e,t){super(e,t,D.LocalStorage)}}function q(e){return JSON.stringify(e,((e,t)=>"bigint"==typeof t?`bigint:${t.toString()}`:t))}function $(e){return JSON.parse(e,((e,t)=>"string"==typeof t&&t.startsWith("bigint:")?BigInt(t.substr(7)):t))}class j{constructor(){this.storageScope="CBStore.plaintext"}set(e,t){if("undefined"==typeof window||void 0===window.localStorage)return;if(null==t)return void localStorage.removeItem(this.scopedKey(e.name));const n=q(t);localStorage.setItem(this.scopedKey(e.name),n)}get(e){if("undefined"==typeof window||void 0===window.localStorage)return;const t=localStorage.getItem(this.scopedKey(e.name));if(null==t)return;const n=$(t),i=j.mappedPrototypes.get(e.name);if(i){const e=Object.create(i);return Object.assign(e,n),e}return n}clear(e){if("undefined"==typeof window||void 0===window.localStorage)return;const t=this.scopedKey(""),n=[];for(let i=0;i<localStorage.length;i++){const r=localStorage.key(i);"string"!=typeof r||!r.startsWith(t)||e?.exceptions&&!this.shouldKeyBeCleared(r,e.exceptions)||n.push(r)}n.forEach((e=>localStorage.removeItem(e)))}scopedKey(e){return`${this.storageScope}:${e}`}shouldKeyBeCleared(e,t){for(const n of t)if(this.scopedKey(n.name)===e)return!1;return!0}}j.mappedPrototypes=new Map;class B{constructor(){this.storage=new Map}set(e,t){this.storage.set(e.name,t)}get(e){return this.storage.get(e.name)}clear(){this.storage.clear()}}const U=new class{constructor(){this.localStorage=new j,this.memoryStorage=new B,this.isOpen=!0}open(){this.isOpen=!0}set(e,t){this.isOpen&&this.storageForKey(e).set(e,t)}get(e){return this.storageForKey(e).get(e)}has(e){const t=this.get(e);return null!=t}clear(e){this.isOpen=!1,this.deleteAllEntries([D.LocalStorage,D.Memory],e)}deleteAllEntries(e,t){e.forEach((e=>{e===D.LocalStorage&&this.localStorage.clear(t),e===D.Memory&&this.memoryStorage.clear()}))}storageForKey(e){switch(e.kind){case D.LocalStorage:return this.localStorage;case D.Memory:return this.memoryStorage;default:throw new Error("Switch statements must be exhaustive")}}},V=new L("userId");c.TT.ios,c.TT.android,c.TT.extension,c.TT.web;let F;function K(){if(!F)throw new Error("cb-wallet-data initialization error: setApplicationMetadata must be called prior to getApplicationMetadata.");return F}const W=new L("accessToken"),H=new L("refreshToken");let Q;async function z(e){const t=U.get(H);if(!t)throw new Error("Attempted to refresh access token without a refresh token. This can't work.");let n;try{return Q||(Q=async function(e){const{result:t}=await Ae("refreshAccessToken",{refreshToken:e});return t}(t)),n=await Q,e(n),n.token}finally{Q=void 0}}Number.MAX_SAFE_INTEGER;const G=new class{constructor(){this.getRetailAccessToken=void 0,this.refreshRetailAccessToken=void 0}getWalletAccessToken(){return U.get(W)}async refreshWalletAccessToken(e){return z(e)}async getAuthedHeaders({withRetailToken:e=!1,withXCbwAuthorizationHeader:t=!1}={}){const{platform:n}=K(),i=this.getWalletAccessToken(),r={Authorization:`Bearer ${i}`};if(t&&(r["X-Cbw-Authorization"]=`Bearer ${i}`),e&&n!==c.TT.web){const e=await(this.getRetailAccessToken?.());if(!e)throw new Error("Failed to get retail access token.");r.Authorization=`Bearer ${e}`}return r}async refreshAccessTokens({onRefreshWalletAccessToken:e,shouldRefreshWalletAccessToken:t=!0}){t?await this.refreshWalletAccessToken(e):await(this.refreshRetailAccessToken?.())}};let Y=new AbortController;if("MISSING_ENV_VAR".IS_PRIME&&!"MISSING_ENV_VAR".PRIME_BASE_URL)throw new Error("Missing ENV var: PRIME_BASE_URL");const J="https://api.wallet.coinbase.com",X="https://wallet-api-dev.cbhq.net",Z="MISSING_ENV_VAR".CB_WALLET_CHAIN_PROXY_URL??"https://chain-proxy.wallet.coinbase.com",ee="MISSING_ENV_VAR".ONRAMP_API_URL??"https://onramp.wallet.coinbase.com",te="MISSING_ENV_VAR".ONRAMP_API_URL??"https://onramp-api-dev.cbhq.net",ne="MISSING_ENV_VAR".ONRAMP_API_LOCAL_URL,ie="MISSING_ENV_VAR".OFFRAMP_API_URL??"https://offramp.wallet.coinbase.com",re="MISSING_ENV_VAR".OFFRAMP_API_URL??"https://offramp-wallet-dev.cbhq.net",ae="MISSING_ENV_VAR".OFFRAMP_LOCAL_API,se="MISSING_ENV_VAR".RPC_REDIRECT_API_URL??"https://rpc.wallet.coinbase.com",oe="MISSING_ENV_VAR".RPC_REDIRECT_API_DEV_URL??"https://rpc-redirect-jsonrpc-dev.cbhq.net:8080",ce="MISSING_ENV_VAR".RPC_REDIRECT_API_LOCAL_URL??"https://rpc-redirect-jsonrpc-dev.cbhq.net:8080",le="MISSING_ENV_VAR".TARGET_ENV?.includes("e2e")??!1,ue=le&&!"MISSING_ENV_VAR".TARGET_ENV?.includes("extension"),de=Object.freeze({CB_WALLET_API:{production:J,staging:J,development:X,local:null},ONRAMP_API:{production:ee,staging:ee,development:te,local:ne},OFFRAMP_API:{production:ie,staging:ie,development:re,local:ae},RPC_REDIRECT_API:{production:se,staging:se,development:oe,local:ce}}),he=["ONRAMP_API","OFFRAMP_API"];function pe(){const{platform:e}=K();return e===c.TT.extension?"production":e===c.TT.web?"MISSING_ENV_VAR".RELEASE_STAGE??"MISSING_ENV_VAR".NEXT_PUBLIC_RELEASE_STAGE??"local":"MISSING_ENV_VAR".RELEASE_STAGE??"development"}const me=new L("baseUrl");class fe extends Error{constructor(e,t,n,i,r,a,s){super(n),this.status=e,this.code=t,this.message=n,this.description=i,this.errorDetail=r,this.endpoint=a,this.errorData=s}}class ye extends Error{constructor(e,t){super(e),this.message=e,this.endpoint=t}}const ge=.01;function be(e){if(!function(e=ge){return Math.random()<=e}())return null;const t=Date.now(),{version:n}=K();return(0,c.br)({name:"network_request",resource:(i=e,i.replace(/\?.*$/,"")),start:t,meta:{version:n??"0.0.0"}});var i}const we=new L("chaosTestingServiceGroups"),_e={header:{}},ve=new L("chaosTestingProviderGroups");async function Ee(e,t,n){const{method:i,authenticated:r,retried:a,apiVersion:s=2,isThirdParty:o=!1,service:l="rpc",forceDevEnvironment:u,walletApi:d="CB_WALLET_API",withRetailToken:h=!1}=n,{version:p,platform:m,appsFlyerAppID:f}=K(),y=U.get(we)||"",g=U.get(ve)||"",b=function(e,t){const{platform:n}=K(),i=pe();let r=t||"CB_WALLET_API"===e&&U.get(me)===X?"development":"production";return("local"===i||"localhost"===i)&&n===c.TT.web&&he.includes(e)&&(r="local"),de[e][r]}(d,u),w=o?new URL(e):new URL(`${b}/${l}/v${s}/${e}`);"OFFRAMP_API"===d&&(w.pathname=`/${l}/${e}`),"GET"===i&&t&&(w.search=t);const _=w.toString().replace(/\/$/,""),v=r?await G.getAuthedHeaders({withRetailToken:h,withXCbwAuthorizationHeader:he.includes(d)}):null,E=be(e),T={Accept:"application/json",...n.skipBlockingHeaders?{}:{"X-App-Version":p??"","X-Platform-Name":m??"","X-Appsflyer-Id":f??""},...v,...r&&I?_e.header:null,...n.additionalHeaders,...y?{"X-Cb-Egw-Simulate-Killswitch":y.replace(/, *$/,"")}:null,...g?{"X-Cb-Egw-Simulate-Killswitch-Downstream":g.replace(/, *$/,"")}:null,...(0,c.DD)(),...(N=E,N?(0,c.Po)(N):{})};var N;const A=["POST","DELETE"].includes(i)?{method:i,body:t}:null,S={headers:T,signal:Y.signal,...A};let x;try{x=await fetch(_,S)}catch(t){if(t instanceof Error)throw new ye(t.message,e);throw t}if(x.status>=400){if(r&&401===x.status&&!a){const i=x.headers.get("www-authenticate"),r=!he.includes(d)||!!i?.includes("coinbase-wallet");return await G.refreshAccessTokens({onRefreshWalletAccessToken:n.setAuthTokens,shouldRefreshWalletAccessToken:r}),Ee(e,t,{...n,retried:!0})}await async function(e){let t;try{const n=await e.json();t="message"in n?{...n,code:"code"in n?String(n.code):""}:n.error}catch{throw new fe(e.status,"",`Failed to parse network response from ${e.url}. The status code is ${e.status}`,void 0,void 0,e.url)}throw new fe(e.status,t?.code,t?.message??t?.error,t?.description,t?.errorDetail??t?.details,e.url,t?.data)}(x)}let C=null;return n.isTextResponse&&x.ok?C=await x.text():x.ok&&(C=await x.json()),function(e,t={}){var n;if(e)try{const i=Date.now();(0,c.om)([e],{duration:i-(n=e.start,Math.ceil(n/1e6)),...t})}catch(e){reportError(e)}}(E,{error:Number(Boolean(x.status>=400))}),{status:x.status,body:C,headers:Object.fromEntries(x.headers?.entries()??[])}}async function Te(e,t,n){const i=U.get(V);return Ee(e,t,{...n,additionalHeaders:{"Content-Type":"application/json",...n.skipBlockingHeaders?{}:{"X-Wallet-User-Id":i},...n.skipBlockingHeaders?{}:{"X-Release-Stage":pe()},...n.additionalHeaders??{},...n.walletAccountType?{"X-Wallet-Account-Type":n.walletAccountType}:{}}})}async function Ne(e,t,{returnHeaders:n,...i}){const r=(a=t,0===Object.keys(a).length?void 0:JSON.stringify(t,Se));var a;const s=await Te(e,r,i);return n?s:s.body}async function Ae(e,t,n){return Ne(e,t,{method:"POST",...n})}function Se(e,t){return"bigint"==typeof t?t.toString():t}var xe;!function(e){e.SERVICE_WORKER="SERVICE_WORKER",e.EXTENSION_REQUEST="EXTENSION_REQUEST",e.DAPP_BROWSER="DAPP_BROWSER",e.MOBILE_SDK="MOBILE_SDK",e.SCW="SCW",e.PANORAMA_DAPP="PANORAMA_DAPP",e.BLINK="BLINK"}(xe||(xe={}));async function Ce({domains:e},t){const n=Array.from(new Set(e.map((e=>e.replace("www.",""))))),i=(new Date).getTime();let r,a=0;try{!function({requestSource:e,dappUrl:t}){(0,l.Np)("blocklist.fetch_start",{dappUrl:t,requestSource:e}),(0,l.N8)({metricName:"blocklist.fetch_start",metricType:c.vj.count,value:1,tags:{requestSource:e??""}})}({requestSource:t,dappUrl:n[0]});const e=await Ae("blocklist",{domains:n});if(e?.result.length){const i=e.result.map((e=>e.domain));!function({dappUrl:e,requestSource:t,maliciousDomains:n}){(0,l.Np)("blocklist.malicious_domains_found",{dappUrl:e,requestSource:t,maliciousDomains:n}),(0,l.N8)({metricName:"blocklist.malicious_domains_found",metricType:c.vj.count,value:1,tags:{requestSource:t??""}})}({dappUrl:n[0],requestSource:t,maliciousDomains:i})}r=e}catch(n){n instanceof fe&&(!function({requestSource:e,dappUrl:t,errorMessage:n}){(0,l.Np)("blocklist.fetch_error",{requestSource:e,dappUrl:t,errorMessage:n}),(0,l.N8)({metricName:"blocklist.fetch_error",metricType:c.vj.count,value:1,tags:{requestSource:e??""}})}({requestSource:t}),O({error:new Error("Blocklist API is not fetching data"),context:"http_error",metadata:{domains:e,status:n.status},severity:"error",isHandled:!1}))}a=(new Date).getTime();return a-i>750&&function({requestSource:e}){(0,l.N8)({metricName:"blocklist.fetch_timeout",metricType:c.vj.count,value:1,tags:{requestSource:e??""}})}({requestSource:t}),r}var Me=n(14041),Re=n(86125);n(31085);function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Pe=function(e){return e.unknown="unknown",e.web="web",e.android="android",e.ios="ios",e.mobile_web="mobile_web",e.tablet_web="tablet_web",e.server="server",e.windows="windows",e.macos="macos",e.extension="extension",e}({}),De=function(e){return e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram",e}({});const Le={default:{disabled:!1,serviceUrl:"",scope:"",platform:Pe.unknown,version:""}},qe={default:{}};function $e(e,t){if(!t)return e;let n=!1;return Object.keys(e).forEach((i=>{void 0!==t[i]&&e[i]!==t[i]?(e[i]=t[i],n=!0):void 0===t[i]&&(e[i]&&(n=!0),e[i]=!1)})),n?Oe({},e):e}async function je(e){const t=e??{},n=t.optionalScope,i=t.optionalKillSwitchUrl,r=t.optionalApiParams,a=n??"default";try{const e={scope:n?Le[n].scope:Le.default.scope,platform:n?Le[n].platform:Le.default.platform,version:n?Le[n].version:Le.default.version},t=(0,Re.encode)(JSON.stringify(r??e)),s=i??Le[a].serviceUrl,o=await fetch(`${s}?q=${t}`,{headers:{"Content-Type":"application/json"}}).then((async e=>e.json()));return o.killswitches?o.killswitches:null}catch(e){return e instanceof Error&&Le[a].fetchErrorHandler?.(e),null}}async function Be(e,t){const n=t.scope;if(Object.keys(qe).includes(n)){console.warn("You are initializing the kill switch package with the same scope as the prior initialization. This may cause unexpected behavior. See https://docs.cbhq.net/frontend/resilience/client-kill-switch/overview for more information.");const t=Oe(Oe({},qe[n]),e);qe[n]=Oe({},t)}else Le[n]=Oe({},t),qe[n]=Oe({},e);if(Le[n].disabled)return;const i=await je({optionalScope:n});if(Le[n].logger&&i){const e=`enable_logging_metrics_${Le[n].logger?.platform}`;Le[n].logger.enableLogging=i[e]}const r=$e(qe[n],i);if(Object.assign(qe[n],r),Le[n].logger?.enableLogging)for(const e in qe[n])if(qe[n][e]){Le[n].logger?.logMetric({metricName:"kill_switch_initialized",metricType:De.count,value:1});break}return qe[n]}async function Ue(e){return new Promise((t=>{je().then((n=>{n?.[e]&&t(!0),t(!1)}))}))}var Ve=n(52225),Fe=n.n(Ve);function Ke(e){try{return He(e)}catch(e){return{protocol:"",hostname:"",params:{},pathname:"",host:"",origin:""}}}function We(e){return e.endsWith(":")?e.substr(0,e.length-1):e}function He(e){const t=new(Fe())(e,!0);return{protocol:We(t.protocol),hostname:t.hostname,params:t.query,pathname:t.pathname,host:t.host,origin:`${t.protocol}${t.slashes?"//":""}${t.host}`}}function Qe({url:e,faviconQuality:t}){const{hostname:n,protocol:i}=Ke(e??"");return n?`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${i}://${n}&size=${t}`:void 0}var ze,Ge,Ye,Je,Xe,Ze;!function(e){e.connect="connect",e.signMessage="signMessage",e.signTransaction="signTransaction",e.signAllTransactions="signAllTransactions",e.sendTransaction="sendTransaction"}(ze||(ze={})),function(e){e.connectionSuccess="solanaConnectionSuccess",e.connectionDeny="solanaConnectionDeny",e.signMessageSuccess="signSolanaMessageSuccess",e.signMessageDeny="signSolanaMessageDeny",e.sendTransactionSuccess="sendSolanaTransactionSuccess",e.sendTransactionDeny="sendSolanaTransactionDeny",e.signTransactionSuccess="signSolanaTransactionSuccess",e.signTransactionDeny="signaSolanaTransactionDeny",e.signAllTransactionsSuccess="signAllSolanaTransactionsSuccess",e.signAllTransactionsDeny="signAllSolanaTransactionsDeny",e.parentDisconnected="parentDisconnected",e.featureFlagOff="featureFlagOff",e.web3RequestCanceled="web3RequestCanceled"}(Ge||(Ge={})),function(e){e.getAllAddresses="getAllAddresses"}(Ye||(Ye={})),function(e){e.requestEthereumAccounts="requestEthereumAccounts",e.hideRequestEthereumAccounts="hideRequestEthereumAccounts",e.switchEthereumChain="switchEthereumChain",e.addEthereumChain="addEthereumChain",e.watchAsset="watchAsset",e.selectProvider="selectProvider"}(Je||(Je={})),function(e){e.requestEthereumAccountsResponse="requestEthereumAccountsResponse",e.addEthereumChainDeny="addEthereumChainDeny",e.addEthereumChainApprove="addEthereumChainApprove",e.switchEthereumChainDeny="switchEthereumChainDeny",e.switchEthereumChainApprove="switchEthereumChainApprove",e.signEthereumMessageSuccess="signEthereumMessageSuccess",e.signEthereumTransactionSuccess="signEthereumTransactionSuccess",e.submitEthereumTransactionSuccess="submitEthereumTransactionSuccess",e.watchAssetApprove="watchAssetApprove",e.watchAssetDeny="watchAssetDeny",e.selectProviderApprove="selectProviderApprove",e.selectProviderDeny="selectProviderDeny",e.dappChainSwitched="dappChainSwitched"}(Xe||(Xe={})),function(e){e.web3RequestCanceled="web3RequestCanceled",e.parentDisconnected="parentDisconnect"}(Ze||(Ze={}));class et{constructor(e,t){this.whitelisted=e,this.internal=t||{},this.whitelistedChainIdSet=new Set(Object.values(this.whitelisted).map((e=>e.chainId.toString()))),this.internalChainIdSet=new Set(Object.values(this.internal).map((e=>e.chainId.toString()))),this.networkMap=new Map(Object.values(e).map((e=>[e.chainId.toString(),e])))}get allNetworks(){return this.networkMap}addNetwork(e,t){this.networkMap.set(e,t)}removeNetwork(e){if(this.isWhitelisted(e))throw Error("Cannot delete a whitelisted network");this.networkMap.delete(e)}removeCustomizationForWhitelisted(e){const t=Object.values(this.whitelisted).find((t=>t.chainId.toString()===e));t&&this.addNetwork(e,t)}isWhitelisted(e){return this.whitelistedChainIdSet.has(e)}isInternal(e){return this.internalChainIdSet.has(e)}isWhiteListedAndCustomized(e){if(!this.isWhitelisted(e))return!1;const t=this.fromChainId(BigInt(e)),n=Object.values(this.whitelisted).find((t=>t.chainId.toString()===e));return!t||!n||t.displayName!==n.displayName||t.rpcUrl!==n.rpcUrl||t.baseAssetCurrencyCode!==n.baseAssetCurrencyCode||t.blockExplorerUrl!==n.blockExplorerUrl}resetNetworks(){this.networkMap=new Map(Object.values(this.whitelisted).map((e=>[e.chainId.toString(),e])))}fromChainId(e){const t=e.toString();if(this.networkMap.has(t))return this.networkMap.get(t)}}const tt={...{ETHEREUM_MAINNET:{chainId:1,blockExplorerUrl:"https://etherscan.io",rpcUrl:`${Z}?targetName=ethereum-mainnet`,etherscanCompatibleTxHistoryApi:Z},OPTIMISM_MAINNET:{chainId:10,blockExplorerUrl:"https://optimistic.etherscan.io",rpcUrl:`${Z}?targetName=optimism-mainnet`,etherscanCompatibleTxHistoryApi:Z},BASE_MAINNET:{chainId:8453,blockExplorerUrl:"https://explorer.base.org",rpcUrl:`${Z}?targetName=base`,etherscanCompatibleTxHistoryApi:Z},POLYGON_MAINNET:{chainId:137,blockExplorerUrl:"https://polygonscan.com",rpcUrl:`${Z}?targetName=polygon-mainnet`,etherscanCompatibleTxHistoryApi:Z},BNB_MAINNET:{chainId:56,blockExplorerUrl:"https://bscscan.com",rpcUrl:`${Z}?targetName=bsc`,etherscanCompatibleTxHistoryApi:Z},FANTOM_MAINNET:{chainId:250,blockExplorerUrl:"https://explorer.fantom.network",rpcUrl:`${Z}?targetName=fantom`,etherscanCompatibleTxHistoryApi:Z},ARBITRUM_MAINNET:{chainId:42161,blockExplorerUrl:"https://arbiscan.io",rpcUrl:`${Z}?targetName=arbitrum`,etherscanCompatibleTxHistoryApi:Z},GNOSIS_MAINNET:{chainId:100,blockExplorerUrl:"https://blockscout.com/poa/xdai",rpcUrl:`${Z}?targetName=xdai`,etherscanCompatibleTxHistoryApi:Z},LORDCHAIN_MAINNET:{chainId:84530008,blockExplorerUrl:"https://lordchain-explorer.appchain.base.org",rpcUrl:`${Z}?targetName=lordchain`,etherscanCompatibleTxHistoryApi:"https://lordchain-explorer.appchain.base.org"},METACADE_MAINNET:{chainId:845300014,blockExplorerUrl:"https://metacade-explorer.appchain.base.org",rpcUrl:`${Z}?targetName=metacade-mainnet`,etherscanCompatibleTxHistoryApi:"https://metacade-explorer.appchain.base.org"},AVALANCHE_MAINNET:{chainId:43114,blockExplorerUrl:"https://snowtrace.io",rpcUrl:`${Z}?targetName=avalanche`,etherscanCompatibleTxHistoryApi:Z},ZETACHAIN_MAINNET:{chainId:7e3,blockExplorerUrl:"https://zetachain.blockscout.com",rpcUrl:`${Z}?targetName=zetachain-mainnet`,etherscanCompatibleTxHistoryApi:Z},ZORA_MAINNET:{chainId:7777777,blockExplorerUrl:"https://explorer.zora.energy",rpcUrl:`${Z}?targetName=zora-mainnet`,etherscanCompatibleTxHistoryApi:Z},SEPOLIA:{chainId:11155111,blockExplorerUrl:"https://sepolia.etherscan.io",rpcUrl:`${Z}?targetName=ethereum-sepolia`,etherscanCompatibleTxHistoryApi:Z},HOLESKY:{chainId:17e3,blockExplorerUrl:"https://holesky.etherscan.io",rpcUrl:`${Z}?targetName=ethereum-holesky`,etherscanCompatibleTxHistoryApi:Z},OP_SEPOLIA:{chainId:11155420,blockExplorerUrl:"https://optimism-sepolia.blockscout.com",rpcUrl:`${Z}?targetName=optimism-sepolia`,etherscanCompatibleTxHistoryApi:Z},BASE_SEPOLIA:{chainId:84532,blockExplorerUrl:"https://sepolia.basescan.org",rpcUrl:`${Z}?targetName=base-sepolia`,etherscanCompatibleTxHistoryApi:Z},BNB_TESTNET:{chainId:97,blockExplorerUrl:"https://testnet.bscscan.com",rpcUrl:`${Z}?targetName=bsc-testnet`,etherscanCompatibleTxHistoryApi:Z},FANTOM_TESTNET:{chainId:4002,blockExplorerUrl:"https://explorer.testnet.fantom.network",rpcUrl:"https://rpc.ankr.com/fantom_testnet",etherscanCompatibleTxHistoryApi:Z},ARBITRUM_SEPOLIA:{chainId:421614,blockExplorerUrl:"https://sepolia.arbiscan.io",rpcUrl:`${Z}?targetName=arbitrum-sepolia`,etherscanCompatibleTxHistoryApi:Z},AVALANCHE_FUJI:{chainId:43113,blockExplorerUrl:"https://testnet.snowtrace.io",rpcUrl:`${Z}?targetName=avalanche-fuji`,etherscanCompatibleTxHistoryApi:Z},LORDCHAIN_TESTNET:{chainId:845320008,blockExplorerUrl:"https://lordchain-explorer-testnet.appchain.base.org",rpcUrl:`${Z}?targetName=lordchain-testnet`,etherscanCompatibleTxHistoryApi:"https://lordchain-explorer-testnet.appchain.base.org"},SANDBOX_TESTNET:{chainId:8453200058,blockExplorerUrl:"https://sandbox-explorer-testnet.appchain.base.org",rpcUrl:`${Z}?targetName=sandbox-testnet`,etherscanCompatibleTxHistoryApi:"https://sandbox-explorer-testnet.appchain.base.org"},METACADE_TESTNET:{chainId:8453200014,blockExplorerUrl:"https://metacade-explorer-testnet.appchain.base.org",rpcUrl:`${Z}?targetName=metacade-testnet`,etherscanCompatibleTxHistoryApi:"https://metacade-explorer-testnet.appchain.base.org"},LOCALHOST_8545:{chainId:31337,blockExplorerUrl:"",rpcUrl:"http://127.0.0.1:8545",etherscanCompatibleTxHistoryApi:""}}},nt=Object.keys(tt).reduce(((e,t)=>(e[t]={blockExplorerUrl:`${J}/mock-block-explorer`,rpcUrl:`${J}/mock-chain-rpc`,etherscanCompatibleTxHistoryApi:`${J}/mock-etherscan-${t}`},e)),{}),it=ue?nt:tt,rt={blockchainSymbol:"ETH",isNonEthChain:!1},at={baseAssetCurrencyCode:"ZETA",baseAssetImageUrl:"https://asset-metadata-service-production.s3.amazonaws.com/asset_icons/ef9e387c9bf4354c6163feeb01183f15f362d500e6cb7b0d9a2ed3346e0256a8.png",baseAssetDisplayName:"ZETA",baseAssetDecimal:18,chainImageUrl:"https://asset-metadata-service-production.s3.amazonaws.com/asset_icons/ef9e387c9bf4354c6163feeb01183f15f362d500e6cb7b0d9a2ed3346e0256a8.png",displayName:"ZetaChain",isTestnet:!1,isLayer2:!1,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",wacNetworkId:"networks/zetachain-mainnet",chainProxyTarget:"zetachain-mainnet-etherscan",...rt,...it.ZETACHAIN_MAINNET},st={baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/chains/zora-logo.png",displayName:"Zora",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isOvmNetwork:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/zora-mainnet",chainProxyTarget:"zora-mainnet-etherscan",...rt,...it.ZORA_MAINNET},ot={baseAssetCurrencyCode:"LRDS",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/76/5e/765efd83724794e0fe44caee4cf493e2838a632124833382409a5a7e55625f8e-MDAyMWQ3MTctOWZkMC00MWE5LTgxYTMtNmU1YzE4YTA3N2Mx",baseAssetDisplayName:"LORDCHAIN",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/chains/lordchain-logo.png",displayName:"LORDCHAIN TESTNET",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isNudgeSupported:!0,wacNetworkId:"networks/lordchain-testnet",...rt,...it.LORDCHAIN_TESTNET},ct={baseAssetCurrencyCode:"LRDS",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/76/5e/765efd83724794e0fe44caee4cf493e2838a632124833382409a5a7e55625f8e-MDAyMWQ3MTctOWZkMC00MWE5LTgxYTMtNmU1YzE4YTA3N2Mx",baseAssetDisplayName:"LORDCHAIN",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/chains/lordchain-logo.png",displayName:"LORDCHAIN",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isNudgeSupported:!0,wacNetworkId:"networks/lordchain-mainnet",...rt,...it.LORDCHAIN_MAINNET},lt={baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/eth_288.png",baseAssetDisplayName:"Ether",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",displayName:"Sandbox Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isNudgeSupported:!0,wacNetworkId:"networks/sandbox-testnet",chainProxyTarget:"sandbox-testnet-explorer",...rt,...it.SANDBOX_TESTNET},ut={baseAssetCurrencyCode:"MCADE",baseAssetImageUrl:"https://go.wallet.coinbase.com/static/chains/metacade-logo.png",baseAssetDisplayName:"Metacade",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/chains/metacade-logo.png",displayName:"Metacade",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isNudgeSupported:!0,wacNetworkId:"networks/metacade-mainnet",chainProxyTarget:"metacade-mainnet-explorer",...rt,...it.METACADE_MAINNET},dt={baseAssetCurrencyCode:"MCADE",baseAssetImageUrl:"https://go.wallet.coinbase.com/static/chains/metacade-logo.png",baseAssetDisplayName:"Metacade",baseAssetDecimal:18,chainImageUrl:"https://go.wallet.coinbase.com/static/chains/metacade-logo.png",displayName:"Metacade Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isNudgeSupported:!0,wacNetworkId:"networks/metacade-testnet",chainProxyTarget:"metacade-testnet-explorer",...rt,...it.METACADE_TESTNET},ht=new et({...{ETHEREUM_MAINNET:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Ethereum",isTestnet:!1,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-mainnet",chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",chainProxyTarget:"ethereum-etherscan",...rt,...it.ETHEREUM_MAINNET},OPTIMISM_MAINNET:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"OP Mainnet",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,etherscanLikeApiKey:"3AC76IGUZCFP2ABUNPGAY8PJSPRAFJYHEF",chainImageUrl:"https://go.wallet.coinbase.com/static/assets/optimism.png",isNudgeSupported:!0,wacNetworkId:"networks/optimism-mainnet",chainProxyTarget:"optimism-etherscan",...rt,...it.OPTIMISM_MAINNET},BASE_MAINNET:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Base",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",isNudgeSupported:!0,chainProxyTarget:"basescan",wacNetworkId:"networks/base-mainnet",...rt,...it.BASE_MAINNET},POLYGON_MAINNET:{baseAssetCurrencyCode:"POL",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/b474d4bf3af389e5f26ed66956f1da8a/maticLogo.png",baseAssetDisplayName:"Polygon Ecosystem Token",baseAssetDecimal:18,displayName:"Polygon",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"N1QTECUKT25H7R5H1EGHAXUIG7SRT8BUYY",chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0_64.png",isNudgeSupported:!0,wacNetworkId:"networks/polygon-mainnet",chainProxyTarget:"polygonscan",...rt,...it.POLYGON_MAINNET},BNB_MAINNET:{baseAssetCurrencyCode:"BNB",baseAssetImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",baseAssetDisplayName:"BNB",baseAssetDecimal:18,displayName:"BNB (Binance Smart) Chain",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"T8BK2SDU3I3JXKWCFAPVRFQDHKV5MACHWC",chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/bnb_288.png",isNudgeSupported:!0,wacNetworkId:"networks/bnb-mainnet",chainProxyTarget:"bsc-bscscan",...rt,...it.BNB_MAINNET},FANTOM_MAINNET:{baseAssetCurrencyCode:"FTM",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",baseAssetDisplayName:"FTM",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",displayName:"Fantom Opera",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"33A9K22PIJJEQT28HYD7JIWQHQ7AHC1TFF",isNudgeSupported:!0,wacNetworkId:"networks/fantom-mainnet",chainProxyTarget:"fantom-ftmscan",...rt,...it.FANTOM_MAINNET},ARBITRUM_MAINNET:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Arbitrum",isTestnet:!1,isLayer2:!0,is1559Enabled:I,isCustomNetwork:!1,etherscanLikeApiKey:"8EIAPIHN5S47JM7AD65UCVPGQWGZ38G7AJ",chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/5f/45/5f45a2999ef5c8ba72fa5bc5275b38a44f196cb64fd12cd8996ae70f13a8910c-OGRkMmQyZTYtMzA1OS00OGMxLThjNWMtYjExODY5YmM2Mzhi",isNudgeSupported:!0,wacNetworkId:"networks/arbitrum-mainnet",chainProxyTarget:"arbitrum-arbiscan",...rt,...it.ARBITRUM_MAINNET},GNOSIS_MAINNET:{baseAssetCurrencyCode:"XDAI",baseAssetImageUrl:"https://static-assets.coinbase.com/wallet/assets/xdai.png",baseAssetDisplayName:"xDai",baseAssetDecimal:18,chainImageUrl:"https://dynamic-assets.coinbase.com/d1afa9a4f7ce51fa1af1ab94a15ea875a4df2b9a0b6ca619ea3de482d688198d67112c70516b703405b01d9abd5856493c238fe58004b63f4c5b5986a7624da2/asset_icons/b2e81465e2ac5d20898c4793c1c672073895ba71688ad1044a01011fe555ca88.png",displayName:"Gnosis",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"1b25e3c1-9951-4366-afc6-a6d414ecdb5e",isNudgeSupported:!0,wacNetworkId:"networks/xdai-mainnet",chainProxyTarget:"gnosis-gnosisscan",...rt,...it.GNOSIS_MAINNET},...I?{}:{LORDCHAIN_MAINNET:ct},AVALANCHE_MAINNET:{baseAssetCurrencyCode:"AVAX",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",baseAssetDisplayName:"AVAX",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",displayName:"Avalanche C-Chain",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"S1UPXSUGI2Z7TBZN2MZCMZBW2HP3DZ1B4G",isNudgeSupported:!0,wacNetworkId:"networks/avacchain-mainnet",chainProxyTarget:"avalanche-snowtrace",...rt,...it.AVALANCHE_MAINNET},...I?{}:{ZETACHAIN_MAINNET:at},...I?{}:{ZORA_MAINNET:st},...I?{}:{METACADE_MAINNET:ut},HOLESKY:{baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Holesky Ethereum",baseAssetDecimal:18,chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",displayName:"Holesky",isTestnet:!0,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-holesky-testnet",chainProxyTarget:"ethereum-holesky-etherscan",...rt,...it.HOLESKY},SEPOLIA:{baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",displayName:"Sepolia",isTestnet:!0,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-sepolia-testnet",chainProxyTarget:"ethereum-sepolia-etherscan",...rt,...it.SEPOLIA},OP_SEPOLIA:{baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,displayName:"OP Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",chainImageUrl:"https://go.wallet.coinbase.com/static/assets/optimism.png",isNudgeSupported:!0,wacNetworkId:"networks/optimism-sepolia-testnet",chainProxyTarget:"optimism-sepolia-etherscan",...rt,...it.OP_SEPOLIA},BASE_SEPOLIA:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,displayName:"Base Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",isNudgeSupported:!0,chainProxyTarget:"base-sepolia-etherscan",wacNetworkId:"networks/base-sepolia-testnet",...rt,...it.BASE_SEPOLIA},BNB_TESTNET:{baseAssetCurrencyCode:"BNB",baseAssetImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",baseAssetDisplayName:"BNB",baseAssetDecimal:18,chainImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",displayName:"BNB (Binance Smart) Chain Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"T8BK2SDU3I3JXKWCFAPVRFQDHKV5MACHWC",isNudgeSupported:!0,wacNetworkId:"networks/bnb-testnet",chainProxyTarget:"bsc-testnet-bscscan",...rt,...it.BNB_TESTNET},FANTOM_TESTNET:{baseAssetCurrencyCode:"FTM",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",baseAssetDisplayName:"FTM",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",displayName:"Fantom Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"33A9K22PIJJEQT28HYD7JIWQHQ7AHC1TFF",isNudgeSupported:!0,wacNetworkId:"networks/fantom-testnet",chainProxyTarget:"fantom-testnet-ftmscan",...rt,...it.FANTOM_TESTNET},ARBITRUM_SEPOLIA:{baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/5f/45/5f45a2999ef5c8ba72fa5bc5275b38a44f196cb64fd12cd8996ae70f13a8910c-OGRkMmQyZTYtMzA1OS00OGMxLThjNWMtYjExODY5YmM2Mzhi",displayName:"Arbitrum Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:I,isCustomNetwork:!1,etherscanLikeApiKey:"8EIAPIHN5S47JM7AD65UCVPGQWGZ38G7AJ",isNudgeSupported:!0,wacNetworkId:"networks/arbitrum-sepolia-testnet",chainProxyTarget:"arbitrum-sepolia-etherscan",...rt,...it.ARBITRUM_SEPOLIA},AVALANCHE_FUJI:{baseAssetCurrencyCode:"AVAX",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",baseAssetDisplayName:"Testnet AVAX",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",displayName:"Avalanche Fuji",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"S1UPXSUGI2Z7TBZN2MZCMZBW2HP3DZ1B4G",isNudgeSupported:!0,wacNetworkId:"networks/avacchain-fuji-testnet",chainProxyTarget:"avalanche-fuji-snowtrace",...rt,...it.AVALANCHE_FUJI},...I?{}:{LORDCHAIN_TESTNET:ot},LOCALHOST_8545:{baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",baseAssetDisplayName:"Localhost ETH",baseAssetDecimal:18,chainImageUrl:"https://d3r81g40ycuhqg.cloudfront.net/wallet/wais/07/23/0723c996feb7dc2d87bec4191b6af4721acfd4898759a1fa85686ae2d67f8982-ZTZjN2NhNjAtODI2Ni00YmU4LWI4NTgtOWNiZTUyYzQ3MDc4",displayName:"Localhost 8545",isTestnet:!0,isLayer2:!1,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"",...rt,...it.LOCALHOST_8545},...I?{}:{SANDBOX_TESTNET:lt},...I?{}:{METACADE_TESTNET:dt}}});function pt(e,t){if(e){if(!t)return e;try{const n=new URL(t).origin,i=new URL(e);return i.searchParams.append("client-project-name",n),i.toString()}catch(e){return}}}var mt=function(e,t){return mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},mt(e,t)};function ft(e,t){function n(){this.constructor=e}mt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function yt(e){return"function"==typeof e}var gt=!1,bt={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;gt=e},get useDeprecatedSynchronousErrorHandling(){return gt}};function wt(e){setTimeout((function(){throw e}),0)}var _t={closed:!0,next:function(e){},error:function(e){if(bt.useDeprecatedSynchronousErrorHandling)throw e;wt(e)},complete:function(){}},vt=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function Et(e){return null!==e&&"object"==typeof e}var Tt=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Nt=Tt,At=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,i=n._parentOrParents,r=n._ctorUnsubscribe,a=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof e)i.remove(this);else if(null!==i)for(var o=0;o<i.length;++o){i[o].remove(this)}if(yt(a)){r&&(this._unsubscribe=void 0);try{a.call(this)}catch(e){t=e instanceof Nt?St(e.errors):[e]}}if(vt(s)){o=-1;for(var c=s.length;++o<c;){var l=s[o];if(Et(l))try{l.unsubscribe()}catch(e){t=t||[],e instanceof Nt?t=t.concat(St(e.errors)):t.push(e)}}}if(t)throw new Nt(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var i=n;(n=new e)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function St(e){return e.reduce((function(e,t){return e.concat(t instanceof Nt?t.errors:t)}),[])}var xt=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Ct=function(e){function t(n,i,r){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=_t;break;case 1:if(!n){a.destination=_t;break}if("object"==typeof n){n instanceof t?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new Mt(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new Mt(a,n,i,r)}return a}return ft(t,e),t.prototype[xt]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(At),Mt=function(e){function t(t,n,i,r){var a,s=e.call(this)||this;s._parentSubscriber=t;var o=s;return yt(n)?a=n:n&&(a=n.next,i=n.error,r=n.complete,n!==_t&&(yt((o=Object.create(n)).unsubscribe)&&s.add(o.unsubscribe.bind(o)),o.unsubscribe=s.unsubscribe.bind(s))),s._context=o,s._next=a,s._error=i,s._complete=r,s}return ft(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;bt.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=bt.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):wt(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;wt(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};bt.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),bt.useDeprecatedSynchronousErrorHandling)throw e;wt(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!bt.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return bt.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(wt(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Ct);var Rt=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function kt(e){return e}function Ot(e){return 0===e.length?kt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var It=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,r=function(e,t,n){if(e){if(e instanceof Ct)return e;if(e[xt])return e[xt]()}return e||t||n?new Ct(e,t,n):new Ct(_t)}(e,t,n);if(i?r.add(i.call(r,this.source)):r.add(this.source||bt.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),bt.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){bt.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,i=t.destination,r=t.isStopped;if(n||r)return!1;e=i&&i instanceof Ct?i:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Pt(t))((function(t,i){var r;r=n.subscribe((function(t){try{e(t)}catch(e){i(e),r&&r.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Rt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Ot(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Pt(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Pt(e){if(e||(e=bt.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var Dt=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Lt=function(e){function t(t,n){var i=e.call(this)||this;return i.subject=t,i.subscriber=n,i.closed=!1,i}return ft(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(At),qt=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return ft(t,e),t}(Ct),$t=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return ft(t,e),t.prototype[xt]=function(){return new qt(this)},t.prototype.lift=function(e){var t=new jt(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Dt;if(!this.isStopped)for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new Dt;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Dt;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),i=0;i<t;i++)n[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Dt;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Dt;return this.hasError?(e.error(this.thrownError),At.EMPTY):this.isStopped?(e.complete(),At.EMPTY):(this.observers.push(e),new Lt(this,e))},t.prototype.asObservable=function(){var e=new It;return e.source=this,e},t.create=function(e,t){return new jt(e,t)},t}(It),jt=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return ft(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):At.EMPTY},t}($t),Bt=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return ft(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,i=void 0;try{this.work(e)}catch(e){n=!0,i=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return ft(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(At)),Ut=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return ft(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,i):t.flush(this)},t}(Bt),Vt=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),Ft=function(e){function t(n,i){void 0===i&&(i=Vt.now);var r=e.call(this,n,(function(){return t.delegate&&t.delegate!==r?t.delegate.now():i()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return ft(t,e),t.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,i,r):e.prototype.schedule.call(this,n,i,r)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Vt),Kt=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ft(t,e),t}(Ft))(Ut),Wt=new It((function(e){return e.complete()}));function Ht(e){return e?function(e){return new It((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Wt}var Qt,zt=function(e){return function(t){for(var n=0,i=e.length;n<i&&!t.closed;n++)t.next(e[n]);t.complete()}};function Gt(e,t){return new It((function(n){var i=new At,r=0;return i.add(t.schedule((function(){r!==e.length?(n.next(e[r++]),n.closed||i.add(this.schedule())):n.complete()}))),i}))}function Yt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,i=e[e.length-1];return(n=i)&&"function"==typeof n.schedule?(e.pop(),Gt(e,i)):function(e,t){return t?Gt(e,t):new It(zt(e))}(e)}function Jt(e){var t=e.error;e.subscriber.error(t)}Qt||(Qt={});var Xt=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return Yt(this.value);case"E":return function(e,t){return new It(t?function(n){return t.schedule(Jt,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}(this.error);case"C":return Ht()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();var Zt=function(e){function t(t,n,i){void 0===i&&(i=0);var r=e.call(this,t)||this;return r.scheduler=n,r.delay=i,r}return ft(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new en(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Xt.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Xt.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Xt.createComplete()),this.unsubscribe()},t}(Ct),en=function(){return function(e,t){this.notification=e,this.destination=t}}(),tn=function(e){function t(t,n,i){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this)||this;return r.scheduler=i,r._events=[],r._infiniteTimeWindow=!1,r._bufferSize=t<1?1:t,r._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(r._infiniteTimeWindow=!0,r.next=r.nextInfiniteTimeWindow):r.next=r.nextTimeWindow,r}return ft(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new nn(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,i=n?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,a=i.length;if(this.closed)throw new Dt;if(this.isStopped||this.hasError?t=At.EMPTY:(this.observers.push(e),t=new Lt(this,e)),r&&e.add(e=new Zt(e,r)),n)for(var s=0;s<a&&!e.closed;s++)e.next(i[s]);else for(s=0;s<a&&!e.closed;s++)e.next(i[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||Kt).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,i=this._events,r=i.length,a=0;a<r&&!(e-i[a].time<n);)a++;return r>t&&(a=Math.max(a,r-t)),a>0&&i.splice(0,a),i},t}($t),nn=function(){return function(e,t){this.time=e,this.value=t}}();function rn(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new an(e,t))}}var an=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new sn(e,this.project,this.thisArg))},e}(),sn=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return ft(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Ct);function on(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var cn=on(),ln=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function un(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var dn=function(e){if(e&&"function"==typeof e[Rt])return n=e,function(e){var t=n[Rt]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(ln(e))return zt(e);if(un(e))return function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,wt),t}}(e);if(e&&"function"==typeof e[cn])return t=e,function(e){for(var n=t[cn]();;){var i=void 0;try{i=n.next()}catch(t){return e.error(t),e}if(i.done){e.complete();break}if(e.next(i.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,i=Et(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function hn(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[Rt]}(e))return function(e,t){return new It((function(n){var i=new At;return i.add(t.schedule((function(){var r=e[Rt]();i.add(r.subscribe({next:function(e){i.add(t.schedule((function(){return n.next(e)})))},error:function(e){i.add(t.schedule((function(){return n.error(e)})))},complete:function(){i.add(t.schedule((function(){return n.complete()})))}}))}))),i}))}(e,t);if(un(e))return function(e,t){return new It((function(n){var i=new At;return i.add(t.schedule((function(){return e.then((function(e){i.add(t.schedule((function(){n.next(e),i.add(t.schedule((function(){return n.complete()})))})))}),(function(e){i.add(t.schedule((function(){return n.error(e)})))}))}))),i}))}(e,t);if(ln(e))return Gt(e,t);if(function(e){return e&&"function"==typeof e[cn]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new It((function(n){var i,r=new At;return r.add((function(){i&&"function"==typeof i.return&&i.return()})),r.add(t.schedule((function(){i=e[cn](),r.add(t.schedule((function(){if(!n.closed){var e,t;try{var r=i.next();e=r.value,t=r.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),r}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}var pn=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return ft(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Ct),mn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ft(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Ct);function fn(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(i){return i.pipe(fn((function(n,i){return(r=e(n,i),a?hn(r,a):r instanceof It?r:new It(dn(r))).pipe(rn((function(e,r){return t(n,e,i,r)})));var r,a}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new bn(e,n))})}var yn,gn,bn=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new wn(e,this.project,this.concurrent))},e}(),wn=function(e){function t(t,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var r=e.call(this,t)||this;return r.project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return ft(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new pn(this),n=this.destination;n.add(t);var i=function(e,t){if(!t.closed){if(e instanceof It)return e.subscribe(t);var n;try{n=dn(e)(t)}catch(e){t.error(e)}return n}}(e,t);i!==t&&n.add(i)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(mn);function _n(){return rn((()=>{}))}class vn extends Ct{constructor(){super(...arguments),this.completed=!1}_next(e){super._next(e),this._complete()}_complete(){this.completed=!0,super._complete()}_error(e){this.completed=!0,super._error(e)}unsubscribe(){super.unsubscribe(),!this.completed&&this.onUnsubscribe&&(this.onUnsubscribe(),this.onUnsubscribe=void 0)}}class En extends It{constructor(e){super((t=>{const n=new vn(t);return this.onUnsubscribe&&(n.onUnsubscribe=this.onUnsubscribe),e(n),n}))}static just(e){return new En((t=>{t.next(e)}))}static error(e){return new En((t=>{t.error(e)}))}static fromCallable(e){return new En((t=>{e(),t.next()}))}static deferPromise(e){return new En((t=>{e().then((e=>t.next(e))).catch((e=>t.error(e)))}))}}!function(e){e.parentConnected="parentConnected",e.connectedDapps="connectedDapps",e.amplitudeDeviceId="amplitudeDeviceId",e.cachedExperiments="cachedExperiments",e.cachedDeviceExperiments="cachedDeviceExperiments",e.blockedDappWhitelist="blockedDappWhitelist",e.evmPhishingConfig="evmPhishingConfig",e.solanaPhishingConfig="solanaPhishingConfig",e.extensionWasUpdated="extensionWasUpdated",e.activeEthAddress="activeEthAddress",e.chainSwitchedDapp="chainSwitchedDapp",e.canSignViaExtension="canSignViaExtension",e.supportsSolana="supportsSolana",e.migrationIndex="migrationIndex",e.signoutIncomplete="signoutIncomplete"}(yn||(yn={})),function(e){e.isStandaloneSigning="isStandaloneSigning",e.signingDevice="signingDevice"}(gn||(gn={}));const Tn={...y};function Nn(e){if(null==e)return!1;const t=String(e).trim();return!!/^(?:y|yes|true|1|on)$/i.test(t)}Nn("false"),Nn("false");const An="production",Sn="production",xn=Nn("false"),Cn="ibdjdlilbembidmokdpjanlbnjclopbi",Mn="hnfanknocfeofbddgcijnmhnfnkdnaad";function Rn(e){const t=function(){if("production"===Sn)switch(chrome.runtime.id){case Cn:return"corporate";case Mn:return"production";default:return"local-prod"}return"local"}();return e.includes(t)}function kn(){const e=chrome.runtime.getManifest().version;return Rn(["production"])?e:Rn(["corporate"])?`corp-${e}`:Rn(["local-prod"])?`qa-${e}`:"local"}const On="kill-switches";const In={serviceUrl:"https://api.coinbase.com/v3/coinbase.killswitch.KillSwitchService/KillSwitches",disabled:!1,platform:c.TT.extension,scope:"wallet",version:kn()||"",contextErrorHandler:function(){O({error:new Error("ClientKillSwitch: context not provided"),context:On,severity:"error",isHandled:!1})},fetchErrorHandler:function(e){O({error:e,context:On,severity:"error",metadata:{MetaData:e.message||"fetchError"},isHandled:!1})},hookErrorHandler:function(){O({error:new Error("ClientKillSwitch: useHook error"),context:On,severity:"error",isHandled:!1})},logger:{logMetric:function(){(0,l.N8)({metricName:"client_kill_switch.listen_latest",metricType:c.vj.count,value:1})},platform:"extension",enableLogging:!1}};Be(Object.freeze({...b,...Tn}),In);const Pn="undefined"==typeof localStorage,Dn=["https://*/*","http://localhost/*","http://127.0.0.1/*","http://0.0.0.0/*"],Ln=Object.freeze({CoinbaseContent:{allFrames:!0,id:"CoinbaseContent",js:["content.js"],matches:Dn,runAt:"document_start",world:"ISOLATED"},CoinbaseRequestProvider:{allFrames:!0,id:"CoinbaseRequestProvider",js:["requestProvider.js"],matches:Dn,runAt:"document_start",world:"MAIN"},CoinbaseSolanaProvider:{allFrames:!0,id:"CoinbaseSolanaProvider",js:["requestSolanaProvider.js"],matches:Dn,runAt:"document_start",world:"MAIN"},CoinbaseSolanaProviderCleanup:{allFrames:!0,id:"CoinbaseSolanaProviderCleanup",js:["requestSolanaProviderCleanup.js"],matches:Dn,runAt:"document_start",world:"MAIN"},CoinbaseWalletDappProvider:{allFrames:!0,id:"CoinbaseWalletDappProvider",js:["injectCoinbaseWalletDappProvider.js"],matches:["http://localhost:3000","https://wallet-dev.cbhq.net","https://wallet-staging.cbhq.net","https://wallet-qa.coinbase.com","https://wallet.coinbase.com","https://homebase.coinbase.com","https://dapp-dev-internal.cbhq.net","https://dapp-staging-internal.cbhq.net","https://dapp-qa-internal.cbhq.net","https://dapp-internal.cbhq.net"].map((e=>`${e}/*`)),runAt:"document_start",world:"MAIN"}});function qn(){return"production"===An}const $n="extension.chrome_update",jn="extension.connected",Bn="extension.dapp_origin_mismatch",Un="extension.force_update",Vn="extension.force_update_cleared",Fn="extension.installed",Kn="extension.no_original_tab",Wn="extension.cpu_info.service_worker_started",Hn="extension.cpu_info.service_worker_idle",Qn="extension.cpu_info.service_worker_interval",zn="extension.storage_migration.failed",Gn="extension.storage_migration.success",Yn="extension.suspend",Jn="extension.undefined_popup_event_response",Xn="extension.unknown_message_type",Zn="extension.unspecified_sender_tab",ei="extension.updated";function ti(...e){qn()||console.log(...e)}const ni=[Ye.getAllAddresses];function ii(e){if(e.data.action===Ye.getAllAddresses)return function(e){return{action:Ye.getAllAddresses,id:e.data.id,childSession:e.data.childSession}}(e)}const ri=[Je.requestEthereumAccounts,Je.addEthereumChain,Je.switchEthereumChain,Je.watchAsset,Je.selectProvider,"signEthereumMessage","signEthereumTransaction","submitEthereumTransaction"];function ai(e){switch(e.data.action){case Je.requestEthereumAccounts:return function(e){return{action:Je.requestEthereumAccounts,id:e.data.id,childSession:e.data.childSession}}(e);case Je.addEthereumChain:return function(e){return{action:Je.addEthereumChain,id:e.data.id,chainId:e.data.chainId,rpcUrls:e.data.rpcUrls,blockExplorerUrls:e.data.blockExplorerUrls,chainName:e.data.chainName,iconUrls:e.data.iconUrls,nativeCurrency:e.data.nativeCurrency}}(e);case Je.switchEthereumChain:return function(e){return{action:Je.switchEthereumChain,id:e.data.id,chainId:e.data.chainId,...e.data.address&&{address:e.data.address}}}(e);case Je.selectProvider:return function(e){return{action:Je.selectProvider,id:e.data.id,selectedProviderKey:e.data.selectedProviderKey}}(e);case Je.watchAsset:return function(e){return{action:Je.watchAsset,id:e.data.id,type:e.data.type,chainId:e.data.chainId,options:{address:e.data.options.address,symbol:e.data.options.symbol,decimals:e.data.options.decimals,image:e.data.options.image}}}(e);case"signEthereumMessage":case"signEthereumTransaction":case"submitEthereumTransaction":return function(e){return{action:e.data.action,id:e.data.id,request:e.data.request}}(e);default:return}}class si extends P{constructor(e,t){super(e,t,D.Memory)}}new si("isAppUnlocked"),new si("isAuthenticating"),new L("requireTransactionsAuth"),new L("isAppAccessAuthRequired"),new L("multiAccountEncryptedMnemonic"),new L("hashIterations");const oi=new L("serviceWorkerStorageSecret");new L("passwordAttempts"),new L("lastPasswordAttempt"),new L("autoLockTimeout"),new L("autoLockByUnixTimestamp"),new L("logoutIncomplete"),new L("signingDevice"),new L("encryptedMnemonic"),new L("passwordSalt"),new L("passwordIv");var ci;!function(e){e.standalone="standalone",e.hw_wallet="hw_wallet",e.walletlink="basic",e.dapp_provider="dapp_provider"}(ci||(ci={}));class li{constructor(e){Object.assign(this,e)}imageURLForNetwork(e){return this.imageURL}currencyCodeForNetwork(e){return this.currencyCode}get minimumBalance(){}}class ui extends li{constructor(e){super({blockchain:e.blockchain,networkSetting:e.networkSetting,refreshInterval:e.refreshInterval,currencyCode:e.currencyCode,decimals:e.decimals,imageURL:e.imageURL,defaultReceiveType:e.defaultReceiveType,supportsMultiWallet:!1,isSyncingRequired:!0}),Object.assign(this,e)}displayName(e){return e.isTestnet?`Testnet ${this.currencyName}`:this.currencyName}}class di{constructor(e){this.rawValue=e.toUpperCase()}toString(){return this.rawValue}static isEqual(e,t){return e.rawValue===t.rawValue}get addressCharLength(){switch(this.rawValue){case"SOL":return 44;case"ETH":case"BTC":return 42;case"LTC":return 43;case"DOGE":return 34;default:throw new Error("Blockchain not supported")}}blockExplorerUrl(e,t){switch(this.rawValue){case"ETH":{const n=t.asChain();return n?.blockExplorerUrl?`${n.blockExplorerUrl}/tx/${e}`:void 0}case"SOL":{const n=t.asChain();return n?`${n.blockExplorerUrl}/tx/${e}`:void 0}case"BTC":return`https://live.blockcypher.com/btc/tx/${e}`;case"DOGE":return`https://dogechain.info/tx/${e}`;case"LTC":return`https://live.blockcypher.com/ltc/tx/${e}`;default:return}}fullName(){switch(this.rawValue){case"ETH":return"Ethereum";case"SOL":return"Solana";case"BTC":return"Bitcoin";case"DOGE":return"Dogecoin";case"LTC":return"Litecoin";default:return}}avgConfirmationTime(){switch(this.rawValue){case"ETH":return{confirmationTime:"30",timeUnit:"seconds"};case"SOL":return{confirmationTime:"10",timeUnit:"seconds"};case"BTC":return{confirmationTime:"30",timeUnit:"minutes"};case"DOGE":return{confirmationTime:"3",timeUnit:"minutes"};case"LTC":return{confirmationTime:"8",timeUnit:"minutes"};default:return}}}class hi{constructor(e){this.code=e.toUpperCase(),this.rawValue=this.code}static isEqual(e,t){return e.rawValue===t.rawValue}get value(){return this.rawValue}}hi.USD=new hi("USD"),hi.EUR=new hi("EUR"),hi.CNY=new hi("CNY"),hi.GBP=new hi("GBP"),hi.CAD=new hi("CAD"),hi.USDC=new hi("USDC"),hi.EURC=new hi("EURC"),hi.USDT=new hi("USDT"),hi.RUB=new hi("RUB"),hi.BTC=new hi("BTC"),hi.ETH=new hi("ETH"),hi.WETH=new hi("WETH"),hi.CETH=new hi("CETH"),hi.WBTC=new hi("WBTC"),hi.CWBTC=new hi("CWBTC"),hi.MATIC=new hi("MATIC"),hi.POL=new hi("POL"),hi.SOL=new hi("SOL"),hi.XDAI=new hi("XDAI"),hi.AVAX=new hi("AVAX"),hi.RETH=new hi("RETH");class pi{constructor(e){this.rawValue=e}}const mi="Solana",fi="SOL",yi="https://asset-metadata-service-production.s3.amazonaws.com/asset_icons/b658adaf7913c1513c8d120bcb41934a5a4bf09b6adbcb436085e2fbf6eb128c.png",gi={SOLANA_MAINNET:{blockExplorerUrl:"https://solana.fm",rpcUrl:"https://sol-mainnet.wallet.coinbase.com"}},bi=Object.keys(gi).reduce((function(e,t){return e[t]={blockExplorerUrl:`${J}/mock-block-explorer`,rpcUrl:`${J}/mock-chain-rpc`},e}),{}),wi=new et({SOLANA_MAINNET:{blockchainSymbol:"SOL",chainId:101,baseAssetCurrencyCode:"SOL",baseAssetImageUrl:yi,baseAssetDisplayName:"Solana",baseAssetDecimal:9,displayName:"Solana",isLayer2:!1,isTestnet:!1,chainImageUrl:yi,isCustomNetwork:!1,isNonEthChain:!0,isNudgeSupported:!1,wacNetworkId:"networks/solana-mainnet",...(ue?bi:gi).SOLANA_MAINNET}}),_i="SOLANA_CHAIN";function vi(e){return new Ti(`${_i}:${e.chainId}`,e.isTestnet)}wi.whitelisted.SOLANA_MAINNET;const Ei=v()((function(e){const t=e.split("/");if(2!==t.length)return;const n=t[0];let i="";try{i=JSON.parse(t[1])}catch(t){O({error:t,context:"networks",metadata:{networkRawValue:e},isHandled:!0,severity:"error"})}return"boolean"==typeof i?new Ti(n,i):void 0}));class Ti{constructor(e,t=!1){this.isTestnet=t,this.rawValue=[e,String(t)].join("/")}static createTestnetNetwork(e){return new Ti("TESTNET",e)}static create(e){return Ei(e)}static isEqual(e,t){return e.rawValue===t.rawValue}static fromChainId({chainPrefix:e=d,chainId:t}){let n=e,i=ht.fromChainId(t);return t!==BigInt(101)||i||(n=_i),n===_i&&(i=wi.fromChainId(t)),new Ti(`${n}:${t}`,i?.isTestnet??!1)}static fromSupportedChain(e){return new Ti(`${e.prefix}:${e.chainId}`,!1)}asChain(){const{chainPrefix:e,chainId:t}=Ai(this.rawValue);if(e&&t)switch(e){case d:return ht.fromChainId(t);case _i:return wi.fromChainId(t);default:return}}}const Ni={chainId:void 0,chainPrefix:void 0},Ai=v()((function(e){if(!e)return Ni;const t=e.split("/");if(2!==t.length)return Ni;const n=t[0],i=n?.split(":")??[];if(2!==i.length)return Ni;const r=i[0],a=i[1];let s;try{s="undefined"===a?void 0:BigInt(a)}catch(t){throw O({error:t,context:"networks",metadata:{networkRawValue:e},isHandled:!0,severity:"error"}),t}return{chainPrefix:r,chainId:s}}));class Si{constructor(e,t){this.name=e,this.network=t}}class xi{constructor(e,t,n,i,r=[]){this.blockchain=e,this.defaultMainnet=t,this.mainnets=n,this.testnets=i,this.customNetworks=r}get defaultNetworks(){return[...this.mainnets,...this.testnets]}get allNetworks(){return[...this.mainnets,...this.testnets,...this.customNetworks]}get mainnetsAndCustomNetworks(){return[...this.mainnets,...this.customNetworks]}get testnetNetworks(){return[...this.testnets]}static forMainnetOnlyBlockchain(e){const t=new Si("Mainnet",Ti.createTestnetNetwork(!1));return new xi(e,t,[t],[])}}const Ci="BTC",Mi=new pi("BitcoinSegWit"),Ri=new pi("BitcoinBRDSegWit"),ki=new pi("BitcoinLegacy"),Oi=new pi("BitcoinBRDLegacy"),Ii=new di(Ci),Pi=xi.forMainnetOnlyBlockchain(Ii);new ui({supportedAddressTypes:[Mi,ki,Ri,Oi],blockchain:Ii,currencyName:"Bitcoin",currencyCode:hi.BTC,decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/btc_288.png",defaultReceiveType:Mi,txResubmitterInterval:120n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"bitcoin",qrCodeUriTestnetScheme:"bitcoin",networkSetting:Pi,refreshInterval:480n,isDerivationPathSupported:function(e,t){switch(e.rawValue){case Oi.rawValue:case Ri.rawValue:return!t;default:return!0}}});const Di="DOGE",Li=new pi("DogeCoin"),qi=new di(Di),$i=xi.forMainnetOnlyBlockchain(qi),ji=(new ui({supportedAddressTypes:[Li],blockchain:qi,currencyName:"Dogecoin",currencyCode:new hi("DOGE"),decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/doge_288.png",defaultReceiveType:Li,txResubmitterInterval:30n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"dogecoin",qrCodeUriTestnetScheme:"dogecoin",networkSetting:$i,refreshInterval:BigInt(480)}),"LTC"),Bi=new pi("LitecoinSegwit"),Ui=new pi("LitecoinLegacy"),Vi=new pi("LitecoinBRD"),Fi=new di(ji),Ki=xi.forMainnetOnlyBlockchain(Fi);new ui({supportedAddressTypes:[Bi,Ui,Vi],blockchain:Fi,currencyName:"Litecoin",currencyCode:new hi("LTC"),decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/ltc_288.png",defaultReceiveType:Bi,txResubmitterInterval:30n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"litecoin",qrCodeUriTestnetScheme:"litecoin",networkSetting:Ki,refreshInterval:BigInt(480),isDerivationPathSupported:function(e,t){return e.rawValue!==Vi.rawValue||!t}});n(52326);class Wi{static getInheritanceTree(e){const t=[e],n=e=>{const i=Object.getPrototypeOf(e);i&&i.name&&(t.push(i),n(i))};return n(e),t}static isInherited(e,t){return e.prototype instanceof t}static filterByTarget(e,t){return t?e.filter((e=>e.target&&-1!==t.indexOf(e.target))):e}}class Hi{constructor(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}filterTables(e){return this.filterByTarget(this.tables,e)}filterColumns(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)}findGenerated(e,t){return this.generations.find((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t))}findTree(e){return this.trees.find((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterRelations(e){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,e)}filterRelationIds(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)}filterRelationCounts(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)}filterIndices(e){return this.indices.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterUniques(e){return this.uniques.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterChecks(e){return this.checks.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterExclusions(e){return this.exclusions.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterListeners(e){return this.filterByTarget(this.entityListeners,e)}filterEmbeddeds(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)}findJoinTable(e,t){return this.joinTables.find((n=>n.target===e&&n.propertyName===t))}filterJoinColumns(e,t){return this.joinColumns.filter((n=>n.target===e&&n.propertyName===t))}filterSubscribers(e){return this.filterByTarget(this.entitySubscribers,e)}filterNamingStrategies(e){return this.filterByTarget(this.namingStrategies,e)}filterTransactionEntityManagers(e,t){return this.transactionEntityManagers.filter((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t))}filterTransactionRepository(e,t){return this.transactionRepositories.filter((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t))}filterSingleTableChildren(e){return this.tables.filter((t=>"function"==typeof t.target&&"function"==typeof e&&Wi.isInherited(t.target,e)&&"entity-child"===t.type))}findInheritanceType(e){return this.inheritances.find((t=>t.target===e))}findDiscriminatorValue(e){return this.discriminatorValues.find((t=>t.target===e))}filterByTarget(e,t){return e.filter((e=>Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t))}filterByTargetAndWithoutDuplicateProperties(e,t){const n=[];return e.forEach((e=>{(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((t=>t.propertyName===e.propertyName))||n.push(e))})),n}filterByTargetAndWithoutDuplicateRelationProperties(e,t){const n=[];return e.forEach((e=>{if(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t){const i=n.findIndex((t=>t.propertyName===e.propertyName));if(Array.isArray(t)&&-1!==i&&t.indexOf(e.target)<t.indexOf(n[i].target)){const t=Object.create(n[i]);t.type=e.type,n[i]=t}else-1===i&&n.push(e)}})),n}filterByTargetAndWithoutDuplicateEmbeddedProperties(e,t){const n=[];return e.forEach((e=>{if(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t){n.find((t=>t.prefix===e.prefix&&t.propertyName===e.propertyName))||n.push(e)}})),n}}class Qi{static getGlobalVariable(){return"undefined"!=typeof window?window:n.g}static load(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: require("${e}").`);return""}static pathNormalize(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.normalize("${e}").`);return""}static pathExtname(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.extname("${e}").`);return""}static pathResolve(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.resolve("${e}").`);return""}static fileExist(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.existsSync("${e}").`);return!1}static dotenv(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "${e}" }).`)}static getEnvVariable(e){}static readFileSync(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("${e}").`);return null}static appendFileSync(e,t){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("${e}").`)}static writeFile(e,t){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.writeFile("${e}").`);return Promise.reject(null)}static highlightSql(e){return e}static highlightJson(e){return e}static logInfo(e,t){console.info(e+" ",t)}static logError(e,t){console.error(e+" ",t)}static logWarn(e,t){console.warn(e+" ",t)}static log(e){console.log(e)}static warn(e){return e}}Qi.type="browser";"undefined"!=typeof window&&(window.Buffer=n(1048).Buffer),void 0!==n.g&&(n.g.Buffer=n(1048).Buffer);class zi{static sha1(e){let t,n,i,r,a,s,o,c,l,u=function(e,t){return e<<t|e>>>32-t},d=function(e){let t,n,i="";for(t=7;t>=0;t--)n=e>>>4*t&15,i+=n.toString(16);return i},h=new Array(80),p=1732584193,m=4023233417,f=2562383102,y=271733878,g=3285377520,b=(e=encodeURIComponent(e)).length,w=[];for(n=0;n<b-3;n+=4)i=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),w.push(i);switch(b%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(b-1)<<24|8388608;break;case 2:n=e.charCodeAt(b-2)<<24|e.charCodeAt(b-1)<<16|32768;break;case 3:n=e.charCodeAt(b-3)<<24|e.charCodeAt(b-2)<<16|e.charCodeAt(b-1)<<8|128}for(w.push(n);w.length%16!=14;)w.push(0);for(w.push(b>>>29),w.push(b<<3&4294967295),t=0;t<w.length;t+=16){for(n=0;n<16;n++)h[n]=w[t+n];for(n=16;n<=79;n++)h[n]=u(h[n-3]^h[n-8]^h[n-14]^h[n-16],1);for(r=p,a=m,s=f,o=y,c=g,n=0;n<=19;n++)l=u(r,5)+(a&s|~a&o)+c+h[n]+1518500249&4294967295,c=o,o=s,s=u(a,30),a=r,r=l;for(n=20;n<=39;n++)l=u(r,5)+(a^s^o)+c+h[n]+1859775393&4294967295,c=o,o=s,s=u(a,30),a=r,r=l;for(n=40;n<=59;n++)l=u(r,5)+(a&s|a&o|s&o)+c+h[n]+2400959708&4294967295,c=o,o=s,s=u(a,30),a=r,r=l;for(n=60;n<=79;n++)l=u(r,5)+(a^s^o)+c+h[n]+3395469782&4294967295,c=o,o=s,s=u(a,30),a=r,r=l;p=p+r&4294967295,m=m+a&4294967295,f=f+s&4294967295,y=y+o&4294967295,g=g+c&4294967295}return l=d(p)+d(m)+d(f)+d(y)+d(g),l.toLowerCase()}}var Gi=n(24783);class Yi{constructor(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}getTableName(e){return"string"!=typeof e&&(e=e.name),e.split(".").pop()}tableName(e,t){return t||(0,Gi.LW)(e)}closureJunctionTableName(e){return e+"_closure"}columnName(e,t,n){const i=t||e;return n.length?(0,Gi.xQ)(n.join("_"))+(0,Gi.nx)(i):i}relationName(e){return e}primaryKeyName(e,t){const n=[...t];n.sort();const i=`${this.getTableName(e).replace(".","_")}_${n.join("_")}`;return"PK_"+zi.sha1(i).substr(0,27)}uniqueConstraintName(e,t){const n=[...t];n.sort();const i=`${this.getTableName(e).replace(".","_")}_${n.join("_")}`;return"UQ_"+zi.sha1(i).substr(0,27)}relationConstraintName(e,t,n){const i=[...t];i.sort();let r=`${this.getTableName(e).replace(".","_")}_${i.join("_")}`;return n&&(r+=`_${n}`),"REL_"+zi.sha1(r).substr(0,26)}defaultConstraintName(e,t){const n=`${this.getTableName(e).replace(".","_")}_${t}`;return"DF_"+zi.sha1(n).substr(0,27)}foreignKeyName(e,t,n,i){const r=[...t];r.sort();const a=`${this.getTableName(e).replace(".","_")}_${r.join("_")}`;return"FK_"+zi.sha1(a).substr(0,27)}indexName(e,t,n){const i=[...t];i.sort();let r=`${this.getTableName(e).replace(".","_")}_${i.join("_")}`;return n&&(r+=`_${n}`),"IDX_"+zi.sha1(r).substr(0,26)}checkConstraintName(e,t,n){const i=`${this.getTableName(e).replace(".","_")}_${t}`,r="CHK_"+zi.sha1(i).substr(0,26);return n?`${r}_ENUM`:r}exclusionConstraintName(e,t){const n=`${this.getTableName(e).replace(".","_")}_${t}`;return"XCL_"+zi.sha1(n).substr(0,26)}joinColumnName(e,t){return(0,Gi.xQ)(e+"_"+t)}joinTableName(e,t,n,i){return(0,Gi.LW)(e+"_"+n.replace(/\./gi,"_")+"_"+t)}joinTableColumnDuplicationPrefix(e,t){return e+"_"+t}joinTableColumnName(e,t,n){return(0,Gi.xQ)(e+"_"+(n||t))}joinTableInverseColumnName(e,t,n){return this.joinTableColumnName(e,t,n)}prefixTableName(e,t){return e+t}eagerJoinRelationAlias(e,t){return e+"_"+t.replace(".","_")}}var Ji=n(26883);class Xi{constructor(e){this["@instanceof"]=Symbol.for("TableColumn"),this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||(e.unsigned||!1),this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.generatedIdentity=e.generatedIdentity,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.primaryKeyConstraintName=e.primaryKeyConstraintName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}clone(){return new Xi({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,primaryKeyConstraintName:this.primaryKeyConstraintName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,generatedIdentity:this.generatedIdentity,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})}}class Zi{constructor(e){this["@instanceof"]=Symbol.for("TableIndex"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.isNullFiltered=!!e.isNullFiltered,this.parser=e.parser,this.where=e.where?e.where:""}clone(){return new Zi({name:this.name,columnNames:[...this.columnNames],isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,isNullFiltered:this.isNullFiltered,parser:this.parser,where:this.where})}static create(e){return new Zi({name:e.name,columnNames:e.columns.map((e=>e.databaseName)),isUnique:e.isUnique,isSpatial:e.isSpatial,isFulltext:e.isFulltext,isNullFiltered:e.isNullFiltered,parser:e.parser,where:e.where})}}class er{constructor(e){this["@instanceof"]=Symbol.for("TableForeignKey"),this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedDatabase=e.referencedDatabase,this.referencedSchema=e.referencedSchema,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}clone(){return new er({name:this.name,columnNames:[...this.columnNames],referencedColumnNames:[...this.referencedColumnNames],referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})}static create(e,t){return new er({name:e.name,columnNames:e.columnNames,referencedColumnNames:e.referencedColumnNames,referencedDatabase:e.referencedEntityMetadata.database,referencedSchema:e.referencedEntityMetadata.schema,referencedTableName:e.referencedTablePath,onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable})}}class tr{static createTableColumnOptions(e,t){return{name:e.databaseName,length:t.getColumnLength(e),width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,generatedIdentity:e.generatedIdentity,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map((e=>e+"")):e.enum,enumName:e.enumName,primaryKeyConstraintName:e.primaryKeyConstraintName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}}}class nr{constructor(e){this["@instanceof"]=Symbol.for("TableUnique"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.deferrable=e.deferrable}clone(){return new nr({name:this.name,columnNames:[...this.columnNames],deferrable:this.deferrable})}static create(e){return new nr({name:e.name,columnNames:e.columns.map((e=>e.databaseName)),deferrable:e.deferrable})}}class ir{constructor(e){this["@instanceof"]=Symbol.for("TableCheck"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}clone(){return new ir({name:this.name,columnNames:this.columnNames?[...this.columnNames]:[],expression:this.expression})}static create(e){return new ir({name:e.name,expression:e.expression})}}class rr{constructor(e){this["@instanceof"]=Symbol.for("TableExclusion"),this.name=e.name,this.expression=e.expression}clone(){return new rr({name:this.name,expression:this.expression})}static create(e){return new rr({name:e.name,expression:e.expression})}}class ar{constructor(e){this["@instanceof"]=Symbol.for("Table"),this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,this.withoutRowid=!1,e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,e.columns&&(this.columns=e.columns.map((e=>new Xi(e)))),e.indices&&(this.indices=e.indices.map((e=>new Zi(e)))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map((t=>new er({...t,referencedDatabase:(null==t?void 0:t.referencedDatabase)||e.database,referencedSchema:(null==t?void 0:t.referencedSchema)||e.schema})))),e.uniques&&(this.uniques=e.uniques.map((e=>new nr(e)))),e.checks&&(this.checks=e.checks.map((e=>new ir(e)))),e.exclusions&&(this.exclusions=e.exclusions.map((e=>new rr(e)))),void 0!==e.justCreated&&(this.justCreated=e.justCreated),e.withoutRowid&&(this.withoutRowid=e.withoutRowid),this.engine=e.engine)}get primaryColumns(){return this.columns.filter((e=>e.isPrimary))}clone(){return new ar({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map((e=>e.clone())),indices:this.indices.map((e=>e.clone())),foreignKeys:this.foreignKeys.map((e=>e.clone())),uniques:this.uniques.map((e=>e.clone())),checks:this.checks.map((e=>e.clone())),exclusions:this.exclusions.map((e=>e.clone())),justCreated:this.justCreated,withoutRowid:this.withoutRowid,engine:this.engine})}addColumn(e){this.columns.push(e)}removeColumn(e){const t=this.columns.find((t=>t.name===e.name));t&&this.columns.splice(this.columns.indexOf(t),1)}addUniqueConstraint(e){if(this.uniques.push(e),1===e.columnNames.length){const t=this.columns.find((t=>t.name===e.columnNames[0]));t&&(t.isUnique=!0)}}removeUniqueConstraint(e){const t=this.uniques.find((t=>t.name===e.name));if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){const e=this.columns.find((e=>e.name===t.columnNames[0]));e&&(e.isUnique=!1)}}addCheckConstraint(e){this.checks.push(e)}removeCheckConstraint(e){const t=this.checks.find((t=>t.name===e.name));t&&this.checks.splice(this.checks.indexOf(t),1)}addExclusionConstraint(e){this.exclusions.push(e)}removeExclusionConstraint(e){const t=this.exclusions.find((t=>t.name===e.name));t&&this.exclusions.splice(this.exclusions.indexOf(t),1)}addForeignKey(e){this.foreignKeys.push(e)}removeForeignKey(e){const t=this.foreignKeys.find((t=>t.name===e.name));t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)}addIndex(e,t=!1){if(this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){const t=this.columns.find((t=>t.name===e.columnNames[0]));t&&(t.isUnique=!0)}}removeIndex(e,t=!1){const n=this.indices.find((t=>t.name===e.name));if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){const e=this.columns.find((e=>e.name===n.columnNames[0]));e&&(e.isUnique=this.indices.some((t=>1===t.columnNames.length&&t.columnNames[0]===e.name&&!!n.isUnique)))}}findColumnByName(e){return this.columns.find((t=>t.name===e))}findColumnIndices(e){return this.indices.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnForeignKeys(e){return this.foreignKeys.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnUniques(e){return this.uniques.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnChecks(e){return this.checks.filter((t=>!!t.columnNames.find((t=>t===e.name))))}static create(e,t){const n=e.database===t.database?void 0:e.database,i=e.schema===t.options.schema?void 0:e.schema,r={database:e.database,schema:e.schema,name:t.buildTableName(e.tableName,i,n),withoutRowid:e.withoutRowid,engine:e.engine,columns:e.columns.filter((e=>e)).map((e=>tr.createTableColumnOptions(e,t))),indices:e.indices.filter((e=>!0===e.synchronize)).map((e=>Zi.create(e))),uniques:e.uniques.map((e=>nr.create(e))),checks:e.checks.map((e=>ir.create(e))),exclusions:e.exclusions.map((e=>rr.create(e)))};return new ar(r)}}class sr{constructor(e,t,n,i){this.id=e,this.timestamp=t,this.name=n,this.instance=i}}class or{constructor(e,t,...n){this.value=e,this.type=t,this["@instanceof"]=Symbol.for("MssqlParameter"),this.params=[],this.params=n||[]}}var cr=n(5471);class lr{constructor(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";const{schema:n}=this.connection.driver.options,i=this.connection.driver.database;this.migrationsDatabase=i,this.migrationsSchema=n,this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n,i)}async executeMigration(e){return this.withQueryRunner((async t=>(await this.createMigrationsTableIfNotExist(t),await t.beforeMigration(),await e.instance.up(t),await t.afterMigration(),await this.insertExecutedMigration(t,e),e)))}async getAllMigrations(){return Promise.resolve(this.getMigrations())}async getExecutedMigrations(){return this.withQueryRunner((async e=>(await this.createMigrationsTableIfNotExist(e),await this.loadExecutedMigrations(e))))}async getPendingMigrations(){const e=await this.getAllMigrations(),t=await this.getExecutedMigrations();return e.filter((e=>!t.find((t=>t.name===e.name))))}insertMigration(e){return this.withQueryRunner((t=>this.insertExecutedMigration(t,e)))}deleteMigration(e){return this.withQueryRunner((t=>this.deleteExecutedMigration(t,e)))}async showMigrations(){let e=!1;const t=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(t);const n=await this.loadExecutedMigrations(t),i=this.getMigrations();for(const t of i){n.find((e=>e.name===t.name))?this.connection.logger.logSchemaBuild(`[X] ${t.name}`):(e=!0,this.connection.logger.logSchemaBuild(`[ ] ${t.name}`))}return this.queryRunner||await t.release(),e}async executePendingMigrations(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const t=this.connection.driver.createSchemaBuilder();cr.t.isRdbmsSchemaBuilder(t)&&await t.createMetadataTableIfNecessary(e);const n=await this.loadExecutedMigrations(e);let i=this.getLatestTimestampMigration(n);const r=this.getMigrations(),a=[],s=r.filter((e=>!n.find((t=>t.name===e.name))));if(!s.length)return this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner||await e.release(),[];this.connection.logger.logSchemaBuild(`${n.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${r.length} migrations were found in the source code.`),i&&this.connection.logger.logSchemaBuild(`${i.name} is the last executed migration. It was executed on ${new Date(i.timestamp).toString()}.`),this.connection.logger.logSchemaBuild(`${s.length} migrations are new migrations must be executed.`);let o=!1;"all"!==this.transaction||e.isTransactionActive||(await e.startTransaction(),o=!0);try{for(const t of s)this.fake?await this.insertExecutedMigration(e,t):("each"!==this.transaction||e.isTransactionActive||(await e.startTransaction(),o=!0),await t.instance.up(e).catch((e=>{throw this.connection.logger.logMigration(`Migration "${t.name}" failed, error: ${null==e?void 0:e.message}`),e})).then((async()=>{await this.insertExecutedMigration(e,t),"each"===this.transaction&&o&&await e.commitTransaction()})).then((()=>{a.push(t),this.connection.logger.logSchemaBuild(`Migration ${t.name} has been ${this.fake?"(fake)":""} executed successfully.`)})));"all"===this.transaction&&o&&await e.commitTransaction()}catch(t){if(o)try{await e.rollbackTransaction()}catch(e){}throw t}finally{this.queryRunner||await e.release()}return a}async undoLastMigration(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const t=await this.loadExecutedMigrations(e);let n=this.getLatestExecutedMigration(t);if(!n)return void this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!");const i=this.getMigrations().find((e=>e.name===n.name));if(!i)throw new Ji.VR(`No migration ${n.name} was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.`);this.connection.logger.logSchemaBuild(`${t.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${n.name} is the last executed migration. It was executed on ${new Date(n.timestamp).toString()}.`),this.connection.logger.logSchemaBuild("Now reverting it...");let r=!1;"none"===this.transaction||e.isTransactionActive||(await e.startTransaction(),r=!0);try{this.fake||(await e.beforeMigration(),await i.instance.down(e),await e.afterMigration()),await this.deleteExecutedMigration(e,i),this.connection.logger.logSchemaBuild(`Migration ${i.name} has been ${this.fake?"(fake)":""} reverted successfully.`),r&&await e.commitTransaction()}catch(t){if(r)try{await e.rollbackTransaction()}catch(e){}throw t}finally{this.queryRunner||await e.release()}}async createMigrationsTableIfNotExist(e){if("mongodb"===this.connection.driver.options.type)return;await e.hasTable(this.migrationsTable)||await e.createTable(new ar({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))}async loadExecutedMigrations(e){if("mongodb"===this.connection.driver.options.type){const t=e;return await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()}return(await this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()).map((e=>new sr(parseInt(e.id),parseInt(e.timestamp),e.name)))}getMigrations(){const e=this.connection.migrations.map((e=>{const t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new Ji.VR(`${t} migration name is wrong. Migration class name should have a JavaScript timestamp appended.`);return new sr(void 0,n,t,e)}));return this.checkForDuplicateMigrations(e),e.sort(((e,t)=>e.timestamp-t.timestamp))}checkForDuplicateMigrations(e){const t=e.map((e=>e.name)),n=Array.from(new Set(t.filter(((e,n)=>t.indexOf(e)<n))));if(n.length>0)throw Error(`Duplicate migrations: ${n.join(", ")}`)}getLatestTimestampMigration(e){const t=e.map((e=>e)).sort(((e,t)=>-1*(e.timestamp-t.timestamp)));return t.length>0?t[0]:void 0}getLatestExecutedMigration(e){return e.length>0?e[0]:void 0}async insertExecutedMigration(e,t){const n={};if("mssql"===this.connection.driver.options.type?(n.timestamp=new or(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new or(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),"mongodb"===this.connection.driver.options.type){const t=e;await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(n)}else{const t=e.manager.createQueryBuilder();await t.insert().into(this.migrationsTable).values(n).execute()}}async deleteExecutedMigration(e,t){const n={};if("mssql"===this.connection.driver.options.type?(n.timestamp=new or(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new or(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),"mongodb"===this.connection.driver.options.type){const t=e;await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)}else{const t=e.manager.createQueryBuilder();await t.delete().from(this.migrationsTable).where(`${t.escape("timestamp")} = :timestamp`).andWhere(`${t.escape("name")} = :name`).setParameters(n).execute()}}async withQueryRunner(e){const t=this.queryRunner||this.connection.createQueryRunner();try{return e(t)}finally{this.queryRunner||await t.release()}}}var ur=n(57719),dr=n(80601);function hr(e,t,n){let i=[],r={};return function a(s){r[s]=!0,i.push(s),e[s].forEach((function(e){if(r[e]){if(i.indexOf(e)>=0)throw i.push(e),new Ji.VR(`Dependency Cycle Found: ${i.join(" -> ")}`)}else a(e)})),i.pop(),t&&0!==e[s].length||-1!==n.indexOf(s)||n.push(s)}}class pr{constructor(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}addNode(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])}removeNode(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach((function(t){Object.keys(t).forEach((function(n){let i=t[n].indexOf(e);i>=0&&t[n].splice(i,1)}),this)})))}hasNode(e){return this.nodes.hasOwnProperty(e)}getNodeData(e){if(this.hasNode(e))return this.nodes[e];throw new Ji.VR(`Node does not exist: ${e}`)}setNodeData(e,t){if(!this.hasNode(e))throw new Ji.VR(`Node does not exist: ${e}`);this.nodes[e]=t}addDependency(e,t){if(!this.hasNode(e))throw new Ji.VR(`Node does not exist: ${e}`);if(!this.hasNode(t))throw new Ji.VR(`Node does not exist: ${t}`);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0}removeDependency(e,t){let n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t),n>=0&&this.outgoingEdges[e].splice(n,1)),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e),n>=0&&this.incomingEdges[t].splice(n,1))}dependenciesOf(e,t){if(this.hasNode(e)){let n=[];hr(this.outgoingEdges,t,n)(e);let i=n.indexOf(e);return i>=0&&n.splice(i,1),n}throw new Ji.VR(`Node does not exist: ${e}`)}dependantsOf(e,t){if(this.hasNode(e)){let n=[];hr(this.incomingEdges,t,n)(e);let i=n.indexOf(e);return i>=0&&n.splice(i,1),n}throw new Ji.VR(`Node does not exist: ${e}`)}overallOrder(e){let t=this,n=[],i=Object.keys(this.nodes);if(0===i.length)return n;{let r=hr(this.outgoingEdges,!1,[]);i.forEach((function(e){r(e)}));let a=hr(this.outgoingEdges,e,n);return i.filter((function(e){return 0===t.incomingEdges[e].length})).forEach((function(e){a(e)})),n}}}var mr=n(19108),fr=n(63849),yr=n(13149),gr=n(86740);class br{validateMany(e,t){e.forEach((n=>this.validate(n,e,t))),this.validateDependencies(e),this.validateEagerRelations(e)}validate(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new ur.$(e);if(e.primaryColumns.length>1){if(!e.primaryColumns.every(((e,t,n)=>e.primaryKeyConstraintName===n[0].primaryKeyConstraintName)))throw new Ji.VR(`Entity ${e.name} has multiple primary columns with different constraint names. Constraint names should be the equal.`)}if("STI"===e.inheritancePattern||"entity-child"===e.tableType){if(!e.discriminatorColumn)throw new Ji.VR(`Entity ${e.name} using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?`);if(void 0===e.discriminatorValue)throw new Ji.VR(`Entity ${e.name} has an undefined discriminator value. Discriminator value should be defined.`);const n=t.find((t=>t!==e&&("STI"===t.inheritancePattern||"entity-child"===t.tableType)&&t.tableName===e.tableName&&t.discriminatorValue===e.discriminatorValue&&t.inheritanceTree.some((t=>-1!==e.inheritanceTree.indexOf(t)))));if(n)throw new Ji.VR(`Entities ${e.name} and ${n.name} have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.`)}if(e.relationCounts.forEach((e=>{if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Ji.VR("Relation count can not be implemented on ManyToOne or OneToOne relations.")})),"mongodb"!==n.options.type&&e.columns.forEach((t=>{const i=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(i))throw new mr.E(t,i,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(i))throw new Ji.VR(`Column ${t.propertyName} of Entity ${e.name} does not support length property.`);if("enum"===t.type&&!t.enum&&!t.enumName)throw new Ji.VR(`Column "${t.propertyName}" of Entity "${e.name}" is defined as enum, but missing "enum" or "enumName" properties.`)})),gr.I.isMySQLFamily(n)||"aurora-mysql"===n.options.type){if(e.columns.filter((e=>e.isGenerated&&"uuid"!==e.generationStrategy)).length>1)throw new Ji.VR(`Error in ${e.name} entity. There can be only one auto-increment column in MySql table.`)}if(gr.I.isMySQLFamily(n)){const e=t.filter((e=>e.database));if(0===e.length&&!n.database)throw new fr.n("database")}if("mssql"===n.options.type){if(e.columns.filter((e=>e.charset)).length>1)throw new Ji.VR("Character set specifying is not supported in Sql Server")}if("postgres"===n.options.type){const t=e.columns.find((e=>e.asExpression&&(!e.generatedType||"VIRTUAL"===e.generatedType)));if(t)throw new Ji.VR(`Column "${t.propertyName}" of Entity "${e.name}" is defined as VIRTUAL, but Postgres supports only STORED generated columns.`)}const i=e.create(void 0,{fromDeserializer:!0});e.relations.forEach((e=>{if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;const t=e.getEntityValue(i);if(Array.isArray(t))throw new yr.Z(e)}})),e.relations.forEach((e=>{})),e.relations.forEach((t=>{if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Ji.VR(`Relation ${e.name}#${t.propertyName} and ${t.inverseRelation.entityMetadata.name}#${t.inverseRelation.propertyName} both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.`)})),e.eagerRelations.forEach((e=>{}))}validateDependencies(e){const t=new pr;e.forEach((e=>{t.addNode(e.name)})),e.forEach((e=>{e.relationsWithJoinColumns.filter((e=>!e.isNullable)).forEach((n=>{t.addDependency(e.name,n.inverseEntityMetadata.name)}))}));try{t.overallOrder()}catch(e){throw new dr.j(e.toString().replace("Error: Dependency Cycle Found: ",""))}}validateEagerRelations(e){e.forEach((e=>{e.eagerRelations.forEach((t=>{if(t.inverseRelation&&t.inverseRelation.isEager)throw new Ji.VR(`Circular eager relations are disallowed. ${e.targetName}#${t.propertyPath} contains "eager: true", and its inverse side ${t.inverseEntityMetadata.targetName}#${t.inverseRelation.propertyPath} contains "eager: true" as well. Remove "eager: true" from one side of the relation.`)}))}))}}var wr=n(81719),_r=n(76965),vr=n(52738),Er=n(24611),Tr=n(93499),Nr=n(68625);class Ar{static createRelationMaps(e,t,n,i){return i.map((i=>{const r=t.treeParentRelation.joinColumns[0],a=r.givenDatabaseName||r.databaseName,s=i[n+"_"+t.primaryColumns[0].databaseName],o=i[n+"_"+a];return{id:e.connection.driver.prepareHydratedValue(s,t.primaryColumns[0]),parentId:e.connection.driver.prepareHydratedValue(o,r)}}))}static buildChildrenEntityTree(e,t,n,i,r){const a=e.treeChildrenRelation.propertyName;if(0===r.depth)return void(t[a]=[]);const s=e.primaryColumns[0].getEntityValue(t),o=i.filter((e=>e.parentId===s)),c=new Set(o.map((e=>e.id)));t[a]=n.filter((t=>c.has(e.primaryColumns[0].getEntityValue(t)))),t[a].forEach((t=>{Ar.buildChildrenEntityTree(e,t,n,i,{...r,depth:r.depth-1})}))}static buildParentEntityTree(e,t,n,i){const r=e.treeParentRelation.propertyName,a=e.primaryColumns[0].getEntityValue(t),s=i.find((e=>e.id===a)),o=n.find((t=>!!s&&e.primaryColumns[0].getEntityValue(t)===s.parentId));o&&(t[r]=o,Ar.buildParentEntityTree(e,t[r],n,i))}}var Sr=n(88126),xr=n.n(Sr);class Cr{constructor(e,t,n){this.target=e,this.manager=t,this.queryRunner=n}get metadata(){return this.manager.connection.getMetadata(this.target)}createQueryBuilder(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)}hasId(e){return this.manager.hasId(this.metadata.target,e)}getId(e){return this.manager.getId(this.metadata.target,e)}create(e){return this.manager.create(this.metadata.target,e)}merge(e,...t){return this.manager.merge(this.metadata.target,e,...t)}preload(e){return this.manager.preload(this.metadata.target,e)}save(e,t){return this.manager.save(this.metadata.target,e,t)}remove(e,t){return this.manager.remove(this.metadata.target,e,t)}softRemove(e,t){return this.manager.softRemove(this.metadata.target,e,t)}recover(e,t){return this.manager.recover(this.metadata.target,e,t)}insert(e){return this.manager.insert(this.metadata.target,e)}update(e,t){return this.manager.update(this.metadata.target,e,t)}upsert(e,t){return this.manager.upsert(this.metadata.target,e,t)}batchUpsert(e,t,n=50){return 0===e.length?[]:xr()(e,n).map((e=>this.upsert(e,t)))}delete(e){return this.manager.delete(this.metadata.target,e)}deleteEntities(e,t=50){const n=e.map((e=>e.id));return xr()(n,t).map((e=>this.delete(e)))}softDelete(e){return this.manager.softDelete(this.metadata.target,e)}isNull(){return!1}restore(e){return this.manager.restore(this.metadata.target,e)}count(e){return this.manager.count(this.metadata.target,e)}countBy(e){return this.manager.countBy(this.metadata.target,e)}async find(e){return this.manager.find(this.metadata.target,e)}async findBy(e){return this.manager.findBy(this.metadata.target,e)}findAndCount(e){return this.manager.findAndCount(this.metadata.target,e)}findAndCountBy(e){return this.manager.findAndCountBy(this.metadata.target,e)}async findByIds(e){return this.manager.findByIds(this.metadata.target,e)}async findOne(e){return this.manager.findOne(this.metadata.target,e)}async findOneBy(e){return this.manager.findOneBy(this.metadata.target,e)}async findOneById(e){return this.manager.findOneById(this.metadata.target,e)}async findOneOrFail(e){return this.manager.findOneOrFail(this.metadata.target,e)}async findOneByOrFail(e){return this.manager.findOneByOrFail(this.metadata.target,e)}query(e,t){return this.manager.query(e,t)}clear(){return this.manager.clear(this.metadata.target)}increment(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)}decrement(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)}extend(e){const t=this.constructor,{target:n,manager:i,queryRunner:r}=this,a=new class extends t{}(n,i,r);return Object.assign(a,e),a}}class Mr extends Cr{async findTrees(e){const t=await this.findRoots(e);return await Promise.all(t.map((t=>this.findDescendantsTree(t,e)))),t}findRoots(e){const t=this.metadata.treeParentRelation.joinColumns[0],n=t.givenDatabaseName||t.databaseName,i=this.createQueryBuilder("treeEntity");return Nr.H.applyOptionsToTreeQueryBuilder(i,e),i.where(`${(e=>this.manager.connection.driver.escape(e))("treeEntity")}.${(e=>this.manager.connection.driver.escape(e))(n)} IS NULL`).getMany()}findDescendants(e,t){const n=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);return Nr.H.applyOptionsToTreeQueryBuilder(n,t),n.getMany()}async findDescendantsTree(e,t){const n=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);Nr.H.applyOptionsToTreeQueryBuilder(n,t);const i=await n.getRawAndEntities(),r=Ar.createRelationMaps(this.manager,this.metadata,"treeEntity",i.raw);return Ar.buildChildrenEntityTree(this.metadata,e,i.entities,r,{depth:-1,...t}),e}countDescendants(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()}createDescendantsQueryBuilder(e,t,n){const i=e=>this.manager.connection.driver.escape(e);if("closure-table"===this.metadata.treeType){const r=this.metadata.closureJunctionTable.descendantColumns.map((n=>i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath))).join(" AND "),a={},s=this.metadata.closureJunctionTable.ancestorColumns.map((e=>(a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName))).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,r).where(s).setParameters(a)}if("nested-set"===this.metadata.treeType){const t=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath,i={},r=this.metadata.treeParentRelation.joinColumns.map((e=>{const t=e.referencedColumn.propertyPath.replace(".","_");return i[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",t).where(r,i)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((t=>{const i=t.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(n));return gr.I.isSQLiteFamily(this.manager.connection.driver)?`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE ${i.getQuery()} || '%'`:`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE NULLIF(CONCAT(${i.getQuery()}, '%'), '%')`}));throw new Tr.V("Supported only in tree entities")}findAncestors(e,t){const n=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);return Nr.H.applyOptionsToTreeQueryBuilder(n,t),n.getMany()}async findAncestorsTree(e,t){const n=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);Nr.H.applyOptionsToTreeQueryBuilder(n,t);const i=await n.getRawAndEntities(),r=Ar.createRelationMaps(this.manager,this.metadata,"treeEntity",i.raw);return Ar.buildParentEntityTree(this.metadata,e,i.entities,r),e}countAncestors(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()}createAncestorsQueryBuilder(e,t,n){if("closure-table"===this.metadata.treeType){const i=this.metadata.closureJunctionTable.ancestorColumns.map((n=>t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath)).join(" AND "),r={},a=this.metadata.closureJunctionTable.descendantColumns.map((e=>(r[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName))).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(a).setParameters(r)}if("nested-set"===this.metadata.treeType){const t="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath,i={},r=this.metadata.treeParentRelation.joinColumns.map((e=>{const t=e.referencedColumn.propertyPath.replace(".","_");return i[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",t).where(r,i)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((t=>{const i=t.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(n));return gr.I.isSQLiteFamily(this.manager.connection.driver)?`${i.getQuery()} LIKE ${e}.${this.metadata.materializedPathColumn.propertyPath} || '%'`:`${i.getQuery()} LIKE CONCAT(${e}.${this.metadata.materializedPathColumn.propertyPath}, '%')`}));throw new Tr.V("Supported only in tree entities")}extend(e){const t=this.constructor,{target:n,manager:i,queryRunner:r}=this,a=new class extends t{}(n,i,r);return Object.assign(a,e),a}}var Rr=n(91481);class kr{transform(e,t,n,i=!1){return this.groupAndTransform(e,t,n,i),e}groupAndTransform(e,t,n,i=!1){n.nonVirtualColumns.forEach((n=>{const i=n.getEntityValue(t);void 0!==i&&n.setEntityValue(e,i)})),n.relations.length&&n.relations.forEach((n=>{let r=n.getEntityValue(e);const a=n.getEntityValue(t,i);if(void 0!==a)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(a))return;r||(r=[],n.setEntityValue(e,r)),a.forEach((e=>{let t=r.find((t=>n.inverseEntityMetadata.compareEntities(e,t)));t||(t=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),r.push(t)),this.groupAndTransform(t,e,n.inverseEntityMetadata,i)}))}else{if(!Rr.B.isObject(a))return void(Rr.B.isObject(r)||n.setEntityValue(e,a));r||(r=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),n.setEntityValue(e,r)),this.groupAndTransform(r,a,n.inverseEntityMetadata,i)}}))}}class Or{constructor(e,t,n,i){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=i}get target(){return this.metadata.target}get id(){return this.metadata.getEntityIdMixedMap(this.plainEntity)}}class Ir{constructor(){this.loadMapItems=[]}get mainLoadMapItem(){return this.loadMapItems.find((e=>!e.relation&&!e.parentLoadMapItem))}addLoadMap(e){this.loadMapItems.find((t=>t.target===e.target&&t.id===e.id))||this.loadMapItems.push(e)}fillEntities(e,t){t.forEach((t=>{const n=this.loadMapItems.find((n=>n.target===e&&n.metadata.compareEntities(t,n.plainEntity)));n&&(n.entity=t)}))}groupByTargetIds(){const e=[];return this.loadMapItems.forEach((t=>{let n=e.find((e=>e.target===t.target));n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)})),e}}class Pr{constructor(e){this.manager=e}async transform(e,t){if(!t.hasAllPrimaryKeys(e))return Promise.reject("Given object does not have a primary column, cannot transform it to database entity.");const n=new Ir,i=(e,r,a,s)=>{const o=new Or(e,r,a,s);n.addLoadMap(o),r.extractRelationValuesFromEntity(e,t.relations).filter((e=>null!=e)).forEach((([e,t,n])=>i(t,n,o,e)))};return i(e,t),await Promise.all(n.groupByTargetIds().map((e=>this.manager.findByIds(e.target,e.ids).then((t=>n.fillEntities(e.target,t)))))),n.loadMapItems.forEach((e=>{e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)})),n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0}}var Dr=n(4857),Lr=n(72287);class qr{get repository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new Dr.N(this.constructor);return this.manager.getRepository(e)}get treeRepository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new Dr.N(this.constructor);return this.manager.getTreeRepository(e)}createQueryBuilder(e){const t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new Dr.N(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)}createQueryBuilderFor(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)}getRepositoryFor(e){return this.manager.getRepository(e)}getTreeRepositoryFor(e){return this.manager.getTreeRepository(e)}getCustomRepositoryTarget(e){const t=po().entityRepositories.find((t=>t.target===("function"==typeof e?e:e.constructor)));if(!t)throw new Lr.z(e);return t.entity}}var $r=n(854);class jr{constructor(e){this.subjects=[...e],this.metadatas=this.getUniqueMetadatas(this.subjects)}sort(e){if(!this.metadatas.length)return this.subjects;const t=[];if("delete"===e){const e=this.subjects.filter((e=>!e.entity&&!e.databaseEntity));t.push(...e),this.removeAlreadySorted(e)}const n=this.getNonNullableDependencies();let i=this.toposort(n);"insert"===e&&(i=i.reverse()),i.forEach((e=>{const n=this.subjects.filter((t=>{var n;return t.metadata.targetName===e||(null===(n=t.metadata.parentEntityMetadata)||void 0===n?void 0:n.targetName)===e}));t.push(...n),this.removeAlreadySorted(n)}));const r=this.getDependencies();let a=this.toposort(r);return"insert"===e&&(a=a.reverse()),a.forEach((e=>{const n=this.subjects.filter((t=>t.metadata.targetName===e));t.push(...n),this.removeAlreadySorted(n)})),t.push(...this.subjects),t}removeAlreadySorted(e){e.forEach((e=>{this.subjects.splice(this.subjects.indexOf(e),1)}))}getUniqueMetadatas(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e.metadata)&&t.push(e.metadata)})),t}getNonNullableDependencies(){return this.metadatas.reduce(((e,t)=>(t.relationsWithJoinColumns.forEach((n=>{n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e)),[])}getDependencies(){return this.metadatas.reduce(((e,t)=>(t.relationsWithJoinColumns.forEach((n=>{n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e)),[])}toposort(e){const t=function(e){let t=[];for(let n=0,i=e.length;n<i;n++){let i=e[n];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e);let n=t.length,i=new Array(n),r={},a=n;for(;a--;)r[a]||s(t[a],a,[]);function s(a,o,c){if(c.indexOf(a)>=0)throw new Ji.VR("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new Ji.VR("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(r[o])return;r[o]=!0;let l=e.filter((function(e){return e[0]===a}));if(o=l.length){let e=c.concat(a);do{let n=l[--o][1];s(n,t.indexOf(n),e)}while(o)}i[--n]=a}return i}}Math.pow(10,8);var Br=6e4,Ur=36e5;function Vr(e,t){var n;!function(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}(1,arguments);var i=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}(null!==(n=null==t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==i&&1!==i&&0!==i)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r,a=function(e){var t,n={},i=e.split(Fr.dateTimeDelimiter);if(i.length>2)return n;/:/.test(i[0])?t=i[0]:(n.date=i[0],t=i[1],Fr.timeZoneDelimiter.test(n.date)&&(n.date=e.split(Fr.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length)));if(t){var r=Fr.timezone.exec(t);r?(n.time=t.replace(r[1],""),n.timezone=r[1]):n.time=t}return n}(e);if(a.date){var s=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),i=e.match(n);if(!i)return{year:NaN,restDateString:""};var r=i[1]?parseInt(i[1]):null,a=i[2]?parseInt(i[2]):null;return{year:null===a?r:100*a,restDateString:e.slice((i[1]||i[2]).length)}}(a.date,i);r=function(e,t){if(null===t)return new Date(NaN);var n=e.match(Kr);if(!n)return new Date(NaN);var i=!!n[4],r=Qr(n[1]),a=Qr(n[2])-1,s=Qr(n[3]),o=Qr(n[4]),c=Qr(n[5])-1;if(i)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,o,c)?function(e,t,n){var i=new Date(0);i.setUTCFullYear(e,0,4);var r=i.getUTCDay()||7,a=7*(t-1)+n+1-r;return i.setUTCDate(i.getUTCDate()+a),i}(t,o,c):new Date(NaN);var l=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Gr[t]||(Yr(e)?29:28))}(t,a,s)&&function(e,t){return t>=1&&t<=(Yr(e)?366:365)}(t,r)?(l.setUTCFullYear(t,a,Math.max(r,s)),l):new Date(NaN)}(s.restDateString,s.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);var o,c=r.getTime(),l=0;if(a.time&&(l=function(e){var t=e.match(Wr);if(!t)return NaN;var n=zr(t[1]),i=zr(t[2]),r=zr(t[3]);if(!function(e,t,n){if(24===e)return 0===t&&0===n;return n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,i,r))return NaN;return n*Ur+i*Br+1e3*r}(a.time),isNaN(l)))return new Date(NaN);if(!a.timezone){var u=new Date(c+l),d=new Date(0);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return o=function(e){if("Z"===e)return 0;var t=e.match(Hr);if(!t)return 0;var n="+"===t[1]?-1:1,i=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,r))return NaN;return n*(i*Ur+r*Br)}(a.timezone),isNaN(o)?new Date(NaN):new Date(c+l+o)}var Fr={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Kr=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Wr=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Hr=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Qr(e){return e?parseInt(e):1}function zr(e){return e&&parseFloat(e.replace(",","."))||0}var Gr=[31,null,31,30,31,30,31,31,30,31,30,31];function Yr(e){return e%400==0||e%4==0&&e%100!=0}class Jr{static normalizeHydratedDate(e){return e&&"string"==typeof e?new Date(e):e}static mixedDateToDateString(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e}static mixedDateToDate(e,t=!1,n=!0){let i="string"==typeof e?Vr(e):e;return t&&(i=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds())),n||i.setUTCMilliseconds(0),i}static mixedDateToTimeString(e,t=!1){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e}static mixedTimeToDate(e){if("string"==typeof e){const[t,n,i]=e.split(":"),r=new Date;return t&&r.setHours(parseInt(t)),n&&r.setMinutes(parseInt(n)),i&&r.setSeconds(parseInt(i)),r}return e}static mixedTimeToString(e,t=!1){return"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map((e=>1===e.length?"0"+e:e)).join(":"):e}static mixedDateToDatetimeString(e,t){if("string"==typeof e&&(e=new Date(e)),e instanceof Date){let n=this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+=`.${this.formatMilliseconds(e.getMilliseconds())}`),e=n}return e}static mixedDateToUtcDatetimeString(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear(),4)+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e}static simpleArrayToString(e){return Array.isArray(e)?e.map((e=>String(e))).join(","):e}static stringToSimpleArray(e){return"string"==typeof e?e.length>0?e.split(","):[]:e}static simpleJsonToString(e){return JSON.stringify(e)}static stringToSimpleJson(e){return"string"==typeof e?JSON.parse(e):e}static simpleEnumToString(e){return""+e}static stringToSimpleEnum(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e}static formatZerolessValue(e,t=2){const n="0".repeat(t);return String(`${n}${e}`).slice(-t)}static formatMilliseconds(e){return e<10?"00"+e:e<100?"0"+e:String(e)}}var Xr=n(33324),Zr=n(88272),ea=n(1048).Buffer;class ta{compute(e){e.forEach((t=>{this.computeDiffColumns(t),this.computeDiffRelationalColumns(e,t)}))}computeDiffColumns(e){e.entity&&e.metadata.columns.forEach((t=>{if(t.isVirtual||t.isDiscriminator)return;const n=e.changeMaps.find((e=>e.column===t));n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);const i=t.getEntityValue(e.entity);if(void 0!==i){if(e.databaseEntity){const n="json"!==t.type&&"jsonb"!==t.type;let r=t.getEntityValue(e.databaseEntity,n);if(t.relationMetadata){const n=t.relationMetadata.getEntityValue(e.entity);if(null!=n)return}let a=i;if(null!==i){switch(t.type){case"date":a=Jr.mixedDateToDateString(i);break;case"time":case"time with time zone":case"time without time zone":case"timetz":a=Jr.mixedDateToTimeString(i);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":a=Jr.mixedDateToUtcDatetimeString(i),r=Jr.mixedDateToUtcDatetimeString(r);break;case"json":case"jsonb":if(Xr.m.deepCompare(i,r))return;break;case"simple-array":a=Jr.simpleArrayToString(i),r=Jr.simpleArrayToString(r);break;case"simple-enum":a=Jr.simpleEnumToString(i),r=Jr.simpleEnumToString(r);break;case"simple-json":a=Jr.simpleJsonToString(i),r=Jr.simpleJsonToString(r)}t.transformer&&(a=Zr.W.transformTo(t.transformer,i))}if(ea.isBuffer(a)&&ea.isBuffer(r)){if(a.equals(r))return}else if(a===r)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:i})}}))}computeDiffRelationalColumns(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach((n=>{let i=n.getEntityValue(t.entity);if(void 0===i)return;if(t.databaseEntity){let e=i;null!==e&&Rr.B.isObject(e)&&(e=n.getRelationIdMap(e));const r=n.getEntityValue(t.databaseEntity);if(Xr.m.compareIds(e,r))return;t.diffRelations.push(n)}const r=e.find((e=>e.mustBeInserted&&e.entity===i));r&&(i=r);const a=t.changeMaps.find((e=>e.relation===n));a?a.value=i:t.changeMaps.push({relation:n,value:i})}))}}var na=n(45046),ia=n(83159),ra=n(1746);class aa extends Tr.V{constructor(){super("Nested sets do not support multiple root entities.")}}class sa{constructor(e){this.queryRunner=e}async insert(e){const t=e=>this.queryRunner.connection.driver.escape(e),n=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),r=t(e.metadata.nestedSetRightColumn.databaseName);let a=e.metadata.treeParentRelation.getEntityValue(e.entity);!a&&e.parentSubject&&e.parentSubject.entity&&(a=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const s=e.metadata.getEntityIdMap(a);let o;if(s&&(o=await this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then((e=>{const t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t}))),void 0!==o)await this.queryRunner.query(`UPDATE ${n} SET ${i} = CASE WHEN ${i} > ${o} THEN ${i} + 2 ELSE ${i} END,${r} = ${r} + 2 WHERE ${r} >= ${o}`),Xr.m.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(o),e.metadata.nestedSetRightColumn.createValueMap(o+1));else{if(!await this.isUniqueRootEntity(e,a))throw new aa;Xr.m.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2))}}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;if(!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n))))),void 0===n||void 0===t)return;const i=e.metadata.treeParentRelation.getEntityValue(n),r=e.metadata.getEntityIdMap(i),a=e.metadata.getEntityIdMap(t);if(!Xr.m.compareIds(r,a))if(t){const t=e=>this.queryRunner.connection.driver.escape(e),i=this.getTableName(e.metadata.tablePath),r=t(e.metadata.nestedSetLeftColumn.databaseName),s=t(e.metadata.nestedSetRightColumn.databaseName),o=e.metadata.getEntityIdMap(n);let c,l;if(o&&(c=(await this.getNestedSetIds(e.metadata,o))[0]),a&&(l=(await this.getNestedSetIds(e.metadata,a))[0]),void 0!==c&&void 0!==l){const e=l.left>c.left,t=c.right-c.left+1;let n;n=e?l.left-c.right:l.right-c.left;const a=`WHEN ${r} >= ${c.left} AND ${r} < ${c.right} THEN ${r} + ${n} `,o=`WHEN ${s} > ${c.left} AND ${s} <= ${c.right} THEN ${s} + ${n} `;e?await this.queryRunner.query(`UPDATE ${i} SET ${r} = CASE WHEN ${r} > ${c.right} AND ${r} <= ${l.left} THEN ${r} - ${t} `+a+`ELSE ${r} END, `+`${s} = CASE `+`WHEN ${s} > ${c.right} AND `+`${s} < ${l.left} `+`THEN ${s} - ${t} `+o+`ELSE ${s} END`):await this.queryRunner.query(`UPDATE ${i} SET ${r} = CASE WHEN ${r} < ${c.left} AND ${r} > ${l.right} THEN ${r} + ${t} `+a+`ELSE ${r} END, `+`${s} = CASE `+`WHEN ${s} < ${c.left} AND `+`${s} >= ${l.right} `+`THEN ${s} + ${t} `+o+`ELSE ${s} END`)}}else{if(!await this.isUniqueRootEntity(e,t))throw new aa}}async remove(e){Array.isArray(e)||(e=[e]);const t=e[0].metadata,n=e=>this.queryRunner.connection.driver.escape(e),i=this.getTableName(t.tablePath),r=n(t.nestedSetLeftColumn.databaseName),a=n(t.nestedSetRightColumn.databaseName);let s=[];for(const n of e){const e=t.getEntityIdMap(n.entity);e&&s.push(e)}let o=await this.getNestedSetIds(t,s);for(const e of o){const t=e.right-e.left+1;await this.queryRunner.query(`UPDATE ${i} SET ${r} = CASE WHEN ${r} > ${e.left} THEN ${r} - ${t} ELSE ${r} END, ${a} = CASE WHEN ${a} > ${e.right} THEN ${a} - ${t} ELSE ${a} END`)}}getNestedSetIds(e,t){const n={left:`${e.targetName}.${e.nestedSetLeftColumn.propertyPath}`,right:`${e.targetName}.${e.nestedSetRightColumn.propertyPath}`},i=this.queryRunner.manager.createQueryBuilder();return Object.entries(n).forEach((([e,t])=>{i.addSelect(t,e)})),i.from(e.target,e.targetName).whereInIds(t).orderBy(n.right,"DESC").getRawMany().then((e=>{const t=[];for(const i of e){const e={};for(const t of Object.keys(n)){const n=i?i[t]:void 0;e[t]="string"==typeof n?parseInt(n):n}t.push(e)}return t}))}async isUniqueRootEntity(e,t){const n=e=>this.queryRunner.connection.driver.escape(e),i=this.getTableName(e.metadata.tablePath),r=[],a=e.metadata.treeParentRelation.joinColumns.map((e=>{const i=n(e.databaseName),a=e.getEntityValue(t);if(null==a)return`${i} IS NULL`;r.push(a);return`${i} = ${this.queryRunner.connection.driver.createParameter("entity_"+e.databaseName,r.length-1)}`})).join(" AND "),s="count",o=await this.queryRunner.query(`SELECT COUNT(1) AS ${n(s)} FROM ${i} WHERE ${a}`,r,!0);return 0===parseInt(o.records[0][s])}getTableName(e){return e.split(".").map((e=>""===e?e:this.queryRunner.connection.driver.escape(e))).join(".")}}var oa=n(34165);class ca{constructor(e){this.queryRunner=e}async insert(e){const t={};e.metadata.closureJunctionTable.ancestorColumns.forEach((n=>{t[n.databaseName]=e.identifier})),e.metadata.closureJunctionTable.descendantColumns.forEach((n=>{t[n.databaseName]=e.identifier})),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute();let n=e.metadata.treeParentRelation.getEntityValue(e.entity);if(!n&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n){const t=e=>this.queryRunner.connection.driver.escape(e),i=this.getTableName(e.metadata.closureJunctionTable.tablePath),r=[],a=e.metadata.closureJunctionTable.ancestorColumns.map((e=>t(e.databaseName))),s=e.metadata.closureJunctionTable.descendantColumns.map((e=>t(e.databaseName))),o=e.metadata.primaryColumns.map((t=>(r.push(t.getEntityValue(e.insertedValueSet?e.insertedValueSet:e.entity)),this.queryRunner.connection.driver.createParameter("child_entity_"+t.databaseName,r.length-1)))),c=e.metadata.closureJunctionTable.descendantColumns.map((i=>{const a=t(i.databaseName),s=i.referencedColumn.getEntityValue(n);if(!s)throw new oa.T(e.metadata.name);r.push(s);return`${a} = ${this.queryRunner.connection.driver.createParameter("parent_entity_"+i.referencedColumn.databaseName,r.length-1)}`}));await this.queryRunner.query(`INSERT INTO ${i} (${[...a,...s].join(", ")}) SELECT ${a.join(", ")}, ${o.join(", ")} FROM ${i} WHERE ${c.join(" AND ")}`,r)}}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;if(!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n))))),void 0===n||void 0===t)return;const i=e.metadata.treeParentRelation.getEntityValue(n),r=e.metadata.getEntityIdMap(i),a=e.metadata.getEntityIdMap(t);if(Xr.m.compareIds(r,a))return;const s=e=>this.queryRunner.connection.driver.escape(e),o=e.metadata.closureJunctionTable,c=o.ancestorColumns.map((e=>s(e.databaseName))),l=o.descendantColumns.map((e=>s(e.databaseName))),u=(e,t)=>{const n=`sub${t}`,i=e.createQueryBuilder().select(l.join(", ")).from(o.tablePath,n);for(const e of o.ancestorColumns)i.andWhere(`${s(n)}.${s(e.databaseName)} = :value_${e.referencedColumn.databaseName}`);return e.createQueryBuilder().select(l.join(", ")).from(`(${i.getQuery()})`,t).setParameters(i.getParameters()).getQuery()},d={};for(const t of e.metadata.primaryColumns)d[`value_${t.databaseName}`]=n[t.databaseName];if(await this.queryRunner.manager.createQueryBuilder().delete().from(o.tablePath).where((e=>`(${l.join(", ")}) IN (${u(e,"descendant")})`)).andWhere((e=>`(${c.join(", ")}) NOT IN (${u(e,"ancestor")})`)).setParameters(d).execute(),t){const i=[],r=this.getTableName(o.tablePath),a=s("supertree"),u=s("subtree"),d=[...c.map((e=>`${a}.${e}`)),...l.map((e=>`${u}.${e}`))],h=e.metadata.closureJunctionTable.ancestorColumns.map((e=>{const t=s(e.databaseName),r=e.referencedColumn.getEntityValue(n);i.push(r);const a=this.queryRunner.connection.driver.createParameter("entity_"+e.referencedColumn.databaseName,i.length-1);return`${u}.${t} = ${a}`})),p=e.metadata.closureJunctionTable.descendantColumns.map((n=>{const r=s(n.databaseName),o=n.referencedColumn.getEntityValue(t);if(!o)throw new oa.T(e.metadata.name);i.push(o);const c=this.queryRunner.connection.driver.createParameter("parent_entity_"+n.referencedColumn.databaseName,i.length-1);return`${a}.${r} = ${c}`}));await this.queryRunner.query(`INSERT INTO ${r} (${[...c,...l].join(", ")}) SELECT ${d.join(", ")} FROM ${r} AS ${a}, ${r} AS ${u} WHERE ${[...h,...p].join(" AND ")}`,i)}}async remove(e){if("mssql"!==this.queryRunner.connection.driver.options.type)return;Array.isArray(e)||(e=[e]);const t=e=>this.queryRunner.connection.driver.escape(e),n=e.map((e=>e.identifier)),i=e[0].metadata.closureJunctionTable,r=e=>e.map((e=>{const i=n.map((t=>t[e.referencedColumn.databaseName]));return`${t(e.databaseName)} IN (${i.join(", ")})`})).join(" AND "),a=r(i.ancestorColumns),s=r(i.descendantColumns);await this.queryRunner.manager.createQueryBuilder().delete().from(i.tablePath).where(a).orWhere(s).execute()}getTableName(e){return e.split(".").map((e=>""===e?e:this.queryRunner.connection.driver.escape(e))).join(".")}}class la{constructor(e){this.queryRunner=e}async insert(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const n=e.metadata.getEntityIdMap(t);let i="";n&&(i=await this.getEntityPath(e,n));const r=e.metadata.treeParentRelation.joinColumns.map((t=>t.referencedColumn.getEntityValue(e.insertedValueSet))).join("_");await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[e.metadata.materializedPathColumn.propertyPath]:i+r+"."}).where(e.identifier).execute()}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n)))));const i=e.metadata.treeParentRelation.getEntityValue(n),r=e.metadata.getEntityIdMap(i),a=e.metadata.getEntityIdMap(t);if(Xr.m.compareIds(r,a))return;let s="";a&&(s=await this.getEntityPath(e,a));let o="";r&&(o=await this.getEntityPath(e,r)||"");const c=e.metadata.treeParentRelation.joinColumns.map((e=>e.referencedColumn.getEntityValue(n))).join("_"),l=e.metadata.materializedPathColumn.propertyPath;await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[l]:()=>`REPLACE(${l}, '${o}${c}.', '${s}${c}.')`}).where(`${l} LIKE :path`,{path:`${o}${c}.%`}).execute()}getEntityPath(e,t){return this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(t).getRawOne().then((e=>e?e.path:""))}}class ua{constructor(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}async execute(){let e;this.options&&!1===this.options.listeners||(e=this.broadcastBeforeEventsForAll(),e.promises.length>0&&await Promise.all(e.promises)),e&&e.count>0&&(this.insertSubjects.forEach((e=>e.recompute())),this.updateSubjects.forEach((e=>e.recompute())),this.removeSubjects.forEach((e=>e.recompute())),this.softRemoveSubjects.forEach((e=>e.recompute())),this.recoverSubjects.forEach((e=>e.recompute())),this.recompute()),this.insertSubjects=new jr(this.insertSubjects).sort("insert"),await this.executeInsertOperations(),this.updateSubjects=this.allSubjects.filter((e=>e.mustBeUpdated)),await this.executeUpdateOperations(),this.removeSubjects=new jr(this.removeSubjects).sort("delete"),await this.executeRemoveOperations(),this.softRemoveSubjects=this.allSubjects.filter((e=>e.mustBeSoftRemoved)),await this.executeSoftRemoveOperations(),this.recoverSubjects=this.allSubjects.filter((e=>e.mustBeRecovered)),await this.executeRecoverOperations(),await this.updateSpecialColumnsInPersistedEntities(),this.options&&!1===this.options.listeners||(e=this.broadcastAfterEventsForAll(),e.promises.length>0&&await Promise.all(e.promises))}validate(){this.allSubjects.forEach((e=>{if(e.mustBeUpdated&&e.mustBeRemoved)throw new ia.j(e)}))}recompute(){(new ta).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter((e=>e.mustBeInserted)),this.updateSubjects=this.allSubjects.filter((e=>e.mustBeUpdated)),this.removeSubjects=this.allSubjects.filter((e=>e.mustBeRemoved)),this.softRemoveSubjects=this.allSubjects.filter((e=>e.mustBeSoftRemoved)),this.recoverSubjects=this.allSubjects.filter((e=>e.mustBeRecovered)),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0}broadcastBeforeEventsForAll(){const e=new ra.M;return this.insertSubjects.length&&this.insertSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeInsertEvent(e,t.metadata,t.entity))),this.updateSubjects.length&&this.updateSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,t.metadata,t.entity,t.databaseEntity,t.diffColumns,t.diffRelations))),this.removeSubjects.length&&this.removeSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeSoftRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.recoverSubjects.length&&this.recoverSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeRecoverEvent(e,t.metadata,t.entity,t.databaseEntity))),e}broadcastAfterEventsForAll(){const e=new ra.M;return this.insertSubjects.length&&this.insertSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterInsertEvent(e,t.metadata,t.entity))),this.updateSubjects.length&&this.updateSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,t.metadata,t.entity,t.databaseEntity,t.diffColumns,t.diffRelations))),this.removeSubjects.length&&this.removeSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterSoftRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.recoverSubjects.length&&this.recoverSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterRecoverEvent(e,t.metadata,t.entity,t.databaseEntity))),e}async executeInsertOperations(){const[e,t]=this.groupBulkSubjects(this.insertSubjects,"insert");for(const n of t){const t=e[n],i=[],r=[],a=[];if("mongodb"===this.queryRunner.connection.driver.options.type?t.forEach((e=>{e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),r.push(e),i.push(e.entity)})):"oracle"===this.queryRunner.connection.driver.options.type?t.forEach((e=>{a.push(e)})):t.forEach((e=>{0===e.changeMaps.length||e.metadata.treeType||"oracle"===this.queryRunner.connection.driver.options.type||"sap"===this.queryRunner.connection.driver.options.type?a.push(e):(r.push(e),i.push(e.createValueSetAndPopChangeMap()))})),cr.t.isMongoEntityManager(this.queryRunner.manager)){const e=await this.queryRunner.manager.insert(t[0].metadata.target,i);t.forEach(((t,n)=>{t.identifier=e.identifiers[n],t.generatedMap=e.generatedMaps[n],t.insertedValueSet=i[n]}))}else{if(i.length>0){const e=await this.queryRunner.manager.createQueryBuilder().insert().into(t[0].metadata.target).values(i).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute();r.forEach(((t,n)=>{t.identifier=e.identifiers[n],t.generatedMap=e.generatedMaps[n],t.insertedValueSet=i[n]}))}if(a.length>0)for(const e of a)e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"===e.metadata.treeType&&await new sa(this.queryRunner).insert(e),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute().then((t=>{e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]})),"closure-table"===e.metadata.treeType?await new ca(this.queryRunner).insert(e):"materialized-path"===e.metadata.treeType&&await new la(this.queryRunner).insert(e)}t.forEach((e=>{e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const i=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,i)}}))}))}}async executeUpdateOperations(){const e=async e=>{if(!e.identifier)throw new na.S(e);if(cr.t.isMongoEntityManager(this.queryRunner.manager)){const t=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete t[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete t[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(t[e.metadata.updateDateColumn.propertyName]=new Date);const n=this.queryRunner.manager;await n.update(e.metadata.target,e.identifier,t)}else{const t=e.createValueSetAndPopChangeMap();switch(e.metadata.treeType){case"nested-set":await new sa(this.queryRunner).update(e);break;case"closure-table":await new ca(this.queryRunner).update(e);break;case"materialized-path":await new la(this.queryRunner).update(e)}const n=this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set(t).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier);let i=(await n.execute()).generatedMaps[0];i&&(e.metadata.columns.forEach((e=>{const t=e.getEntityValue(i);if(null!=t){const n=this.queryRunner.connection.driver.prepareHydratedValue(t,e);e.setEntityValue(i,n)}})),e.generatedMap||(e.generatedMap={}),Object.assign(e.generatedMap,i))}},t=[],n=[];for(const e of this.updateSubjects)"nested-set"===e.metadata.treeType?t.push(e):n.push(e);const i=new Promise((async(n,i)=>{for(const n of t)try{await e(n)}catch(e){i(e)}n()}));await Promise.all([...n.map(e),i])}async executeRemoveOperations(){const[e,t]=this.groupBulkSubjects(this.removeSubjects,"delete");for(const n of t){const t=e[n],i=t.map((e=>{if(!e.identifier)throw new na.S(e);return e.identifier}));if(cr.t.isMongoEntityManager(this.queryRunner.manager)){const e=this.queryRunner.manager;await e.delete(t[0].metadata.target,i)}else{switch(t[0].metadata.treeType){case"nested-set":await new sa(this.queryRunner).remove(t);break;case"closure-table":await new ca(this.queryRunner).remove(t)}await this.queryRunner.manager.createQueryBuilder().delete().from(t[0].metadata.target).where(i).callListeners(!1).execute()}}}cloneMongoSubjectEntity(e){const t={};if(e.entity)for(const n of e.metadata.columns)Xr.m.mergeDeep(t,n.getEntityValueMap(e.entity));return t}async executeSoftRemoveOperations(){await Promise.all(this.softRemoveSubjects.map((async e=>{if(!e.identifier)throw new na.S(e);let t;if(cr.t.isMongoEntityManager(this.queryRunner.manager)){const n=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete n[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete n[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(n[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(n[e.metadata.deleteDateColumn.propertyName]=new Date);const i=this.queryRunner.manager;t=await i.update(e.metadata.target,e.identifier,n)}else{const n=this.queryRunner.manager.createQueryBuilder().softDelete().from(e.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier),t=await n.execute()}e.generatedMap=t.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const i=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,i)}}))})))}async executeRecoverOperations(){await Promise.all(this.recoverSubjects.map((async e=>{if(!e.identifier)throw new na.S(e);let t;if(cr.t.isMongoEntityManager(this.queryRunner.manager)){const n=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete n[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete n[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(n[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(n[e.metadata.deleteDateColumn.propertyName]=null);const i=this.queryRunner.manager;t=await i.update(e.metadata.target,e.identifier,n)}else{const n=this.queryRunner.manager.createQueryBuilder().restore().from(e.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier),t=await n.execute()}e.generatedMap=t.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const i=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,i)}}))})))}updateSpecialColumnsInPersistedEntities(){this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.softRemoveSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.recoverSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach((e=>{e.entity&&e.metadata.primaryColumns.forEach((t=>{t.setEntityValue(e.entity,void 0)}))})),this.allSubjects.forEach((e=>{e.entity&&(e.metadata.relationIds.forEach((t=>{t.setValue(e.entity)})),cr.t.isMongoEntityManager(this.queryRunner.manager)&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.databaseName&&e.metadata.objectIdColumn.databaseName!==e.metadata.objectIdColumn.propertyName&&delete e.entity[e.metadata.objectIdColumn.databaseName])}))}updateSpecialColumnsInInsertedAndUpdatedEntities(e){e.forEach((e=>{e.entity&&(e.metadata.columns.forEach((t=>{if(!(e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map((e=>e.target)).indexOf(t.target)||t.isVirtual)){if(t.isNullable){void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null)}e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach((t=>{t.relation.joinColumns.forEach((n=>{!0!==n.isVirtual&&n.setEntityValue(e.entity,Rr.B.isObject(t.value)?n.referencedColumn.getEntityValue(t.value):t.value)}))}))}})),e.generatedMap&&this.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))}))}groupBulkSubjects(e,t){const n={},i=[],r=e.some((e=>e.metadata.getInsertionReturningColumns().length>0)),a="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported("insert")||!1===r;return e.forEach(((e,t)=>{const r=a||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[r]?n[r].push(e):(n[r]=[e],i.push(r))})),[n,i]}}var da=n(11866),ha=n(1048).Buffer;class pa{constructor(e){this["@instanceof"]=Symbol.for("Subject"),this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&this.changeMaps.push(...e.changeMaps),this.recompute()}get mustBeInserted(){return this.canBeInserted&&!this.databaseEntity}get mustBeUpdated(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0}get mustBeSoftRemoved(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)}get mustBeRecovered(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)}createValueSetAndPopChangeMap(){const e=[],t=this.changeMaps.reduce(((t,n)=>{let i,r=n.value;if(cr.t.isSubject(r)&&(r=r.insertedValueSet?r.insertedValueSet:r.entity),this.metadata.isJunction&&n.column)i=n.column.createValueMap(n.column.referencedColumn.getEntityValue(r));else if(n.column)i=n.column.createValueMap(r);else if(n.relation)if(Rr.B.isObject(r)&&!ha.isBuffer(r)){const a=n.relation.getRelationIdMap(r);if(void 0===a)return e.push(n),this.canBeUpdated=!0,t;i=n.relation.createValueMap(a),this.updatedRelationMaps.push({relation:n.relation,value:a})}else i=n.relation.createValueMap(r),this.updatedRelationMaps.push({relation:n.relation,value:r});return Xr.m.mergeDeep(t,i),t}),{});return this.changeMaps=e,t}recompute(){this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach((e=>{if(e.relationMetadata&&e.relationMetadata.inverseEntityMetadata===this.parentSubject.metadata){const t=e.referencedColumn.getEntityValue(this.parentSubject.entity);e.setEntityValue(this.entityWithFulfilledIds,t)}})),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))}}var ma=n(28028),fa=n(45200);class ya{constructor(e){this["@instanceof"]=Symbol.for("EntityMetadata"),this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.beforeSoftRemoveListeners=[],this.beforeRecoverListeners=[],this.afterRemoveListeners=[],this.afterSoftRemoveListeners=[],this.afterRecoverListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid,this.dependsOn=this.tableMetadataArgs.dependsOn}create(e,t){const n=!(!t||!0!==t.pojo);let i;return i="function"!=typeof this.target||n?{}:!(null==t?void 0:t.fromDeserializer)||this.isAlwaysUsingConstructor?new this.target:Object.create(this.target.prototype),this.connection.options.typename&&(i[this.connection.options.typename]=this.targetName),this.lazyRelations.forEach((t=>this.connection.relationLoader.enableLazyLoad(t,i,e))),i}hasId(e){return!!e&&this.primaryColumns.every((t=>{const n=t.getEntityValue(e);return null!=n&&""!==n}))}hasAllPrimaryKeys(e){return this.primaryColumns.every((t=>{const n=t.getEntityValue(e);return null!=n}))}ensureEntityIdMap(e){if(Rr.B.isObject(e))return e;if(this.hasMultiplePrimaryKeys)throw new ma.m(this,e);return this.primaryColumns[0].createValueMap(e)}getEntityIdMap(e){if(e)return ya.getValueMap(e,this.primaryColumns,{skipNulls:!0})}getEntityIdMixedMap(e){if(!e)return e;const t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t}compareEntities(e,t){const n=this.getEntityIdMap(e);if(!n)return!1;const i=this.getEntityIdMap(t);return!!i&&Xr.m.compareIds(n,i)}findColumnWithPropertyName(e){return this.columns.find((t=>t.propertyName===e))}findColumnWithDatabaseName(e){return this.columns.find((t=>t.databaseName===e))}hasColumnWithPropertyPath(e){return this.columns.some((t=>t.propertyPath===e))||this.hasRelationWithPropertyPath(e)}findColumnWithPropertyPath(e){const t=this.columns.find((t=>t.propertyPath===e));if(t)return t;const n=this.relations.find((t=>t.propertyPath===e));return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0}findColumnWithPropertyPathStrict(e){return this.columns.find((t=>t.propertyPath===e))}findColumnsWithPropertyPath(e){const t=this.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.findRelationWithPropertyPath(e);return n&&n.joinColumns?n.joinColumns:[]}hasRelationWithPropertyPath(e){return this.relations.some((t=>t.propertyPath===e))}findRelationWithPropertyPath(e){return this.relations.find((t=>t.propertyPath===e))}hasEmbeddedWithPropertyPath(e){return this.allEmbeddeds.some((t=>t.propertyPath===e))}findEmbeddedWithPropertyPath(e){return this.allEmbeddeds.find((t=>t.propertyPath===e))}mapPropertyPathsToColumns(e){return e.map((e=>{const t=this.findColumnWithPropertyPath(e);if(null==t)throw new fa.K(e,this);return t}))}extractRelationValuesFromEntity(e,t){const n=[];return t.forEach((t=>{const i=t.getEntityValue(e);Array.isArray(i)?i.forEach((e=>n.push([t,e,this.getInverseEntityMetadata(e,t)]))):i&&n.push([t,i,this.getInverseEntityMetadata(i,t)])})),n}getInverseEntityMetadata(e,t){const n=t.inverseEntityMetadata.childEntityMetadatas.find((t=>t.target===e.constructor));return n||t.inverseEntityMetadata}static createPropertyPath(e,t,n=""){const i=[];return Object.keys(t).forEach((r=>{const a=n?n+"."+r:r;if(e.hasEmbeddedWithPropertyPath(a)){const n=this.createPropertyPath(e,t[r],a);i.push(...n)}else{const e=n?n+"."+r:r;i.push(e)}})),i}static difference(e,t){return e.filter((e=>!t.find((t=>Xr.m.compareIds(e,t)))))}static getValueMap(e,t,n){return t.reduce(((t,i)=>{const r=i.getEntityValueMap(e,n);if(void 0!==t&&null!=r)return Xr.m.mergeDeep(t,r)}),{})}build(){var e;const t=this.connection.namingStrategy,n=this.connection.options.entityPrefix,i=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:(null===(e=this.connection.options)||void 0===e?void 0:e.hasOwnProperty("schema"))&&(this.schema=this.connection.options.schema),this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName="function"==typeof this.tableMetadataArgs.target?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=t.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=t.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=t.tableName(this.targetName,this.givenTableName),"junction"===this.tableMetadataArgs.type&&this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,Gi.ml)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy="function"==typeof this.tableMetadataArgs.orderBy?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,void 0!==i&&(this.isAlwaysUsingConstructor=!i),this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type}registerColumn(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce(((e,t)=>e.concat(t.columnsFromTree)),this.ownColumns),this.primaryColumns=this.columns.filter((e=>e.isPrimary)),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter((e=>e.isGenerated||"uuid"===e.generationStrategy)).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach((t=>t.registerColumn(e))))}createPropertiesMap(){const e={};return this.columns.forEach((t=>Xr.m.mergeDeep(e,t.createValueMap(t.propertyPath)))),this.relations.forEach((t=>Xr.m.mergeDeep(e,t.createValueMap(t.propertyPath)))),e}getInsertionReturningColumns(){return this.columns.filter((e=>void 0!==e.default||e.isGenerated||e.isCreateDate||e.isUpdateDate||e.isDeleteDate||e.isVersion))}}class ga{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.metadata.oneToManyRelations.forEach((t=>{!1!==t.persistenceEnabled&&this.buildForSubjectRelation(e,t)}))}))}buildForSubjectRelation(e,t){let n=[];if(e.databaseEntity){const i=t.getEntityValue(e.databaseEntity);i&&(n=i.map((e=>t.inverseEntityMetadata.getEntityIdMap(e))))}let i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0===i)return;const r=[];i.forEach((i=>{let a=t.inverseEntityMetadata.getEntityIdMap(i),s=this.subjects.find((e=>e.entity===i));if(s&&(a=s.identifier),!a){if(!s)return;return void s.changeMaps.push({relation:t.inverseRelation,value:e})}n.find((e=>Xr.m.compareIds(a,e)))||(s||(s=new pa({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:a}),this.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),r.push(a)})),ya.difference(n,r).forEach((n=>{const i=new pa({metadata:t.inverseEntityMetadata,parentSubject:e,identifier:n});t.inverseRelation&&"nullify"!==t.inverseRelation.orphanedRowAction?"delete"===t.inverseRelation.orphanedRowAction?i.mustBeRemoved=!0:"soft-delete"===t.inverseRelation.orphanedRowAction&&(i.canBeSoftRemoved=!0):(i.canBeUpdated=!0,i.changeMaps=[{relation:t.inverseRelation,value:null}]),this.subjects.push(i)}))}}class ba{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.metadata.oneToOneRelations.forEach((t=>{t.isOwning||!1===t.persistenceEnabled||this.buildForSubjectRelation(e,t)}))}))}buildForSubjectRelation(e,t){let n;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));let i=t.getEntityValue(e.entity);if(void 0===i)return;if(null===i){if(n){const i=new pa({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(i)}return}let r=t.inverseEntityMetadata.getEntityIdMap(i),a=this.subjects.find((e=>!!e.entity&&e.entity===i));if(a&&(r=a.identifier),!r){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&Xr.m.compareIds(r,n)||(a||(a=new pa({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:r}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}}class wa{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.entity&&e.metadata.manyToManyRelations.forEach((t=>{!1!==t.persistenceEnabled&&this.buildForSubjectRelation(e,t)}))}))}buildForAllRemoval(e){e.databaseEntity&&e.metadata.manyToManyRelations.forEach((t=>{if(!1===t.persistenceEnabled)return;t.getEntityValue(e.databaseEntity).forEach((n=>{const i=new pa({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,t,n)});this.subjects.push(i)}))}))}buildForSubjectRelation(e,t){let n=[];e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));let i=t.getEntityValue(e.entity);if(null===i&&(i=[]),!Array.isArray(i))return;i.forEach((i=>{let r=t.inverseEntityMetadata.getEntityIdMap(i);const a=this.subjects.find((e=>e.entity===i));if(a&&(r=a.identifier),!r&&!a)return;if(n.find((e=>Xr.m.compareIds(e,r))))return;const s=t.isOwning?e:a||i,o=t.isOwning?a||i:e,c=new pa({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});this.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach((e=>{c.changeMaps.push({column:e,value:s})})),t.junctionEntityMetadata.inverseColumns.forEach((e=>{c.changeMaps.push({column:e,value:o})}))}));const r=[];i.forEach((e=>{let n=t.inverseEntityMetadata.getEntityIdMap(e);const i=this.subjects.find((t=>t.entity===e));i&&(n=i.identifier),null!=n&&r.push(n)}));n.filter((e=>!r.find((t=>Xr.m.compareIds(t,e))))).forEach((n=>{const i=new pa({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,t,n)});this.subjects.push(i)}))}buildJunctionIdentifier(e,t,n){const i=t.isOwning?e.entity:n,r=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach((e=>{Xr.m.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))})),t.junctionEntityMetadata.inverseColumns.forEach((e=>{Xr.m.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))})),a}}class _a{constructor(e,t){this.queryRunner=e,this.subjects=t}async load(e){const t=this.groupByEntityTargets().map((async t=>{const n=[],i=[];if(t.subjects.forEach((e=>{!e.databaseEntity&&e.identifier&&(n.push(e.identifier),i.push(e))})),!n.length)return;const r=[];"save"===e||"soft-remove"===e||"recover"===e?t.subjects.forEach((e=>{e.metadata.relations.forEach((t=>{void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===r.indexOf(t.propertyPath)&&r.push(t.propertyPath)}))})):r.push(...t.subjects[0].metadata.manyToManyRelations.map((e=>e.propertyPath)));const a={loadEagerRelations:!1,loadRelationIds:{relations:r,disableMixedMap:!0},withDeleted:!0};let s=[];if("mongodb"===this.queryRunner.connection.driver.options.type){const e=this.queryRunner.manager.getRepository(t.target);s=await e.findByIds(n,a)}else s=await this.queryRunner.manager.getRepository(t.target).createQueryBuilder().setFindOptions(a).whereInIds(n).getMany();s.forEach((e=>{this.findByPersistEntityLike(t.target,e).forEach((t=>{t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)}))}));for(let e of i)e.databaseEntityLoaded=!0}));await Promise.all(t)}findByPersistEntityLike(e,t){return this.subjects.filter((n=>!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))))}groupByEntityTargets(){return this.subjects.reduce(((e,t)=>{let n=e.find((e=>e.target===t.metadata.target));return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e}),[])}}class va{constructor(e){this.allSubjects=e}build(e,t){e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach((([n,i,r])=>{if(null==i||!n.isCascadeInsert&&!n.isCascadeUpdate&&!n.isCascadeSoftRemove&&!n.isCascadeRecover)return;if(!Rr.B.isObject(i))return;const a=this.findByPersistEntityLike(r.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===n.isCascadeInsert&&"save"===t),!1===a.canBeUpdated&&(a.canBeUpdated=!0===n.isCascadeUpdate&&"save"===t),!1===a.canBeSoftRemoved&&(a.canBeSoftRemoved=!0===n.isCascadeSoftRemove&&"soft-remove"===t),void(!1===a.canBeRecovered&&(a.canBeRecovered=!0===n.isCascadeRecover&&"recover"===t));const s=new pa({metadata:r,parentSubject:e,entity:i,canBeInserted:!0===n.isCascadeInsert&&"save"===t,canBeUpdated:!0===n.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===n.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===n.isCascadeRecover&&"recover"===t});this.allSubjects.push(s),this.build(s,t)}))}findByPersistEntityLike(e,t){return this.allSubjects.find((n=>!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))))}}class Ea{constructor(e,t,n,i,r,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=i,this.entity=r,this.options=a}async execute(){if(!this.entity||"object"!=typeof this.entity)return Promise.reject(new $r.k(this.mode,this.entity));await Promise.resolve();const e=this.queryRunner||this.connection.createQueryRunner();let t=e.data;this.options&&this.options.data&&(e.data=this.options.data);try{const t=Array.isArray(this.entity)?this.entity:[this.entity],n=this.options&&this.options.chunk&&this.options.chunk>0?Xr.m.chunk(t,this.options.chunk):[t],i=await Promise.all(n.map((async t=>{const n=[];t.forEach((e=>{const t=this.target?this.target:e.constructor;if(t===Object)throw new da.u(this.mode);let i=this.connection.getMetadata(t);if("STI"===i.inheritancePattern&&i.childEntityMetadatas.length>0){const t=i.childEntityMetadatas.find((t=>e.constructor===t.target));t&&(i=t)}n.push(new pa({metadata:i,entity:e,canBeInserted:"save"===this.mode,canBeUpdated:"save"===this.mode,mustBeRemoved:"remove"===this.mode,canBeSoftRemoved:"soft-remove"===this.mode,canBeRecovered:"recover"===this.mode}))}));const i=new va(n);return n.forEach((e=>{i.build(e,this.mode)})),await new _a(e,n).load(this.mode),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new ga(n).build(),new ba(n).build(),new wa(n).build()):n.forEach((e=>{e.mustBeRemoved&&new wa(n).buildForAllRemoval(e)})),new ua(e,n,this.options)}))),r=i.filter((e=>e.hasExecutableOperations));if(0===r.length)return;let a=!1;try{e.isTransactionActive||this.options&&!1===this.options.transaction||(a=!0,await e.startTransaction());for(const e of r)await e.execute();!0===a&&await e.commitTransaction()}catch(t){if(a)try{await e.rollbackTransaction()}catch(e){}throw t}}finally{e.data=t,this.queryRunner||await e.release()}}}class Ta{constructor(e,t){this["@instanceof"]=Symbol.for("EntityManager"),this.repositories=[],this.treeRepositories=[],this.plainObjectToEntityTransformer=new kr,this.connection=e,t&&(this.queryRunner=t,Rr.B.assign(this.queryRunner,{manager:this}))}async transaction(e,t){const n="string"==typeof e?e:void 0,i="function"==typeof e?e:t;if(!i)throw new Ji.VR("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new _r.h;const r=this.queryRunner||this.connection.createQueryRunner();try{await r.startTransaction(n);const e=await i(r.manager);return await r.commitTransaction(),e}catch(e){try{await r.rollbackTransaction()}catch(e){}throw e}finally{this.queryRunner||await r.release()}}async query(e,t){return this.connection.query(e,t,this.queryRunner)}createQueryBuilder(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)}hasId(e,t){const n=2===arguments.length?e:e.constructor,i=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(i)}getId(e,t){const n=2===arguments.length?e:e.constructor,i=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(i)}create(e,t){const n=this.connection.getMetadata(e);if(!t)return n.create(this.queryRunner);if(Array.isArray(t))return t.map((t=>this.create(e,t)));const i=n.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,n,!0),i}merge(e,t,...n){const i=this.connection.getMetadata(e);return n.forEach((e=>this.plainObjectToEntityTransformer.transform(t,e,i))),t}async preload(e,t){const n=this.connection.getMetadata(e),i=new Pr(this.connection.manager),r=await i.transform(t,n);if(r)return this.merge(e,r,t)}save(e,t,n){let i=arguments.length>1&&("function"==typeof e||cr.t.isEntitySchema(e)||"string"==typeof e)?e:void 0;const r=i?t:e,a=i?n:t;return cr.t.isEntitySchema(i)&&(i=i.options.name),Array.isArray(r)&&0===r.length?Promise.resolve(r):new Ea(this.connection,this.queryRunner,"save",i,r,a).execute().then((()=>r))}remove(e,t,n){const i=arguments.length>1&&("function"==typeof e||cr.t.isEntitySchema(e)||"string"==typeof e)?e:void 0,r=i?t:e,a=i?n:t;return Array.isArray(r)&&0===r.length?Promise.resolve(r):new Ea(this.connection,this.queryRunner,"remove",i,r,a).execute().then((()=>r))}softRemove(e,t,n){let i=arguments.length>1&&("function"==typeof e||cr.t.isEntitySchema(e)||"string"==typeof e)?e:void 0;const r=i?t:e,a=i?n:t;return cr.t.isEntitySchema(i)&&(i=i.options.name),Array.isArray(r)&&0===r.length?Promise.resolve(r):new Ea(this.connection,this.queryRunner,"soft-remove",i,r,a).execute().then((()=>r))}recover(e,t,n){let i=arguments.length>1&&("function"==typeof e||cr.t.isEntitySchema(e)||"string"==typeof e)?e:void 0;const r=i?t:e,a=i?n:t;return cr.t.isEntitySchema(i)&&(i=i.options.name),Array.isArray(r)&&0===r.length?Promise.resolve(r):new Ea(this.connection,this.queryRunner,"recover",i,r,a).execute().then((()=>r))}async insert(e,t){return this.createQueryBuilder().insert().into(e).values(t).execute()}async upsert(e,t,n){const i=this.connection.getMetadata(e);let r,a;r=Array.isArray(n)?{conflictPaths:n}:n,a=Array.isArray(t)?t:[t];const s=i.mapPropertyPathsToColumns(r.conflictPaths),o=i.columns.filter((e=>!s.includes(e)&&a.some((t=>void 0!==e.getEntityValue(t)))));return this.createQueryBuilder().insert().into(e).values(a).orUpdate([...s,...o].map((e=>e.databaseName)),s.map((e=>e.databaseName)),{skipUpdateIfNoValuesChanged:r.skipUpdateIfNoValuesChanged}).execute()}update(e,t,n){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Ji.VR("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()}delete(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Ji.VR("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()}softDelete(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Ji.VR("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()}restore(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Ji.VR("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()}count(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,Nr.H.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getCount()}countBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getCount()}async find(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,Nr.H.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getMany()}async findBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getMany()}findAndCount(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,Nr.H.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getManyAndCount()}findAndCountBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getManyAndCount()}async findByIds(e,t){if(!t.length)return Promise.resolve([]);const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).andWhereInIds(t).getMany()}async findOne(e,t){let n=this.connection.getMetadata(e).name;if(t&&t.join&&(n=t.join.alias),!t.where)throw new Error("You must provide selection conditions in order to find a single row.");return this.createQueryBuilder(e,n).setFindOptions({...t,take:1}).getOne()}async findOneBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t,take:1}).getOne()}async findOneById(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({take:1}).whereInIds(n.ensureEntityIdMap(t)).getOne()}async findOneOrFail(e,t){return this.findOne(e,t).then((n=>null===n?Promise.reject(new wr.p(e,t)):Promise.resolve(n)))}async findOneByOrFail(e,t){return this.findOneBy(e,t).then((n=>null===n?Promise.reject(new wr.p(e,t)):Promise.resolve(n)))}async clear(e){const t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner();try{return await n.clearTable(t.tablePath)}finally{this.queryRunner||await n.release()}}async increment(e,t,n,i){const r=this.connection.getMetadata(e),a=r.findColumnWithPropertyPath(n);if(!a)throw new Ji.VR(`Column ${n} was not found in ${r.targetName} entity.`);if(isNaN(Number(i)))throw new Ji.VR(`Value "${i}" is not a number.`);const s=n.split(".").reduceRight(((e,t)=>({[t]:e})),(()=>this.connection.driver.escape(a.databaseName)+" + "+i));return this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()}async decrement(e,t,n,i){const r=this.connection.getMetadata(e),a=r.findColumnWithPropertyPath(n);if(!a)throw new Ji.VR(`Column ${n} was not found in ${r.targetName} entity.`);if(isNaN(Number(i)))throw new Ji.VR(`Value "${i}" is not a number.`);const s=n.split(".").reduceRight(((e,t)=>({[t]:e})),(()=>this.connection.driver.escape(a.databaseName)+" - "+i));return this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()}getRepository(e){const t=this.repositories.find((t=>t.target===e));if(t)return t;if("mongodb"===this.connection.driver.options.type){const t=new Er.MongoRepository(e,this,this.queryRunner);return this.repositories.push(t),t}{const t=new Cr(e,this,this.queryRunner);return this.repositories.push(t),t}}getTreeRepository(e){if(!1===this.connection.driver.treeSupport)throw new Ji.ku(this.connection.driver);const t=this.treeRepositories.find((t=>t.target===e));if(t)return t;const n=new Mr(e,this,this.queryRunner);return this.treeRepositories.push(n),n}getMongoRepository(e){return this.connection.getMongoRepository(e)}withRepository(e){const t=e.constructor,{target:n,manager:i,queryRunner:r,...a}=e;return Object.assign(new t(e.target,this),{...a})}getCustomRepository(e){const t=po().entityRepositories.find((t=>t.target===("function"==typeof e?e:e.constructor)));if(!t)throw new Ji.zB(e);const n=t.entity?this.connection.getMetadata(t.entity):void 0,i=new t.target(this,n);if(i instanceof qr)i.manager||(i.manager=this);else{if(!n)throw new Ji.IU(e);i.manager=this,i.metadata=n}return i}async release(){if(!this.queryRunner)throw new vr.e;return this.queryRunner.release()}}class Na extends Ta{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("SqljsEntityManager"),this.driver=e.driver}async loadDatabase(e){await this.driver.load(e)}async saveDatabase(e){await this.driver.save(e)}exportDatabase(){return this.driver.export()}}var Aa=n(49015),Sa=n(41598);const xa=(e,t)=>n=>{if(cr.t.isFindOperator(t))switch(t.type){case"not":if(cr.t.isFindOperator(t._value)){const i=Ca(t._value,t.value);return xa(e,i)(n)}return n[e]!==t.value;case"equal":return n[e]===t.value;case"lessThan":return n[e]<t.value;case"lessThanOrEqual":return n[e]<=t.value;case"moreThan":return n[e]>t.value;case"moreThanOrEqual":return n[e]>=t.value;case"between":return n[e]>=t.value[0]&&n[e]<=t.value[1];case"notBetween":return n[e]<t.value[0]||n[e]>t.value[1];case"in":case"any":return"string"==typeof n[e]?t.value.map((e=>e.toString().toLowerCase())).includes(n[e].toLowerCase()):t.value.includes(n[e]);case"exclude":return"string"==typeof n[e]?!t.value.map((e=>e.toString().toLowerCase())).includes(n[e].toLowerCase()):!t.value.includes(n[e]);case"isNull":return null===n[e]||void 0===n[e];case"notNull":return null!==n[e]&&void 0!==n[e];case"arrayContains":case"arrayContainedBy":case"arrayOverlap":case"raw":case"ilike":case"like":throw new Error("Not supported for IndexedDB");default:return!1}return n[e]===t},Ca=(e,t)=>{return"lessThan"===e.type?(n=t,new Sa.q("moreThanOrEqual",n)):"lessThanOrEqual"===e.type?function(e){return new Sa.q("moreThan",e)}(t):"moreThan"===e.type?function(e){return new Sa.q("lessThanOrEqual",e)}(t):"moreThanOrEqual"===e.type?function(e){return new Sa.q("lessThan",e)}(t):"between"===e.type?new Sa.q("notBetween",t):"any"===e.type||"in"===e.type?new Sa.q("exclude",t):"isNull"===e.type&&new Sa.q("notNull",t);var n};var Ma=n(46763),Ra=n(38689);class ka extends Ta{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("IndexedDbEntityManager")}count(e,t){return this.getDexieTableForTarget(e).count()}async insert(e,t){const n=this.getDexieTableForTarget(e);return Array.isArray(t)?await n.bulkAdd(t):await n.add(t),new Aa.T}async find(e,t){return this.executeFind(e,t)}async findByIds(e,t,n){throw new Error("findByIds is deprecated. use findBy method instead in conjunction with In operator")}async findBy(e,t){return this.executeFind(e,t)}async findOne(e,t){return this.executeFindOne(e,t)}async findOneBy(e,t){return this.executeFindOne(e,t)}async findOneById(e,t){return this.executeFindOne(e,{where:{id:t}})}async update(e,t,n){const i=new Ma.L,r=this.getDexieTableForTarget(e),a=Object.keys(t),s=Object.values(t);try{const e=await r.where(a).equals(s).modify(n);i.affected=e}catch(e){i.affected=0}return i}async upsert(e,t,n){const i=new Aa.T,r=this.getDexieTableForTarget(e),a=Array.isArray(n)?n:n.conflictPaths;try{if(Array.isArray(t)){const e=await r.bulkPut(t,{allKeys:!0});for(const t of e)i.identifiers.push({id:(t||[]).join(",")})}else{const e=await r.put(t,a);i.identifiers.push({id:(e||[]).join(",")})}}catch(e){i.identifiers=[]}return i}async delete(e,t){const n=new Ra.P,i=this.getDexieTableForTarget(e);return"string"==typeof t||"number"==typeof t||t instanceof Date?n.affected=await i.where(["id"]).equals([t.toString()]).delete():Array.isArray(t)?await Promise.all(t.map((e=>i.where(["id"]).equals([e.toString()]).delete()))):n.affected=await i.where(Object.keys(t)).equals(Object.values(t)).delete(),n}async transaction(e,t){if("string"==typeof e)throw new Ji.VR("Cannot specify Isolation level for IndexedDB");const n="function"==typeof e?e:t,i="object"==typeof t?t:void 0;if(!n)throw new Ji.VR("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new Ji.hz;const r=this.queryRunner||this.connection.createQueryRunner(),a=this.connection.driver.dexie;let s;const o=i?i.entitiesToLock:Object.keys(a._allTables);return await a.transaction("rw",o,(async()=>{s=await n(r.manager)})),s}getDexieTableForTarget(e){const t=this.connection.driver,n=this.connection.getMetadata(e);return t.dexie._allTables[n.tableName]}async executeFind(e,t){const n=this.getDexieTableForTarget(e),i=this.convertPredicateToIndexedDbQuery(t),r=this.convertPredicateToIndexedDbSortingOptions(t);if(!i){let e=await this.applyTableSorting(n,r);return e=this.applyPagination(e,t),e.toArray()}if(this.requiresOptimizingForInOperator(i))return this.optimizeAnyOfIntoParallelQueries(n,i);let a=this.applyQueryFilter(n,i);return a=this.applyPagination(a,t),this.applyCollectionSorting(a,r)}async executeFindOne(e,t){const n=this.getDexieTableForTarget(e),i=this.convertPredicateToIndexedDbQuery(t);if(!i||0===Object.keys(i).length){const e=await n.limit(1).toArray();return e.length>0?e[0]:null}let r=await this.applyQueryFilter(n,i).limit(1).toArray();return r.length>0?r[0]:null}convertPredicateToIndexedDbQuery(e){if(e)return Nr.H.isFindManyOptions(e)?"string"==typeof e.where?{}:e.where:e}convertPredicateToIndexedDbSortingOptions(e){var t;let n={enabled:!1,columns:[],direction:"ASC"};if((Nr.H.isFindManyOptions(e)||Nr.H.isFindOneOptions(e))&&e.order){const i=Object.keys(e.order),r=Object.values(e.order);n.enabled=i.length>0,n.columns=i,n.direction=null!==(t=r[0])&&void 0!==t?t:"ASC"}return n}applyQueryFilter(e,t){let n=null;for(const[i,r]of Object.entries(t)){const t=xa(i,r);n=n?n.and(t):e.filter(t)}return null==n?e.toCollection():n}applyPagination(e,t){return Nr.H.isFindManyOptions(t)&&(t.skip&&(e=e.offset(t.skip)),t.take&&(e=e.limit(t.take))),e}async applyTableSorting(e,t){if(!t.enabled)return e.toCollection();let n=e.orderBy(t.columns);return"DESC"===t.direction&&(n=n.reverse()),n}async applyCollectionSorting(e,t){if(!t.enabled||0===t.columns.length)return e.toArray();return("DESC"===t.direction?e.reverse():e).sortBy(t.columns[0])}requiresOptimizingForInOperator(e){const t=Object.values(e).filter((e=>cr.t.isFindOperator(e)));return 1===t.length&&null!=t.find((e=>"in"===e.type))}async optimizeAnyOfIntoParallelQueries(e,t){const n=Object.keys(t)[0],i=t[n].value,r=await Promise.allSettled(i.map((async t=>e.where({[n]:t}).toArray()))),a=r.reduce(((e,t)=>("rejected"===t.status&&e.push(t),e)),[]);if(a.length>0&&/KeyPath (\w*) on object store (\w*) is not indexed/gi.test(a[0].reason))throw Error(a[0].reason);return(e=>e.reduce(((e,t)=>("fulfilled"===t.status&&e.push(...t.value),e)),[]))(r)}}class Oa{create(e,t){return"mongodb"===e.driver.options.type?new Er.MongoEntityManager(e):"sqljs"===e.driver.options.type?new Na(e,t):"indexeddb"===e.driver.options.type?new ka(e,t):new Ta(e,t)}}var Ia=n(86741);class Pa{constructor(e){this["@instanceof"]=Symbol.for("View"),e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}clone(){return new Pa({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})}static create(e,t){const n={database:e.database,schema:e.schema,name:t.buildTableName(e.tableName,e.schema,e.database),expression:e.expression,materialized:e.tableMetadataArgs.materialized};return new Pa(n)}}class Da{static viewMetadataCmp(e,t){return e&&t?e.dependsOn&&(e.dependsOn.has(t.target)||e.dependsOn.has(t.name))?1:t.dependsOn&&(t.dependsOn.has(e.target)||t.dependsOn.has(e.name))?-1:0:0}}class La{constructor(e){this.connection=e,this["@instanceof"]=Symbol.for("RdbmsSchemaBuilder")}async build(){this.queryRunner=this.connection.createQueryRunner(),this.currentDatabase=this.connection.driver.database,this.currentSchema=this.connection.driver.schema;const e=!("cockroachdb"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type||"none"===this.connection.options.migrationsTransactionMode);await this.queryRunner.beforeMigration(),e&&await this.queryRunner.startTransaction();try{await this.createMetadataTableIfNecessary(this.queryRunner);const t=this.entityToSyncMetadatas.map((e=>this.getTablePath(e)));await this.queryRunner.getTables(t),await this.queryRunner.getViews([]),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),e&&await this.queryRunner.commitTransaction()}catch(t){try{e&&await this.queryRunner.rollbackTransaction()}catch(e){}throw t}finally{await this.queryRunner.afterMigration(),await this.queryRunner.release()}}async createMetadataTableIfNecessary(e){(this.viewEntityToSyncMetadatas.length>0||this.hasGeneratedColumns())&&await this.createTypeormMetadataTable(e)}async log(){this.queryRunner=this.connection.createQueryRunner();try{const e=this.entityToSyncMetadatas.map((e=>this.getTablePath(e)));return await this.queryRunner.getTables(e),await this.queryRunner.getViews([]),this.queryRunner.enableSqlMemory(),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),this.queryRunner.getMemorySql()}finally{this.queryRunner.disableSqlMemory(),await this.queryRunner.release()}}get entityToSyncMetadatas(){return this.connection.entityMetadatas.filter((e=>e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType))}get viewEntityToSyncMetadatas(){return this.connection.entityMetadatas.filter((e=>"view"===e.tableType&&e.synchronize)).sort(Da.viewMetadataCmp)}hasGeneratedColumns(){return this.connection.entityMetadatas.some((e=>e.columns.some((e=>e.generatedType))))}async executeSchemaSyncOperationsInProperOrder(){await this.dropOldViews(),await this.dropOldForeignKeys(),await this.dropOldIndices(),await this.dropOldChecks(),await this.dropOldExclusions(),await this.dropCompositeUniqueConstraints(),await this.renameColumns(),await this.createNewTables(),await this.dropRemovedColumns(),await this.addNewColumns(),await this.updatePrimaryKeys(),await this.updateExistColumns(),await this.createNewIndices(),await this.createNewChecks(),await this.createNewExclusions(),await this.createCompositeUniqueConstraints(),await this.createForeignKeys(),await this.createViews()}getTablePath(e){const t=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(t.tableName,t.schema||this.currentSchema,t.database||this.currentDatabase)}async dropOldForeignKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.foreignKeys.filter((t=>{const n=e.foreignKeys.find((e=>t.name===e.name&&this.getTablePath(t)===this.getTablePath(e.referencedEntityMetadata)));return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate}));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old foreign keys of ${t.name}: ${n.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropForeignKeys(t,n))}}async renameTables(){}async renameColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;if(e.columns.length!==t.columns.length)continue;const n=e.columns.filter((e=>!t.columns.find((t=>t.name===e.databaseName&&t.type===this.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===this.connection.driver.normalizeIsUnique(e)))));if(0===n.length||n.length>1)continue;const i=t.columns.filter((t=>!e.columns.find((e=>e.databaseName===t.name&&this.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&this.connection.driver.normalizeIsUnique(e)===t.isUnique))));if(0===i.length||i.length>1)continue;const r=i[0].clone();r.name=n[0].databaseName,this.connection.logger.logSchemaBuild(`renaming column "${i[0].name}" in to "${r.name}"`),await this.queryRunner.renameColumn(t,i[0],r)}}async dropOldIndices(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.indices.filter((t=>{const n=e.indices.find((e=>e.name===t.name));return!n||!1!==n.synchronize&&(n.isUnique!==t.isUnique||(n.isSpatial!==t.isSpatial||(!(!this.connection.driver.isFullTextColumnTypeSupported()||n.isFulltext===t.isFulltext)||(n.columns.length!==t.columnNames.length||!n.columns.every((e=>-1!==t.columnNames.indexOf(e.databaseName)))))))})).map((async e=>{this.connection.logger.logSchemaBuild(`dropping an index: "${e.name}" from table ${t.name}`),await this.queryRunner.dropIndex(t,e)}));await Promise.all(n)}}async dropOldChecks(){if(!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.checks.filter((t=>!e.checks.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old check constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropCheckConstraints(t,n))}}async dropCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.uniques.filter((t=>t.columnNames.length>1&&!e.uniques.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old unique constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropUniqueConstraints(t,n))}}async dropOldExclusions(){if("postgres"===this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.exclusions.filter((t=>!e.exclusions.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old exclusion constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropExclusionConstraints(t,n))}}async createNewTables(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(t)continue;this.connection.logger.logSchemaBuild(`creating a new table: ${this.getTablePath(e)}`);const n=ar.create(e,this.connection.driver);await this.queryRunner.createTable(n,!1,!1),this.queryRunner.loadedTables.push(n)}}async createViews(){for(const e of this.viewEntityToSyncMetadatas){const t=this.queryRunner.loadedViews.find((t=>{const n="string"==typeof t.expression?t.expression.trim():t.expression(this.connection).getQuery(),i="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.getTablePath(t)===this.getTablePath(e)&&n===i}));if(t)continue;this.connection.logger.logSchemaBuild(`creating a new view: ${this.getTablePath(e)}`);const n=Pa.create(e,this.connection.driver);await this.queryRunner.createView(n),this.queryRunner.loadedViews.push(n)}}async dropOldViews(){const e=[],t=this.viewEntityToSyncMetadatas,n=new Map;for(const e of this.queryRunner.loadedViews){const i=t.find((t=>this.getTablePath(e)===this.getTablePath(t)));i&&n.set(e,i)}for(const t of this.queryRunner.loadedViews){const i=n.get(t);if(!i)continue;("string"==typeof t.expression?t.expression.trim():t.expression(this.connection).getQuery())!==("string"==typeof i.expression?i.expression.trim():i.expression(this.connection).getQuery())&&(this.connection.logger.logSchemaBuild(`dropping an old view: ${t.name}`),e.push(t))}const i=e=>{const t=n.get(e);let r=[e];if(!t)return r;for(const[a,s]of n.entries())a!==e&&s.dependsOn&&(s.dependsOn.has(t.target)||s.dependsOn.has(t.name))&&(r=r.concat(i(a)));return r},r=new Set(e.map((e=>i(e))).reduce(((e,t)=>e.concat(t)),[]).sort(((e,t)=>Da.viewMetadataCmp(n.get(e),n.get(t)))).reverse());for(const e of r)await this.queryRunner.dropView(e);this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter((e=>!r.has(e)))}async dropRemovedColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.columns.filter((t=>!e.columns.find((e=>e.databaseName===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`columns dropped in ${t.name}: `+n.map((e=>e.name)).join(", ")),await this.queryRunner.dropColumns(t,n))}}async addNewColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.columns.filter((e=>!t.columns.find((t=>t.name===e.databaseName))));if(0===n.length)continue;const i=this.metadataColumnsToTableColumnOptions(n).map((e=>new Xi(e)));0!==i.length&&(this.connection.logger.logSchemaBuild("new columns added: "+n.map((e=>e.databaseName)).join(", ")),await this.queryRunner.addColumns(t,i))}}async updatePrimaryKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.columns.filter((e=>e.isPrimary));if(t.columns.filter((e=>e.isPrimary)).length!==n.length&&n.length>1){const e=n.map((e=>new Xi(tr.createTableColumnOptions(e,this.connection.driver))));await this.queryRunner.updatePrimaryKeys(t,e)}}}async updateExistColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=this.connection.driver.findChangedColumns(t.columns,e.columns);if(0===n.length)continue;for(const t of n)await this.dropColumnReferencedForeignKeys(this.getTablePath(e),t.databaseName);for(const t of n)await this.dropColumnCompositeIndices(this.getTablePath(e),t.databaseName);if(!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type)for(const t of n)await this.dropColumnCompositeUniques(this.getTablePath(e),t.databaseName);const i=n.map((e=>{const n=t.columns.find((t=>t.name===e.databaseName)),i=tr.createTableColumnOptions(e,this.connection.driver);return{oldColumn:n,newColumn:new Xi(i)}}));0!==i.length&&(this.connection.logger.logSchemaBuild(`columns changed in "${t.name}". updating: `+n.map((e=>e.databaseName)).join(", ")),await this.queryRunner.changeColumns(t,i))}}async createNewIndices(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.indices.filter((e=>!t.indices.find((t=>t.name===e.name))&&!0===e.synchronize)).map((e=>Zi.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new indices ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createIndices(t,n))}}async createNewChecks(){if(!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.checks.filter((e=>!t.checks.find((t=>t.name===e.name)))).map((e=>ir.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new check constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createCheckConstraints(t,n))}}async createCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.uniques.filter((e=>e.columns.length>1&&!t.uniques.find((t=>t.name===e.name)))).map((e=>nr.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new unique constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createUniqueConstraints(t,n))}}async createNewExclusions(){if("postgres"===this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.exclusions.filter((e=>!t.exclusions.find((t=>t.name===e.name)))).map((e=>rr.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new exclusion constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createExclusionConstraints(t,n))}}async createForeignKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.foreignKeys.filter((e=>!t.foreignKeys.find((t=>t.name===e.name&&this.getTablePath(t)===this.getTablePath(e.referencedEntityMetadata)))));if(0===n.length)continue;const i=n.map((e=>er.create(e,this.connection.driver)));this.connection.logger.logSchemaBuild(`creating a foreign keys: ${n.map((e=>e.name)).join(", ")} on table "${t.name}"`),await this.queryRunner.createForeignKeys(t,i)}}async dropColumnReferencedForeignKeys(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const i=[],r=n.foreignKeys.find((e=>-1!==e.columnNames.indexOf(t)));if(r){const e=n.clone();e.foreignKeys=[r],i.push(e),n.removeForeignKey(r)}for(const n of this.queryRunner.loadedTables){const r=n.foreignKeys.filter((n=>this.getTablePath(n)===e&&-1!==n.referencedColumnNames.indexOf(t)));if(r.length>0){const e=n.clone();e.foreignKeys=r,i.push(e),r.forEach((e=>n.removeForeignKey(e)))}}if(i.length>0)for(const e of i)this.connection.logger.logSchemaBuild(`dropping related foreign keys of ${e.name}: ${e.foreignKeys.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropForeignKeys(e,e.foreignKeys)}async dropColumnCompositeIndices(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const i=n.indices.filter((e=>e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)));0!==i.length&&(this.connection.logger.logSchemaBuild(`dropping related indices of "${e}"."${t}": ${i.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropIndices(n,i))}async dropColumnCompositeUniques(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const i=n.uniques.filter((e=>e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)));0!==i.length&&(this.connection.logger.logSchemaBuild(`dropping related unique constraints of "${e}"."${t}": ${i.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropUniqueConstraints(n,i))}metadataColumnsToTableColumnOptions(e){return e.map((e=>tr.createTableColumnOptions(e,this.connection.driver)))}async createTypeormMetadataTable(e){const t=this.currentSchema,n=this.currentDatabase,i=this.connection.driver.buildTableName(this.connection.metadataTableName,t,n),r="spanner"===this.connection.driver.options.type;await e.createTable(new ar({database:n,schema:t,name:i,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1,isPrimary:r},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0,isPrimary:r},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0,isPrimary:r},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0,isPrimary:r},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0,isPrimary:r},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0,isPrimary:r}]}),!0)}}class qa{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.supportedUpsertType="on-conflict-do-update",this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=gr.I.buildDriverOptions(this.options).database}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise(((e,t)=>{this.queryRunner=void 0,this.databaseConnection.close((n=>n?t(n):e()))}))}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){var t,n;return null===(n=null===(t=this.attachedDatabases)||void 0===t?void 0:t[e])||void 0===n?void 0:n.attachHandle}getAttachedDatabasePathRelativeByHandle(e){var t;return null===(t=Object.values(this.attachedDatabases).find((({attachHandle:t})=>e===t)))||void 0===t?void 0:t.attachFilepathRelative}createSchemaBuilder(){return new La(this.connection)}preparePersistentValue(e,t){return t.transformer&&(e=Zr.W.transformTo(t.transformer,e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?Jr.mixedDateToDateString(e):"time"===t.type?Jr.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?Jr.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?Jr.simpleArrayToString(e):"simple-json"===t.type?Jr.simpleJsonToString(e):"simple-enum"===t.type?Jr.simpleEnumToString(e):e}prepareHydratedValue(e,t){return null==e?t.transformer?Zr.W.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=Jr.normalizeHydratedDate(e)):"date"===t.type?e=Jr.mixedDateToDateString(e):"time"===t.type?e=Jr.mixedTimeToString(e):"simple-array"===t.type?e=Jr.stringToSimpleArray(e):"simple-json"===t.type?e=Jr.stringToSimpleJson(e):"simple-enum"===t.type&&(e=Jr.stringToSimpleEnum(e,t)),t.transformer&&(e=Zr.W.transformFrom(t.transformer,e)),e)}escapeQueryWithParameters(e,t,n){const i=Object.keys(n).map((e=>"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]instanceof Date?Jr.mixedDateToUtcDatetimeString(n[e]):n[e]));return t&&Object.keys(t).length?[e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,r)=>{if(!t.hasOwnProperty(r))return e;let a=t[r];return n?a.map((e=>(i.push(e),this.createParameter(r,i.length-1)))).join(", "):"function"==typeof a?a():"number"==typeof a?String(a):a instanceof Date?(i.push(Jr.mixedDateToUtcDatetimeString(a)),this.createParameter(r,i.length-1)):(i.push(a),this.createParameter(r,i.length-1))})),i]:[e,i]}escape(e){return'"'+e+'"'}buildTableName(e,t,n){return e}parseTableName(e){var t;const n=this.database,i=void 0;if(cr.t.isTable(e)||cr.t.isView(e)){const t=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||t.database||n,schema:e.schema||t.schema||i,tableName:t.tableName}}if(cr.t.isTableForeignKey(e)){const t=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||t.database||n,schema:e.referencedSchema||t.schema||i,tableName:t.tableName}}if(cr.t.isEntityMetadata(e))return{database:e.database||n,schema:e.schema||i,tableName:e.tableName};const r=e.split(".");if(3===r.length)return{database:r[0]||n,schema:r[1]||i,tableName:r[2]};if(2===r.length){return{database:null!==(t=this.getAttachedDatabasePathRelativeByHandle(r[0]))&&void 0!==t?t:n,schema:r[0],tableName:r[1]}}return{database:n,schema:i,tableName:e}}normalizeType(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""}normalizeDefault(e){const t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?t?"1":"0":"function"==typeof t?t():"string"==typeof t?`'${t}'`:null!=t?`${t}`:void 0}normalizeIsUnique(e){return e.entityMetadata.uniques.some((t=>1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,t,n,i){const r=e.generatedColumns.reduce(((e,r)=>{let a;return"increment"===r.generationStrategy&&t&&(a=t-i+n+1),a?Xr.m.mergeDeep(e,r.createValueMap(a)):e}),{});return Object.keys(r).length>0?r:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;return n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==t.length||n.precision!==t.precision||n.scale!==t.scale||this.normalizeDefault(t)!==n.default||n.isPrimary!==t.isPrimary||n.isNullable!==t.isNullable||n.generatedType!==t.generatedType||n.asExpression!==t.asExpression||n.isUnique!==this.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&n.isGenerated!==t.isGenerated}))}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return"?"}createDatabaseConnection(){throw new Ji.VR("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")}loadDependencies(){}}var $a,ja=n(76320),Ba=n(75672),Ua=n(60765);class Va{constructor(e,t){this.query=e,this.parameters=t,this["@instanceof"]=Symbol.for("Query")}}class Fa{constructor(){this.upQueries=[],this.downQueries=[]}}class Ka{constructor(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new Fa,this.transactionDepth=0,this.cachedTablePaths={}}async beforeMigration(){}async afterMigration(){}async getTable(e){return this.loadedTables=await this.loadTables([e]),this.loadedTables.length>0?this.loadedTables[0]:void 0}async getTables(e){return e?(this.loadedTables=await this.loadTables(e),this.loadedTables):await this.loadTables(e)}async getView(e){return this.loadedViews=await this.loadViews([e]),this.loadedViews.length>0?this.loadedViews[0]:void 0}async getViews(e){return this.loadedViews=await this.loadViews(e),this.loadedViews}enableSqlMemory(){this.sqlInMemory=new Fa,this.sqlMemoryMode=!0}disableSqlMemory(){this.sqlInMemory=new Fa,this.sqlMemoryMode=!1}clearSqlMemory(){this.sqlInMemory=new Fa}getMemorySql(){return this.sqlInMemory}async executeMemoryUpSql(){for(const{query:e,parameters:t}of this.sqlInMemory.upQueries)await this.query(e,t)}async executeMemoryDownSql(){for(const{query:e,parameters:t}of this.sqlInMemory.downQueries.reverse())await this.query(e,t)}getReplicationMode(){return this.mode}async getCachedView(e){const t=this.loadedViews.find((t=>t.name===e));if(t)return t;const n=await this.loadViews([e]);if(n.length>0)return this.loadedViews.push(n[0]),n[0];throw new Tr.V(`View "${e}" does not exist.`)}async getCachedTable(e){if(e in this.cachedTablePaths){const t=this.cachedTablePaths[e],n=this.loadedTables.find((e=>this.getTablePath(e)===t));if(n)return n}const t=await this.loadTables([e]);if(t.length>0){const n=this.getTablePath(t[0]),i=this.loadedTables.find((e=>this.getTablePath(e)===n));return i||(this.cachedTablePaths[e]=this.getTablePath(t[0]),this.loadedTables.push(t[0]),t[0])}throw new Tr.V(`Table "${e}" does not exist.`)}replaceCachedTable(e,t){const n=this.getTablePath(e),i=this.loadedTables.find((e=>this.getTablePath(e)===n));for(const[e,i]of Object.entries(this.cachedTablePaths))i===n&&(this.cachedTablePaths[e]=this.getTablePath(t));i&&(i.database=t.database,i.schema=t.schema,i.name=t.name,i.columns=t.columns,i.indices=t.indices,i.foreignKeys=t.foreignKeys,i.uniques=t.uniques,i.checks=t.checks,i.justCreated=t.justCreated,i.engine=t.engine)}getTablePath(e){const t=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(t.tableName,t.schema,t.database)}getTypeormMetadataTableName(){const e=this.connection.driver.options;return this.connection.driver.buildTableName(this.connection.metadataTableName,e.schema,e.database)}selectTypeormMetadataSql({database:e,schema:t,table:n,type:i,name:r}){const a=this.connection.createQueryBuilder(),s=a.select().from(this.getTypeormMetadataTableName(),"t").where(`${a.escape("type")} = :type`,{type:i}).andWhere(`${a.escape("name")} = :name`,{name:r});e&&s.andWhere(`${a.escape("database")} = :database`,{database:e}),t&&s.andWhere(`${a.escape("schema")} = :schema`,{schema:t}),n&&s.andWhere(`${a.escape("table")} = :table`,{table:n});const[o,c]=s.getQueryAndParameters();return new Va(o,c)}insertTypeormMetadataSql({database:e,schema:t,table:n,type:i,name:r,value:a}){const[s,o]=this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({database:e,schema:t,table:n,type:i,name:r,value:a}).getQueryAndParameters();return new Va(s,o)}deleteTypeormMetadataSql({database:e,schema:t,table:n,type:i,name:r}){const a=this.connection.createQueryBuilder(),s=a.delete().from(this.getTypeormMetadataTableName()).where(`${a.escape("type")} = :type`,{type:i}).andWhere(`${a.escape("name")} = :name`,{name:r});e&&s.andWhere(`${a.escape("database")} = :database`,{database:e}),t&&s.andWhere(`${a.escape("schema")} = :schema`,{schema:t}),n&&s.andWhere(`${a.escape("table")} = :table`,{table:n});const[o,c]=s.getQueryAndParameters();return new Va(o,c)}isColumnChanged(e,t,n,i){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||i&&e.comment!==t.comment||!Xr.m.isArraysEqual(e.enum||[],t.enum||[])}isDefaultColumnLength(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n){if(this.connection.driver.getColumnLength(n))return!1}}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()}isDefaultColumnPrecision(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&null!==n.precision&&void 0!==n.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n}isDefaultColumnScale(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&null!==n.scale&&void 0!==n.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n}async executeQueries(e,t){if(cr.t.isQuery(e)&&(e=[e]),cr.t.isQuery(t)&&(t=[t]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...t),!0===this.sqlMemoryMode)return Promise.resolve();for(const{query:t,parameters:n}of e)await this.query(t,n)}generateIndexName(e,t){return this.connection.namingStrategy.indexName(e,t.columnNames,t.where)}}!function(e){e.VIEW="VIEW",e.MATERIALIZED_VIEW="MATERIALIZED_VIEW",e.GENERATED_COLUMN="GENERATED_COLUMN"}($a||($a={}));class Wa extends Ka{constructor(){super(),this.transactionPromise=null}connect(){return Promise.resolve(this.driver.databaseConnection)}release(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()}async startTransaction(e){if("none"===this.driver.transactionSupport)throw new Ji.VR(`Transactions aren't supported by ${this.connection.driver.options.type}.`);if(this.isTransactionActive&&"simple"===this.driver.transactionSupport)throw new Ji.ol;if(e&&"READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new Ji.VR("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?(e&&("READ UNCOMMITTED"===e?await this.query("PRAGMA read_uncommitted = true"):await this.query("PRAGMA read_uncommitted = false")),await this.query("BEGIN TRANSACTION")):await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("COMMIT"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("ROLLBACK"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}stream(e,t,n,i){throw new Ji.VR("Stream is not supported by sqlite driver.")}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return Promise.resolve(!1)}async getCurrentDatabase(){return Promise.resolve(void 0)}async hasSchema(e){throw new Ji.VR("This driver does not support table schemas")}async getCurrentSchema(){return Promise.resolve(void 0)}async hasTable(e){const t=`SELECT * FROM "sqlite_master" WHERE "type" = 'table' AND "name" = '${cr.t.isTable(e)?e.name:e}'`;return!!(await this.query(t)).length}async hasColumn(e,t){const n=cr.t.isTable(e)?e.name:e,i=`PRAGMA table_xinfo(${this.escapePath(n)})`;return!!(await this.query(i)).find((e=>e.name===t))}async createDatabase(e,t){return Promise.resolve()}async dropDatabase(e,t){return Promise.resolve()}async createSchema(e,t){return Promise.resolve()}async dropSchema(e,t){return Promise.resolve()}async createTable(e,t=!1,n=!0,i=!0){const r=[],a=[];if(t){if(await this.hasTable(e))return Promise.resolve()}r.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),i&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),r.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(t))}));const s=e.columns.filter((e=>e.generatedType&&e.asExpression));for(const t of s){const n=this.insertTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),i=this.deleteTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name});r.push(n),a.push(i)}await this.executeQueries(r,a)}async dropTable(e,t,n=!0,i=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const r=n,a=cr.t.isTable(e)?e:await this.getCachedTable(e),s=[],o=[];i&&a.indices.forEach((e=>{s.push(this.dropIndexSql(e)),o.push(this.createIndexSql(a,e))})),s.push(this.dropTableSql(a,t)),o.push(this.createTableSql(a,r));const c=a.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of c){const t=this.deleteTypeormMetadataSql({table:a.name,type:$a.GENERATED_COLUMN,name:e.name}),n=this.insertTypeormMetadataSql({table:a.name,type:$a.GENERATED_COLUMN,name:e.name,value:e.asExpression});s.push(t),o.push(n)}await this.executeQueries(s,o)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=cr.t.isView(e)?e.name:e,n=await this.getCachedView(t),i=[],r=[];i.push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),r.push(this.insertViewDefinitionSql(n)),r.push(this.createViewSql(n)),await this.executeQueries(i,r)}async renameTable(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();i.name=t;const r=new Va(`ALTER TABLE ${this.escapePath(n.name)} RENAME TO ${this.escapePath(t)}`),a=new Va(`ALTER TABLE ${this.escapePath(t)} RENAME TO ${this.escapePath(n.name)}`);await this.executeQueries(r,a),i.uniques.forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(n,e.columnNames);e.name===t&&(e.name=this.connection.namingStrategy.uniqueConstraintName(i,e.columnNames))})),i.foreignKeys.forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(n,e.columnNames,this.getTablePath(e),e.referencedColumnNames);e.name===t&&(e.name=this.connection.namingStrategy.foreignKeyName(i,e.columnNames,this.getTablePath(e),e.referencedColumnNames))})),i.indices.forEach((e=>{const t=this.connection.namingStrategy.indexName(n,e.columnNames,e.where);e.name===t&&(e.name=this.connection.namingStrategy.indexName(i,e.columnNames,e.where))})),n.name=i.name,await this.recreateTable(i,n)}async addColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);return this.addColumns(n,[t])}async addColumns(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.addColumn(e))),await this.recreateTable(i,n)}async renameColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e),r=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!r)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);let a;return cr.t.isTableColumn(n)?a=n:(a=r.clone(),a.name=n),this.changeColumn(i,r,a)}async changeColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e),r=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!r)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);await this.changeColumns(i,[{oldColumn:r,newColumn:n}])}async changeColumns(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>{e.newColumn.name!==e.oldColumn.name&&(i.findColumnUniques(e.oldColumn).forEach((t=>{const r=this.connection.namingStrategy.uniqueConstraintName(n,t.columnNames);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===r&&(t.name=this.connection.namingStrategy.uniqueConstraintName(i,t.columnNames))})),i.findColumnForeignKeys(e.oldColumn).forEach((t=>{const r=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===r&&(t.name=this.connection.namingStrategy.foreignKeyName(i,t.columnNames,this.getTablePath(t),t.referencedColumnNames))})),i.findColumnIndices(e.oldColumn).forEach((t=>{const r=this.connection.namingStrategy.indexName(n,t.columnNames,t.where);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===r&&(t.name=this.connection.namingStrategy.indexName(i,t.columnNames,t.where))})));const t=i.columns.find((t=>t.name===e.oldColumn.name));t&&(i.columns[i.columns.indexOf(t)]=e.newColumn)})),await this.recreateTable(i,n)}async dropColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableColumn(t)?t:n.findColumnByName(t);if(!i)throw new Ji.VR(`Column "${t}" was not found in table "${n.name}"`);await this.dropColumns(n,[i])}async dropColumns(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>{const t=cr.t.isTableColumn(e)?e:n.findColumnByName(e);if(!t)throw new Error(`Column "${e}" was not found in table "${n.name}"`);i.removeColumn(t),i.findColumnUniques(t).forEach((e=>i.removeUniqueConstraint(e))),i.findColumnIndices(t).forEach((e=>i.removeIndex(e))),i.findColumnForeignKeys(t).forEach((e=>i.removeForeignKey(e)))})),await this.recreateTable(i,n)}async createPrimaryKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();i.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)})),await this.recreateTable(i,n),n.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)}))}async updatePrimaryKeys(e,t){await Promise.resolve()}async dropPrimaryKey(e){const t=cr.t.isTable(e)?e:await this.getCachedTable(e),n=t.clone();n.primaryColumns.forEach((e=>{e.isPrimary=!1})),await this.recreateTable(n,t),t.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){await this.createUniqueConstraints(e,[t])}async createUniqueConstraints(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.addUniqueConstraint(e))),await this.recreateTable(i,n)}async dropUniqueConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableUnique(t)?t:n.uniques.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied unique constraint was not found in table ${n.name}`);await this.dropUniqueConstraints(n,[i])}async dropUniqueConstraints(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.removeUniqueConstraint(e))),await this.recreateTable(i,n)}async createCheckConstraint(e,t){await this.createCheckConstraints(e,[t])}async createCheckConstraints(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.addCheckConstraint(e))),await this.recreateTable(i,n)}async dropCheckConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableCheck(t)?t:n.checks.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied check constraint was not found in table ${n.name}`);await this.dropCheckConstraints(n,[i])}async dropCheckConstraints(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.removeCheckConstraint(e))),await this.recreateTable(i,n)}async createExclusionConstraint(e,t){throw new Ji.VR("Sqlite does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new Ji.VR("Sqlite does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new Ji.VR("Sqlite does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new Ji.VR("Sqlite does not support exclusion constraints.")}async createForeignKey(e,t){await this.createForeignKeys(e,[t])}async createForeignKeys(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.addForeignKey(e))),await this.recreateTable(i,n)}async dropForeignKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied foreign key was not found in table ${n.name}`);await this.dropForeignKeys(e,[i])}async dropForeignKeys(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone();t.forEach((e=>i.removeForeignKey(e))),await this.recreateTable(i,n)}async createIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const i=this.createIndexSql(n,t),r=this.dropIndexSql(t);await this.executeQueries(i,r),n.addIndex(t)}async createIndices(e,t){const n=t.map((t=>this.createIndex(e,t)));await Promise.all(n)}async dropIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied index ${t} was not found in table ${n.name}`);i.name||(i.name=this.generateIndexName(n,i));const r=this.dropIndexSql(i),a=this.createIndexSql(n,i);await this.executeQueries(r,a),n.removeIndex(i)}async dropIndices(e,t){const n=t.map((t=>this.dropIndex(e,t)));await Promise.all(n)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)}`)}async clearDatabase(e){let t;e&&this.driver.getAttachedDatabaseHandleByRelativePath(e)&&(t=this.driver.getAttachedDatabaseHandleByRelativePath(e)),await this.query("PRAGMA foreign_keys = OFF");const n=this.isTransactionActive;n||await this.startTransaction();try{const e=t?`SELECT 'DROP VIEW "${t}"."' || name || '";' as query FROM "${t}"."sqlite_master" WHERE "type" = 'view'`:"SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'",i=await this.query(e);await Promise.all(i.map((e=>this.query(e.query))));const r=t?`SELECT 'DROP TABLE "${t}"."' || name || '";' as query FROM "${t}"."sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`:"SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",a=await this.query(r);await Promise.all(a.map((e=>this.query(e.query)))),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}finally{await this.query("PRAGMA foreign_keys = ON")}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=e.map((e=>"'"+e+"'")).join(", ");let n=`SELECT "t".* FROM "${this.getTypeormMetadataTableName()}" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = 'view' WHERE "t"."type" = '${$a.VIEW}'`;t.length>0&&(n+=` AND "t"."name" IN (${t})`);return(await this.query(n)).map((e=>{const t=new Pa;return t.name=e.name,t.expression=e.value,t}))}async loadTableRecords(e,t){let n;const[i,r]=this.splitTablePath(e);i&&this.driver.getAttachedDatabasePathRelativeByHandle(i)&&(n=this.driver.getAttachedDatabasePathRelativeByHandle(i));return await this.query(`SELECT ${n?`'${n}'`:null} as database, ${i?`'${i}'`:null} as schema, * FROM ${i?`"${i}".`:""}${this.escapePath("sqlite_master")} WHERE "type" = '${t}' AND "${"table"===t?"name":"tbl_name"}" IN ('${r}')`)}async loadPragmaRecords(e,t){const[,n]=this.splitTablePath(e);return await this.query(`PRAGMA ${t}("${n}")`)}async loadTables(e){if(e&&0===e.length)return[];let t,n=[];if(e)n=(await Promise.all(e.map((e=>this.loadTableRecords(e,"table"))))).reduce(((e,t)=>[...e,...t]),[]).filter(Boolean),t=(await Promise.all((null!=e?e:[]).map((e=>this.loadTableRecords(e,"index"))))).reduce(((e,t)=>[...e,...t]),[]).filter(Boolean);else{const e='SELECT * FROM "sqlite_master" WHERE "type" = \'table\'';n.push(...await this.query(e));const i=n.map((({name:e})=>`'${e}'`)).join(", ");t=await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'index' AND "tbl_name" IN (${i})`)}return 0===n.length?[]:Promise.all(n.map((async e=>{const n=e.database&&this.driver.getAttachedDatabaseHandleByRelativePath(e.database)?`${this.driver.getAttachedDatabaseHandleByRelativePath(e.database)}.${e.name}`:e.name,i=e.sql,r=i.includes("WITHOUT ROWID"),a=new ar({name:n,withoutRowid:r}),[s,o,c]=await Promise.all([this.loadPragmaRecords(n,"table_xinfo"),this.loadPragmaRecords(n,"index_list"),this.loadPragmaRecords(n,"foreign_key_list")]);let l;const u=e.sql;let d,h=u.toUpperCase().indexOf("AUTOINCREMENT");if(-1!==h){l=u.substr(0,h);const e=l.lastIndexOf(","),t=l.lastIndexOf("(");-1!==e?(l=l.substr(e),l=l.substr(0,l.lastIndexOf('"')),l=l.substr(l.indexOf('"')+1)):-1!==t&&(l=l.substr(t),l=l.substr(0,l.lastIndexOf('"')),l=l.substr(l.indexOf('"')+1))}a.columns=await Promise.all(s.map((async e=>{const t=new Xi;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=l===e.name,t.isGenerated&&(t.generationStrategy="increment"),2===e.hidden||3===e.hidden){t.generatedType=2===e.hidden?"VIRTUAL":"STORED";const n=await this.selectTypeormMetadataSql({table:a.name,type:$a.GENERATED_COLUMN,name:t.name}),i=await this.query(n.query,n.parameters);i[0]&&i[0].value?t.asExpression=i[0].value:t.asExpression=""}if("varchar"===t.type){const e=i.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\"\\1\"\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));e&&(t.enum=e[2].substr(1,e[2].length-2).split("','"))}let n=t.type.indexOf("(");if(-1!==n){const e=t.type;let i=e.substr(0,n);if(this.driver.withLengthColumnTypes.find((e=>e===i))){let r=parseInt(e.substring(n+1,e.length-1));r&&(t.length=r.toString(),t.type=i)}if(this.driver.withPrecisionColumnTypes.find((e=>e===i))){const n=new RegExp(`^${i}\\((\\d+),?\\s?(\\d+)?\\)`),r=e.match(n);r&&r[1]&&(t.precision=+r[1]),this.driver.withScaleColumnTypes.find((e=>e===i))&&r&&r[2]&&(t.scale=+r[2]),t.type=i}}return t})));const p=[],m=/CONSTRAINT "([^"]*)" FOREIGN KEY ?\((.*?)\) REFERENCES "([^"]*)"/g;for(;null!==(d=m.exec(i));)p.push({name:d[1],columns:d[2].substr(1,d[2].length-2).split('", "'),referencedTableName:d[3]});const f=Xr.m.uniq(c,(e=>e.id));let y;a.foreignKeys=f.map((e=>{const t=c.filter((t=>t.id===e.id&&t.table===e.table)),n=t.map((e=>e.from)),i=t.map((e=>e.to)),r=p.find((t=>t.referencedTableName===e.table&&t.columns.every((e=>-1!==n.indexOf(e)))));return new er({name:r.name,columnNames:n,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})}));const g=[],b=/CONSTRAINT "([^"]*)" UNIQUE ?\((.*?)\)/g;for(;null!==(y=b.exec(i));)g.push({name:y[1],columns:y[2].substr(1,y[2].length-2).split('", "')});const w=o.filter((e=>"u"===e.origin)).map((e=>e.name)).filter(((e,t,n)=>n.indexOf(e)===t)).map((async e=>{const t=o.find((t=>t.name===e)),n=(await this.query(`PRAGMA index_info("${t.name}")`)).sort(((e,t)=>parseInt(e.seqno)-parseInt(t.seqno))).map((e=>e.name));if(1===n.length){const e=a.columns.find((e=>!!n.find((t=>t===e.name))));e&&(e.isUnique=!0)}const i=g.find((e=>e.columns.every((e=>-1!==n.indexOf(e)))));return new nr({name:i?i.name:this.connection.namingStrategy.uniqueConstraintName(a,n),columnNames:n})}));let _;a.uniques=await Promise.all(w);const v=/CONSTRAINT "([^"]*)" CHECK ?(\(.*?\))([,]|[)]$)/g;for(;null!==(_=v.exec(i));)a.checks.push(new ir({name:_[1],expression:_[2]}));const E=o.filter((e=>"c"===e.origin)).map((e=>e.name)).filter(((e,t,n)=>n.indexOf(e)===t)).map((async n=>{const i=t.find((e=>e.name===n)),r=/WHERE (.*)/.exec(i.sql),s=o.find((e=>e.name===n)),c=(await this.query(`PRAGMA index_info("${s.name}")`)).sort(((e,t)=>parseInt(e.seqno)-parseInt(t.seqno))).map((e=>e.name)),l=`${e.database?`${e.database}.`:""}${s.name}`,u="1"===s.unique||1===s.unique;return new Zi({table:a,name:l,columnNames:c,isUnique:u,where:r?r[1]:void 0})})),T=await Promise.all(E);return a.indices=T.filter((e=>!!e)),a})))}createTableSql(e,t,n){const i=e.columns.filter((e=>e.isPrimary)),r=i.find((e=>e.isGenerated&&"increment"===e.generationStrategy)),a=i.length>1;if(a&&r)throw new Ji.VR("Sqlite does not support AUTOINCREMENT on composite primary key");const s=e.columns.map((e=>this.buildCreateColumnSql(e,a))).join(", "),[o]=this.splitTablePath(e.name);let c=`CREATE TABLE ${this.escapePath(e.name)} (${s}`,[l,u]=this.splitTablePath(e.name);const d=n?`${l?`${l}.`:""}${u.replace(/^temporary_/,"")}`:e.name;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{e.uniques.some((e=>1===e.columnNames.length&&e.columnNames[0]===t.name))||e.uniques.push(new nr({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){c+=`, ${e.uniques.map((e=>`CONSTRAINT "${e.name?e.name:this.connection.namingStrategy.uniqueConstraintName(d,e.columnNames)}" UNIQUE (${e.columnNames.map((e=>`"${e}"`)).join(", ")})`)).join(", ")}`}if(e.checks.length>0){c+=`, ${e.checks.map((e=>`CONSTRAINT "${e.name?e.name:this.connection.namingStrategy.checkConstraintName(d,e.expression)}" CHECK (${e.expression})`)).join(", ")}`}if(e.foreignKeys.length>0&&t){c+=`, ${e.foreignKeys.filter((e=>{const[t]=this.splitTablePath(e.referencedTableName);return t===o})).map((e=>{const[,t]=this.splitTablePath(e.referencedTableName),n=e.columnNames.map((e=>`"${e}"`)).join(", ");e.name||(e.name=this.connection.namingStrategy.foreignKeyName(d,e.columnNames,this.getTablePath(e),e.referencedColumnNames));const i=e.referencedColumnNames.map((e=>`"${e}"`)).join(", ");let r=`CONSTRAINT "${e.name}" FOREIGN KEY (${n}) REFERENCES "${t}" (${i})`;return e.onDelete&&(r+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(r+=` ON UPDATE ${e.onUpdate}`),r})).join(", ")}`}if(i.length>1){c+=`, PRIMARY KEY (${i.map((e=>`"${e.name}"`)).join(", ")})`}return c+=")",e.withoutRowid&&(c+=" WITHOUT ROWID"),new Va(c)}dropTableSql(e,t){const n=cr.t.isTable(e)?e.name:e,i=t?`DROP TABLE IF EXISTS ${this.escapePath(n)}`:`DROP TABLE ${this.escapePath(n)}`;return new Va(i)}createViewSql(e){return"string"==typeof e.expression?new Va(`CREATE VIEW "${e.name}" AS ${e.expression}`):new Va(`CREATE VIEW "${e.name}" AS ${e.expression(this.connection).getQuery()}`)}insertViewDefinitionSql(e){const t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:$a.VIEW,name:e.name,value:t})}dropViewSql(e){const t=cr.t.isView(e)?e.name:e;return new Va(`DROP VIEW "${t}"`)}deleteViewDefinitionSql(e){const t=cr.t.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:$a.VIEW,name:t})}createIndexSql(e,t){const n=t.columnNames.map((e=>`"${e}"`)).join(", "),[i,r]=this.splitTablePath(e.name);return new Va(`CREATE ${t.isUnique?"UNIQUE ":""}INDEX ${i?`"${i}".`:""}${this.escapePath(t.name)} ON "${r}" (${n}) ${t.where?"WHERE "+t.where:""}`)}dropIndexSql(e){let t=cr.t.isTableIndex(e)?e.name:e;return new Va(`DROP INDEX ${this.escapePath(t)}`)}buildCreateColumnSql(e,t){let n='"'+e.name+'"';return cr.t.isColumnMetadata(e)?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=' CHECK( "'+e.name+'" IN ('+e.enum.map((e=>"'"+e+"'")).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),e.asExpression?n+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`:void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n}async recreateTable(e,t,n=!0){const i=[],r=[];t.indices.forEach((e=>{i.push(this.dropIndexSql(e)),r.push(this.createIndexSql(t,e))}));let[a,s]=this.splitTablePath(e.name),[,o]=this.splitTablePath(t.name);if(e.name=s=`${a?`${a}.`:""}temporary_${s}`,i.push(this.createTableSql(e,!0,!0)),r.push(this.dropTableSql(e)),n){let n=e.columns.filter((e=>!e.generatedType)).map((e=>`"${e.name}"`)),a=t.columns.filter((e=>!e.generatedType)).map((e=>`"${e.name}"`));a.length<n.length?n=e.columns.filter((e=>{const n=t.columns.find((t=>t.name===e.name));return(!n||!n.generatedType)&&(!e.generatedType&&n)})).map((e=>`"${e.name}"`)):a.length>n.length&&(a=t.columns.filter((t=>!t.generatedType&&e.columns.find((e=>e.name===t.name)))).map((e=>`"${e.name}"`))),i.push(new Va(`INSERT INTO ${this.escapePath(e.name)}(${n.join(", ")}) SELECT ${a.join(", ")} FROM ${this.escapePath(t.name)}`)),r.push(new Va(`INSERT INTO ${this.escapePath(t.name)}(${a.join(", ")}) SELECT ${n.join(", ")} FROM ${this.escapePath(e.name)}`))}i.push(this.dropTableSql(t)),r.push(this.createTableSql(t,!0)),i.push(new Va(`ALTER TABLE ${this.escapePath(e.name)} RENAME TO ${this.escapePath(o)}`)),r.push(new Va(`ALTER TABLE ${this.escapePath(t.name)} RENAME TO ${this.escapePath(s)}`)),e.name=t.name,e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),i.push(this.createIndexSql(e,t)),r.push(this.dropIndexSql(t))})),t.columns.filter((t=>{const n=e.columns.find((e=>e.name===t.name));return t.generatedType&&t.asExpression&&(!n||!n.generatedType&&!n.asExpression)})).forEach((e=>{const n=this.deleteTypeormMetadataSql({table:t.name,type:$a.GENERATED_COLUMN,name:e.name}),a=this.insertTypeormMetadataSql({table:t.name,type:$a.GENERATED_COLUMN,name:e.name,value:e.asExpression});i.push(n),r.push(a)})),e.columns.filter((e=>e.generatedType&&e.asExpression&&!t.columns.some((t=>t.name===e.name)))).forEach((t=>{const n=this.insertTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),a=this.deleteTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name});i.push(n),r.push(a)})),e.columns.filter((e=>e.generatedType&&e.asExpression)).forEach((n=>{const a=t.columns.find((e=>e.name===n.name&&e.generatedType&&n.generatedType&&e.asExpression!==n.asExpression));if(!a)return;const s=this.deleteTypeormMetadataSql({table:t.name,type:$a.GENERATED_COLUMN,name:a.name}),o=this.insertTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:n.name,value:n.asExpression});i.push(s),i.push(o);const c=this.insertTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:a.name,value:a.asExpression}),l=this.deleteTypeormMetadataSql({table:t.name,type:$a.GENERATED_COLUMN,name:n.name});r.push(c),r.push(l)})),await this.executeQueries(i,r),this.replaceCachedTable(t,e)}splitTablePath(e){return-1!==e.indexOf(".")?e.split("."):[void 0,e]}escapePath(e,t){return(cr.t.isTable(e)||cr.t.isView(e)?e.name:e).replace(/^\.+|\.+$/g,"").split(".").map((e=>t?e:`"${e}"`)).join(".")}}class Ha{constructor(e){this.queryRunner=e}async broadcast(e,...t){const n=new ra.M,i=this[`broadcast${e}Event`];"function"==typeof i&&i.call(this,n,...t),await n.wait()}broadcastBeforeInsertEvent(e,t,n){n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.beforeInsert){const r=i.beforeInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t});r instanceof Promise&&e.promises.push(r),e.count++}}))}broadcastBeforeUpdateEvent(e,t,n,i,r,a){n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((s=>{if(this.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){const o=s.beforeUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,updatedColumns:r||[],updatedRelations:a||[]});o instanceof Promise&&e.promises.push(o),e.count++}}))}broadcastBeforeRemoveEvent(e,t,n,i){n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.beforeRemove){const a=r.beforeRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastBeforeSoftRemoveEvent(e,t,n,i){n&&t.beforeSoftRemoveListeners.length&&t.beforeSoftRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.beforeSoftRemove){const a=r.beforeSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastBeforeRecoverEvent(e,t,n,i){n&&t.beforeRecoverListeners.length&&t.beforeRecoverListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.beforeRecover){const a=r.beforeRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterInsertEvent(e,t,n){n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.afterInsert){const r=i.afterInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t});r instanceof Promise&&e.promises.push(r),e.count++}}))}broadcastBeforeTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionStart){const n=t.beforeTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionStart){const n=t.afterTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastBeforeTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionCommit){const n=t.beforeTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionCommit){const n=t.afterTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastBeforeTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionRollback){const n=t.beforeTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionRollback){const n=t.afterTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterUpdateEvent(e,t,n,i,r,a){n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((s=>{if(this.isAllowedSubscriber(s,t.target)&&s.afterUpdate){const o=s.afterUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,updatedColumns:r||[],updatedRelations:a||[]});o instanceof Promise&&e.promises.push(o),e.count++}}))}broadcastAfterRemoveEvent(e,t,n,i){n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.afterRemove){const a=r.afterRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterSoftRemoveEvent(e,t,n,i){n&&t.afterSoftRemoveListeners.length&&t.afterSoftRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.afterSoftRemove){const a=r.afterSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterRecoverEvent(e,t,n,i){n&&t.afterRecoverListeners.length&&t.afterRecoverListeners.forEach((t=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.afterRecover){const a=r.afterRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:i,entityId:t.getEntityIdMixedMap(i)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastLoadEventsForAll(e,t,n){return this.broadcastLoadEvent(e,t,n)}broadcastLoadEvent(e,t,n){const i=this.queryRunner.connection.subscribers.filter((e=>this.isAllowedSubscriber(e,t.target)&&e.afterLoad));if(t.relations.length||t.afterLoadListeners.length||i.length){const r=n.filter((e=>!(e instanceof Promise)));t.relations.length&&t.relations.forEach((t=>{r.forEach((n=>{if(t.isLazy&&!n.hasOwnProperty(t.propertyName))return;const i=t.getEntityValue(n);Rr.B.isObject(i)&&this.broadcastLoadEvent(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}))})),t.afterLoadListeners.length&&t.afterLoadListeners.forEach((t=>{r.forEach((n=>{if(t.isAllowed(n)){const i=t.execute(n);i instanceof Promise&&e.promises.push(i),e.count++}}))})),i.forEach((n=>{r.forEach((i=>{const r=n.afterLoad(i,{entity:i,metadata:t,connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}))}))}}isAllowedSubscriber(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)}}class Qa{constructor(){this.records=[]}}class za extends Wa{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Ha(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const r=+new Date;try{const a=await new Promise((async(n,r)=>{i.executeSql(e,t,(e=>n(e)),(e=>r(e)))})),s=this.driver.options.maxQueryExecutionTime,o=+new Date-r;s&&o>s&&this.driver.connection.logger.logQuerySlow(o,e,t,this);const c=new Qa;if("INSERT INTO"===e.substr(0,11))c.raw=a.insertId;else{let e=[];for(let t=0;t<a.rows.length;t++)e.push(a.rows.item(t));c.records=e,c.raw=e}return n?c:c.raw}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}async startTransaction(){throw new Ji.VR("Transactions are not supported by the Cordova driver")}async commitTransaction(){throw new Ji.VR("Transactions are not supported by the Cordova driver")}async rollbackTransaction(){throw new Ji.VR("Transactions are not supported by the Cordova driver")}async clearDatabase(){await this.query("PRAGMA foreign_keys = OFF");try{const e="SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'",t=await this.query(e),n="SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",i=await this.query(n);await Promise.all(t.map((e=>this.query(e.query)))),await Promise.all(i.map((e=>this.query(e.query))))}finally{await this.query("PRAGMA foreign_keys = ON")}}parametrize(e,t=0){return Object.keys(e).map(((e,t)=>`"${e}"=?`))}}var Ga=n(59855),Ya=n(50722);class Ja extends qa{constructor(e){if(super(e),this.database=this.options.database,!this.options.database)throw new Ga.l("database");if(!this.options.location)throw new Ga.l("location");this.loadDependencies()}async disconnect(){return this.queryRunner=void 0,new Promise(((e,t)=>{this.databaseConnection.close(e,t)}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new za(this)),this.queryRunner}async createDatabaseConnection(){const e=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{}),t=await new Promise((t=>{this.sqlite.openDatabase(e,(e=>t(e)))}));return await new Promise(((e,n)=>{t.executeSql("PRAGMA foreign_keys = ON",[],(()=>e()),(e=>n(e)))})),t}loadDependencies(){try{const e=this.options.driver||window.sqlitePlugin;this.sqlite=e}catch(e){throw new Ya.W("Cordova-SQLite","cordova-sqlite-storage")}}}class Xa extends Wa{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Ha(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=this.driver.connection;return new Promise((async(r,a)=>{const s=await this.connect(),o="INSERT INTO"===e.substr(0,11);i.logger.logQuery(e,t,this);const c=(s,c)=>{const u=this.driver.options.maxQueryExecutionTime,d=+new Date-l;u&&d>u&&i.logger.logQuerySlow(d,e,t,this),s&&(i.logger.logQueryError(s,e,t,this),a(new Ba.C(e,t,s)));const h=new Qa;h.raw=c,!o&&Array.isArray(c)&&(h.records=c),r(n?h:h.raw)},l=+new Date;o?s.execSQL(e,t,c):s.all(e,t,c)}))}parametrize(e,t=0){return Object.keys(e).map(((e,t)=>`"${e}"=?`))}}var Za=n(1048).Buffer;class es extends qa{constructor(e){if(super(e),this.connection=e,this.options=e.options,this.database=this.options.database,this.driver=this.options.driver,!this.options.database)throw new Ga.l("database");this.loadDependencies()}async disconnect(){return new Promise(((e,t)=>{this.queryRunner=void 0,this.databaseConnection.close().then(e).catch(t)}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new Xa(this)),this.queryRunner}normalizeType(e){return e.type===Za?"blob":super.normalizeType(e)}createDatabaseConnection(){return new Promise(((e,t)=>{const n=Object.assign({},{readOnly:this.options.readOnly,key:this.options.key,multithreading:this.options.multithreading,migrate:this.options.migrate,iosFlags:this.options.iosFlags,androidFlags:this.options.androidFlags},this.options.extra||{});new this.sqlite(this.options.database,n,((n,i)=>{if(n)return t(n);i.resultType(this.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON",[],((n,r)=>{if(n)return t(n);e(i)}))}))}))}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new Ya.W("Nativescript","nativescript-sqlite")}}class ts extends Wa{constructor(e){super(),this.isDirty=!1,this.driver=e,this.connection=e.connection,this.broadcaster=new Ha(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async flush(){this.isDirty&&(await this.driver.autoSave(),this.isDirty=!1)}async release(){return await this.flush(),super.release()}async commitTransaction(){await super.commitTransaction(),await this.flush()}async query(e,t=[],n=!1){if(this.isReleased)throw new ja.E;const i=e.trim().split(" ",1)[0],r=this.driver.databaseConnection;this.driver.connection.logger.logQuery(e,t,this);const a=+new Date;let s;try{s=r.prepare(e),t&&(t=t.map((e=>void 0!==e?e:null)),s.bind(t));const o=this.driver.options.maxQueryExecutionTime,c=+new Date-a;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=[];for(;s.step();)l.push(s.getAsObject());const u=new Qa;return u.affected=r.getRowsModified(),u.records=l,u.raw=l,s.free(),"SELECT"!==i&&(this.isDirty=!0),n?u:u.raw}catch(n){throw s&&s.free(),this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}}var ns=n(1048).Buffer;class is extends qa{constructor(e){if(super(e),this.options.autoSave&&!this.options.location&&!this.options.autoSaveCallback)throw new Ga.l("location or autoSaveCallback");this.loadDependencies()}async connect(){this.databaseConnection=await this.createDatabaseConnection()}async disconnect(){this.queryRunner=void 0,this.databaseConnection.close()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new ts(this)),this.queryRunner}async load(e,t=!0){if("string"==typeof e){if("node"===Qi.type){if(Qi.fileExist(e)){const t=Qi.readFileSync(e);return this.createDatabaseConnectionWithImport(t)}if(t)throw new Ji.VR(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}{let n=null;if(this.options.useLocalForage){if(!window.localforage)throw new Ji.VR("localforage is not defined - please import localforage.js into your site");n=await window.localforage.getItem(e)}else n=Qi.getGlobalVariable().localStorage.getItem(e);if(null!=n)return this.createDatabaseConnectionWithImport(JSON.parse(n));if(t)throw new Ji.VR(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}}return this.createDatabaseConnectionWithImport(e)}async save(e){if(!e&&!this.options.location)throw new Ji.VR("No location is set, specify a location parameter or add the location option to your configuration");let t="";if(e?t=e:this.options.location&&(t=this.options.location),"node"===Qi.type)try{const e=ns.from(this.databaseConnection.export());await Qi.writeFile(t,e)}catch(e){throw new Ji.VR(`Could not save database, error: ${e}`)}else{const e=this.databaseConnection.export(),n=[].slice.call(e);if(this.options.useLocalForage){if(!window.localforage)throw new Ji.VR("localforage is not defined - please import localforage.js into your site");await window.localforage.setItem(t,JSON.stringify(n))}else Qi.getGlobalVariable().localStorage.setItem(t,JSON.stringify(n))}}async autoSave(){this.options.autoSave&&(this.options.autoSaveCallback?await this.options.autoSaveCallback(this.export()):await this.save())}export(){return this.databaseConnection.export()}createGeneratedMap(e,t){const n=e.generatedColumns.reduce(((e,t)=>{if(t.isPrimary&&"increment"===t.generationStrategy){const n="SELECT last_insert_rowid()";try{let i=this.databaseConnection.exec(n);return this.connection.logger.logQuery(n),Xr.m.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){this.connection.logger.logQueryError(e,n,[])}}return e}),{});return Object.keys(n).length>0?n:void 0}createDatabaseConnection(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)}async createDatabaseConnectionWithImport(e){const t="function"==typeof this.sqlite.Database?this.sqlite:await this.sqlite(this.options.sqlJsConfig);return e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,this.databaseConnection.exec("PRAGMA foreign_keys = ON"),this.databaseConnection}loadDependencies(){if("browser"===Qi.type){const e=this.options.driver||window.SQL;this.sqlite=e}else try{const e=this.options.driver||Qi.load("sql.js");this.sqlite=e}catch(e){throw new Ya.W("sql.js","sql.js")}}}class rs extends Wa{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Ha(this)}async startTransaction(){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive&&void 0===this.transaction)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive&&void 0===this.transaction)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async beforeMigration(){const e=await this.connect();return new Promise(((t,n)=>{e.exec([{sql:"PRAGMA foreign_keys = OFF",args:[]}],!1,(e=>e?n(e):t()))}))}async afterMigration(){const e=await this.connect();return new Promise(((t,n)=>{e.exec([{sql:"PRAGMA foreign_keys = ON",args:[]}],!1,(e=>e?n(e):t()))}))}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;return new Promise((async(i,r)=>{const a=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const s=+new Date;a.transaction((async a=>{void 0===this.transaction&&(await this.startTransaction(),this.transaction=a),this.transaction.executeSql(e,t,((r,a)=>{const o=this.driver.options.maxQueryExecutionTime,c=+new Date-s;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=new Qa;if((null==a?void 0:a.hasOwnProperty("rowsAffected"))&&(l.affected=a.rowsAffected),null==a?void 0:a.hasOwnProperty("rows")){let e=[];for(let t=0;t<a.rows.length;t++)e.push(a.rows.item(t));l.raw=e,l.records=e}e.startsWith("INSERT INTO")&&(l.raw=a.insertId),i(n?l:l.raw)}),((n,i)=>{this.driver.connection.logger.logQueryError(i,e,t,this),r(new Ba.C(e,t,i))}))}),(async e=>{await this.rollbackTransaction(),r(e)}),(()=>{this.isTransactionActive=!1,this.transaction=void 0}))}))}}class as extends qa{constructor(e){if(super(e),this.database=this.options.database,!this.options.database)throw new Ga.l("database");if(!this.options.driver)throw new Ga.l("driver");this.sqlite=this.options.driver}async disconnect(){return new Promise(((e,t)=>{try{this.queryRunner=void 0,this.databaseConnection._db.close(),this.databaseConnection=void 0,e()}catch(e){t(e)}}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new rs(this)),this.queryRunner}createDatabaseConnection(){return new Promise(((e,t)=>{try{const n=this.sqlite.openDatabase(this.options.database);n.transaction((i=>{i.executeSql("PRAGMA foreign_keys = ON",[],((t,i)=>{e(n)}),((e,n)=>{t({transaction:e,error:n})}))}),(e=>{t(e)}))}catch(e){t(e)}}))}}class ss extends Ka{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.client=t,this.broadcaster=new Ha(this)}async connect(){return{}}release(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?await this.client.startTransaction():await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.commitTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.rollbackTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=await this.client.query(e,t),r=new Qa;return r.raw=i,(null==i?void 0:i.hasOwnProperty("records"))&&Array.isArray(i.records)&&(r.records=i.records),(null==i?void 0:i.hasOwnProperty("numberOfRecordsUpdated"))&&(r.affected=i.numberOfRecordsUpdated),n?r:r.raw}stream(e,t,n,i){if(this.isReleased)throw new ja.E;return new Promise((async(r,a)=>{try{const a=(await this.connect()).query(e,t);n&&a.on("end",n),i&&a.on("error",i),r(a)}catch(e){a(e)}}))}async getDatabases(){return Promise.resolve([])}async getSchemas(e){throw new Ji.VR("MySql driver does not support table schemas")}async hasDatabase(e){return!!(await this.query(`SELECT * FROM \`INFORMATION_SCHEMA\`.\`SCHEMATA\` WHERE \`SCHEMA_NAME\` = '${e}'`)).length}async getCurrentDatabase(){return(await this.query("SELECT DATABASE() AS `db_name`"))[0].db_name}async hasSchema(e){throw new Ji.VR("MySql driver does not support table schemas")}async getCurrentSchema(){return(await this.query("SELECT SCHEMA() AS `schema_name`"))[0].schema_name}async hasTable(e){const t=this.driver.parseTableName(e),n=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${t.database}' AND \`TABLE_NAME\` = '${t.tableName}'`;return!!(await this.query(n)).length}async hasColumn(e,t){const n=this.driver.parseTableName(e),i=cr.t.isTableColumn(t)?t.name:t,r=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${n.database}' AND \`TABLE_NAME\` = '${n.tableName}' AND \`COLUMN_NAME\` = '${i}'`;return!!(await this.query(r)).length}async createDatabase(e,t){const n=t?`CREATE DATABASE IF NOT EXISTS \`${e}\``:`CREATE DATABASE \`${e}\``,i=`DROP DATABASE \`${e}\``;await this.executeQueries(new Va(n),new Va(i))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS \`${e}\``:`DROP DATABASE \`${e}\``,i=`CREATE DATABASE \`${e}\``;await this.executeQueries(new Va(n),new Va(i))}async createSchema(e,t){throw new Ji.VR("Schema create queries are not supported by MySql driver.")}async dropSchema(e,t){throw new Ji.VR("Schema drop queries are not supported by MySql driver.")}async createTable(e,t=!1,n=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const i=[],r=[];return i.push(this.createTableSql(e,n)),r.push(this.dropTableSql(e)),e.indices.forEach((t=>r.push(this.dropIndexSql(e,t)))),n&&e.foreignKeys.forEach((t=>r.push(this.dropForeignKeySql(e,t)))),this.executeQueries(i,r)}async dropTable(e,t,n=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const i=n,r=this.getTablePath(e),a=await this.getCachedTable(r),s=[],o=[];n&&a.foreignKeys.forEach((e=>s.push(this.dropForeignKeySql(a,e)))),a.indices.forEach((e=>s.push(this.dropIndexSql(a,e)))),s.push(this.dropTableSql(a)),o.push(this.createTableSql(a,i)),await this.executeQueries(s,o)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=cr.t.isView(e)?e.name:e,n=await this.getCachedView(t),i=[],r=[];i.push(await this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),r.push(await this.insertViewDefinitionSql(n)),r.push(this.createViewSql(n)),await this.executeQueries(i,r)}async renameTable(e,t){const n=[],i=[],r=cr.t.isTable(e)?e:await this.getCachedTable(e),a=r.clone(),{database:s}=this.driver.parseTableName(r);a.name=s?`${s}.${t}`:t,n.push(new Va(`RENAME TABLE ${this.escapePath(r)} TO ${this.escapePath(a)}`)),i.push(new Va(`RENAME TABLE ${this.escapePath(a)} TO ${this.escapePath(r)}`)),a.indices.forEach((e=>{const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),r=this.connection.namingStrategy.indexName(a,e.columnNames,e.where);let s="";e.isUnique&&(s+="UNIQUE "),e.isSpatial&&(s+="SPATIAL "),e.isFulltext&&(s+="FULLTEXT "),n.push(new Va(`ALTER TABLE ${this.escapePath(a)} DROP INDEX \`${e.name}\`, ADD ${s}INDEX \`${r}\` (${t})`)),i.push(new Va(`ALTER TABLE ${this.escapePath(a)} DROP INDEX \`${r}\`, ADD ${s}INDEX \`${e.name}\` (${t})`)),e.name=r})),a.foreignKeys.forEach((e=>{const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),r=e.referencedColumnNames.map((e=>`\`${e}\``)).join(","),s=this.connection.namingStrategy.foreignKeyName(a,e.columnNames);let o=`ALTER TABLE ${this.escapePath(a)} DROP FOREIGN KEY \`${e.name}\`, ADD CONSTRAINT \`${s}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${r})`;e.onDelete&&(o+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(o+=` ON UPDATE ${e.onUpdate}`);let c=`ALTER TABLE ${this.escapePath(a)} DROP FOREIGN KEY \`${s}\`, ADD CONSTRAINT \`${e.name}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${r})`;e.onDelete&&(c+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(c+=` ON UPDATE ${e.onUpdate}`),n.push(new Va(o)),i.push(new Va(c)),e.name=s})),await this.executeQueries(n,i),r.name=a.name,this.replaceCachedTable(r,a)}async addColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone(),r=[],a=[],s=i.primaryColumns.length>0;if(r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(t,s,!1)}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN \`${t.name}\``)),t.isPrimary&&s){const e=i.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const i=e.clone();i.isGenerated=!1,i.generationStrategy=void 0,r.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(i,!0)}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${i.name}\` ${this.buildCreateColumnSql(t,!0)}`))}const s=i.primaryColumns;let o=s.map((e=>`\`${e.name}\``)).join(", ");if(r.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${o})`)),s.push(t),o=s.map((e=>`\`${e.name}\``)).join(", "),r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${o})`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),e){const i=e.clone();i.isGenerated=!1,i.generationStrategy=void 0,r.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${i.name}\` ${this.buildCreateColumnSql(t,!0)}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(i,!0)}`))}}const o=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(o)r.push(this.createIndexSql(n,o)),a.push(this.dropIndexSql(n,o));else if(t.isUnique){const e=new Zi({name:this.connection.namingStrategy.indexName(n,[t.name]),columnNames:[t.name],isUnique:!0});i.indices.push(e),i.uniques.push(new nr({name:e.name,columnNames:e.columnNames})),r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD UNIQUE INDEX \`${e.name}\` (\`${t.name}\`)`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP INDEX \`${e.name}\``))}await this.executeQueries(r,a),i.addColumn(t),this.replaceCachedTable(n,i)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e),r=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!r)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);let a;cr.t.isTableColumn(n)?a=n:(a=r.clone(),a.name=n),await this.changeColumn(i,r,a)}async changeColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e);let r=i.clone();const a=[],s=[],o=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!o)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);if(n.isGenerated!==o.isGenerated&&"uuid"!==n.generationStrategy||o.type!==n.type||o.length!==n.length||o.generatedType!==n.generatedType)await this.dropColumn(i,o),await this.addColumn(i,n),r=i.clone();else{if(n.name!==o.name){a.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${o.name}\` \`${n.name}\` ${this.buildCreateColumnSql(o,!0,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${n.name}\` \`${o.name}\` ${this.buildCreateColumnSql(o,!0,!0)}`)),r.findColumnIndices(o).forEach((e=>{e.columnNames.splice(e.columnNames.indexOf(o.name),1),e.columnNames.push(n.name);const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),c=this.connection.namingStrategy.indexName(r,e.columnNames,e.where);let l="";e.isUnique&&(l+="UNIQUE "),e.isSpatial&&(l+="SPATIAL "),e.isFulltext&&(l+="FULLTEXT "),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP INDEX \`${e.name}\`, ADD ${l}INDEX \`${c}\` (${t})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP INDEX \`${c}\`, ADD ${l}INDEX \`${e.name}\` (${t})`)),e.name=c})),r.findColumnForeignKeys(o).forEach((e=>{e.columnNames.splice(e.columnNames.indexOf(o.name),1),e.columnNames.push(n.name);const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),c=e.referencedColumnNames.map((e=>`\`${e}\``)).join(","),l=this.connection.namingStrategy.foreignKeyName(r,e.columnNames);let u=`ALTER TABLE ${this.escapePath(i)} DROP FOREIGN KEY \`${e.name}\`, ADD CONSTRAINT \`${l}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${c})`;e.onDelete&&(u+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(u+=` ON UPDATE ${e.onUpdate}`);let d=`ALTER TABLE ${this.escapePath(i)} DROP FOREIGN KEY \`${l}\`, ADD CONSTRAINT \`${e.name}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${c})`;e.onDelete&&(d+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(d+=` ON UPDATE ${e.onUpdate}`),a.push(new Va(u)),s.push(new Va(d)),e.name=l}));const e=r.columns.find((e=>e.name===o.name));r.columns[r.columns.indexOf(e)].name=n.name,o.name=n.name}if(this.isColumnChanged(o,n,!0)&&(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${o.name}\` ${this.buildCreateColumnSql(n,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${n.name}\` ${this.buildCreateColumnSql(o,!0)}`))),n.isPrimary!==o.isPrimary){const e=r.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`))}const t=r.primaryColumns;if(t.length>0){const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP PRIMARY KEY`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD PRIMARY KEY (${e})`))}if(!0===n.isPrimary){t.push(n);r.columns.find((e=>e.name===n.name)).isPrimary=!0;const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD PRIMARY KEY (${e})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP PRIMARY KEY`))}else{const e=t.find((e=>e.name===n.name));t.splice(t.indexOf(e),1);if(r.columns.find((e=>e.name===n.name)).isPrimary=!1,t.length>0){const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD PRIMARY KEY (${e})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP PRIMARY KEY`))}}if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`))}}if(n.isUnique!==o.isUnique)if(!0===n.isUnique){const e=new Zi({name:this.connection.namingStrategy.indexName(i,[n.name]),columnNames:[n.name],isUnique:!0});r.indices.push(e),r.uniques.push(new nr({name:e.name,columnNames:e.columnNames})),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD UNIQUE INDEX \`${e.name}\` (\`${n.name}\`)`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP INDEX \`${e.name}\``))}else{const e=r.indices.find((e=>1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((e=>e===n.name))));r.indices.splice(r.indices.indexOf(e),1);const t=r.uniques.find((t=>t.name===e.name));r.uniques.splice(r.uniques.indexOf(t),1),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP INDEX \`${e.name}\``)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD UNIQUE INDEX \`${e.name}\` (\`${n.name}\`)`))}}await this.executeQueries(a,s),this.replaceCachedTable(i,r)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:i}of t)await this.changeColumn(e,n,i)}async dropColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableColumn(t)?t:n.findColumnByName(t);if(!i)throw new Ji.VR(`Column "${t}" was not found in table "${n.name}"`);const r=n.clone(),a=[],s=[];if(i.isPrimary){const e=r.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`))}const t=r.primaryColumns.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(r)} DROP PRIMARY KEY`)),s.push(new Va(`ALTER TABLE ${this.escapePath(r)} ADD PRIMARY KEY (${t})`));if(r.findColumnByName(i.name).isPrimary=!1,r.primaryColumns.length>0){const e=r.primaryColumns.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(r)} ADD PRIMARY KEY (${e})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(r)} DROP PRIMARY KEY`))}if(e&&e.name!==i.name){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`))}}const o=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===i.name));if(o)r.indices.splice(r.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o));else if(i.isUnique){const e=this.connection.namingStrategy.uniqueConstraintName(n,[i.name]),t=r.uniques.find((t=>t.name===e));t&&r.uniques.splice(r.uniques.indexOf(t),1);const o=this.connection.namingStrategy.indexName(n,[i.name]),c=r.indices.find((e=>e.name===o));c&&r.indices.splice(r.indices.indexOf(c),1),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP INDEX \`${o}\``)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD UNIQUE INDEX \`${o}\` (\`${i.name}\`)`))}a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN \`${i.name}\``)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(i,!0)}`)),await this.executeQueries(a,s),r.removeColumn(i),this.replaceCachedTable(n,r)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone(),r=this.createPrimaryKeySql(n,t),a=this.dropPrimaryKeySql(n);await this.executeQueries(r,a),i.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)})),this.replaceCachedTable(n,i)}async updatePrimaryKeys(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone(),r=t.map((e=>e.name)),a=[],s=[],o=i.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(o){const e=o.clone();e.isGenerated=!1,e.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${o.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(o,!0)}`))}const c=i.primaryColumns;if(c.length>0){const e=c.map((e=>`\`${e.name}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${e})`))}i.columns.filter((e=>-1!==r.indexOf(e.name))).forEach((e=>e.isPrimary=!0));const l=r.map((e=>`\`${e}\``)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${l})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`));const u=o||t.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(u){const e=u.clone();e.isGenerated=!1,e.generationStrategy=void 0,a.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(u,!0)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${u.name}\` ${this.buildCreateColumnSql(e,!0)}`));const t=i.columns.find((e=>e.name===u.name));t.isGenerated=!0,t.generationStrategy="increment"}await this.executeQueries(a,s),this.replaceCachedTable(n,i)}async dropPrimaryKey(e){const t=cr.t.isTable(e)?e:await this.getCachedTable(e),n=this.dropPrimaryKeySql(t),i=this.createPrimaryKeySql(t,t.primaryColumns.map((e=>e.name)));await this.executeQueries(n,i),t.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){throw new Ji.VR("MySql does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,t){throw new Ji.VR("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,t){throw new Ji.VR("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,t){throw new Ji.VR("MySql does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,t){throw new Ji.VR("MySql does not support check constraints.")}async createCheckConstraints(e,t){throw new Ji.VR("MySql does not support check constraints.")}async dropCheckConstraint(e,t){throw new Ji.VR("MySql does not support check constraints.")}async dropCheckConstraints(e,t){throw new Ji.VR("MySql does not support check constraints.")}async createExclusionConstraint(e,t){throw new Ji.VR("MySql does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new Ji.VR("MySql does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new Ji.VR("MySql does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new Ji.VR("MySql does not support exclusion constraints.")}async createForeignKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames));const i=this.createForeignKeySql(n,t),r=this.dropForeignKeySql(n,t);await this.executeQueries(i,r),n.addForeignKey(t)}async createForeignKeys(e,t){const n=t.map((t=>this.createForeignKey(e,t)));await Promise.all(n)}async dropForeignKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied foreign key was not found in table ${n.name}`);const r=this.dropForeignKeySql(n,i),a=this.createForeignKeySql(n,i);await this.executeQueries(r,a),n.removeForeignKey(i)}async dropForeignKeys(e,t){const n=t.map((t=>this.dropForeignKey(e,t)));await Promise.all(n)}async createIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const i=this.createIndexSql(n,t),r=this.dropIndexSql(n,t);await this.executeQueries(i,r),n.addIndex(t,!0)}async createIndices(e,t){const n=t.map((t=>this.createIndex(e,t)));await Promise.all(n)}async dropIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied index ${t} was not found in table ${n.name}`);i.name||(i.name=this.generateIndexName(n,i));const r=this.dropIndexSql(n,i),a=this.createIndexSql(n,i);await this.executeQueries(r,a),n.removeIndex(i,!0)}async dropIndices(e,t){const n=t.map((t=>this.dropIndex(e,t)));await Promise.all(n)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(e){const t=e||this.driver.database;if(!t)throw new Ji.VR("Can not clear database. No database is specified");if(!await this.hasDatabase(t))return Promise.resolve();const n=this.isTransactionActive;n||await this.startTransaction();try{const e=`SELECT concat('DROP VIEW IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`VIEWS\` WHERE \`TABLE_SCHEMA\` = '${t}'`,i=await this.query(e);await Promise.all(i.map((e=>this.query(e.query))));const r="SET FOREIGN_KEY_CHECKS = 0;",a=`SELECT concat('DROP TABLE IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_SCHEMA\` = '${t}'`,s="SET FOREIGN_KEY_CHECKS = 1;";await this.query(r);const o=await this.query(a);await Promise.all(o.map((e=>this.query(e.query)))),await this.query(s),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=await this.getCurrentDatabase(),n=e.map((e=>{let{database:n,tableName:i}=this.driver.parseTableName(e);return n||(n=t),`(\`t\`.\`schema\` = '${n}' AND \`t\`.\`name\` = '${i}')`})).join(" OR "),i=`SELECT \`t\`.*, \`v\`.\`check_option\` FROM ${this.escapePath(this.getTypeormMetadataTableName())} \`t\` INNER JOIN \`information_schema\`.\`views\` \`v\` ON \`v\`.\`table_schema\` = \`t\`.\`schema\` AND \`v\`.\`table_name\` = \`t\`.\`name\` WHERE \`t\`.\`type\` = '${$a.VIEW}' ${n?`AND (${n})`:""}`;return(await this.query(i)).map((e=>{const n=new Pa,i=e.schema===t?void 0:e.schema;return n.database=e.schema,n.name=this.driver.buildTableName(e.name,void 0,i),n.expression=e.value,n}))}async loadTables(e){if(e&&0===e.length)return[];const t=[],n=await this.getCurrentDatabase();if(e){const i="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES` WHERE "+e.map((e=>{let[t,i]=e.split(".");return i||(i=t,t=this.driver.database||n),`(\`TABLE_SCHEMA\` = '${t}' AND \`TABLE_NAME\` = '${i}')`})).join(" OR ");t.push(...await this.query(i))}else{const e="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES`";t.push(...await this.query(e))}if(0===t.length)return[];const i=t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`TABLE_SCHEMA\` = '${t}' AND \`TABLE_NAME\` = '${e}')`)).join(" OR "),r="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE "+i,a=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` WHERE \`CONSTRAINT_NAME\` = 'PRIMARY' AND (${i})`,s=`SELECT \`s\`.* FROM \`INFORMATION_SCHEMA\`.\`STATISTICS\` \`s\` LEFT JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`rc\` ON \`s\`.\`INDEX_NAME\` = \`rc\`.\`CONSTRAINT_NAME\` WHERE (${t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`s\`.\`TABLE_SCHEMA\` = '${t}' AND \`s\`.\`TABLE_NAME\` = '${e}')`)).join(" OR ")}) AND \`s\`.\`INDEX_NAME\` != 'PRIMARY' AND \`rc\`.\`CONSTRAINT_NAME\` IS NULL`,o="SELECT `kcu`.`TABLE_SCHEMA`, `kcu`.`TABLE_NAME`, `kcu`.`CONSTRAINT_NAME`, `kcu`.`COLUMN_NAME`, `kcu`.`REFERENCED_TABLE_SCHEMA`, `kcu`.`REFERENCED_TABLE_NAME`, `kcu`.`REFERENCED_COLUMN_NAME`, `rc`.`DELETE_RULE` `ON_DELETE`, `rc`.`UPDATE_RULE` `ON_UPDATE` FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` `kcu` INNER JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `rc`.`constraint_name` = `kcu`.`constraint_name` WHERE "+t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`kcu\`.\`TABLE_SCHEMA\` = '${t}' AND \`kcu\`.\`TABLE_NAME\` = '${e}')`)).join(" OR "),[c,l,u,d,h]=await Promise.all([this.query(r),this.query(a),this.query("SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`"),this.query(s),this.query(o)]);return Promise.all(t.map((async e=>{const t=new ar,i=u.find((t=>t.SCHEMA_NAME===e.TABLE_SCHEMA)),r=i.COLLATION,a=i.CHARSET,s=e.TABLE_SCHEMA===n?void 0:e.TABLE_SCHEMA;t.database=e.TABLE_SCHEMA,t.name=this.driver.buildTableName(e.TABLE_NAME,void 0,s),t.columns=c.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)).map((n=>{const i=d.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.COLUMN_NAME===n.COLUMN_NAME&&0===parseInt(t.NON_UNIQUE,10))),s=this.connection.entityMetadatas.find((e=>this.getTablePath(t)===this.getTablePath(e))),o=i.length>0&&s&&s.indices.some((e=>i.some((t=>e.name===t.INDEX_NAME&&!1===e.synchronize)))),c=i.every((e=>d.some((t=>t.INDEX_NAME===e.INDEX_NAME&&t.COLUMN_NAME!==n.COLUMN_NAME)))),u=new Xi;if(u.name=n.COLUMN_NAME,u.type=n.DATA_TYPE.toLowerCase(),-1!==this.driver.withWidthColumnTypes.indexOf(u.type)){const e=n.COLUMN_TYPE.substring(n.COLUMN_TYPE.indexOf("(")+1,n.COLUMN_TYPE.indexOf(")"));u.width=e&&!this.isDefaultColumnWidth(t,u,parseInt(e))?parseInt(e):void 0}if(null===n.COLUMN_DEFAULT||void 0===n.COLUMN_DEFAULT?u.default=void 0:u.default="CURRENT_TIMESTAMP"===n.COLUMN_DEFAULT?n.COLUMN_DEFAULT:`'${n.COLUMN_DEFAULT}'`,-1!==n.EXTRA.indexOf("on update")&&(u.onUpdate=n.EXTRA.substring(n.EXTRA.indexOf("on update")+10)),n.GENERATION_EXPRESSION&&(u.asExpression=n.GENERATION_EXPRESSION,u.generatedType=-1!==n.EXTRA.indexOf("VIRTUAL")?"VIRTUAL":"STORED"),u.isUnique=i.length>0&&!o&&!c,u.isNullable="YES"===n.IS_NULLABLE,u.isPrimary=l.some((e=>e.TABLE_NAME===n.TABLE_NAME&&e.TABLE_SCHEMA===n.TABLE_SCHEMA&&e.COLUMN_NAME===n.COLUMN_NAME)),u.zerofill=-1!==n.COLUMN_TYPE.indexOf("zerofill"),u.unsigned=!!u.zerofill||-1!==n.COLUMN_TYPE.indexOf("unsigned"),u.isGenerated=-1!==n.EXTRA.indexOf("auto_increment"),u.isGenerated&&(u.generationStrategy="increment"),u.comment="string"==typeof n.COLUMN_COMMENT&&0===n.COLUMN_COMMENT.length?void 0:n.COLUMN_COMMENT,n.CHARACTER_SET_NAME&&(u.charset=n.CHARACTER_SET_NAME===a?void 0:n.CHARACTER_SET_NAME),n.COLLATION_NAME&&(u.collation=n.COLLATION_NAME===r?void 0:n.COLLATION_NAME),-1!==this.driver.withLengthColumnTypes.indexOf(u.type)&&n.CHARACTER_MAXIMUM_LENGTH){const e=n.CHARACTER_MAXIMUM_LENGTH.toString();u.length=this.isDefaultColumnLength(t,u,e)?"":e}if("decimal"!==u.type&&"double"!==u.type&&"float"!==u.type||(null===n.NUMERIC_PRECISION||this.isDefaultColumnPrecision(t,u,n.NUMERIC_PRECISION)||(u.precision=parseInt(n.NUMERIC_PRECISION)),null===n.NUMERIC_SCALE||this.isDefaultColumnScale(t,u,n.NUMERIC_SCALE)||(u.scale=parseInt(n.NUMERIC_SCALE))),"enum"===u.type||"simple-enum"===u.type||"set"===u.type){const e=n.COLUMN_TYPE,t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(",");u.enum=t.map((e=>e.substring(1,e.length-1))),u.length=""}return"datetime"!==u.type&&"time"!==u.type&&"timestamp"!==u.type||null===n.DATETIME_PRECISION||void 0===n.DATETIME_PRECISION||this.isDefaultColumnPrecision(t,u,parseInt(n.DATETIME_PRECISION))||(u.precision=parseInt(n.DATETIME_PRECISION)),u}));const o=Xr.m.uniq(h.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)),(e=>e.CONSTRAINT_NAME));t.foreignKeys=o.map((e=>{const t=h.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME)),i=e.REFERENCED_TABLE_SCHEMA===n?void 0:e.REFERENCED_TABLE_SCHEMA,r=this.driver.buildTableName(e.REFERENCED_TABLE_NAME,void 0,i);return new er({name:e.CONSTRAINT_NAME,columnNames:t.map((e=>e.COLUMN_NAME)),referencedDatabase:e.REFERENCED_TABLE_SCHEMA,referencedTableName:r,referencedColumnNames:t.map((e=>e.REFERENCED_COLUMN_NAME)),onDelete:e.ON_DELETE,onUpdate:e.ON_UPDATE})}));const p=Xr.m.uniq(d.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)),(e=>e.INDEX_NAME));return t.indices=p.map((e=>{const n=d.filter((t=>t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME)),i=parseInt(e.NON_UNIQUE,10);return new Zi({table:t,name:e.INDEX_NAME,columnNames:n.map((e=>e.COLUMN_NAME)),isUnique:0===i,isSpatial:"SPATIAL"===e.INDEX_TYPE,isFulltext:"FULLTEXT"===e.INDEX_TYPE})})),t})))}createTableSql(e,t){const n=e.columns.map((e=>this.buildCreateColumnSql(e,!0))).join(", ");let i=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{const n=e.indices.some((e=>1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name))),i=e.uniques.some((e=>1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)));n||i||e.indices.push(new Zi({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((t=>{e.indices.some((e=>e.name===t.name))||e.indices.push(new Zi({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.indices.length>0){i+=`, ${e.indices.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where));let i="";return t.isUnique&&(i+="UNIQUE "),t.isSpatial&&(i+="SPATIAL "),t.isFulltext&&(i+="FULLTEXT "),`${i}INDEX \`${t.name}\` (${n})`})).join(", ")}`}if(e.foreignKeys.length>0&&t){i+=`, ${e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames));const i=t.referencedColumnNames.map((e=>`\`${e}\``)).join(", ");let r=`CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${i})`;return t.onDelete&&(r+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(r+=` ON UPDATE ${t.onUpdate}`),r})).join(", ")}`}if(e.primaryColumns.length>0){i+=`, PRIMARY KEY (${e.primaryColumns.map((e=>`\`${e.name}\``)).join(", ")})`}return i+=`) ENGINE=${e.engine||"InnoDB"}`,new Va(i)}dropTableSql(e){return new Va(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){return"string"==typeof e.expression?new Va(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression}`):new Va(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const t=await this.getCurrentDatabase(),n="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:$a.VIEW,schema:t,name:e.name,value:n})}dropViewSql(e){return new Va(`DROP VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const t=await this.getCurrentDatabase(),n=cr.t.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:$a.VIEW,schema:t,name:n})}createIndexSql(e,t){const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");let i="";return t.isUnique&&(i+="UNIQUE "),t.isSpatial&&(i+="SPATIAL "),t.isFulltext&&(i+="FULLTEXT "),new Va(`CREATE ${i}INDEX \`${t.name}\` ON ${this.escapePath(e)} (${n})`)}dropIndexSql(e,t){let n=cr.t.isTableIndex(t)?t.name:t;return new Va(`DROP INDEX \`${n}\` ON ${this.escapePath(e)}`)}createPrimaryKeySql(e,t){const n=t.map((e=>`\`${e}\``)).join(", ");return new Va(`ALTER TABLE ${this.escapePath(e)} ADD PRIMARY KEY (${n})`)}dropPrimaryKeySql(e){return new Va(`ALTER TABLE ${this.escapePath(e)} DROP PRIMARY KEY`)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>`\`${e}\``)).join(", "),i=t.referencedColumnNames.map((e=>`\`${e}\``)).join(",");let r=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))}(${i})`;return t.onDelete&&(r+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(r+=` ON UPDATE ${t.onUpdate}`),new Va(r)}dropForeignKeySql(e,t){const n=cr.t.isTableForeignKey(t)?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP FOREIGN KEY \`${n}\``)}escapeComment(e){return e&&0!==e.length?`'${e=e.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\u0000/g,"")}'`:"''"}escapePath(e){const{database:t,tableName:n}=this.driver.parseTableName(e);return t&&t!==this.driver.database?`\`${t}\`.\`${n}\``:`\`${n}\``}buildCreateColumnSql(e,t,n=!1){let i="";return i=n?this.connection.driver.createFullType(e):`\`${e.name}\` ${this.connection.driver.createFullType(e)}`,e.asExpression&&(i+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`),e.zerofill?i+=" ZEROFILL":e.unsigned&&(i+=" UNSIGNED"),e.enum&&(i+=` (${e.enum.map((e=>"'"+e+"'")).join(", ")})`),e.charset&&(i+=` CHARACTER SET "${e.charset}"`),e.collation&&(i+=` COLLATE "${e.collation}"`),e.isNullable||(i+=" NOT NULL"),e.isNullable&&(i+=" NULL"),e.isPrimary&&!t&&(i+=" PRIMARY KEY"),e.isGenerated&&"increment"===e.generationStrategy&&(i+=" AUTO_INCREMENT"),e.comment&&(i+=` COMMENT ${this.escapeComment(e.comment)}`),void 0!==e.default&&null!==e.default&&(i+=` DEFAULT ${e.default}`),e.onUpdate&&(i+=` ON UPDATE ${e.onUpdate}`),i}isDefaultColumnWidth(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&n.width)return!1}const i=this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].width;return!!i&&i===n}}var os=n(1048).Buffer;class cs{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["bit","int","integer","tinyint","smallint","mediumint","bigint","float","double","double precision","real","decimal","dec","numeric","fixed","bool","boolean","date","datetime","timestamp","time","year","char","nchar","national char","varchar","nvarchar","national varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","set","binary","varbinary","json","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.supportedUpsertType="on-duplicate-key-update",this.spatialTypes=["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.withLengthColumnTypes=["char","varchar","nvarchar","binary","varbinary"],this.withWidthColumnTypes=["bit","tinyint","smallint","mediumint","int","integer","bigint"],this.withPrecisionColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real","time","datetime","timestamp"],this.withScaleColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real"],this.unsignedAndZerofillTypes=["int","integer","smallint","tinyint","mediumint","bigint","decimal","dec","numeric","fixed","float","double","double precision","real"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",deleteDate:"datetime",deleteDatePrecision:6,deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255},"national varchar":{length:255},char:{length:1},binary:{length:1},varbinary:{length:255},decimal:{precision:10,scale:0},dec:{precision:10,scale:0},numeric:{precision:10,scale:0},fixed:{precision:10,scale:0},float:{precision:12},double:{precision:22},time:{precision:0},datetime:{precision:0},timestamp:{precision:0},bit:{width:1},int:{width:11},integer:{width:11},tinyint:{width:4},smallint:{width:6},mediumint:{width:9},bigint:{width:20}},this.maxAliasLength=63,this.cteCapabilities={enabled:!1},this.connection=e,this.options=e.options,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),this.database=gr.I.buildDriverOptions(this.options).database}async connect(){if(!this.database){const e=await this.createQueryRunner("master");this.database=await e.getCurrentDatabase(),await e.release()}}afterConnect(){return Promise.resolve()}async disconnect(){}createSchemaBuilder(){return new La(this.connection)}createQueryRunner(e){return new ss(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions))}escapeQueryWithParameters(e,t,n){const i=Object.keys(n).map((e=>n[e]));return t&&Object.keys(t).length?[e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,r)=>{if(!t.hasOwnProperty(r))return e;let a=t[r];return n?a.map((e=>(i.push(e),this.createParameter(r,i.length-1)))).join(", "):"function"==typeof a?a():(i.push(a),this.createParameter(r,i.length-1))})),i]:[e,i]}escape(e){return"`"+e+"`"}buildTableName(e,t,n){let i=[e];return n&&i.unshift(n),i.join(".")}parseTableName(e){const t=this.database,n=void 0;if(cr.t.isTable(e)||cr.t.isView(e)){const i=this.parseTableName(e.name);return{database:e.database||i.database||t,schema:e.schema||i.schema||n,tableName:i.tableName}}if(cr.t.isTableForeignKey(e)){const i=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||i.database||t,schema:e.referencedSchema||i.schema||n,tableName:i.tableName}}if(cr.t.isEntityMetadata(e))return{database:e.database||t,schema:e.schema||n,tableName:e.tableName};const i=e.split(".");return{database:(i.length>1?i[0]:void 0)||t,schema:n,tableName:i.length>1?i[1]:i[0]}}preparePersistentValue(e,t){return t.transformer&&(e=Zr.W.transformTo(t.transformer,e)),this.options.formatOptions&&!1===this.options.formatOptions.castParameters?null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?Jr.mixedDateToDateString(e):"time"===t.type?Jr.mixedDateToTimeString(e):"json"===t.type?JSON.stringify(e):"timestamp"===t.type||"datetime"===t.type||t.type===Date?Jr.mixedDateToDate(e):"simple-array"===t.type||"set"===t.type?Jr.simpleArrayToString(e):"simple-json"===t.type?Jr.simpleJsonToString(e):"enum"===t.type||"simple-enum"===t.type?""+e:e:this.client.preparePersistentValue(e,t)}prepareHydratedValue(e,t){return null==e?t.transformer?Zr.W.transformFrom(t.transformer,e):e:this.options.formatOptions&&!1===this.options.formatOptions.castParameters?(t.type===Boolean||"bool"===t.type||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?e=Jr.normalizeHydratedDate(e):"date"===t.type?e=Jr.mixedDateToDateString(e):"json"===t.type?e="string"==typeof e?JSON.parse(e):e:"time"===t.type?e=Jr.mixedTimeToString(e):"simple-array"===t.type||"set"===t.type?e=Jr.stringToSimpleArray(e):"simple-json"===t.type?e=Jr.stringToSimpleJson(e):("enum"===t.type||"simple-enum"===t.type)&&t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),t.transformer&&(e=Zr.W.transformFrom(t.transformer,e)),e):this.client.prepareHydratedValue(e,t)}normalizeType(e){return e.type===Number||"integer"===e.type?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===os?"blob":e.type===Boolean?"tinyint":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"enum":"double precision"===e.type||"real"===e.type?"double":"dec"===e.type||"numeric"===e.type||"fixed"===e.type?"decimal":"bool"===e.type||"boolean"===e.type?"tinyint":"nvarchar"===e.type||"national varchar"===e.type?"varchar":"nchar"===e.type||"national char"===e.type?"char":e.type||""}normalizeDefault(e){const t=e.default;if(null!==t){if(("enum"===e.type||"simple-enum"===e.type)&&void 0!==t)return`'${t}'`;if("set"===e.type&&void 0!==t)return`'${Jr.simpleArrayToString(t)}'`;if("number"==typeof t)return`${t}`;if("boolean"==typeof t)return t?"1":"0";if("function"==typeof t)return t();if("string"==typeof t)return`'${t}'`;if(void 0!==t)return`${t}`}}normalizeIsUnique(e){return e.entityMetadata.indices.some((t=>t.isUnique&&1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case String:case"varchar":case"nvarchar":case"national varchar":case"varbinary":return"255";default:return""}}createFullType(e){let t=e.type;return this.getColumnLength(e)?t+=`(${this.getColumnLength(e)})`:e.width?t+=`(${e.width})`:null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=`(${e.precision},${e.scale})`:null!==e.precision&&void 0!==e.precision&&(t+=`(${e.precision})`),e.isArray&&(t+=" array"),t}obtainMasterConnection(){return new Promise(((e,t)=>{this.poolCluster?this.poolCluster.getConnection("MASTER",((n,i)=>{n?t(n):e(this.prepareDbConnection(i))})):this.pool?this.pool.getConnection(((n,i)=>{n?t(n):e(this.prepareDbConnection(i))})):t(new Ji.VR("Connection is not established with mysql database"))}))}obtainSlaveConnection(){return this.poolCluster?new Promise(((e,t)=>{this.poolCluster.getConnection("SLAVE*",((n,i)=>{n?t(n):e(this.prepareDbConnection(i))}))})):this.obtainMasterConnection()}createGeneratedMap(e,t,n){const i=e.generatedColumns.reduce(((e,i)=>{let r;return"increment"===i.generationStrategy&&t.insertId&&(r=t.insertId+n),Xr.m.mergeDeep(e,i.createValueMap(r))}),{});return Object.keys(i).length>0?i:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;let i=t.length;return i||"uuid"!==t.generationStrategy||(i=this.getColumnLength(t)),n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==i||n.width!==t.width||n.precision!==t.precision||n.scale!==t.scale||n.zerofill!==t.zerofill||n.unsigned!==t.unsigned||n.asExpression!==t.asExpression||n.generatedType!==t.generatedType||n.comment!==this.escapeComment(t.comment)||!this.compareDefaultValues(this.normalizeDefault(t),n.default)||n.enum&&t.enum&&!Xr.m.isArraysEqual(n.enum,t.enum.map((e=>e+"")))||n.onUpdate!==t.onUpdate||n.isPrimary!==t.isPrimary||n.isNullable!==t.isNullable||n.isUnique!==this.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&n.isGenerated!==t.isGenerated}))}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!0}createParameter(e,t){return"?"}loadDependencies(){const e=this.options.driver||Qi.load("typeorm-aurora-data-api-driver");this.DataApiDriver=e,this.DataApiDriver=this.DataApiDriver.default||this.DataApiDriver}createConnectionOptions(e,t){return t=Object.assign({},t,gr.I.buildDriverOptions(t)),Object.assign({},{resourceArn:e.resourceArn,secretArn:e.secretArn,database:e.database,region:e.region,type:e.type},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})}async createPool(e){return{}}prepareDbConnection(e){const{logger:t}=this.connection;return 0===e.listeners("error").length&&e.on("error",(e=>t.log("warn",`MySQL connection raised an error. ${e}`))),e}compareDefaultValues(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t}escapeComment(e){return e?e=e.replace(/\u0000/g,""):e}}var ls=n(1572);class us extends Ka{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.mode=t,this.broadcaster=new Ha(this)}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((([e,t])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const n=e=>this.releasePostgresConnection(e);return this.releaseCallback=e=>{this.databaseConnection.removeListener("error",n),t(e)},this.databaseConnection.on("error",n),this.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((([e,t])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const n=e=>this.releasePostgresConnection(e);return this.releaseCallback=e=>{this.databaseConnection.removeListener("error",n),t(e)},this.databaseConnection.on("error",n),this.databaseConnection}))),this.databaseConnectionPromise)}async releasePostgresConnection(e){if(this.isReleased)return;this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0);const t=this.driver.connectedQueryRunners.indexOf(this);-1!==t&&this.driver.connectedQueryRunners.splice(t,1)}release(){return this.releasePostgresConnection()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?(await this.query("START TRANSACTION"),e&&await this.query("SET TRANSACTION ISOLATION LEVEL "+e)):await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("COMMIT"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("ROLLBACK"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=await this.connect();this.driver.connection.logger.logQuery(e,t,this);try{const r=+new Date,a=await i.query(e,t),s=this.driver.options.maxQueryExecutionTime,o=+new Date-r;s&&o>s&&this.driver.connection.logger.logQuerySlow(o,e,t,this);const c=new Qa;if(a){switch(a.hasOwnProperty("rows")&&(c.records=a.rows),a.hasOwnProperty("rowCount")&&(c.affected=a.rowCount),a.command){case"DELETE":case"UPDATE":c.raw=[a.rows,a.rowCount];break;default:c.raw=a.rows}if(!n)return c.raw}return c}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}async stream(e,t,n,i){const r=this.driver.loadStreamDependency();if(this.isReleased)throw new ja.E;const a=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const s=a.query(new r(e,t));return n&&s.on("end",n),i&&s.on("error",i),s}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return!!(await this.query(`SELECT * FROM pg_database WHERE datname='${e}';`)).length}async getCurrentDatabase(){return(await this.query("SELECT * FROM current_database()"))[0].current_database}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){return(await this.query("SELECT * FROM current_schema()"))[0].current_schema}async hasTable(e){const t=this.driver.parseTableName(e);t.schema||(t.schema=await this.getCurrentSchema());const n=`SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '${t.schema}' AND "table_name" = '${t.tableName}'`;return!!(await this.query(n)).length}async hasColumn(e,t){const n=this.driver.parseTableName(e);n.schema||(n.schema=await this.getCurrentSchema());const i=`SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '${n.schema}' AND "table_name" = '${n.tableName}' AND "column_name" = '${t}'`;return!!(await this.query(i)).length}async createDatabase(e,t){if(t){if(await this.hasDatabase(e))return Promise.resolve()}const n=`CREATE DATABASE "${e}"`,i=`DROP DATABASE "${e}"`;await this.executeQueries(new Va(n),new Va(i))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,i=`CREATE DATABASE "${e}"`;await this.executeQueries(new Va(n),new Va(i))}async createSchema(e,t){const n=-1===e.indexOf(".")?e:e.split(".")[1],i=t?`CREATE SCHEMA IF NOT EXISTS "${n}"`:`CREATE SCHEMA "${n}"`,r=`DROP SCHEMA "${n}" CASCADE`;await this.executeQueries(new Va(i),new Va(r))}async dropSchema(e,t,n){const i=-1===e.indexOf(".")?e:e.split(".")[1],r=t?`DROP SCHEMA IF EXISTS "${i}" ${n?"CASCADE":""}`:`DROP SCHEMA "${i}" ${n?"CASCADE":""}`,a=`CREATE SCHEMA "${i}"`;await this.executeQueries(new Va(r),new Va(a))}async createTable(e,t=!1,n=!0,i=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const r=[],a=[],s=e.columns.filter((e=>"enum"===e.type||"simple-enum"===e.type)),o=[];for(const t of s){const n=await this.hasEnumType(e,t),i=this.buildEnumName(e,t);n||-1!==o.indexOf(i)||(o.push(i),r.push(this.createEnumTypeSql(e,t,i)),a.push(this.dropEnumTypeSql(e,t,i)))}const c=e.columns.filter((e=>"STORED"===e.generatedType&&e.asExpression));for(const t of c){const n=(await this.getTableNameWithSchema(e.name)).split("."),i=n[1],s=n[0],o=this.insertTypeormMetadataSql({database:this.driver.database,schema:s,table:i,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),c=this.deleteTypeormMetadataSql({database:this.driver.database,schema:s,table:i,type:$a.GENERATED_COLUMN,name:t.name});r.push(o),a.push(c)}r.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((t=>a.push(this.dropForeignKeySql(e,t)))),i&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),r.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(e,t))})),await this.executeQueries(r,a)}async dropTable(e,t,n=!0,i=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const r=n,a=this.getTablePath(e),s=await this.getCachedTable(a),o=[],c=[];i&&s.indices.forEach((e=>{o.push(this.dropIndexSql(s,e)),c.push(this.createIndexSql(s,e))})),n&&s.foreignKeys.forEach((e=>o.push(this.dropForeignKeySql(s,e)))),o.push(this.dropTableSql(s)),c.push(this.createTableSql(s,r));const l=s.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of l){const t=(await this.getTableNameWithSchema(s.name)).split("."),n=t[1],i=t[0],r=this.deleteTypeormMetadataSql({database:this.driver.database,schema:i,table:n,type:$a.GENERATED_COLUMN,name:e.name}),a=this.insertTypeormMetadataSql({database:this.driver.database,schema:i,table:n,type:$a.GENERATED_COLUMN,name:e.name,value:e.asExpression});o.push(r),c.push(a)}await this.executeQueries(o,c)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=cr.t.isView(e)?e.name:e,n=await this.getCachedView(t),i=[],r=[];i.push(await this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),r.push(await this.insertViewDefinitionSql(n)),r.push(this.createViewSql(n)),await this.executeQueries(i,r)}async renameTable(e,t){const n=[],i=[],r=cr.t.isTable(e)?e:await this.getCachedTable(e),a=r.clone(),{schema:s,tableName:o}=this.driver.parseTableName(r);if(a.name=s?`${s}.${t}`:t,n.push(new Va(`ALTER TABLE ${this.escapePath(r)} RENAME TO "${t}"`)),i.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME TO "${o}"`)),a.primaryColumns.length>0&&!a.primaryColumns[0].primaryKeyConstraintName){const e=a.primaryColumns.map((e=>e.name)),t=this.connection.namingStrategy.primaryKeyName(r,e),s=this.connection.namingStrategy.primaryKeyName(a,e);n.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${t}" TO "${s}"`)),i.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${t}"`))}a.columns.map((e=>{if(e.isGenerated&&"increment"===e.generationStrategy){const t=this.buildSequencePath(r,e.name),s=this.buildSequenceName(r,e.name),o=this.buildSequencePath(a,e.name),c=this.buildSequenceName(a,e.name),l=`ALTER SEQUENCE ${this.escapePath(t)} RENAME TO "${c}"`,u=`ALTER SEQUENCE ${this.escapePath(o)} RENAME TO "${s}"`;n.push(new Va(l)),i.push(new Va(u))}})),a.uniques.forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(r,e.columnNames);if(e.name!==t)return;const s=this.connection.namingStrategy.uniqueConstraintName(a,e.columnNames);n.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${e.name}" TO "${s}"`)),i.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${e.name}"`)),e.name=s})),a.indices.forEach((e=>{const t=this.connection.namingStrategy.indexName(r,e.columnNames,e.where);if(e.name!==t)return;const{schema:s}=this.driver.parseTableName(a),o=this.connection.namingStrategy.indexName(a,e.columnNames,e.where),c=s?`ALTER INDEX "${s}"."${e.name}" RENAME TO "${o}"`:`ALTER INDEX "${e.name}" RENAME TO "${o}"`,l=s?`ALTER INDEX "${s}"."${o}" RENAME TO "${e.name}"`:`ALTER INDEX "${o}" RENAME TO "${e.name}"`;n.push(new Va(c)),i.push(new Va(l)),e.name=o})),a.foreignKeys.forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(r,e.columnNames,this.getTablePath(e),e.referencedColumnNames);if(e.name!==t)return;const s=this.connection.namingStrategy.foreignKeyName(a,e.columnNames,this.getTablePath(e),e.referencedColumnNames);n.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${e.name}" TO "${s}"`)),i.push(new Va(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${e.name}"`)),e.name=s}));const c=a.columns.filter((e=>"enum"===e.type||"simple-enum"===e.type));for(let e of c){if(e.enumName)continue;const t=await this.getUserDefinedTypeName(r,e);n.push(new Va(`ALTER TYPE "${t.schema}"."${t.name}" RENAME TO ${this.buildEnumName(a,e,!1)}`)),i.push(new Va(`ALTER TYPE ${this.buildEnumName(a,e)} RENAME TO "${t.name}"`))}await this.executeQueries(n,i)}async addColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone(),r=[],a=[];if("enum"===t.type||"simple-enum"===t.type){await this.hasEnumType(n,t)||(r.push(this.createEnumTypeSql(n,t)),a.push(this.dropEnumTypeSql(n,t)))}if(r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(n,t)}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN "${t.name}"`)),t.isPrimary){const e=i.primaryColumns;if(e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,e.map((e=>e.name))),s=e.map((e=>`"${e.name}"`)).join(", ");r.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${t}"`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${t}" PRIMARY KEY (${s})`))}e.push(t);const s=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,e.map((e=>e.name))),o=e.map((e=>`"${e.name}"`)).join(", ");r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${s}" PRIMARY KEY (${o})`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${s}"`))}const s=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(s&&(r.push(this.createIndexSql(n,s)),a.push(this.dropIndexSql(n,s))),t.isUnique){const e=new nr({name:this.connection.namingStrategy.uniqueConstraintName(n,[t.name]),columnNames:[t.name]});i.uniques.push(e),r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${e.name}" UNIQUE ("${t.name}")`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${e.name}"`))}if("STORED"===t.generatedType&&t.asExpression){const e=(await this.getTableNameWithSchema(n.name)).split("."),i=e[1],s=e[0],o=this.insertTypeormMetadataSql({database:this.driver.database,schema:s,table:i,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),c=this.deleteTypeormMetadataSql({database:this.driver.database,schema:s,table:i,type:$a.GENERATED_COLUMN,name:t.name});r.push(o),a.push(c)}t.comment&&(r.push(new Va(`COMMENT ON COLUMN ${this.escapePath(n)}."${t.name}" IS ${this.escapeComment(t.comment)}`)),a.push(new Va(`COMMENT ON COLUMN ${this.escapePath(n)}."${t.name}" IS ${this.escapeComment(t.comment)}`))),await this.executeQueries(r,a),i.addColumn(t),this.replaceCachedTable(n,i)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e),r=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!r)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);let a;return cr.t.isTableColumn(n)?a=n:(a=r.clone(),a.name=n),this.changeColumn(i,r,a)}async changeColumn(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e);let r=i.clone();const a=[],s=[];let o=!1;const c=cr.t.isTableColumn(t)?t:i.columns.find((e=>e.name===t));if(!c)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);if(c.type!==n.type||c.length!==n.length||n.isArray!==c.isArray||!c.generatedType&&"STORED"===n.generatedType||c.asExpression!==n.asExpression&&"STORED"===n.generatedType)await this.dropColumn(i,c),await this.addColumn(i,n),r=i.clone();else{if(c.name!==n.name){if(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME COLUMN "${c.name}" TO "${n.name}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME COLUMN "${n.name}" TO "${c.name}"`)),"enum"===c.type||"simple-enum"===c.type){const e=await this.getUserDefinedTypeName(i,c);a.push(new Va(`ALTER TYPE "${e.schema}"."${e.name}" RENAME TO ${this.buildEnumName(i,n,!1)}`)),s.push(new Va(`ALTER TYPE ${this.buildEnumName(i,n)} RENAME TO "${e.name}"`))}if(!0===c.isPrimary&&!c.primaryKeyConstraintName){const e=r.primaryColumns.map((e=>e.name)),t=this.connection.namingStrategy.primaryKeyName(r,e);e.splice(e.indexOf(c.name),1),e.push(n.name);const o=this.connection.namingStrategy.primaryKeyName(r,e);a.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${t}" TO "${o}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${o}" TO "${t}"`))}if(!0===c.isGenerated&&"increment"===n.generationStrategy){const e=this.buildSequencePath(i,c.name),t=this.buildSequenceName(i,c.name),r=this.buildSequencePath(i,n.name),o=this.buildSequenceName(i,n.name),l=`ALTER SEQUENCE ${this.escapePath(e)} RENAME TO "${o}"`,u=`ALTER SEQUENCE ${this.escapePath(r)} RENAME TO "${t}"`;a.push(new Va(l)),s.push(new Va(u))}r.findColumnUniques(c).forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(r,e.columnNames);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const o=this.connection.namingStrategy.uniqueConstraintName(r,e.columnNames);a.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${e.name}" TO "${o}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${o}" TO "${e.name}"`)),e.name=o})),r.findColumnIndices(c).forEach((e=>{const t=this.connection.namingStrategy.indexName(r,e.columnNames,e.where);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const{schema:o}=this.driver.parseTableName(i),l=this.connection.namingStrategy.indexName(r,e.columnNames,e.where),u=o?`ALTER INDEX "${o}"."${e.name}" RENAME TO "${l}"`:`ALTER INDEX "${e.name}" RENAME TO "${l}"`,d=o?`ALTER INDEX "${o}"."${l}" RENAME TO "${e.name}"`:`ALTER INDEX "${l}" RENAME TO "${e.name}"`;a.push(new Va(u)),s.push(new Va(d)),e.name=l})),r.findColumnForeignKeys(c).forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(r,e.columnNames,this.getTablePath(e),e.referencedColumnNames);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const o=this.connection.namingStrategy.foreignKeyName(r,e.columnNames,this.getTablePath(e),e.referencedColumnNames);a.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${e.name}" TO "${o}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME CONSTRAINT "${o}" TO "${e.name}"`)),e.name=o}));const e=r.columns.find((e=>e.name===c.name));r.columns[r.columns.indexOf(e)].name=n.name,c.name=n.name}if(n.precision===c.precision&&n.scale===c.scale||(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(c)}`))),!("enum"!==n.type&&"simple-enum"!==n.type||"enum"!==c.type&&"simple-enum"!==c.type||Xr.m.isArraysEqual(n.enum,c.enum)&&n.enumName===c.enumName)){const e=n.isArray?"[]":"",t=this.buildEnumName(i,n),r=this.buildEnumName(i,c),l=this.buildEnumName(i,c,!1),u=this.buildEnumName(i,c,!0,!1,!0),d=this.buildEnumName(i,c,!1,!1,!0);a.push(new Va(`ALTER TYPE ${r} RENAME TO ${d}`)),s.push(new Va(`ALTER TYPE ${u} RENAME TO ${l}`)),a.push(this.createEnumTypeSql(i,n,t)),s.push(this.dropEnumTypeSql(i,n,t)),null!==c.default&&void 0!==c.default&&(o=!0,a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" SET DEFAULT ${c.default}`)));const h=`${t}${e} USING "${n.name}"::"text"::${t}${e}`,p=`${u}${e} USING "${n.name}"::"text"::${u}${e}`;a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${h}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${p}`)),null!==n.default&&void 0!==n.default&&(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${n.default}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`))),a.push(this.dropEnumTypeSql(i,c,u)),s.push(this.createEnumTypeSql(i,c,u))}if(c.isNullable!==n.isNullable&&(n.isNullable?(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" DROP NOT NULL`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" SET NOT NULL`))):(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" SET NOT NULL`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" DROP NOT NULL`)))),c.comment!==n.comment&&(a.push(new Va(`COMMENT ON COLUMN ${this.escapePath(i)}."${c.name}" IS ${this.escapeComment(n.comment)}`)),s.push(new Va(`COMMENT ON COLUMN ${this.escapePath(i)}."${n.name}" IS ${this.escapeComment(c.comment)}`))),n.isPrimary!==c.isPrimary){const e=r.primaryColumns;if(e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,e.map((e=>e.name))),n=e.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${t}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${t}" PRIMARY KEY (${n})`))}if(!0===n.isPrimary){e.push(n);r.columns.find((e=>e.name===n.name)).isPrimary=!0;const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,e.map((e=>e.name))),o=e.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${t}" PRIMARY KEY (${o})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${t}"`))}else{const t=e.find((e=>e.name===n.name));e.splice(e.indexOf(t),1);if(r.columns.find((e=>e.name===n.name)).isPrimary=!1,e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,e.map((e=>e.name))),n=e.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${t}" PRIMARY KEY (${n})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${t}"`))}}}if(n.isUnique!==c.isUnique)if(!0===n.isUnique){const e=new nr({name:this.connection.namingStrategy.uniqueConstraintName(i,[n.name]),columnNames:[n.name]});r.uniques.push(e),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${e.name}" UNIQUE ("${n.name}")`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${e.name}"`))}else{const e=r.uniques.find((e=>1===e.columnNames.length&&!!e.columnNames.find((e=>e===n.name))));r.uniques.splice(r.uniques.indexOf(e),1),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${e.name}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${e.name}" UNIQUE ("${n.name}")`))}if(c.isGenerated!==n.isGenerated&&(c.isGenerated&&("uuid"===c.generationStrategy?(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${c.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):"increment"===c.generationStrategy&&(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(i,n))}')`)),a.push(new Va(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(i,n))}`)),s.push(new Va(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(i,n))} OWNED BY ${this.escapePath(i)}."${n.name}"`)))),"uuid"===n.generationStrategy?!0===n.isGenerated?(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${this.driver.uuidGenerator}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):"increment"===n.generationStrategy&&(!0===n.isGenerated?(a.push(new Va(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(i,n))} OWNED BY ${this.escapePath(i)}."${n.name}"`)),s.push(new Va(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(i,n))}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(i,n))}')`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(i,n))}')`)),a.push(new Va(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(i,n))}`)),s.push(new Va(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(i,n))} OWNED BY ${this.escapePath(i)}."${n.name}"`))))),n.default===c.default||o||(null!==n.default&&void 0!==n.default?(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${n.default}`)),null!==c.default&&void 0!==c.default?s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${c.default}`)):s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):null!==c.default&&void 0!==c.default&&(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" SET DEFAULT ${c.default}`)))),(n.spatialFeatureType||"").toLowerCase()===(c.spatialFeatureType||"").toLowerCase()&&n.srid===c.srid||(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(c)}`))),n.generatedType!==c.generatedType&&(!n.generatedType||"VIRTUAL"===n.generatedType)){const e=(await this.getTableNameWithSchema(i.name)).split("."),t=e[1],r=e[0];a.push(new Va(`ALTER TABLE ${this.escapePath(i)} RENAME COLUMN "${c.name}" TO "TEMP_OLD_${c.name}"`)),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD ${this.buildCreateColumnSql(i,n)}`)),a.push(new Va(`UPDATE ${this.escapePath(i)} SET "${n.name}" = "TEMP_OLD_${c.name}"`)),a.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP COLUMN "TEMP_OLD_${c.name}"`)),a.push(this.deleteTypeormMetadataSql({database:this.driver.database,schema:r,table:t,type:$a.GENERATED_COLUMN,name:c.name})),s.push(this.insertTypeormMetadataSql({database:this.driver.database,schema:r,table:t,type:$a.GENERATED_COLUMN,name:c.name,value:c.asExpression})),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ADD ${this.buildCreateColumnSql(i,c)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} DROP COLUMN "${n.name}"`))}}await this.executeQueries(a,s),this.replaceCachedTable(i,r)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:i}of t)await this.changeColumn(e,n,i)}async dropColumn(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableColumn(t)?t:n.findColumnByName(t);if(!i)throw new Ji.VR(`Column "${t}" was not found in table "${n.name}"`);const r=n.clone(),a=[],s=[];if(i.isPrimary){const e=i.primaryKeyConstraintName?i.primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,r.primaryColumns.map((e=>e.name))),t=r.primaryColumns.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${e}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`));if(r.findColumnByName(i.name).isPrimary=!1,r.primaryColumns.length>0){const e=r.primaryColumns[0].primaryKeyConstraintName?r.primaryColumns[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,r.primaryColumns.map((e=>e.name))),t=r.primaryColumns.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${e}"`))}}const o=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===i.name));o&&(r.indices.splice(r.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o)));const c=r.checks.find((e=>!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===i.name));c&&(r.checks.splice(r.checks.indexOf(c),1),a.push(this.dropCheckConstraintSql(n,c)),s.push(this.createCheckConstraintSql(n,c)));const l=r.uniques.find((e=>1===e.columnNames.length&&e.columnNames[0]===i.name));if(l&&(r.uniques.splice(r.uniques.indexOf(l),1),a.push(this.dropUniqueConstraintSql(n,l)),s.push(this.createUniqueConstraintSql(n,l))),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN "${i.name}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(n,i)}`)),"enum"===i.type||"simple-enum"===i.type){if(await this.hasEnumType(n,i)){const e=await this.getUserDefinedTypeName(n,i),t=`"${e.schema}"."${e.name}"`;a.push(this.dropEnumTypeSql(n,i,t)),s.push(this.createEnumTypeSql(n,i,t))}}if("STORED"===i.generatedType){const e=(await this.getTableNameWithSchema(n.name)).split("."),t=e[1],r=e[0],o=this.deleteTypeormMetadataSql({database:this.driver.database,schema:r,table:t,type:$a.GENERATED_COLUMN,name:i.name}),c=this.insertTypeormMetadataSql({database:this.driver.database,schema:r,table:t,type:$a.GENERATED_COLUMN,name:i.name,value:i.asExpression});a.push(o),s.push(c)}await this.executeQueries(a,s),r.removeColumn(i),this.replaceCachedTable(n,r)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t,n){const i=cr.t.isTable(e)?e:await this.getCachedTable(e),r=i.clone(),a=this.createPrimaryKeySql(i,t,n);r.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)}));const s=this.dropPrimaryKeySql(r);await this.executeQueries(a,s),this.replaceCachedTable(i,r)}async updatePrimaryKeys(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=n.clone(),r=t.map((e=>e.name)),a=[],s=[],o=i.primaryColumns;if(o.length>0){const e=o[0].primaryKeyConstraintName?o[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,o.map((e=>e.name))),t=o.map((e=>`"${e.name}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${e}"`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`))}i.columns.filter((e=>-1!==r.indexOf(e.name))).forEach((e=>e.isPrimary=!0));const c=o[0].primaryKeyConstraintName?o[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,r),l=r.map((e=>`"${e}"`)).join(", ");a.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${c}" PRIMARY KEY (${l})`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${c}"`)),await this.executeQueries(a,s),this.replaceCachedTable(n,i)}async dropPrimaryKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=this.dropPrimaryKeySql(n),r=this.createPrimaryKeySql(n,n.primaryColumns.map((e=>e.name)),t);await this.executeQueries(i,r),n.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n,t.columnNames));const i=this.createUniqueConstraintSql(n,t),r=this.dropUniqueConstraintSql(n,t);await this.executeQueries(i,r),n.addUniqueConstraint(t)}async createUniqueConstraints(e,t){for(const n of t)await this.createUniqueConstraint(e,n)}async dropUniqueConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableUnique(t)?t:n.uniques.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied unique constraint was not found in table ${n.name}`);const r=this.dropUniqueConstraintSql(n,i),a=this.createUniqueConstraintSql(n,i);await this.executeQueries(r,a),n.removeUniqueConstraint(i)}async dropUniqueConstraints(e,t){for(const n of t)await this.dropUniqueConstraint(e,n)}async createCheckConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n,t.expression));const i=this.createCheckConstraintSql(n,t),r=this.dropCheckConstraintSql(n,t);await this.executeQueries(i,r),n.addCheckConstraint(t)}async createCheckConstraints(e,t){const n=t.map((t=>this.createCheckConstraint(e,t)));await Promise.all(n)}async dropCheckConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableCheck(t)?t:n.checks.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied check constraint was not found in table ${n.name}`);const r=this.dropCheckConstraintSql(n,i),a=this.createCheckConstraintSql(n,i);await this.executeQueries(r,a),n.removeCheckConstraint(i)}async dropCheckConstraints(e,t){const n=t.map((t=>this.dropCheckConstraint(e,t)));await Promise.all(n)}async createExclusionConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.exclusionConstraintName(n,t.expression));const i=this.createExclusionConstraintSql(n,t),r=this.dropExclusionConstraintSql(n,t);await this.executeQueries(i,r),n.addExclusionConstraint(t)}async createExclusionConstraints(e,t){const n=t.map((t=>this.createExclusionConstraint(e,t)));await Promise.all(n)}async dropExclusionConstraint(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableExclusion(t)?t:n.exclusions.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied exclusion constraint was not found in table ${n.name}`);const r=this.dropExclusionConstraintSql(n,i),a=this.createExclusionConstraintSql(n,i);await this.executeQueries(r,a),n.removeExclusionConstraint(i)}async dropExclusionConstraints(e,t){const n=t.map((t=>this.dropExclusionConstraint(e,t)));await Promise.all(n)}async createForeignKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const i=this.createForeignKeySql(n,t),r=this.dropForeignKeySql(n,t);await this.executeQueries(i,r),n.addForeignKey(t)}async createForeignKeys(e,t){for(const n of t)await this.createForeignKey(e,n)}async dropForeignKey(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied foreign key was not found in table ${n.name}`);const r=this.dropForeignKeySql(n,i),a=this.createForeignKeySql(n,i);await this.executeQueries(r,a),n.removeForeignKey(i)}async dropForeignKeys(e,t){for(const n of t)await this.dropForeignKey(e,n)}async createIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const i=this.createIndexSql(n,t),r=this.dropIndexSql(n,t);await this.executeQueries(i,r),n.addIndex(t)}async createIndices(e,t){for(const n of t)await this.createIndex(e,n)}async dropIndex(e,t){const n=cr.t.isTable(e)?e:await this.getCachedTable(e),i=cr.t.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied index ${t} was not found in table ${n.name}`);i.name||(i.name=this.generateIndexName(n,i));const r=this.dropIndexSql(n,i),a=this.createIndexSql(n,i);await this.executeQueries(r,a),n.removeIndex(i)}async dropIndices(e,t){for(const n of t)await this.dropIndex(e,n)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(){const e=[];this.connection.entityMetadatas.filter((e=>e.schema)).forEach((t=>{!!e.find((e=>e===t.schema))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema()");const t=e.map((e=>"current_schema()"===e?e:"'"+e+"'")).join(", "),n=this.isTransactionActive;n||await this.startTransaction();try{const e=await this.getVersion(),i=`SELECT 'DROP VIEW IF EXISTS "' || schemaname || '"."' || viewname || '" CASCADE;' as "query" FROM "pg_views" WHERE "schemaname" IN (${t}) AND "viewname" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')`,r=await this.query(i);if(await Promise.all(r.map((e=>this.query(e.query)))),ls.g.isGreaterOrEqual(e,"9.3")){const e=`SELECT 'DROP MATERIALIZED VIEW IF EXISTS "' || schemaname || '"."' || matviewname || '" CASCADE;' as "query" FROM "pg_matviews" WHERE "schemaname" IN (${t})`,n=await this.query(e);await Promise.all(n.map((e=>this.query(e.query))))}const a=`SELECT 'DROP TABLE IF EXISTS "' || schemaname || '"."' || tablename || '" CASCADE;' as "query" FROM "pg_tables" WHERE "schemaname" IN (${t}) AND "tablename" NOT IN ('spatial_ref_sys')`,s=await this.query(a);await Promise.all(s.map((e=>this.query(e.query)))),await this.dropEnumTypes(t),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=await this.getCurrentDatabase(),n=await this.getCurrentSchema(),i=0===e.length?"1=1":e.map((e=>this.driver.parseTableName(e))).map((({schema:e,tableName:t})=>(e||(e=this.driver.options.schema||n),`("t"."schema" = '${e}' AND "t"."name" = '${t}')`))).join(" OR "),r=`SELECT "t".* FROM ${this.escapePath(this.getTypeormMetadataTableName())} "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN ('${$a.VIEW}', '${$a.MATERIALIZED_VIEW}') ${i?`AND (${i})`:""}`;return(await this.query(r)).map((e=>{const i=new Pa,r=e.schema!==n||this.driver.options.schema?e.schema:void 0;return i.database=t,i.schema=e.schema,i.name=this.driver.buildTableName(e.name,r),i.expression=e.value,i.materialized=e.type===$a.MATERIALIZED_VIEW,i}))}async loadTables(e){if(e&&0===e.length)return[];const t=await this.getCurrentSchema(),n=await this.getCurrentDatabase(),i=[];if(e){const n='SELECT "table_schema", "table_name" FROM "information_schema"."tables" WHERE '+e.map((e=>this.driver.parseTableName(e))).map((({schema:e,tableName:n})=>`("table_schema" = '${e||t}' AND "table_name" = '${n}')`)).join(" OR ");i.push(...await this.query(n))}else{const e='SELECT "table_schema", "table_name" FROM "information_schema"."tables"';i.push(...await this.query(e))}if(0===i.length)return[];const r='SELECT columns.*, pg_catalog.col_description((\'"\' || table_catalog || \'"."\' || table_schema || \'"."\' || table_name || \'"\')::regclass::oid, ordinal_position) AS description, (\'"\' || "udt_schema" || \'"."\' || "udt_name" || \'"\')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE '+i.map((({table_schema:e,table_name:t})=>`("table_schema" = '${e}' AND "table_name" = '${t}')`)).join(" OR "),a=i.map((({table_schema:e,table_name:t})=>`("ns"."nspname" = '${e}' AND "t"."relname" = '${t}')`)).join(" OR "),s=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN 'p' THEN 'PRIMARY' WHEN 'u' THEN 'UNIQUE' WHEN 'c' THEN 'CHECK' WHEN 'x' THEN 'EXCLUDE' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN ('r', 'p') AND (${a})`,o=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('r', 'p') AND "cnst"."contype" IS NULL AND (${a})`,c=`SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN 'INITIALLY DEFERRED' ELSE 'INITIALLY IMMEDIATE' END as condeferred, CASE "con1"."confdeltype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confdeltype", CASE "con1"."confupdtype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = 'f' AND (${i.map((({table_schema:e,table_name:t})=>`("ns"."nspname" = '${e}' AND "cl"."relname" = '${t}')`)).join(" OR ")}) ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" ${await this.hasSupportForPartitionedTables()?' AND "cl"."relispartition" = \'f\'':""}INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"`,[l,u,d,h]=await Promise.all([this.query(r),this.query(s),this.query(o),this.query(c)]);return Promise.all(i.map((async e=>{const i=new ar,r=(e,n)=>e[n]!==t||this.driver.options.schema&&this.driver.options.schema!==t?e[n]:void 0,a=r(e,"table_schema");i.database=n,i.schema=e.table_schema,i.name=this.driver.buildTableName(e.table_name,a),i.columns=await Promise.all(l.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)).map((async t=>{const r=u.filter((e=>e.table_name===t.table_name&&e.table_schema===t.table_schema&&e.column_name===t.column_name)),a=new Xi;if(a.name=t.column_name,a.type=t.regtype.toLowerCase(),"numeric"!==a.type&&"decimal"!==a.type&&"float"!==a.type||(null===t.numeric_precision||this.isDefaultColumnPrecision(i,a,t.numeric_precision)?null===t.numeric_scale||this.isDefaultColumnScale(i,a,t.numeric_scale)||(a.precision=void 0):a.precision=t.numeric_precision,null===t.numeric_scale||this.isDefaultColumnScale(i,a,t.numeric_scale)?null===t.numeric_precision||this.isDefaultColumnPrecision(i,a,t.numeric_precision)||(a.scale=void 0):a.scale=t.numeric_scale),"interval"!==a.type&&"time without time zone"!==a.type&&"time with time zone"!==a.type&&"timestamp without time zone"!==a.type&&"timestamp with time zone"!==a.type||(a.precision=this.isDefaultColumnPrecision(i,a,t.datetime_precision)?void 0:t.datetime_precision),"USER-DEFINED"===t.data_type||"ARRAY"===t.data_type){const{name:n}=await this.getUserDefinedTypeName(i,a),r=this.buildEnumName(i,a,!1,!0)!==n?n:void 0,s=`SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${e.table_schema}' AND "t"."typname" = '${r||n}'`,o=await this.query(s);if(o.length&&(a.type="enum",a.enum=o.map((e=>e.value)),a.enumName=r),"ARRAY"===t.data_type){a.isArray=!0;const e=a.type.replace("[]","");a.type=this.connection.driver.normalizeType({type:e})}}if("geometry"===a.type){const e=`SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geometry_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geometry_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = '${t.column_name}' AND\n                          "table_schema" = '${t.table_schema}' AND\n                          "table_name" = '${t.table_name}'`,n=await this.query(e);n.length>0&&(a.spatialFeatureType=n[0].type,a.srid=n[0].srid)}if("geography"===a.type){const e=`SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geography_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geography_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = '${t.column_name}' AND\n                          "table_schema" = '${t.table_schema}' AND\n                          "table_name" = '${t.table_name}'`,n=await this.query(e);n.length>0&&(a.spatialFeatureType=n[0].type,a.srid=n[0].srid)}if(-1!==this.driver.withLengthColumnTypes.indexOf(a.type)){let e;if(a.isArray){const n=/\((\d+)\)/.exec(t.format_type);e=n?n[1]:void 0}else t.character_maximum_length&&(e=t.character_maximum_length.toString());e&&(a.length=this.isDefaultColumnLength(i,a,e)?"":e)}a.isNullable="YES"===t.is_nullable;const s=r.find((e=>"PRIMARY"===e.constraint_type));if(s){a.isPrimary=!0;const e=u.filter((e=>e.table_name===t.table_name&&e.table_schema===t.table_schema&&e.column_name!==t.column_name&&"PRIMARY"===e.constraint_type)).map((e=>e.column_name));e.push(t.column_name);const n=this.connection.namingStrategy.primaryKeyName(i,e);s.constraint_name!==n&&(a.primaryKeyConstraintName=s.constraint_name)}const o=r.filter((e=>"UNIQUE"===e.constraint_type)),c=o.every((e=>u.some((n=>"UNIQUE"===n.constraint_type&&n.constraint_name===e.constraint_name&&n.column_name!==t.column_name))));if(a.isUnique=o.length>0&&!c,"YES"===t.is_identity)a.isGenerated=!0,a.generationStrategy="identity",a.generatedIdentity=t.identity_generation;else if(null!==t.column_default&&void 0!==t.column_default){const e=`nextval('${this.buildSequenceName(i,t.column_name)}'::regclass)`,n=`nextval('${this.buildSequencePath(i,t.column_name)}'::regclass)`,r=t.column_default.replace(/"/g,"");r===e||r===n?(a.isGenerated=!0,a.generationStrategy="increment"):"gen_random_uuid()"===t.column_default||/^uuid_generate_v\d\(\)/.test(t.column_default)?"uuid"===a.type?(a.isGenerated=!0,a.generationStrategy="uuid"):a.default=t.column_default:"now()"===t.column_default||-1!==t.column_default.indexOf("'now'::text")?a.default=t.column_default:(a.default=t.column_default.replace(/::[\w\s\.\[\]\"]+/g,""),a.default=a.default.replace(/^(-?\d+)$/,"'$1'"))}if("ALWAYS"===t.is_generated&&t.generation_expression){a.generatedType="STORED";const t=await this.selectTypeormMetadataSql({database:n,schema:e.table_schema,table:e.table_name,type:$a.GENERATED_COLUMN,name:a.name}),i=await this.query(t.query,t.parameters);i[0]&&i[0].value?a.asExpression=i[0].value:a.asExpression=""}return a.comment=t.description?t.description:void 0,t.character_set_name&&(a.charset=t.character_set_name),t.collation_name&&(a.collation=t.collation_name),a})));const s=Xr.m.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"UNIQUE"===t.constraint_type)),(e=>e.constraint_name));i.uniques=s.map((e=>{const t=u.filter((t=>t.constraint_name===e.constraint_name));return new nr({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),deferrable:e.deferrable?e.deferred:void 0})}));const o=Xr.m.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"CHECK"===t.constraint_type)),(e=>e.constraint_name));i.checks=o.map((e=>{const t=u.filter((t=>t.constraint_name===e.constraint_name));return new ir({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),expression:e.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})}));const c=Xr.m.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"EXCLUDE"===t.constraint_type)),(e=>e.constraint_name));i.exclusions=c.map((e=>new rr({name:e.constraint_name,expression:e.expression.substring(8)})));const p=Xr.m.uniq(h.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)),(e=>e.constraint_name));i.foreignKeys=p.map((e=>{const t=h.filter((t=>t.constraint_name===e.constraint_name)),n=r(e,"referenced_table_schema"),i=this.driver.buildTableName(e.referenced_table_name,n);return new er({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),referencedSchema:e.referenced_table_schema,referencedTableName:i,referencedColumnNames:t.map((e=>e.referenced_column_name)),onDelete:e.on_delete,onUpdate:e.on_update,deferrable:e.deferrable?e.deferred:void 0})}));const m=Xr.m.uniq(d.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)),(e=>e.constraint_name));return i.indices=m.map((e=>{const t=d.filter((t=>t.table_schema===e.table_schema&&t.table_name===e.table_name&&t.constraint_name===e.constraint_name));return new Zi({table:i,name:e.constraint_name,columnNames:t.map((e=>e.column_name)),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:t.every((e=>this.driver.spatialTypes.indexOf(e.type_name)>=0)),isFulltext:!1})})),i})))}createTableSql(e,t){const n=e.columns.map((t=>this.buildCreateColumnSql(e,t))).join(", ");let i=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{e.uniques.some((e=>1===e.columnNames.length&&e.columnNames[0]===t.name))||e.uniques.push(new nr({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){const t=e.uniques.map((t=>{let n=`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.uniqueConstraintName(e,t.columnNames)}" UNIQUE (${t.columnNames.map((e=>`"${e}"`)).join(", ")})`;return t.deferrable&&(n+=` DEFERRABLE ${t.deferrable}`),n})).join(", ");i+=`, ${t}`}if(e.checks.length>0){const t=e.checks.map((t=>`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.checkConstraintName(e,t.expression)}" CHECK (${t.expression})`)).join(", ");i+=`, ${t}`}if(e.exclusions.length>0){const t=e.exclusions.map((t=>`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.exclusionConstraintName(e,t.expression)}" EXCLUDE ${t.expression}`)).join(", ");i+=`, ${t}`}if(e.foreignKeys.length>0&&t){const t=e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`"${e}"`)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const i=t.referencedColumnNames.map((e=>`"${e}"`)).join(", ");let r=`CONSTRAINT "${t.name}" FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${i})`;return t.onDelete&&(r+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(r+=` ON UPDATE ${t.onUpdate}`),t.deferrable&&(r+=` DEFERRABLE ${t.deferrable}`),r})).join(", ");i+=`, ${t}`}const r=e.columns.filter((e=>e.isPrimary));if(r.length>0){const t=r[0].primaryKeyConstraintName?r[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(e,r.map((e=>e.name))),n=r.map((e=>`"${e.name}"`)).join(", ");i+=`, CONSTRAINT "${t}" PRIMARY KEY (${n})`}return i+=")",e.columns.filter((e=>e.comment)).forEach((t=>i+=`; COMMENT ON COLUMN ${this.escapePath(e)}."${t.name}" IS ${this.escapeComment(t.comment)}`)),new Va(i)}async getVersion(){return(await this.query("SELECT version()"))[0].version.replace(/^PostgreSQL ([\d\.]+) .*$/,"$1")}dropTableSql(e){return new Va(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e);return"string"==typeof e.expression?new Va(`CREATE ${t}VIEW ${n} AS ${e.expression}`):new Va(`CREATE ${t}VIEW ${n} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const t=await this.getCurrentSchema();let{schema:n,tableName:i}=this.driver.parseTableName(e);n||(n=t);const r=e.materialized?$a.MATERIALIZED_VIEW:$a.VIEW,a="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:r,schema:n,name:i,value:a})}dropViewSql(e){const t=e.materialized?"MATERIALIZED ":"";return new Va(`DROP ${t}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const t=await this.getCurrentSchema();let{schema:n,tableName:i}=this.driver.parseTableName(e);n||(n=t);const r=e.materialized?$a.MATERIALIZED_VIEW:$a.VIEW;return this.deleteTypeormMetadataSql({type:r,schema:n,name:i})}async dropEnumTypes(e){const t=`SELECT 'DROP TYPE IF EXISTS "' || n.nspname || '"."' || t.typname || '" CASCADE;' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN (${e}) GROUP BY "n"."nspname", "t"."typname"`,n=await this.query(t);await Promise.all(n.map((e=>this.query(e.query))))}async hasEnumType(e,t){let{schema:n}=this.driver.parseTableName(e);n||(n=await this.getCurrentSchema());const i=`SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${n}' AND "t"."typname" = '${this.buildEnumName(e,t,!1,!0)}'`;return!!(await this.query(i)).length}createEnumTypeSql(e,t,n){n||(n=this.buildEnumName(e,t));const i=t.enum.map((e=>`'${e.replace("'","''")}'`)).join(", ");return new Va(`CREATE TYPE ${n} AS ENUM(${i})`)}dropEnumTypeSql(e,t,n){return n||(n=this.buildEnumName(e,t)),new Va(`DROP TYPE ${n}`)}createIndexSql(e,t){const n=t.columnNames.map((e=>`"${e}"`)).join(", ");return new Va(`CREATE ${t.isUnique?"UNIQUE ":""}INDEX "${t.name}" ON ${this.escapePath(e)} ${t.isSpatial?"USING GiST ":""}(${n}) ${t.where?"WHERE "+t.where:""}`)}dropIndexSql(e,t){let n=cr.t.isTableIndex(t)?t.name:t;const{schema:i}=this.driver.parseTableName(e);return new Va(i?`DROP INDEX "${i}"."${n}"`:`DROP INDEX "${n}"`)}createPrimaryKeySql(e,t,n){const i=n||this.connection.namingStrategy.primaryKeyName(e,t),r=t.map((e=>`"${e}"`)).join(", ");return new Va(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${i}" PRIMARY KEY (${r})`)}dropPrimaryKeySql(e){if(!e.primaryColumns.length)throw new Ji.VR(`Table ${e} has no primary keys.`);const t=e.primaryColumns.map((e=>e.name)),n=e.primaryColumns[0].primaryKeyConstraintName,i=n||this.connection.namingStrategy.primaryKeyName(e,t);return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${i}"`)}createUniqueConstraintSql(e,t){const n=t.columnNames.map((e=>'"'+e+'"')).join(", ");let i=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" UNIQUE (${n})`;return t.deferrable&&(i+=` DEFERRABLE ${t.deferrable}`),new Va(i)}dropUniqueConstraintSql(e,t){const n=cr.t.isTableUnique(t)?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createCheckConstraintSql(e,t){return new Va(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" CHECK (${t.expression})`)}dropCheckConstraintSql(e,t){const n=cr.t.isTableCheck(t)?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createExclusionConstraintSql(e,t){return new Va(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" EXCLUDE ${t.expression}`)}dropExclusionConstraintSql(e,t){const n=cr.t.isTableExclusion(t)?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>'"'+e+'"')).join(", "),i=t.referencedColumnNames.map((e=>'"'+e+'"')).join(",");let r=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))}(${i})`;return t.onDelete&&(r+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(r+=` ON UPDATE ${t.onUpdate}`),t.deferrable&&(r+=` DEFERRABLE ${t.deferrable}`),new Va(r)}dropForeignKeySql(e,t){const n=cr.t.isTableForeignKey(t)?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}buildSequenceName(e,t){const{tableName:n}=this.driver.parseTableName(e),i=cr.t.isTableColumn(t)?t.name:t;let r=`${n}_${i}_seq`;return r.length>this.connection.driver.maxAliasLength&&(r=`${n.substring(0,29)}_${i.substring(0,Math.max(29,63-e.name.length-5))}_seq`),r}buildSequencePath(e,t){const{schema:n}=this.driver.parseTableName(e);return n?`${n}.${this.buildSequenceName(e,t)}`:this.buildSequenceName(e,t)}buildEnumName(e,t,n=!0,i,r){const{schema:a,tableName:s}=this.driver.parseTableName(e);let o=t.enumName?t.enumName:`${s}_${t.name.toLowerCase()}_enum`;return a&&n&&(o=`${a}.${o}`),r&&(o+="_old"),o.split(".").map((e=>i?e:`"${e}"`)).join(".")}async getUserDefinedTypeName(e,t){let{schema:n,tableName:i}=this.driver.parseTableName(e);n||(n=await this.getCurrentSchema());const r=await this.query(`SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = '${n}' AND "table_name" = '${i}' AND "column_name"='${t.name}'`);let a=r[0].udt_name;return 0===a.indexOf("_")&&(a=a.substr(1,a.length)),{schema:r[0].udt_schema,name:a}}escapeComment(e){return e&&0!==e.length?`'${e=e.replace(/'/g,"''").replace(/\u0000/g,"")}'`:"NULL"}escapePath(e){const{schema:t,tableName:n}=this.driver.parseTableName(e);return t&&t!==this.driver.searchSchema?`"${t}"."${n}"`:`"${n}"`}async getTableNameWithSchema(e){const t=cr.t.isTable(e)?e.name:e;if(-1===t.indexOf(".")){return`${(await this.query("SELECT current_schema()"))[0].current_schema}.${t}`}return`${t.split(".")[0]}.${t.split(".")[1]}`}buildCreateColumnSql(e,t){let n='"'+t.name+'"';if(!0===t.isGenerated&&"uuid"!==t.generationStrategy)if("identity"===t.generationStrategy){const e=t.generatedIdentity||"BY DEFAULT";n+=` ${t.type} GENERATED ${e} AS IDENTITY`}else"integer"!==t.type&&"int"!==t.type&&"int4"!==t.type||(n+=" SERIAL"),"smallint"!==t.type&&"int2"!==t.type||(n+=" SMALLSERIAL"),"bigint"!==t.type&&"int8"!==t.type||(n+=" BIGSERIAL");return"enum"===t.type||"simple-enum"===t.type?(n+=" "+this.buildEnumName(e,t),t.isArray&&(n+=" array")):t.isGenerated&&"uuid"!==t.type||(n+=" "+this.connection.driver.createFullType(t)),"STORED"===t.generatedType&&t.asExpression&&(n+=` GENERATED ALWAYS AS (${t.asExpression}) STORED`),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),!0!==t.isNullable&&(n+=" NOT NULL"),void 0!==t.default&&null!==t.default&&(n+=" DEFAULT "+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(n+=` DEFAULT ${this.driver.uuidGenerator}`),n}async hasSupportForPartitionedTables(){return!!(await this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")).length}}class ds extends us{constructor(e,t){super(e,t)}}class hs extends ds{constructor(e,t,n){super(e,n),this.client=t}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((([e,t])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=t,this.databaseConnection))):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((([e,t])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=t,this.databaseConnection)))),this.databaseConnectionPromise)}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?await this.client.startTransaction():await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.commitTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.rollbackTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=await this.client.query(e,t),r=new Qa;return r.raw=i,(null==i?void 0:i.hasOwnProperty("records"))&&Array.isArray(i.records)&&(r.records=i.records),(null==i?void 0:i.hasOwnProperty("numberOfRecordsUpdated"))&&(r.affected=i.numberOfRecordsUpdated),n?r:r.raw}}class ps extends Er.PostgresDriver{}class ms extends ps{constructor(e){super(),this.transactionSupport="nested",this.connection=e,this.options=e.options,this.isReplicated=!1,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),this.database=gr.I.buildDriverOptions(this.options).database}async connect(){}async disconnect(){}createQueryRunner(e){return new hs(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),e)}preparePersistentValue(e,t){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?super.preparePersistentValue(e,t):(t.transformer&&(e=Zr.W.transformTo(t.transformer,e)),this.client.preparePersistentValue(e,t))}prepareHydratedValue(e,t){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?super.prepareHydratedValue(e,t):(t.transformer&&(e=Zr.W.transformFrom(t.transformer,e)),this.client.prepareHydratedValue(e,t))}loadDependencies(){const e=this.options.driver||Qi.load("typeorm-aurora-data-api-driver"),{pg:t}=e;this.DataApiDriver=t}executeQuery(e,t){return this.connection.query(t)}async afterConnect(){const e=await this.checkMetadataForExtensions();return e.hasExtensions&&await this.enableExtensions(e,this.connection),Promise.resolve()}}class fs extends Wa{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Ha(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async executeSet(e){if(this.isReleased)throw new ja.E;return(await this.connect()).executeSet(e,!1)}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;const i=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const r=e.substr(0,e.indexOf(" "));try{let a;a=-1!==["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(r)?await i.execute(e,!1):-1!==["INSERT","UPDATE","DELETE"].indexOf(r)?await i.run(e,t,!1):await i.query(e,t||[]);const s=new Qa;return(null==a?void 0:a.hasOwnProperty("values"))&&(s.raw=a.values,s.records=a.values),(null==a?void 0:a.hasOwnProperty("changes"))&&(s.affected=a.changes.changes,s.raw=a.changes.lastId||a.changes.changes),n?s:s.raw}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}parametrize(e){return Object.keys(e).map((e=>`"${e}"=?`))}}class ys extends qa{constructor(e){if(super(e),this.database=this.options.database,this.driver=this.options.driver,!this.options.database)throw new Ji.lG("database");if(!this.options.driver)throw new Ji.lG("driver");this.sqlite=this.options.driver}async connect(){this.databaseConnection=this.createDatabaseConnection(),await this.databaseConnection}async disconnect(){this.queryRunner=void 0;return(await this.databaseConnection).close().then((()=>{this.databaseConnection=void 0}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new fs(this)),this.queryRunner}async createDatabaseConnection(){const e=this.options.mode||"no-encryption",t="no-encryption"!==e,n=void 0===this.options.version?1:this.options.version,i=await this.sqlite.createConnection(this.options.database,t,e,n);return await i.open(),await i.query("PRAGMA foreign_keys = ON"),this.options.journalMode&&-1!==["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)&&await i.query(`PRAGMA journal_mode = ${this.options.journalMode}`),i}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new Ji.WZ("Capacitor","@capacitor-community/sqlite")}}class gs extends Ka{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.mode=t,this.broadcaster=new Ha(this)}async connect(){if(this.session)return Promise.resolve(this.session);const[e]=await this.driver.instanceDatabase.createSession({});return this.session=e,this.sessionTransaction=await e.transaction(),this.session}async release(){return this.isReleased=!0,this.session&&await this.session.delete(),this.session=void 0,Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}await this.connect(),await this.sessionTransaction.begin(),this.connection.logger.logQuery("START TRANSACTION"),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionCommit"),await this.sessionTransaction.commit(),this.connection.logger.logQuery("COMMIT"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new Ua.v;await this.broadcaster.broadcast("BeforeTransactionRollback"),await this.sessionTransaction.rollback(),this.connection.logger.logQuery("ROLLBACK"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new ja.E;try{const i=+new Date;let r;await this.connect();const a=e.startsWith("SELECT"),s=a&&!this.isTransactionActive?this.driver.instanceDatabase:this.sessionTransaction;this.isTransactionActive||a||await this.sessionTransaction.begin();try{this.driver.connection.logger.logQuery(e,t,this),r=await s.run({sql:e,params:t?t.reduce(((e,t,n)=>(e["param"+n]=t,e)),{}):void 0,json:!0}),this.isTransactionActive||a||await this.sessionTransaction.commit()}catch(e){try{this.isTransactionActive||a||await this.sessionTransaction.rollback()}catch(e){}throw e}const o=this.driver.options.maxQueryExecutionTime,c=+new Date-i;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=new Qa;return l.raw=r,l.records=r?r[0]:[],r&&r[1]&&r[1].rowCountExact&&(l.affected=parseInt(r[1].rowCountExact)),n?l:l.records}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}async updateDDL(e,t){if(this.isReleased)throw new ja.E;this.driver.connection.logger.logQuery(e,t,this);try{const n=+new Date,[i]=await this.driver.instanceDatabase.updateSchema(e);await i.promise();const r=this.driver.options.maxQueryExecutionTime,a=+new Date-n;r&&a>r&&this.driver.connection.logger.logQuerySlow(a,e,t,this)}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}async stream(e,t,n,i){if(this.isReleased)throw new ja.E;try{this.driver.connection.logger.logQuery(e,t,this);const r={sql:e,params:t?t.reduce(((e,t,n)=>(e["param"+n]=t,e)),{}):void 0,json:!0},a=this.driver.instanceDatabase.runStream(r);return n&&a.on("end",n),i&&a.on("error",i),a}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new Ba.C(e,t,n)}}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){throw new Ji.VR("Check database queries are not supported by Spanner driver.")}async getCurrentDatabase(){throw new Ji.VR("Check database queries are not supported by Spanner driver.")}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){throw new Ji.VR("Check schema queries are not supported by Spanner driver.")}async hasTable(e){const t=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` = '${e instanceof ar?e.name:e}'`;return!!(await this.query(t)).length}async hasColumn(e,t){const n=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` = '${e instanceof ar?e.name:e}' AND \`COLUMN_NAME\` = '${t}'`;return!!(await this.query(n)).length}async createDatabase(e,t){if(t){if(await this.hasDatabase(e))return Promise.resolve()}const n=`CREATE DATABASE "${e}"`,i=`DROP DATABASE "${e}"`;await this.executeQueries(new Va(n),new Va(i))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,i=`CREATE DATABASE "${e}"`;await this.executeQueries(new Va(n),new Va(i))}async createSchema(e,t){return Promise.resolve()}async dropSchema(e,t,n){return Promise.resolve()}async createTable(e,t=!1,n=!0,i=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const r=[],a=[];r.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((t=>a.push(this.dropForeignKeySql(e,t)))),i&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),r.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(e,t))}));const s=e.columns.filter((e=>e.generatedType&&e.asExpression));for(const t of s){const n=this.insertTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),i=this.deleteTypeormMetadataSql({table:e.name,type:$a.GENERATED_COLUMN,name:t.name});r.push(n),a.push(i)}await this.executeQueries(r,a)}async dropTable(e,t,n=!0,i=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const r=n,a=this.getTablePath(e),s=await this.getCachedTable(a),o=[],c=[];i&&s.indices.forEach((e=>{o.push(this.dropIndexSql(s,e)),c.push(this.createIndexSql(s,e))})),n&&s.foreignKeys.forEach((e=>o.push(this.dropForeignKeySql(s,e)))),o.push(this.dropTableSql(s)),c.push(this.createTableSql(s,r));const l=s.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of l){const t=this.deleteTypeormMetadataSql({table:s.name,type:$a.GENERATED_COLUMN,name:e.name}),n=this.insertTypeormMetadataSql({table:s.name,type:$a.GENERATED_COLUMN,name:e.name,value:e.asExpression});o.push(t),c.push(n)}await this.executeQueries(o,c)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=e instanceof Pa?e.name:e,n=await this.getCachedView(t),i=[],r=[];i.push(await this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),r.push(await this.insertViewDefinitionSql(n)),r.push(this.createViewSql(n)),await this.executeQueries(i,r)}async renameTable(e,t){throw new Ji.VR("Rename table queries are not supported by Spanner driver.")}async addColumn(e,t){const n=e instanceof ar?e:await this.getCachedTable(e),i=n.clone(),r=[],a=[];r.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(t)}`)),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN ${this.driver.escape(t.name)}`));const s=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(s)r.push(this.createIndexSql(n,s)),a.push(this.dropIndexSql(n,s));else if(t.isUnique){const e=new Zi({name:this.connection.namingStrategy.indexName(n,[t.name]),columnNames:[t.name],isUnique:!0});i.indices.push(e),i.uniques.push(new nr({name:e.name,columnNames:e.columnNames})),r.push(this.createIndexSql(n,e)),a.push(this.dropIndexSql(n,e))}if(t.generatedType&&t.asExpression){const e=this.insertTypeormMetadataSql({table:n.name,type:$a.GENERATED_COLUMN,name:t.name,value:t.asExpression}),i=this.deleteTypeormMetadataSql({table:n.name,type:$a.GENERATED_COLUMN,name:t.name});r.push(e),a.push(i)}await this.executeQueries(r,a),i.addColumn(t),this.replaceCachedTable(n,i)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const i=e instanceof ar?e:await this.getCachedTable(e),r=t instanceof Xi?t:i.columns.find((e=>e.name===t));if(!r)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);let a;return n instanceof Xi?a=n:(a=r.clone(),a.name=n),this.changeColumn(i,r,a)}async changeColumn(e,t,n){const i=e instanceof ar?e:await this.getCachedTable(e);let r=i.clone();const a=[],s=[],o=t instanceof Xi?t:i.columns.find((e=>e.name===t));if(!o)throw new Ji.VR(`Column "${t}" was not found in the "${i.name}" table.`);if(o.name!==n.name||o.type!==n.type||o.length!==n.length||o.isArray!==n.isArray||o.generatedType!==n.generatedType||o.asExpression!==n.asExpression)await this.dropColumn(i,o),await this.addColumn(i,n),r=i.clone();else if(n.precision===o.precision&&n.scale===o.scale||(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(o)}`))),o.isNullable!==n.isNullable&&(n.isNullable?(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${o.name}" DROP NOT NULL`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${o.name}" SET NOT NULL`))):(a.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${o.name}" SET NOT NULL`)),s.push(new Va(`ALTER TABLE ${this.escapePath(i)} ALTER COLUMN "${o.name}" DROP NOT NULL`)))),n.isUnique!==o.isUnique)if(!0===n.isUnique){const e=new Zi({name:this.connection.namingStrategy.indexName(i,[n.name]),columnNames:[n.name],isUnique:!0});r.indices.push(e),r.uniques.push(new nr({name:e.name,columnNames:e.columnNames})),a.push(this.createIndexSql(i,e)),s.push(this.dropIndexSql(i,e))}else{const e=r.indices.find((e=>1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((e=>e===n.name))));r.indices.splice(r.indices.indexOf(e),1);const t=r.uniques.find((t=>t.name===e.name));r.uniques.splice(r.uniques.indexOf(t),1),a.push(this.dropIndexSql(i,e)),s.push(this.createIndexSql(i,e))}await this.executeQueries(a,s),this.replaceCachedTable(i,r)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:i}of t)await this.changeColumn(e,n,i)}async dropColumn(e,t){const n=e instanceof ar?e:await this.getCachedTable(e),i=t instanceof Xi?t:n.findColumnByName(t);if(!i)throw new Ji.VR(`Column "${t}" was not found in table "${n.name}"`);const r=n.clone(),a=[],s=[],o=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===i.name));o&&(r.indices.splice(r.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o)));const c=r.checks.find((e=>!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===i.name));if(c&&(r.checks.splice(r.checks.indexOf(c),1),a.push(this.dropCheckConstraintSql(n,c)),s.push(this.createCheckConstraintSql(n,c))),a.push(new Va(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN ${this.driver.escape(i.name)}`)),s.push(new Va(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(i)}`)),i.generatedType&&i.asExpression){const e=this.deleteTypeormMetadataSql({table:n.name,type:$a.GENERATED_COLUMN,name:i.name}),t=this.insertTypeormMetadataSql({table:n.name,type:$a.GENERATED_COLUMN,name:i.name,value:i.asExpression});a.push(e),s.push(t)}await this.executeQueries(a,s),r.removeColumn(i),this.replaceCachedTable(n,r)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async updatePrimaryKeys(e,t){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async dropPrimaryKey(e){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async createUniqueConstraint(e,t){throw new Ji.VR("Spanner does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,t){throw new Ji.VR("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,t){throw new Ji.VR("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,t){throw new Ji.VR("Spanner does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,t){const n=e instanceof ar?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n,t.expression));const i=this.createCheckConstraintSql(n,t),r=this.dropCheckConstraintSql(n,t);await this.executeQueries(i,r),n.addCheckConstraint(t)}async createCheckConstraints(e,t){const n=t.map((t=>this.createCheckConstraint(e,t)));await Promise.all(n)}async dropCheckConstraint(e,t){const n=e instanceof ar?e:await this.getCachedTable(e),i=t instanceof ir?t:n.checks.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied check constraint was not found in table ${n.name}`);const r=this.dropCheckConstraintSql(n,i),a=this.createCheckConstraintSql(n,i);await this.executeQueries(r,a),n.removeCheckConstraint(i)}async dropCheckConstraints(e,t){const n=t.map((t=>this.dropCheckConstraint(e,t)));await Promise.all(n)}async createExclusionConstraint(e,t){throw new Ji.VR("Spanner does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new Ji.VR("Spanner does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new Ji.VR("Spanner does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new Ji.VR("Spanner does not support exclusion constraints.")}async createForeignKey(e,t){const n=e instanceof ar?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const i=this.createForeignKeySql(n,t),r=this.dropForeignKeySql(n,t);await this.executeQueries(i,r),n.addForeignKey(t)}async createForeignKeys(e,t){for(const n of t)await this.createForeignKey(e,n)}async dropForeignKey(e,t){const n=e instanceof ar?e:await this.getCachedTable(e),i=t instanceof er?t:n.foreignKeys.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied foreign key was not found in table ${n.name}`);const r=this.dropForeignKeySql(n,i),a=this.createForeignKeySql(n,i);await this.executeQueries(r,a),n.removeForeignKey(i)}async dropForeignKeys(e,t){for(const n of t)await this.dropForeignKey(e,n)}async createIndex(e,t){const n=e instanceof ar?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const i=this.createIndexSql(n,t),r=this.dropIndexSql(n,t);await this.executeQueries(i,r),n.addIndex(t)}async createIndices(e,t){for(const n of t)await this.createIndex(e,n)}async dropIndex(e,t){const n=e instanceof ar?e:await this.getCachedTable(e),i=t instanceof Zi?t:n.indices.find((e=>e.name===t));if(!i)throw new Ji.VR(`Supplied index ${t} was not found in table ${n.name}`);i.name||(i.name=this.generateIndexName(n,i));const r=this.dropIndexSql(n,i),a=this.createIndexSql(n,i);await this.executeQueries(r,a),n.removeIndex(i)}async dropIndices(e,t){for(const n of t)await this.dropIndex(e,n)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)} WHERE true`)}async clearDatabase(){const e=await this.query("SELECT concat('DROP INDEX `', INDEX_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`INDEXES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `INDEX_TYPE` = 'INDEX' AND `SPANNER_IS_MANAGED` = false"),t=await this.query("SELECT concat('ALTER TABLE `', TABLE_NAME, '`', ' DROP CONSTRAINT `', CONSTRAINT_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLE_CONSTRAINTS` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `CONSTRAINT_TYPE` = 'FOREIGN KEY'"),n=await this.query("SELECT concat('DROP TABLE `', TABLE_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'");if(!e.length&&!t.length&&!n.length)return;const i=this.isTransactionActive;i||await this.startTransaction();try{for(let t of e)await this.updateDDL(t.query);for(let e of t)await this.updateDDL(e.query);for(let e of n)await this.updateDDL(e.query);await this.commitTransaction()}catch(e){try{i||await this.rollbackTransaction()}catch(e){}throw e}}async executeMemoryUpSql(){for(const{query:e,parameters:t}of this.sqlInMemory.upQueries)this.isDMLQuery(e)?await this.query(e,t):await this.updateDDL(e,t)}async executeMemoryDownSql(){for(const{query:e,parameters:t}of this.sqlInMemory.downQueries.reverse())this.isDMLQuery(e)?await this.query(e,t):await this.updateDDL(e,t)}async loadViews(e){return Promise.resolve([])}async loadTables(e){if(e&&0===e.length)return[];const t=[];if(e&&e.length){const n=`SELECT \`TABLE_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` IN (${e.map((e=>`'${e}'`)).join(", ")})`;t.push(...await this.query(n))}else{const e="SELECT `TABLE_NAME` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'";t.push(...await this.query(e))}if(!t.length)return[];const n=t.map((e=>`'${e.TABLE_NAME}'`)).join(", "),i=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` IN (${n})`,r=`SELECT \`KCU\`.\`TABLE_NAME\`, \`KCU\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'PRIMARY KEY' AND \`TC\`.\`TABLE_NAME\` IN (${n})`,a=`SELECT \`I\`.\`TABLE_NAME\`, \`I\`.\`INDEX_NAME\`, \`I\`.\`IS_UNIQUE\`, \`I\`.\`IS_NULL_FILTERED\`, \`IC\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`INDEXES\` \`I\` INNER JOIN \`INFORMATION_SCHEMA\`.\`INDEX_COLUMNS\` \`IC\` ON \`IC\`.\`INDEX_NAME\` = \`I\`.\`INDEX_NAME\` AND \`IC\`.\`TABLE_NAME\` = \`I\`.\`TABLE_NAME\` WHERE \`I\`.\`TABLE_CATALOG\` = '' AND \`I\`.\`TABLE_SCHEMA\` = '' AND \`I\`.\`TABLE_NAME\` IN (${n}) AND \`I\`.\`INDEX_TYPE\` = 'INDEX' AND \`I\`.\`SPANNER_IS_MANAGED\` = false`,s=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`CC\`.\`CHECK_CLAUSE\`, \`CCU\`.\`COLUMN_NAME\`FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CHECK_CONSTRAINTS\` \`CC\` ON \`CC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'CHECK' AND \`TC\`.\`TABLE_NAME\` IN (${n}) AND \`TC\`.\`CONSTRAINT_NAME\` NOT LIKE 'CK_IS_NOT_NULL%'`,o=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`KCU\`.\`COLUMN_NAME\`, \`CTU\`.\`TABLE_NAME\` AS \`REFERENCED_TABLE_NAME\`, \`CCU\`.\`COLUMN_NAME\` AS \`REFERENCED_COLUMN_NAME\`, \`RC\`.\`UPDATE_RULE\`, \`RC\`.\`DELETE_RULE\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_TABLE_USAGE\` \`CTU\` ON \`CTU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`RC\` ON \`RC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'FOREIGN KEY' AND \`TC\`.\`TABLE_NAME\` IN (${n})`,[c,l,u,d,h]=await Promise.all([this.query(i),this.query(r),this.query(a),this.query(s),this.query(o)]);return Promise.all(t.map((async e=>{const t=new ar;t.name=this.driver.buildTableName(e.TABLE_NAME),t.columns=await Promise.all(c.filter((t=>t.TABLE_NAME===e.TABLE_NAME)).map((async n=>{const i=u.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.COLUMN_NAME===n.COLUMN_NAME&&!0===t.IS_UNIQUE)),r=this.connection.entityMetadatas.find((e=>this.getTablePath(t)===this.getTablePath(e))),a=i.length>0&&r&&r.indices.some((e=>i.some((t=>e.name===t.INDEX_NAME&&!1===e.synchronize)))),s=i.every((e=>u.some((t=>t.INDEX_NAME===e.INDEX_NAME&&t.COLUMN_NAME!==n.COLUMN_NAME)))),o=new Xi;o.name=n.COLUMN_NAME;let c=n.SPANNER_TYPE.toLowerCase();if(-1!==c.indexOf("array")&&(o.isArray=!0,c=c.substring(c.indexOf("<")+1,c.indexOf(">"))),-1!==c.indexOf("(")?o.type=c.substring(0,c.indexOf("(")):o.type=c,-1!==this.driver.withLengthColumnTypes.indexOf(o.type)&&(o.length=c.substring(c.indexOf("(")+1,c.indexOf(")"))),"ALWAYS"===n.IS_GENERATED){o.asExpression=n.GENERATION_EXPRESSION,o.generatedType="STORED";const t=await this.selectTypeormMetadataSql({table:e.TABLE_NAME,type:$a.GENERATED_COLUMN,name:o.name}),i=await this.query(t.query,t.parameters);i[0]&&i[0].value?o.asExpression=i[0].value:o.asExpression=""}return o.isUnique=i.length>0&&!a&&!s,o.isNullable="YES"===n.IS_NULLABLE,o.isPrimary=l.some((e=>e.TABLE_NAME===n.TABLE_NAME&&e.COLUMN_NAME===n.COLUMN_NAME)),o})));const n=h.filter((t=>t.TABLE_NAME===e.TABLE_NAME));t.foreignKeys=Xr.m.uniq(n,(e=>e.CONSTRAINT_NAME)).map((e=>{const t=n.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME));return new er({name:e.CONSTRAINT_NAME,columnNames:Xr.m.uniq(t.map((e=>e.COLUMN_NAME))),referencedDatabase:e.REFERENCED_TABLE_SCHEMA,referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:Xr.m.uniq(t.map((e=>e.REFERENCED_COLUMN_NAME))),onDelete:e.DELETE_RULE,onUpdate:e.UPDATE_RULE})}));const i=u.filter((t=>t.TABLE_NAME===e.TABLE_NAME));t.indices=Xr.m.uniq(i,(e=>e.INDEX_NAME)).map((e=>{const n=i.filter((t=>t.INDEX_NAME===e.INDEX_NAME));return new Zi({table:t,name:e.INDEX_NAME,columnNames:n.map((e=>e.COLUMN_NAME)),isUnique:e.IS_UNIQUE,isNullFiltered:e.IS_NULL_FILTERED})}));const r=d.filter((t=>t.TABLE_NAME===e.TABLE_NAME));return t.checks=Xr.m.uniq(r,(e=>e.CONSTRAINT_NAME)).map((e=>{const t=r.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME));return new ir({name:e.CONSTRAINT_NAME,columnNames:t.map((e=>e.COLUMN_NAME)),expression:e.CHECK_CLAUSE})})),t})))}createTableSql(e,t){const n=e.columns.map((e=>this.buildCreateColumnSql(e))).join(", ");let i=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{const n=e.indices.some((e=>1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name))),i=e.uniques.some((e=>1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)));n||i||e.indices.push(new Zi({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((t=>{e.indices.some((e=>e.name===t.name))||e.indices.push(new Zi({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.checks.length>0){i+=`, ${e.checks.map((t=>`CONSTRAINT \`${t.name?t.name:this.connection.namingStrategy.checkConstraintName(e,t.expression)}\` CHECK (${t.expression})`)).join(", ")}`}if(e.foreignKeys.length>0&&t){i+=`, ${e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const i=t.referencedColumnNames.map((e=>`\`${e}\``)).join(", ");return`CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${i})`})).join(", ")}`}i+=")";const r=e.columns.filter((e=>e.isPrimary));if(r.length>0){i+=` PRIMARY KEY (${r.map((e=>this.driver.escape(e.name))).join(", ")})`}return new Va(i)}dropTableSql(e){return new Va(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e),i="string"==typeof e.expression?e.expression:e.expression(this.connection).getQuery();return new Va(`CREATE ${t}VIEW ${n} SQL SECURITY INVOKER AS ${i}`)}async insertViewDefinitionSql(e){let{schema:t,tableName:n}=this.driver.parseTableName(e);const i=e.materialized?$a.MATERIALIZED_VIEW:$a.VIEW,r="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:i,schema:t,name:n,value:r})}dropViewSql(e){const t=e.materialized?"MATERIALIZED ":"";return new Va(`DROP ${t}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){let{schema:t,tableName:n}=this.driver.parseTableName(e);const i=e.materialized?$a.MATERIALIZED_VIEW:$a.VIEW;return this.deleteTypeormMetadataSql({type:i,schema:t,name:n})}createIndexSql(e,t){const n=t.columnNames.map((e=>this.driver.escape(e))).join(", ");let i="";return t.isUnique&&(i+="UNIQUE "),t.isNullFiltered&&(i+="NULL_FILTERED "),new Va(`CREATE ${i}INDEX \`${t.name}\` ON ${this.escapePath(e)} (${n})`)}dropIndexSql(e,t){let n=t instanceof Zi?t.name:t;return new Va(`DROP INDEX \`${n}\``)}createCheckConstraintSql(e,t){return new Va(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` CHECK (${t.expression})`)}dropCheckConstraintSql(e,t){const n=t instanceof ir?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${n}\``)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>this.driver.escape(e))).join(", "),i=t.referencedColumnNames.map((e=>this.driver.escape(e))).join(",");let r=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${i})`;return new Va(r)}dropForeignKeySql(e,t){const n=t instanceof er?t.name:t;return new Va(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${n}\``)}escapePath(e){const{tableName:t}=this.driver.parseTableName(e);return`\`${t}\``}buildCreateColumnSql(e){let t=`${this.driver.escape(e.name)} ${this.connection.driver.createFullType(e)}`;return"STORED"===e.generatedType&&e.asExpression?t+=` AS (${e.asExpression}) STORED`:e.isNullable||(t+=" NOT NULL"),t}async executeQueries(e,t){if(e instanceof Va&&(e=[e]),t instanceof Va&&(t=[t]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...t),!0===this.sqlMemoryMode)return Promise.resolve();for(const{query:t,parameters:n}of e)this.isDMLQuery(t)?await this.query(t,n):await this.updateDDL(t,n)}isDMLQuery(e){return e.startsWith("INSERT")||e.startsWith("UPDATE")||e.startsWith("DELETE")}}var bs=n(1048).Buffer;class ws{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="none",this.supportedDataTypes=["bool","int64","float64","numeric","string","json","bytes","date","timestamp","array"],this.supportedUpsertType=void 0,this.spatialTypes=[],this.withLengthColumnTypes=["string","bytes"],this.withWidthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"",updateDate:"timestamp",updateDateDefault:"",deleteDate:"timestamp",deleteDateNullable:!0,version:"int64",treeLevel:"int64",migrationId:"int64",migrationName:"string",migrationTimestamp:"int64",cacheId:"string",cacheIdentifier:"string",cacheTime:"int64",cacheDuration:"int64",cacheQuery:"string",cacheResult:"string",metadataType:"string",metadataDatabase:"string",metadataSchema:"string",metadataTable:"string",metadataName:"string",metadataValue:"string"},this.dataTypeDefaults={},this.maxAliasLength=63,this.cteCapabilities={enabled:!0},this._isReturningSqlSupported={delete:!1,insert:!1,update:!1},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}async connect(){this.instance=this.spanner.instance(this.options.instanceId),this.instanceDatabase=this.instance.database(this.options.databaseId)}afterConnect(){return Promise.resolve()}async disconnect(){this.instanceDatabase.close()}createSchemaBuilder(){return new La(this.connection)}createQueryRunner(e){return new gs(this,e)}escapeQueryWithParameters(e,t,n){const i=Object.keys(n).map((e=>n[e]));return t&&Object.keys(t).length?[e=(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,r)=>{if(!t.hasOwnProperty(r))return e;let a=t[r];return null===a?e:n?a.map((e=>(i.push(e),this.createParameter(r,i.length-1)))).join(", "):a instanceof Function?a():(i.push(a),this.createParameter(r,i.length-1))}))).replace(/([ ]+)?=([ ]+)?:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,i,r,a)=>{if(!t.hasOwnProperty(a))return e;return null===t[a]?" IS NULL":e})),i]:[e,i]}escape(e){return`\`${e}\``}buildTableName(e,t,n){let i=[e];return n&&i.unshift(n),i.join(".")}parseTableName(e){const t=this.database,n=void 0;if(e instanceof ar||e instanceof Pa){const i=this.parseTableName(e.name);return{database:e.database||i.database||t,schema:e.schema||i.schema||n,tableName:i.tableName}}if(e instanceof er){const i=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||i.database||t,schema:e.referencedSchema||i.schema||n,tableName:i.tableName}}if(e instanceof ya)return{database:e.database||t,schema:e.schema||n,tableName:e.tableName};const i=e.split(".");return{database:(i.length>1?i[0]:void 0)||t,schema:n,tableName:i.length>1?i[1]:i[0]}}preparePersistentValue(e,t){if(t.transformer&&(e=Zr.W.transformTo(t.transformer,e)),null==e)return e;if("numeric"===t.type){return(this.options.driver||Qi.load("spanner")).Spanner.numeric(e)}return"date"===t.type?Jr.mixedDateToDateString(e):"json"===t.type?e:"timestamp"===t.type||t.type===Date?Jr.mixedDateToDate(e):e}prepareHydratedValue(e,t){return null==e?t.transformer?Zr.W.transformFrom(t.transformer,e):e:(t.type===Boolean||"bool"===t.type?e=!!e:"timestamp"===t.type||t.type===Date?e=new Date(e):"numeric"===t.type?e=e.value:"date"===t.type?e=Jr.mixedDateToDateString(e):"json"===t.type&&(e="string"==typeof e?JSON.parse(e):e),t.transformer&&(e=Zr.W.transformFrom(t.transformer,e)),e)}normalizeType(e){return e.type===Number?"int64":e.type===String||"uuid"===e.type?"string":e.type===Date?"timestamp":e.type===bs?"bytes":e.type===Boolean?"bool":e.type||""}normalizeDefault(e){return""===e.default?`"${e.default}"`:`${e.default}`}normalizeIsUnique(e){return e.entityMetadata.indices.some((t=>t.isUnique&&1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case String:case"string":case"bytes":return"max";default:return""}}createFullType(e){let t=e.type;return this.getColumnLength(e)?t+=`(${this.getColumnLength(e)})`:e.width?t+=`(${e.width})`:null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=`(${e.precision},${e.scale})`:null!==e.precision&&void 0!==e.precision&&(t+=`(${e.precision})`),e.isArray&&(t=`array<${t}>`),t}obtainMasterConnection(){return this.instanceDatabase}obtainSlaveConnection(){return this.instanceDatabase}createGeneratedMap(e,t,n){if(!t)return;if(void 0===t.insertId)return Object.keys(t).reduce(((n,i)=>{const r=e.findColumnWithDatabaseName(i);return r&&Xr.m.mergeDeep(n,r.createValueMap(t[i])),n}),{});const i=e.generatedColumns.reduce(((e,i)=>{let r;return"increment"===i.generationStrategy&&t.insertId&&(r=t.insertId+n),Xr.m.mergeDeep(e,i.createValueMap(r))}),{});return Object.keys(i).length>0?i:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;return n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==this.getColumnLength(t)||n.asExpression!==t.asExpression||n.generatedType!==t.generatedType||n.isPrimary!==t.isPrimary||!this.compareNullableValues(t,n)||n.isUnique!==this.normalizeIsUnique(t)}))}isReturningSqlSupported(e){return this._isReturningSqlSupported[e]}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return"@param"+t}loadDependencies(){try{const e=this.options.driver||Qi.load("spanner");this.spanner=new e.Spanner({projectId:this.options.projectId})}catch(e){throw console.error(e),new Ya.W("Spanner","@google-cloud/spanner")}}compareNullableValues(e,t){return!!e.generatedType||e.isNullable===t.isNullable}compareDefaultValues(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t}normalizeDatetimeFunction(e){if(!e)return e;if(-1!==e.toUpperCase().indexOf("CURRENT_TIMESTAMP")||-1!==e.toUpperCase().indexOf("NOW")){const t=e.match(/\(\d+\)/);return t?`CURRENT_TIMESTAMP${t[0]}`:"CURRENT_TIMESTAMP"}return e}escapeComment(e){return e?e=e.replace(/\u0000/g,""):e}}var _s=n(55854),vs=n(81465);class Es{constructor(e){this.connection=e}async build(){const e={};this.connection.entityMetadatas.forEach((t=>{const n=[];t.primaryColumns.forEach((e=>{n.push(`&[${e.propertyName}]`)})),t.indices.forEach((e=>{const t=[];for(const n of e.columns)t.push(n.propertyName);const i=e.isUnique?"&":"";n.push(`${i}[${t.join("+")}]`),1===t.length&&n.push(`${i}${t.join("+")}`)})),e[t.tableName]=n.join(",")}));const t=this.connection.createQueryRunner(),n=this.connection.options;await t.applySchemas(e,n.version)}log(){return Promise.resolve(new Fa)}}class Ts{constructor(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.connection=e,this.databaseConnection=t,this.broadcaster=new Ha(this)}async beforeMigration(){}async afterMigration(){}async applySchemas(e,t){const n=this.connection.driver;n.dexie.isOpen()&&await n.dexie.close(),n.dexie.version(t).stores(e),await n.dexie.open()}async clearDatabase(){await this.databaseConnection.delete()}async connect(){}async release(){}async startTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}async commitTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}async rollbackTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}query(e,t){throw new Ji.VR("Executing SQL query is not supported by IndexedDb driver.")}stream(e,t,n,i){throw new Ji.VR("Stream is not supported by IndexedDb driver.")}async getDatabases(){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async getSchemas(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async getTable(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async getTables(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async getView(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async getViews(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}getReplicationMode(){return"master"}async hasDatabase(e){throw new Ji.VR("Check database queries are not supported by IndexedDb driver.")}async getCurrentDatabase(){throw new Ji.VR("Check database queries are not supported by IndexedDb driver.")}async hasSchema(e){throw new Ji.VR("Check schema queries are not supported by IndexedDb driver.")}async getCurrentSchema(){throw new Ji.VR("Check schema queries are not supported by IndexedDb driver.")}async hasTable(e){throw new Ji.VR("Check schema queries are not supported by IndexedDb driver.")}async hasColumn(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createDatabase(e){throw new Ji.VR("Database create queries are not supported by IndexedDb driver.")}async dropDatabase(e,t){throw new Ji.VR("Database drop queries are not supported by IndexedDb driver.")}async createSchema(e,t){throw new Ji.VR("Schema create queries are not supported by IndexedDb driver.")}async dropSchema(e,t){throw new Ji.VR("Schema drop queries are not supported by IndexedDb driver.")}async createTable(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropTable(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createView(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropView(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async renameTable(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async addColumn(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async addColumns(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async renameColumn(e,t,n){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async changeColumn(e,t,n){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async changeColumns(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropColumn(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropColumns(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createPrimaryKey(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async updatePrimaryKeys(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropPrimaryKey(e){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createUniqueConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createUniqueConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropUniqueConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropUniqueConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createCheckConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createCheckConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropCheckConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropCheckConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createExclusionConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createExclusionConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropExclusionConstraint(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropExclusionConstraints(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createForeignKey(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createForeignKeys(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropForeignKey(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropForeignKeys(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createIndex(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async createIndices(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropIndex(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async dropIndices(e,t){throw new Ji.VR("Schema update queries are not supported by IndexedDb driver.")}async clearTable(e){await this.databaseConnection._allTables[e].clear()}enableSqlMemory(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}disableSqlMemory(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}clearSqlMemory(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}getMemorySql(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}async executeMemoryUpSql(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}async executeMemoryDownSql(){throw new Ji.VR("This operation is not supported by IndexedDb driver.")}}class Ns{constructor(e){var t;this.connection=e,this.isReplicated=!1,this.treeSupport=!1,this.transactionSupport="simple",this.supportedDataTypes=["int","integer","tinyint","bigint","varchar","text","boolean","date","datetime"],this.spatialTypes=[],this.withLengthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:(new Date).toISOString(),updateDate:"datetime",updateDatePrecision:6,updateDateDefault:(new Date).toISOString(),deleteDate:"datetime",deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"int",migrationTimestamp:"int",cacheId:"int",cacheIdentifier:"int",cacheTime:"int",cacheDuration:"int",cacheQuery:"int",cacheResult:"int",metadataType:"int",metadataDatabase:"int",metadataSchema:"int",metadataTable:"int",metadataName:"int",metadataValue:"int"},this.validOptionNames=[],this.cteCapabilities={enabled:!1},this.options=e.options,this.loadDependencies();const n=null!==(t=this.options.database)&&void 0!==t?t:"default";this.dexie=new vs.default(n,{...this.options.dexieJsConfig})}async connect(){this.queryRunner=new Ts(this.connection,this.dexie)}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise(((e,t)=>{if(!this.queryRunner)return t(new _s.e("indexeddb"));this.queryRunner.databaseConnection.close(),this.queryRunner=void 0}))}createSchemaBuilder(){return new Es(this.connection)}createQueryRunner(e){return this.queryRunner}escapeQueryWithParameters(e,t,n){throw new Ji.VR("This operation is not supported by IndexedDB.")}escape(e){return e}buildTableName(e,t,n){return e}parseTableName(e){return cr.t.isEntityMetadata(e)?{tableName:e.tableName}:cr.t.isTable(e)||cr.t.isView(e)?{tableName:e.name}:cr.t.isTableForeignKey(e)?{tableName:e.referencedTableName}:{tableName:e}}preparePersistentValue(e,t){return t.transformer&&(e=Zr.W.transformTo(t.transformer,e)),e}prepareHydratedValue(e,t){return t.transformer&&(e=Zr.W.transformFrom(t.transformer,e)),e}normalizeType(e){return e.type===Number||"int"===e.type||"integer"===e.type||"tinyint"===e.type?"integer":e.type===String||"varchar"===e.type||"bigint"===e.type?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":e.type||""}normalizeDefault(e){const t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?t?"1":"0":"function"==typeof t?t():"string"==typeof t?`'${t}'`:null!=t?`${t}`:void 0}normalizeIsUnique(e){return e.entityMetadata.uniques.some((t=>1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){throw new Ji.VR("IndexedDB is schema-less, not supported by this driver.")}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,t){return e.objectIdColumn.createValueMap(t)}findChangedColumns(e,t){throw new Ji.VR("IndexedDB is schema-less, not supported by this driver.")}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return""}loadDependencies(){try{const e=n(81465);this.dexie=e}catch(e){throw new Ya.W("IndexedDb","dexie")}}}class As{create(e){const{type:t}=e.options;if("indexeddb"===t)return new Ns(e);if("react-native"===t){const{ReactNativeDriver:t}=n(24611);return new t(e)}switch(t){case"mysql":case"mariadb":return new Er.MysqlDriver(e);case"postgres":return new Er.PostgresDriver(e);case"cockroachdb":return new Er.CockroachDriver(e);case"sap":return new Er.SapDriver(e);case"sqlite":return new Er.SqliteDriver(e);case"better-sqlite3":return new Er.BetterSqlite3Driver(e);case"cordova":return new Ja(e);case"nativescript":return new es(e);case"sqljs":return new is(e);case"oracle":return new Er.OracleDriver(e);case"mssql":return new Er.SqlServerDriver(e);case"mongodb":return new Er.MongoDriver(e);case"expo":return new as(e);case"aurora-mysql":return new cs(e);case"aurora-postgres":return new ms(e);case"capacitor":return new ys(e);case"spanner":return new ws(e);default:throw new Ia.d(t,["aurora-mysql","aurora-postgres","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs","indexeddb","spanner"])}}}const Ss=new class{constructor(){this.instances=[]}get(e){let t=this.instances.find((t=>t.type===e));return t||(t={type:e,object:new e},this.instances.push(t)),t.object}};let xs,Cs;function Ms(e){if(xs)try{const t=xs.get(e);if(t)return t;if(!Cs||!Cs.fallback)return t}catch(e){if(!Cs||!Cs.fallbackOnErrors)throw e}return Ss.get(e)}var Rs=n(1048).Buffer;class ks{constructor(e){this["@instanceof"]=Symbol.for("ColumnMetadata"),this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),e.args.options.generatedIdentity&&(this.generatedIdentity=e.args.options.generatedIdentity),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),null!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(Rr.B.isObject(e.args.options.enum)&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter((t=>isNaN(+t)&&"function"!=typeof e.args.options.enum[t])).map((t=>e.args.options.enum[t])):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.primaryKeyConstraintName&&(this.primaryKeyConstraintName=e.args.options.primaryKeyConstraintName),e.args.options.foreignKeyConstraintName&&(this.foreignKeyConstraintName=e.args.options.foreignKeyConstraintName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.createDateDefault),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.updateDateDefault),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}createValueMap(e,t=!1){if(this.embeddedMetadata){const n=[...this.embeddedMetadata.parentPropertyNames],i=(n,r)=>{const a=n.shift();return a?(r[a]={},i(n,r[a]),r):("increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),r[t?this.databaseName:this.propertyName]=e,r)};return i(n,{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),{[t?this.databaseName:this.propertyName]:e}}getEntityValueMap(e,t){var n;if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],n=this.embeddedMetadata.isArray,i=(e,t)=>{if(void 0===t)return{};const r=e.shift();if(r){const n=i(e,t[r]);return Object.keys(n).length>0?{[r]:n}:{}}return n&&Array.isArray(t)?t.map((e=>({[this.propertyName]:e[this.propertyName]}))):void 0!==t[this.propertyName]?{[this.propertyName]:t[this.propertyName]}:{}},r=i(t,e);return Object.keys(r).length>0?r:void 0}if(this.relationMetadata&&!(null===(n=Object.getOwnPropertyDescriptor(e,this.relationMetadata.propertyName))||void 0===n?void 0:n.get)&&e[this.relationMetadata.propertyName]&&Rr.B.isObject(e[this.relationMetadata.propertyName])){const t=this.relationMetadata.joinColumns.reduce(((t,n)=>{const i=n.referencedColumn.getEntityValueMap(e[this.relationMetadata.propertyName]);return void 0===i?t:Xr.m.mergeDeep(t,i)}),{});return Object.keys(t).length>0?{[this.propertyName]:t}:void 0}return void 0!==e[this.propertyName]?{[this.propertyName]:e[this.propertyName]}:void 0}getEntityValue(e,t=!1){if(null==e)return;let n;if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],i=this.embeddedMetadata.isArray,r=(e,t)=>{const n=e.shift();return n&&t?r(e,t[n]):t},a=r(t,e);if(a)if(this.relationMetadata&&this.referencedColumn){const e=this.relationMetadata.getEntityValue(a);n=e&&Rr.B.isObject(e)&&!cr.t.isFindOperator(e)&&!Rs.isBuffer(e)?this.referencedColumn.getEntityValue(e):!a[this.propertyName]||!Rr.B.isObject(a[this.propertyName])||cr.t.isFindOperator(a[this.propertyName])||Rs.isBuffer(a[this.propertyName])||a[this.propertyName]instanceof Date?a[this.propertyName]:this.referencedColumn.getEntityValue(a[this.propertyName])}else n=this.referencedColumn?this.referencedColumn.getEntityValue(a[this.propertyName]):i&&Array.isArray(a)?a.map((e=>e[this.propertyName])):a[this.propertyName]}else if(this.relationMetadata&&this.referencedColumn){const t=this.relationMetadata.getEntityValue(e);n=t&&Rr.B.isObject(t)&&!cr.t.isFindOperator(t)&&"function"!=typeof t&&!Rs.isBuffer(t)?this.referencedColumn.getEntityValue(t):!e[this.propertyName]||!Rr.B.isObject(e[this.propertyName])||cr.t.isFindOperator(e[this.propertyName])||"function"==typeof e[this.propertyName]||Rs.isBuffer(e[this.propertyName])||e[this.propertyName]instanceof Date?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName])}else n=this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName];return t&&this.transformer&&(n=Zr.W.transformTo(this.transformer,n)),n}setEntityValue(e,t){if(this.embeddedMetadata){const n=(e,i)=>{const r=e.shift();return r?(i[r.propertyName]||(i[r.propertyName]=r.create()),n(e,i[r.propertyName]),i):(i[this.propertyName]=t,i)};return n([...this.embeddedMetadata.embeddedMetadataTree],e)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=t):e[this.propertyName]=t}compareEntityValue(e,t){const n=this.getEntityValue(e);return Rr.B.isObject(n)?n.equals(t):n===t}build(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this}buildPropertyPath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e}buildDatabasePath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e}buildDatabaseName(e){let t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return"mongodb"===e.driver.options.type&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)}}class Os{constructor(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.isNullFiltered=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.isNullFiltered=!!e.args.nullFiltered,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}build(e){if(!1===this.synchronize)return this.name=this.givenName,this;const t={};if(this.givenColumnNames){let e=[];if(Array.isArray(this.givenColumnNames))e=this.givenColumnNames.map((e=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+e:e.trim())),e.forEach((e=>t[e]=1));else{const n=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(n)?(e=n.map((e=>String(e))),e.forEach((e=>t[e]=1))):(e=Object.keys(n).map((e=>String(e))),Object.keys(n).forEach((e=>t[e]=n[e])))}this.columns=e.map((e=>{const t=this.entityMetadata.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.entityMetadata.relations.find((t=>t.isWithJoinColumn&&t.propertyName===e));if(n)return n.joinColumns;const i=this.givenName?'"'+this.givenName+'" ':"",r=this.entityMetadata.targetName;throw new Ji.VR(`Index ${i}contains column that is missing in the entity (${r}): `+e)})).reduce(((e,t)=>e.concat(t)))}return this.columnNamesWithOrderingMap=Object.keys(t).reduce(((e,n)=>{const i=this.entityMetadata.columns.find((e=>e.propertyPath===n));return i&&(e[i.databasePath]=t[n]),e}),{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tableName,this.columns.map((e=>e.databaseName)),this.where),this}}class Is{constructor(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;const t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.createForeignKeyConstraints=!1!==t.options.createForeignKeyConstraints,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.orphanedRowAction=t.options.orphanedRowAction||"nullify",this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,"function"==typeof t.type?this.type="function"==typeof t.type?t.type():t.type:cr.t.isEntitySchema(t.type)?this.type=t.type.options.name:Rr.B.isObject(t.type)&&"string"==typeof t.type.name?this.type=t.type.name:this.type=t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}getRelationIdMap(e){const t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((e=>e.referencedColumn));return ya.getValueMap(e,t)}ensureRelationIdMap(e){if(Rr.B.isObject(e))return e;const t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((e=>e.referencedColumn));if(t.length>1)throw new Ji.VR("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)}getEntityValue(e,t=!1){if(null!=e){if(this.embeddedMetadata){const n=[...this.embeddedMetadata.parentPropertyNames],i=(e,t)=>{const n=e.shift();return n?t[n]?i(e,t[n]):void 0:t},r=i(n,e);return this.isLazy?void 0!==r["__"+this.propertyName+"__"]?r["__"+this.propertyName+"__"]:!0===t?r[this.propertyName]:void 0:r?r[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}}setEntityValue(e,t){const n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){const i=(e,r)=>{const a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n]=t,r)};return i([...this.embeddedMetadata.embeddedMetadataTree],e)}e[n]=t}createValueMap(e){if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],n=(t,i)=>{const r=t.shift();return r?(i[r]={},n(t,i[r]),i):(i[this.propertyName]=e,i)};return n(t,{})}return{[this.propertyName]:e}}build(){this.propertyPath=this.buildPropertyPath()}registerForeignKeys(...e){this.foreignKeys.push(...e)}registerJoinColumns(e=[],t=[]){this.joinColumns=e,this.inverseJoinColumns=t,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner}registerJunctionEntityMetadata(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)}buildInverseSidePropertyPath(){if(this.givenInverseSidePropertyFactory){const e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""}buildPropertyPath(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName}}class Ps{constructor(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}create(e){return"function"!=typeof this.type?{}:!(null==e?void 0:e.fromDeserializer)||this.isAlwaysUsingConstructor?new this.type:Object.create(this.type.prototype)}build(e){return this.embeddeds.forEach((t=>t.build(e))),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),e.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!e.options.entitySkipConstructor),this}buildPartialPrefix(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new Ji.VR(`Invalid prefix option given for ${this.entityMetadata.targetName}#${this.propertyName}`)}buildPrefix(e){if("mongodb"===e.driver.options.type)return this.propertyName;let t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push(...this.buildPartialPrefix()),t.join("_")}buildParentPropertyNames(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]}buildParentPrefixes(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()}buildEmbeddedMetadataTree(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]}buildColumnsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildColumnsFromTree())),this.columns)}buildRelationsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationsFromTree())),this.relations)}buildListenersFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildListenersFromTree())),this.listeners)}buildIndicesFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildIndicesFromTree())),this.indices)}buildUniquesFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildUniquesFromTree())),this.uniques)}buildRelationIdsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationIdsFromTree())),this.relationIds)}buildRelationCountsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationCountsFromTree())),this.relationCounts)}}class Ds{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}setValue(e){const t=this.relation.getEntityValue(e);if(Array.isArray(t))e[this.propertyName]=t.map((e=>this.relation.inverseEntityMetadata.getEntityIdMixedMap(e))).filter((e=>null!=e));else{const n=this.relation.inverseEntityMetadata.getEntityIdMixedMap(t);void 0!==n&&(e[this.propertyName]=n)}}build(){const e="function"==typeof this.relationNameOrFactory?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Ji.VR(`Cannot find relation ${e}. Wrong relation specified for @RelationId decorator.`);this.relation=t}}class Ls{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}build(){const e="function"==typeof this.relationNameOrFactory?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Ji.VR(`Cannot find relation ${e}. Wrong relation specified for @RelationCount decorator.`);this.relation=t}}class qs{}qs.AFTER_LOAD="after-load",qs.BEFORE_INSERT="before-insert",qs.AFTER_INSERT="after-insert",qs.BEFORE_UPDATE="before-update",qs.AFTER_UPDATE="after-update",qs.BEFORE_REMOVE="before-remove",qs.AFTER_REMOVE="after-remove",qs.BEFORE_SOFT_REMOVE="before-soft-remove",qs.AFTER_SOFT_REMOVE="after-soft-remove",qs.BEFORE_RECOVER="before-recover",qs.AFTER_RECOVER="after-recover";class $s{constructor(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,this.givenName=e.name,e.namingStrategy&&this.build(e.namingStrategy)}build(e){this.columnNames=this.columns.map((e=>e.databaseName)),this.referencedColumnNames=this.referencedColumns.map((e=>e.databaseName)),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=this.givenName?this.givenName:e.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)}}class js{constructor(e){this.connection=e}build(e,t){var n,i;const r=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),s=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),o=new ya({connection:this.connection,args:{target:"",name:s,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});o.build();const c=r.map((n=>{const i=t.joinColumns?t.joinColumns.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))):void 0,r=i&&i.name?i.name:this.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new ks({connection:this.connection,entityMetadata:o,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:r,options:{name:r,length:n.length||!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,type:n.type,precision:n.precision,scale:n.scale,charset:n.charset,collation:n.collation,zerofill:n.zerofill,unsigned:!!n.zerofill||n.unsigned,enum:n.enum,enumName:n.enumName,foreignKeyConstraintName:null==i?void 0:i.foreignKeyConstraintName,nullable:!1,primary:!0}}})})),l=a.map((n=>{const i=t.inverseJoinColumns?t.inverseJoinColumns.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))):void 0,r=i&&i.name?i.name:this.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new ks({connection:this.connection,entityMetadata:o,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:r,options:{length:n.length||!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,type:n.type,precision:n.precision,scale:n.scale,charset:n.charset,collation:n.collation,zerofill:n.zerofill,unsigned:!!n.zerofill||n.unsigned,enum:n.enum,enumName:n.enumName,foreignKeyConstraintName:null==i?void 0:i.foreignKeyConstraintName,name:r,nullable:!1,primary:!0}}})}));return this.changeDuplicatedColumnNames(c,l),o.ownerColumns=c,o.inverseColumns=l,o.ownColumns=[...c,...l],o.ownColumns.forEach((t=>t.relationMetadata=e)),o.foreignKeys=e.createForeignKeyConstraints?[new $s({entityMetadata:o,referencedEntityMetadata:e.entityMetadata,columns:c,referencedColumns:r,name:null===(n=c[0])||void 0===n?void 0:n.foreignKeyConstraintName,onDelete:"spanner"===this.connection.driver.options.type?"NO ACTION":e.onDelete||"CASCADE",onUpdate:"oracle"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?"NO ACTION":e.onUpdate||"CASCADE"}),new $s({entityMetadata:o,referencedEntityMetadata:e.inverseEntityMetadata,columns:l,referencedColumns:a,name:null===(i=l[0])||void 0===i?void 0:i.foreignKeyConstraintName,onDelete:"spanner"===this.connection.driver.options.type?"NO ACTION":e.inverseRelation?e.inverseRelation.onDelete:"CASCADE",onUpdate:"oracle"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?"NO ACTION":e.inverseRelation?e.inverseRelation.onUpdate:"CASCADE"})]:[],o.ownIndices=[new Os({entityMetadata:o,columns:c,args:{target:o.target,synchronize:!0}}),new Os({entityMetadata:o,columns:l,args:{target:o.target,synchronize:!0}})],o}collectReferencedColumns(e,t){const n=!!t.joinColumns&&t.joinColumns.find((e=>!!e.referencedColumnName));return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter((e=>e.isPrimary)):t.joinColumns.map((t=>{const n=e.entityMetadata.columns.find((e=>e.propertyName===t.referencedColumnName));if(!n)throw new Ji.VR(`Referenced column ${t.referencedColumnName} was not found in entity ${e.entityMetadata.name}`);return n}))}collectInverseReferencedColumns(e,t){const n=!!t.inverseJoinColumns,i=!!n&&t.inverseJoinColumns.find((e=>!!e.referencedColumnName));return!n||n&&!i?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map((t=>{const n=e.inverseEntityMetadata.ownColumns.find((e=>e.propertyName===t.referencedColumnName));if(!n)throw new Ji.VR(`Referenced column ${t.referencedColumnName} was not found in entity ${e.inverseEntityMetadata.name}`);return n}))}changeDuplicatedColumnNames(e,t){e.forEach((e=>{t.forEach((t=>{if(e.givenDatabaseName===t.givenDatabaseName){const n=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=n,e.givenDatabaseName=n;const i=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}}))}))}}class Bs{constructor(e){this.connection=e}build(e){const t=new ya({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return t.build(),e.primaryColumns.forEach((n=>{t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,closureType:"ancestor",referencedColumn:n,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(n):n.propertyName+"_ancestor",options:{primary:!0,length:n.length,type:n.type}}})),t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,closureType:"descendant",referencedColumn:n,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(n):n.propertyName+"_descendant",options:{primary:!0,length:n.length,type:n.type}}}))})),t.ownIndices=[new Os({entityMetadata:t,columns:[t.ownColumns[0]],args:{target:t.target,synchronize:!0}}),new Os({entityMetadata:t,columns:[t.ownColumns[1]],args:{target:t.target,synchronize:!0}})],e.treeLevelColumn&&t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),t.foreignKeys=[new $s({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[0]],referencedColumns:e.primaryColumns,onDelete:"mssql"===this.connection.driver.options.type?"NO ACTION":"CASCADE"}),new $s({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[1]],referencedColumns:e.primaryColumns,onDelete:"mssql"===this.connection.driver.options.type?"NO ACTION":"CASCADE"})],t}}class Us{constructor(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns,this.deferrable=e.args.deferrable)}build(e){const t={};if(this.givenColumnNames){let e=[];if(Array.isArray(this.givenColumnNames))e=this.givenColumnNames.map((e=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+e:e.trim())),e.forEach((e=>t[e]=1));else{const n=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(n)?(e=n.map((e=>String(e))),e.forEach((e=>t[e]=1))):(e=Object.keys(n).map((e=>String(e))),Object.keys(n).forEach((e=>t[e]=n[e])))}this.columns=e.map((e=>{const t=this.entityMetadata.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.entityMetadata.relations.find((t=>t.isWithJoinColumn&&t.propertyName===e));if(n)return n.joinColumns;const i=this.givenName?'"'+this.givenName+'" ':"",r=this.entityMetadata.targetName;throw new Ji.VR(`Unique constraint ${i}contains column that is missing in the entity (${r}): `+e)})).reduce(((e,t)=>e.concat(t)))}return this.columnNamesWithOrderingMap=Object.keys(t).reduce(((e,n)=>{const i=this.entityMetadata.columns.find((e=>e.propertyPath===n));return i&&(e[i.databasePath]=t[n]),e}),{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map((e=>e.databaseName))),this}}class Vs{constructor(e){this.connection=e}build(e,t){var n;const i=this.collectReferencedColumns(e,t),r=this.collectColumns(e,t,i);if(!i.length||!t.createForeignKeyConstraints)return{foreignKey:void 0,columns:r,uniqueConstraint:void 0};const a=new $s({name:null===(n=e[0])||void 0===n?void 0:n.foreignKeyConstraintName,entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:i,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if("oracle"===this.connection.driver.options.type&&r.every((e=>e.isPrimary)))return{foreignKey:a,columns:r,uniqueConstraint:void 0};if(i.length>0&&t.isOneToOne){const e=new Us({entityMetadata:t.entityMetadata,columns:a.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tableName,a.columns.map((e=>e.databaseName))),target:t.entityMetadata.target}});return e.build(this.connection.namingStrategy),{foreignKey:a,columns:r,uniqueConstraint:e}}return{foreignKey:a,columns:r,uniqueConstraint:void 0}}collectReferencedColumns(e,t){const n=e.find((e=>!!e.referencedColumnName)),i=0===e.length&&t.isManyToOne,r=e.length>0&&!n;return i||r?t.inverseEntityMetadata.primaryColumns:e.map((e=>{const n=t.inverseEntityMetadata.ownColumns.find((t=>t.propertyName===e.referencedColumnName));if(!n)throw new Ji.VR(`Referenced column ${e.referencedColumnName} was not found in entity ${t.inverseEntityMetadata.name}`);return n}))}collectColumns(e,t,n){return n.map((n=>{const i=e.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))),r=i?i.name:this.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName);let a=(t.embeddedMetadata?t.embeddedMetadata.columns:t.entityMetadata.ownColumns).find((e=>e.databaseNameWithoutPrefixes===r));return a||(a=new ks({connection:this.connection,entityMetadata:t.entityMetadata,embeddedMetadata:t.embeddedMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:r,type:n.type,length:n.length||!gr.I.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,enum:n.enum,enumName:n.enumName,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(a)),a.referencedColumn=n,a.type=n.type,a.relationMetadata=t,a.build(this.connection),a}))}}class Fs{constructor(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}isAllowed(e){return this.entityMetadata.target===e.constructor||"function"==typeof this.entityMetadata.target&&e.constructor.prototype instanceof this.entityMetadata.target}execute(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))}callEntityEmbeddedMethod(e,t){const n=t.shift();n&&e[n]&&(0===t.length?Array.isArray(e[n])?e[n].map((e=>e[this.propertyName]())):e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))}}class Ks{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tableName,this.expression),this}}class Ws{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this}}class Hs{constructor(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new js(e),this.closureJunctionEntityMetadataBuilder=new Bs(e),this.relationJoinColumnBuilder=new Vs(e)}build(e){const t=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter((e=>"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type)).map((e=>this.createEntityMetadata(e)));return t.forEach((e=>this.computeParentEntityMetadata(t,e))),t.forEach((e=>{e.childEntityMetadatas=t.filter((t=>"function"==typeof e.target&&"function"==typeof t.target&&Wi.isInherited(t.target,e.target)))})),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>e.build())),t.filter((e=>"entity-child"===e.tableType)).forEach((e=>e.build())),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>this.computeEntityMetadataStep1(t,e))),t.filter((e=>"entity-child"===e.tableType)).forEach((e=>this.computeEntityMetadataStep1(t,e))),t.forEach((e=>this.computeEntityMetadataStep2(e))),t.forEach((e=>this.computeInverseProperties(e,t))),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>{e.relations.filter((e=>e.isOneToOne||e.isManyToOne)).forEach((t=>{const n=this.metadataArgsStorage.filterJoinColumns(t.target,t.propertyName),{foreignKey:i,columns:r,uniqueConstraint:a}=this.relationJoinColumnBuilder.build(n,t);if(i&&(t.registerForeignKeys(i),e.foreignKeys.push(i)),r&&t.registerJoinColumns(r),a)if(gr.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"mssql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){const n=new Os({entityMetadata:a.entityMetadata,columns:a.columns,args:{target:a.target,name:a.name,unique:!0,synchronize:!0}});"mssql"===this.connection.driver.options.type&&(n.where=n.columns.map((e=>`${this.connection.driver.escape(e.databaseName)} IS NOT NULL`)).join(" AND ")),"spanner"===this.connection.driver.options.type&&(n.isNullFiltered=!0),t.embeddedMetadata?t.embeddedMetadata.indices.push(n):t.entityMetadata.ownIndices.push(n),this.computeEntityMetadataStep2(e)}else t.embeddedMetadata?t.embeddedMetadata.uniques.push(a):t.entityMetadata.ownUniques.push(a),this.computeEntityMetadataStep2(e);if(i&&"cockroachdb"===this.connection.driver.options.type){const n=new Os({entityMetadata:t.entityMetadata,columns:i.columns,args:{target:t.entityMetadata.target,synchronize:!0}});t.embeddedMetadata?t.embeddedMetadata.indices.push(n):t.entityMetadata.ownIndices.push(n),this.computeEntityMetadataStep2(e)}})),e.relations.filter((e=>e.isManyToMany)).forEach((e=>{const n=this.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(!n)return;const i=this.junctionEntityMetadataBuilder.build(e,n);e.registerForeignKeys(...i.foreignKeys),e.registerJoinColumns(i.ownIndices[0].columns,i.ownIndices[1].columns),e.registerJunctionEntityMetadata(i),this.computeEntityMetadataStep2(i),this.computeInverseProperties(i,t),t.push(i)}))})),t.forEach((e=>{e.relationsWithJoinColumns=e.relations.filter((e=>e.isWithJoinColumn)),e.hasNonNullableRelations=e.relationsWithJoinColumns.some((e=>!e.isNullable||e.isPrimary))})),t.filter((e=>"closure-table"===e.treeType)).forEach((e=>{const n=this.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=n,this.computeEntityMetadataStep2(n),this.computeInverseProperties(n,t),t.push(n)})),t.filter((e=>"STI"===e.inheritancePattern&&e.discriminatorColumn)).forEach((e=>this.createKeysForTableInheritance(e))),t.forEach((e=>{e.indices.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.uniques.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.checks.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.exclusions.forEach((e=>e.build(this.connection.namingStrategy)))})),t.filter((e=>"function"==typeof e.target)).forEach((e=>{e.relations.filter((e=>e.isLazy)).forEach((t=>{this.connection.relationLoader.enableLazyLoad(t,e.target.prototype)}))})),t.forEach((e=>{e.columns.forEach((t=>{const n=this.metadataArgsStorage.findGenerated(t.target,t.propertyName);n&&(t.isGenerated=!0,t.generationStrategy=n.strategy,"uuid"===n.strategy?t.type="uuid":"rowid"===n.strategy?t.type="int":t.type=t.type||Number,t.build(this.connection),this.computeEntityMetadataStep2(e))}))})),t}createEntityMetadata(e){const t="function"==typeof e.target?Wi.getInheritanceTree(e.target):[e.target],n=this.metadataArgsStorage.findInheritanceType(e.target),i=this.metadataArgsStorage.findTree(e.target);let r;return(n&&"STI"===n.pattern||"entity-child"===e.type)&&(r=this.metadataArgsStorage.filterSingleTableChildren(e.target).map((e=>e.target)).filter((e=>"function"==typeof e)),t.push(...r)),new ya({connection:this.connection,args:e,inheritanceTree:t,tableTree:i,inheritancePattern:n?n.pattern:void 0})}computeParentEntityMetadata(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find((e=>-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern)))}computeEntityMetadataStep1(e,t){const n=this.metadataArgsStorage.findInheritanceType(t.target),i=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=void 0!==i?i.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map((e=>("STI"===t.inheritancePattern&&(e.columns=e.columns.map((e=>(e.isNullable=!0,e)))),e))),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map((n=>{if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find((e=>e.propertyName===n.propertyName));const i=new ks({connection:this.connection,entityMetadata:t,args:n});return e.find((e=>"entity-child"===e.tableType&&e.target===n.target))&&(i.isNullable=!0),i})),n&&n.column){const e=n.column&&n.column.name?n.column.name:"type";let i=t.ownColumns.find((t=>t.propertyName===e));i?i.isDiscriminator=!0:(i=new ks({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:e,options:n.column||{name:e,type:"varchar",nullable:!1}}}),i.isVirtual=!0,i.isDiscriminator=!0,t.ownColumns.push(i))}if("entity-child"===t.tableType){const e=t.parentEntityMetadata.ownColumns.find((e=>e.isDiscriminator));e&&!t.ownColumns.find((t=>t===e))&&t.ownColumns.push(e)}const{namingStrategy:r}=this.connection;if("materialized-path"===t.treeType)t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:r.materializedPathColumnName,type:String,nullable:!0,default:""}}}));else if("nested-set"===t.treeType){const{left:e,right:n}=r.nestedSetColumnNames;t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:e,options:{name:e,type:Number,nullable:!1,default:1}}})),t.ownColumns.push(new ks({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:n,options:{name:n,type:Number,nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map((e=>{if("entity-child"===t.tableType){const n=t.parentEntityMetadata.ownRelations.find((t=>t.propertyName===e.propertyName)),i="function"==typeof e.type?e.type():e.type;if(n.type!==i){const e=Object.create(n);return e.type=i,e}return n}return new Is({entityMetadata:t,args:e})})),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map((e=>"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find((t=>t.propertyName===e.propertyName)):new Ds({entityMetadata:t,args:e}))),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map((e=>"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find((t=>t.propertyName===e.propertyName)):new Ls({entityMetadata:t,args:e}))),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map((e=>new Fs({entityMetadata:t,args:e}))),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map((e=>new Ks({entityMetadata:t,args:e}))),"postgres"===this.connection.driver.options.type&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map((e=>new Ws({entityMetadata:t,args:e})))),"cockroachdb"===this.connection.driver.options.type){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((e=>!e.unique)).map((e=>new Os({entityMetadata:t,args:e})));const e=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((e=>e.unique)).map((e=>new Us({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})));t.ownUniques.push(...e)}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map((e=>new Os({entityMetadata:t,args:e})));if(gr.I.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){const e=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((e=>new Os({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})));t.ownIndices.push(...e)}else{const e=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((e=>new Us({entityMetadata:t,args:e})));t.ownUniques.push(...e)}}createEmbeddedsRecursively(e,t){return t.map((t=>{const n=new Ps({entityMetadata:e,args:t}),i="function"==typeof n.type?Wi.getInheritanceTree(n.type):[n.type];return n.columns=this.metadataArgsStorage.filterColumns(i).map((t=>new ks({connection:this.connection,entityMetadata:e,embeddedMetadata:n,args:t}))),n.relations=this.metadataArgsStorage.filterRelations(i).map((t=>new Is({entityMetadata:e,embeddedMetadata:n,args:t}))),n.listeners=this.metadataArgsStorage.filterListeners(i).map((t=>new Fs({entityMetadata:e,embeddedMetadata:n,args:t}))),n.indices=this.metadataArgsStorage.filterIndices(i).map((t=>new Os({entityMetadata:e,embeddedMetadata:n,args:t}))),n.uniques=this.metadataArgsStorage.filterUniques(i).map((t=>new Us({entityMetadata:e,embeddedMetadata:n,args:t}))),n.relationIds=this.metadataArgsStorage.filterRelationIds(i).map((t=>new Ds({entityMetadata:e,args:t}))),n.relationCounts=this.metadataArgsStorage.filterRelationCounts(i).map((t=>new Ls({entityMetadata:e,args:t}))),n.embeddeds=this.createEmbeddedsRecursively(e,this.metadataArgsStorage.filterEmbeddeds(i)),n.embeddeds.forEach((e=>e.parentEmbeddedMetadata=n)),e.allEmbeddeds.push(n),n}))}computeEntityMetadataStep2(e){e.embeddeds.forEach((e=>e.build(this.connection))),e.embeddeds.forEach((e=>{e.columnsFromTree.forEach((e=>e.build(this.connection))),e.relationsFromTree.forEach((e=>e.build()))})),e.ownColumns.forEach((e=>e.build(this.connection))),e.ownRelations.forEach((e=>e.build())),e.relations=e.embeddeds.reduce(((e,t)=>e.concat(t.relationsFromTree)),e.ownRelations),e.eagerRelations=e.relations.filter((e=>e.isEager)),e.lazyRelations=e.relations.filter((e=>e.isLazy)),e.oneToOneRelations=e.relations.filter((e=>e.isOneToOne)),e.oneToManyRelations=e.relations.filter((e=>e.isOneToMany)),e.manyToOneRelations=e.relations.filter((e=>e.isManyToOne)),e.manyToManyRelations=e.relations.filter((e=>e.isManyToMany)),e.ownerOneToOneRelations=e.relations.filter((e=>e.isOneToOneOwner)),e.ownerManyToManyRelations=e.relations.filter((e=>e.isManyToManyOwner)),e.treeParentRelation=e.relations.find((e=>e.isTreeParent)),e.treeChildrenRelation=e.relations.find((e=>e.isTreeChildren)),e.columns=e.embeddeds.reduce(((e,t)=>e.concat(t.columnsFromTree)),e.ownColumns),e.listeners=e.embeddeds.reduce(((e,t)=>e.concat(t.listenersFromTree)),e.ownListeners),e.afterLoadListeners=e.listeners.filter((e=>e.type===qs.AFTER_LOAD)),e.afterInsertListeners=e.listeners.filter((e=>e.type===qs.AFTER_INSERT)),e.afterUpdateListeners=e.listeners.filter((e=>e.type===qs.AFTER_UPDATE)),e.afterRemoveListeners=e.listeners.filter((e=>e.type===qs.AFTER_REMOVE)),e.afterSoftRemoveListeners=e.listeners.filter((e=>e.type===qs.AFTER_SOFT_REMOVE)),e.afterRecoverListeners=e.listeners.filter((e=>e.type===qs.AFTER_RECOVER)),e.beforeInsertListeners=e.listeners.filter((e=>e.type===qs.BEFORE_INSERT)),e.beforeUpdateListeners=e.listeners.filter((e=>e.type===qs.BEFORE_UPDATE)),e.beforeRemoveListeners=e.listeners.filter((e=>e.type===qs.BEFORE_REMOVE)),e.beforeSoftRemoveListeners=e.listeners.filter((e=>e.type===qs.BEFORE_SOFT_REMOVE)),e.beforeRecoverListeners=e.listeners.filter((e=>e.type===qs.BEFORE_RECOVER)),e.indices=e.embeddeds.reduce(((e,t)=>e.concat(t.indicesFromTree)),e.ownIndices),e.uniques=e.embeddeds.reduce(((e,t)=>e.concat(t.uniquesFromTree)),e.ownUniques),e.primaryColumns=e.columns.filter((e=>e.isPrimary)),e.nonVirtualColumns=e.columns.filter((e=>!e.isVirtual)),e.ancestorColumns=e.columns.filter((e=>"ancestor"===e.closureType)),e.descendantColumns=e.columns.filter((e=>"descendant"===e.closureType)),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter((e=>e.isGenerated||e.isObjectId)),e.hasUUIDGeneratedColumns=e.columns.filter((e=>e.isGenerated||"uuid"===e.generationStrategy)).length>0,e.createDateColumn=e.columns.find((e=>e.isCreateDate)),e.updateDateColumn=e.columns.find((e=>e.isUpdateDate)),e.deleteDateColumn=e.columns.find((e=>e.isDeleteDate)),e.versionColumn=e.columns.find((e=>e.isVersion)),e.discriminatorColumn=e.columns.find((e=>e.isDiscriminator)),e.treeLevelColumn=e.columns.find((e=>e.isTreeLevel)),e.nestedSetLeftColumn=e.columns.find((e=>e.isNestedSetLeft)),e.nestedSetRightColumn=e.columns.find((e=>e.isNestedSetRight)),e.materializedPathColumn=e.columns.find((e=>e.isMaterializedPath)),e.objectIdColumn=e.columns.find((e=>e.isObjectId)),e.foreignKeys.forEach((e=>e.build(this.connection.namingStrategy))),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach((e=>e.build())),e.relationCounts.forEach((e=>e.build())),e.embeddeds.forEach((e=>{e.relationIdsFromTree.forEach((e=>e.build())),e.relationCountsFromTree.forEach((e=>e.build()))}))}computeInverseProperties(e,t){e.relations.forEach((n=>{const i=t.find((e=>e.target===n.type||"string"==typeof n.type&&(e.targetName===n.type||e.givenTableName===n.type)));if(!i)throw new Ji.VR("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=i,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=i.relations.find((e=>e.propertyPath===n.inverseSidePropertyPath))}))}createKeysForTableInheritance(e){e.indices.push(new Os({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))}}class Qs extends Ji.VR{static createEntitySchemaIsRequiredException(e){return new Qs(`EntitySchema is required for ${e} embedded field`)}static createTargetIsRequired(e){return new Qs(`Target field is required for ${e} embedded EntitySchema`)}constructor(e){super(e)}}class zs{transform(e){const t=new Hi;return e.forEach((e=>{const n=e.options,i={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,withoutRowid:!!n.withoutRowid,expression:n.expression};t.tables.push(i),this.transformColumnsRecursive(n,t)})),t}transformColumnsRecursive(e,t){Object.keys(e.columns).forEach((n=>{const i=e.columns[n];let r="regular";i.createDate&&(r="createDate"),i.updateDate&&(r="updateDate"),i.deleteDate&&(r="deleteDate"),i.version&&(r="version"),i.treeChildrenCount&&(r="treeChildrenCount"),i.treeLevel&&(r="treeLevel"),i.objectId&&(r="objectId");const a={target:e.target||e.name,mode:r,propertyName:n,options:{type:i.type,name:i.objectId?"_id":i.name,length:i.length,width:i.width,nullable:i.nullable,readonly:i.readonly,update:i.update,select:i.select,insert:i.insert,primary:i.primary,unique:i.unique,comment:i.comment,default:i.default,onUpdate:i.onUpdate,precision:i.precision,scale:i.scale,zerofill:i.zerofill,unsigned:i.unsigned,charset:i.charset,collation:i.collation,enum:i.enum,enumName:i.enumName,asExpression:i.asExpression,generatedType:i.generatedType,hstoreType:i.hstoreType,array:i.array,transformer:i.transformer,spatialFeatureType:i.spatialFeatureType,srid:i.srid}};if(t.columns.push(a),i.generated){const r={target:e.target||e.name,propertyName:n,strategy:"string"==typeof i.generated?i.generated:"increment"};t.generations.push(r)}i.unique&&t.uniques.push({target:e.target||e.name,columns:[n]})})),e.relations&&Object.keys(e.relations).forEach((n=>{const i=e.relations[n],r={target:e.target||e.name,propertyName:n,relationType:i.type,isLazy:i.lazy||!1,type:i.target,inverseSideProperty:i.inverseSide,isTreeParent:i.treeParent,isTreeChildren:i.treeChildren,options:{eager:i.eager||!1,cascade:i.cascade,nullable:i.nullable,onDelete:i.onDelete,onUpdate:i.onUpdate,deferrable:i.deferrable,createForeignKeyConstraints:i.createForeignKeyConstraints,persistence:i.persistence,orphanedRowAction:i.orphanedRowAction}};if(t.relations.push(r),i.joinColumn)if("boolean"==typeof i.joinColumn){const i={target:e.target||e.name,propertyName:n};t.joinColumns.push(i)}else{const r=Array.isArray(i.joinColumn)?i.joinColumn:[i.joinColumn];for(const i of r){const r={target:e.target||e.name,propertyName:n,name:i.name,referencedColumnName:i.referencedColumnName,foreignKeyConstraintName:i.foreignKeyConstraintName};t.joinColumns.push(r)}}if(i.joinTable)if("boolean"==typeof i.joinTable){const i={target:e.target||e.name,propertyName:n};t.joinTables.push(i)}else{const r={target:e.target||e.name,propertyName:n,name:i.joinTable.name,database:i.joinTable.database,schema:i.joinTable.schema,joinColumns:i.joinTable.joinColumn?[i.joinTable.joinColumn]:i.joinTable.joinColumns,inverseJoinColumns:i.joinTable.inverseJoinColumn?[i.joinTable.inverseJoinColumn]:i.joinTable.inverseJoinColumns};t.joinTables.push(r)}})),e.relationIds&&Object.keys(e.relationIds).forEach((n=>{const i=e.relationIds[n],r={propertyName:n,relation:i.relationName,target:e.target||e.name,alias:i.alias,queryBuilderFactory:i.queryBuilderFactory};t.relationIds.push(r)})),e.indices&&e.indices.forEach((n=>{const i={target:e.target||e.name,name:n.name,unique:!0===n.unique,spatial:!0===n.spatial,fulltext:!0===n.fulltext,nullFiltered:!0===n.nullFiltered,parser:n.parser,synchronize:!1!==n.synchronize,where:n.where,sparse:n.sparse,columns:n.columns};t.indices.push(i)})),e.uniques&&e.uniques.forEach((n=>{const i={target:e.target||e.name,name:n.name,columns:n.columns,deferrable:n.deferrable};t.uniques.push(i)})),e.checks&&e.checks.forEach((n=>{const i={target:e.target||e.name,name:n.name,expression:n.expression};t.checks.push(i)})),e.exclusions&&e.exclusions.forEach((n=>{const i={target:e.target||e.name,name:n.name,expression:n.expression};t.exclusions.push(i)})),e.embeddeds&&Object.keys(e.embeddeds).forEach((n=>{const i=e.embeddeds[n];if(!i.schema)throw Qs.createEntitySchemaIsRequiredException(n);const r=i.schema.options;t.embeddeds.push({target:e.target||e.name,propertyName:n,isArray:!0===i.array,prefix:void 0!==i.prefix?i.prefix:void 0,type:()=>(null==r?void 0:r.target)||r.name}),this.transformColumnsRecursive(r,t)}))}}class Gs{constructor(e){this.connection=e}async buildMigrations(e){const[t,n]=Xr.m.splitClassesAndStrings(e);return[...t,...await(this.connection.logger,[])].map((e=>Ms(e)))}async buildSubscribers(e){const[t,n]=Xr.m.splitClassesAndStrings(e||[]),i=[...t,...await(this.connection.logger,[])];return po().filterSubscribers(i).map((e=>Ms(e.target)))}async buildEntityMetadatas(e){const[t,n]=Xr.m.splitClassesAndStrings(e||[]),i=t.filter((e=>!cr.t.isEntitySchema(e))),r=t.filter((e=>cr.t.isEntitySchema(e))),a=[...i,...await(this.connection.logger,[])];a.forEach((e=>{cr.t.isEntitySchema(e)&&r.push(e)}));const s=new Hs(this.connection,po()).build(a),o=(new zs).transform(r);return[...s,...new Hs(this.connection,o).build()]}}var Ys=n(17915);class Js{constructor(e){this.options=e}logQuery(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){const n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+n)}}logQueryError(e,t,n,i){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){const i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}}logQuerySlow(e,t,n,i){const r=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+r),console.log("execution time: "+e)}logSchemaBuild(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)}logMigration(e,t){console.log(e)}log(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}}stringifyParams(e){try{return JSON.stringify(e)}catch(t){return e}}}class Xs{constructor(e){this.options=e}logQuery(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){const n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");Qi.logInfo("query:",Qi.highlightSql(n))}}logQueryError(e,t,n,i){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){const i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");Qi.logError("query failed:",Qi.highlightSql(i)),Qi.logError("error:",e)}}logQuerySlow(e,t,n,i){const r=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");Qi.logWarn("query is slow:",Qi.highlightSql(r)),Qi.logWarn("execution time:",e)}logSchemaBuild(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&Qi.log(e)}logMigration(e,t){Qi.log(e)}log(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&Qi.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&Qi.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(Qi.warn(t))}}stringifyParams(e){try{return JSON.stringify(e)}catch(t){return e}}}class Zs{logQuery(){throw new Error("This logger is not applicable in a browser context")}logQueryError(){throw new Error("This logger is not applicable in a browser context")}logQuerySlow(){throw new Error("This logger is not applicable in a browser context")}logSchemaBuild(){throw new Error("This logger is not applicable in a browser context")}logMigration(){throw new Error("This logger is not applicable in a browser context")}log(){throw new Error("This logger is not applicable in a browser context")}}class eo extends Zs{}var to=n(20124),no=n.n(to);class io{constructor(){this.debugQueryLog=no()("typeorm:query:log"),this.debugQueryError=no()("typeorm:query:error"),this.debugQuerySlow=no()("typeorm:query:slow"),this.debugSchemaBuild=no()("typeorm:schema"),this.debugMigration=no()("typeorm:migration"),this.debugLog=no()("typeorm:log"),this.debugInfo=no()("typeorm:info"),this.debugWarn=no()("typeorm:warn")}logQuery(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(Qi.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))}logQueryError(e,t,n,i){this.debugQueryError.enabled&&(this.debugQueryError(Qi.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))}logQuerySlow(e,t,n,i){this.debugQuerySlow.enabled&&(this.debugQuerySlow(Qi.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))}logSchemaBuild(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)}logMigration(e,t){this.debugMigration.enabled&&this.debugMigration(e)}log(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}}}class ro{create(e,t){if(Rr.B.isObject(e))return e;if(e)switch(e){case"simple-console":return new Js(t);case"file":return new eo(t);case"advanced-console":return new Xs(t);case"debug":return new io}return new Xs(t)}}class ao{constructor(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}async connect(){const e=this.connection.options.cache;if("redis"===this.clientType)this.client=this.redis.createClient({...null==e?void 0:e.options,legacyMode:!0}),"object"==typeof this.connection.options.cache&&this.connection.options.cache.ignoreErrors&&this.client.on("error",(e=>{this.connection.logger.log("warn",e)})),"connect"in this.client&&await this.client.connect();else if("ioredis"===this.clientType)e&&e.port?e.options?this.client=new this.redis(e.port,e.options):this.client=new this.redis(e.port):e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new Tr.V(`options.startupNodes required for ${this.clientType}.`);this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}}async disconnect(){return new Promise(((e,t)=>{this.client.quit(((n,i)=>{if(n)return t(n);e(),this.client=void 0}))}))}async synchronize(e){}getFromCache(e,t){return new Promise(((t,n)=>{e.identifier?this.client.get(e.identifier,((e,i)=>{if(e)return n(e);t(JSON.parse(i))})):e.query?this.client.get(e.query,((e,i)=>{if(e)return n(e);t(JSON.parse(i))})):t(void 0)}))}isExpired(e){return e.time+e.duration<(new Date).getTime()}async storeInCache(e,t,n){return new Promise(((t,n)=>{e.identifier?this.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,((e,i)=>{if(e)return n(e);t()})):e.query&&this.client.set(e.query,JSON.stringify(e),"PX",e.duration,((e,i)=>{if(e)return n(e);t()}))}))}async clear(e){return new Promise(((e,t)=>{this.client.flushdb(((n,i)=>{if(n)return t(n);e()}))}))}async remove(e,t){await Promise.all(e.map((e=>this.deleteKey(e))))}deleteKey(e){return new Promise(((t,n)=>{this.client.del(e,((e,i)=>{if(e)return n(e);t()}))}))}loadRedis(){try{return"ioredis/cluster"===this.clientType?Qi.load("ioredis"):Qi.load(this.clientType)}catch(e){throw new Tr.V(`Cannot use cache because ${this.clientType} is not installed. Please run "npm i ${this.clientType} --save".`)}}}var so=n(77981);class oo{constructor(e){this.connection=e;const{schema:t}=this.connection.driver.options,n=this.connection.driver.database,i=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=n,this.queryResultCacheSchema=t,this.queryResultCacheTable=this.connection.driver.buildTableName(i,t,n)}async connect(){}async disconnect(){}async synchronize(e){e=this.getQueryRunner(e);const t=this.connection.driver;await e.hasTable(this.queryResultCacheTable)||await e.createTable(new ar({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"spanner"===t.options.type?"uuid":"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))}getFromCache(e,t){t=this.getQueryRunner(t);const n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(`${n.escape("cache")}.${n.escape("identifier")} = :identifier`).setParameters({identifier:"mssql"===this.connection.driver.options.type?new or(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?"oracle"===this.connection.driver.options.type?n.where(`dbms_lob.compare(${n.escape("cache")}.${n.escape("query")}, :query) = 0`,{query:e.query}).getRawOne():n.where(`${n.escape("cache")}.${n.escape("query")} = :query`).setParameters({query:"mssql"===this.connection.driver.options.type?new or(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)}isExpired(e){const t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()}async storeInCache(e,t,n){const i=void 0===n||"slave"===(null==n?void 0:n.getReplicationMode());(void 0===n||i)&&(n=this.connection.createQueryRunner("master"));let r=e;if("mssql"===this.connection.driver.options.type&&(r={identifier:new or(e.identifier,"nvarchar"),time:new or(e.time,"bigint"),duration:new or(e.duration,"int"),query:new or(e.query,"nvarchar"),result:new or(e.result,"nvarchar")}),t&&t.identifier){const e=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r);e.where(`${e.escape("identifier")} = :condition`,{condition:r.identifier}),await e.execute()}else if(t&&t.query){const e=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r);"oracle"===this.connection.driver.options.type?e.where('dbms_lob.compare("query", :condition) = 0',{condition:r.query}):e.where(`${e.escape("query")} = :condition`,{condition:r.query}),await e.execute()}else"spanner"!==this.connection.driver.options.type||r.id||(r.id=(0,so.A)()),await n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(r).execute();i&&await n.release()}async clear(e){return this.getQueryRunner(e).clearTable(this.queryResultCacheTable)}async remove(e,t){let n=t||this.getQueryRunner();await Promise.all(e.map((e=>{const t=n.manager.createQueryBuilder();return t.delete().from(this.queryResultCacheTable).where(`${t.escape("identifier")} = :identifier`,{identifier:e}).execute()}))),t||await n.release()}getQueryRunner(e){return e||this.connection.createQueryRunner()}}class co{constructor(e){this.connection=e}create(){if(!this.connection.options.cache)throw new Tr.V("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");const e=this.connection.options.cache;return e.provider&&"function"==typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new ao(this.connection,e.type):new oo(this.connection)}}class lo{constructor(e){this.connection=e}load(e,t,n,i){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n,i):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n,i):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n,i):this.loadManyToManyNotOwner(e,t,n,i)}loadManyToOneOrOneToOneOwner(e,t,n,i){const r=Array.isArray(t)?t:[t],a=e.entityMetadata.name,s=i||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),o=s.expressionMap.mainAlias.name,c=e.entityMetadata.primaryColumns,l=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map((t=>`${e.entityMetadata.name}.${t.propertyName} = ${o}.${t.referencedColumn.propertyName}`)).join(" AND ");if(s.innerJoin(e.entityMetadata.target,a,l),1===c.length)s.where(`${a}.${c[0].propertyPath} IN (:...${a+"_"+c[0].propertyName})`),s.setParameter(a+"_"+c[0].propertyName,r.map((e=>c[0].getEntityValue(e,!0))));else{const e=r.map(((e,t)=>c.map(((n,i)=>{const r=a+"_entity_"+t+"_"+i;return s.setParameter(r,n.getEntityValue(e,!0)),a+"."+n.propertyPath+" = :"+r})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");s.where(e)}return Nr.H.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadOneToManyOrOneToOneNotOwner(e,t,n,i){const r=Array.isArray(t)?t:[t],a=e.inverseRelation.joinColumns,s=i||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName),o=s.expressionMap.mainAlias.name;if(1===a.length)s.where(`${o}.${a[0].propertyPath} IN (:...${o+"_"+a[0].propertyName})`),s.setParameter(o+"_"+a[0].propertyName,r.map((e=>a[0].referencedColumn.getEntityValue(e,!0))));else{const e=r.map(((e,t)=>a.map(((n,i)=>{const r=o+"_entity_"+t+"_"+i;return s.setParameter(r,n.referencedColumn.getEntityValue(e,!0)),o+"."+n.propertyPath+" = :"+r})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");s.where(e)}return Nr.H.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadManyToManyOwner(e,t,n,i){const r=Array.isArray(t)?t:[t],a=e.joinColumns.reduce(((e,t)=>(e[t.propertyName]=r.map((e=>t.referencedColumn.getEntityValue(e,!0))),e)),{}),s=i||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),o=s.expressionMap.mainAlias.name,c=e.junctionEntityMetadata.tableName,l=e.joinColumns.map((e=>`${c}.${e.propertyName} IN (:...${e.propertyName})`)),u=e.inverseJoinColumns.map((e=>`${c}.${e.propertyName}=${o}.${e.referencedColumn.propertyName}`));return s.innerJoin(c,c,[...l,...u].join(" AND ")).setParameters(a),Nr.H.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadManyToManyNotOwner(e,t,n,i){const r=Array.isArray(t)?t:[t],a=i||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),s=a.expressionMap.mainAlias.name,o=e.junctionEntityMetadata.tableName,c=e.inverseRelation.joinColumns.map((e=>`${o}.${e.propertyName} = ${s}.${e.referencedColumn.propertyName}`)),l=e.inverseRelation.inverseJoinColumns.map((e=>`${o}.${e.propertyName} IN (:...${e.propertyName})`)),u=e.inverseRelation.inverseJoinColumns.reduce(((e,t)=>(e[t.propertyName]=r.map((e=>t.referencedColumn.getEntityValue(e,!0))),e)),{});return a.innerJoin(o,o,[...c,...l].join(" AND ")).setParameters(u),Nr.H.joinEagerRelations(a,a.alias,a.expressionMap.mainAlias.metadata),a.getMany()}enableLazyLoad(e,t,n){const i=this,r="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",s="__has_"+e.propertyName+"__",o=(e,t)=>(e[r]=t,e[s]=!0,delete e[a],t),c=(e,t)=>(delete e[s],delete e[r],e[a]=t,t.then((n=>e[a]===t?o(e,n):n)),t);Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[s]||void 0!==this[r])return Promise.resolve(this[r]);if(this[a])return this[a];const t=i.load(e,this,n).then((t=>e.isOneToOne||e.isManyToOne?0===t.length?null:t[0]:t));return c(this,t)},set:function(e){e instanceof Promise?c(this,e):o(this,e)},configurable:!0})}}class uo{constructor(e){this.connection=e}load(e,t,n){const i=Array.isArray(t)?t:[t],r=Array.isArray(n)?n:n?[n]:void 0;return e.isManyToMany?this.loadForManyToMany(e,i,r):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,i,r):this.loadForOneToManyAndOneToOneNotOwner(e,i,r)}async loadManyToManyRelationIdsAndGroup(e,t,n,i){const r=e.isManyToMany||e.isOneToMany,a=Array.isArray(t)?t:[t];if(!n&&!(n=await this.connection.relationLoader.load(e,t,void 0,i)).length)return a.map((e=>({entity:e,related:r?[]:void 0})));const s=await this.load(e,t,n),o=Array.isArray(n)?n:[n];let c=[],l=[];return e.isManyToManyOwner?(c=e.junctionEntityMetadata.inverseColumns.map((e=>e.referencedColumn)),l=e.junctionEntityMetadata.ownerColumns.map((e=>e.referencedColumn))):e.isManyToManyNotOwner?(c=e.junctionEntityMetadata.ownerColumns.map((e=>e.referencedColumn)),l=e.junctionEntityMetadata.inverseColumns.map((e=>e.referencedColumn))):e.isManyToOne||e.isOneToOneOwner?(c=e.joinColumns.map((e=>e.referencedColumn)),l=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(c=e.inverseRelation.entityMetadata.primaryColumns,l=e.inverseRelation.joinColumns.map((e=>e.referencedColumn))),a.map((t=>{const n={entity:t,related:r?[]:void 0},i=s.filter((e=>l.every((n=>n.compareEntityValue(t,e[n.entityMetadata.name+"_"+n.propertyAliasName])))));return i.length?(o.forEach((t=>{i.forEach((i=>{c.every((n=>n.compareEntityValue(t,i[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")])))&&(r?n.related.push(t):n.related=t)}))})),n):n}))}loadForManyToMany(e,t,n){const i=e.junctionEntityMetadata,r=i.name,a=e.isOwning?i.ownerColumns:i.inverseColumns,s=e.isOwning?i.inverseColumns:i.ownerColumns,o=this.connection.createQueryBuilder();a.forEach((e=>{const t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");o.addSelect(r+"."+e.propertyPath,t)})),s.forEach((t=>{const n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");o.addSelect(r+"."+t.propertyPath,n)}));let c="";if(1===a.length){const e=t.map((e=>a[0].referencedColumn.getEntityValue(e)));e.every((e=>"number"==typeof e))?c=`${r}.${a[0].propertyPath} IN (${e.join(", ")})`:(o.setParameter("values1",e),c=r+"."+a[0].propertyPath+" IN (:...values1)")}else c="("+t.map(((e,t)=>a.map((n=>{const i="entity1_"+t+"_"+n.propertyName;return o.setParameter(i,n.referencedColumn.getEntityValue(e)),r+"."+n.propertyPath+" = :"+i})).join(" AND "))).map((e=>"("+e+")")).join(" OR ")+")";let l="";if(n)if(1===s.length){const e=n.map((e=>s[0].referencedColumn.getEntityValue(e)));e.every((e=>"number"==typeof e))?l=`${r}.${s[0].propertyPath} IN (${e.join(", ")})`:(o.setParameter("values2",e),l=r+"."+s[0].propertyPath+" IN (:...values2)")}else l="("+n.map(((e,t)=>s.map((n=>{const i="entity2_"+t+"_"+n.propertyName;return o.setParameter(i,n.referencedColumn.getEntityValue(e)),r+"."+n.propertyPath+" = :"+i})).join(" AND "))).map((e=>"("+e+")")).join(" OR ")+")";const u=[c,l].filter((e=>e.length>0)).join(" AND ");return o.from(i.target,r).where(u).getRawMany()}loadForManyToOneAndOneToOneOwner(e,t,n){const i=e.entityMetadata.targetName,r=e.joinColumns.every((t=>!!e.entityMetadata.nonVirtualColumns.find((e=>e===t))));if(n&&r){let i=[];if(t.forEach((t=>{let r={};e.entityMetadata.primaryColumns.forEach((e=>{const n=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");r[n]=e.getEntityValue(t)})),n.forEach((n=>{e.joinColumns.forEach((i=>{const a=i.getEntityValue(t),s=i.referencedColumn.getEntityValue(n);if(void 0!==a&&void 0!==s&&a===s){const t=i.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+i.referencedColumn.propertyPath.replace(".","_");r[t]=s}}))})),Object.keys(r).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&i.push(r)})),i.length===t.length)return Promise.resolve(i)}const a=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((e=>{const t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");a.addSelect(i+"."+e.propertyPath,t)})),e.joinColumns.forEach((t=>{const n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");a.addSelect(i+"."+t.propertyPath,n)}));let s="";if(1===e.entityMetadata.primaryColumns.length){const n=t.map((t=>e.entityMetadata.primaryColumns[0].getEntityValue(t)));n.every((e=>"number"==typeof e))?s=`${i}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${n.join(", ")})`:(a.setParameter("values",n),s=i+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else s=t.map(((t,n)=>e.entityMetadata.primaryColumns.map(((e,r)=>{const s="entity"+n+"_"+r;return a.setParameter(s,e.getEntityValue(t)),i+"."+e.propertyPath+" = :"+s})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");return a.from(e.entityMetadata.target,i).where(s).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,t,n){if((e=e.inverseRelation).entityMetadata.primaryColumns.length===e.joinColumns.length){if(e.entityMetadata.primaryColumns.every((t=>-1!==e.joinColumns.indexOf(t))))return Promise.resolve(t.map((t=>{const n={};return e.joinColumns.forEach((function(i){const r=i.referencedColumn.getEntityValue(t),a=i.referencedColumn.entityMetadata.name+"_"+i.referencedColumn.propertyPath.replace(".","_"),s=i.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+i.propertyPath.replace(".","_");n[a]=r,n[s]=r})),n})))}const i=e.entityMetadata.targetName,r=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((t=>{const n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");r.addSelect(i+"."+t.propertyPath,n)})),e.joinColumns.forEach((e=>{const t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");r.addSelect(i+"."+e.propertyPath,t)}));let a="";if(1===e.joinColumns.length){const n=t.map((t=>e.joinColumns[0].referencedColumn.getEntityValue(t)));n.every((e=>"number"==typeof e))?a=`${i}.${e.joinColumns[0].propertyPath} IN (${n.join(", ")})`:(r.setParameter("values",n),a=i+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else a=t.map(((t,n)=>e.joinColumns.map(((e,a)=>{const s="entity"+n+"_"+a;return r.setParameter(s,e.referencedColumn.getEntityValue(t)),i+"."+e.propertyPath+" = :"+s})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");return r.from(e.entityMetadata.target,i).where(a).getRawMany()}}class ho{constructor(e){this["@instanceof"]=Symbol.for("DataSource"),this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new ro).create(this.options.logger,this.options.logging),this.driver=(new As).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new Yi,this.metadataTableName=e.metadataTableName||"typeorm_metadata",this.queryResultCache=e.cache?new co(this).create():void 0,this.relationLoader=new lo(this),this.relationIdLoader=new uo(this),this.isInitialized=!1}get isConnected(){return this.isInitialized}get mongoManager(){if(!cr.t.isMongoEntityManager(this.manager))throw new Ji.VR("MongoEntityManager is only available for MongoDB databases.");return this.manager}get sqljsManager(){if(!cr.t.isSqljsEntityManager(this.manager))throw new Ji.VR("SqljsEntityManager is only available for Sqljs databases.");return this.manager}setOptions(e){return Object.assign(this.options,e),(e.logger||e.logging)&&(this.logger=(new ro).create(e.logger||this.options.logger,e.logging||this.options.logging)),e.namingStrategy&&(this.namingStrategy=e.namingStrategy),e.cache&&(this.queryResultCache=new co(this).create()),this}async initialize(){if(this.isInitialized)throw new Ji.tX(this.name);await this.driver.connect(),this.queryResultCache&&await this.queryResultCache.connect(),Rr.B.assign(this,{isInitialized:!0});try{await this.buildMetadatas(),await this.driver.afterConnect(),this.options.dropSchema&&await this.dropDatabase(),this.options.migrationsRun&&await this.runMigrations({transaction:this.options.migrationsTransactionMode}),this.options.synchronize&&await this.synchronize()}catch(e){throw await this.close(),e}return this}async connect(){return this.initialize()}async destroy(){if(!this.isInitialized)throw new Ji.Xp(this.name);await this.driver.disconnect(),this.queryResultCache&&await this.queryResultCache.disconnect(),Rr.B.assign(this,{isInitialized:!1})}async close(){return this.destroy()}async synchronize(e=!1){if(!this.isInitialized)throw new Ji.Xp(this.name);e&&await this.dropDatabase();const t=this.driver.createSchemaBuilder();await t.build()}async dropDatabase(){const e=this.createQueryRunner();try{if("mssql"===this.driver.options.type||gr.I.isMySQLFamily(this.driver)||"aurora-mysql"===this.driver.options.type||gr.I.isSQLiteFamily(this.driver)){const t=[];if(this.entityMetadatas.forEach((e=>{e.database&&-1===t.indexOf(e.database)&&t.push(e.database)})),0===t.length&&this.driver.database&&t.push(this.driver.database),0===t.length)await e.clearDatabase();else for(const n of t)await e.clearDatabase(n)}else await e.clearDatabase()}finally{await e.release()}}async runMigrations(e){if(!this.isInitialized)throw new Ji.Xp(this.name);const t=new lr(this);t.transaction=e&&e.transaction||"all",t.fake=e&&e.fake||!1;return await t.executePendingMigrations()}async undoLastMigration(e){if(!this.isInitialized)throw new Ji.Xp(this.name);const t=new lr(this);t.transaction=e&&e.transaction||"all",t.fake=e&&e.fake||!1,await t.undoLastMigration()}async showMigrations(){if(!this.isInitialized)throw new Ji.Xp(this.name);const e=new lr(this);return await e.showMigrations()}hasMetadata(e){return!!this.findMetadata(e)}getMetadata(e){const t=this.findMetadata(e);if(!t)throw new Ji.Yg(e);return t}getRepository(e){return this.manager.getRepository(e)}getTreeRepository(e){return this.manager.getTreeRepository(e)}getMongoRepository(e){if("mongodb"!==this.driver.options.type)throw new Ji.VR("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)}getCustomRepository(e){return this.manager.getCustomRepository(e)}async transaction(e,t){const n=(t||{}).entitiesToLock;return this.manager.transaction(e,t,n)}async query(e,t,n){if(cr.t.isMongoEntityManager(this.manager))throw new Ji.VR("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new Ji.hz;const i=n||this.createQueryRunner();try{return await i.query(e,t)}finally{n||await i.release()}}createQueryBuilder(e,t,n){if(cr.t.isMongoEntityManager(this.manager))throw new Ji.VR("Query Builder is not supported by MongoDB.");if(t){t=gr.I.buildAlias(this.driver,t);const i=this.getMetadata(e);return new Ys.w(this,n).select(t).from(i.target,t)}return new Ys.w(this,e)}createQueryRunner(e="master"){const t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t}getManyToManyMetadata(e,t){const n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Ji.VR(`Relation "${t}" was not found in ${e} entity.`);if(!n.isManyToMany)throw new Ji.VR(`Relation "${e}#${t}" does not have a many-to-many relationship.You can use this method only on many-to-many relations.`);return n.junctionEntityMetadata}createEntityManager(e){return(new Oa).create(this,e)}findMetadata(e){return this.entityMetadatas.find((t=>t.target===e||(cr.t.isEntitySchema(e)?t.name===e.options.name:"string"==typeof e?-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e:!(!Rr.B.isObject(e)||"string"!=typeof e.name)&&(-1!==e.name.indexOf(".")?t.tablePath===e.name:t.name===e.name||t.tableName===e.name))))}async buildMetadatas(){const e=new Gs(this),t=new br,n=Rr.B.mixedListToArray(this.options.subscribers||[]),i=await e.buildSubscribers(n);Rr.B.assign(this,{subscribers:i});const r=Rr.B.mixedListToArray(this.options.entities||[]),a=await e.buildEntityMetadatas(r);Rr.B.assign(this,{entityMetadatas:a});const s=Rr.B.mixedListToArray(this.options.migrations||[]),o=await e.buildMigrations(s);Rr.B.assign(this,{migrations:o}),t.validateMany(this.entityMetadatas.filter((e=>"view"!==e.tableType)),this.driver);for(let e of a)cr.t.isBaseEntityConstructor(e.target)&&e.target.useDataSource(this)}}n(1430),n(47037);function po(){const e=Qi.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new Hi),e.typeormMetadataArgsStorage}var mo=n(80345);function fo(e,t){return function(n,i){let r;"string"==typeof e||"function"==typeof e?r=e:e&&(t=e,r=e.type),t||(t={});const a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,i):void 0;if(!r&&a&&(r=a),!t.type&&r&&(t.type=r),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),"function"==typeof e)po().embeddeds.push({target:n.constructor,propertyName:i,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new mo.N(n,i);!0===t.unique&&po().uniques.push({target:n.constructor,columns:[i]}),po().columns.push({target:n.constructor,propertyName:i,mode:"regular",options:t}),t.generated&&po().generations.push({target:n.constructor,propertyName:i,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}var yo=n(52806);function go(e,t){return function(n,i){let r;"string"==typeof e||e===String||e===Boolean||e===Number?r=e:t=Object.assign({},e),t||(t={});const a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,i):void 0;if(!r&&a&&(r=a),!t.type&&r&&(t.type=r),!t.type)throw new mo.N(n,i);if(t.nullable)throw new yo.k(n,i);t.primary=!0,po().columns.push({target:n.constructor,propertyName:i,mode:"regular",options:t}),t.generated&&po().generations.push({target:n.constructor,propertyName:i,strategy:"string"==typeof t.generated?t.generated:"increment"})}}function bo(e,t){const n=(Rr.B.isObject(e)?e:t)||{},i="string"==typeof e?e:n.name;return function(e){po().tables.push({target:e,name:i,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize,withoutRowid:n.withoutRowid})}}function wo(e,t,n){const i="string"==typeof e?e:void 0,r="string"==typeof e?t:e;let a=Rr.B.isObject(e)&&!Array.isArray(e)?e:n;return a||(a=Rr.B.isObject(t)&&!Array.isArray(t)?t:n),function(e,t){po().indices.push({target:t?e.constructor:e,name:i,columns:t?[t]:r,synchronize:!a||!1!==a.synchronize,where:a?a.where:void 0,unique:!(!a||!a.unique),spatial:!(!a||!a.spatial),fulltext:!(!a||!a.fulltext),nullFiltered:!(!a||!a.nullFiltered),parser:a?a.parser:void 0,sparse:!(!a||!a.sparse),background:!(!a||!a.background),expireAfterSeconds:a?a.expireAfterSeconds:void 0})}}Sa.q;n(50504),n(7109),n(98947),n(61035),n(29225);var _o,vo=n(62392);vo.A;!function(e){e.MNEMONIC="mnemonic",e.PRIME="prime",e.PRIVATE_KEY="private_key",e.WALLET_LINK="wallet_link",e.LEDGER="ledger",e.TREZOR="trezor",e.DAPP_PROVIDER="dapp_provider",e.SCW="smart_contract_wallet"}(_o||(_o={}));_o.MNEMONIC,_o.PRIVATE_KEY,_o.WALLET_LINK,_o.LEDGER,_o.TREZOR,_o.DAPP_PROVIDER,_o.SCW,_o.PRIME,_o.LEDGER,_o.TREZOR,_o.PRIVATE_KEY,_o.SCW,_o.MNEMONIC,_o.PRIME,_o.PRIVATE_KEY,_o.LEDGER,_o.TREZOR,_o.DAPP_PROVIDER,_o.MNEMONIC,_o.PRIVATE_KEY,_o.MNEMONIC,_o.DAPP_PROVIDER,_o.MNEMONIC;var Eo,To,No=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Ao=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let So=class{};No([go("varchar"),Ao("design:type",String)],So.prototype,"id",void 0),No([fo("datetime"),Ao("design:type","function"==typeof(Eo="undefined"!=typeof Date&&Date)?Eo:Object)],So.prototype,"createdAt",void 0),No([fo("varchar"),Ao("design:type","function"==typeof(To=void 0!==_o&&_o)?To:Object)],So.prototype,"type",void 0),No([fo("varchar",{nullable:!0}),Ao("design:type",Object)],So.prototype,"primaryAddressChain",void 0),No([fo("varchar",{nullable:!0}),Ao("design:type",String)],So.prototype,"primaryAddress",void 0),No([fo(),Ao("design:type",String)],So.prototype,"nickname",void 0),No([fo({nullable:!0,default:!1}),Ao("design:type",Boolean)],So.prototype,"isDeleted",void 0),No([fo("boolean",{default:!0}),Ao("design:type",Boolean)],So.prototype,"hasCompletedBackupFlow",void 0),No([fo("varchar",{nullable:!0}),Ao("design:type",String)],So.prototype,"provider",void 0),No([fo("varchar",{nullable:!0}),Ao("design:type",String)],So.prototype,"dappProviderUserId",void 0),So=No([bo("account"),wo("IDX_ACCOUNT",["type","primaryAddress","primaryAddressChain"]),wo("IDX_ACCOUNT_CreatedAt",["createdAt"])],So);n(1048).Buffer;var xo=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Co=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Mo=class{};xo([go("varchar"),Co("design:type",String)],Mo.prototype,"id",void 0),xo([fo("varchar"),Co("design:type",String)],Mo.prototype,"name",void 0),xo([fo({name:"decimalsStr",type:"varchar"}),Co("design:type",String)],Mo.prototype,"decimalsStr",void 0),xo([fo("varchar"),Co("design:type",String)],Mo.prototype,"contractAddress",void 0),xo([fo({name:"chainIdStr",type:"varchar"}),Co("design:type",String)],Mo.prototype,"chainIdStr",void 0),xo([fo({name:"currencyCodeStr",type:"varchar"}),Co("design:type",String)],Mo.prototype,"currencyCodeStr",void 0),xo([fo({name:"blockchainStr",type:"varchar"}),Co("design:type",String)],Mo.prototype,"blockchainStr",void 0),xo([fo({name:"imageURLStr",type:"varchar",nullable:!0}),Co("design:type",String)],Mo.prototype,"imageURLStr",void 0),xo([fo({name:"lastUpdated",nullable:!0}),Co("design:type",Number)],Mo.prototype,"lastUpdated",void 0),Mo=xo([bo("erc20"),wo("IDX_ERC20_ADDR_CHAIN",["contractAddress","chainIdStr"],{unique:!0})],Mo);var Ro;!function(e){e[e.PENDING=1]="PENDING",e[e.FAILED=2]="FAILED",e[e.CONFIRMED=3]="CONFIRMED",e[e.DROPPED=4]="DROPPED",e[e.DROPPED_BY_RELAYER=5]="DROPPED_BY_RELAYER",e[e.REPLACED=6]="REPLACED"}(Ro||(Ro={}));var ko=n(1048).Buffer;const Oo={from:function(e){const t=e?e.split(",").map(Number):[];return ko.from(new Uint8Array(t))},to:e=>e?.toString()},Io={from:e=>e?$(e):[],to:e=>q(e)};n(1048).Buffer;var Po,Do,Lo=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},qo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $o=class{};Lo([go(),qo("design:type",String)],$o.prototype,"id",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"fromAddress",void 0),Lo([fo({nullable:!0}),qo("design:type",String)],$o.prototype,"toAddress",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"nonce",void 0),Lo([fo({type:"int"}),qo("design:type",Number)],$o.prototype,"chainId",void 0),Lo([fo({type:"varchar",transformer:Oo}),qo("design:type","function"==typeof(Po="undefined"!=typeof Uint8Array&&Uint8Array)?Po:Object)],$o.prototype,"signedTxData",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"txHash",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"weiValue",void 0),Lo([fo({nullable:!0}),qo("design:type",String)],$o.prototype,"erc20Value",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"blockchainStr",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"currencyCodeStr",void 0),Lo([fo({type:"int"}),qo("design:type","function"==typeof(Do=void 0!==Ro&&Ro)?Do:Object)],$o.prototype,"state",void 0),Lo([fo(),qo("design:type",String)],$o.prototype,"notFoundCount",void 0),$o=Lo([bo("ethereum_signed_tx"),wo("IDX_ETH_STATE_CHAIN",["state","chainId"]),wo("IDX_ETH_STATE_CHAIN_FROM",["state","chainId","fromAddress"]),wo("IDX_ETH_CHAIN_FROM_NONCE",["chainId","fromAddress","nonce"]),wo("IDX_ETH_CHAIN_NONCE_FROM_CURR_STATE",["chainId","nonce","fromAddress","currencyCodeStr","state"]),wo("IDX_ETH_CHAIN_NONCE_FROM_TO_STATE",["chainId","nonce","fromAddress","toAddress","state"]),wo("IDX_TXHASH",["txHash"])],$o);n(1048).Buffer;var jo,Bo,Uo=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Vo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Fo=class{};Uo([go(),Vo("design:type",String)],Fo.prototype,"id",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"fromAddress",void 0),Uo([fo({nullable:!0}),Vo("design:type",String)],Fo.prototype,"toAddress",void 0),Uo([fo({type:"int"}),Vo("design:type",Number)],Fo.prototype,"chainId",void 0),Uo([fo({type:"varchar",transformer:Oo}),Vo("design:type","function"==typeof(jo="undefined"!=typeof Uint8Array&&Uint8Array)?jo:Object)],Fo.prototype,"signedTxData",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"txHash",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"transferValue",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"blockchainStr",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"currencyCodeStr",void 0),Uo([fo({type:"int"}),Vo("design:type","function"==typeof(Bo=void 0!==Ro&&Ro)?Bo:Object)],Fo.prototype,"state",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"recentBlockHash",void 0),Uo([fo({default:0}),Vo("design:type",Number)],Fo.prototype,"lastValidBlockHeight",void 0),Uo([fo(),Vo("design:type",String)],Fo.prototype,"notFoundCount",void 0),Fo=Uo([bo("solana_signed_tx"),wo("IDX_SOL_STATE_CHAIN",["state","chainId"]),wo("IDX_SOL_HASH_CHAIN",["txHash","chainId"]),wo("IDX_SOL_HASH_CHAIN_ADDR",["txHash","chainId","fromAddress"]),wo("IDX_SOL_CHAIN_RECENT_ADDR",["chainId","recentBlockHash","fromAddress"]),wo("IDX_SOL_CHAIN_RECENT_ADDR_CURR_STATE",["chainId","recentBlockHash","fromAddress","currencyCodeStr","state"]),wo("IDX_SOL_CHAIN_RECENT_ADDR_TO_STATE",["chainId","recentBlockHash","fromAddress","toAddress","state"])],Fo);var Ko=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Wo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ho=class{};Ko([go(),Wo("design:type",String)],Ho.prototype,"id",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"name",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"decimalsStr",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"mintAddress",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"chainIdStr",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"currencyCodeStr",void 0),Ko([fo(),Wo("design:type",String)],Ho.prototype,"blockchainStr",void 0),Ko([fo({nullable:!0}),Wo("design:type",String)],Ho.prototype,"imageURLStr",void 0),Ho=Ko([bo("spl"),wo("IDX_SPL_CHAIN",["chainIdStr"]),wo("IDX_SPL_ADDR_CHAIN",["mintAddress","chainIdStr"])],Ho);n(1048).Buffer;var Qo,zo,Go=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Yo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Jo=class{};Go([go(),Yo("design:type",String)],Jo.prototype,"id",void 0),Go([fo({type:"varchar",transformer:Oo}),Yo("design:type","function"==typeof(Qo="undefined"!=typeof Uint8Array&&Uint8Array)?Qo:Object)],Jo.prototype,"signedTransactionData",void 0),Go([fo(),Yo("design:type",String)],Jo.prototype,"txHash",void 0),Go([fo(),Yo("design:type",String)],Jo.prototype,"networkStr",void 0),Go([fo(),Yo("design:type",String)],Jo.prototype,"currencyCodeStr",void 0),Go([fo(),Yo("design:type",String)],Jo.prototype,"blockchainStr",void 0),Go([fo({type:"int"}),Yo("design:type","function"==typeof(zo=void 0!==Ro&&Ro)?zo:Object)],Jo.prototype,"state",void 0),Go([fo(),Yo("design:type",String)],Jo.prototype,"notFoundCount",void 0),Jo=Go([bo("utxo_signed_tx"),wo("IDX_UTXO_BLOCKCHAIN_CURRENCY_NETWORK_STATE",["blockchainStr","currencyCodeStr","networkStr","state"])],Jo);var Xo=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Zo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ec=class{};Xo([go(),Zo("design:type",String)],ec.prototype,"id",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"indexStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"address",void 0),Xo([fo({nullable:!0}),Zo("design:type",String)],ec.prototype,"balanceStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"currencyCodeStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"isChangeAddressStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"networkStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"typeStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"derivationPath",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"isUsedStr",void 0),Xo([fo(),Zo("design:type",String)],ec.prototype,"blockchainStr",void 0),Xo([fo({nullable:!0}),Zo("design:type",String)],ec.prototype,"contractAddress",void 0),Xo([fo({nullable:!0}),Zo("design:type",String)],ec.prototype,"accountId",void 0),Xo([fo({nullable:!0,default:!1}),Zo("design:type",Boolean)],ec.prototype,"isDeleted",void 0),ec=Xo([bo("address"),wo("IDX_ADDRESS_ADDRESS",["address"]),wo("IDX_ADDRESS_USEDSTR",["isUsedStr"]),wo("IDX_ADDRESS_BLOCKCHAIN",["blockchainStr"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURRENCY_NETWORK_ACCOUNTID",["blockchainStr","currencyCodeStr","networkStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_NETWORK_ACCOUNTID",["blockchainStr","networkStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURRENCY_NETWORK",["blockchainStr","currencyCodeStr","networkStr"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURRENCY_NETWORK_TYPE",["blockchainStr","currencyCodeStr","networkStr","typeStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURRENCY_NETWORK_BALANCE",["blockchainStr","currencyCodeStr","networkStr","balanceStr"]),wo("IDX_ADDRESS_BLOCKCHAIN_NETWORK",["blockchainStr","networkStr"]),wo("IDX_ADDRESS_BLOCKCHAIN_ADDRESS_NETWORK",["blockchainStr","address","networkStr"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURR_ADDRESS_NETWORK_ACCOUNTID",["blockchainStr","currencyCodeStr","address","networkStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURR_NETWORK_USED_ACCOUNTID",["blockchainStr","currencyCodeStr","networkStr","isUsedStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURR_NETWORK_TYPE_CHANGED_USED_ACCOUNTID",["blockchainStr","currencyCodeStr","networkStr","typeStr","isChangeAddressStr","isUsedStr","accountId"]),wo("IDX_ADDRESS_BLOCKCHAIN_CURR_NETWORK_TYPE_CHANGED_INDEX_ACCOUNTID",["blockchainStr","currencyCodeStr","networkStr","typeStr","isChangeAddressStr","indexStr","accountId"])],ec);var tc,nc;!function(e){e[e.userSpam=0]="userSpam",e[e.userSpamVisible=1]="userSpamVisible",e[e.userVisible=2]="userVisible",e[e.userHidden=3]="userHidden",e[e.spam=100]="spam",e[e.whitelist=101]="whitelist"}(tc||(tc={})),function(e){e[e.wallet=0]="wallet",e[e.collectible=1]="collectible"}(nc||(nc={}));var ic,rc,ac=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},sc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oc=class{};ac([go(),sc("design:type",String)],oc.prototype,"id",void 0),ac([fo(),sc("design:type",String)],oc.prototype,"blockchainStr",void 0),ac([fo(),sc("design:type",String)],oc.prototype,"currencyCodeStr",void 0),ac([fo(),sc("design:type",String)],oc.prototype,"networkStr",void 0),ac([fo({type:"int"}),sc("design:type","function"==typeof(ic=void 0!==tc&&tc)?ic:Object)],oc.prototype,"status",void 0),ac([fo({type:"int"}),sc("design:type","function"==typeof(rc=void 0!==nc&&nc)?rc:Object)],oc.prototype,"type",void 0),ac([fo({nullable:!0}),sc("design:type",String)],oc.prototype,"contractAddress",void 0),oc=ac([bo("curated_asset_setting"),wo("IDX_CURATED_ASSET_SETTINGS",["currencyCodeStr","contractAddress","blockchainStr","networkStr"])],oc);var cc,lc=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},uc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let dc=class{};lc([go(),uc("design:type",String)],dc.prototype,"id",void 0),lc([fo(),uc("design:type",String)],dc.prototype,"blockchainStr",void 0),lc([fo({type:"int"}),uc("design:type","function"==typeof(cc=void 0!==tc&&tc)?cc:Object)],dc.prototype,"status",void 0),lc([fo(),uc("design:type",String)],dc.prototype,"networkStr",void 0),lc([fo(),uc("design:type",String)],dc.prototype,"contractAddress",void 0),lc([fo(),uc("design:type",String)],dc.prototype,"primaryAddress",void 0),lc([fo({nullable:!0}),uc("design:type",String)],dc.prototype,"tokenId",void 0),dc=lc([bo("user_collectible_setting"),wo("IDX_USER_COLLECTIBLE_SETTING",["primaryAddress","contractAddress","blockchainStr","networkStr","tokenId"])],dc);var hc,pc=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},mc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fc=class{};pc([go(),mc("design:type",String)],fc.prototype,"id",void 0),pc([fo(),mc("design:type",String)],fc.prototype,"blockchainStr",void 0),pc([fo(),mc("design:type",String)],fc.prototype,"currencyCodeStr",void 0),pc([fo(),mc("design:type",String)],fc.prototype,"networkStr",void 0),pc([fo({type:"int"}),mc("design:type","function"==typeof(hc=void 0!==tc&&tc)?hc:Object)],fc.prototype,"status",void 0),pc([fo({nullable:!0}),mc("design:type",String)],fc.prototype,"contractAddress",void 0),pc([fo(),mc("design:type",String)],fc.prototype,"primaryAddress",void 0),fc=pc([bo("user_wallet_setting"),wo("IDX_PRIMARY_CURRENCY_CONTRACT_BLOCKCHAIN_NETWORK",["primaryAddress","currencyCodeStr","contractAddress","blockchainStr","networkStr"])],fc);var yc,gc,bc=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},wc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _c=class{};bc([go(),wc("design:type",String)],_c.prototype,"id",void 0),bc([fo(),wc("design:type",String)],_c.prototype,"txHash",void 0),bc([fo(),wc("design:type",String)],_c.prototype,"networkStr",void 0),bc([fo(),wc("design:type",String)],_c.prototype,"blockchainStr",void 0),bc([fo(),wc("design:type",String)],_c.prototype,"accountId",void 0),bc([fo(),wc("design:type",String)],_c.prototype,"walletIndexStr",void 0),bc([fo({type:"datetime"}),wc("design:type","function"==typeof(yc="undefined"!=typeof Date&&Date)?yc:Object)],_c.prototype,"createdAt",void 0),bc([fo({type:"datetime"}),wc("design:type","function"==typeof(gc="undefined"!=typeof Date&&Date)?gc:Object)],_c.prototype,"updatedAt",void 0),_c=bc([bo("last_synced_tx_hash"),wo("IDX_BLOCKCHAIN_NETWORK_ACCOUNTID_WALLETINDEX",["blockchainStr","networkStr","accountId","walletIndexStr"],{unique:!0}),wo("IDX_BLOCKCHAIN_ACCOUNTID_WALLETINDEX",["blockchainStr","accountId","walletIndexStr"])],_c);var vc,Ec=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Tc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Nc=class{};Ec([go("varchar"),Tc("design:type",String)],Nc.prototype,"id",void 0),Ec([fo("datetime"),Tc("design:type","function"==typeof(vc="undefined"!=typeof Date&&Date)?vc:Object)],Nc.prototype,"createdAt",void 0),Ec([fo("varchar"),Tc("design:type",String)],Nc.prototype,"value",void 0),Nc=Ec([bo("secrets")],Nc);var Ac=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Sc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xc=class{};Ac([go(),Sc("design:type",String)],xc.prototype,"id",void 0),Ac([fo(),Sc("design:type",String)],xc.prototype,"blockchainStr",void 0),Ac([fo(),Sc("design:type",String)],xc.prototype,"currencyCodeStr",void 0),Ac([fo({nullable:!0}),Sc("design:type",String)],xc.prototype,"contractAddressStr",void 0),Ac([fo(),Sc("design:type",String)],xc.prototype,"chainIdStr",void 0),Ac([fo(),Sc("design:type",String)],xc.prototype,"selectedCountStr",void 0),xc=Ac([bo("swap_asset_stats"),wo("IDX_SWAP_STATS_ID",["id"]),wo("IDX_SWAP_STATS_BLOCKCHAIN_CURRENCY_CHAIN_CONTRACT",["blockchainStr","currencyCodeStr","chainIdStr","contractAddressStr"])],xc);var Cc;!function(e){e.string="string",e.bigint="bigint",e.boolean="boolean",e.number="number"}(Cc||(Cc={}));class Mc{constructor(e,t){this.keyName=e,this.kind=t}get rawValue(){return[this.keyName,this.kind].join("/")}static create(e){const t=e.split("/",2);if(2!==t.length||!(t[1]in Cc))throw new Error(`Invalid TxOrUserOpMetadataKey: ${e}`);return new Mc(t[0],Cc[t[1]])}}new Mc("consumerTxID",Cc.string),new Mc("inputCount",Cc.bigint),new Mc("outputCount",Cc.bigint),new Mc("sponsoredUuid",Cc.string),new Mc("hasRecordedConfirmEvent",Cc.boolean),new Mc("gaslessSwapHash",Cc.string),new Mc("isGasless",Cc.boolean),new Mc("isSponsored",Cc.boolean),new Mc("isRealTimeSwap",Cc.boolean),new Mc("isCBStake",Cc.boolean),new Mc("cashoutIdem",Cc.string),new Mc("sponsoredCashoutUuid",Cc.string),new Mc("cashoutWithdrawalType",Cc.string),new Mc("assetType",Cc.string),new Mc("toTokenImage",Cc.string),new Mc("toTokenName",Cc.string),new Mc("toTokenDecimal",Cc.string),new Mc("toTokenCurrencyCode",Cc.string),new Mc("toTokenAmount",Cc.string),new Mc("isReceiveTronTx",Cc.boolean),new Mc("tronTxStatus",Cc.string),new Mc("tronFromAddress",Cc.string),new Mc("tronReceiptLink",Cc.string),new Mc("tronTransactionHash",Cc.string),new Mc("tronDestinationTransactionHash",Cc.string),new Mc("tronTxProviderKycLink",Cc.string),new Mc("isVANReceiveTx",Cc.boolean),new Mc("vanTxStatus",Cc.string),new Mc("vanReceiptLink",Cc.string),new Mc("vanOriginAmount",Cc.string),new Mc("vanOriginCurrency",Cc.string),new Mc("vanSenderName",Cc.string),new Mc("vanProviderName",Cc.string),new Mc("usdcRewardTxProgramName",Cc.string),new Mc("primeActivityId",Cc.string),new Mc("primeSignedTxnHash",Cc.string),new Mc("primeConsensusMet",Cc.boolean),new Mc("primeApprovalDeadline",Cc.string),new Mc("isFromPrimeActivity",Cc.boolean),new Mc("originalIdemKey",Cc.string),new Mc("dappUrl",Cc.string),new Mc("primeApprovalsCount",Cc.number),new Mc("primeApprovalsRequired",Cc.number),new Mc("primeApproversJson",Cc.string),new Mc("primeIsSigned",Cc.boolean),new Mc("primeSignedBy",Cc.string),new Mc("primeSignedAt",Cc.string);const Rc=new di(h),kc=new pi("Ethereum"),Oc=function(){const e=new Si("Ethereum",Ic(ht.whitelisted.ETHEREUM_MAINNET)),t=[];for(const e of Object.values(ht.whitelisted))isNaN(e?.chainId)||t.push(ht.fromChainId(BigInt(e.chainId)));const n=[e],i=[];return t.filter((e=>e.chainId!==ht.whitelisted.ETHEREUM_MAINNET.chainId)).map((e=>function(e){return new Si(e.displayName,Ic(e))}(e))).sort((function(e,t){const n=e.name.toLowerCase(),i=t.name.toLowerCase();return n<i?-1:n>i?1:0})).forEach((function(e){const t=new Si(e.name,e.network);e.network.isTestnet?i.push(t):n.push(t)})),new xi(Rc,e,n,i)}();new class extends li{constructor({blockchain:e,networkSetting:t,refreshInterval:n,currencyCode:i,decimals:r,imageURL:a,defaultReceiveType:s,supportsMultiWallet:o,isSyncingRequired:c,isERC20Supported:l}){super({blockchain:e,networkSetting:t,refreshInterval:n,currencyCode:i,decimals:r,imageURL:a,defaultReceiveType:s,supportsMultiWallet:o,isSyncingRequired:c}),Object.assign(this,{isERC20Supported:l})}displayName(e){const t=e.asChain();return t?t.baseAssetDisplayName:"Unknown"}imageURLForNetwork(e){const t=e.asChain();return t?.baseAssetImageUrl}currencyCodeForNetwork(e){const t=e.asChain();return t?new hi(t.baseAssetCurrencyCode??this.currencyCode.code):this.currencyCode}feeDecimalForNetwork(e){const t=e.asChain();return t?BigInt(t.baseAssetDecimal):this.decimals}}({blockchain:Rc,networkSetting:Oc,refreshInterval:30n,currencyCode:hi.ETH,decimals:18n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/eth_288.png",defaultReceiveType:kc,supportsMultiWallet:!0,isSyncingRequired:!1,isERC20Supported:!0});function Ic(e){return new Ti(`${d}:${e.chainId}`,e.isTestnet)}ht.whitelisted.ETHEREUM_MAINNET;new L("hardhatNetwork"),new Mc("txSource",Cc.string),new Mc("approvalKey",Cc.string),new Mc("sendNFTId",Cc.string),new Mc("analyticsId",Cc.string),new Mc("contactRecordID",Cc.string);new Map(Oc.allNetworks.map((e=>{const t=e.network.asChain(),n=t.chainId.toString();let i=`${J}/rpc/v2/getMainnetGasPrices`;parseInt(n,10)!==ht.whitelisted.ETHEREUM_MAINNET.chainId&&(i="");return[n,{name:t.displayName,rpcUrl:t.rpcUrl,gasStationUrl:i}]})));n(39216);const Pc=new pi(mi),Dc=new di(fi),Lc=function(){const e=new Si("Solana",vi(wi.whitelisted.SOLANA_MAINNET)),t=[];for(const e of Object.values(wi.whitelisted))isNaN(e.chainId)||t.push(wi.fromChainId(BigInt(e.chainId)));const n=[e],i=[];return t.filter((e=>e.chainId!==wi.whitelisted.SOLANA_MAINNET.chainId)).map((e=>new Si(e.displayName,vi(e)))).sort(((e,t)=>e.name.localeCompare(t.name,"en-US"))).forEach((e=>{const t=new Si(e.name,e.network);e.network.isTestnet?i.push(t):n.push(t)})),new xi(Dc,e,n,i)}();new class extends li{displayName(){return mi}imageURLForNetwork(){return yi}currencyCodeForNetwork(){return this.currencyCode}feeDecimalForNetwork(){return this.decimals}}({blockchain:Dc,networkSetting:Lc,refreshInterval:30n,currencyCode:hi.SOL,decimals:9n,imageURL:yi,defaultReceiveType:Pc,supportsMultiWallet:!0,isSyncingRequired:!1});new Mc("solanaSwapStep",Cc.string),new L("storedBlockchainDeprecationStatus");const qc=[h,fi],$c=[Ci,Di,ji];new Map([[h,!0],[fi,!0]]),new Map([[Ci,!1],[Di,!1],[ji,!1]]);const jc=v()((function(e){return new Bc(new Map(e.map((function(e){const t=e.split("//",2),n=Mc.create(t[0]),i=t[1];let r;switch(n.kind){case Cc.string:r=i;break;case Cc.bigint:r=BigInt(i);break;case Cc.boolean:r=JSON.parse(i);break;case Cc.number:r=parseInt(i,10);break;default:throw new Error(`Invalid TxOrUserOpMetadataKey.kind: ${n.kind}`)}return[n,r]}))))}),(function(e){return e.sort().join(",")}));class Bc{constructor(e=new Map){this.metadataMap=new Map(Array.from(e.entries()).map((([e,t])=>[e.rawValue,t])))}get(e){return this.metadataMap.get(e.rawValue)}has(e){return this.metadataMap.has(e.rawValue)}get rawValue(){return Array.from(this.metadataMap.entries()).map((([e,t])=>[e,t.toString()].join("//")))}get rawMap(){return this.metadataMap}static isEqual(e,t){const n=e.rawMap,i=t.rawMap;return n.size===i.size&&Array.from(n.entries()).every((([e,t])=>"bigint"==typeof t?t===i.get(e):i.get(e)===t))}static create(e){return jc(e)}toMutableMap(){return new Map(Array.from(this.metadataMap.entries()).map((([e,t])=>[Mc.create(e),t])))}mergeMetadata(e){const t=new Map(this.toMutableMap());for(const[n,i]of e.toMutableMap().entries())t.set(n,i);return new Bc(t)}}var Uc;!function(e){e.SEND="send",e.SWAP="swap",e.CASHOUT="cashout"}(Uc||(Uc={}));var Vc,Fc,Kc,Wc,Hc=n(1048).Buffer,Qc=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},zc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};v()((function(e){return e?$(e):void 0}));let Gc=class{};Qc([go(),zc("design:type",String)],Gc.prototype,"id",void 0),Qc([fo({type:"datetime"}),zc("design:type","function"==typeof(Vc="undefined"!=typeof Date&&Date)?Vc:Object)],Gc.prototype,"createdAt",void 0),Qc([fo({type:"datetime",nullable:!0}),zc("design:type","function"==typeof(Fc="undefined"!=typeof Date&&Date)?Fc:Object)],Gc.prototype,"confirmedAt",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"blockchainStr",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"currencyCodeStr",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"feeCurrencyCodeStr",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"feeCurrencyDecimal",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toAddress",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toDomain",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromAddress",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromDomain",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"amount",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromAmount",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toAmount",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"fee",void 0),Qc([fo({type:"int"}),zc("design:type","function"==typeof(Kc=void 0!==Ro&&Ro)?Kc:Object)],Gc.prototype,"state",void 0),Qc([fo({type:"varchar",transformer:Io}),zc("design:type",Array)],Gc.prototype,"metadataStrArray",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"networkStr",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"accountId",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"walletIndex",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"txOrUserOpHash",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"userOpHash",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"txHash",void 0),Qc([fo(),zc("design:type",Boolean)],Gc.prototype,"isSent",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"contractAddress",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"tokenName",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"tokenDecimal",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"nonce",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"gasLimit",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"maxFeePerGas",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"maxPriorityFeePerGas",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"baseFeePerGas",void 0),Qc([fo({type:"varchar",nullable:!0}),zc("design:type",Object)],Gc.prototype,"txSubmissionType",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"lowerBoundValue",void 0),Qc([fo({type:"varchar",transformer:Oo,nullable:!0}),zc("design:type","function"==typeof(Wc=void 0!==Hc&&Hc)?Wc:Object)],Gc.prototype,"data",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"type",void 0),Qc([fo({type:"varchar",nullable:!0}),zc("design:type",String)],Gc.prototype,"primaryAction",void 0),Qc([fo({type:"varchar",nullable:!0}),zc("design:type",String)],Gc.prototype,"transfersStr",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toAssetHistoricalPrice",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromAssetHistoricalPrice",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"nativeAssetHistoricalPrice",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromAssetImage",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toAssetImage",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromProfileImage",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toProfileImage",void 0),Qc([fo({nullable:!0}),zc("design:type",Boolean)],Gc.prototype,"isContractExecution",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toNetwork",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toCurrencyCode",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toContractAddress",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toTokenName",void 0),Qc([fo({type:"varchar",nullable:!0}),zc("design:type",String)],Gc.prototype,"source",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toTokenDecimal",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"protocolFeeAmount",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"coinbaseFeeAmount",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"coinbaseFeeDecimal",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"coinbaseFeeAssetAddress",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"coinbaseFeeCurrencyCode",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"coinbaseFeeName",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"protocolFeeDecimal",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"protocolFeeCurrencyCode",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"protocolFeeName",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"fromTokenId",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toTokenId",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"toWalletId",void 0),Qc([fo(),zc("design:type",String)],Gc.prototype,"walletId",void 0),Qc([fo({nullable:!0}),zc("design:type",String)],Gc.prototype,"l1GasFee",void 0),Qc([fo({nullable:!0,type:"varchar",transformer:Io}),zc("design:type",Array)],Gc.prototype,"utxos",void 0),Qc([fo({default:!1}),zc("design:type",Boolean)],Gc.prototype,"deleted",void 0),Qc([fo({nullable:!0}),zc("design:type",Boolean)],Gc.prototype,"isSpam",void 0),Gc=Qc([bo("tx_or_userop_history"),wo("IDX_txOrUserOpHash_ACCOUNTID_WALLETINDEX_UNIQUE",["txOrUserOpHash","accountId","walletIndex"],{unique:!0}),wo("IDX_TXUSEROP_BLOCK_CURR_NETWORK_2",["blockchainStr","currencyCodeStr","networkStr"]),wo("IDX_TXUSEROP_CURR_NETWORK_2",["currencyCodeStr","networkStr"]),wo("IDX_TXUSEROP_TX_HASH_2",["txHash"]),wo("IDX_TXUSEROP_TX_HASH_WALLET_2",["txHash","walletId"]),wo("IDX_TXUSEROP_ITEM_HASH",["txOrUserOpHash"]),wo("IDX_TXUSEROP_BLOCK_CURR_NETWORK_ADDR_2",["blockchainStr","currencyCodeStr","networkStr","fromAddress"]),wo("IDX_TXUSEROP_WALLETID_ACCOUNTID",["txOrUserOpHash","walletId","accountId"]),wo("IDX_TXUSEROP_CREATED_AT_2",["createdAt"]),wo("IDX_TXUSEROP_SOFT_DELETED",["deleted"]),wo("IDX_TXUSEROP_WALLETID",["walletId"])],Gc);n(22563);var Yc,Jc=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},Xc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Zc=class{};Jc([go(),Xc("design:type",String)],Zc.prototype,"id",void 0),Jc([fo("datetime"),Xc("design:type","function"==typeof(Yc="undefined"!=typeof Date&&Date)?Yc:Object)],Zc.prototype,"createdAt",void 0),Jc([fo(),Xc("design:type",String)],Zc.prototype,"accountId",void 0),Jc([fo(),Xc("design:type",String)],Zc.prototype,"walletIndex",void 0),Jc([fo({nullable:!0}),Xc("design:type",String)],Zc.prototype,"hardwareDerivationPath",void 0),Jc([fo(),Xc("design:type",String)],Zc.prototype,"nickname",void 0),Jc([fo(),Xc("design:type",Boolean)],Zc.prototype,"isHidden",void 0),Jc([fo({nullable:!0}),Xc("design:type",String)],Zc.prototype,"themeColor",void 0),Jc([fo({nullable:!0}),Xc("design:type",Number)],Zc.prototype,"avatarIndex",void 0),Jc([fo({nullable:!0}),Xc("design:type",String)],Zc.prototype,"walletAddress",void 0),Zc=Jc([bo("wallet_group"),wo("IDX_WALLET_GROUP",["accountId","walletIndex","hardwareDerivationPath","isHidden"]),wo("IDX_WALLET_GROUP_CreatedAt",["createdAt"]),wo("IDX_WALLET_GROUP_Theme",["themeColor"])],Zc);n(59092),n(84213),n(82823),n(89029);var el=n(43144),tl=n(39907);var nl=function(e){const t=new Error(e);if(void 0===t.stack)try{throw t}catch(e){}return t},il=nl;var rl=function(e){return!!e&&"function"==typeof e.then};var al=function(e,t){if(null!=e)return e;throw il(null!=t?t:"Got unexpected null or undefined")};function sl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ol{getValue(){throw il("BaseLoadable")}toPromise(){throw il("BaseLoadable")}valueMaybe(){throw il("BaseLoadable")}valueOrThrow(){throw il(`Loadable expected value, but in "${this.state}" state`)}promiseMaybe(){throw il("BaseLoadable")}promiseOrThrow(){throw il(`Loadable expected promise, but in "${this.state}" state`)}errorMaybe(){throw il("BaseLoadable")}errorOrThrow(){throw il(`Loadable expected error, but in "${this.state}" state`)}is(e){return e.state===this.state&&e.contents===this.contents}map(e){throw il("BaseLoadable")}}class cl extends ol{constructor(e){super(),sl(this,"state","hasValue"),sl(this,"contents",void 0),this.contents=e}getValue(){return this.contents}toPromise(){return Promise.resolve(this.contents)}valueMaybe(){return this.contents}valueOrThrow(){return this.contents}promiseMaybe(){}errorMaybe(){}map(e){try{const t=e(this.contents);return rl(t)?pl(t):yl(t)?t:dl(t)}catch(t){return rl(t)?pl(t.next((()=>this.map(e)))):hl(t)}}}class ll extends ol{constructor(e){super(),sl(this,"state","hasError"),sl(this,"contents",void 0),this.contents=e}getValue(){throw this.contents}toPromise(){return Promise.reject(this.contents)}valueMaybe(){}promiseMaybe(){}errorMaybe(){return this.contents}errorOrThrow(){return this.contents}map(e){return this}}class ul extends ol{constructor(e){super(),sl(this,"state","loading"),sl(this,"contents",void 0),this.contents=e}getValue(){throw this.contents}toPromise(){return this.contents}valueMaybe(){}promiseMaybe(){return this.contents}promiseOrThrow(){return this.contents}errorMaybe(){}map(e){return pl(this.contents.then((t=>{const n=e(t);if(yl(n)){const e=n;switch(e.state){case"hasValue":case"loading":return e.contents;case"hasError":throw e.contents}}return n})).catch((t=>{if(rl(t))return t.then((()=>this.map(e).contents));throw t})))}}function dl(e){return Object.freeze(new cl(e))}function hl(e){return Object.freeze(new ll(e))}function pl(e){return Object.freeze(new ul(e))}function ml(){return Object.freeze(new ul(new Promise((()=>{}))))}function fl(e){const t=function(e){return e.every((e=>"hasValue"===e.state))?dl(e.map((e=>e.contents))):e.some((e=>"hasError"===e.state))?hl(al(e.find((e=>"hasError"===e.state)),"Invalid loadable passed to loadableAll").contents):pl(Promise.all(e.map((e=>e.contents))))}((Array.isArray(e)?e:Object.getOwnPropertyNames(e).map((t=>e[t]))).map((e=>yl(e)?e:rl(e)?pl(e):dl(e))));return Array.isArray(e)?t:t.map((t=>Object.getOwnPropertyNames(e).reduce(((e,n,i)=>({...e,[n]:t[i]})),{})))}function yl(e){return e instanceof ol}const gl={of:e=>rl(e)?pl(e):yl(e)?e:dl(e),error:e=>hl(e),loading:()=>ml(),all:fl,isLoadable:yl};var bl={loadableWithValue:dl,loadableWithError:hl,loadableWithPromise:pl,loadableLoading:ml,loadableAll:fl,isLoadable:yl,RecoilLoadable:gl},wl=bl.loadableWithValue,_l=bl.loadableWithError,vl=bl.loadableWithPromise,El=bl.loadableLoading,Tl=bl.loadableAll,Nl=bl.isLoadable,Al=bl.RecoilLoadable,Sl=Object.freeze({__proto__:null,loadableWithValue:wl,loadableWithError:_l,loadableWithPromise:vl,loadableLoading:El,loadableAll:Tl,isLoadable:Nl,RecoilLoadable:Al});const xl={RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED:!0,RECOIL_GKS_ENABLED:new Set(["recoil_hamt_2020","recoil_sync_external_store","recoil_suppress_rerender_in_callback","recoil_memory_managament_2020"])};void 0!==tl&&null!=(null==tl?void 0:"MISSING_ENV_VAR")&&(function(e,t){var n,i;const r=null===(n="MISSING_ENV_VAR"[e])||void 0===n||null===(i=n.toLowerCase())||void 0===i?void 0:i.trim();if(null!=r&&""!==r){if(!["true","false"].includes(r))throw il(`process.env.${e} value must be 'true', 'false', or empty: ${r}`);t("true"===r)}}("RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED",(e=>{xl.RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED=e})),function(e,t){var n;const i=null===(n="MISSING_ENV_VAR"[e])||void 0===n?void 0:n.trim();null!=i&&""!==i&&t(i.split(/\s*,\s*|\s+/))}("RECOIL_GKS_ENABLED",(e=>{e.forEach((e=>{xl.RECOIL_GKS_ENABLED.add(e)}))})));var Cl=xl;function Ml(e){return Cl.RECOIL_GKS_ENABLED.has(e)}Ml.setPass=e=>{Cl.RECOIL_GKS_ENABLED.add(e)},Ml.setFail=e=>{Cl.RECOIL_GKS_ENABLED.delete(e)},Ml.clear=()=>{Cl.RECOIL_GKS_ENABLED.clear()};var Rl=Ml;var kl,Ol,Il,Pl=function(e,t,{error:n}={}){return null};const Dl=null!==(kl=Me.createMutableSource)&&void 0!==kl?kl:Me.unstable_createMutableSource,Ll=null!==(Ol=Me.useMutableSource)&&void 0!==Ol?Ol:Me.unstable_useMutableSource,ql=null!==(Il=Me.useSyncExternalStore)&&void 0!==Il?Il:Me.unstable_useSyncExternalStore;var $l={createMutableSource:Dl,useMutableSource:Ll,useSyncExternalStore:ql,currentRendererSupportsUseSyncExternalStore:function(){return!0},reactMode:function(){return Rl("recoil_transition_support")?{mode:"TRANSITION_SUPPORT",early:!0,concurrent:!0}:Rl("recoil_sync_external_store")&&null!=ql?{mode:"SYNC_EXTERNAL_STORE",early:!0,concurrent:!1}:Rl("recoil_mutable_source")&&null!=Ll&&"undefined"!=typeof window&&!window.$disableRecoilValueMutableSource_TEMP_HACK_DO_NOT_USE?Rl("recoil_suppress_rerender_in_callback")?{mode:"MUTABLE_SOURCE",early:!0,concurrent:!0}:{mode:"MUTABLE_SOURCE",early:!1,concurrent:!1}:Rl("recoil_suppress_rerender_in_callback")?{mode:"LEGACY",early:!0,concurrent:!1}:{mode:"LEGACY",early:!1,concurrent:!1}},isFastRefreshEnabled:function(){return!1}};class jl{constructor(e){sl(this,"key",void 0),this.key=e}toJSON(){return{key:this.key}}}class Bl extends jl{}class Ul extends jl{}var Vl={AbstractRecoilValue:jl,RecoilState:Bl,RecoilValueReadOnly:Ul,isRecoilValue:function(e){return e instanceof Bl||e instanceof Ul}},Fl=Vl.AbstractRecoilValue,Kl=Vl.RecoilState,Wl=Vl.RecoilValueReadOnly,Hl=Vl.isRecoilValue,Ql=Object.freeze({__proto__:null,AbstractRecoilValue:Fl,RecoilState:Kl,RecoilValueReadOnly:Wl,isRecoilValue:Hl});var zl=function(e,...t){0};var Gl=function(e,t){return function*(){let n=0;for(const i of e)yield t(i,n++)}()};const{isFastRefreshEnabled:Yl}=$l;class Jl{}const Xl=new Jl,Zl=new Map,eu=new Map;class tu extends Error{}const nu=new Map;function iu(e){return nu.get(e)}var ru={nodes:Zl,recoilValues:eu,registerNode:function(e){Cl.RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED&&function(e){if(Zl.has(e)){const t=`Duplicate atom key "${e}". This is a FATAL ERROR in\n      production. But it is safe to ignore this warning if it occurred because of\n      hot module replacement.`;console.warn(t)}}(e.key),Zl.set(e.key,e);const t=null==e.set?new Ql.RecoilValueReadOnly(e.key):new Ql.RecoilState(e.key);return eu.set(e.key,t),t},getNode:function(e){const t=Zl.get(e);if(null==t)throw new tu(`Missing definition for RecoilValue: "${e}""`);return t},getNodeMaybe:function(e){return Zl.get(e)},deleteNodeConfigIfPossible:function(e){var t;if(!Rl("recoil_memory_managament_2020"))return;const n=Zl.get(e);var i;null!=n&&null!==(t=n.shouldDeleteConfigOnRelease)&&void 0!==t&&t.call(n)&&(Zl.delete(e),null===(i=iu(e))||void 0===i||i(),nu.delete(e))},setConfigDeletionHandler:function(e,t){Rl("recoil_memory_managament_2020")&&(void 0===t?nu.delete(e):nu.set(e,t))},getConfigDeletionHandler:iu,recoilValuesForKeys:function(e){return Gl(e,(e=>al(eu.get(e))))},NodeMissingError:tu,DefaultValue:Jl,DEFAULT_VALUE:Xl};var au={enqueueExecution:function(e,t){t()}};var su,ou,cu=(su=function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n={},i=Math.pow(2,5),r=i-1,a=i/2,s=i/4,o={},c=function(e){return function(){return e}},l=n.hash=function(e){var n=void 0===e?"undefined":t(e);if("number"===n)return e;"string"!==n&&(e+="");for(var i=0,r=0,a=e.length;r<a;++r)i=(i<<5)-i+e.charCodeAt(r)|0;return i},u=function(e,t){return t>>>e&r},d=function(e){return 1<<e},h=function(e,t){return n=e&t-1,n=(n=(858993459&(n-=n>>1&1431655765))+(n>>2&858993459))+(n>>4)&252645135,127&(n+=n>>8)+(n>>16);var n},p=function(e,t,n,i){var r=i;if(!e){var a=i.length;r=new Array(a);for(var s=0;s<a;++s)r[s]=i[s]}return r[t]=n,r},m=function(e,t,n){var i=n.length-1,r=0,a=0,s=n;if(e)r=a=t;else for(s=new Array(i);r<t;)s[a++]=n[r++];for(++r;r<=i;)s[a++]=n[r++];return e&&(s.length=i),s},f={__hamt_isEmpty:!0},y=function(e){return e===f||e&&e.__hamt_isEmpty},g=function(e,t,n,i){return{type:1,edit:e,hash:t,key:n,value:i,_modify:T}},b=function(e,t,n){return{type:2,edit:e,hash:t,children:n,_modify:N}},w=function(e,t,n){return{type:3,edit:e,mask:t,children:n,_modify:A}},_=function(e,t,n){return{type:4,edit:e,size:t,children:n,_modify:S}},v=function e(t,n,i,r,a,s){if(i===a)return b(t,i,[s,r]);var o=u(n,i),c=u(n,a);return w(t,d(o)|d(c),o===c?[e(t,n+5,i,r,a,s)]:o<c?[r,s]:[s,r])},E=function(e,t){return e===t.edit},T=function(e,t,n,i,r,a,s){if(t(a,this.key)){var c=i(this.value);return c===this.value?this:c===o?(--s.value,f):E(e,this)?(this.value=c,this):g(e,r,a,c)}var l=i();return l===o?this:(++s.value,v(e,n,this.hash,this,r,g(e,r,a,l)))},N=function(e,t,n,i,r,a,s){if(r===this.hash){var c=function(e,t,n,i,r,a,s,c){for(var l=r.length,u=0;u<l;++u){var d=r[u];if(n(s,d.key)){var h=d.value,f=a(h);return f===h?r:f===o?(--c.value,m(e,u,r)):p(e,u,g(t,i,s,f),r)}}var y=a();return y===o?r:(++c.value,p(e,l,g(t,i,s,y),r))}(E(e,this),e,t,this.hash,this.children,i,a,s);return c===this.children?this:c.length>1?b(e,this.hash,c):c[0]}var l=i();return l===o?this:(++s.value,v(e,n,this.hash,this,r,g(e,r,a,l)))},A=function(e,t,n,i,r,s,o){var c=this.mask,l=this.children,g=u(n,r),b=d(g),v=h(c,b),T=c&b,N=T?l[v]:f,A=N._modify(e,t,n+5,i,r,s,o);if(N===A)return this;var S,x=E(e,this),C=c,M=void 0;if(T&&y(A)){if(!(C&=~b))return f;if(l.length<=2&&((S=l[1^v])===f||1===S.type||2===S.type))return l[1^v];M=m(x,v,l)}else if(T||y(A))M=p(x,v,A,l);else{if(l.length>=a)return function(e,t,n,i,r){for(var a=[],s=i,o=0,c=0;s;++c)1&s&&(a[c]=r[o++]),s>>>=1;return a[t]=n,_(e,o+1,a)}(e,g,A,c,l);C|=b,M=function(e,t,n,i){var r=i.length;if(e){for(var a=r;a>=t;)i[a--]=i[a];return i[t]=n,i}for(var s=0,o=0,c=new Array(r+1);s<t;)c[o++]=i[s++];for(c[t]=n;s<r;)c[++o]=i[s++];return c}(x,v,A,l)}return x?(this.mask=C,this.children=M,this):w(e,C,M)},S=function(e,t,n,i,r,a,o){var c=this.size,l=this.children,d=u(n,r),h=l[d],m=(h||f)._modify(e,t,n+5,i,r,a,o);if(h===m)return this;var g=E(e,this),b=void 0;if(y(h)&&!y(m))++c,b=p(g,d,m,l);else if(!y(h)&&y(m)){if(--c<=s)return function(e,t,n,i){for(var r=new Array(t-1),a=0,s=0,o=0,c=i.length;o<c;++o)if(o!==n){var l=i[o];l&&!y(l)&&(r[a++]=l,s|=1<<o)}return w(e,s,r)}(e,c,d,l);b=p(g,d,f,l)}else b=p(g,d,m,l);return g?(this.size=c,this.children=b,this):_(e,c,b)};function x(e,t,n,i,r){this._editable=e,this._edit=t,this._config=n,this._root=i,this._size=r}f._modify=function(e,t,n,i,r,a,s){var c=i();return c===o?f:(++s.value,g(e,r,a,c))},x.prototype.setTree=function(e,t){return this._editable?(this._root=e,this._size=t,this):e===this._root?this:new x(this._editable,this._edit,this._config,e,t)};var C=n.tryGetHash=function(e,t,n,i){for(var r=i._root,a=0,s=i._config.keyEq;;)switch(r.type){case 1:return s(n,r.key)?r.value:e;case 2:if(t===r.hash)for(var o=r.children,c=0,l=o.length;c<l;++c){var p=o[c];if(s(n,p.key))return p.value}return e;case 3:var m=u(a,t),f=d(m);if(r.mask&f){r=r.children[h(r.mask,f)],a+=5;break}return e;case 4:if(r=r.children[u(a,t)]){a+=5;break}return e;default:return e}};x.prototype.tryGetHash=function(e,t,n){return C(e,t,n,this)};var M=n.tryGet=function(e,t,n){return C(e,n._config.hash(t),t,n)};x.prototype.tryGet=function(e,t){return M(e,t,this)};var R=n.getHash=function(e,t,n){return C(void 0,e,t,n)};x.prototype.getHash=function(e,t){return R(e,t,this)},n.get=function(e,t){return C(void 0,t._config.hash(e),e,t)},x.prototype.get=function(e,t){return M(t,e,this)};var k=n.has=function(e,t,n){return C(o,e,t,n)!==o};x.prototype.hasHash=function(e,t){return k(e,t,this)};var O=n.has=function(e,t){return k(t._config.hash(e),e,t)};x.prototype.has=function(e){return O(e,this)};var I=function(e,t){return e===t};n.make=function(e){return new x(0,0,{keyEq:e&&e.keyEq||I,hash:e&&e.hash||l},f,0)},n.empty=n.make();var P=n.isEmpty=function(e){return e&&!!y(e._root)};x.prototype.isEmpty=function(){return P(this)};var D=n.modifyHash=function(e,t,n,i){var r={value:i._size},a=i._root._modify(i._editable?i._edit:NaN,i._config.keyEq,0,e,t,n,r);return i.setTree(a,r.value)};x.prototype.modifyHash=function(e,t,n){return D(n,e,t,this)};var L=n.modify=function(e,t,n){return D(e,n._config.hash(t),t,n)};x.prototype.modify=function(e,t){return L(t,e,this)};var q=n.setHash=function(e,t,n,i){return D(c(n),e,t,i)};x.prototype.setHash=function(e,t,n){return q(e,t,n,this)};var $=n.set=function(e,t,n){return q(n._config.hash(e),e,t,n)};x.prototype.set=function(e,t){return $(e,t,this)};var j=c(o),B=n.removeHash=function(e,t,n){return D(j,e,t,n)};x.prototype.removeHash=x.prototype.deleteHash=function(e,t){return B(e,t,this)};var U=n.remove=function(e,t){return B(t._config.hash(e),e,t)};x.prototype.remove=x.prototype.delete=function(e){return U(e,this)};var V=n.beginMutation=function(e){return new x(e._editable+1,e._edit+1,e._config,e._root,e._size)};x.prototype.beginMutation=function(){return V(this)};var F=n.endMutation=function(e){return e._editable=e._editable&&e._editable-1,e};x.prototype.endMutation=function(){return F(this)};var K=n.mutate=function(e,t){var n=V(t);return e(n),F(n)};x.prototype.mutate=function(e){return K(e,this)};var W=function(e){return e&&H(e[0],e[1],e[2],e[3],e[4])},H=function(e,t,n,i,r){for(;n<e;){var a=t[n++];if(a&&!y(a))return Q(a,i,[e,t,n,i,r])}return W(r)},Q=function(e,t,n){switch(e.type){case 1:return{value:t(e),rest:n};case 2:case 4:case 3:var i=e.children;return H(i.length,i,0,t,n);default:return W(n)}},z={done:!0};function G(e){this.v=e}G.prototype.next=function(){if(!this.v)return z;var e=this.v;return this.v=W(e.rest),e},G.prototype[Symbol.iterator]=function(){return this};var Y=function(e,t){return new G(Q(e._root,t))},J=function(e){return[e.key,e.value]},X=n.entries=function(e){return Y(e,J)};x.prototype.entries=x.prototype[Symbol.iterator]=function(){return X(this)};var Z=function(e){return e.key},ee=n.keys=function(e){return Y(e,Z)};x.prototype.keys=function(){return ee(this)};var te=function(e){return e.value},ne=n.values=x.prototype.values=function(e){return Y(e,te)};x.prototype.values=function(){return ne(this)};var ie=n.fold=function(e,t,n){var i=n._root;if(1===i.type)return e(t,i.value,i.key);for(var r=[i.children],a=void 0;a=r.pop();)for(var s=0,o=a.length;s<o;){var c=a[s++];c&&c.type&&(1===c.type?t=e(t,c.value,c.key):r.push(c.children))}return t};x.prototype.fold=function(e,t){return ie(e,t,this)};var re=n.forEach=function(e,t){return ie((function(n,i,r){return e(i,r,t)}),null,t)};x.prototype.forEach=function(e){return re(e,this)};var ae=n.count=function(e){return e._size};x.prototype.count=function(){return ae(this)},Object.defineProperty(x.prototype,"size",{get:x.prototype.count}),e.exports?e.exports=n:(void 0).hamt=n},su(ou={exports:{}},ou.exports),ou.exports);class lu{constructor(e){sl(this,"_map",void 0),this._map=new Map(null==e?void 0:e.entries())}keys(){return this._map.keys()}entries(){return this._map.entries()}get(e){return this._map.get(e)}has(e){return this._map.has(e)}set(e,t){return this._map.set(e,t),this}delete(e){return this._map.delete(e),this}clone(){return du(this)}toMap(){return new Map(this._map)}}class uu{constructor(e){if(sl(this,"_hamt",cu.empty.beginMutation()),e instanceof uu){const t=e._hamt.endMutation();e._hamt=t.beginMutation(),this._hamt=t.beginMutation()}else if(e)for(const[t,n]of e.entries())this._hamt.set(t,n)}keys(){return this._hamt.keys()}entries(){return this._hamt.entries()}get(e){return this._hamt.get(e)}has(e){return this._hamt.has(e)}set(e,t){return this._hamt.set(e,t),this}delete(e){return this._hamt.delete(e),this}clone(){return du(this)}toMap(){return new Map(this._hamt)}}function du(e){return Rl("recoil_hamt_2020")?new uu(e):new lu(e)}var hu=du,pu=Object.freeze({__proto__:null,persistentMap:hu});var mu=function(e,...t){const n=new Set;e:for(const i of e){for(const e of t)if(e.has(i))continue e;n.add(i)}return n};var fu=function(e,t){const n=new Map;return e.forEach(((e,i)=>{n.set(i,t(e,i))})),n};function yu(e,t,n,i){const{nodeDeps:r,nodeToNodeSubscriptions:a}=n,s=r.get(e);if(s&&i&&s!==i.nodeDeps.get(e))return;r.set(e,t);const o=null==s?t:mu(t,s);for(const t of o){a.has(t)||a.set(t,new Set);al(a.get(t)).add(e)}if(s){const n=mu(s,t);for(const t of n){if(!a.has(t))return;const n=al(a.get(t));n.delete(e),0===n.size&&a.delete(t)}}}var gu={cloneGraph:function(e){return{nodeDeps:fu(e.nodeDeps,(e=>new Set(e))),nodeToNodeSubscriptions:fu(e.nodeToNodeSubscriptions,(e=>new Set(e)))}},graph:function(){return{nodeDeps:new Map,nodeToNodeSubscriptions:new Map}},saveDepsToStore:function(e,t,n,i){var r,a,s,o;const c=n.getState();i!==c.currentTree.version&&i!==(null===(r=c.nextTree)||void 0===r?void 0:r.version)&&i!==(null===(a=c.previousTree)||void 0===a?void 0:a.version)&&Pl("Tried to save dependencies to a discarded tree");const l=n.getGraph(i);if(yu(e,t,l),i===(null===(s=c.previousTree)||void 0===s?void 0:s.version)){yu(e,t,n.getGraph(c.currentTree.version),l)}if(i===(null===(o=c.previousTree)||void 0===o?void 0:o.version)||i===c.currentTree.version){var u;const i=null===(u=c.nextTree)||void 0===u?void 0:u.version;if(void 0!==i){yu(e,t,n.getGraph(i),l)}}}};let bu=0;let wu=0;let _u=0;var vu={getNextTreeStateVersion:()=>bu++,getNextStoreID:()=>wu++,getNextComponentID:()=>_u++};const{persistentMap:Eu}=pu,{graph:Tu}=gu,{getNextTreeStateVersion:Nu}=vu;function Au(){const e=Nu();return{version:e,stateID:e,transactionMetadata:{},dirtyAtoms:new Set,atomValues:Eu(),nonvalidatedAtoms:Eu()}}var Su={makeEmptyTreeState:Au,makeEmptyStoreState:function(){const e=Au();return{currentTree:e,nextTree:null,previousTree:null,commitDepth:0,knownAtoms:new Set,knownSelectors:new Set,transactionSubscriptions:new Map,nodeTransactionSubscriptions:new Map,nodeToComponentSubscriptions:new Map,queuedComponentCallbacks_DEPRECATED:[],suspendedComponentResolvers:new Set,graphsByVersion:(new Map).set(e.version,Tu()),retention:{referenceCounts:new Map,nodesRetainedByZone:new Map,retainablesToCheckForRelease:new Set},nodeCleanupFunctions:new Map}},getNextTreeStateVersion:Nu};class xu{}var Cu={RetentionZone:xu,retentionZone:function(){return new xu}};var Mu={setByAddingToSet:function(e,t){const n=new Set(e);return n.add(t),n},setByDeletingFromSet:function(e,t){const n=new Set(e);return n.delete(t),n},mapBySettingInMap:function(e,t,n){const i=new Map(e);return i.set(t,n),i},mapByUpdatingInMap:function(e,t,n){const i=new Map(e);return i.set(t,n(i.get(t))),i},mapByDeletingFromMap:function(e,t){const n=new Map(e);return n.delete(t),n},mapByDeletingMultipleFromMap:function(e,t){const n=new Map(e);return t.forEach((e=>n.delete(e))),n}};var Ru=function*(e,t){let n=0;for(const i of e)t(i,n++)&&(yield i)};var ku=function(e,t){return new Proxy(e,{get:(e,n)=>(!(n in e)&&n in t&&(e[n]=t[n]()),e[n]),ownKeys:e=>Object.keys(e)})};const{getNode:Ou,getNodeMaybe:Iu,recoilValuesForKeys:Pu}=ru,{RetentionZone:Du}=Cu,{setByAddingToSet:Lu}=Mu,qu=Object.freeze(new Set);class $u extends Error{}function ju(e,t,n,i){const r=e.getState();if(r.nodeCleanupFunctions.has(n))return;const a=Ou(n),s=function(e,t,n){if(!Rl("recoil_memory_managament_2020"))return()=>{};const{nodesRetainedByZone:i}=e.getState().retention;function r(e){let n=i.get(e);n||i.set(e,n=new Set),n.add(t)}if(n instanceof Du)r(n);else if(Array.isArray(n))for(const e of n)r(e);return()=>{if(!Rl("recoil_memory_managament_2020"))return;const{retention:i}=e.getState();function r(e){const n=i.nodesRetainedByZone.get(e);null==n||n.delete(t),n&&0===n.size&&i.nodesRetainedByZone.delete(e)}if(n instanceof Du)r(n);else if(Array.isArray(n))for(const e of n)r(e)}}(e,n,a.retainedBy),o=a.init(e,t,i);r.nodeCleanupFunctions.set(n,(()=>{o(),s()}))}function Bu(e,t,n){return Ou(n).peek(e,t)}function Uu(e,t,n){const i=new Set,r=Array.from(n),a=e.getGraph(t.version);for(let e=r.pop();e;e=r.pop()){var s;i.add(e);const t=null!==(s=a.nodeToNodeSubscriptions.get(e))&&void 0!==s?s:qu;for(const e of t)i.has(e)||r.push(e)}return i}var Vu={getNodeLoadable:function(e,t,n){return ju(e,t,n,"get"),Ou(n).get(e,t)},peekNodeLoadable:Bu,setNodeValue:function(e,t,n,i){const r=Ou(n);if(null==r.set)throw new $u(`Attempt to set read-only RecoilValue: ${n}`);const a=r.set;return ju(e,t,n,"set"),a(e,t,i)},initializeNode:function(e,t,n){ju(e,e.getState().currentTree,t,n)},cleanUpNode:function(e,t){var n;const i=e.getState();null===(n=i.nodeCleanupFunctions.get(t))||void 0===n||n(),i.nodeCleanupFunctions.delete(t)},setUnvalidatedAtomValue_DEPRECATED:function(e,t,n){var i;const r=Iu(t);return null==r||null===(i=r.invalidate)||void 0===i||i.call(r,e),{...e,atomValues:e.atomValues.clone().delete(t),nonvalidatedAtoms:e.nonvalidatedAtoms.clone().set(t,n),dirtyAtoms:Lu(e.dirtyAtoms,t)}},peekNodeInfo:function(e,t,n){const i=e.getState(),r=e.getGraph(t.version),a=Ou(n).nodeType;return ku({type:a},{loadable:()=>Bu(e,t,n),isActive:()=>i.knownAtoms.has(n)||i.knownSelectors.has(n),isSet:()=>"selector"!==a&&t.atomValues.has(n),isModified:()=>t.dirtyAtoms.has(n),deps:()=>{var e;return Pu(null!==(e=r.nodeDeps.get(n))&&void 0!==e?e:[])},subscribers:()=>{var r,a;return{nodes:Pu(Ru(Uu(e,t,new Set([n])),(e=>e!==n))),components:Gl(null!==(r=null===(a=i.nodeToComponentSubscriptions.get(n))||void 0===a?void 0:a.values())&&void 0!==r?r:[],(([e])=>({name:e})))}}})},getDownstreamNodes:Uu};let Fu=null;var Ku={setInvalidateMemoizedSnapshot:function(e){Fu=e},invalidateMemoizedSnapshot:function(){var e;null===(e=Fu)||void 0===e||e()}};const{getDownstreamNodes:Wu,getNodeLoadable:Hu,setNodeValue:Qu}=Vu,{getNextComponentID:zu}=vu,{getNode:Gu,getNodeMaybe:Yu}=ru,{DefaultValue:Ju}=ru,{reactMode:Xu}=$l,{AbstractRecoilValue:Zu,RecoilState:ed,RecoilValueReadOnly:td,isRecoilValue:nd}=Ql,{invalidateMemoizedSnapshot:id}=Ku;function rd(e,t,n){if("set"===n.type){const{recoilValue:i,valueOrUpdater:r}=n,a=function(e,t,{key:n},i){if("function"==typeof i){const r=Hu(e,t,n);if("loading"===r.state){const e=`Tried to set atom or selector "${n}" using an updater function while the current state is pending, this is not currently supported.`;throw Pl(e),il(e)}if("hasError"===r.state)throw r.contents;return i(r.contents)}return i}(e,t,i,r),s=Qu(e,t,i.key,a);for(const[e,n]of s.entries())ad(t,e,n)}else if("setLoadable"===n.type){const{recoilValue:{key:e},loadable:i}=n;ad(t,e,i)}else if("markModified"===n.type){const{recoilValue:{key:e}}=n;t.dirtyAtoms.add(e)}else if("setUnvalidated"===n.type){var i;const{recoilValue:{key:e},unvalidatedValue:r}=n,a=Yu(e);null==a||null===(i=a.invalidate)||void 0===i||i.call(a,t),t.atomValues.delete(e),t.nonvalidatedAtoms.set(e,r),t.dirtyAtoms.add(e)}else Pl(`Unknown action ${n.type}`)}function ad(e,t,n){"hasValue"===n.state&&n.contents instanceof Ju?e.atomValues.delete(t):e.atomValues.set(t,n),e.dirtyAtoms.add(t),e.nonvalidatedAtoms.delete(t)}function sd(e,t){e.replaceState((n=>{const i=ld(n);for(const n of t)rd(e,i,n);return ud(e,i),id(),i}))}function od(e,t){if(cd.length){const n=cd[cd.length-1];let i=n.get(e);i||n.set(e,i=[]),i.push(t)}else sd(e,[t])}const cd=[];function ld(e){return{...e,atomValues:e.atomValues.clone(),nonvalidatedAtoms:e.nonvalidatedAtoms.clone(),dirtyAtoms:new Set(e.dirtyAtoms)}}function ud(e,t){const n=Wu(e,t,t.dirtyAtoms);for(const e of n){var i,r;null===(i=Yu(e))||void 0===i||null===(r=i.invalidate)||void 0===r||r.call(i,t)}}function dd(e,t,n){od(e,{type:"set",recoilValue:t,valueOrUpdater:n})}var hd={RecoilValueReadOnly:td,AbstractRecoilValue:Zu,RecoilState:ed,getRecoilValueAsLoadable:function(e,{key:t},n=e.getState().currentTree){var i,r;const a=e.getState();n.version!==a.currentTree.version&&n.version!==(null===(i=a.nextTree)||void 0===i?void 0:i.version)&&n.version!==(null===(r=a.previousTree)||void 0===r?void 0:r.version)&&Pl("Tried to read from a discarded tree");const s=Hu(e,n,t);return"loading"===s.state&&s.contents.catch((()=>{})),s},setRecoilValue:dd,setRecoilValueLoadable:function(e,t,n){if(n instanceof Ju)return dd(e,t,n);od(e,{type:"setLoadable",recoilValue:t,loadable:n})},markRecoilValueModified:function(e,t){od(e,{type:"markModified",recoilValue:t})},setUnvalidatedRecoilValue:function(e,t,n){od(e,{type:"setUnvalidated",recoilValue:t,unvalidatedValue:n})},subscribeToRecoilValue:function(e,{key:t},n,i=null){const r=zu(),a=e.getState();a.nodeToComponentSubscriptions.has(t)||a.nodeToComponentSubscriptions.set(t,new Map),al(a.nodeToComponentSubscriptions.get(t)).set(r,[null!=i?i:"<not captured>",n]);const s=Xu();if(s.early&&("LEGACY"===s.mode||"MUTABLE_SOURCE"===s.mode)){const i=e.getState().nextTree;i&&i.dirtyAtoms.has(t)&&n(i)}return{release:()=>{const n=e.getState(),i=n.nodeToComponentSubscriptions.get(t);void 0!==i&&i.has(r)?(i.delete(r),0===i.size&&n.nodeToComponentSubscriptions.delete(t)):Pl(`Subscription missing at release time for atom ${t}. This is a bug in Recoil.`)}}},isRecoilValue:nd,applyAtomValueWrites:function(e,t){const n=e.clone();return t.forEach(((e,t)=>{"hasValue"===e.state&&e.contents instanceof Ju?n.delete(t):n.set(t,e)})),n},batchStart:function(){const e=new Map;return cd.push(e),()=>{for(const[t,n]of e)sd(t,n);cd.pop()!==e&&Pl("Incorrect order of batch popping")}},writeLoadableToTreeState:ad,invalidateDownstreams:ud,copyTreeState:ld,refreshRecoilValue:function(e,t){var n;const{currentTree:i}=e.getState(),r=Gu(t.key);null===(n=r.clearCache)||void 0===n||n.call(r,e,i)}};var pd=function(e,t,n){const i=e.entries();let r=i.next();for(;!r.done;){const a=r.value;if(t.call(n,a[1],a[0],e))return!0;r=i.next()}return!1};const{cleanUpNode:md}=Vu,{deleteNodeConfigIfPossible:fd,getNode:yd}=ru,{RetentionZone:gd}=Cu,bd=new Set;function wd(e,t){const n=e.getState(),i=n.currentTree;if(n.nextTree)return void Pl("releaseNodesNowOnCurrentTree should only be called at the end of a batch");const r=new Set;for(const e of t)if(e instanceof gd)for(const t of vd(n,e))r.add(t);else r.add(e);const a=function(e,t){const n=e.getState(),i=n.currentTree,r=e.getGraph(i.version),a=new Set,s=new Set;return o(t),a;function o(t){const c=new Set,l=function(e,t,n,i,r){const a=e.getGraph(t.version),s=[],o=new Set;for(;n.size>0;)c(al(n.values().next().value));return s;function c(e){if(i.has(e)||r.has(e))return void n.delete(e);if(o.has(e))return;const t=a.nodeToNodeSubscriptions.get(e);if(t)for(const e of t)c(e);o.add(e),n.delete(e),s.push(e)}}(e,i,t,a,s);for(const e of l){var u;if("recoilRoot"===yd(e).retainedBy){s.add(e);continue}if((null!==(u=n.retention.referenceCounts.get(e))&&void 0!==u?u:0)>0){s.add(e);continue}if(Ed(e).some((e=>n.retention.referenceCounts.get(e)))){s.add(e);continue}const t=r.nodeToNodeSubscriptions.get(e);t&&pd(t,(e=>s.has(e)))?s.add(e):(a.add(e),c.add(e))}const d=new Set;for(const e of c)for(const t of null!==(h=r.nodeDeps.get(e))&&void 0!==h?h:bd){var h;a.has(t)||d.add(t)}d.size&&o(d)}}(e,r);for(const t of a)_d(e,i,t)}function _d(e,t,n){if(!Rl("recoil_memory_managament_2020"))return;md(e,n);const i=e.getState();i.knownAtoms.delete(n),i.knownSelectors.delete(n),i.nodeTransactionSubscriptions.delete(n),i.retention.referenceCounts.delete(n);const r=Ed(n);for(const e of r){var a;null===(a=i.retention.nodesRetainedByZone.get(e))||void 0===a||a.delete(n)}t.atomValues.delete(n),t.dirtyAtoms.delete(n),t.nonvalidatedAtoms.delete(n);const s=i.graphsByVersion.get(t.version);if(s){const e=s.nodeDeps.get(n);if(void 0!==e){s.nodeDeps.delete(n);for(const t of e){var o;null===(o=s.nodeToNodeSubscriptions.get(t))||void 0===o||o.delete(n)}}s.nodeToNodeSubscriptions.delete(n)}fd(n)}function vd(e,t){var n;return null!==(n=e.retention.nodesRetainedByZone.get(t))&&void 0!==n?n:bd}function Ed(e){const t=yd(e).retainedBy;return void 0===t||"components"===t||"recoilRoot"===t?[]:t instanceof gd?[t]:t}function Td(e,t){if(!Rl("recoil_memory_managament_2020"))return;e.getState().retention.referenceCounts.delete(t),function(e,t){const n=e.getState();n.nextTree?n.retention.retainablesToCheckForRelease.add(t):wd(e,new Set([t]))}(e,t)}var Nd={SUSPENSE_TIMEOUT_MS:12e4,updateRetainCount:function(e,t,n){var i;if(!Rl("recoil_memory_managament_2020"))return;const r=e.getState().retention.referenceCounts,a=(null!==(i=r.get(t))&&void 0!==i?i:0)+n;0===a?Td(e,t):r.set(t,a)},updateRetainCountToZero:Td,releaseScheduledRetainablesNow:function(e){if(!Rl("recoil_memory_managament_2020"))return;const t=e.getState();wd(e,t.retention.retainablesToCheckForRelease),t.retention.retainablesToCheckForRelease.clear()},retainedByOptionWithDefault:function(e){return void 0===e?"recoilRoot":e}};const{unstable_batchedUpdates:Ad}=el;var Sd={unstable_batchedUpdates:Ad};const{unstable_batchedUpdates:xd}=Sd;var Cd={unstable_batchedUpdates:xd};const{batchStart:Md}=hd,{unstable_batchedUpdates:Rd}=Cd;let kd=Rd||(e=>e());var Od={getBatcher:()=>kd,setBatcher:e=>{kd=e},batchUpdates:e=>{kd((()=>{let t=()=>{};try{t=Md(),e()}finally{t()}}))}};var Id=function*(e){for(const t of e)for(const e of t)yield e};const Pd="undefined"==typeof Window||"undefined"==typeof window,Dd="undefined"!=typeof navigator&&"ReactNative"===navigator.product;var Ld={isSSR:Pd,isReactNative:Dd,isWindow:e=>!Pd&&(e===window||e instanceof Window)};var qd={memoizeWithArgsHash:function(e,t){let n;return(...i)=>{n||(n={});const r=t(...i);return Object.hasOwnProperty.call(n,r)||(n[r]=e(...i)),n[r]}},memoizeOneWithArgsHash:function(e,t){let n,i;return(...r)=>{const a=t(...r);return n===a||(n=a,i=e(...r)),i}},memoizeOneWithArgsHashAndInvalidation:function(e,t){let n,i;return[(...r)=>{const a=t(...r);return n===a||(n=a,i=e(...r)),i},()=>{n=null}]}};const{batchUpdates:$d}=Od,{initializeNode:jd,peekNodeInfo:Bd}=Vu,{graph:Ud}=gu,{getNextStoreID:Vd}=vu,{DEFAULT_VALUE:Fd,recoilValues:Kd,recoilValuesForKeys:Wd}=ru,{AbstractRecoilValue:Hd,getRecoilValueAsLoadable:Qd,setRecoilValue:zd,setUnvalidatedRecoilValue:Gd}=hd,{updateRetainCount:Yd}=Nd,{setInvalidateMemoizedSnapshot:Jd}=Ku,{getNextTreeStateVersion:Xd,makeEmptyStoreState:Zd}=Su,{isSSR:eh}=Ld,{memoizeOneWithArgsHashAndInvalidation:th}=qd;class nh{constructor(e,t){sl(this,"_store",void 0),sl(this,"_refCount",1),sl(this,"getLoadable",(e=>(this.checkRefCount_INTERNAL(),Qd(this._store,e)))),sl(this,"getPromise",(e=>(this.checkRefCount_INTERNAL(),this.getLoadable(e).toPromise()))),sl(this,"getNodes_UNSTABLE",(e=>{if(this.checkRefCount_INTERNAL(),!0===(null==e?void 0:e.isModified)){if(!1===(null==e?void 0:e.isInitialized))return[];const t=this._store.getState().currentTree;return Wd(t.dirtyAtoms)}const t=this._store.getState().knownAtoms,n=this._store.getState().knownSelectors;return null==(null==e?void 0:e.isInitialized)?Kd.values():!0===e.isInitialized?Wd(Id([t,n])):Ru(Kd.values(),(({key:e})=>!t.has(e)&&!n.has(e)))})),sl(this,"getInfo_UNSTABLE",(({key:e})=>(this.checkRefCount_INTERNAL(),Bd(this._store,this._store.getState().currentTree,e)))),sl(this,"map",(e=>{this.checkRefCount_INTERNAL();const t=new sh(this,$d);return e(t),t})),sl(this,"asyncMap",(async e=>{this.checkRefCount_INTERNAL();const t=new sh(this,$d);return t.retain(),await e(t),t.autoRelease_INTERNAL(),t})),this._store={storeID:Vd(),parentStoreID:t,getState:()=>e,replaceState:t=>{e.currentTree=t(e.currentTree)},getGraph:t=>{const n=e.graphsByVersion;if(n.has(t))return al(n.get(t));const i=Ud();return n.set(t,i),i},subscribeToTransactions:()=>({release:()=>{}}),addTransactionMetadata:()=>{throw il("Cannot subscribe to Snapshots")}};for(const e of this._store.getState().knownAtoms)jd(this._store,e,"get"),Yd(this._store,e,1);this.autoRelease_INTERNAL()}retain(){this._refCount<=0&&Pl("Attempt to retain() Snapshot that was already released."),this._refCount++;let e=!1;return()=>{e||(e=!0,this._release())}}autoRelease_INTERNAL(){eh||window.setTimeout((()=>this._release()),10)}_release(){if(this._refCount--,0===this._refCount){if(this._store.getState().nodeCleanupFunctions.forEach((e=>e())),this._store.getState().nodeCleanupFunctions.clear(),!Rl("recoil_memory_managament_2020"))return}else this._refCount}isRetained(){return this._refCount>0}checkRefCount_INTERNAL(){Rl("recoil_memory_managament_2020")&&this._refCount}getStore_INTERNAL(){return this.checkRefCount_INTERNAL(),this._store}getID(){return this.checkRefCount_INTERNAL(),this._store.getState().currentTree.stateID}getStoreID(){return this.checkRefCount_INTERNAL(),this._store.storeID}}function ih(e,t,n=!1){const i=e.getState(),r=n?Xd():t.version;return{currentTree:{version:n?r:t.version,stateID:n?r:t.stateID,transactionMetadata:{...t.transactionMetadata},dirtyAtoms:new Set(t.dirtyAtoms),atomValues:t.atomValues.clone(),nonvalidatedAtoms:t.nonvalidatedAtoms.clone()},commitDepth:0,nextTree:null,previousTree:null,knownAtoms:new Set(i.knownAtoms),knownSelectors:new Set(i.knownSelectors),transactionSubscriptions:new Map,nodeTransactionSubscriptions:new Map,nodeToComponentSubscriptions:new Map,queuedComponentCallbacks_DEPRECATED:[],suspendedComponentResolvers:new Set,graphsByVersion:(new Map).set(r,e.getGraph(t.version)),retention:{referenceCounts:new Map,nodesRetainedByZone:new Map,retainablesToCheckForRelease:new Set},nodeCleanupFunctions:new Map(Gl(i.nodeCleanupFunctions.entries(),(([e])=>[e,()=>{}])))}}const[rh,ah]=th(((e,t)=>{var n;const i=e.getState(),r="latest"===t?null!==(n=i.nextTree)&&void 0!==n?n:i.currentTree:al(i.previousTree);return new nh(ih(e,r),e.storeID)}),((e,t)=>{var n,i;return String(t)+String(e.storeID)+String(null===(n=e.getState().nextTree)||void 0===n?void 0:n.version)+String(e.getState().currentTree.version)+String(null===(i=e.getState().previousTree)||void 0===i?void 0:i.version)}));Jd(ah);class sh extends nh{constructor(e,t){super(ih(e.getStore_INTERNAL(),e.getStore_INTERNAL().getState().currentTree,!0),e.getStoreID()),sl(this,"_batch",void 0),sl(this,"set",((e,t)=>{this.checkRefCount_INTERNAL();const n=this.getStore_INTERNAL();this._batch((()=>{Yd(n,e.key,1),zd(this.getStore_INTERNAL(),e,t)}))})),sl(this,"reset",(e=>{this.checkRefCount_INTERNAL();const t=this.getStore_INTERNAL();this._batch((()=>{Yd(t,e.key,1),zd(this.getStore_INTERNAL(),e,Fd)}))})),sl(this,"setUnvalidatedAtomValues_DEPRECATED",(e=>{this.checkRefCount_INTERNAL();const t=this.getStore_INTERNAL();$d((()=>{for(const[n,i]of e.entries())Yd(t,n,1),Gd(t,new Hd(n),i)}))})),this._batch=t}}var oh={Snapshot:nh,MutableSnapshot:sh,freshSnapshot:function(e){const t=new nh(Zd());return null!=e?t.map(e):t},cloneSnapshot:function(e,t="latest"){const n=rh(e,t);return n.isRetained()?n:(ah(),rh(e,t))}},ch=oh.Snapshot,lh=oh.MutableSnapshot,uh=oh.freshSnapshot,dh=oh.cloneSnapshot,hh=Object.freeze({__proto__:null,Snapshot:ch,MutableSnapshot:lh,freshSnapshot:uh,cloneSnapshot:dh});var ph=function(...e){const t=new Set;for(const n of e)for(const e of n)t.add(e);return t};const{useRef:mh}=Me;var fh=function(e){const t=mh(e);return t.current===e&&"function"==typeof e&&(t.current=e()),t};const{getNextTreeStateVersion:yh,makeEmptyStoreState:gh}=Su,{cleanUpNode:bh,getDownstreamNodes:wh,initializeNode:_h,setNodeValue:vh,setUnvalidatedAtomValue_DEPRECATED:Eh}=Vu,{graph:Th}=gu,{cloneGraph:Nh}=gu,{getNextStoreID:Ah}=vu,{createMutableSource:Sh,reactMode:xh}=$l,{applyAtomValueWrites:Ch}=hd,{releaseScheduledRetainablesNow:Mh}=Nd,{freshSnapshot:Rh}=hh,{useCallback:kh,useContext:Oh,useEffect:Ih,useMemo:Ph,useRef:Dh,useState:Lh}=Me;function qh(){throw il("This component must be used inside a <RecoilRoot> component.")}const $h=Object.freeze({storeID:Ah(),getState:qh,replaceState:qh,getGraph:qh,subscribeToTransactions:qh,addTransactionMetadata:qh});let jh=!1;function Bh(e){if(jh)throw il("An atom update was triggered within the execution of a state updater function. State updater functions provided to Recoil must be pure functions.");const t=e.getState();if(null===t.nextTree){Rl("recoil_memory_managament_2020")&&Rl("recoil_release_on_cascading_update_killswitch_2021")&&t.commitDepth>0&&Mh(e);const n=t.currentTree.version,i=yh();t.nextTree={...t.currentTree,version:i,stateID:i,dirtyAtoms:new Set,transactionMetadata:{}},t.graphsByVersion.set(i,Nh(al(t.graphsByVersion.get(n))))}}const Uh=Me.createContext({current:$h}),Vh=()=>Oh(Uh),Fh=Me.createContext(null);function Kh(e,t,n){const i=wh(e,n,n.dirtyAtoms);for(const e of i){const i=t.nodeToComponentSubscriptions.get(e);if(i)for(const[e,[t,r]]of i)r(n)}}function Wh(e){const t=e.getState(),n=t.currentTree,i=n.dirtyAtoms;if(i.size){for(const[n,r]of t.nodeTransactionSubscriptions)if(i.has(n))for(const[t,n]of r)n(e);for(const[n,i]of t.transactionSubscriptions)i(e);(!xh().early||t.suspendedComponentResolvers.size>0)&&(Kh(e,t,n),t.suspendedComponentResolvers.forEach((e=>e())),t.suspendedComponentResolvers.clear())}t.queuedComponentCallbacks_DEPRECATED.forEach((e=>e(n))),t.queuedComponentCallbacks_DEPRECATED.splice(0,t.queuedComponentCallbacks_DEPRECATED.length)}function Hh({setNotifyBatcherOfChange:e}){const t=Vh(),[,n]=Lh([]);return e((()=>n({}))),Ih((()=>(e((()=>n({}))),()=>{e((()=>{}))})),[e]),Ih((()=>{au.enqueueExecution("Batcher",(()=>{!function(e){const t=e.getState();t.commitDepth++;try{const{nextTree:n}=t;if(null==n)return;t.previousTree=t.currentTree,t.currentTree=n,t.nextTree=null,Wh(e),null!=t.previousTree?t.graphsByVersion.delete(t.previousTree.version):Pl("Ended batch with no previous state, which is unexpected","recoil"),t.previousTree=null,Rl("recoil_memory_managament_2020")&&null==n&&Mh(e)}finally{t.commitDepth--}}(t.current)}))})),null}let Qh=0;function zh({initializeState_DEPRECATED:e,initializeState:t,store_INTERNAL:n,children:i}){let r;const a=e=>{const t=r.current.graphsByVersion;if(t.has(e))return al(t.get(e));const n=Th();return t.set(e,n),n},s=(e,t)=>{if(null==t){const{transactionSubscriptions:t}=d.current.getState(),n=Qh++;return t.set(n,e),{release:()=>{t.delete(n)}}}{const{nodeTransactionSubscriptions:n}=d.current.getState();n.has(t)||n.set(t,new Map);const i=Qh++;return al(n.get(t)).set(i,e),{release:()=>{const e=n.get(t);e&&(e.delete(i),0===e.size&&n.delete(t))}}}},o=e=>{Bh(d.current);for(const t of Object.keys(e))al(d.current.getState().nextTree).transactionMetadata[t]=e[t]},c=e=>{Bh(d.current);const t=al(r.current.nextTree);let n;try{jh=!0,n=e(t)}finally{jh=!1}n!==t&&(r.current.nextTree=n,xh().early&&Kh(d.current,r.current,n),al(l.current)())},l=Dh(null),u=kh((e=>{l.current=e}),[l]),d=fh((()=>null!=n?n:{storeID:Ah(),getState:()=>r.current,replaceState:c,getGraph:a,subscribeToTransactions:s,addTransactionMetadata:o}));null!=n&&(d.current=n),r=fh((()=>null!=e?function(e,t){const n=gh();return t({set:(t,i)=>{const r=n.currentTree,a=vh(e,r,t.key,i),s=new Set(a.keys()),o=r.nonvalidatedAtoms.clone();for(const e of s)o.delete(e);n.currentTree={...r,dirtyAtoms:ph(r.dirtyAtoms,s),atomValues:Ch(r.atomValues,a),nonvalidatedAtoms:o}},setUnvalidatedAtomValues:e=>{e.forEach(((e,t)=>{n.currentTree=Eh(n.currentTree,t,e)}))}}),n}(d.current,e):null!=t?function(e){const t=Rh(e),n=t.getStore_INTERNAL().getState();return t.retain(),n.nodeCleanupFunctions.forEach((e=>e())),n.nodeCleanupFunctions.clear(),n}(t):gh()));const h=Ph((()=>null==Sh?void 0:Sh(r,(()=>r.current.currentTree.version))),[r]);return Ih((()=>{const e=d.current;for(const t of new Set(e.getState().knownAtoms))_h(e,t,"get");return()=>{for(const t of e.getState().knownAtoms)bh(e,t)}}),[d]),Me.createElement(Uh.Provider,{value:d},Me.createElement(Fh.Provider,{value:h},Me.createElement(Hh,{setNotifyBatcherOfChange:u}),i))}var Gh={RecoilRoot:function(e){const{override:t,...n}=e,i=Vh();return!1===t&&i.current!==$h?e.children:Me.createElement(zh,n)},useStoreRef:Vh,useRecoilMutableSource:function(){const e=Oh(Fh);return null==e&&zl("Attempted to use a Recoil hook outside of a <RecoilRoot>. <RecoilRoot> must be an ancestor of any component that uses Recoil hooks."),e},useRecoilStoreID:function(){return Vh().current.storeID},notifyComponents_FOR_TESTING:Kh,sendEndOfBatchNotifications_FOR_TESTING:Wh};var Yh=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0};const{useEffect:Jh,useRef:Xh}=Me;var Zh=function(e){const t=Xh();return Jh((()=>{t.current=e})),t.current};const{useStoreRef:ep}=Gh,{SUSPENSE_TIMEOUT_MS:tp}=Nd,{updateRetainCount:np}=Nd,{RetentionZone:ip}=Cu,{useEffect:rp,useRef:ap}=Me,{isSSR:sp}=Ld;var op=function(e){if(Rl("recoil_memory_managament_2020"))return function(e){const t=Array.isArray(e)?e:[e],n=t.map((e=>e instanceof ip?e:e.key)),i=ep();rp((()=>{if(!Rl("recoil_memory_managament_2020"))return;const e=i.current;if(r.current&&!sp)window.clearTimeout(r.current),r.current=null;else for(const t of n)np(e,t,1);return()=>{for(const t of n)np(e,t,-1)}}),[i,...n]);const r=ap(),a=Zh(n);if(!(sp||void 0!==a&&Yh(a,n))){const e=i.current;for(const t of n)np(e,t,1);if(a)for(const t of a)np(e,t,-1);r.current&&window.clearTimeout(r.current),r.current=window.setTimeout((()=>{r.current=null;for(const t of n)np(e,t,-1)}),tp)}}(e)};var cp=function(){return"<component name not available>"};const{batchUpdates:lp}=Od,{DEFAULT_VALUE:up}=ru,{currentRendererSupportsUseSyncExternalStore:dp,reactMode:hp,useMutableSource:pp,useSyncExternalStore:mp}=$l,{useRecoilMutableSource:fp,useStoreRef:yp}=Gh,{isRecoilValue:gp}=Ql,{AbstractRecoilValue:bp,getRecoilValueAsLoadable:wp,setRecoilValue:_p,setUnvalidatedRecoilValue:vp,subscribeToRecoilValue:Ep}=hd,{useCallback:Tp,useEffect:Np,useMemo:Ap,useRef:Sp,useState:xp}=Me,{setByAddingToSet:Cp}=Mu,{isSSR:Mp}=Ld;function Rp(e,t,n){if("hasValue"===e.state)return e.contents;if("loading"===e.state){throw new Promise((t=>{const i=n.current.getState().suspendedComponentResolvers;i.add(t),Mp&&rl(e.contents)&&e.contents.finally((()=>{i.delete(t)}))}))}throw"hasError"===e.state?e.contents:il(`Invalid value of loadable atom "${t.key}"`)}function kp(e){const t=yp(),n=cp(),i=Tp((()=>{var n;const i=t.current,r=i.getState(),a=hp().early&&null!==(n=r.nextTree)&&void 0!==n?n:r.currentTree;return{loadable:wp(i,e,a),key:e.key}}),[t,e]),r=Tp((e=>{let t;return()=>{var n,i;const r=e();return null!==(n=t)&&void 0!==n&&n.loadable.is(r.loadable)&&(null===(i=t)||void 0===i?void 0:i.key)===r.key?t:(t=r,r)}}),[]),a=Ap((()=>r(i)),[i,r]),s=Tp((i=>{const r=t.current;return Ep(r,e,i,n).release}),[t,e,n]);return mp(s,a,a).loadable}function Op(e){const t=yp(),n=Tp((()=>{var n;const i=t.current,r=i.getState(),a=hp().early&&null!==(n=r.nextTree)&&void 0!==n?n:r.currentTree;return wp(i,e,a)}),[t,e]),i=Tp((()=>n()),[n]),r=cp(),a=Tp(((i,a)=>{const s=t.current;return Ep(s,e,(()=>{if(!Rl("recoil_suppress_rerender_in_callback"))return a();const e=n();c.current.is(e)||a(),c.current=e}),r).release}),[t,e,r,n]),s=fp();if(null==s)throw il("Recoil hooks must be used in components contained within a <RecoilRoot> component.");const o=pp(s,i,a),c=Sp(o);return Np((()=>{c.current=o})),o}function Ip(e){const t=yp(),n=cp(),i=Tp((()=>{var n;const i=t.current,r=i.getState(),a=hp().early&&null!==(n=r.nextTree)&&void 0!==n?n:r.currentTree;return wp(i,e,a)}),[t,e]),r=Tp((()=>({loadable:i(),key:e.key})),[i,e.key]),a=Tp((e=>{const t=r();return e.loadable.is(t.loadable)&&e.key===t.key?e:t}),[r]);Np((()=>{const i=Ep(t.current,e,(e=>{o(a)}),n);return o(a),i.release}),[n,e,t,a]);const[s,o]=xp(r);return s.key!==e.key?r().loadable:s.loadable}function Pp(e){const t=yp(),[,n]=xp([]),i=cp(),r=Tp((()=>{var n;const i=t.current,r=i.getState(),a=hp().early&&null!==(n=r.nextTree)&&void 0!==n?n:r.currentTree;return wp(i,e,a)}),[t,e]),a=r(),s=Sp(a);return Np((()=>{s.current=a})),Np((()=>{const a=t.current,o=a.getState(),c=Ep(a,e,(e=>{var t;if(!Rl("recoil_suppress_rerender_in_callback"))return n([]);const i=r();null!==(t=s.current)&&void 0!==t&&t.is(i)||n(i),s.current=i}),i);if(o.nextTree)a.getState().queuedComponentCallbacks_DEPRECATED.push((()=>{s.current=null,n([])}));else{var l;if(!Rl("recoil_suppress_rerender_in_callback"))return n([]);const e=r();null!==(l=s.current)&&void 0!==l&&l.is(e)||n(e),s.current=e}return c.release}),[i,r,e,t]),a}function Dp(e){return Rl("recoil_memory_managament_2020")&&op(e),{TRANSITION_SUPPORT:Ip,SYNC_EXTERNAL_STORE:dp()?kp:Ip,MUTABLE_SOURCE:Op,LEGACY:Pp}[hp().mode](e)}function Lp(e){const t=yp();return Rp(Dp(e),e,t)}function qp(e){const t=yp();return Tp((n=>{_p(t.current,e,n)}),[t,e])}function $p(e){return Rl("recoil_memory_managament_2020")&&op(e),Ip(e)}function jp(e){const t=yp();return Rp($p(e),e,t)}var Bp={recoilComponentGetRecoilValueCount_FOR_TESTING:{current:0},useRecoilInterface:function(){const e=cp(),t=yp(),[,n]=xp([]),i=Sp(new Set);i.current=new Set;const r=Sp(new Set),a=Sp(new Map),s=Tp((e=>{const t=a.current.get(e);t&&(t.release(),a.current.delete(e))}),[a]),o=Tp(((e,t)=>{a.current.has(t)&&n([])}),[]);return Np((()=>{const n=t.current;mu(i.current,r.current).forEach((t=>{if(a.current.has(t))return void zl(`Double subscription to RecoilValue "${t}"`);const i=Ep(n,new bp(t),(e=>o(e,t)),e);a.current.set(t,i);n.getState().nextTree?n.getState().queuedComponentCallbacks_DEPRECATED.push((()=>{o(n.getState(),t)})):o(n.getState(),t)})),mu(r.current,i.current).forEach((e=>{s(e)})),r.current=i.current})),Np((()=>{const n=a.current;return mu(i.current,new Set(n.keys())).forEach((i=>{const r=Ep(t.current,new bp(i),(e=>o(e,i)),e);n.set(i,r)})),()=>n.forEach(((e,t)=>s(t)))}),[e,t,s,o]),Ap((()=>{function e(e){return n=>{_p(t.current,e,n)}}function n(e){var n;i.current.has(e.key)||(i.current=Cp(i.current,e.key));const r=t.current.getState();return wp(t.current,e,hp().early&&null!==(n=r.nextTree)&&void 0!==n?n:r.currentTree)}function r(e){return Rp(n(e),e,t)}return{getRecoilValue:r,getRecoilValueLoadable:n,getRecoilState:function(t){return[r(t),e(t)]},getRecoilStateLoadable:function(t){return[n(t),e(t)]},getSetRecoilState:e,getResetRecoilState:function(e){return()=>_p(t.current,e,up)}}}),[i,t])},useRecoilState:function(e){return[Lp(e),qp(e)]},useRecoilStateLoadable:function(e){return[Dp(e),qp(e)]},useRecoilValue:Lp,useRecoilValueLoadable:Dp,useResetRecoilState:function(e){const t=yp();return Tp((()=>{_p(t.current,e,up)}),[t,e])},useSetRecoilState:qp,useSetUnvalidatedAtomValues:function(){const e=yp();return(t,n={})=>{lp((()=>{e.current.addTransactionMetadata(n),t.forEach(((t,n)=>vp(e.current,new bp(n),t)))}))}},useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:$p,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:jp,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:function(e){return[jp(e),qp(e)]}};var Up=function(e,t){const n=new Map;for(const[i,r]of e)t(r,i)&&n.set(i,r);return n};var Vp=function(e,t){const n=new Set;for(const i of e)t(i)&&n.add(i);return n};var Fp=function(...e){const t=new Map;for(let n=0;n<e.length;n++){const i=e[n].keys();let r;for(;!(r=i.next()).done;)t.set(r.value,e[n].get(r.value))}return t};const{batchUpdates:Kp}=Od,{DEFAULT_VALUE:Wp,getNode:Hp,nodes:Qp}=ru,{useStoreRef:zp}=Gh,{AbstractRecoilValue:Gp,setRecoilValueLoadable:Yp}=hd,{SUSPENSE_TIMEOUT_MS:Jp}=Nd,{cloneSnapshot:Xp}=hh,{useCallback:Zp,useEffect:em,useRef:tm,useState:nm}=Me,{isSSR:im}=Ld;function rm(e){const t=zp();em((()=>t.current.subscribeToTransactions(e).release),[e,t])}function am(e){const t=e.atomValues.toMap(),n=fu(Up(t,((e,t)=>{const n=Hp(t).persistence_UNSTABLE;return null!=n&&"none"!==n.type&&"hasValue"===e.state})),(e=>e.contents));return Fp(e.nonvalidatedAtoms.toMap(),n)}function sm(e,t){var n;const i=e.getState(),r=null!==(n=i.nextTree)&&void 0!==n?n:i.currentTree,a=t.getStore_INTERNAL().getState().currentTree;Kp((()=>{const n=new Set;for(const e of[r.atomValues.keys(),a.atomValues.keys()])for(const t of e){var i,s;(null===(i=r.atomValues.get(t))||void 0===i?void 0:i.contents)!==(null===(s=a.atomValues.get(t))||void 0===s?void 0:s.contents)&&Hp(t).shouldRestoreFromSnapshots&&n.add(t)}n.forEach((t=>{Yp(e,new Gp(t),a.atomValues.has(t)?al(a.atomValues.get(t)):Wp)})),e.replaceState((e=>({...e,stateID:t.getID()})))}))}var om={useRecoilSnapshot:function(){const e=zp(),[t,n]=nm((()=>Xp(e.current))),i=Zh(t),r=tm(),a=tm();if(rm(Zp((e=>n(Xp(e))),[])),em((()=>{const e=t.retain();var n;r.current&&!im&&(window.clearTimeout(r.current),r.current=null,null===(n=a.current)||void 0===n||n.call(a),a.current=null);return()=>{window.setTimeout(e,10)}}),[t]),i!==t&&!im){var s;if(r.current)window.clearTimeout(r.current),r.current=null,null===(s=a.current)||void 0===s||s.call(a),a.current=null;a.current=t.retain(),r.current=window.setTimeout((()=>{var e;r.current=null,null===(e=a.current)||void 0===e||e.call(a),a.current=null}),Jp)}return t},gotoSnapshot:sm,useGotoRecoilSnapshot:function(){const e=zp();return Zp((t=>sm(e.current,t)),[e])},useRecoilTransactionObserver:function(e){rm(Zp((t=>{const n=Xp(t,"latest"),i=Xp(t,"previous");e({snapshot:n,previousSnapshot:i})}),[e]))},useTransactionObservation_DEPRECATED:function(e){rm(Zp((t=>{let n=t.getState().previousTree;const i=t.getState().currentTree;n||(Pl("Transaction subscribers notified without a previous tree being present -- this is a bug in Recoil"),n=t.getState().currentTree);const r=am(i),a=am(n),s=fu(Qp,(e=>{var t,n,i,r;return{persistence_UNSTABLE:{type:null!==(t=null===(n=e.persistence_UNSTABLE)||void 0===n?void 0:n.type)&&void 0!==t?t:"none",backButton:null!==(i=null===(r=e.persistence_UNSTABLE)||void 0===r?void 0:r.backButton)&&void 0!==i&&i}}})),o=Vp(i.dirtyAtoms,(e=>r.has(e)||a.has(e)));e({atomValues:r,previousAtomValues:a,atomInfo:s,modifiedAtoms:o,transactionMetadata:{...i.transactionMetadata}})}),[e]))},useTransactionSubscription_DEPRECATED:rm};const{peekNodeInfo:cm}=Vu,{useStoreRef:lm}=Gh;var um=function(){const e=lm();return({key:t})=>cm(e.current,e.current.getState().currentTree,t)};const{reactMode:dm}=$l,{RecoilRoot:hm,useStoreRef:pm}=Gh,{useMemo:mm}=Me;var fm=function(){"MUTABLE_SOURCE"===dm().mode&&console.warn("Warning: There are known issues using useRecoilBridgeAcrossReactRoots() in recoil_mutable_source rendering mode.  Please consider upgrading to recoil_sync_external_store mode.");const e=pm().current;return mm((()=>function({children:t}){return Me.createElement(hm,{store_INTERNAL:e},t)}),[e])};const{loadableWithValue:ym}=Sl,{initializeNode:gm}=Vu,{DEFAULT_VALUE:bm,getNode:wm}=ru,{copyTreeState:_m,getRecoilValueAsLoadable:vm,invalidateDownstreams:Em,writeLoadableToTreeState:Tm}=hd;function Nm(e){return"atom"===wm(e.key).nodeType}class Am{constructor(e,t){sl(this,"_store",void 0),sl(this,"_treeState",void 0),sl(this,"_changes",void 0),sl(this,"get",(e=>{if(this._changes.has(e.key))return this._changes.get(e.key);if(!Nm(e))throw il("Reading selectors within atomicUpdate is not supported");const t=vm(this._store,e,this._treeState);if("hasValue"===t.state)return t.contents;throw"hasError"===t.state?t.contents:il(`Expected Recoil atom ${e.key} to have a value, but it is in a loading state.`)})),sl(this,"set",((e,t)=>{if(!Nm(e))throw il("Setting selectors within atomicUpdate is not supported");if("function"==typeof t){const n=this.get(e);this._changes.set(e.key,t(n))}else gm(this._store,e.key,"set"),this._changes.set(e.key,t)})),sl(this,"reset",(e=>{this.set(e,bm)})),this._store=e,this._treeState=t,this._changes=new Map}newTreeState_INTERNAL(){if(0===this._changes.size)return this._treeState;const e=_m(this._treeState);for(const[t,n]of this._changes)Tm(e,t,ym(n));return Em(this._store,e),e}}var Sm=function(e){return t=>{e.replaceState((n=>{const i=new Am(e,n);return t(i),i.newTreeState_INTERNAL()}))}},xm=Sm,Cm=Object.freeze({__proto__:null,atomicUpdater:xm});var Mm=function(e,t){if(!e)throw new Error(t)};const{atomicUpdater:Rm}=Cm,{batchUpdates:km}=Od,{DEFAULT_VALUE:Om}=ru,{useStoreRef:Im}=Gh,{refreshRecoilValue:Pm,setRecoilValue:Dm}=hd,{cloneSnapshot:Lm}=hh,{gotoSnapshot:qm}=om,{useCallback:$m}=Me;class jm{}const Bm=new jm;function Um(e,t,n,i){let r,a=Bm;var s;(km((()=>{const s="useRecoilCallback() expects a function that returns a function: it accepts a function of the type (RecoilInterface) => (Args) => ReturnType and returns a callback function (Args) => ReturnType, where RecoilInterface is an object {snapshot, set, ...} and Args and ReturnType are the argument and return types of the callback you want to create.  Please see the docs at recoiljs.org for details.";if("function"!=typeof t)throw il(s);const o=ku({...null!=i?i:{},set:(t,n)=>Dm(e,t,n),reset:t=>Dm(e,t,Om),refresh:t=>Pm(e,t),gotoSnapshot:t=>qm(e,t),transact_UNSTABLE:t=>Rm(e)(t)},{snapshot:()=>{const t=Lm(e);return r=t.retain(),t}}),c=t(o);if("function"!=typeof c)throw il(s);a=c(...n)})),a instanceof jm&&Mm(!1),rl(a))?a=a.finally((()=>{var e;null===(e=r)||void 0===e||e()})):null===(s=r)||void 0===s||s();return a}var Vm={recoilCallback:Um,useRecoilCallback:function(e,t){const n=Im();return $m(((...t)=>Um(n.current,e,t)),null!=t?[...t,n]:void 0)}};const{useStoreRef:Fm}=Gh,{refreshRecoilValue:Km}=hd,{useCallback:Wm}=Me;var Hm=function(e){const t=Fm();return Wm((()=>{const n=t.current;Km(n,e)}),[e,t])};const{atomicUpdater:Qm}=Cm,{useStoreRef:zm}=Gh,{useMemo:Gm}=Me;var Ym=function(e,t){const n=zm();return Gm((()=>(...t)=>{Qm(n.current)((n=>{e(n)(...t)}))}),null!=t?[...t,n]:void 0)};var Jm=class{constructor(e){sl(this,"value",void 0),this.value=e}},Xm=Object.freeze({__proto__:null,WrappedValue:Jm});const{isFastRefreshEnabled:Zm}=$l;class ef extends Error{}var tf=class{constructor(e){var t,n,i;sl(this,"_name",void 0),sl(this,"_numLeafs",void 0),sl(this,"_root",void 0),sl(this,"_onHit",void 0),sl(this,"_onSet",void 0),sl(this,"_mapNodeValue",void 0),this._name=null==e?void 0:e.name,this._numLeafs=0,this._root=null,this._onHit=null!==(t=null==e?void 0:e.onHit)&&void 0!==t?t:()=>{},this._onSet=null!==(n=null==e?void 0:e.onSet)&&void 0!==n?n:()=>{},this._mapNodeValue=null!==(i=null==e?void 0:e.mapNodeValue)&&void 0!==i?i:e=>e}size(){return this._numLeafs}root(){return this._root}get(e,t){var n;return null===(n=this.getLeafNode(e,t))||void 0===n?void 0:n.value}getLeafNode(e,t){if(null==this._root)return;let n=this._root;for(;n;){if(null==t||t.onNodeVisit(n),"leaf"===n.type)return this._onHit(n),n;const i=this._mapNodeValue(e(n.nodeKey));n=n.branches.get(i)}}set(e,t,n){const i=()=>{var i,r,a,s;let o,c;for(const[t,i]of e){var l,u,d;const e=this._root;if("leaf"===(null==e?void 0:e.type))throw this.invalidCacheError();const r=o;if(o=r?r.branches.get(c):e,o=null!==(l=o)&&void 0!==l?l:{type:"branch",nodeKey:t,parent:r,branches:new Map,branchKey:c},"branch"!==o.type||o.nodeKey!==t)throw this.invalidCacheError();null==r||r.branches.set(c,o),null==n||null===(u=n.onNodeVisit)||void 0===u||u.call(n,o),c=this._mapNodeValue(i),this._root=null!==(d=this._root)&&void 0!==d?d:o}const h=o?null===(i=o)||void 0===i?void 0:i.branches.get(c):this._root;if(null!=h&&("leaf"!==h.type||h.branchKey!==c))throw this.invalidCacheError();const p={type:"leaf",value:t,parent:o,branchKey:c};null===(r=o)||void 0===r||r.branches.set(c,p),this._root=null!==(a=this._root)&&void 0!==a?a:p,this._numLeafs++,this._onSet(p),null==n||null===(s=n.onNodeVisit)||void 0===s||s.call(n,p)};try{i()}catch(e){if(!(e instanceof ef))throw e;this.clear(),i()}}delete(e){const t=this.root();if(!t)return!1;if(e===t)return this._root=null,this._numLeafs=0,!0;let n=e.parent,i=e.branchKey;for(;n;){var r;if(n.branches.delete(i),n===t)return 0===n.branches.size?(this._root=null,this._numLeafs=0):this._numLeafs--,!0;if(n.branches.size>0)break;i=null===(r=n)||void 0===r?void 0:r.branchKey,n=n.parent}for(;n!==t;n=n.parent)if(null==n)return!1;return this._numLeafs--,!0}clear(){this._numLeafs=0,this._root=null}invalidCacheError(){const e=Zm()?"Possible Fast Refresh module reload detected.  This may also be caused by an selector returning inconsistent values. Resetting cache.":"Invalid cache values.  This happens when selectors do not return consistent values for the same input dependency values.  That may also be caused when using Fast Refresh to change a selector implementation.  Resetting cache.";throw Pl(e+(null!=this._name?` - ${this._name}`:"")),new ef}},nf=tf,rf=Object.freeze({__proto__:null,TreeCache:nf});var af=class{constructor(e){var t;sl(this,"_maxSize",void 0),sl(this,"_size",void 0),sl(this,"_head",void 0),sl(this,"_tail",void 0),sl(this,"_map",void 0),sl(this,"_keyMapper",void 0),this._maxSize=e.maxSize,this._size=0,this._head=null,this._tail=null,this._map=new Map,this._keyMapper=null!==(t=e.mapKey)&&void 0!==t?t:e=>e}head(){return this._head}tail(){return this._tail}size(){return this._size}maxSize(){return this._maxSize}has(e){return this._map.has(this._keyMapper(e))}get(e){const t=this._keyMapper(e),n=this._map.get(t);if(n)return this.set(e,n.value),n.value}set(e,t){const n=this._keyMapper(e);this._map.get(n)&&this.delete(e);const i=this.head(),r={key:e,right:i,left:null,value:t};i?i.left=r:this._tail=r,this._map.set(n,r),this._head=r,this._size++,this._maybeDeleteLRU()}_maybeDeleteLRU(){this.size()>this.maxSize()&&this.deleteLru()}deleteLru(){const e=this.tail();e&&this.delete(e.key)}delete(e){const t=this._keyMapper(e);if(!this._size||!this._map.has(t))return;const n=al(this._map.get(t)),i=n.right,r=n.left;i&&(i.left=n.left),r&&(r.right=n.right),n===this.head()&&(this._head=i),n===this.tail()&&(this._tail=r),this._map.delete(t),this._size--}clear(){this._size=0,this._head=null,this._tail=null,this._map=new Map}},sf=Object.freeze({__proto__:null,LRUCache:af});const{LRUCache:of}=sf,{TreeCache:cf}=rf;var lf=function({name:e,maxSize:t,mapNodeValue:n=(e=>e)}){const i=new of({maxSize:t}),r=new cf({name:e,mapNodeValue:n,onHit:e=>{i.set(e,!0)},onSet:e=>{const n=i.tail();i.set(e,!0),n&&r.size()>t&&r.delete(n.key)}});return r};function uf(e,t,n){if("string"==typeof e&&!e.includes('"')&&!e.includes("\\"))return`"${e}"`;switch(typeof e){case"undefined":return"";case"boolean":return e?"true":"false";case"number":case"symbol":return String(e);case"string":return JSON.stringify(e);case"function":if(!0!==(null==t?void 0:t.allowFunctions))throw il("Attempt to serialize function in a Recoil cache key");return`__FUNCTION(${e.name})__`}if(null===e)return"null";var i;if("object"!=typeof e)return null!==(i=JSON.stringify(e))&&void 0!==i?i:"";if(rl(e))return"__PROMISE__";if(Array.isArray(e))return`[${e.map(((e,n)=>uf(e,t,n.toString())))}]`;if("function"==typeof e.toJSON)return uf(e.toJSON(n),t,n);if(e instanceof Map){const i={};for(const[n,r]of e)i["string"==typeof n?n:uf(n,t)]=r;return uf(i,t,n)}return e instanceof Set?uf(Array.from(e).sort(((e,n)=>uf(e,t).localeCompare(uf(n,t)))),t,n):void 0!==Symbol&&null!=e[Symbol.iterator]&&"function"==typeof e[Symbol.iterator]?uf(Array.from(e),t,n):`{${Object.keys(e).filter((t=>void 0!==e[t])).sort().map((n=>`${uf(n,t)}:${uf(e[n],t,n)}`)).join(",")}}`}var df=function(e,t={allowFunctions:!1}){return uf(e,t)};const{TreeCache:hf}=rf,pf={equality:"reference",eviction:"keep-all",maxSize:1/0};var mf=function({equality:e=pf.equality,eviction:t=pf.eviction,maxSize:n=pf.maxSize}=pf,i){const r=function(e){switch(e){case"reference":return e=>e;case"value":return e=>df(e)}throw il(`Unrecognized equality policy ${e}`)}(e);return function(e,t,n,i){switch(e){case"keep-all":return new hf({name:i,mapNodeValue:n});case"lru":return lf({name:i,maxSize:al(t),mapNodeValue:n});case"most-recent":return lf({name:i,maxSize:1,mapNodeValue:n})}throw il(`Unrecognized eviction policy ${e}`)}(t,n,r,i)};const{isReactNative:ff,isWindow:yf}=Ld;var gf={startPerfBlock:function(e){return()=>null}};const{isLoadable:bf,loadableWithError:wf,loadableWithPromise:_f,loadableWithValue:vf}=Sl,{WrappedValue:Ef}=Xm,{getNodeLoadable:Tf,peekNodeLoadable:Nf,setNodeValue:Af}=Vu,{saveDepsToStore:Sf}=gu,{DEFAULT_VALUE:xf,getConfigDeletionHandler:Cf,getNode:Mf,registerNode:Rf}=ru,{isRecoilValue:kf}=Ql,{markRecoilValueModified:Of}=hd,{retainedByOptionWithDefault:If}=Nd,{recoilCallback:Pf}=Vm,{startPerfBlock:Df}=gf;class Lf{}const qf=new Lf,$f=[],jf=new Map,Bf=(()=>{let e=0;return()=>e++})();function Uf(e){let t=null;const{key:n,get:i,cachePolicy_UNSTABLE:r}=e,a=null!=e.set?e.set:void 0;const s=new Set,o=mf(null!=r?r:{equality:"reference",eviction:"keep-all"},n),c=If(e.retainedBy_UNSTABLE),l=new Map;let u=0;function d(){return!Rl("recoil_memory_managament_2020")||u>0}function h(e){return e.getState().knownSelectors.add(n),u++,()=>{u--}}function p(){return void 0!==Cf(n)&&!d()}function m(e,t,n,i,r){x(t,i,r),f(e,n)}function f(e,t){S(e,t)&&A(e),y(t,!0)}function y(e,n){const i=jf.get(e);if(null!=i){for(const e of i)Of(e,al(t));n&&jf.delete(e)}}function g(e,t){let n=jf.get(t);null==n&&jf.set(t,n=new Set),n.add(e)}function b(e,t,n,i,r,a){return t.then((i=>{if(!d())throw A(e),qf;null!=a.loadingDepKey&&a.loadingDepPromise===t?n.atomValues.set(a.loadingDepKey,vf(i)):e.getState().knownSelectors.forEach((e=>{n.atomValues.delete(e)}));const s=v(e,n);if(s&&"loading"!==s.state){if((S(e,r)||null==N(e))&&f(e,r),"hasValue"===s.state)return s.contents;throw s.contents}if(!S(e,r)){const t=T(e,n);if(null!=t)return t.loadingLoadable.contents}const[o,c]=_(e,n,r);if("loading"!==o.state&&m(e,n,r,o,c),"hasError"===o.state)throw o.contents;return o.contents})).catch((t=>{if(t instanceof Lf)throw qf;if(!d())throw A(e),qf;const a=wf(t);throw m(e,n,r,a,i),t}))}function w(e,t,i,r){var a,o,c,l,u,d,h;(S(e,r)||t.version===(null===(a=e.getState())||void 0===a||null===(o=a.currentTree)||void 0===o?void 0:o.version)||t.version===(null===(c=e.getState())||void 0===c||null===(l=c.nextTree)||void 0===l?void 0:l.version))&&Sf(n,i,e,null!==(u=null===(d=e.getState())||void 0===d||null===(h=d.nextTree)||void 0===h?void 0:h.version)&&void 0!==u?u:e.getState().currentTree.version);for(const e of i)s.add(e)}function _(e,r,a){const s=Df(n);let o=!0,c=!0;const l=()=>{s(),c=!1};let u,h,p=!1;const f={loadingDepKey:null,loadingDepPromise:null},g=new Map;function _({key:t}){const n=Tf(e,r,t);switch(g.set(t,n),o||(w(e,r,new Set(g.keys()),a),function(e,t){S(e,t)&&(al(N(e)).stateVersions.clear(),y(t,!1))}(e,a)),n.state){case"hasValue":return n.contents;case"hasError":throw n.contents;case"loading":throw f.loadingDepKey=t,f.loadingDepPromise=n.contents,n.contents}throw il("Invalid Loadable state")}const v=n=>(...i)=>{if(c)throw il("Callbacks from getCallback() should only be called asynchronously after the selector is evalutated.  It can be used for selectors to return objects with callbacks that can work with Recoil state without a subscription.");return null==t&&Mm(!1),Pf(e,n,i,{node:t})};try{u=i({get:_,getCallback:v}),u=kf(u)?_(u):u,bf(u)&&("hasError"===u.state&&(p=!0),u=u.contents),rl(u)?u=function(e,t,n,i,r,a){return t.then((t=>{if(!d())throw A(e),qf;const a=vf(t);return m(e,n,r,a,i),t})).catch((t=>{if(!d())throw A(e),qf;if(rl(t))return b(e,t,n,i,r,a);const s=wf(t);throw m(e,n,r,s,i),t}))}(e,u,r,g,a,f).finally(l):l(),u=u instanceof Ef?u.value:u}catch(t){u=t,rl(u)?u=b(e,u,r,g,a,f).finally(l):(p=!0,l())}return h=p?wf(u):rl(u)?_f(u):vf(u),o=!1,function(e,t,n){if(S(e,t)){const t=N(e);null!=t&&(t.depValuesDiscoveredSoFarDuringAsyncWork=n)}}(e,a,g),w(e,r,new Set(g.keys()),a),[h,g]}function v(e,t){let i=t.atomValues.get(n);if(null!=i)return i;const r=new Set;try{i=o.get((n=>("string"!=typeof n&&Mm(!1),Tf(e,t,n).contents)),{onNodeVisit:e=>{"branch"===e.type&&e.nodeKey!==n&&r.add(e.nodeKey)}})}catch(e){throw il(`Problem with cache lookup for selector "${n}": ${e.message}`)}var a;i&&(t.atomValues.set(n,i),w(e,t,r,null===(a=N(e))||void 0===a?void 0:a.executionID));return i}function E(e,t){const n=v(e,t);if(null!=n)return A(e),n;const i=T(e,t);var r;if(null!=i)return"loading"===(null===(r=i.loadingLoadable)||void 0===r?void 0:r.state)&&g(e,i.executionID),i.loadingLoadable;const a=Bf(),[s,o]=_(e,t,a);return"loading"===s.state?(!function(e,t,n,i,r){l.set(e,{depValuesDiscoveredSoFarDuringAsyncWork:i,executionID:t,loadingLoadable:n,stateVersions:new Map([[r.version,!0]])})}(e,a,s,o,t),g(e,a)):(A(e),x(t,s,o)),s}function T(e,t){const n=Id([l.has(e)?[al(l.get(e))]:[],Gl(Ru(l,(([t])=>t!==e)),(([,e])=>e))]);function i(n){for(const[i,r]of n)if(!Tf(e,t,i).is(r))return!0;return!1}for(const e of n){if(e.stateVersions.get(t.version)||!i(e.depValuesDiscoveredSoFarDuringAsyncWork))return e.stateVersions.set(t.version,!0),e;e.stateVersions.set(t.version,!1)}}function N(e){return l.get(e)}function A(e){l.delete(e)}function S(e,t){var n;return t===(null===(n=N(e))||void 0===n?void 0:n.executionID)}function x(e,t,i){e.atomValues.set(n,t);try{o.set(function(e){return Array.from(e.entries()).map((([e,t])=>[e,t.contents]))}(i),t)}catch(e){throw il(`Problem with setting cache for selector "${n}": ${e.message}`)}}function C(e,t){const i=t.atomValues.get(n);return null!=i?i:o.get((n=>{var i;return"string"!=typeof n&&Mm(!1),null===(i=Nf(e,t,n))||void 0===i?void 0:i.contents}))}function M(e,t){return function(e){if($f.includes(n)){const e=`Recoil selector has circular dependencies: ${$f.slice($f.indexOf(n)).join(" \u2192 ")}`;return wf(il(e))}$f.push(n);try{return e()}finally{$f.pop()}}((()=>E(e,t)))}function R(e){e.atomValues.delete(n)}function k(e,n){null==t&&Mm(!1);for(const t of s){var i;const r=Mf(t);null===(i=r.clearCache)||void 0===i||i.call(r,e,n)}s.clear(),R(n),o.clear(),Of(e,t)}if(null!=a){return t=Rf({key:n,nodeType:"selector",peek:C,get:M,set:(e,t,i)=>{let r=!1;const s=new Map;function o({key:i}){if(r)throw il("Recoil: Async selector sets are not currently supported.");const a=Tf(e,t,i);if("hasValue"===a.state)return a.contents;if("loading"===a.state){const e=`Getting value of asynchronous atom or selector "${i}" in a pending state while setting selector "${n}" is not yet supported.`;throw Pl(e),il(e)}throw a.contents}function c(n,i){if(r){const e="Recoil: Async selector sets are not currently supported.";throw Pl(e),il(e)}const a="function"==typeof i?i(o(n)):i;Af(e,t,n.key,a).forEach(((e,t)=>s.set(t,e)))}const l=a({set:c,get:o,reset:function(e){c(e,xf)}},i);if(void 0!==l)throw rl(l)?il("Recoil: Async selector sets are not currently supported."):il("Recoil: selector set should be a void function.");return r=!0,s},init:h,invalidate:R,clearCache:k,shouldDeleteConfigOnRelease:p,dangerouslyAllowMutability:e.dangerouslyAllowMutability,shouldRestoreFromSnapshots:!1,retainedBy:c})}return t=Rf({key:n,nodeType:"selector",peek:C,get:M,init:h,invalidate:R,clearCache:k,shouldDeleteConfigOnRelease:p,dangerouslyAllowMutability:e.dangerouslyAllowMutability,shouldRestoreFromSnapshots:!1,retainedBy:c})}Uf.value=e=>new Ef(e);var Vf=Uf;const{isLoadable:Ff,loadableWithError:Kf,loadableWithPromise:Wf,loadableWithValue:Hf}=Sl,{WrappedValue:Qf}=Xm,{peekNodeInfo:zf}=Vu,{DEFAULT_VALUE:Gf,DefaultValue:Yf,getConfigDeletionHandler:Jf,registerNode:Xf,setConfigDeletionHandler:Zf}=ru,{isRecoilValue:ey}=Ql,{getRecoilValueAsLoadable:ty,markRecoilValueModified:ny,setRecoilValue:iy,setRecoilValueLoadable:ry}=hd,{retainedByOptionWithDefault:ay}=Nd,sy=e=>e instanceof Qf?e.value:e;function oy(e){const{key:t,persistence_UNSTABLE:n}=e,i=ay(e.retainedBy_UNSTABLE);let r=0;function a(e){return Wf(e.then((e=>(o=Hf(e),e))).catch((e=>{throw o=Kf(e),e})))}let s,o=rl(e.default)?a(e.default):Ff(e.default)?"loading"===e.default.state?a(e.default.contents):e.default:Hf(sy(e.default));l(o.contents);const c=new Map;function l(e){return e}function u(e,n){var i,r;return null!==(i=null!==(r=n.atomValues.get(t))&&void 0!==r?r:s)&&void 0!==i?i:o}const d=Xf({key:t,nodeType:"atom",peek:u,get:function(e,i){if(i.atomValues.has(t))return al(i.atomValues.get(t));if(i.nonvalidatedAtoms.has(t)){if(null!=s)return s;if(null==n)return zl(`Tried to restore a persisted value for atom ${t} but it has no persistence settings.`),o;const e=i.nonvalidatedAtoms.get(t),r=n.validator(e,Gf),a=r instanceof Yf?o:Hf(r);return s=a,s}return o},set:function(e,n,i){if(n.atomValues.has(t)){const e=al(n.atomValues.get(t));if("hasValue"===e.state&&i===e.contents)return new Map}else if(!n.nonvalidatedAtoms.has(t)&&i instanceof Yf)return new Map;return s=void 0,(new Map).set(t,Hf(i))},init:function(n,i,a){var s;if(r++,n.getState().knownAtoms.add(t),"loading"===o.state){const m=()=>{var e;(null!==(e=n.getState().nextTree)&&void 0!==e?e:n.getState().currentTree).atomValues.has(t)||ny(n,d)};o.contents.finally(m)}const l=null!==(s=e.effects)&&void 0!==s?s:e.effects_UNSTABLE;if(null!=l){let f=Gf,y=!0,g=!1,b=null;function w(e){if(y&&e.key===t){const e=f;return e instanceof Yf?u(n,i):rl(e)?Wf(e.then((e=>e instanceof Yf?o.toPromise():e))):Hf(e)}return ty(n,e)}function _(e){return w(e).toPromise()}function v(e){var i;const r=zf(n,null!==(i=n.getState().nextTree)&&void 0!==i?i:n.getState().currentTree,e.key);return!y||e.key!==t||f instanceof Yf?r:{...r,isSet:!0,loadable:w(e)}}const E=e=>t=>{if(y){const n=w(d),i="hasValue"===n.state?n.contents:Gf;f="function"==typeof t?t(i):t,rl(f)&&(f=f.then((t=>(b={effect:e,value:t},t))))}else{if(rl(t))throw il("Setting atoms to async values is not implemented.");"function"!=typeof t&&(b={effect:e,value:sy(t)}),iy(n,d,"function"==typeof t?n=>{const i=sy(t(n));return b={effect:e,value:i},i}:sy(t))}},T=e=>()=>E(e)(Gf),N=e=>i=>{var r;const{release:a}=n.subscribeToTransactions((n=>{var r;let{currentTree:a,previousTree:s}=n.getState();s||(Pl("Transaction subscribers notified without a next tree being present -- this is a bug in Recoil"),s=a);const c=null!==(r=a.atomValues.get(t))&&void 0!==r?r:o;if("hasValue"===c.state){var l,u,d,h;const n=c.contents,r=null!==(l=s.atomValues.get(t))&&void 0!==l?l:o,p="hasValue"===r.state?r.contents:Gf;(null===(u=b)||void 0===u?void 0:u.effect)!==e||(null===(d=b)||void 0===d?void 0:d.value)!==n?i(n,p,!a.atomValues.has(t)):(null===(h=b)||void 0===h?void 0:h.effect)===e&&(b=null)}}),t);c.set(n,[...null!==(r=c.get(n))&&void 0!==r?r:[],a])};for(const A of l)try{const S=A({node:d,storeID:n.storeID,parentStoreID_UNSTABLE:n.parentStoreID,trigger:a,setSelf:E(A),resetSelf:T(A),onSet:N(A),getPromise:_,getLoadable:w,getInfo_UNSTABLE:v});var h;if(null!=S)c.set(n,[...null!==(h=c.get(n))&&void 0!==h?h:[],S])}catch(x){f=x,g=!0}if(y=!1,!(f instanceof Yf)){var p;const C=g?Kf(f):rl(f)?Wf(function(e,n){const i=n.then((n=>{var r,a;return(null===(a=(null!==(r=e.getState().nextTree)&&void 0!==r?r:e.getState().currentTree).atomValues.get(t))||void 0===a?void 0:a.contents)===i&&iy(e,d,n),n})).catch((n=>{var r,a;throw(null===(a=(null!==(r=e.getState().nextTree)&&void 0!==r?r:e.getState().currentTree).atomValues.get(t))||void 0===a?void 0:a.contents)===i&&ry(e,d,Kf(n)),n}));return i}(n,f)):Hf(sy(f));C.contents,i.atomValues.set(t,C),null===(p=n.getState().nextTree)||void 0===p||p.atomValues.set(t,C)}}return()=>{var e;r--,null===(e=c.get(n))||void 0===e||e.forEach((e=>e())),c.delete(n)}},invalidate:function(){s=void 0},shouldDeleteConfigOnRelease:function(){return void 0!==Jf(t)&&r<=0},dangerouslyAllowMutability:e.dangerouslyAllowMutability,persistence_UNSTABLE:e.persistence_UNSTABLE?{type:e.persistence_UNSTABLE.type,backButton:e.persistence_UNSTABLE.backButton}:void 0,shouldRestoreFromSnapshots:!0,retainedBy:i});return d}function cy(e){const{...t}=e,n="default"in e?e.default:new Promise((()=>{}));return ey(n)?function(e){const t=cy({...e,default:Gf,persistence_UNSTABLE:void 0===e.persistence_UNSTABLE?void 0:{...e.persistence_UNSTABLE,validator:t=>t instanceof Yf?t:al(e.persistence_UNSTABLE).validator(t,Gf)},effects:e.effects,effects_UNSTABLE:e.effects_UNSTABLE}),n=Vf({key:`${e.key}__withFallback`,get:({get:n})=>{const i=n(t);return i instanceof Yf?e.default:i},set:({set:e},n)=>e(t,n),cachePolicy_UNSTABLE:{eviction:"most-recent"},dangerouslyAllowMutability:e.dangerouslyAllowMutability});return Zf(n.key,Jf(e.key)),n}({...t,default:n}):oy({...t,default:n})}cy.value=e=>new Qf(e);var ly=cy;var uy=class{constructor(e){var t;sl(this,"_map",void 0),sl(this,"_keyMapper",void 0),this._map=new Map,this._keyMapper=null!==(t=null==e?void 0:e.mapKey)&&void 0!==t?t:e=>e}size(){return this._map.size}has(e){return this._map.has(this._keyMapper(e))}get(e){return this._map.get(this._keyMapper(e))}set(e,t){this._map.set(this._keyMapper(e),t)}delete(e){this._map.delete(this._keyMapper(e))}clear(){this._map.clear()}},dy=Object.freeze({__proto__:null,MapCache:uy});const{LRUCache:hy}=sf,{MapCache:py}=dy,my={equality:"reference",eviction:"none",maxSize:1/0};var fy=function({equality:e=my.equality,eviction:t=my.eviction,maxSize:n=my.maxSize}=my){const i=function(e){switch(e){case"reference":return e=>e;case"value":return e=>df(e)}throw il(`Unrecognized equality policy ${e}`)}(e);return function(e,t,n){switch(e){case"keep-all":return new py({mapKey:n});case"lru":return new hy({mapKey:n,maxSize:al(t)});case"most-recent":return new hy({mapKey:n,maxSize:1})}throw il(`Unrecognized eviction policy ${e}`)}(t,n,i)};const{setConfigDeletionHandler:yy}=ru;var gy=function(e){var t,n;const i=fy({equality:null!==(t=null===(n=e.cachePolicyForParams_UNSTABLE)||void 0===n?void 0:n.equality)&&void 0!==t?t:"value",eviction:"keep-all"});return t=>{var n,r;const a=i.get(t);if(null!=a)return a;const{cachePolicyForParams_UNSTABLE:s,...o}=e,c="default"in e?e.default:new Promise((()=>{})),l=ly({...o,key:`${e.key}__${null!==(n=df(t))&&void 0!==n?n:"void"}`,default:"function"==typeof c?c(t):c,retainedBy_UNSTABLE:"function"==typeof e.retainedBy_UNSTABLE?e.retainedBy_UNSTABLE(t):e.retainedBy_UNSTABLE,effects:"function"==typeof e.effects?e.effects(t):"function"==typeof e.effects_UNSTABLE?e.effects_UNSTABLE(t):null!==(r=e.effects)&&void 0!==r?r:e.effects_UNSTABLE});return i.set(t,l),yy(l.key,(()=>{i.delete(t)})),l}};const{setConfigDeletionHandler:by}=ru;let wy=0;var _y=function(e){var t,n;const i=fy({equality:null!==(t=null===(n=e.cachePolicyForParams_UNSTABLE)||void 0===n?void 0:n.equality)&&void 0!==t?t:"value",eviction:"keep-all"});return t=>{var n;let r;try{r=i.get(t)}catch(t){throw il(`Problem with cache lookup for selector ${e.key}: ${t.message}`)}if(null!=r)return r;const a=`${e.key}__selectorFamily/${null!==(n=df(t,{allowFunctions:!0}))&&void 0!==n?n:"void"}/${wy++}`,s=n=>e.get(t)(n),o=e.cachePolicy_UNSTABLE,c="function"==typeof e.retainedBy_UNSTABLE?e.retainedBy_UNSTABLE(t):e.retainedBy_UNSTABLE;let l;if(null!=e.set){const n=e.set;l=Vf({key:a,get:s,set:(e,i)=>n(t)(e,i),cachePolicy_UNSTABLE:o,dangerouslyAllowMutability:e.dangerouslyAllowMutability,retainedBy_UNSTABLE:c})}else l=Vf({key:a,get:s,cachePolicy_UNSTABLE:o,dangerouslyAllowMutability:e.dangerouslyAllowMutability,retainedBy_UNSTABLE:c});return i.set(t,l),by(l.key,(()=>{i.delete(t)})),l}};const vy=_y({key:"__constant",get:e=>()=>e,cachePolicyForParams_UNSTABLE:{equality:"reference"}});var Ey=function(e){return vy(e)};const Ty=_y({key:"__error",get:e=>()=>{throw il(e)},cachePolicyForParams_UNSTABLE:{equality:"reference"}});var Ny=function(e){return Ty(e)};var Ay=function(e){return e};const{loadableWithError:Sy,loadableWithPromise:xy,loadableWithValue:Cy}=Sl;function My(e,t){const n=Array(t.length).fill(void 0),i=Array(t.length).fill(void 0);for(const[r,a]of t.entries())try{n[r]=e(a)}catch(e){i[r]=e}return[n,i]}function Ry(e){return null!=e&&!rl(e)}function ky(e){return Array.isArray(e)?e:Object.getOwnPropertyNames(e).map((t=>e[t]))}function Oy(e,t){return Array.isArray(e)?t:Object.getOwnPropertyNames(e).reduce(((e,n,i)=>({...e,[n]:t[i]})),{})}function Iy(e,t,n){return Oy(e,n.map(((e,n)=>null==e?Cy(t[n]):rl(e)?xy(e):Sy(e))))}const Py=_y({key:"__waitForNone",get:e=>({get:t})=>{const n=ky(e),[i,r]=My(t,n);return Iy(e,i,r)},dangerouslyAllowMutability:!0}),Dy=_y({key:"__waitForAny",get:e=>({get:t})=>{const n=ky(e),[i,r]=My(t,n);return r.some((e=>!rl(e)))?Iy(e,i,r):new Promise((t=>{for(const[n,a]of r.entries())rl(a)&&a.then((a=>{i[n]=a,r[n]=void 0,t(Iy(e,i,r))})).catch((a=>{r[n]=a,t(Iy(e,i,r))}))}))},dangerouslyAllowMutability:!0}),Ly=_y({key:"__waitForAll",get:e=>({get:t})=>{const n=ky(e),[i,r]=My(t,n);if(r.every((e=>null==e)))return Oy(e,i);const a=r.find(Ry);if(null!=a)throw a;return Promise.all(r).then((t=>{return Oy(e,(n=i,t.map(((e,t)=>void 0===e?n[t]:e))));var n}))},dangerouslyAllowMutability:!0}),qy=_y({key:"__waitForAllSettled",get:e=>({get:t})=>{const n=ky(e),[i,r]=My(t,n);return r.every((e=>!rl(e)))?Iy(e,i,r):Promise.all(r.map(((e,t)=>rl(e)?e.then((e=>{i[t]=e,r[t]=void 0})).catch((e=>{i[t]=void 0,r[t]=e})):null))).then((()=>Iy(e,i,r)))},dangerouslyAllowMutability:!0});var $y={waitForNone:Py,waitForAny:Dy,waitForAll:Ly,waitForAllSettled:qy,noWait:_y({key:"__noWait",get:e=>({get:t})=>{try{return Vf.value(Cy(t(e)))}catch(e){return Vf.value(rl(e)?xy(e):Sy(e))}},dangerouslyAllowMutability:!0})};const{RecoilLoadable:jy}=Sl,{DefaultValue:By}=ru,{RecoilRoot:Uy,useRecoilStoreID:Vy}=Gh,{isRecoilValue:Fy}=Ql,{retentionZone:Ky}=Cu,{freshSnapshot:Wy}=hh,{useRecoilState:Hy,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:Qy,useRecoilStateLoadable:zy,useRecoilValue:Gy,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:Yy,useRecoilValueLoadable:Jy,useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:Xy,useResetRecoilState:Zy,useSetRecoilState:eg}=Bp,{useGotoRecoilSnapshot:tg,useRecoilSnapshot:ng,useRecoilTransactionObserver:ig}=om,{useRecoilCallback:rg}=Vm,{noWait:ag,waitForAll:sg,waitForAllSettled:og,waitForAny:cg,waitForNone:lg}=$y;var ug={DefaultValue:By,isRecoilValue:Fy,RecoilLoadable:jy,RecoilEnv:Cl,RecoilRoot:Uy,useRecoilStoreID:Vy,useRecoilBridgeAcrossReactRoots_UNSTABLE:fm,atom:ly,selector:Vf,atomFamily:gy,selectorFamily:_y,constSelector:Ey,errorSelector:Ny,readOnlySelector:Ay,noWait:ag,waitForNone:lg,waitForAny:cg,waitForAll:sg,waitForAllSettled:og,useRecoilValue:Gy,useRecoilValueLoadable:Jy,useRecoilState:Hy,useRecoilStateLoadable:zy,useSetRecoilState:eg,useResetRecoilState:Zy,useGetRecoilValueInfo_UNSTABLE:um,useRecoilRefresher_UNSTABLE:Hm,useRecoilValueLoadable_TRANSITION_SUPPORT_UNSTABLE:Xy,useRecoilValue_TRANSITION_SUPPORT_UNSTABLE:Yy,useRecoilState_TRANSITION_SUPPORT_UNSTABLE:Qy,useRecoilCallback:rg,useRecoilTransaction_UNSTABLE:Ym,useGotoRecoilSnapshot:tg,useRecoilSnapshot:ng,useRecoilTransactionObserver_UNSTABLE:ig,snapshot_UNSTABLE:Wy,useRetain:op,retentionZone:Ky},dg=ug.atom,hg=ug.selector;const pg=dg({key:"exchangeRates",default:[]});dg({key:"primeExchangeRates",default:{}}),dg({key:"didLoadCachedExchangeRates",default:!1});hg({key:"exchangeRatesMapSelector",get:function({get:e}){return function(e){const t={};return e.forEach((e=>{t[function({chainId:e,networkId:t,contractAddress:n,currencyCode:i}){const r=t||e?.toString();return`${r||"x"}-${n||"x"}-${r&&n?"x":i.code}`}(e)]=e.rate})),t}(e(pg))},cachePolicy_UNSTABLE:{eviction:"most-recent"}});new Map;new Set([hi.BTC.value,hi.SOL.value]);n(53142);var mg=function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},fg=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yg=class{};mg([go(),fg("design:type",String)],yg.prototype,"id",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"primaryAddress",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"addresses",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"displayName",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"currencyCodeStr",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"contractAddress",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"imageURLStr",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"balanceStr",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"decimalsStr",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"blockchainStr",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"minimumBalanceStr",void 0),mg([fo(),fg("design:type",String)],yg.prototype,"networkStr",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"selectedIndexStr",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"accountId",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"assetUUID",void 0),mg([fo({nullable:!0}),fg("design:type",String)],yg.prototype,"lastBalanceUpdateTxHash",void 0),mg([fo({nullable:!0}),fg("design:type",Boolean)],yg.prototype,"isSpam",void 0),mg([fo({nullable:!0}),fg("design:type",Boolean)],yg.prototype,"isWhitelist",void 0),mg([fo({nullable:!0,default:!1}),fg("design:type",Boolean)],yg.prototype,"isDeleted",void 0),yg=mg([bo("wallet"),wo("IDX_WALLET",["blockchainStr","currencyCodeStr","networkStr","contractAddress","selectedIndexStr","accountId"]),wo("IDX_WALLET_BLOCKCHAIN",["blockchainStr"]),wo("IDX_WALLET_ACCOUNT_ID",["accountId"])],yg);const gg=[So,ec,oc,Mo,$o,_c,Fo,Ho,Nc,xc,Gc,dc,fc,Jo,yg,Zc];class bg{createQueryBuilder(e,t){const n={where:(e,t)=>n};return n.andWhere=n.where,n.getMany=async()=>Promise.resolve([]),n.getOne=async()=>Promise.resolve(null),n}get target(){return""}hasId(e){return!1}getId(e){return null}create(){}merge(e,...t){}async preload(e){return Promise.resolve(void 0)}async save(e,t){return Promise.resolve([])}async remove(e,t){return Promise.resolve(void 0)}async softRemove(e,t){return Promise.resolve([])}async recover(e,t){return Promise.resolve([])}async insert(e){return Promise.resolve(void 0)}async update(e,t){return Promise.resolve(void 0)}async upsert(e,t){throw new Error("Method not implemented.")}async delete(e){throw new Error("Method not implemented.")}async softDelete(e){return Promise.resolve(void 0)}async restore(e){return Promise.resolve(void 0)}async count(e){return Promise.resolve(0)}async find(e){return Promise.resolve([])}async findAndCount(e){return Promise.resolve([[],0])}async findByIds(e,t){return Promise.resolve([])}async findOne(e,t){return Promise.resolve(void 0)}async findOneOrFail(e,t){throw new Error("Method not implemented.")}async query(e,t){return Promise.resolve(void 0)}async clear(){return Promise.resolve()}async increment(e,t){return Promise.resolve(void 0)}async decrement(e,t){return Promise.resolve(void 0)}batchUpsert(e,t,n){return e.map((async()=>Promise.resolve(void 0)))}isNull(){return!0}}let wg=!0;const _g="walletExt",vg={type:"indexeddb",dropSchema:!!"MISSING_ENV_VAR".JEST_WORKER_ID,version:53,name:_g,database:_g,entities:gg,synchronize:!0,dexieJsConfig:{autoOpen:!0}};let Eg,Tg;const{openDatabase:Ng,deleteDatabase:Ag,tryGetRepository:Sg}={openDatabase:async function(){return Tg||(Tg=async function(){return Eg=new ho(vg),await Eg.initialize(),Eg}(),Tg)},deleteDatabase:async function(){const e=await Ng();await e.dropDatabase(),Tg=void 0,Eg=void 0},tryGetRepository:function(e){return wg&&void 0!==Eg?Eg.getRepository(e):new bg}};n(3514);var xg=n(29740);function Cg(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}function Mg(e){return new Uint8Array(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))}class Rg{constructor(){this.memoryStorage=new Map,this.delete=async e=>this.sessionApi?this.sessionApi.remove(e):(this.memoryStorage.delete(e),Promise.resolve()),"object"==typeof chrome.storage.session&&(this.sessionApi=chrome.storage.session)}async clear(){return this.sessionApi?chrome.storage.session.clear():(this.memoryStorage.clear(),Promise.resolve())}async get(e){if(this.sessionApi){return(await this.sessionApi.get(e))[e]}return Promise.resolve(this.memoryStorage.get(e))}async set(e,t){return this.sessionApi?this.sessionApi.set({[e]:t}):(this.memoryStorage.set(e,t),Promise.resolve())}}const kg="serviceWorkerMemoryRequest";class Og{constructor(){this.storage=new Rg}handleRequest(e,t){switch(e.action){case"get":this.get(e.key).then((e=>t(e)));break;case"set":this.set(e.key,e.value).then((()=>t(!0)));break;case"clear":this.storage.clear().then((()=>t(!0)))}}clear(){this.storage.clear()}async set(e,t){const n=await this.getId(e);return void 0===t?this.storage.delete(n):this.storage.set(n,t)}async get(e){const t=await this.getId(e);return this.storage.get(t)}async getId(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Cg(new Uint8Array(n))}}new class{constructor(){this.secret=U.get(oi)??(0,xg.randomBytesHex)(32),U.set(oi,this.secret)}async timedPromise(e,t,n){return new Promise(((i,r)=>{let a=!1;setTimeout((()=>{a||(a=!0,O({error:new Error(`Timed out while reading/writing ${e} from Service Worker Storage.`),context:"service_worker",severity:"error",isHandled:!1}),r(void 0))}),t);n((t=>{a?O({error:new Error(`Tried to resolve result for ${e} in Service Worker Storage after timeout.`),context:"service_worker",severity:"warning",isHandled:!1}):(a=!0,i(t))}))}))}async get(e){return this.timedPromise(e,2e3,(t=>{chrome.runtime.sendMessage({type:kg,data:{key:e,action:"get"}},(e=>{if("string"!=typeof e)return t(void 0);(async function(e,t){if(64!==t.length)throw Error("secret must be 256 bits");return new Promise(((n,i)=>{(async()=>{const r=await crypto.subtle.importKey("raw",Mg(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),a=Mg(e),s=a.slice(0,12),o=a.slice(12,28),c=a.slice(28),l=new Uint8Array([...c,...o]),u={name:"AES-GCM",iv:new Uint8Array(s)};try{const e=await window.crypto.subtle.decrypt(u,r,l),t=new TextDecoder;n(t.decode(e))}catch(e){i(e)}})()}))})(e,this.secret).then(t).catch((e=>t(void 0)))}))})).catch((()=>{}))}async set(e,t){const n=t?await async function(e,t){if(64!==t.length)throw Error("secret must be 256 bits");const n=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.importKey("raw",Mg(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),r=new TextEncoder,a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},i,r.encode(e)),s=a.slice(a.byteLength-16),o=a.slice(0,a.byteLength-16),c=new Uint8Array(s),l=new Uint8Array(o);return Cg(new Uint8Array([...n,...c,...l]))}(t,this.secret):void 0;return this.timedPromise(e,2e3,(t=>{chrome.runtime.sendMessage({type:kg,data:{key:e,action:"set",value:n}},(()=>t(!0)))})).catch((()=>!1))}async clear(){return new Promise((e=>{chrome.runtime.sendMessage({type:kg,data:{action:"clear"}},(t=>e(t)))}))}};var Ig;!function(e){e.Unlock="Unlock",e.PasswordOnboardingFlow="PasswordOnboardingFlow",e.ShowRecoveryPhrase="ShowRecoveryPhrase",e.ShowPrivateKey="ShowPrivateKey",e.ChangePassword="ChangePassword",e.VerifyPasswordCreateFlow="VerifyPasswordCreateFlow",e.VerifyPasswordImportFlow="VerifyPasswordImportFlow",e.DebugMenu="DebugMenu",e.BackfillPrimaryAddress="BackfillPrimaryAddress",e.CreateAccount="CreateNewMnemonic",e.ImportAccount="ImportAccount"}(Ig||(Ig={}));new Error("Illegal State - encrypted secret is undefined"),new Error("Illegal State - encrypted secret for account is undefined"),new Error("Illegal State - cannot delete last remaining account"),new Error("setEncryptedSecrets error");var Pg;!function(e){e.ledger="ledger",e.standalone="standalone"}(Pg||(Pg={}));const Dg=[{id:1,fromKey:gn.signingDevice,toKey:yn.supportsSolana,transformer:e=>String([Pg.standalone,Pg.ledger].includes(e))},{id:2,fromKey:gn.isStandaloneSigning,toKey:yn.canSignViaExtension,transformer:e=>e}].sort(((e,t)=>e.id-t.id));async function Lg({fromKey:e,toKey:t,transformer:n}){const i=(await chrome.storage.local.get([e]))[e];if(void 0===i)return;const r=n(i);await chrome.storage.local.set({[t]:r}),await chrome.storage.local.remove([e])}async function qg({eventMessenger:e}){try{const t=(await chrome.storage.local.get([yn.migrationIndex]))[yn.migrationIndex],n=void 0!==t?Dg.slice(Number(t)+1):Dg;if(n.length<1)return;for(const e of n)try{await Lg(e)}catch(t){throw new Error(`migration ${e.id} failed while trying to migrate ${e.fromKey} to ${e.toKey}`)}await chrome.storage.local.set({[yn.migrationIndex]:Dg.length-1}),e(Gn,{loggingId:"e8e03da9-b928-4a18-a8eb-3e4971c454e0",numberOfOperations:n.length})}catch(t){e(zn,{loggingId:"339e93a5-062d-40e5-a97b-9674f0930708",errorMessage:t?.message})}}var $g;function jg(e){if(e.data.action===$g.troubleshootConnection)return function(e){return{action:$g.troubleshootConnection,id:e.data.id,childSession:e.data.childSession}}(e)}!function(e){e.troubleshootConnection="troubleshootConnection"}($g||($g={}));const Bg=[ze.connect,ze.signMessage,ze.signTransaction,ze.signAllTransactions,ze.sendTransaction];function Ug(e){switch(e.data.action){case ze.connect:return function(e){return{action:ze.connect,id:e.data.id}}(e);case ze.signMessage:return function(e){return{action:ze.signMessage,id:e.data.id,request:{method:ze.signMessage,params:{message:e.data.request.message,address:e.data.request.address}}}}(e);case ze.signTransaction:return function(e){return{action:ze.signTransaction,id:e.data.id,request:{method:ze.signTransaction,params:{transactions:e.data.request.transactions}}}}(e);case ze.signAllTransactions:return function(e){return{action:ze.signAllTransactions,id:e.data.id,request:{method:ze.signAllTransactions,params:{transactions:e.data.request.transactions}}}}(e);case ze.sendTransaction:return function(e){return{action:ze.sendTransaction,id:e.data.id,request:{method:ze.sendTransaction,params:{transactions:e.data.request.transactions,options:e.data.request.options}}}}(e);default:return}}function Vg(){return"function"==typeof chrome.system?.cpu?.getInfo}let Fg=0,Kg=0;class Wg{constructor(e,t){this.sendOrQueueEvent=e,this.serviceWorkerMemory=t}start(){this.checkForceUpdate().catch((e=>{ti("Failed checking forced update ",e)})),chrome.alarms.create("checkForceUpdate",{periodInMinutes:qn()?5:30}),chrome.alarms.onAlarm.addListener((e=>{"checkForceUpdate"===e.name&&(this.checkForceUpdate().catch((e=>{ti("Failed checking forced update ",e)})),chrome.storage.local.get(["autoLockByUnixTimestamp"],(e=>{const t=e.autoLockByUnixTimestamp;void 0!==t&&t<Date.now()&&this.serviceWorkerMemory.clear()})))}))}async checkForceUpdate(){return new Promise(((e,t)=>{chrome.storage.local.get(["minimumVersion","hasForcedUpdate"],(async n=>{let i=n.minimumVersion;const r=n.hasForcedUpdate;try{if(i=await this.fetchMinimumVersion(),chrome.storage.local.set({minimumVersion:i}),!i)return this.setPopup("index.html?inPageRequest=false"),chrome.storage.local.set({hasForcedUpdated:!1}),r&&this.sendOrQueueEvent(Vn,{loggingId:"7e5b0380-0d1b-4523-bc19-ebee4a987414"}),void e(!1)}catch(e){ti(e)}const a=chrome.runtime.getManifest().version;if(!i||!a)return void t(new Error("Couldn't check minimum version"));if(!(this.compareVersion(i,a)>0))return this.setPopup("index.html?inPageRequest=false"),chrome.storage.local.set({hasForcedUpdated:!1}),r&&this.sendOrQueueEvent(Vn,{loggingId:"7e5b0380-0d1b-4523-bc19-ebee4a987414",currentVersion:a,minimumVersion:i}),void e(!1);this.sendOrQueueEvent(Un,{loggingId:"0868c1f5-118d-405d-85cf-b2f201a87a48",currentVersion:a,minimumVersion:i}),this.setPopup("forceUpdate.html"),this.serviceWorkerMemory.clear(),chrome.storage.local.set({hasForcedUpdated:!0}),e(!0)}))}))}compareVersion(e,t){const n=e.split("."),i=t.split("."),r=e=>/^\d+$/.test(e);if(!n.every(r)||!i.every(r))return NaN;for(;n.length<i.length;)n.push("0");for(;i.length<n.length;)i.push("0");const a=n.map(Number),s=i.map(Number);for(let e=0;e<a.length;++e){if(a[e]>s[e])return 1;if(a[e]<s[e])return-1}return 0}async fetchMinimumVersion(){return fetch("https://api.wallet.coinbase.com/rpc/v2/getMinimumSupportedBuilds").then((async e=>{if(e.status<200||e.status>=400)throw new Error("Invalid response");const t=await e.json();return t?.result?.extension}))}setPopup(e){chrome.action.setPopup({popup:e})}}const Hg=/Chrome\/([0-9.]+)/;function Qg(){const e=navigator.userAgent,t=Hg.exec(navigator.userAgent)?.[1];if(!t)return{userAgent:e};const[n,i,r]=t.split(".").map(Number);return{major:n,minor:i,patch:r,userAgent:e,vendor:"chrome",version:t}}class zg{constructor(){this.hasInitializedAnalytics=!1,this.eventQueue=[],this.sendOrQueueEvent=this.sendOrQueueEvent.bind(this)}initializeAnalytics(e){(0,c.Ts)({amplitudeApiKey:"4b5c59547a46317aee88399fdfc8f1f3",isProd:qn(),platform:c.TT.extension,onError:e=>{ti("Got error in analytics",e?.message)},projectName:"wallet_extension_service_worker",showDebugLogging:xn,version:kn()}),chrome.storage.local.get([yn.amplitudeDeviceId],(t=>{let n=t[yn.amplitudeDeviceId];if(!n&&e)n=(0,so.A)(),chrome.storage.local.set({[yn.amplitudeDeviceId]:n});else if(!n)return void chrome.storage.onChanged.addListener((e=>{const t=e[yn.amplitudeDeviceId]?.newValue;t&&!this.hasInitializedAnalytics&&((0,c.ls)({deviceId:t}),this.hasInitializedAnalytics=!0,this.flushEventQueue())}));(0,c.ls)({deviceId:n}),this.hasInitializedAnalytics=!0,this.flushEventQueue()}))}flushEventQueue(){0!==this.eventQueue.length&&(ti(`Flushing ${this.eventQueue.length} events from the queue`),this.eventQueue.forEach((({eventName:e,eventProperties:t})=>{this.fireEventAndMetric(e,t)})),this.eventQueue=[])}fireEventAndMetric(e,t){(0,l.N8)({metricName:e,metricType:c.vj.count,value:1,tags:{web3_method:t.request,blockchain:t.blockchain,chain_id:t.chainId?.toString()}}),(0,l.Np)(e,{...t,...this.eventMetadata})}get eventMetadata(){const{vendor:e,version:t,major:n,userAgent:i}=Qg();return{appVersion:chrome.runtime.getManifest().version,browserVendor:e,browserVersionMajor:n,chromeVersion:t,userAgent:i}}sendOrQueueEvent(e,t){this.hasInitializedAnalytics?this.fireEventAndMetric(e,t):(ti(`Queueing event: ${e}`),this.eventQueue.push({eventName:e,eventProperties:t}))}}const Gg=new class{constructor(){this.dappsSubject=new tn(1),this.getDapps().subscribe((e=>{this.dappsSubject.next(e)}))}get allConnections(){return this.dappsSubject.pipe(rn((e=>e.filter((e=>e.connected)))))}updateChainIdForHost(e){const t=e.overriddenChainId,n=t?ht.fromChainId(BigInt(t))?.rpcUrl:void 0,i=this.getHostName(e.dappURL),r=pt(n,e.dappURL);return this.getDapps().pipe(rn((e=>e.map((e=>this.getHostName(e.dappURL)===i?{...e,overriddenChainId:t,overriddenJsonUrl:r}:e)))),fn((e=>this.setDapps(e))),_n())}addConnection(e){const t=e.overriddenChainId,n=pt(e.overriddenJsonUrl,e.dappURL),i={dappName:e.dappName,dappLogoURL:e.dappLogoURL,dappLogoURLAlt:e.dappLogoURLAlt,dappURL:e.dappURL,connected:!0,connectedAddress:e.connectedAddress,providerType:e.providerType,overriddenChainId:t,overriddenJsonUrl:n};return this.updateConnection([i],!1)}addConnections(e){const t=e.map((e=>{const t=e.overriddenChainId,n=pt(e.overriddenJsonUrl,e.dappURL);return{dappName:e.dappName,dappLogoURL:e.dappLogoURL,dappLogoURLAlt:e.dappLogoURLAlt,dappURL:e.dappURL,connected:!0,connectedAddress:e.connectedAddress,providerType:e.providerType,overriddenChainId:t,overriddenJsonUrl:n}}));return this.setDapps(t)}removeConnection(e){return this.updateConnection([e],!0)}removeAllConnections(e){return this.getDapps().pipe(fn((t=>{if(e){const n=t.filter((t=>{const n=e.map((e=>e.toLocaleLowerCase()));return!!t.connectedAddress&&n.includes(t.connectedAddress.toLowerCase())}));return this.updateConnection(n,!0)}return this.updateConnection(t,!0)})),_n())}setDapps(e){return En.deferPromise((async()=>new Promise((t=>{chrome.storage?.local.set({[yn.connectedDapps]:JSON.stringify(e)},(()=>{this.dappsSubject.next(e),t()}))}))))}getDapps(){return En.deferPromise((async()=>new Promise((e=>{chrome.storage?.local.get([yn.connectedDapps],(t=>{if(!t[yn.connectedDapps])return void e([]);const n=t[yn.connectedDapps];e(n?JSON.parse(n):[])}))}))))}getHostName(e){return new URL(e).hostname.toLocaleUpperCase()}updateConnection(e,t){return this.getDapps().pipe(rn((n=>{let i=n;i.length||(i=[]);let r=!1;const a=new Set(e.map((e=>this.getHostName(e.dappURL)))),s=i.map((n=>{const i=this.getHostName(n.dappURL);if(a.has(i)){const a=e.find((e=>this.getHostName(e.dappURL)===i&&e.connectedAddress?.toLowerCase()===n.connectedAddress?.toLowerCase()));if(a)return r=!0,{dappName:a.dappName,dappLogoURL:a.dappLogoURL,dappLogoURLAlt:a.dappLogoURLAlt,dappURL:a.dappURL,overriddenChainId:a.overriddenChainId,overriddenJsonUrl:a.overriddenJsonUrl,connected:!t,connectedAddress:a.connectedAddress,providerType:a.providerType}}return n}));if(!r&&!t){const t={dappName:e[0].dappName,dappLogoURL:e[0].dappLogoURL,dappLogoURLAlt:e[0].dappLogoURLAlt,dappURL:e[0].dappURL,connected:!0,connectedAddress:e[0].connectedAddress,providerType:e[0].providerType,overriddenChainId:e[0].overriddenChainId,overriddenJsonUrl:e[0].overriddenJsonUrl};return[...s,t]}return s})),fn((e=>this.setDapps(e))),_n())}};(new class{constructor(){this.initialState={callbackMap:{},currPopupTabs:{},currPopupWins:{},originsMap:{},popupUIResponseMap:{},web3OriginTabId:null,injectedTabs:{}},this.cachedState=this.initialState,this.sessionState=new Rg,this.stateMutex=new s,this.stateKey="Coinbase/Wallet/WalletLinkService/State",this.checkingWindowLock=new s,this.serviceWorkerMemory=new Og,this.hasStartedWindowOrTabOpen=!1,this.serviceWorkerEventManager=new zg}async initializeState(){try{const e=await this.sessionState.get(this.stateKey);e&&Object.assign(this.cachedState,e)}catch(e){ti("Failed to initialize service worker state.",e)}}async initializeKillSwitches(){await Be(b,In)}get state(){return this.cachedState}setState(e){e(this.cachedState),this.stateMutex.runExclusive((async()=>{await this.sessionState.set(this.stateKey,this.cachedState)}))}async setupKeepAlive(){const e=chrome.runtime.getURL("index.html"),t=new RegExp(`^(https?:|${e})`),n=new Map;function i(e){const t=()=>{chrome.runtime.connect({name:"keepAlive"}).onDisconnect.addListener((()=>{"Could not establish connection. Receiving end does not exist."!==chrome.runtime.lastError?.message?t():((...t)=>{e||console.log(...t)})("Had last error indicating a connection error happened, stopping keep alive")}))};t()}async function r(...e){await Promise.all(e.map((async({id:e,url:t})=>{if(void 0!==e)try{ti(`Registering keepAlive for tab ${e}`),await chrome.scripting.executeScript({target:{tabId:e},func:i,args:[qn()]}),t&&n.set(e,t)}catch(t){ti(`Could not reconnect keepalive port for tab with tabId ${e}`,t)}else ti("Could not reconnect keepalive port for tab with undefined id")})))}const a=await chrome.tabs.query({url:[e,"http://*/*","https://*/*"]});await r(...a),chrome.tabs.onUpdated.addListener((function(e,i,a){(t.test(i.url??"")||"loading"===i.status&&n.get(e)===a.url)&&async function(e){if(chrome.runtime.lastError)return void ti(`Could not reconnect tab with tabId ${e.id} \u2014 it has likely been closed.`,chrome.runtime.lastError);await r(e)}(a)})),chrome.runtime.onConnect.addListener((e=>{"keepAlive"===e.name&&setTimeout((()=>e.disconnect()),25e4)}))}async onTabActivated(e){await this.injectProviderContentScriptsIntoTab(e.tabId)}async logCpuUsage(e){if(!Vg())return;const t=await async function(){if(!Vg())return;const e=(await chrome.system.cpu.getInfo())?.processors;if("number"!=typeof e?.length||0===e?.length)return;const{totalUsedCpuTime:t,totalCpuTime:n}=e.reduce(((e,t)=>{const n=t.usage.user+t.usage.kernel,i=t.usage.total;return{totalUsedCpuTime:e.totalUsedCpuTime+n,totalCpuTime:e.totalCpuTime+i}}),{totalUsedCpuTime:0,totalCpuTime:0}),i=(t-Fg)/(n-Kg);return Fg=t,Kg=n,i}();"number"==typeof t&&this.serviceWorkerEventManager.sendOrQueueEvent(e,{usedCpuInfo:t})}async start(){var e;if(await this.logCpuUsage(Wn),await Promise.allSettled([this.initializeState(),this.initializeKillSwitches(),qg({eventMessenger:this.serviceWorkerEventManager.sendOrQueueEvent})]),this.onTabActivated=this.onTabActivated.bind(this),chrome.tabs.onActivated.addListener(this.onTabActivated),chrome.tabs.onRemoved.addListener((e=>{this.setState((t=>{t.injectedTabs[e]=[]}))})),this.setupKeepAlive().catch((e=>ti("FAILED while setting up keepAlive",e))),e={version:kn(),platform:c.TT.extension},F=F?{...F,...e}:e,!Pn)return;new Wg(this.serviceWorkerEventManager.sendOrQueueEvent,this.serviceWorkerMemory).start(),chrome.runtime.onMessage.addListener(((e,t,n)=>{let i,r;switch(e.type){case"extensionUIRequest":return n(),void 0===t.tab?.id||void 0===t.tab.url||void 0===t.tab.title?(ti("Skipping message, sender tab not specified"),void this.serviceWorkerEventManager.sendOrQueueEvent(Zn,{loggingId:"53b228aa-c93f-4c21-8648-7e4fa55acd61"})):new URL(t.tab.url).origin!==e.data.origin?(this.serviceWorkerEventManager.sendOrQueueEvent(Bn,{loggingId:"53b228aa-c93f-4c21-8648-7e4fa55acd61",senderUrl:new URL(t.tab.url).origin,messageOrigin:e.data.origin}),void this.handleExtensionUIRequestEvent({event:e,tabId:t.tab?.id,dappName:e.data.dappInfo?.frameTitle,dappLogoURL:Qe({url:e.data.origin,faviconQuality:64}),dappLogoURLAlt:void 0,dappURL:e?.data.origin,hasMultipleProviders:Boolean(e.data.hasMultipleProviders)})):(i=e?.data.dappInfo.dappLogoURL,r=t?.tab.favIconUrl,void this.handleExtensionUIRequestEvent({event:e,tabId:t.tab?.id,dappName:t.tab.title,dappLogoURL:i,dappLogoURLAlt:r,dappURL:t.tab.url,hasMultipleProviders:Boolean(e.data.hasMultipleProviders)}));case"extensionUIResponse":return n(),this.handlePopupResponseEvent(e),!1;case"wallet-beta-autoconnect":return chrome.tabs.create({url:e.url}).then((t=>{chrome.runtime.onMessage.addListener((function n(i){"object"==typeof i&&null!==i&&t?.id&&("type"in i&&"handshake"!==i.type||(chrome.tabs.sendMessage(t.id,e),chrome.runtime.onMessage.removeListener(n)))}))})),!0;case"popupUIRequest":return n(this.state.popupUIResponseMap[e.data.id]),!0;case kg:return this.serviceWorkerMemory.handleRequest(e.data,n),!0;case"pageLoadedRequest":{const e=[],{url:i}=t,r=o(i||"",!0);r&&e.push(r);const a={domains:e,url:i||""},s=t.tab?.id;return s?(this.setState((e=>{e.originsMap[s]=a})),n(a)):n(null),!0}case"updateActiveEthAddress":return chrome.storage.local.set({[yn.activeEthAddress]:e.data.address}),!1;case"switchAddress":return chrome.tabs.query({active:!0,currentWindow:!0},(t=>{t[0]?.id&&("window.ethereum"===e.data.provider&&chrome.storage.local.set({[yn.activeEthAddress]:e.data.addresses[0]}),chrome.tabs.sendMessage(t[0].id,{type:"switchAddress",provider:e.data.provider,addresses:e.data.addresses}))})),!1;case"pageUnloadedRequest":{const e=t.tab?.id||0,i=this.state.originsMap[e];return this.setState((t=>{delete t.originsMap[e]})),n(i),!0}case"getDomainsFromBrowserRequest":{const t={domains:[],url:""};if(e.data?.tabId)return n(this.state.originsMap[e.data.tabId]||t),!0;if(this.state.web3OriginTabId){const i=this.state.originsMap[this.state.web3OriginTabId]??t,r=[];let a=i.url;const s=e.data?.triggeringRequestId;if(s){const e=this.state.popupUIResponseMap[s],t=e?.data?.dappInfo?.dappURL;if(e?.data?.originTabId===this.state.web3OriginTabId&&t){const e=o(t);r.push(e),a=t}}const c=[...i.domains,...r];return n({...{...i,url:a,domains:c},web3OriginTabId:this.state.web3OriginTabId}),!0}return n(t),!0}case"checkUrlWithBlocklist":return Ue("kill_blocklist_integration_extension").then((t=>{if(t)n({blocklistKilled:!0,maliciousDomains:[]});else{const t=e.data;Ce({domains:[t]},xe.SERVICE_WORKER).then((e=>{if(e)if(e.result.length){this.serviceWorkerEventManager.sendOrQueueEvent("blocklist.local_hit_blocklist_hit",{loggingId:"ebbb1a19-762d-48e7-ad27-a94d8b933e5b",dappUrl:t});const i=e.result.map((e=>e.domain));n({maliciousDomains:i})}else this.serviceWorkerEventManager.sendOrQueueEvent("blocklist.local_hit_blocklist_miss",{loggingId:"0f5f81c5-23c6-4f2b-82cb-feab3d308912",dappUrl:t}),n({maliciousDomains:[]});else n({maliciousDomains:[]})}))}})),!0;default:return ti(`Unknown message ${e.type}`),this.serviceWorkerEventManager.sendOrQueueEvent(Xn,{loggingId:"e706cd24-59a0-4edb-8171-7c6706620046",type:e.type}),n(),!1}})),chrome.runtime.onConnect.addListener((e=>{"extensionUIRequest"===e.name&&(this.serviceWorkerEventManager.sendOrQueueEvent(jn,{loggingId:"2b0641f6-28bc-4738-bdc5-3a0c9150db3e"}),ti("connected ",e),e.onMessage.addListener(ti))})),chrome.runtime.onSuspend.addListener((()=>{ti("SUSPEND EVENT"),this.serviceWorkerEventManager.sendOrQueueEvent(Yn,{loggingId:"26d0494e-d498-46d5-88aa-13f93ee5d0c8"})})),chrome.runtime.onInstalled.addListener((e=>{switch(ti("INSTALL EVENT"),e.reason){case"install":this.serviceWorkerEventManager.sendOrQueueEvent(Fn,{loggingId:"3429023f-801a-4827-91ec-ee42c8311709"});break;case"update":this.serviceWorkerEventManager.sendOrQueueEvent(ei,{loggingId:"2ae9b9c8-fbd8-4558-8dfe-a4f817f9965b"}),chrome.storage.local.set({[yn.extensionWasUpdated]:!0});break;case"chrome_update":this.serviceWorkerEventManager.sendOrQueueEvent($n,{loggingId:"d193911b-0f9c-4361-8eaf-e28e5209d844"})}if("install"!==e.reason)return;chrome.tabs.create({url:chrome.runtime.getURL("index.html?launchedForOnboarding=true")})})),this.listenForTabsClosingAndCancelWeb3Request();const t=e=>{};chrome.windows.onRemoved.addListener(t),chrome.windows.onRemoved.removeListener(t),this.serviceWorkerEventManager.initializeAnalytics(!0),await this.registerProviderContentScripts(),await this.injectProviderContentScriptsIntoActiveTab(),await this.logCpuUsage(Hn),Vg()&&setInterval((async()=>this.logCpuUsage(Qn)),3e5)}handlePopupResponseEvent(e){if(ti(e),void 0===e.data.id)return ti("Undefined id in service worker response handler"),void this.serviceWorkerEventManager.sendOrQueueEvent(Jn,{loggingId:"f72476d3-9f7b-4de9-be09-68ecc91a7ed3"});const t=this.state.callbackMap[e.data.id],n=t?.tabId,i=t?.action;if(void 0===n)return ti("Couldn't find original tab to send response to"),void this.serviceWorkerEventManager.sendOrQueueEvent(Kn,{loggingId:"c3ce9894-b206-4d09-a1e3-658f5d448b3d"});if(this.setState((t=>{delete t.callbackMap[e.data.id]})),chrome.tabs.sendMessage(n,e),i!==Je.requestEthereumAccounts&&i!==Je.selectProvider)return;const r=[];for(const t of Object.keys(this.state.callbackMap)){this.state.callbackMap[t].tabId===n&&(ti(`Also sending event ${e} to tab ${n}`),chrome.tabs.sendMessage(n,{...e,data:{...e.data,id:t}}),r.push(t))}this.setState((e=>{r.forEach((t=>delete e.callbackMap[t]))}))}async handleExtensionUIRequestEvent({event:t,tabId:n,dappName:i,dappLogoURL:r,dappLogoURLAlt:a,dappURL:s,hasMultipleProviders:o}){if(await this.checkIfWindowIsClosedAndClearCurrPopupWindow(),!t.data.id)return void ti("Undefined id in service worker request handler");if(this.state.callbackMap[t.data.id])return void ti("This event is already in the service worker callback map");if(s.startsWith("chrome-extension://"))throw Error("The service worker is handling an extension ui request from the extension itself, shouldn't happen");if(void 0===t.data.action)return void ti("Undefined action in service worker script");const c=Object.values(this.state.callbackMap).find((e=>e.tabId===n))?.tabId;if(this.setState((e=>{e.callbackMap[t.data.id]={tabId:n,action:t.data.action}})),void 0!==c&&[Je.requestEthereumAccounts,Je.selectProvider,Ye.getAllAddresses].includes(t.data.action)){const e=this.state.currPopupWins[n];if(e)return ti("skipping starting UI since window already exists"),void chrome.windows.update(e,{focused:!0});const t=this.state.currPopupTabs[n];if(t)return ti("skipping starting UI since tab already exists"),void chrome.tabs.update(t,{highlighted:!0})}let l=jg;if(d=t.data.action,ri.includes(d))l=ai;else if(function(e,t){return"window.coinbaseSolana"===t&&Bg.includes(e)}(t.data.action,t.provider)){if(await Ue("kill_solana_web3_extension"))return this.handlePopupResponseEvent({type:"extensionUIResponse",data:{id:t.data.id,action:Ge.featureFlagOff,error:new Error("Feature flag is off")}});l=Ug}else(function(e){return ni.includes(e)})(t.data.action)&&(l=ii);var d;const h={...l(t),dappInfo:{dappName:i,dappLogoURL:r,dappLogoURLAlt:a,dappURL:s},provider:t.provider,originTabId:n};if("switchEthereumChain"===h.action)return this.switchEthereumChain(h),!0;const p=function(e){switch(e?.method){case"signEthereumMessage":{const{addPrefix:t,typedDataJson:n}=e.params;if(!t&&!n)return{method:"eth_sign"};break}case"signEthereumTransaction":{const{shouldSubmit:t}=e.params;if(!t)return{method:"eth_signTransaction"};break}}}(h.request);if(p)return this.serviceWorkerEventManager.sendOrQueueEvent(u,{method:p.method,dappURL:Ke(s).hostname,requestSource:"extension"}),void this.handlePopupResponseEvent({type:"extensionUIResponse",data:{id:h.id,action:Ze.web3RequestCanceled,error:(0,e.serializeError)(e.standardErrors.provider.unsupportedMethod(`${p.method} method is deprecated`))}});this.makePopupRequest(t.data.action,{type:"extensionUIRequest",data:h},o,t.data.id,n)}async switchEthereumChain(e){var t;await Gg.updateChainIdForHost({...e.dappInfo,...e.address&&{connectedAddress:e.address.toLocaleLowerCase()},overriddenChainId:e.chainId}).toPromise(),t={dappURL:e.dappInfo.dappURL,request:"switchEthereumChain",chainId:e.chainId},(0,l.$s)("extension.web3.dapp_connection.network_switched",{loggingId:"423cee41-7865-44a8-bb5c-f05dbf7cb3c7",action:c.X2.measurement,componentType:c.I5.unknown,dapp:o(t.dappURL),request:t.request,chainId:t.chainId??""}),this.handlePopupResponseEvent({type:"extensionUIResponse",data:{id:e.id,action:Xe.switchEthereumChainApprove,chainId:e.chainId,blockchain:h}})}async makePopupRequest(e,t,n,i,r,a){const s=await chrome.windows.getCurrent();let o,c;if(this.setState((e=>{e.web3OriginTabId=r})),void 0!==s?.width&&void 0!==s.left&&void 0!==s.top){const e=n?0:-296;o=s.width+s.left+e,c=s.top}else o=0,c=0;const l="fullscreen"===s.state;if(ti(`Checking if full screen ${l}`),this.setState((e=>{e.popupUIResponseMap[i]=t})),(this.state.currPopupTabs[r]||this.state.currPopupWins[r]||this.hasStartedWindowOrTabOpen)&&Object.keys(this.state.callbackMap).length>1){chrome.runtime.sendMessage(t);const e=this.state.currPopupWins[r];if(e)return ti(`Bringing window ${e} to the foreground`),void chrome.windows.update(e,{focused:!0});const n=this.state.currPopupTabs[r];if(n)return ti(`Bringing tab ${n} to the foreground`),void chrome.tabs.update(n,{highlighted:!0})}const u=`index.html?inPageRequest=true&type=extensionUIRequest&action=${encodeURIComponent(e)}&id=${encodeURIComponent(i)}&originTabId=${encodeURIComponent(r)}${a?`&step=${encodeURIComponent(a)}`:""}`;if(l){const e=`${u}&fullScreen=true`;this.hasStartedWindowOrTabOpen=!0,chrome.tabs.create({url:chrome.runtime.getURL(e)},(e=>{this.hasStartedWindowOrTabOpen=!1,this.setState((t=>{void 0!==e?.id&&(t.currPopupTabs[r]=e.id)}))}))}else{this._windowListenerCancelCallback?.(),this._windowListenerCancelCallback=void 0;const e=await this.checkingWindowLock.acquire();this.hasStartedWindowOrTabOpen=!0,chrome.windows.create({url:chrome.runtime.getURL(u),type:"popup",left:o,top:c,height:625,width:375},(t=>{e(),this._windowListenerCancelCallback=this.listenForWindowsClosingAndCancelWeb3Request(),this.hasStartedWindowOrTabOpen=!1,this.setState((e=>{void 0!==t?.id&&(e.currPopupWins[r]=t.id)}))}))}}handleClosingAndCancelWeb3Request(t){const n=Object.keys(this.state.currPopupTabs).find((e=>"closingPopupTabId"in t&&this.state.currPopupTabs[Number(e)]===t.closingPopupTabId));void 0!==n&&this.setState((e=>{delete e.currPopupTabs[Number(n)]}));const i=Object.keys(this.state.currPopupWins).find((e=>"closingPopupWindowId"in t&&this.state.currPopupWins[Number(e)]===t.closingPopupWindowId));void 0!==i&&this.setState((e=>{delete e.currPopupWins[Number(i)]}));const r=[];for(const t of Object.keys(this.state.callbackMap))this.state.callbackMap[t].tabId!==Number(n)&&this.state.callbackMap[t].tabId!==Number(i)||(chrome.tabs.sendMessage(this.state.callbackMap[t].tabId,{type:"extensionUIResponse",data:{id:t,action:Ze.web3RequestCanceled,error:(0,e.serializeError)(e.standardErrors.provider.userRejectedRequest({}))}}),r.push(t));this.setState((e=>{r.forEach((t=>delete e.callbackMap[t]))}))}listenForTabsClosingAndCancelWeb3Request(){chrome.tabs.onRemoved.addListener((e=>{Object.values(this.state.currPopupTabs).includes(e)&&this.handleClosingAndCancelWeb3Request({closingPopupTabId:e})}))}async checkIfWindowIsClosedAndClearCurrPopupWindow(){const e=await this.checkingWindowLock.acquire(),t=await chrome.windows.getAll();e(),this._windowListenerCancelCallback&&Object.entries(this.state.currPopupWins).forEach((([e,n])=>{t.find((e=>e.id===n))||(this._windowListenerCancelCallback?.(),this._windowListenerCancelCallback=void 0,this.setState((t=>{delete t.currPopupWins[Number(e)]})))}))}listenForWindowsClosingAndCancelWeb3Request(){let e=!1;return setTimeout((async()=>{if(0===Object.keys(this.state.currPopupWins).length||e)return e=!0,void(this._windowListenerCancelCallback=void 0);const t=await this.checkingWindowLock.acquire(),n=await chrome.windows.getAll();t(),e||(Object.values(this.state.currPopupWins).forEach((t=>{n.find((e=>e.id===t))||(e=!0,this._windowListenerCancelCallback=void 0,this.handleClosingAndCancelWeb3Request({closingPopupWindowId:t}))})),this.listenForWindowsClosingAndCancelWeb3Request())}),5e3),()=>{e=!0}}async injectProviderContentScriptsIntoActiveTab(){const e=await this.getActiveTab();"number"==typeof e?.id?await this.injectProviderContentScriptsIntoTab(e.id):ti("FAILED while injecting provider content scripts into active tab. No injectable active tab id.")}async injectProviderContentScriptsIntoTab(e){await this.injectScriptIntoTab(Ln.CoinbaseContent,e),await this.injectScriptIntoTab(Ln.CoinbaseRequestProvider,e),await this.injectScriptIntoTab(Ln.CoinbaseWalletDappProvider,e),chrome.storage.local.get([yn.supportsSolana],(t=>{const n="true"===t[yn.supportsSolana];n&&this.injectSolanaProviderContentScript(n,e)})),chrome.storage.onChanged.addListener((t=>{const n=t[yn.supportsSolana];if(void 0!==n){const t="true"===n.newValue;this.injectSolanaProviderContentScript(t,e)}}))}async injectSolanaProviderContentScript(e,t){e?await this.injectScriptIntoTab(Ln.CoinbaseSolanaProvider,t):await this.injectScriptIntoTab(Ln.CoinbaseSolanaProviderCleanup,t)}async registerProviderContentScripts(){await this.registerContentScript(Ln.CoinbaseContent),await this.registerContentScript(Ln.CoinbaseRequestProvider),await this.registerContentScript(Ln.CoinbaseWalletDappProvider),await new Promise((e=>{chrome.storage.local.get([yn.supportsSolana],(t=>{const n="true"===t[yn.supportsSolana];n?this.registerSolanaProviderContentScript(n).then(e):e()}))})),chrome.storage.onChanged.addListener((e=>{const t=e[yn.supportsSolana];if(void 0!==t){const e="true"===t.newValue;this.registerSolanaProviderContentScript(e)}}))}async registerSolanaProviderContentScript(e){return e?this.registerContentScript(Ln.CoinbaseSolanaProvider,Ln.CoinbaseSolanaProviderCleanup):this.registerContentScript(Ln.CoinbaseSolanaProviderCleanup,Ln.CoinbaseSolanaProvider)}async getActiveTab(){const e={active:!0,lastFocusedWindow:!0,url:Dn},[t]=await chrome.tabs.query(e);return t}async injectScriptIntoTab(e,t){if(e?.js&&t)if(this.state.injectedTabs[t]?.includes(e.id))ti(`Skipping injecting ${e.id} into tab ${t}, already injected`);else{ti(`Injecting ${e.id} into tab ${t}`);try{await chrome.scripting.executeScript({files:e.js,world:e.world,injectImmediately:!0,target:{tabId:t,allFrames:e.allFrames}}),this.setState((n=>{const i=n.injectedTabs[t]??[];i.push(e.id),n.injectedTabs[t]=i}))}catch(n){ti(`FAILED while injecting ${e.id} into tab ${t}`,n)}}else ti(`FAILED while injecting ${e?.id} into tab ${t}. Missing js or tab id.`)}async registerContentScript(e,t){const n=await chrome.scripting.getRegisteredContentScripts(),i=t&&n.find((e=>e.id===t.id)),r=n.find((t=>t.id===e.id));i&&(ti(`Deregistering content script ${t.id}`),await chrome.scripting.unregisterContentScripts({ids:[t.id]})),r?(ti(`Updating content script ${e.id}`),await chrome.scripting.updateContentScripts([e])):(ti(`Registering content script ${e.id}`),await chrome.scripting.registerContentScripts([e]))}}).start()})()})();
//# sourceMappingURL=service.js.map