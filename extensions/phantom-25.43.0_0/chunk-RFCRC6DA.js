import{a as $,b as z}from"./chunk-CM4ZFCT2.js";import{b as N}from"./chunk-RKMQYZSN.js";import{a as B}from"./chunk-MN377ENM.js";import{Ac as E,Bc as f,Cc as b,Dc as D,Ec as A,Fc as O,xc as F}from"./chunk-GSVPXWLR.js";import{R as M,m as p,n as x,o as w,p as R}from"./chunk-LYTSCHVN.js";import{a as n,g as T,i as u,n as h}from"./chunk-NSVULBS3.js";u();h();u();h();u();h();var L=class a{static{n(this,"RingBuffer")}static fromArray(e,t=0){let s=new a(t);return s.fromArray(e,t===0),s}buffer=[];size;pos=0;constructor(e){if(e<0)throw new RangeError("Invalid size.");this.size=e}getSize(){return this.size}getPos(){return this.pos}getBufferLength(){return this.buffer.length}add(...e){e.forEach(t=>{this.buffer[this.pos]=t,this.pos=(this.pos+1)%this.size})}get(e){if(e<0&&(e+=this.buffer.length),!(e<0||e>this.buffer.length))return this.buffer.length<this.size?this.buffer[e]:this.buffer[(this.pos+e)%this.size]}getFirst(){return this.get(0)}getLast(){return this.get(-1)}getFirstN(e){return e===0?[]:e<0?this.getLastN(-e):this.toArray().slice(0,e)}getLastN(e){return e===0?[]:e<0?this.getFirstN(-e):this.toArray().slice(-e)}remove(e,t=1){if(e<0&&(e+=this.buffer.length),e<0||e>this.buffer.length)return[];let s=this.toArray(),o=s.splice(e,t);return this.fromArray(s),o}removeFirst(){return this.remove(0)[0]}removeLast(){return this.remove(-1)[0]}toArray(){return this.buffer.slice(this.pos).concat(this.buffer.slice(0,this.pos))}fromArray(e,t=!1){if(!Array.isArray(e))throw new TypeError("Input value is not an array.");t&&this.resize(e.length),this.size!==0&&(this.buffer=e.slice(-this.size),this.pos=this.buffer.length%this.size)}clear(){this.buffer=[],this.pos=0}resize(e){if(e<0)throw new RangeError("The size does not allow negative values.");if(e===0)this.clear();else if(e!==this.size){let t=this.toArray();this.fromArray(t.slice(-e)),this.pos=this.buffer.length%e}this.size=e}isFull(){return this.buffer.length===this.size}isEmpty(){return this.buffer.length===0}};var I=T(M(),1),S=T(B(),1);var P=new $,Q=".phantom-labs.log",k="state-log",y=class a{static{n(this,"ExtensionFileLogger")}maxSize=1024*1024;maxDepth=5;autoTrim=!1;disableDebounce=!1;includeSessionMetadata=!1;quoteStrings=!1;useLocalStorage=!1;useTimestamps=!1;indent="  ";logFilename=k;storageKey=Q;startTime;logs="";logQueue;logQueueSize=256;debounceSaveAndFlushQueuedLogs=(0,I.default)(this.saveAndFlushQueuedLogs,4e3);constructor(e){if(e)for(let t in e)e[t]!==void 0&&(this[t]=e[t])}static async init(e){let t=new a(e);if(t.useLocalStorage){let s=await t.getDataFromStorage();if(s){t.logs=s.log,t.startTime=new Date(s.startTime);let o=new Date(s.lastLog);t.addSessionMetadataToLog(`Last session end: ${s.lastLog}`),t.addSessionMetadataToLog(`Last ${t.formatSessionDuration(t.startTime,o)}`)}}return t.addSessionStartToLog(),t.logQueue=new L(t.disableDebounce?1:t.logQueueSize),t}async downloadLog(e,t){try{let s=A(e,t);await this.saveAndFlushQueuedLogs();let o=this.useLocalStorage?await this.getLogsFromStorage():this.logs,i=O(`${s}${o}`),r=new Blob([i],{type:"text/plain;charset=utf-8"}),l=URL.createObjectURL(r),d=new Date().toISOString().replace(/:|\./g,"-").slice(0,-5),m=`${this.logFilename}-${d}.txt`;if(S.default.downloads&&typeof S.default.downloads.download=="function")await S.default.downloads.download({url:l,filename:m,saveAs:!0}),URL.revokeObjectURL(l);else{let g=document.createElement("a");g.href=self.URL.createObjectURL(r),g.target="_blank",g.rel="noopener noreferrer",g.download=m,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(g.href)}}catch(s){let o=`Error downloading log file: ${s}`;E.captureError(new Error(o),F.FileLogger),console.error(o)}}getRecentLogs(e){let t=new TextEncoder,s=this.logs.split(`
`),o=0,i=s.length;for(let r=s.length-1;r>=0;r--){let l=t.encode(s[r]).length+1;if(o+l>e)break;o+=l,i=r}return s.slice(i).join(`
`)+`
`}write(...e){this.queueAndBatchWriteLogs(...e)}async queueAndBatchWriteLogs(...e){let t=this.formatNewLogData(...e);this.logQueue.add(t),this.debounceSaveAndFlushQueuedLogs.cancel(),this.logQueue.isFull()?await this.saveAndFlushQueuedLogs():await this.debounceSaveAndFlushQueuedLogs()}async saveAndFlushQueuedLogs(){this.logQueue.isEmpty()||(this.addItemToLogs(this.logQueue.toArray()),this.useLocalStorage&&await this.saveDataToStorage(this.logs),this.logQueue.clear())}formatNewLogData(...e){let t="";return this.useTimestamps&&(t+=this.formatDate()+" "),t+=e.map(s=>D({obj:s,depth:0,maxDepth:this.maxDepth,indent:this.indent,quoteStrings:this.quoteStrings})).join(" "),t+=`
`,t}addItemToLogs(e){Array.isArray(e)?e.forEach(t=>this.logs+=t):this.logs+=e,this.autoTrim&&(this.logs=this.trimLogByPercentage(.5,this.maxSize))}async saveDataToStorage(e){let t={startTime:this.startTime,log:e,lastLog:new Date};await P.set(this.storageKey,JSON.stringify(t))}async getLogsFromStorage(){let e=new Date,t=await this.getDataFromStorage();return t&&(this.startTime=new Date(t.startTime),this.logs=t.log),this.includeSessionMetadata?this.logs+`---- ${this.formatSessionDuration(this.startTime,e)} ----
`:this.logs}async getDataFromStorage(){let e=await P.get(this.storageKey);return e&&typeof e=="string"?JSON.parse(e):null}trimLogByPercentage(e,t){if(e<0||e>1)throw new Error("Percentage must be between 0 and 1");if(new TextEncoder().encode(this.logs).length<=t)return this.logs;let i=this.logs.split(`
`);i.pop();let r=Math.floor(i.length*e);return i.splice(0,r),i.join(`
`)+`
`}formatSessionDuration(e,t){let s=t.getTime()-e.getTime(),o=Math.floor(s/1e3/60/60),i=("0"+o).slice(-2);s-=o*1e3*60*60;let r=Math.floor(s/1e3/60),l=("0"+r).slice(-2);s-=r*1e3*60;let d=Math.floor(s/1e3),m=("0"+d).slice(-2);return s-=d*1e3,"Session duration: "+i+":"+l+":"+m}formatDate(e=new Date){return`[${e.toISOString()}]`}addSessionMetadataToLog(e){this.includeSessionMetadata&&(this.logs+=`---- ${e} ----
`)}addSessionStartToLog(){this.startTime=new Date,this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`)}async clear(){this.logs="",this.logQueue.clear(),this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`),this.addSessionMetadataToLog("Log cleared "+this.formatDate()),this.useLocalStorage&&await this.saveDataToStorage(this.logs)}search(e){let t=new RegExp(e,"ig"),s=this.logs.split(`
`),o=[];for(let r=0;r<s.length;r++){let l=`[${r}] `;s[r].match(t)&&o.push(l+s[r].trim())}let i=o.join(`
`);return i.length||(i=`Nothing found for "${e}".`),i}slice(...e){return this.logs.split(`
`).slice(...e).join(`
`)}};var j=1024*10,_={autoTrim:!0,useLocalStorage:!0,useTimestamps:!0},c=null,se={init:n(async()=>{try{c=await y.init(_)}catch{console.error(f)}},"init"),downloadLog:n(async a=>{if(!c){console.error(f);return}await c.saveAndFlushQueuedLogs()},"downloadLog"),getRecentLogs:n(async()=>c?c.getRecentLogs(j):(console.error(f),""),"getRecentLogs"),write:n((a,e,t,s)=>{if(!c){console.error(f);return}let o=s?` :: ${JSON.stringify(s)}`:"",r=`${(t??"info").toUpperCase()}: ${e}: ${a}${o}`;c.write(r)},"write"),getLogFilePaths:n(()=>{throw new Error(b)},"getLogFilePaths"),sendLogFilesByEmail:n(async a=>{throw new Error(b)},"sendLogFilesByEmail")};u();h();var U=new w(null,{loadPath:n(a=>{let e=a[0];return e.substring(0,3)==="fil"?`/locales/${e.substring(0,3)}/translation.json`:e.substring(0,2)==="zh"?e==="zh-CN"||e==="zh-TW"?`/locales/${e}/translation.json`:"/locales/zh-CN/translation.json":`/locales/${e.substring(0,2)}/translation.json`},"loadPath"),parse:n(a=>JSON.parse(a),"parse")});p.use(w).use(x).use(R).use(U).init({supportedLngs:N(),fallbackLng:"en",nonExplicitSupportedLngs:!0,debug:!1,returnNull:!1,detection:{order:["querystring","localStorage","cookie","sessionStorage","navigator","htmlTag","path","subdomain"],caches:["localStorage"]},react:{useSuspense:!1},interpolation:{escapeValue:!1}});p.on("initialized",()=>{z.setDisplayLanguage(p.language)});export{c as a,se as b};
//# sourceMappingURL=chunk-RFCRC6DA.js.map
