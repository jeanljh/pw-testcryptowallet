import{a as i6,f as q6,g as F6}from"./chunk-VGIRFM65.js";import{gc as l6,ic as $A}from"./chunk-44NW6BSR.js";import{c as aA}from"./chunk-3JCRVFH6.js";import{a as v7}from"./chunk-MN377ENM.js";import{$a as a6,Gb as o6,Pb as $6,X as Gj,da as n6,j as cj,ma as zA,qa as WA,s as YA}from"./chunk-COS4XKZ5.js";import{Ac as G,E as VA,F as t6,H as JA,L as e6,Oc as B6,Wc as k6,ae as BA,kd as jA,md as rA,pd as _A,qd as oA,tb as z,ud as s6,wc as g,x as lj,xc as p}from"./chunk-GSVPXWLR.js";import{a as bA,r as E6}from"./chunk-LYTSCHVN.js";import{h as Z,k as AA}from"./chunk-P5BPG5MC.js";import{g as y,h as ij,l as qj,n as Fj}from"./chunk-PPQ6BNOX.js";import{a as e,e as p7,g as uA,i as n,m as Buffer,n as a}from"./chunk-NSVULBS3.js";n();a();n();a();n();a();function wA(A){if(!Number.isSafeInteger(A)||A<0)throw new Error(`positive integer expected, not ${A}`)}e(wA,"number");function dj(A){if(typeof A!="boolean")throw new Error(`boolean expected, not ${A}`)}e(dj,"bool");function Ij(A){return A instanceof Uint8Array||A!=null&&typeof A=="object"&&A.constructor.name==="Uint8Array"}e(Ij,"isBytes");function V(A,...j){if(!Ij(A))throw new Error("Uint8Array expected");if(j.length>0&&!j.includes(A.length))throw new Error(`Uint8Array expected of length ${j}, not of length=${A.length}`)}e(V,"bytes");function uj(A,j=!0){if(A.destroyed)throw new Error("Hash instance has been destroyed");if(j&&A.finished)throw new Error("Hash#digest() has already been called")}e(uj,"exists");function c6(A,j){V(A);let r=j.outputLen;if(A.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}e(c6,"output");var iA=e(A=>new Uint32Array(A.buffer,A.byteOffset,Math.floor(A.byteLength/4)),"u32"),G6=e(A=>new DataView(A.buffer,A.byteOffset,A.byteLength),"createView"),O7=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!O7)throw new Error("Non little-endian hardware is not supported");function pj(A){if(typeof A!="string")throw new Error(`string expected, got ${typeof A}`);return new Uint8Array(new TextEncoder().encode(A))}e(pj,"utf8ToBytes");function QA(A){if(typeof A=="string")A=pj(A);else if(Ij(A))A=A.slice();else throw new Error(`Uint8Array expected, got ${typeof A}`);return A}e(QA,"toBytes");function d6(...A){let j=0;for(let t=0;t<A.length;t++){let B=A[t];V(B),j+=B.length}let r=new Uint8Array(j);for(let t=0,B=0;t<A.length;t++){let s=A[t];r.set(s,B),B+=s.length}return r}e(d6,"concatBytes");function I6(A,j){if(j==null||typeof j!="object")throw new Error("options must be defined");return Object.assign(A,j)}e(I6,"checkOpts");function u6(A,j){if(A.length!==j.length)return!1;let r=0;for(let t=0;t<A.length;t++)r|=A[t]^j[t];return r===0}e(u6,"equalBytes");var vj=e((A,j)=>(Object.assign(j,A),j),"wrapCipher");function Oj(A,j,r,t){if(typeof A.setBigUint64=="function")return A.setBigUint64(j,r,t);let B=BigInt(32),s=BigInt(4294967295),k=Number(r>>B&s),E=Number(r&s),o=t?4:0,i=t?0:4;A.setUint32(j+o,k,t),A.setUint32(j+i,E,t)}e(Oj,"setBigUint64");n();a();var p6;(function(A){A.Initial="initial",A.Create="create",A.ImportSeed="importSeed",A.ImportPrivateKey="importPrivateKey",A.ConnectHardware="connectHardware",A.SeedlessRecover="seedlessRecover",A.SeedlessBackup="seedlessBackup",A.SeedVault="seedVault",A.Append="append"})(p6||(p6={}));var f7=y.object({balance:y.boolean(),history:y.boolean()}),At=y.record(y.string(),f7),NA=class extends Error{static{e(this,"SetTermsAcknowledgementError")}constructor(j){super(j),this.name="SetTermsAcknowledgementError"}};var SA;(function(A){A.FirstTimeOnboarding="firstTimeOnboarding",A.IsResettingApp="isResettingApp",A.OnBoardedAt="onboardedAt"})(SA||(SA={}));var st=e(async(A,j)=>{try{return await A.set(cj.TermsHaveBeenAcknowledgedLastSeenVersion,j)}catch{throw new NA("Error Setting Terms Acknowledgement")}},"setTermsAcknowledgement");var Et=e(async A=>{try{return await A.remove(cj.TermsHaveBeenAcknowledgedLastSeenVersion)}catch{throw new NA("Error Clearing Terms Acknowledgement")}},"clearTermsAcknowledgement");n();a();var yA=uA(bA());var v6=(0,yA.createContext)(null);function m7({children:A,seedlessRepository:j}){return yA.default.createElement(v6.Provider,{value:{seedlessRepository:j}},A)}e(m7,"SeedlessProvider");function h7(){let A=(0,yA.useContext)(v6);if(!A)throw new Error("useSeedlessContext must be used within a SeedlessProvider");return A}e(h7,"useSeedlessContext");function R(){return h7().seedlessRepository}e(R,"useSeedlessRepository");n();a();n();a();var M7=y.record(y.string(),y.number()),g7=y.object({type:y.union([y.literal("Buffer"),y.literal("Object")]),data:y.array(y.number())}),x7=y.union([M7,g7]),O6=y.object({seeds:y.array(y.tuple([y.string(),x7]))}),f6=e(A=>K7(A)?new Uint8Array(Buffer.from(A.data)):new Uint8Array(Object.values(A)),"bundleBytesLikeToUint8Array"),K7=e(A=>!!A&&typeof A=="object"&&Gj("type",A)&&typeof A.type=="string"&&Gj("data",A)&&Array.isArray(A.data)&&A.data.every(j=>!Number.isNaN(parseInt(j))),"isSerializedBuffer"),m6=y.object({deviceId:y.string(),encryptionKey:y.string().length(44).base64()}),pA;(function(A){A.RotationResult="seedlessRotationResult",A.RecoverResult="seedlessRecoverResult",A.BackupResult="seedlessBackupResult"})(pA||(pA={}));n();a();n();a();var kA="/seedless",b7="https://phantom-wallet.zendesk.com/hc/en-us/articles/32775281256851";var h6="/seedless";n();a();var PA=class extends Error{static{e(this,"JuiceboxBackupError")}reasonString;reasonCode;constructor(j){super("Failed to backup share from Juicebox"),this.reasonCode=j,this.reasonString=ZA[j]}},HA=class extends Error{static{e(this,"JuiceboxRecoverError")}guessesRemaining;reasonString;reasonCode;constructor(j,r){super("Failed to recover share from Juicebox"),this.guessesRemaining=r,this.reasonCode=j,this.reasonString=tA[j]}},RA=class extends Error{static{e(this,"JuiceboxDeleteError")}reasonString;reasonCode;constructor(j){super("Failed to delete share from Juicebox"),this.reasonCode=j,this.reasonString=fj[j]}},ZA;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.Assertion=2]="Assertion",A[A.Transient=3]="Transient"})(ZA||(ZA={}));var tA;(function(A){A[A.InvalidPin=0]="InvalidPin",A[A.NotRegistered=1]="NotRegistered",A[A.InvalidAuth=2]="InvalidAuth",A[A.UpgradeRequired=3]="UpgradeRequired",A[A.Assertion=4]="Assertion",A[A.Transient=5]="Transient",A[A.CooldownTimer=6]="CooldownTimer"})(tA||(tA={}));var fj;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.RateLimitExceeded=2]="RateLimitExceeded",A[A.Assertion=3]="Assertion",A[A.Transient=4]="Transient"})(fj||(fj={}));var _7=e(A=>Aj(A)||M6(A)||g6(A),"isJuiceboxError"),Aj=e(A=>A instanceof HA,"isJuiceboxRecoverError"),M6=e(A=>A instanceof PA,"isJuiceboxBackupError"),g6=e(A=>A instanceof RA,"isJuiceboxDeleteError");globalThis.JuiceboxGetAuthToken=async A=>{let j=Buffer.from(A).toString("hex");return globalThis.JuiceboxTokens[j]};var mj=class{static{e(this,"JuiceboxClient")}encoder;provider;constructor(j){this.encoder=new TextEncoder,this.provider=j}async getJwts(j){let r=await Z.api().bearer(j).post(`${h6}/v1/juiceboxtoken`);(AA(r)||r.status===304)&&this.provider.setJuiceboxTokens(r.data)}async sendJuiceboxShare(j,r,t,B){await this.getJwts(B);try{await this.provider.backupShare(j,r,this.encoder.encode(t),this.encoder.encode("phantom"),7),G.addBreadcrumb(p.Seedless,"Successful backup share to Juicebox",g.Debug)}catch(s){G.addBreadcrumb(p.Seedless,"Failed to backup share to Juicebox",g.Error);let k=new PA(s);throw G.captureError(k,p.Seedless),k}return!0}async getJuiceboxShare(j,r,t){await this.getJwts(t);try{let B=await this.provider.recoverShare(j,this.encoder.encode(r),this.encoder.encode("phantom"));return G.addBreadcrumb(p.Seedless,"Successfully recovered share from Juicebox",g.Debug),B}catch(B){let s=B.reason,k=B.guessesRemaining!==void 0?B.guessesRemaining:B.guesses_remaining;G.addBreadcrumb(p.Seedless,"Failed to recover share from Juicebox",g.Error);let E=new HA(s,k);throw G.captureError(E,p.Seedless),E}}async deleteShare(j,r){await this.getJwts(r);try{await this.provider.deleteShare(j),G.addBreadcrumb(p.Seedless,"Successfully deleted share from Juicebox",g.Debug)}catch(t){G.addBreadcrumb(p.Seedless,"Failed to delete share from Juicebox",g.Error);let B=new RA(t);throw G.captureError(B,p.Seedless),B}}};n();a();n();a();var hj="@phantom/seedless",vA={hasSeedlessBundle:["seedless",`${hj}:has_seedless_bundle`],needsBundleUpdate:["seedless",`${hj}:needs_bundle_update`],timeLeftCooldown:["seedless",`${hj}:time_left_cooldown`]};function w7({enabled:A=!0}={}){let j=vA.hasSeedlessBundle,r=R(),t=WA();return _A({enabled:t&&A,queryKey:j,queryFn:e(async()=>await r.hasSeedlessBundle(),"queryFn")})}e(w7,"useHasSeedlessBundle");n();a();n();a();var cA=e(async A=>{await A.invalidateQueries({queryKey:vA.hasSeedlessBundle})},"invalidateHasSeedlessBundle"),sA=e(async A=>{await A.invalidateQueries({queryKey:vA.needsBundleUpdate})},"invalidateNeedsBundleUpdate");function y7(){let A=R(),j=jA(),r=BA();return rA({mutationFn:e(async({entropy:t,pin:B})=>await A.backup(t,B),"mutationFn"),onSuccess:e(async()=>{r.capture("seedlessBackupSuccess"),await cA(j),await sA(j)},"onSuccess"),onError:e(()=>{r.capture("seedlessBackupError")},"onError")})}e(y7,"useBackup");n();a();function Mj(){let A=R(),j=jA(),r=BA();return rA({mutationFn:e(async B=>await A.recover(B),"mutationFn"),onSuccess:e(async()=>{r.capture("seedlessRecoverSuccess"),await sA(j)},"onSuccess"),onError:e(()=>{r.capture("seedlessRecoverError")},"onError")})}e(Mj,"useRecover");n();a();function P7(){let A=R(),j=BA();return rA({mutationFn:e(async t=>{await A.verifyPin(t)},"mutationFn"),onSuccess:e(()=>{G.addBreadcrumb(p.Seedless,"Successfully verified PIN",g.Info),j.capture("seedlessVerifyPinSuccess")},"onSuccess"),onError:e(()=>{G.addBreadcrumb(p.Seedless,"Failed to verify PIN",g.Error),j.capture("seedlessVerifyPinError")},"onError")})}e(P7,"useVerifyPin");n();a();function H7(){let A=R(),j=jA();return rA({mutationFn:e(async()=>await A.deleteBundle(),"mutationFn"),onSuccess:e(async()=>{await cA(j),await sA(j)},"onSuccess")})}e(H7,"useDeleteBundle");n();a();function D7(){let A=R(),j=BA();return rA({mutationFn:e(async t=>await A.resetBundleFromDevice(t.pin,t.seedlessEntropies),"mutationFn"),onSuccess:e(()=>{G.addBreadcrumb(p.Seedless,"Successfully reset bundle from device",g.Info),j.capture("seedlessResetPinSuccess")},"onSuccess"),onError:e(()=>{G.addBreadcrumb(p.Seedless,"Failed to reset bundle from device",g.Error),j.capture("seedlessResetPinError")},"onError")})}e(D7,"useResetBundleFromDevice");n();a();var T7=1e3,L7=500;function gj(){let A=vA.timeLeftCooldown,j=R(),r=WA();return _A({enabled:r,queryKey:A,queryFn:e(async()=>await j.timeLeftCooldown(),"queryFn"),refetchInterval:T7,refetchOnMount:"always",staleTime:L7})}e(gj,"useTimeLeftCooldown");n();a();var jj=uA(bA());var x6=1e3,K6=e(()=>{let[A,j]=(0,jj.useState)(0);return(0,jj.useEffect)(()=>{if(!A)return;let r=setInterval(async()=>{j(A-x6)},x6);return()=>clearInterval(r)},[A]),{cooldownTimer:A,setCooldownTimer:j}},"useCheckCooldownTimer");n();a();var b6=uA(bA());var N7=e(()=>{let A=jA(),j=R(),r=zA(),t=$6(),B=a6();return(0,b6.useCallback)(async()=>{await r.deleteAllAuthFactors(),await t.patchUserProfile({privacyState:o6.INVISIBLE,addresses:B.reduce((s,k)=>(s[k]="",s),{})}),await j.deleteAllBundles(),await j.deleteJuiceboxShare(),await cA(A),await sA(A)},[j,r,t,A,B])},"useDeleteSeedlessProfile");n();a();var Kj=uA(bA());var S7="seedless-pin-verification-timer-in-ms",R7=y.string().transform(A=>Number(A)).pipe(y.number()).nullish().catch(null),C7=e(()=>{let A=R(),j=(0,Kj.useMemo)(()=>k6.getMultivariateAssignment(S7,{dependent_flag:"enable-seedless-pin-verification-interstitial",variation_served:"true"}),[]),r=(0,Kj.useMemo)(()=>R7.parse(j)??2592e6,[j]),t=e(async()=>{let{expired:B,timestampInMs:s}=await A.getPinVerificationTimer({pinVerificationExpiryInMs:r});return{expired:B,timestampInMs:s}},"queryFn");return _A({queryKey:[oA.SeedlessPinVerificationLockTimerInMs],queryFn:t,refetchInterval:r??2592e6,staleTime:r??2592e6})},"useSeedlessPinVerificationTimer");n();a();var bj=e(()=>{let A=jA(),j=R();return rA({mutationFn:e(async()=>{G.addBreadcrumb(p.Seedless,"Resetting PIN verification timer",g.Info),await j.setPinVerificationTimer(Date.now())},"mutationFn"),onSuccess:e(async()=>{G.addBreadcrumb(p.Seedless,"Successfully reset PIN verification timer",g.Info),await A.invalidateQueries({queryKey:[oA.SeedlessPinVerificationLockTimerInMs]})},"onSuccess"),onError:e(()=>{G.addBreadcrumb(p.Seedless,"Failed to reset PIN verification timer",g.Error)},"onError")})},"useResetSeedlessPinVerificationTimer");n();a();var GA=e(A=>{let j=_j(A),r=JSON.stringify(j),t=typeof r=="string"?r:String(r),B=typeof TextEncoder<"u"?new TextEncoder().encode(t):Buffer.from(t,"utf8");return VA(s6(B instanceof Uint8Array?B:Uint8Array.from(B)))},"hashJSON");function rj(A){return/^\d+$/.test(A)}e(rj,"isNumeric");var FA=e(A=>A.length!==4?!1:rj(A),"isValidPin"),_j=e(A=>{if(Array.isArray(A))return A.map(j=>typeof j=="object"?_j(j):j).sort();if(typeof A=="object"&&A!==null){let j={},r=Object.keys(A).sort();for(let t of r)j[t]=_j(A[t]);return j}else return A},"sortKeys"),wj=e(A=>{let j=Math.max(0,Math.floor(A/1e3)),r=Math.floor(j/60).toString(),t=j%60>9?`${j%60}`:`0${j%60}`;return{minutes:r,seconds:t}},"extractMinutesAndSeconds");n();a();var dA=uA(bA());n();a();var DA=class extends Error{static{e(this,"SeedlessRecoverError")}result;constructor(j){super(`Unable to recover seedless bundle: ${j.type}`),this.result=j}},tj=class extends Error{static{e(this,"SeedlessBackupError")}result;constructor(j){super(`Unable to backup seedless bundle: ${j.type}`),this.result=j}},TA=e(A=>A instanceof DA,"isSeedlessRecoverError"),X7=e(A=>TA(A)&&A.result.type==="unauthorized","isSeedlessUnauthorizedError"),yj=e(A=>TA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===tA.InvalidPin,"isSeedlessInvalidPinError"),Pj=e(A=>TA(A)&&A.result.type==="cooldown","isSeedlessCooldownError"),Hj=e(A=>TA(A)&&A.result.type==="upgrade-required","isSeedlessUpgradeRequiredError"),Dj=e(A=>TA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===tA.NotRegistered,"isSeedlessJuiceboxNotRegisteredError");var U7=e(({hasEnrolledAuthentication:A,onOnboardingDone:j,onOnboardingProtect:r,onImportAndSyncAccounts:t,onForgot:B,onNotRegisteredError:s})=>{let{t:k}=E6(),E=BA(),{refetch:o}=gj(),{mutateAsync:i}=bj(),{mutateAsync:$}=Mj(),F=B6("enable-cleanup-on-not-registered-error"),[m,O]=(0,dA.useState)(!1),[l,u]=(0,dA.useState)({isInvalidPin:!1,triesLeft:void 0,pin:""}),[d,M]=(0,dA.useState)(!1),{cooldownTimer:f,setCooldownTimer:x}=K6(),{minutes:K,seconds:Q}=wj(f),[P,U]=(0,dA.useState)(null);return(0,dA.useEffect)(()=>{!l.triesLeft||l.triesLeft>0||B()},[l.triesLeft,B]),(0,dA.useEffect)(()=>{e(async()=>{let{data:h=0}=await o();return h},"refetchTimer")().then(h=>x(h))},[]),{isLoading:d,isError:m,handleInput:e(v=>{u(h=>({...h,isInvalidPin:v!==""&&!rj(v),pin:v}))},"handleInput"),onSubmit:e(async()=>{if(!d){if(!FA(l.pin)){u(v=>({...v,isInvalidPin:!0,triesLeft:void 0,pin:""}));return}try{M(!0),O(!1),u(h=>({...h,isInvalidPin:!1,triesLeft:void 0}));let{entropy:v}=await $(l.pin);await t(v),await i(),E.capture("seedlessEnterPinContinue"),!A&&j?j():r?.()}catch(v){if(yj(v)||Pj(v)){let h;if("guessesRemaining"in v.result&&(h=v.result.guessesRemaining),h===0){u(b=>({...b,isInvalidPin:!0,triesLeft:h,pin:""})),B();return}let _=!1;"reason"in v.result&&v.result.reason===tA.InvalidPin&&(_=!0);let{data:w=0}=await o();x(w),E.capture("seedlessPinError",{data:{triesLeft:h,cooldownTimer:w}}),u(b=>({...b,isInvalidPin:_,triesLeft:h,pin:""}))}else if(Hj(v))O(!0),U({title:k("seedlessRecoverErrorUpgradeRequiredTitle"),description:k("seedlessRecoverErrorUpgradeRequiredDescription")});else if(Dj(v)&&s&&F){G.captureError(v,p.Seedless);try{await s(l.pin)}catch(h){G.captureError(h,p.Seedless),O(!0),U({title:k("seedlessEnterPinUnknownErrorPrimaryText"),description:k("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:k("seedlessTryAgain")})}}else G.captureError(v,p.Seedless),O(!0),U({title:k("seedlessEnterPinUnknownErrorPrimaryText"),description:k("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:k("seedlessTryAgain")})}finally{M(!1)}}},"onSubmit"),onForgot:B,pinAttemptsLeft:l.triesLeft,isPinError:l.isInvalidPin,hasCooldownTimer:f>0,disabled:f>0||l.isInvalidPin||!l.pin||l.pin.length<4,pin:l.pin,continueButtonText:k("seedlessContinueText"),forgotButtonText:k("seedlessVerifyPinForgotButtonText"),attemptsLeftText:k("seedlessEnterPinNumTriesLeft",{numTries:l.triesLeft}),cooldownTimerText:k("seedlessEnterPinCooldown",{minutesLeft:K,secondsLeft:Q}),invalidPinText:k("seedlessEnterPinInvalidPinError"),title:k("seedlessEnterPinPrimaryText"),loadingTitle:k("seedlessLoadingWalletPrimaryText"),loadingDescription:k("seedlessLoadingWalletSecondaryText"),errorTitle:P?P.title:k("seedlessLoadingWalletErrorPrimaryText"),errorDescription:P?P.description:k("seedlessErrorSecondaryText"),tryAgainButtonText:P?P.buttonText:k("seedlessTryAgain")}},"useSeedlessEnterPinProps");n();a();var _6=uA(bA());var V7=e(()=>{let A=R(),j=zA(),r=jA();return(0,_6.useCallback)(async()=>{await A.deleteAllBundles(),await j.deleteAllAuthFactors(),await cA(r),await sA(r)},[A,j,r])},"useDeleteSeedlessBundles");n();a();n();a();var ek=new Error("timeout while waiting for mutex to become available"),Bk=new Error("mutex already locked"),J7=new Error("request for lock canceled"),Y7=function(A,j,r,t){function B(s){return s instanceof r?s:new r(function(k){k(s)})}return e(B,"adopt"),new(r||(r=Promise))(function(s,k){function E($){try{i(t.next($))}catch(F){k(F)}}e(E,"fulfilled");function o($){try{i(t.throw($))}catch(F){k(F)}}e(o,"rejected");function i($){$.done?s($.value):B($.value).then(E,o)}e(i,"step"),i((t=t.apply(A,j||[])).next())})},Tj=class{static{e(this,"Semaphore")}constructor(j,r=J7){this._value=j,this._cancelError=r,this._weightedQueues=[],this._weightedWaiters=[]}acquire(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise((r,t)=>{this._weightedQueues[j-1]||(this._weightedQueues[j-1]=[]),this._weightedQueues[j-1].push({resolve:r,reject:t}),this._dispatch()})}runExclusive(j,r=1){return Y7(this,void 0,void 0,function*(){let[t,B]=yield this.acquire(r);try{return yield j(t)}finally{B()}})}waitForUnlock(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise(r=>{this._weightedWaiters[j-1]||(this._weightedWaiters[j-1]=[]),this._weightedWaiters[j-1].push(r),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(j){this._value=j,this._dispatch()}release(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);this._value+=j,this._dispatch()}cancel(){this._weightedQueues.forEach(j=>j.forEach(r=>r.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var j;for(let r=this._value;r>0;r--){let t=(j=this._weightedQueues[r-1])===null||j===void 0?void 0:j.shift();if(!t)continue;let B=this._value,s=r;this._value-=r,r=this._value+1,t.resolve([B,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(j){let r=!1;return()=>{r||(r=!0,this.release(j))}}_drainUnlockWaiters(){for(let j=this._value;j>0;j--)this._weightedWaiters[j-1]&&(this._weightedWaiters[j-1].forEach(r=>r()),this._weightedWaiters[j-1]=[])}},z7=function(A,j,r,t){function B(s){return s instanceof r?s:new r(function(k){k(s)})}return e(B,"adopt"),new(r||(r=Promise))(function(s,k){function E($){try{i(t.next($))}catch(F){k(F)}}e(E,"fulfilled");function o($){try{i(t.throw($))}catch(F){k(F)}}e(o,"rejected");function i($){$.done?s($.value):B($.value).then(E,o)}e(i,"step"),i((t=t.apply(A,j||[])).next())})},CA=class{static{e(this,"Mutex")}constructor(j){this._semaphore=new Tj(1,j)}acquire(){return z7(this,void 0,void 0,function*(){let[,j]=yield this._semaphore.acquire();return j})}runExclusive(j){return this._semaphore.runExclusive(()=>j())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};n();a();async function w6(A,j,r){let t=await A.decryptionKeySharePhantom.foldAsync(async i=>Buffer.from(new Uint8Array(i)).toString("base64")),B=Buffer.from(A.encryptedAccounts,"hex").toString("base64"),s=Buffer.from(A.encryptionKey,"hex").toString("base64"),k={ciphertext:B,encryptionKey:s,share:t,externalId:j,mode:"JUICEBOX"},E=await Z.api().bearer(r).headers({"Content-Type":"application/json"}).post(`${kA}/v1/bundles`,k),o=AA(E);return o||G.addBreadcrumb(p.Seedless,"Failed to backup bundle to backend",g.Error,{status:E.status,statusText:E.statusText}),o}e(w6,"sendSeedlessBundleToBackend");async function LA(A,j){let r=await Z.api().bearer(j).get(`${kA}/v1/bundles/${A}?mode=JUICEBOX`);if(r.status===404)throw new Error("bundle not found");if(!AA(r)){G.addBreadcrumb(p.Seedless,"Failed to recover bundle from backend",g.Error,{status:r.status,statusText:r.statusText});let t=new Error("Got invalid response from seedless backend: "+r.statusText);throw G.captureError(t,p.Seedless),t}if(!("share"in r.data)){G.addBreadcrumb(p.Seedless,"No share found in bundle",g.Error);let t=new Error("Did not receive share from seedless backend");throw G.captureError(t,p.Seedless),t}try{let t=z.from(new Uint8Array(Buffer.from(r.data.share,"base64"))),B=Buffer.from(r.data.ciphertext,"base64").toString("hex"),s=Buffer.from(r.data.encryptionKey,"base64").toString("hex");return{id:r.data.externalId,encryptedAccounts:B,encryptionKey:s,decryptionKeyShare1:t}}catch{throw new Error("Unable to parse bundle. Incorrect format.")}}e(LA,"recoverSeedlessBundle");async function y6(A){let j=await Z.api().bearer(A).get(`${kA}/v1/bundles?mode=JUICEBOX`);if(!AA(j))throw G.addBreadcrumb(p.Seedless,"Failed to recover all seedless bundles",g.Error,{status:j.status,statusText:j.statusText}),new Error("Failed to recover all seedless bundles.");try{if(!Array.isArray(j.data))throw new Error("Seedless bundles are not an array.");return j.data.map(r=>{if(typeof r!="object"||r===null||!("externalId"in r))throw new Error("No externalId found in bundle.");let t=r.externalId;if(typeof t!="string")throw new Error("External ID is not a string.");return{id:t}})}catch{throw new Error("Unable to parse seedless bundles. Incorrect format.")}}e(y6,"fetchAllSeedlessBundleIDs");async function ej(A,j){let r=await Z.api().bearer(j).get(`${kA}/v1/bundles/${A}?mode=JUICEBOX&populate=none`);if(G.addBreadcrumb(p.Seedless,"Checking if user has a se*dless bundle",g.Info),AA(r))return G.addBreadcrumb(p.Seedless,"A se*dless bundle has been found for this user",g.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return G.addBreadcrumb(p.Seedless,"No se*dless bundle found for user",g.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to check for se*dless bundle.");throw G.captureError(t,p.Seedless),t}e(ej,"hasSeedlessBundle");async function Bj(A,j){let r=await Z.api().bearer(j).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${kA}/v1/bundles/${A}`,{mode:"JUICEBOX"});if(G.addBreadcrumb(p.Seedless,`Deleting se*dless bundle: ${A}`,g.Info),AA(r))return G.addBreadcrumb(p.Seedless,"A se*dless bundle has been deleted for this user",g.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return G.addBreadcrumb(p.Seedless,"No se*dless bundle found for user",g.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to delete se*dless bundle.");throw G.captureError(t,p.Seedless),t}e(Bj,"deleteSeedlessBundle");async function P6(A){let j=await Z.api().bearer(A).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${kA}/v1/bundles`,{mode:"JUICEBOX"});if(G.addBreadcrumb(p.Seedless,"Deleting se*dless bundle",g.Info),AA(j))return G.addBreadcrumb(p.Seedless,"All se*dless bundles, if they exist, have been deleted for this user",g.Info,{status:j.status,statusText:j.statusText,data:j.data}),!0;let r=new Error("Failed to delete all se*dless bundles.");throw G.captureError(r,p.Seedless),r}e(P6,"deleteAllSeedlessBundles");async function Lj(A,j){let r=await Z.api().bearer(A).get(`${kA}/v1/device-encryption-keys/${j}`);if(r.status===404)return G.addBreadcrumb(p.Seedless,"No device encryption key found for user",g.Info),null;if(!AA(r))throw new Error("Unable to get device encryption key.");try{let{encryptionKey:t}=m6.parse(r.data);return z.from(new Uint8Array(Buffer.from(t,"base64")))}catch{throw new Error("Unable to parse device encryption key from response.")}}e(Lj,"getDeviceEncryptionKey");async function H6(A,j,r){let t=await Z.api().bearer(A).post(`${kA}/v1/device-encryption-keys`,{deviceId:j,encryptionKey:r.fold(B=>Buffer.from(B).toString("base64"))});if(!AA(t))throw new Error("Unable to set device encryption key.")}e(H6,"setDeviceEncryptionKey");async function D6(A,j){let r=await Z.api().bearer(A).delete(`${kA}/v1/device-encryption-keys/${j}`);if(!AA(r))throw new Error("Unable to delete device encryption key.")}e(D6,"deleteDeviceEncryptionKey");n();a();n();a();n();a();n();a();var Y=e((A,j)=>A[j++]&255|(A[j++]&255)<<8,"u8to16"),Nj=class{static{e(this,"Poly1305")}constructor(j){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,j=QA(j),V(j,32);let r=Y(j,0),t=Y(j,2),B=Y(j,4),s=Y(j,6),k=Y(j,8),E=Y(j,10),o=Y(j,12),i=Y(j,14);this.r[0]=r&8191,this.r[1]=(r>>>13|t<<3)&8191,this.r[2]=(t>>>10|B<<6)&7939,this.r[3]=(B>>>7|s<<9)&8191,this.r[4]=(s>>>4|k<<12)&255,this.r[5]=k>>>1&8190,this.r[6]=(k>>>14|E<<2)&8191,this.r[7]=(E>>>11|o<<5)&8065,this.r[8]=(o>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let $=0;$<8;$++)this.pad[$]=Y(j,16+2*$)}process(j,r,t=!1){let B=t?0:2048,{h:s,r:k}=this,E=k[0],o=k[1],i=k[2],$=k[3],F=k[4],m=k[5],O=k[6],l=k[7],u=k[8],d=k[9],M=Y(j,r+0),f=Y(j,r+2),x=Y(j,r+4),K=Y(j,r+6),Q=Y(j,r+8),P=Y(j,r+10),U=Y(j,r+12),J=Y(j,r+14),H=s[0]+(M&8191),v=s[1]+((M>>>13|f<<3)&8191),h=s[2]+((f>>>10|x<<6)&8191),_=s[3]+((x>>>7|K<<9)&8191),w=s[4]+((K>>>4|Q<<12)&8191),b=s[5]+(Q>>>1&8191),D=s[6]+((Q>>>14|P<<2)&8191),T=s[7]+((P>>>11|U<<5)&8191),L=s[8]+((U>>>8|J<<8)&8191),N=s[9]+(J>>>5|B),c=0,C=c+H*E+v*(5*d)+h*(5*u)+_*(5*l)+w*(5*O);c=C>>>13,C&=8191,C+=b*(5*m)+D*(5*F)+T*(5*$)+L*(5*i)+N*(5*o),c+=C>>>13,C&=8191;let X=c+H*o+v*E+h*(5*d)+_*(5*u)+w*(5*l);c=X>>>13,X&=8191,X+=b*(5*O)+D*(5*m)+T*(5*F)+L*(5*$)+N*(5*i),c+=X>>>13,X&=8191;let S=c+H*i+v*o+h*E+_*(5*d)+w*(5*u);c=S>>>13,S&=8191,S+=b*(5*l)+D*(5*O)+T*(5*m)+L*(5*F)+N*(5*$),c+=S>>>13,S&=8191;let nA=c+H*$+v*i+h*o+_*E+w*(5*d);c=nA>>>13,nA&=8191,nA+=b*(5*u)+D*(5*l)+T*(5*O)+L*(5*m)+N*(5*F),c+=nA>>>13,nA&=8191;let mA=c+H*F+v*$+h*i+_*o+w*E;c=mA>>>13,mA&=8191,mA+=b*(5*d)+D*(5*u)+T*(5*l)+L*(5*O)+N*(5*m),c+=mA>>>13,mA&=8191;let hA=c+H*m+v*F+h*$+_*i+w*o;c=hA>>>13,hA&=8191,hA+=b*E+D*(5*d)+T*(5*u)+L*(5*l)+N*(5*O),c+=hA>>>13,hA&=8191;let MA=c+H*O+v*m+h*F+_*$+w*i;c=MA>>>13,MA&=8191,MA+=b*o+D*E+T*(5*d)+L*(5*u)+N*(5*l),c+=MA>>>13,MA&=8191;let gA=c+H*l+v*O+h*m+_*F+w*$;c=gA>>>13,gA&=8191,gA+=b*i+D*o+T*E+L*(5*d)+N*(5*u),c+=gA>>>13,gA&=8191;let xA=c+H*u+v*l+h*O+_*m+w*F;c=xA>>>13,xA&=8191,xA+=b*$+D*i+T*o+L*E+N*(5*d),c+=xA>>>13,xA&=8191;let KA=c+H*d+v*u+h*l+_*O+w*m;c=KA>>>13,KA&=8191,KA+=b*F+D*$+T*i+L*o+N*E,c+=KA>>>13,KA&=8191,c=(c<<2)+c|0,c=c+C|0,C=c&8191,c=c>>>13,X+=c,s[0]=C,s[1]=X,s[2]=S,s[3]=nA,s[4]=mA,s[5]=hA,s[6]=MA,s[7]=gA,s[8]=xA,s[9]=KA}finalize(){let{h:j,pad:r}=this,t=new Uint16Array(10),B=j[1]>>>13;j[1]&=8191;for(let E=2;E<10;E++)j[E]+=B,B=j[E]>>>13,j[E]&=8191;j[0]+=B*5,B=j[0]>>>13,j[0]&=8191,j[1]+=B,B=j[1]>>>13,j[1]&=8191,j[2]+=B,t[0]=j[0]+5,B=t[0]>>>13,t[0]&=8191;for(let E=1;E<10;E++)t[E]=j[E]+B,B=t[E]>>>13,t[E]&=8191;t[9]-=8192;let s=(B^1)-1;for(let E=0;E<10;E++)t[E]&=s;s=~s;for(let E=0;E<10;E++)j[E]=j[E]&s|t[E];j[0]=(j[0]|j[1]<<13)&65535,j[1]=(j[1]>>>3|j[2]<<10)&65535,j[2]=(j[2]>>>6|j[3]<<7)&65535,j[3]=(j[3]>>>9|j[4]<<4)&65535,j[4]=(j[4]>>>12|j[5]<<1|j[6]<<14)&65535,j[5]=(j[6]>>>2|j[7]<<11)&65535,j[6]=(j[7]>>>5|j[8]<<8)&65535,j[7]=(j[8]>>>8|j[9]<<5)&65535;let k=j[0]+r[0];j[0]=k&65535;for(let E=1;E<8;E++)k=(j[E]+r[E]|0)+(k>>>16)|0,j[E]=k&65535}update(j){uj(this);let{buffer:r,blockLen:t}=this;j=QA(j);let B=j.length;for(let s=0;s<B;){let k=Math.min(t-this.pos,B-s);if(k===t){for(;t<=B-s;s+=t)this.process(j,s);continue}r.set(j.subarray(s,s+k),this.pos),this.pos+=k,s+=k,this.pos===t&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(j){uj(this),c6(j,this),this.finished=!0;let{buffer:r,h:t}=this,{pos:B}=this;if(B){for(r[B++]=1;B<16;B++)r[B]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let k=0;k<8;k++)j[s++]=t[k]>>>0,j[s++]=t[k]>>>8;return j}digest(){let{buffer:j,outputLen:r}=this;this.digestInto(j);let t=j.slice(0,r);return this.destroy(),t}};function W7(A){let j=e((t,B)=>A(B).update(QA(t)).digest(),"hashC"),r=A(new Uint8Array(32));return j.outputLen=r.outputLen,j.blockLen=r.blockLen,j.create=t=>A(t),j}e(W7,"wrapConstructorWithKey");var T6=W7(A=>new Nj(A));n();a();var N6=e(A=>Uint8Array.from(A.split("").map(j=>j.charCodeAt(0))),"_utf8ToBytes"),Q7=N6("expand 16-byte k"),Z7=N6("expand 32-byte k"),Ar=iA(Q7),S6=iA(Z7),hk=S6.slice();function q(A,j){return A<<j|A>>>32-j}e(q,"rotl");function Sj(A){return A.byteOffset%4===0}e(Sj,"isAligned32");var kj=64,jr=16,R6=2**32-1,L6=new Uint32Array;function rr(A,j,r,t,B,s,k,E){let o=B.length,i=new Uint8Array(kj),$=iA(i),F=Sj(B)&&Sj(s),m=F?iA(B):L6,O=F?iA(s):L6;for(let l=0;l<o;k++){if(A(j,r,t,$,k,E),k>=R6)throw new Error("arx: counter overflow");let u=Math.min(kj,o-l);if(F&&u===kj){let d=l/4;if(l%4!==0)throw new Error("arx: invalid block position");for(let M=0,f;M<jr;M++)f=d+M,O[f]=m[f]^$[M];l+=kj;continue}for(let d=0,M;d<u;d++)M=l+d,s[M]=B[M]^i[d];l+=u}}e(rr,"runCipher");function Rj(A,j){let{allowShortKeys:r,extendNonceFn:t,counterLength:B,counterRight:s,rounds:k}=I6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},j);if(typeof A!="function")throw new Error("core must be a function");return wA(B),wA(k),dj(s),dj(r),(E,o,i,$,F=0)=>{V(E),V(o),V(i);let m=i.length;if($||($=new Uint8Array(m)),V($),wA(F),F<0||F>=R6)throw new Error("arx: counter overflow");if($.length<m)throw new Error(`arx: output (${$.length}) is shorter than data (${m})`);let O=[],l=E.length,u,d;if(l===32)u=E.slice(),O.push(u),d=S6;else if(l===16&&r)u=new Uint8Array(32),u.set(E),u.set(E,16),d=Ar,O.push(u);else throw new Error(`arx: invalid 32-byte key, got length=${l}`);Sj(o)||(o=o.slice(),O.push(o));let M=iA(u);if(t){if(o.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(d,M,iA(o.subarray(0,16)),M),o=o.subarray(16)}let f=16-B;if(f!==o.length)throw new Error(`arx: nonce must be ${f} or 16 bytes`);if(f!==12){let K=new Uint8Array(12);K.set(o,s?0:12-o.length),o=K,O.push(o)}let x=iA(o);for(rr(A,d,M,x,i,$,F,k);O.length>0;)O.pop().fill(0);return $}}e(Rj,"createCipher");function U6(A,j,r,t,B,s=20){let k=A[0],E=A[1],o=A[2],i=A[3],$=j[0],F=j[1],m=j[2],O=j[3],l=j[4],u=j[5],d=j[6],M=j[7],f=B,x=r[0],K=r[1],Q=r[2],P=k,U=E,J=o,H=i,v=$,h=F,_=m,w=O,b=l,D=u,T=d,L=M,N=f,c=x,C=K,X=Q;for(let nA=0;nA<s;nA+=2)P=P+v|0,N=q(N^P,16),b=b+N|0,v=q(v^b,12),P=P+v|0,N=q(N^P,8),b=b+N|0,v=q(v^b,7),U=U+h|0,c=q(c^U,16),D=D+c|0,h=q(h^D,12),U=U+h|0,c=q(c^U,8),D=D+c|0,h=q(h^D,7),J=J+_|0,C=q(C^J,16),T=T+C|0,_=q(_^T,12),J=J+_|0,C=q(C^J,8),T=T+C|0,_=q(_^T,7),H=H+w|0,X=q(X^H,16),L=L+X|0,w=q(w^L,12),H=H+w|0,X=q(X^H,8),L=L+X|0,w=q(w^L,7),P=P+h|0,X=q(X^P,16),T=T+X|0,h=q(h^T,12),P=P+h|0,X=q(X^P,8),T=T+X|0,h=q(h^T,7),U=U+_|0,N=q(N^U,16),L=L+N|0,_=q(_^L,12),U=U+_|0,N=q(N^U,8),L=L+N|0,_=q(_^L,7),J=J+w|0,c=q(c^J,16),b=b+c|0,w=q(w^b,12),J=J+w|0,c=q(c^J,8),b=b+c|0,w=q(w^b,7),H=H+v|0,C=q(C^H,16),D=D+C|0,v=q(v^D,12),H=H+v|0,C=q(C^H,8),D=D+C|0,v=q(v^D,7);let S=0;t[S++]=k+P|0,t[S++]=E+U|0,t[S++]=o+J|0,t[S++]=i+H|0,t[S++]=$+v|0,t[S++]=F+h|0,t[S++]=m+_|0,t[S++]=O+w|0,t[S++]=l+b|0,t[S++]=u+D|0,t[S++]=d+T|0,t[S++]=M+L|0,t[S++]=f+N|0,t[S++]=x+c|0,t[S++]=K+C|0,t[S++]=Q+X|0}e(U6,"chachaCore");function tr(A,j,r,t){let B=A[0],s=A[1],k=A[2],E=A[3],o=j[0],i=j[1],$=j[2],F=j[3],m=j[4],O=j[5],l=j[6],u=j[7],d=r[0],M=r[1],f=r[2],x=r[3];for(let Q=0;Q<20;Q+=2)B=B+o|0,d=q(d^B,16),m=m+d|0,o=q(o^m,12),B=B+o|0,d=q(d^B,8),m=m+d|0,o=q(o^m,7),s=s+i|0,M=q(M^s,16),O=O+M|0,i=q(i^O,12),s=s+i|0,M=q(M^s,8),O=O+M|0,i=q(i^O,7),k=k+$|0,f=q(f^k,16),l=l+f|0,$=q($^l,12),k=k+$|0,f=q(f^k,8),l=l+f|0,$=q($^l,7),E=E+F|0,x=q(x^E,16),u=u+x|0,F=q(F^u,12),E=E+F|0,x=q(x^E,8),u=u+x|0,F=q(F^u,7),B=B+i|0,x=q(x^B,16),l=l+x|0,i=q(i^l,12),B=B+i|0,x=q(x^B,8),l=l+x|0,i=q(i^l,7),s=s+$|0,d=q(d^s,16),u=u+d|0,$=q($^u,12),s=s+$|0,d=q(d^s,8),u=u+d|0,$=q($^u,7),k=k+F|0,M=q(M^k,16),m=m+M|0,F=q(F^m,12),k=k+F|0,M=q(M^k,8),m=m+M|0,F=q(F^m,7),E=E+o|0,f=q(f^E,16),O=O+f|0,o=q(o^O,12),E=E+o|0,f=q(f^E,8),O=O+f|0,o=q(o^O,7);let K=0;t[K++]=B,t[K++]=s,t[K++]=k,t[K++]=E,t[K++]=d,t[K++]=M,t[K++]=f,t[K++]=x}e(tr,"hchacha");var er=Rj(U6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Br=Rj(U6,{counterRight:!1,counterLength:8,extendNonceFn:tr,allowShortKeys:!1});var kr=new Uint8Array(16),C6=e((A,j)=>{A.update(j);let r=j.length%16;r&&A.update(kr.subarray(r))},"updatePadded"),sr=new Uint8Array(32);function X6(A,j,r,t,B){let s=A(j,r,sr),k=T6.create(s);B&&C6(k,B),C6(k,t);let E=new Uint8Array(16),o=G6(E);Oj(o,0,BigInt(B?B.length:0),!0),Oj(o,8,BigInt(t.length),!0),k.update(E);let i=k.digest();return s.fill(0),i}e(X6,"computeTag");var V6=e(A=>(j,r,t)=>(V(j,32),V(r),{encrypt:e((s,k)=>{let E=s.length,o=E+16;k?V(k,o):k=new Uint8Array(o),A(j,r,s,k,1);let i=X6(A,j,r,k.subarray(0,-16),t);return k.set(i,E),k},"encrypt"),decrypt:e((s,k)=>{let E=s.length,o=E-16;if(E<16)throw new Error("encrypted data must be at least 16 bytes");k?V(k,o):k=new Uint8Array(o);let i=s.subarray(0,-16),$=s.subarray(-16),F=X6(A,j,r,i,t);if(!u6($,F))throw new Error("invalid tag");return A(j,r,i,k,1),k},"decrypt")}),"_poly1305_aead"),Pk=vj({blockSize:64,nonceLength:12,tagLength:16},V6(er)),Cj=vj({blockSize:64,nonceLength:24,tagLength:16},V6(Br));n();a();n();a();var OA=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function J6(A=32){if(OA&&typeof OA.getRandomValues=="function")return OA.getRandomValues(new Uint8Array(A));throw new Error("crypto.getRandomValues must be defined")}e(J6,"randomBytes");function Xj(){if(OA&&typeof OA.subtle=="object"&&OA.subtle!=null)return OA.subtle;throw new Error("crypto.subtle must be defined")}e(Xj,"getWebcryptoSubtle");function Uj(A){return wA(A.nonceLength),(j,...r)=>({encrypt:e((t,...B)=>{let{nonceLength:s}=A,k=J6(s),E=A(j,k,...r).encrypt(t,...B),o=d6(k,E);return E.fill(0),o},"encrypt"),decrypt:e((t,...B)=>{let{nonceLength:s}=A,k=t.subarray(0,s),E=t.subarray(s);return A(j,k,...r).decrypt(E,...B)},"decrypt")})}e(Uj,"managedNonce");var Y6={async encrypt(A,j,r,t){let B=Xj(),s=await B.importKey("raw",A,j,!0,["encrypt"]),k=await B.encrypt(r,s,t);return new Uint8Array(k)},async decrypt(A,j,r,t){let B=Xj(),s=await B.importKey("raw",A,j,!0,["decrypt"]),k=await B.decrypt(r,s,t);return new Uint8Array(k)}},EA={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function Er(A,j,r){if(A===EA.CBC)return{name:EA.CBC,iv:j};if(A===EA.CTR)return{name:EA.CTR,counter:j,length:64};if(A===EA.GCM)return r?{name:EA.GCM,iv:j,additionalData:r}:{name:EA.GCM,iv:j};throw new Error("unknown aes block mode")}e(Er,"getCryptParams");function Vj(A){return(j,r,t)=>{V(j),V(r);let B={name:A,length:j.length*8},s=Er(A,r,t);return{encrypt(k){return V(k),Y6.encrypt(j,B,s,k)},decrypt(k){return V(k),Y6.decrypt(j,B,s,k)}}}}e(Vj,"generate");var Jk=Vj(EA.CBC),Yk=Vj(EA.CTR),zk=Vj(EA.GCM);n();a();n();a();function Jj(A){return self.crypto.getRandomValues(new Uint8Array(A))}e(Jj,"getRandomBytes");var Ej=new Uint8Array([0,255,200,8,145,16,208,54,90,62,216,67,153,119,254,24,35,32,7,112,161,108,12,127,98,139,64,70,199,75,224,14,235,22,232,173,207,205,57,83,106,39,53,147,212,78,72,195,43,121,84,40,9,120,15,33,144,135,20,42,169,156,214,116,180,124,222,237,177,134,118,164,152,226,150,143,2,50,28,193,51,238,239,129,253,48,92,19,157,41,23,196,17,68,140,128,243,115,66,30,29,181,240,18,209,91,65,162,215,44,233,213,89,203,80,168,220,252,242,86,114,166,101,47,159,155,61,186,125,194,69,130,167,87,182,163,122,117,79,174,63,55,109,71,97,190,171,211,95,176,88,175,202,94,250,133,228,77,138,5,251,96,183,123,184,38,74,103,198,26,248,105,37,179,219,189,102,221,241,210,223,3,141,52,217,146,13,99,85,170,73,236,188,149,60,132,11,245,230,231,229,172,126,110,185,249,218,142,154,201,36,225,10,21,107,58,160,81,244,234,178,151,158,93,34,136,148,206,25,1,113,76,165,227,197,49,187,204,31,45,59,82,111,246,46,137,247,192,104,27,100,4,6,191,131,56]),z6=new Uint8Array([1,229,76,181,251,159,252,18,3,52,212,196,22,186,31,54,5,92,103,87,58,213,33,90,15,228,169,249,78,100,99,238,17,55,224,16,210,172,165,41,51,89,59,48,109,239,244,123,85,235,77,80,183,42,7,141,255,38,215,240,194,126,9,140,26,106,98,11,93,130,27,143,46,190,166,29,231,157,45,138,114,217,241,39,50,188,119,133,150,112,8,105,86,223,153,148,161,144,24,187,250,122,176,167,248,171,40,214,21,142,203,242,19,230,120,97,63,137,70,13,53,49,136,163,65,128,202,23,95,83,131,254,195,155,69,57,225,245,158,25,94,182,207,75,56,4,185,43,226,193,74,221,72,12,208,125,61,88,222,124,216,20,107,135,71,232,121,132,115,60,189,146,201,35,139,151,149,68,220,173,64,101,134,162,164,204,127,236,192,175,145,253,247,79,129,47,91,234,168,28,2,209,152,113,237,37,227,36,6,104,179,147,44,111,62,108,10,184,206,174,116,177,66,180,30,211,73,233,156,200,198,199,34,110,219,32,191,67,81,82,102,178,118,96,218,197,243,246,170,205,154,160,117,84,14,1]);function sj(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");return A^j}e(sj,"add");function nr(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");if(j===0)throw new Error("cannot divide by zero");let r=Ej[A],t=Ej[j],B=(r-t+255)%255,s=z6[B];return A===0?0:s}e(nr,"div");function Yj(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");let r=Ej[A],t=Ej[j],B=(r+t)%255,s=z6[B];return A===0||j===0?0:s}e(Yj,"mult");function ar(A,j,r){if(A.length!==j.length)throw new Error("sample length mistmatch");let t=A.length,B=0,s=0;for(let k=0;k<t;k++){B=1;for(let E=0;E<t;++E){if(k===E)continue;let o=sj(r,A[E]),i=sj(A[k],A[E]),$=nr(o,i);B=Yj(B,$)}s=sj(s,Yj(j[k],B))}return s}e(ar,"interpolatePolynomial");function or(A,j,r){if(j===0)throw new Error("cannot evaluate secret polynomial at zero");let t=A[r];for(let B=r-1;B>=0;B--){let s=A[B];t=sj(Yj(t,j),s)}return t}e(or,"evaluate");function W6(){return Jj(1)[0]}e(W6,"getRandomByte");function $r(){for(;;){let A=W6();if(A>0)return A}}e($r,"getNonZeroRandomByte");function ir(A,j){let r=new Uint8Array(j+1);r[0]=A;for(let t=1;t<=j;t++){let B=t===j;r[t]=B?$r():W6()}return r}e(ir,"newCoefficients");function qr(){let A=new Uint8Array(255);for(let r=0;r<255;r++)A[r]=r+1;let j=Jj(255);for(let r=0;r<255;r++){let t=j[r]%255,B=A[r];A[r]=A[t],A[t]=B}return A}e(qr,"newCoordinates");var W={instanceOf(A,j,r){if(A.constructor!==j)throw new TypeError(r)},inRange(A,j,r,t){if(!(j<r&&A>=j&&A<r))throw new RangeError(t)},greaterThanOrEqualTo(A,j,r){if(A<j)throw new Error(r)},equalTo(A,j,r){if(A!==j)throw new Error(r)}};async function Q6(A,j,r){W.instanceOf(A,Uint8Array,"secret must be a Uint8Array"),W.greaterThanOrEqualTo(A.byteLength,1,"secret cannot be empty"),W.instanceOf(j,Number,"shares must be a number"),W.inRange(j,2,256,"shares must be at least 2 and at most 255"),W.instanceOf(r,Number,"threshold must be a number"),W.inRange(r,2,256,"threshold must be at least 2 and at most 255"),W.greaterThanOrEqualTo(j,r,"shares cannot be less than threshold");let t=[],B=A.byteLength,s=qr();for(let E=0;E<j;E++){let o=new Uint8Array(B+1);o[B]=s[E],t.push(o)}let k=r-1;for(let E=0;E<B;E++){let o=A[E],i=ir(o,k);for(let $=0;$<j;++$){let F=s[$],m=or(i,F,k);t[$][E]=m}}return t}e(Q6,"split");async function Z6(A){W.instanceOf(A,Array,"shares must be an Array"),W.inRange(A.length,2,256,"shares must have at least 2 and at most 255 elements");let j=A[0];W.instanceOf(j,Uint8Array,"each share must be a Uint8Array");for(let i of A)W.instanceOf(i,Uint8Array,"each share must be a Uint8Array"),W.greaterThanOrEqualTo(i.byteLength,2,"each share must be at least 2 bytes"),W.equalTo(i.byteLength,j.byteLength,"all shares must have the same byte length");let r=A.length,t=j.byteLength,B=t-1,s=new Uint8Array(B),k=new Uint8Array(r),E=new Uint8Array(r),o=new Set;for(let i=0;i<r;i++){let F=A[i][t-1];if(o.has(F))throw new Error("shares must contain unique values but a duplicate was found");o.add(F),k[i]=F}for(let i=0;i<B;i++){for(let $=0;$<r;++$)E[$]=A[$][i];s[i]=ar(k,E,0)}return s}e(Z6,"combine");var A7=e(async(A,j)=>{if(A.length!==32)throw new Error("encryption key must be 32 bytes");lr(A);let r={seeds:[]};for(let i of j){let $="unused",F=i.fold(m=>new Uint8Array(m));r.seeds.push([$,F])}let t=Uj(Cj)(A),B=pj(JSON.stringify(r)),s=t.encrypt(B),[k,E]=await Q6(A,2,2);return{encryptedAccounts:VA(s),decryptionKeySharePhantom:z.from(k),decryptionKeyShareExternal:z.from(E),encryptionKey:"unused"}},"encryptAccounts"),IA=class extends Error{static{e(this,"SeedlessDecryptionError")}reason;constructor(j){super(`Unable to decrypt seedless bundle: ${j}`),this.reason=j}},nj=e(async A=>{let j;try{j=await Fr(A.decryptionKeySharePhantom,A.decryptionKeyShareExternal)}catch{throw new IA("incompatible-shares")}let r;try{r=Uj(Cj)(j).decrypt(t6(A.encryptedAccounts))}catch{throw new IA("incorrect-decryption-key")}let t;try{t=JSON.parse(Buffer.from(r).toString())}catch{throw new IA("invalid-json")}let B=O6.safeParse(t);if(!B.success)throw new IA("invalid-format");return B.data.seeds.map(E=>{let o=E[1],i=f6(o);return z.from(i)})},"decryptAccounts"),Fr=e(async(A,j)=>{let r=A.fold(s=>new Uint8Array(s)),t=j.fold(s=>new Uint8Array(s));return await Z6([r,t])},"getDecryptionKeyFromShares"),lr=e(A=>{if(A.every(j=>j===0))throw new Error("encryption key must not be all zeros")},"validateNotZero");n();a();var j7={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var r7={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var t7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var e7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev/"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var B7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f76005fd-80e5-483e-9d84-c09ef7c60ba3",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var k7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"153ebe7b-400c-4d27-be76-139248bb3acd",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var s7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f577175c-3f1e-4f4a-91d1-cb30aaa0d5d4",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var aj=[j7,r7],E7=aj.reduce((A,j)=>(A[GA(j)]=j,A),{}),n7=[t7,e7,B7,k7,s7],Or=n7.reduce((A,j)=>(A[GA(j)]=j,A),{});function oj(){return qj()||Fj()===ij.Production?E7:Or}e(oj,"getSupportedConfigs");function fA(){if(qj())return aj[aj.length-1];let A=Fj()===ij.Production?aj:n7;return A[A.length-1]}e(fA,"getLatestConfig");var eA={success:{type:"success",didBackup:!0},unauthorized:{type:"unauthorized",didBackup:!1},bundleAlreadyExists:{type:"bundle-already-exists",didBackup:!1},errorBackendCheck:{type:"error-backend-check",didBackup:!1},invalidPin:{type:"invalid-pin-format",didBackup:!1},errorEncryptionFailed:{type:"error-encryption-failed",didBackup:!1},errorBackendUpload:{type:"error-backend-upload",didBackup:!1},errorJuiceboxUpload:{type:"error-juicebox-upload",didBackup:!1},recoveredFromJuiceboxError:{type:"recovered-juicebox-error",didBackup:!1},errorBackendDelete:{type:"error-backend-delete",didBackup:!1}},XA=e(async(A,{pin:j,entropy:r})=>{if(!FA(j))return eA.invalidPin;let t;try{if(t=await A.authRepository.getUser(),!t)return eA.unauthorized}catch{return eA.unauthorized}let B=fA(),s=GA(B);try{if(await ej(s,t.accessToken))return eA.bundleAlreadyExists}catch{return eA.errorBackendCheck}let k;try{let $=JA(32);k=await A7($,[r])}catch{return eA.errorEncryptionFailed}try{if(!await w6(k,s,t.accessToken))return eA.errorBackendUpload}catch{return eA.errorBackendUpload}let E=k.decryptionKeyShareExternal.fold($=>new Uint8Array($)),o=await A.juiceboxClient(),i=!0;try{i=await o.sendJuiceboxShare(fA(),E,j,t.accessToken)}catch{i=!1}if(!i)try{return await Bj(s,t.accessToken),eA.recoveredFromJuiceboxError}catch{return eA.errorBackendDelete}return eA.success},"backupBundle");n();a();var a7="seedlessJuiceboxPinCooldownTimer",zj=".phantom.seedless.juiceboxPinCooldownTimer",UA=e(async A=>{let j=await A.get(a7),r=await A.get(zj),t=r?.timeRemaining||j,B=r?.guessesRemaining;return!t||t<0?{timeRemaining:0,guessesRemaining:B}:{timeRemaining:t-Date.now(),guessesRemaining:B}},"cooldownTimeLeft"),o7=e(async(A,j)=>{let r=mr(A);if(!r)return;let t=Date.now()+r*1e3;j.set(zj,{version:2,timeRemaining:t,guessesRemaining:A})},"updateCooldownTimer"),$7=e(async A=>{await A.remove(a7),await A.remove(zj)},"resetCooldownTimer"),mr=e(A=>hr[A],"getCooldownTimeInSeconds"),hr={[7]:0,[6]:0,[5]:30,[4]:60,[3]:120,[2]:300,[1]:300};n();a();n();a();var i7=e(async(A,j,r)=>{let t=[];try{t=await y6(A)}catch{return{status:"error-fetch-all-seedless-bundles"}}let B=t.filter(s=>s.id!==r).map(s=>s.id);if(B.length===0)return{status:"no-other-bundles-found"};for(let s of B)try{let k=await LA(s,A),E=await nj({encryptedAccounts:k.encryptedAccounts,encryptionKey:k.encryptionKey,decryptionKeySharePhantom:k.decryptionKeyShare1,decryptionKeyShareExternal:z.from(j)});if(E.length===0)continue;return{status:"found-valid-bundle",entropies:E}}catch{continue}return{status:"error-no-decryptable-accounts"}},"recoverFirstValidBundle");var gr=e(A=>{let j="unknown";return A instanceof Error&&(A.message.includes("bundle not found")?j="bundle-not-found":A.message.includes("Got invalid response from seedless backend")?j="non-ok-response":A.message.includes("Did not receive share from seedless backend")?j="no-share-in-bundle":A.message.includes("Unable to parse bundle. Incorrect format.")&&(j="incorrect-format")),{type:"error-backend-recover",reason:j}},"handleBackendRecoverError"),q7=e(async(A,j,{pin:r,ignoreCooldown:t=!1})=>{let{authRepository:B,juiceboxClient:s,storage:k}=A,{timeRemaining:E,guessesRemaining:o}=await UA(k);if(E>0&&!t)return{type:"cooldown",timeRemaining:E,guessesRemaining:o};if(!FA(r))return{type:"invalid-pin-format"};let i=await B.getUser();if(!i)return{type:"unauthorized"};let{accessToken:$}=i,F;try{F=await LA("latest",$)}catch(f){return gr(f)}let m=oj()[F.id];if(!m)return{type:"upgrade-required"};let O=await s(),l;try{l=new Uint8Array(await O.getJuiceboxShare(m,r,$)),await $7(k)}catch(f){let x=f?.reasonCode,K=f?.guessesRemaining;if(Aj(f))if(!t&&K&&K<=5){await o7(K,k);let{timeRemaining:P}=await UA(k);return{type:"cooldown",timeRemaining:P,guessesRemaining:K}}else return{type:"error-juicebox-recover",reason:x,guessesRemaining:K};else return{type:"error-juicebox-recover",reason:x||"unknown"}}if(l.every(f=>f===0))return{type:"error-juicebox-share-zero"};let d;try{d=await nj({encryptedAccounts:F.encryptedAccounts,encryptionKey:F.encryptionKey,decryptionKeySharePhantom:F.decryptionKeyShare1,decryptionKeyShareExternal:z.from(l)})}catch(f){let x;f instanceof IA?x=f.reason:x="unknown";let K=await i7($,l,F.id);if(K.status==="found-valid-bundle")G.addBreadcrumb(p.Seedless,"Recovered from older bundle",g.Info),d=K.entropies;else return K.status==="no-other-bundles-found"?{type:"error-decrypt-accounts",reason:x}:{type:"error-decrypt-accounts",reason:K.status}}if(d.length===0)return{type:"error-no-entropies"};let M=await XA(A,{entropy:d[0],pin:r});return j.emitRotationResult(M),{type:"success",entropy:d[0]}},"recoverBundle");n();a();var $j=class extends n6{static{e(this,"SeedlessEventEmitter")}emitRotationResult(j){this.emitEvent(pA.RotationResult,{type:j.type,didRotate:j.didBackup})}emitRecoverResult(j){let r=j.type,t;"reason"in j&&(typeof j.reason=="string"?t=j.reason:t=tA[j.reason]),this.emitEvent(pA.RecoverResult,{type:r,reason:t})}emitBackupResult(j){this.emitEvent(pA.BackupResult,{type:j.type,didBackup:j.didBackup})}};var xr=e(A=>{let j=new $j,r=new CA,t={backup:e((k,E)=>r.runExclusive(async()=>await br(A,k,E,j)),"backup"),recover:e(k=>r.runExclusive(async()=>await F7(A,k,!1,j)),"recover"),verifyPin:e(k=>r.runExclusive(async()=>await _r(A,k,!0,j)),"verifyPin"),resetBundleFromDevice:e((k,E)=>r.runExclusive(async()=>await Kr(A,k,E)),"resetBundleFromDevice")},B=new CA;return{...t,hasSeedlessBundle:e(k=>yr(A,k),"hasSeedlessBundle"),deleteBundle:e(()=>Qj(A,"latest"),"deleteBundle"),deleteAllBundles:e(()=>Qj(A,"all"),"deleteAllBundles"),deleteJuiceboxShare:e(()=>Pr(A),"deleteJuiceboxShare"),needsBundleUpdate:e(()=>wr(A),"needsBundleUpdate"),timeLeftCooldown:e(()=>Hr(A),"timeLeftCooldown"),getPinVerificationTimer:e(({pinVerificationExpiryInMs:k})=>Dr({...A,pinVerificationExpiryInMs:k}),"getPinVerificationTimer"),setPinVerificationTimer:e(k=>Tr(A,k),"setPinVerificationTimer"),...{getDeviceEncryptionKey:e(()=>B.runExclusive(async()=>await Lr(A)),"getDeviceEncryptionKey")},generateDeviceEncryptionKey:c7,setDeviceEncryptionKey:e(k=>d7(A,k),"setDeviceEncryptionKey"),deleteDeviceEncryptionKey:e(()=>Nr(A),"deleteDeviceEncryptionKey"),getOrCreateSeedlessDeviceID:e(()=>G7(A),"getOrCreateSeedlessDeviceID"),subscribe:e((k,E)=>j.subscribe(k,E),"subscribe")}},"createSeedlessRepository"),Wj={},Kr=e(async(A,j,r)=>{if(!FA(j))throw new Error("Invalid PIN provided. Only numbers are accepted.");await Qj(A);let t=await XA(A,{pin:j,entropy:r[0]});if(t.type!=="success"&&t.type!=="bundle-already-exists")throw new Error(`Failed to backup bundle: ${t.type}`);return{entropy:r[0]}},"resetBundleFromDevice"),br=e(async(A,j,r,t)=>{let B=await XA(A,{pin:r,entropy:j});if(t.emitBackupResult(B),B.type!=="success")throw new tj(B)},"backup"),F7=e(async(A,j,r=!1,t)=>{let B=await q7(A,t,{pin:j,ignoreCooldown:r});if(t.emitRecoverResult(B),B.type!=="success")throw new DA(B);return{entropy:B.entropy}},"recover"),_r=e(async(A,j,r=!0,t)=>{await F7(A,j,r,t)},"verifyPin"),wr=e(async({authRepository:A})=>{let j=await A.getUser();if(!j)throw new Error("User is not logged in, cannot check for seedless bundle update");let{accessToken:r}=j,t,B=GA(fA());try{t=await LA("latest",r)}catch(k){if(k instanceof Error&&k.message==="bundle not found")return!1;throw k}return!!oj()[t.id]&&t.id!==B},"needsBundleUpdate"),yr=e(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot check for se*dless bundle");let{accessToken:t}=r;return await ej(j,t)},"hasSeedlessBundle"),Qj=e(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot delete se*dless bundle");let{accessToken:t}=r;if(j==="all")return await P6(t);let B=GA(fA());return await Bj(B,t)},"deleteSeedlessBundle"),Pr=e(async A=>{let j=await A.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot delete juicebox share");let{accessToken:r}=j;await(await A.juiceboxClient()).deleteShare(fA(),r)},"deleteJuiceboxShare"),Hr=e(async({storage:A})=>{let{timeRemaining:j}=await UA(A);return j},"timeLeftCooldown"),Dr=e(async({storage:A,pinVerificationExpiryInMs:j})=>{let r=Date.now(),t=await A.get(oA.SeedlessPinVerificationLockTimerInMs)??Date.now();return{expired:r>=t+(j??2592e6),timestampInMs:t}},"getPinVerificationTimer"),Tr=e(async({storage:A},j)=>{await A.set(oA.SeedlessPinVerificationLockTimerInMs,j)},"setPinVerificationTimer"),Zj=e(async A=>(await A.get(oA.SeedlessDeviceID))?.deviceID??null,"fetchSeedlessDeviceID"),l7=e(async(A,j)=>{await A.set(oA.SeedlessDeviceID,{version:1,deviceID:j})},"storeSeedlessDeviceID"),c7=e(()=>{let A=JA(32);try{return Promise.resolve(z.from(A))}finally{A.fill(0)}},"generateDeviceEncryptionKey"),G7=e(async({storage:A})=>{let j=await Zj(A);return j||(j=lj(),await l7(A,j)),j},"getOrCreateSeedlessDeviceID"),Lr=e(async A=>{let{authRepository:j}=A,r=await j.getUser();if(!r)throw new Error("User not logged in, cannot retrieve device encryption key.");let t=await G7(A),B=Wj[t];if(B)return B;let s=await Lj(r.accessToken,t);return s||(s=await c7(),await d7(A,s)),Wj[t]=s,s},"getDeviceEncryptionKey"),d7=e(async({authRepository:A,storage:j},r)=>{let t=await A.getUser();if(!t)throw new Error("User not logged in, cannot set device encryption key.");let B=await Zj(j);return B||(B=lj(),await l7(j,B)),await H6(t.accessToken,B,r),Wj[B]=r,r},"setDeviceEncryptionKey"),Nr=e(async({authRepository:A,storage:j})=>{let r=await A.getUser();if(!r)throw new Error("User not logged in, cannot delete device encryption key.");let t=await Zj(j);if(!t)return null;let B=await Lj(r.accessToken,t);return B?(await D6(r.accessToken,t),B):null},"deleteDeviceEncryptionKey");n();a();n();a();var A6={};p7(A6,{default:()=>j6});var j6="./juicebox-sdk_bg-LUYFYBUJ.wasm";i6(A6);var I7=!1,Rr=e(async()=>{if(I7)return;let A=await import("./juicebox-sdk_bg-KZZGMTGP.js"),j=await WebAssembly.instantiateStreaming(fetch(j6),{"./juicebox-sdk_bg.js":A});A.__wbg_set_wasm(j.instance.exports),I7=!0},"initWasm");function u7(A){globalThis.JuiceboxTokens=A}e(u7,"setGlobalJuiceboxTokens");u7({});var r6=class{static{e(this,"JuiceboxProvider")}setJuiceboxTokens(j){u7(j)}async backupShare(j,r,t,B,s){await(await this.client(j)).register(t,r,B,s)}async recoverShare(j,r,t){return await(await this.client(j)).recover(r,t)}async deleteShare(j){await(await this.client(j)).delete()}async client(j){return await Rr(),new q6(new F6(j),[])}};n();a();var wn=[SA.FirstTimeOnboarding,SA.IsResettingApp],yn=[YA.Seed,YA.Seedless,YA.PrivateKey],Pn="https://phantom-wallet.zendesk.com/hc/en-us/articles/33478025712531";n();a();var lA=uA(v7(),1);var Vn=e(async()=>{let A=$A("hasOnboarded"),j=await aA(lA.default.runtime,A);if("error"in j)throw new Error(j.error.message);return j.result},"hasOnboarded"),Jn=e(async()=>{let A=$A("resetHasOnboarded"),j=await aA(lA.default.runtime,A);if("error"in j)throw new Error(j.error.message);return j.result},"resetHasOnboarded"),Yn=e(async A=>{let j=$A("unlockExtension",A),r=await G.startSpan("unlockExtension",()=>aA(lA.default.runtime,j));if("error"in r)throw new Error(r.error.message);if(!r.result)throw new Error("Missing unlock extension response.");let{isUnlocked:t,migrationResult:B}=r.result;if(t===void 0)throw new Error("Missing isUnlocked in unlock response.");if(B===void 0)throw new Error("Missing migrationResult in unlock response.");switch(B){case"success":await l6.invalidateQueries({refetchType:"all"});break;case"no-migration":case"failure":break;default:e6(B)}return{isUnlocked:t,migrationResult:B}},"unlockExtension"),zn=e(async()=>{let A=$A("IsExtensionUnlocked"),j=await G.startSpan("isExtensionUnlocked",()=>aA(lA.default.runtime,A));if("error"in j)throw new Error(j.error.message);return j.result},"isExtensionUnlocked"),Wn=e(async()=>{let A=$A("lockExtension"),j=await G.startSpan("lockExtension",()=>aA(lA.default.runtime,A));if("error"in j)throw new Error(j.error.message);return j.result},"lockExtension"),Qn=e(async A=>{let j=$A("setPassword",A),r=await G.startSpan("setPassword",()=>aA(lA.default.runtime,j));if("error"in r)throw new Error(r.error.message);return r.result},"setPassword"),Zn=e(async A=>{let j=$A("verifyPassword",A),r=await G.startSpan("verifyPassword",()=>aA(lA.default.runtime,j));if("error"in r)throw new Error(r.error.message);return r.result},"verifyPassword"),Aa=e(async(A,j)=>{let r=$A("updatePassword",[A,j]),t=await G.startSpan("updatePassword",()=>aA(lA.default.runtime,r));if("error"in t)throw new Error(t.error.message);return t.result},"updatePassword");export{p6 as a,SA as b,st as c,Et as d,wn as e,yn as f,Pn as g,pA as h,b7 as i,tA as j,_7 as k,M6 as l,mj as m,m7 as n,w7 as o,y7 as p,Mj as q,P7 as r,H7 as s,D7 as t,gj as u,N7 as v,C7 as w,bj as x,FA as y,wj as z,TA as A,X7 as B,yj as C,Pj as D,Hj as E,U7 as F,V7 as G,xr as H,r6 as I,Vn as J,Jn as K,Yn as L,zn as M,Wn as N,Qn as O,Zn as P,Aa as Q};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-IWYOR6BJ.js.map
