import{a as A,b as m,c as M,d as W,e as q,f as $}from"./chunk-5JE2EH74.js";import{Ca as F,Ea as U,Ga as K,Ha as N,Ja as R,La as _,Ma as O,Na as B,Ta as H,Va as v,h as a,o as T,p as b,ta as L,wa as w,ya as Q}from"./chunk-5RCV3KPE.js";import{pb as j}from"./chunk-COS4XKZ5.js";import{kd as k,xd as S}from"./chunk-IJLITZAC.js";import{Ac as g,Td as V,wc as y,xc as h}from"./chunk-GSVPXWLR.js";import{h as I,k as E}from"./chunk-P5BPG5MC.js";import{a as c,i as l,n as u}from"./chunk-NSVULBS3.js";l();u();l();u();function J(e,r){return m(r,e)===0?0:e/m(r,e)*100}c(J,"calculateTotalPercentChange24h");var X=J;l();u();l();u();async function x({walletCaip19s:e,includeFungibleCaip19s:r,excludeFungibleCaip19s:i}){let n=await I.api().timeout(V({seconds:10})).get("/portfolio/v1/fungibles/value",{params:{walletAddresses:e.join(","),...r.length>0&&{includeFungibleCaip19s:r.join(",")},...i.length>0&&{excludeFungibleCaip19s:i.join(",")}}}).then(t=>{if(E(t))return t.data;throw new Error(t.data?.message||t.data?.error||t.statusText||`Status: ${t.status}`,{cause:t.data?.code})}).catch(t=>{throw g.addBreadcrumb(h.Tokens,"getPortfolioValue",y.Error,{message:t.message,cause:t.cause,walletCaip19s:e.join(","),...r.length>0&&{includeFungibleCaip19s:r.join(",")},...i.length>0&&{excludeFungibleCaip19s:i.join(",")}}),g.captureError(t,h.Tokens),t}),o=Q.parse(n);return o.errors&&o.errors.length>0&&o.errors.forEach(t=>{g.addBreadcrumb(h.Tokens,"getPortfolioValue_partialError",y.Info,{code:t.code,message:t.message,chainId:t.details.chainId,address:t.details.address})}),o}c(x,"getPortfolioValue");l();u();var Y=T(e=>{let r=e($);return r?j(r):{queryKey:["default-mainnet"],queryFn:c(()=>({isDeveloperMode:!1}),"queryFn")}}),Z=a(e=>!e(Y).data?.isDeveloperMode),P=Z;var ee=1e3,te=5e3,oe=b(a(e=>{let r=e(H),n=e(B).reduce((o,t)=>{let s=S(void 0,{key:t.legacyKey??"",spamStatus:t.spamStatus??k.NotVerified}),d=S(r,{key:t.legacyKey??"",spamStatus:t.spamStatus??k.NotVerified});return s===d?o:s?{...o,exclude:[...o.exclude,t.encodedCaip19]}:{...o,include:[...o.include,t.encodedCaip19]}},{include:[],exclude:[]});return{include:n.include.sort().slice(0,50),exclude:n.exclude.sort().slice(0,50)}}),e=>e,(e,r)=>e.include.join(",")===r.include.join(",")&&e.exclude.join(",")===r.exclude.join(",")),re=T(e=>{let r=e(K),{include:i,exclude:n}=e(oe),o=e(U),t=e(P),s=L.portfolioValue({walletCaip19s:r,include:i,exclude:n,isMainnet:t});return{enabled:r.length>0&&!o&&t,queryKey:s,meta:{fetchCount:0},refetchInterval:c(f=>{let p=Number(f.meta?.fetchCount??0);return f.meta&&(f.meta.fetchCount=p+1),Math.min(Math.max(p*250,ee),te)},"refetchInterval"),queryFn:c(async()=>x({walletCaip19s:r,includeFungibleCaip19s:i,excludeFungibleCaip19s:n}),"queryFn")}}),D=re;var z=a(e=>{let r=e(v),i=!1,n=r.reduce((o,t)=>{let s=t.livePrice?.price??t.price?.price,d=t.livePrice?.priceChange24h??t.price?.priceChange24h;s&&(i=!0);let f=q(t,s??0),p=W(f,d??0);return{currentValue:A(o.currentValue,f),priceDifference:A(o.priceDifference,p)}},{currentValue:0,priceDifference:0});return i?{currentValue:n.currentValue,priceDifference:n.priceDifference,totalPercentChange24h:X(n.priceDifference,n.currentValue)}:{currentValue:void 0,priceDifference:void 0,totalPercentChange24h:void 0}}),ne=F({atomToStoreOffline:D,offlineKey:a(e=>`${e(R)??""}:portfolio-value`),namespaceKey:"fungible-tokens",ttlMs:V({days:10}),initialValue:{totalValueUsdCentsCurrent:void 0,totalValueUsdStringCurrent:void 0,totalValueUsdCents24h:void 0,totalValueUsdString24h:void 0,totalPercentChange24h:void 0},schema:w}),G=a(e=>{let r=e(ne),i=r?.totalPercentChange24h,n=r?.totalValueUsdCents24h,o=r?.totalValueUsdCentsCurrent;return{currentValue:o!==void 0?o/100:void 0,priceDifference:n!==void 0&&o!==void 0?M(m(o,n),100):void 0,totalPercentChange24h:i}}),at=a(e=>{let r=e(z),i=e(G);return{local:r,remote:i}}),ie=a(e=>{let r=e(v),i=e(_),n=r.slice(-15).map(o=>{let t=i[o.encodedCaip19]??o.livePrice??o.price;return t?o.totalQuantity*t.price/10**o.decimals:0}).filter(o=>o>0);return n.length>0?M(n.reduce((o,t)=>A(o,t),0),n.length):void 0}),ae=b(D,e=>e.status),se=a(e=>{if(!e(P))return{status:"idle",data:{currentValue:void 0,priceDifference:void 0,totalPercentChange24h:void 0}};let i=e(z),n=e(ae),o=e(G),t=!e(O)&&e(N).isSuccess,s=e(ie),d=typeof s=="number"&&s<.05;return{status:n,data:t||d?i:o}}),st=se;export{P as a,D as b,at as c,st as d};
//# sourceMappingURL=chunk-UQHHKL5B.js.map
