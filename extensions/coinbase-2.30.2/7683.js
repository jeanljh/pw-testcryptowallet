"use strict";(self.webpackChunkcb_wallet_extension=self.webpackChunkcb_wallet_extension||[]).push([[7683],{37683:(e,s,t)=>{t.r(s),t.d(s,{StoreKeys_hasSyncedUTXOTxHistory:()=>g,StoreKeys_isSyncingUTXOTxHistory:()=>y,SyncUTXOTxHistoryOperation:()=>T});var n=t(62197),a=t.n(n),r=t(17906),i=t(52276),o=t(37420),l=t(45162),c=t(37106),d=t(37529),u=t(36213),w=t(81737),h=t(91427),p=t(88767);function g(e,s){return new r.U("hasSyncedUTXOTxHistory",`${e.rawValue}_${s.rawValue}`)}function y(e,s){return new i.X("isSyncingUTXOTxHistory",`${e.rawValue}_${s.rawValue}`)}class T extends c.K{wallet;isSyncingTxsKey;hasSyncedTxsKey;constructor(e){super(e.currencyCode,e.network),this.wallet=e,this.isSyncingTxsKey=y(e.currencyCode,e.network),this.hasSyncedTxsKey=g(e.currencyCode,e.network)}parseUTXOWalletTxResponse(e,s){const t=new Set(s);return e.map((e=>{const s=new Date(1e3*e.time);let n=new(a())(0),r=new(a())(0);e.inputs.forEach((e=>{const s=new(a())(e.value);n=n.add(s),t.has(e.address)&&(r=r.add(s))}));let i=new(a())(0),o=new(a())(0);e.outputs.forEach((e=>{const s=new(a())(e.value);i=i.add(s),t.has(e.address)&&(o=o.add(s))}));const l=r.gt(o),c=n.sub(i);let g,y;g=e.outputs.length>2?c.div(new(a())(e.outputs.length)):c,y=l?n.sub(o).sub(g):o;const T=(e,s)=>new(a())(s.value).lt(new(a())(e.value))?-1:new(a())(s.value).gt(new(a())(e.value))?1:0,C=e.outputs.sort(T),k=(C.find((e=>l?!t.has(e.address):t.has(e.address)))??C[0])?.address,x=e.inputs.sort(T),f=(x.find((e=>l?t.has(e.address):!t.has(e.address)))??x[0])?.address,m=new u.G(new Map([[w.YE,new(a())(e.inputs.length)],[w.vB,new(a())(e.outputs.length)]]));return new d.YW((0,p.Z)(),s,s,this.wallet.blockchain,this.wallet.currencyCode,this.wallet.currencyCode,this.wallet.decimals,k,f,y,g,h.Z.CONFIRMED,m,this.network,e.hash,l,void 0,this.wallet.displayName,this.wallet.decimals)}))}async getUTXOWalletTxs({addresses:e,after:s,pagingToken:t,page:n,perPage:r,fetchCompletionCondition:i}){if(n.gt(this.maximumPages))return s;const{response:o,nextPagingToken:c}=await(0,l.UN)({currencyCode:this.currencyCode,addresses:e,pagingToken:t,perPage:r,isTestnet:this.network.isTestnet}),d=this.parseUTXOWalletTxResponse(o,e);return await i(d)||!c.replace("\\s","")?[...s,...d]:this.getUTXOWalletTxs({addresses:e,after:[...s,...d],pagingToken:c,page:n.add(new(a())(1)),perPage:r,fetchCompletionCondition:i})}async getTransactions(){const e=await(0,o.rF)({blockchain:this.wallet.blockchain,currencyCode:this.wallet.currencyCode,network:this.network});return this.getUTXOWalletTxs({addresses:e.map((e=>e.address)),after:[],pagingToken:void 0,page:new(a())(0),perPage:this.perPage,fetchCompletionCondition:this.fetchCompletionCondition})}}}}]);
//# sourceMappingURL=7683.js.map