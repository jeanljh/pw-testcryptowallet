"use strict";(self.webpackChunkcb_wallet_extension=self.webpackChunkcb_wallet_extension||[]).push([[1345],{71345:(e,t,s)=>{s.d(t,{ZP:()=>A,BU:()=>j});var n,i,a=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=(e,t,s)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,h=(e,t)=>{for(var s in t||(t={}))p.call(t,s)&&l(e,s,t[s]);if(d)for(var s of d(t))c.call(t,s)&&l(e,s,t[s]);return e},u=(e,t)=>a(e,"name",{value:t,configurable:!0});(i=n||(n={})).LaunchEmbedded="launch_embedded",i.AppReady="app_ready",i.AppParams="app_params",i.SigninSuccess="signin_success",i.Success="success",i.Exit="exit",i.Event="event",i.PixelReady="pixel_ready",i.OnAppParamsNonce="on_app_params_nonce";var g=u(((e,{onMessage:t,shouldUnsubscribe:s=!0,allowedOrigin:n,onValidateOrigin:i=u((()=>Promise.resolve(!0)),"onValidateOrigin")})=>{const a=u((o=>{const{eventName:r,data:d}=w(o.data),p=!n||o.origin===n;r===e&&(async()=>{p&&await i(o.origin)&&(t(d),s&&window.removeEventListener("message",a))})()}),"onMessage");return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}}),"onBroadcastedPostMessage"),m=u(((e,t,{allowedOrigin:s="*",data:n}={})=>{const i=b(t,n);e.postMessage(i,s)}),"broadcastPostMessage"),w=u((e=>{try{return JSON.parse(e)}catch{return{eventName:e}}}),"parsePostMessage"),b=u(((e,t)=>t?JSON.stringify({eventName:e,data:t}):e),"formatPostMessage"),v="https://pay.coinbase.com";function y(e){const t=e.reduce(((e,{address:t,blockchains:s,assets:n})=>(e[t]=(e[t]||[]).concat(s||[]).concat(n||[]),e)),{});return Object.entries(t).forEach((([e,s])=>{t[e]=[...new Set(s)]})),t}u(y,"parseDestinationWallets");var E=u((({appId:e,destinationWallets:t,paymentMethodsSupported:s=[],host:n=v})=>{const i=new URL(n);return i.pathname="/buy/select-asset",i.searchParams.append("appId",e),i.searchParams.append("destinationWallets",JSON.stringify(y(t))),i.searchParams.append("paymentMethodsSupported",JSON.stringify(s)),i.toString()}),"generateOnrampURL"),x=u(((...e)=>{const t=E(...e);chrome.tabs.create({url:t.toString()})}),"open"),S="cbpay-embedded-onramp",P=u((({url:e,width:t="100%",height:s="100%",position:n="fixed",top:i="0px"})=>{const a=document.createElement("iframe");return a.style.border="unset",a.style.borderWidth="0",a.style.width=t.toString(),a.style.height=s.toString(),a.style.position=n,a.style.top=i,a.id=S,a.src=e,a}),"createEmbeddedContent"),f="coinbase-sdk-connect",I={width:460,height:730},L={width:430,height:600},O=class{constructor({host:e=v,appId:t,appParams:s,onReady:n}){this.nonce="",this.eventStreamListeners={},this.unsubs=[],this.isReady=!1,this.isLoggedIn=!1,this.openExperience=e=>{if(!this.isReady)return void this.onMessage("on_app_params_nonce",{onMessage:()=>{this.openExperience(e)}});const{path:t,experienceLoggedIn:s,experienceLoggedOut:n,embeddedContentStyles:i,onExit:a,onSuccess:o,onEvent:r}=e,d=new URL(`${this.host}${t}`);d.searchParams.append("appId",this.appId),d.searchParams.append("type","secure_standalone");const p=this.isLoggedIn?s:n||s;this.setupExperienceListeners({onExit:a,onSuccess:o,onEvent:r}),this.sendAppParams(this.appParams,(()=>{var e,t,s,n;d.searchParams.append("nonce",this.nonce);const a=d.toString();if(this.nonce="","embedded"===p){const e=u((()=>{var e;const t=P(h({url:a},i));(null==i?void 0:i.target)?null==(e=document.querySelector(null==i?void 0:i.target))||e.replaceChildren(t):document.body.appendChild(t)}),"openEmbeddedExperience");this.isLoggedIn?e():this.startDirectSignin(e)}else"popup"===p&&(null==(t=null==(e=window.chrome)?void 0:e.windows)?void 0:t.create)?window.chrome.windows.create({url:a,setSelfAsOpener:!0,type:"popup",focused:!0,width:I.width,height:I.height,left:window.screenLeft-I.width-10,top:window.screenTop},(e=>{this.addEventStreamListener("open",(()=>{(null==e?void 0:e.id)&&chrome.windows.update(e.id,{width:L.width,height:L.height,left:window.screenLeft-L.width-10,top:window.screenTop})}))})):"new_tab"===p&&(null==(n=null==(s=window.chrome)?void 0:s.tabs)?void 0:n.create)?window.chrome.tabs.create({url:a}):M(a,p)}))},this.endExperience=()=>{var e;null==(e=document.getElementById(S))||e.remove()},this.destroy=()=>{var e;null==(e=document.getElementById(f))||e.remove(),this.unsubs.forEach((e=>e()))},this.setupListeners=()=>{this.onMessage("pixel_ready",{shouldUnsubscribe:!1,onMessage:e=>{this.isLoggedIn=!!(null==e?void 0:e.isLoggedIn),this.sendAppParams(this.appParams)}}),this.onMessage("on_app_params_nonce",{shouldUnsubscribe:!0,onMessage:()=>{var e;this.isReady=!0,null==(e=this.onReadyCallback)||e.call(this)}}),this.onMessage("on_app_params_nonce",{shouldUnsubscribe:!1,onMessage:e=>{this.nonce=(null==e?void 0:e.nonce)||""}})},this.embedPixel=()=>{var e;null==(e=document.getElementById(f))||e.remove();const t=_({host:this.host,appId:this.appId});t.onerror=()=>{var e;null==(e=this.onReadyCallback)||e.call(this,new Error("Failed to initialize app"))},this.pixelIframe=t,document.body.appendChild(t)},this.sendAppParams=(e,t)=>{this.nonce?null==t||t():this.pixelIframe&&(m(this.pixelIframe.contentWindow,"app_params",{data:e}),this.onMessage("on_app_params_nonce",{onMessage:()=>null==t?void 0:t()}))},this.setupExperienceListeners=({onSuccess:e,onExit:t,onEvent:s})=>{s&&this.onMessage("event",{shouldUnsubscribe:!1,onMessage:n=>{var i;const a=n;null==(i=this.eventStreamListeners[a.eventName])||i.forEach((e=>null==e?void 0:e())),"success"===a.eventName&&(null==e||e()),"exit"===a.eventName&&(null==t||t(a.error)),s(n)}})},this.startDirectSignin=e=>{const t=new URLSearchParams;t.set("appId",this.appId),t.set("type","direct");const s=M(`${this.host}/signin?${t.toString()}`,"popup");this.onMessage("signin_success",{onMessage:()=>{null==s||s.close(),e()}})},this.addEventStreamListener=(e,t)=>{var s;this.eventStreamListeners[e]?null==(s=this.eventStreamListeners[e])||s.push(t):this.eventStreamListeners[e]=[t]},this.onMessage=(...e)=>{this.unsubs.push(g(e[0],h({allowedOrigin:this.host},e[1])))},this.host=e,this.appId=t,this.appParams=s,this.onReadyCallback=n,this.setupListeners(),this.embedPixel()}};function _({host:e,appId:t}){const s=document.createElement("iframe");s.style.border="unset",s.style.borderWidth="0",s.style.width="0",s.style.height="0",s.style.height="0",s.id=f;const n=new URL(`${e}/embed`);return n.searchParams.append("appId",t),s.src=n.toString(),s}function M(e,t){return window.open(e,"Coinbase","popup"===t?`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, height=${I.height},width=${I.width}`:void 0)}u(O,"CoinbasePixel"),u(_,"createPixel"),u(M,"openWindow");var R,C,N,k,U={buy:"/buy",checkout:"/checkout"},B=class{constructor(e){this.open=()=>{const{widget:e,experienceLoggedIn:t,experienceLoggedOut:s,embeddedContentStyles:n,onExit:i,onSuccess:a,onEvent:o,closeOnSuccess:r,closeOnExit:d}=this.options;this.pixel.openExperience({path:U[e],experienceLoggedIn:t,experienceLoggedOut:s,embeddedContentStyles:n,onExit:()=>{null==i||i(),d&&this.pixel.endExperience()},onSuccess:()=>{null==a||a(),r&&this.pixel.endExperience()},onEvent:o})},this.destroy=()=>{this.pixel.destroy()};const t=h({widget:e.widget},e.appParams);if(this.options=e,this.pixel=new O({host:e.host,appId:e.appId,appParams:t,onReady:e.onReady}),e.target){const t=document.querySelector(e.target);t&&t.addEventListener("click",this.open)}}};u(B,"CBPayInstance"),(C=R||(R={}))[C.Buy=0]="Buy",C[C.Sell=1]="Sell",(k=N||(N={}))[k.EIP712=2]="EIP712",k[k.ETHSIGN=3]="ETHSIGN",k[k.PRESIGNED=4]="PRESIGNED";var j=u((e=>{var t=e,{experienceLoggedIn:s="embedded",widgetParameters:n}=t,i=((e,t)=>{var s={};for(var n in e)p.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&d)for(var n of d(e))t.indexOf(n)<0&&c.call(e,n)&&(s[n]=e[n]);return s})(t,["experienceLoggedIn","widgetParameters"]);var a;return new B((a=h({},i),o(a,r({widget:"buy",experienceLoggedIn:s,appParams:n}))))}),"initOnramp"),A={open:x}}}]);
//# sourceMappingURL=1345.js.map